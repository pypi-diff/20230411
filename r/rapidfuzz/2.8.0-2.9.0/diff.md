# Comparing `tmp/rapidfuzz-2.8.0.tar.gz` & `tmp/rapidfuzz-2.9.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "rapidfuzz-2.8.0.tar", last modified: Sun Sep 11 21:18:48 2022, max compression
+gzip compressed data, was "rapidfuzz-2.9.0.tar", last modified: Fri Sep 16 01:00:42 2022, max compression
```

## Comparing `rapidfuzz-2.8.0.tar` & `rapidfuzz-2.9.0.tar`

### file list

```diff
@@ -1,178 +1,189 @@
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.834914 rapidfuzz-2.8.0/
--rw-r--r--   0 runner    (1001) docker     (121)     1473 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/CMakeLists.txt
--rw-r--r--   0 runner    (1001) docker     (121)     1091 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/LICENSE
--rw-r--r--   0 runner    (1001) docker     (121)     1043 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (121)     9043 2022-09-11 21:18:48.834914 rapidfuzz-2.8.0/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (121)     8325 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/README.md
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.806912 rapidfuzz-2.8.0/_custom_build/
--rw-r--r--   0 runner    (1001) docker     (121)     2568 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/_custom_build/backend.py
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.806912 rapidfuzz-2.8.0/extern/
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.806912 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/
--rw-r--r--   0 runner    (1001) docker     (121)     3855 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/CMakeLists.txt
--rw-r--r--   0 runner    (1001) docker     (121)     1084 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/LICENSE
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.806912 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.810912 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/
--rw-r--r--   0 runner    (1001) docker     (121)     1725 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/CharSet.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     4886 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/GrowingHashmap.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     4647 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/Matrix.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     5616 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/PatternMatchVector.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     4004 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/Range.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     2162 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/SplittedSentenceView.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     3891 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/common.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     5326 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/common_impl.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    12731 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/distance.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     4791 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/intrinsics.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     8074 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/type_traits.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    17508 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/types.hpp
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.810912 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/
--rw-r--r--   0 runner    (1001) docker     (121)     5804 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/DamerauLevenshtein.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     4493 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/DamerauLevenshtein_impl.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     5209 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Hamming.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     1003 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Hamming_impl.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     3965 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Indel.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     2722 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Indel_impl.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     4107 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/LCSseq.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    12976 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/LCSseq_impl.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    15426 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Levenshtein.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    38621 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Levenshtein_impl.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     3627 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    23714 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/fuzz.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    35494 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/fuzz.impl
--rw-r--r--   0 runner    (1001) docker     (121)      157 2022-09-11 21:18:04.000000 rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/rapidfuzz_all.hpp
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.810912 rapidfuzz-2.8.0/extern/taskflow/
--rw-r--r--   0 runner    (1001) docker     (121)    11309 2022-09-11 21:18:06.000000 rapidfuzz-2.8.0/extern/taskflow/CMakeLists.txt
--rw-r--r--   0 runner    (1001) docker     (121)     1207 2022-09-11 21:18:06.000000 rapidfuzz-2.8.0/extern/taskflow/LICENSE
--rw-r--r--   0 runner    (1001) docker     (121)      423 2022-09-11 21:18:06.000000 rapidfuzz-2.8.0/extern/taskflow/TaskflowConfig.cmake.in
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.810912 rapidfuzz-2.8.0/extern/taskflow/taskflow/
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.810912 rapidfuzz-2.8.0/extern/taskflow/taskflow/algorithm/
--rw-r--r--   0 runner    (1001) docker     (121)    18424 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/algorithm/for_each.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    20072 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/algorithm/reduce.hpp
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.810912 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/
--rw-r--r--   0 runner    (1001) docker     (121)      731 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/error.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    35442 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/executor.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    26935 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/flow_builder.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    13003 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/graph.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     9187 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/notifier.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    12920 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/observer.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    16728 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/task.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     7785 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/taskflow.hpp
--rw-r--r--   0 runner    (1001) docker     (121)      809 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/topology.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     6029 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/core/tsq.hpp
--rw-r--r--   0 runner    (1001) docker     (121)      621 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/declarations.hpp
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.814912 rapidfuzz-2.8.0/extern/taskflow/taskflow/nstd/
--rw-r--r--   0 runner    (1001) docker     (121)    96655 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/nstd/variant.hpp
--rw-r--r--   0 runner    (1001) docker     (121)      637 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/taskflow.hpp
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.814912 rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/
--rw-r--r--   0 runner    (1001) docker     (121)      586 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/iterator.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    19997 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/object_pool.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     2056 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/os.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     5774 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/passive_vector.hpp
--rw-r--r--   0 runner    (1001) docker     (121)      548 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/singleton.hpp
--rw-r--r--   0 runner    (1001) docker     (121)      505 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/stringify.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    11523 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/traits.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     5763 2022-09-11 21:18:07.000000 rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/uuid.hpp
--rw-r--r--   0 runner    (1001) docker     (121)      167 2022-09-11 21:18:38.000000 rapidfuzz-2.8.0/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (121)       38 2022-09-11 21:18:48.834914 rapidfuzz-2.8.0/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (121)     2434 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.806912 rapidfuzz-2.8.0/src/
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.822913 rapidfuzz-2.8.0/src/rapidfuzz/
--rw-r--r--   0 runner    (1001) docker     (121)     3889 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/CMakeLists.txt
--rw-r--r--   0 runner    (1001) docker     (121)      192 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/__init__.py
--rw-r--r--   0 runner    (1001) docker     (121)      201 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/__init__.pyi
--rw-r--r--   0 runner    (1001) docker     (121)    17374 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/cpp_common.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    15195 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/cpp_common.pxd
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.834914 rapidfuzz-2.8.0/src/rapidfuzz/distance/
--rw-r--r--   0 runner    (1001) docker     (121)     3246 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/CMakeLists.txt
--rw-r--r--   0 runner    (1001) docker     (121)      395 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/DamerauLevenshtein.py
--rw-r--r--   0 runner    (1001) docker     (121)     1107 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/DamerauLevenshtein.pyi
--rw-r--r--   0 runner    (1001) docker     (121)   543742 2022-09-11 21:18:37.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/DamerauLevenshtein_cpp.cxx
--rw-r--r--   0 runner    (1001) docker     (121)    10655 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/DamerauLevenshtein_cpp.pyx
--rw-r--r--   0 runner    (1001) docker     (121)     7034 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/DamerauLevenshtein_py.py
--rw-r--r--   0 runner    (1001) docker     (121)     1107 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/DamerauLevenshtein_py.pyi
--rw-r--r--   0 runner    (1001) docker     (121)      384 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming.py
--rw-r--r--   0 runner    (1001) docker     (121)      812 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming.pyi
--rw-r--r--   0 runner    (1001) docker     (121)   538514 2022-09-11 21:18:34.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming_cpp.cxx
--rw-r--r--   0 runner    (1001) docker     (121)    10160 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming_cpp.pyx
--rw-r--r--   0 runner    (1001) docker     (121)     5749 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming_py.py
--rw-r--r--   0 runner    (1001) docker     (121)     1059 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming_py.pyi
--rw-r--r--   0 runner    (1001) docker     (121)      470 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Indel.py
--rw-r--r--   0 runner    (1001) docker     (121)     1082 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Indel.pyi
--rw-r--r--   0 runner    (1001) docker     (121)   582766 2022-09-11 21:18:35.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Indel_cpp.cxx
--rw-r--r--   0 runner    (1001) docker     (121)    14097 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Indel_cpp.pyx
--rw-r--r--   0 runner    (1001) docker     (121)    10018 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Indel_py.py
--rw-r--r--   0 runner    (1001) docker     (121)     1329 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Indel_py.pyi
--rw-r--r--   0 runner    (1001) docker     (121)       54 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Jaro.py
--rw-r--r--   0 runner    (1001) docker     (121)       54 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Jaro.pyi
--rw-r--r--   0 runner    (1001) docker     (121)       61 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/JaroWinkler.py
--rw-r--r--   0 runner    (1001) docker     (121)       61 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/JaroWinkler.pyi
--rw-r--r--   0 runner    (1001) docker     (121)      471 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/LCSseq.py
--rw-r--r--   0 runner    (1001) docker     (121)     1082 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/LCSseq.pyi
--rw-r--r--   0 runner    (1001) docker     (121)   583062 2022-09-11 21:18:35.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/LCSseq_cpp.cxx
--rw-r--r--   0 runner    (1001) docker     (121)    14003 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/LCSseq_cpp.pyx
--rw-r--r--   0 runner    (1001) docker     (121)     9738 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/LCSseq_py.py
--rw-r--r--   0 runner    (1001) docker     (121)     1330 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/LCSseq_py.pyi
--rw-r--r--   0 runner    (1001) docker     (121)      476 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Levenshtein.py
--rw-r--r--   0 runner    (1001) docker     (121)     1417 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Levenshtein.pyi
--rw-r--r--   0 runner    (1001) docker     (121)   654424 2022-09-11 21:18:37.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Levenshtein_cpp.cxx
--rw-r--r--   0 runner    (1001) docker     (121)    20327 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Levenshtein_cpp.pyx
--rw-r--r--   0 runner    (1001) docker     (121)    13814 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Levenshtein_py.py
--rw-r--r--   0 runner    (1001) docker     (121)     1664 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/Levenshtein_py.pyi
--rw-r--r--   0 runner    (1001) docker     (121)      528 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/__init__.py
--rw-r--r--   0 runner    (1001) docker     (121)     3959 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/__init__.pyi
--rw-r--r--   0 runner    (1001) docker     (121)  1521239 2022-09-11 21:18:33.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/_initialize_cpp.cxx
--rw-r--r--   0 runner    (1001) docker     (121)      486 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/_initialize_cpp.pxd
--rw-r--r--   0 runner    (1001) docker     (121)    28172 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/_initialize_cpp.pyx
--rw-r--r--   0 runner    (1001) docker     (121)    12346 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/_initialize_py.py
--rw-r--r--   0 runner    (1001) docker     (121)    14308 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/distance/edit_based.hpp
--rw-r--r--   0 runner    (1001) docker     (121)      788 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/fuzz.py
--rw-r--r--   0 runner    (1001) docker     (121)     2185 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/fuzz.pyi
--rw-r--r--   0 runner    (1001) docker     (121)   646480 2022-09-11 21:18:27.000000 rapidfuzz-2.8.0/src/rapidfuzz/fuzz_cpp.cxx
--rw-r--r--   0 runner    (1001) docker     (121)     5206 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/fuzz_cpp.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    22594 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/fuzz_cpp.pyx
--rw-r--r--   0 runner    (1001) docker     (121)    25389 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/fuzz_py.py
--rw-r--r--   0 runner    (1001) docker     (121)     2551 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/fuzz_py.pyi
--rw-r--r--   0 runner    (1001) docker     (121)      348 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/process.py
--rw-r--r--   0 runner    (1001) docker     (121)     2699 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/process.pyi
--rw-r--r--   0 runner    (1001) docker     (121)     8476 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/process_cdist_cpp.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     3907 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/process_cdist_cpp.py
--rw-r--r--   0 runner    (1001) docker     (121)   808257 2022-09-11 21:18:29.000000 rapidfuzz-2.8.0/src/rapidfuzz/process_cdist_cpp_impl.cxx
--rw-r--r--   0 runner    (1001) docker     (121)      780 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/process_cdist_cpp_impl.pyi
--rw-r--r--   0 runner    (1001) docker     (121)     9416 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/process_cdist_cpp_impl.pyx
--rw-r--r--   0 runner    (1001) docker     (121)     4314 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/process_cdist_py.py
--rw-r--r--   0 runner    (1001) docker     (121)  1301454 2022-09-11 21:18:30.000000 rapidfuzz-2.8.0/src/rapidfuzz/process_cpp.cxx
--rw-r--r--   0 runner    (1001) docker     (121)     6915 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/process_cpp.hpp
--rw-r--r--   0 runner    (1001) docker     (121)    55126 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/process_cpp.pyx
--rw-r--r--   0 runner    (1001) docker     (121)    15716 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/process_py.py
--rw-r--r--   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/py.typed
--rw-r--r--   0 runner    (1001) docker     (121)    13125 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/string_metric.py
--rw-r--r--   0 runner    (1001) docker     (121)     1519 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/string_metric.pyi
--rw-r--r--   0 runner    (1001) docker     (121)   255643 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/unicodetype_db.h
--rw-r--r--   0 runner    (1001) docker     (121)     2111 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/utils.cpp
--rw-r--r--   0 runner    (1001) docker     (121)     3668 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/utils.hpp
--rw-r--r--   0 runner    (1001) docker     (121)      794 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/utils.py
--rw-r--r--   0 runner    (1001) docker     (121)      116 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/utils.pyi
--rw-r--r--   0 runner    (1001) docker     (121)   428559 2022-09-11 21:18:31.000000 rapidfuzz-2.8.0/src/rapidfuzz/utils_cpp.cxx
--rw-r--r--   0 runner    (1001) docker     (121)     2128 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/utils_cpp.hpp
--rw-r--r--   0 runner    (1001) docker     (121)     1613 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/utils_cpp.pyx
--rw-r--r--   0 runner    (1001) docker     (121)      574 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/src/rapidfuzz/utils_py.py
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.822913 rapidfuzz-2.8.0/src/rapidfuzz.egg-info/
--rw-r--r--   0 runner    (1001) docker     (121)     9043 2022-09-11 21:18:48.000000 rapidfuzz-2.8.0/src/rapidfuzz.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (121)     5877 2022-09-11 21:18:48.000000 rapidfuzz-2.8.0/src/rapidfuzz.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (121)        1 2022-09-11 21:18:48.000000 rapidfuzz-2.8.0/src/rapidfuzz.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (121)       40 2022-09-11 21:18:48.000000 rapidfuzz-2.8.0/src/rapidfuzz.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (121)       10 2022-09-11 21:18:48.000000 rapidfuzz-2.8.0/src/rapidfuzz.egg-info/top_level.txt
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.834914 rapidfuzz-2.8.0/tests/
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-11 21:18:48.834914 rapidfuzz-2.8.0/tests/distance/
--rw-r--r--   0 runner    (1001) docker     (121)     2289 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/distance/test_DamerauLevenshtein.py
--rw-r--r--   0 runner    (1001) docker     (121)     2641 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/distance/test_Hamming.py
--rw-r--r--   0 runner    (1001) docker     (121)     2593 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/distance/test_Indel.py
--rw-r--r--   0 runner    (1001) docker     (121)     2069 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/distance/test_LCSseq.py
--rw-r--r--   0 runner    (1001) docker     (121)     6346 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/distance/test_Levenshtein.py
--rw-r--r--   0 runner    (1001) docker     (121)     9130 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/distance/test_init.py
--rw-r--r--   0 runner    (1001) docker     (121)      140 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/test_cpp_fallback.py
--rw-r--r--   0 runner    (1001) docker     (121)    11875 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/test_fuzz.py
--rw-r--r--   0 runner    (1001) docker     (121)    22248 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/test_hypothesis.py
--rw-r--r--   0 runner    (1001) docker     (121)    12578 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/test_process.py
--rw-r--r--   0 runner    (1001) docker     (121)      151 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/test_pure_python_fallback.py
--rw-r--r--   0 runner    (1001) docker     (121)     3610 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/test_string_metric.py
--rw-r--r--   0 runner    (1001) docker     (121)      947 2022-09-11 21:18:01.000000 rapidfuzz-2.8.0/tests/test_utils.py
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.769708 rapidfuzz-2.9.0/
+-rw-r--r--   0 runner    (1001) docker     (121)     1402 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/CMakeLists.txt
+-rw-r--r--   0 runner    (1001) docker     (121)     1091 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (121)     1043 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (121)     9043 2022-09-16 01:00:42.769708 rapidfuzz-2.9.0/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (121)     8325 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/README.md
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.741708 rapidfuzz-2.9.0/_custom_build/
+-rw-r--r--   0 runner    (1001) docker     (121)     2568 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/_custom_build/backend.py
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.741708 rapidfuzz-2.9.0/extern/
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.741708 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/
+-rw-r--r--   0 runner    (1001) docker     (121)     3855 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/CMakeLists.txt
+-rw-r--r--   0 runner    (1001) docker     (121)     1084 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/LICENSE
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.741708 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.745708 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/
+-rw-r--r--   0 runner    (1001) docker     (121)     1700 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/CharSet.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     4861 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/GrowingHashmap.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     4622 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/Matrix.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     5592 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/PatternMatchVector.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     3890 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/Range.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     2142 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/SplittedSentenceView.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     3167 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/common.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     4937 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/common_impl.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    12158 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/distance.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     4533 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/intrinsics.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     1346 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/type_traits.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    17508 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/types.hpp
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.745708 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/
+-rw-r--r--   0 runner    (1001) docker     (121)     5718 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/DamerauLevenshtein.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     4468 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/DamerauLevenshtein_impl.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     5123 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Hamming.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)      979 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Hamming_impl.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     3869 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Indel.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     2698 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Indel_impl.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     4043 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/LCSseq.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    12866 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/LCSseq_impl.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    15295 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Levenshtein.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    38328 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Levenshtein_impl.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     5275 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/OSA.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     5385 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/OSA_impl.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     3665 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    22869 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/fuzz.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    35554 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/fuzz.impl
+-rw-r--r--   0 runner    (1001) docker     (121)      157 2022-09-16 01:00:09.000000 rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/rapidfuzz_all.hpp
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.745708 rapidfuzz-2.9.0/extern/taskflow/
+-rw-r--r--   0 runner    (1001) docker     (121)    13782 2022-09-16 01:00:10.000000 rapidfuzz-2.9.0/extern/taskflow/CMakeLists.txt
+-rw-r--r--   0 runner    (1001) docker     (121)     1091 2022-09-16 01:00:10.000000 rapidfuzz-2.9.0/extern/taskflow/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (121)      458 2022-09-16 01:00:10.000000 rapidfuzz-2.9.0/extern/taskflow/TaskflowConfig.cmake.in
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.745708 rapidfuzz-2.9.0/extern/taskflow/taskflow/
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.749708 rapidfuzz-2.9.0/extern/taskflow/taskflow/algorithm/
+-rw-r--r--   0 runner    (1001) docker     (121)     2172 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/algorithm/critical.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     5475 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/algorithm/for_each.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    31688 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/algorithm/pipeline.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     6511 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/algorithm/reduce.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    14123 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/algorithm/sort.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     5794 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/algorithm/transform.hpp
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.753708 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/
+-rw-r--r--   0 runner    (1001) docker     (121)     1346 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/declarations.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)      160 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/environment.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)      728 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/error.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    54781 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/executor-module-opt.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    55153 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/executor.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    33586 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/flow_builder.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    19798 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/graph.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     9176 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/notifier.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    17682 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/observer.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     3441 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/semaphore.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    19549 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/task.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    17073 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/taskflow.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     1220 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/topology.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     6578 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/tsq.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     3034 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/core/worker.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     1057 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/taskflow.hpp
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.753708 rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/
+-rw-r--r--   0 runner    (1001) docker     (121)      603 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/iterator.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     3055 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/math.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    19886 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/object_pool.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     4048 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/os.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)      553 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/singleton.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    31190 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/small_vector.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)      681 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/stream.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     6085 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/traits.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     5685 2022-09-16 01:00:11.000000 rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/uuid.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)      167 2022-09-16 01:00:33.000000 rapidfuzz-2.9.0/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (121)       38 2022-09-16 01:00:42.769708 rapidfuzz-2.9.0/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (121)     2434 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.741708 rapidfuzz-2.9.0/src/
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.761708 rapidfuzz-2.9.0/src/rapidfuzz/
+-rw-r--r--   0 runner    (1001) docker     (121)     3445 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/CMakeLists.txt
+-rw-r--r--   0 runner    (1001) docker     (121)      192 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (121)      201 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/__init__.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)     2096 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/_utils.py
+-rw-r--r--   0 runner    (1001) docker     (121)      227 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/_utils.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)    17374 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/cpp_common.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    15195 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/cpp_common.pxd
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.769708 rapidfuzz-2.9.0/src/rapidfuzz/distance/
+-rw-r--r--   0 runner    (1001) docker     (121)     1416 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/CMakeLists.txt
+-rw-r--r--   0 runner    (1001) docker     (121)      817 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/DamerauLevenshtein.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1107 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/DamerauLevenshtein.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      349 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/DamerauLevenshtein_cpp.py
+-rw-r--r--   0 runner    (1001) docker     (121)     6084 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/DamerauLevenshtein_py.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1059 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/DamerauLevenshtein_py.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      806 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Hamming.py
+-rw-r--r--   0 runner    (1001) docker     (121)      812 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Hamming.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      301 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Hamming_cpp.py
+-rw-r--r--   0 runner    (1001) docker     (121)     4922 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Hamming_py.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1059 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Hamming_py.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      892 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Indel.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1082 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Indel.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      353 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Indel_cpp.py
+-rw-r--r--   0 runner    (1001) docker     (121)     9191 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Indel_py.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1329 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Indel_py.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)       54 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Jaro.py
+-rw-r--r--   0 runner    (1001) docker     (121)       54 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Jaro.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)       61 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/JaroWinkler.py
+-rw-r--r--   0 runner    (1001) docker     (121)       61 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/JaroWinkler.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      893 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/LCSseq.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1082 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/LCSseq.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      365 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/LCSseq_cpp.py
+-rw-r--r--   0 runner    (1001) docker     (121)     8911 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/LCSseq_py.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1330 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/LCSseq_py.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)     1135 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Levenshtein.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1417 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Levenshtein.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      389 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Levenshtein_cpp.py
+-rw-r--r--   0 runner    (1001) docker     (121)    12987 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Levenshtein_py.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1664 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/Levenshtein_py.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      802 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/OSA.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1059 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/OSA.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      285 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/OSA_cpp.py
+-rw-r--r--   0 runner    (1001) docker     (121)     5741 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/OSA_py.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1059 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/OSA_py.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      590 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (121)     3959 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/__init__.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)  1521073 2022-09-16 01:00:31.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/_initialize_cpp.cxx
+-rw-r--r--   0 runner    (1001) docker     (121)      486 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/_initialize_cpp.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)    28140 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/_initialize_cpp.pyx
+-rw-r--r--   0 runner    (1001) docker     (121)    12346 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/_initialize_py.py
+-rw-r--r--   0 runner    (1001) docker     (121)    16854 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/metrics.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)  1018863 2022-09-16 01:00:33.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/metrics_cpp.cxx
+-rw-r--r--   0 runner    (1001) docker     (121)     5486 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/metrics_cpp.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)    35650 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/distance/metrics_cpp.pyx
+-rw-r--r--   0 runner    (1001) docker     (121)      808 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/fuzz.py
+-rw-r--r--   0 runner    (1001) docker     (121)     2185 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/fuzz.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)   616550 2022-09-16 01:00:27.000000 rapidfuzz-2.9.0/src/rapidfuzz/fuzz_cpp.cxx
+-rw-r--r--   0 runner    (1001) docker     (121)     5206 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/fuzz_cpp.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)    10534 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/fuzz_cpp.pyx
+-rw-r--r--   0 runner    (1001) docker     (121)    25389 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/fuzz_py.py
+-rw-r--r--   0 runner    (1001) docker     (121)     2551 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/fuzz_py.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)      347 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/process.py
+-rw-r--r--   0 runner    (1001) docker     (121)     2699 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/process.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)    15351 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/process_cpp.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     1604 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/process_cpp.py
+-rw-r--r--   0 runner    (1001) docker     (121)  1657650 2022-09-16 01:00:29.000000 rapidfuzz-2.9.0/src/rapidfuzz/process_cpp_impl.cxx
+-rw-r--r--   0 runner    (1001) docker     (121)     2701 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/process_cpp_impl.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)    51937 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/process_cpp_impl.pyx
+-rw-r--r--   0 runner    (1001) docker     (121)    19926 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/process_py.py
+-rw-r--r--   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/py.typed
+-rw-r--r--   0 runner    (1001) docker     (121)    13131 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/string_metric.py
+-rw-r--r--   0 runner    (1001) docker     (121)     1519 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/string_metric.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)   255643 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/unicodetype_db.h
+-rw-r--r--   0 runner    (1001) docker     (121)     2111 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/utils.cpp
+-rw-r--r--   0 runner    (1001) docker     (121)     3668 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/utils.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)      206 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/utils.py
+-rw-r--r--   0 runner    (1001) docker     (121)      116 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/utils.pyi
+-rw-r--r--   0 runner    (1001) docker     (121)   428314 2022-09-16 01:00:30.000000 rapidfuzz-2.9.0/src/rapidfuzz/utils_cpp.cxx
+-rw-r--r--   0 runner    (1001) docker     (121)     2128 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/utils_cpp.hpp
+-rw-r--r--   0 runner    (1001) docker     (121)     1270 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/utils_cpp.pyx
+-rw-r--r--   0 runner    (1001) docker     (121)      574 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/src/rapidfuzz/utils_py.py
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.761708 rapidfuzz-2.9.0/src/rapidfuzz.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (121)     9043 2022-09-16 01:00:42.000000 rapidfuzz-2.9.0/src/rapidfuzz.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (121)     6338 2022-09-16 01:00:42.000000 rapidfuzz-2.9.0/src/rapidfuzz.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (121)        1 2022-09-16 01:00:42.000000 rapidfuzz-2.9.0/src/rapidfuzz.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (121)       40 2022-09-16 01:00:42.000000 rapidfuzz-2.9.0/src/rapidfuzz.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (121)       10 2022-09-16 01:00:42.000000 rapidfuzz-2.9.0/src/rapidfuzz.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.769708 rapidfuzz-2.9.0/tests/
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2022-09-16 01:00:42.769708 rapidfuzz-2.9.0/tests/distance/
+-rw-r--r--   0 runner    (1001) docker     (121)     2289 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/distance/test_DamerauLevenshtein.py
+-rw-r--r--   0 runner    (1001) docker     (121)     2641 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/distance/test_Hamming.py
+-rw-r--r--   0 runner    (1001) docker     (121)     2593 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/distance/test_Indel.py
+-rw-r--r--   0 runner    (1001) docker     (121)     2069 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/distance/test_LCSseq.py
+-rw-r--r--   0 runner    (1001) docker     (121)     7133 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/distance/test_Levenshtein.py
+-rw-r--r--   0 runner    (1001) docker     (121)     3628 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/distance/test_OSA.py
+-rw-r--r--   0 runner    (1001) docker     (121)     9130 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/distance/test_init.py
+-rw-r--r--   0 runner    (1001) docker     (121)      142 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/test_cpp_fallback.py
+-rw-r--r--   0 runner    (1001) docker     (121)    11875 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/test_fuzz.py
+-rw-r--r--   0 runner    (1001) docker     (121)    23661 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/test_hypothesis.py
+-rw-r--r--   0 runner    (1001) docker     (121)    12578 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/test_process.py
+-rw-r--r--   0 runner    (1001) docker     (121)      153 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/test_pure_python_fallback.py
+-rw-r--r--   0 runner    (1001) docker     (121)     3610 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/test_string_metric.py
+-rw-r--r--   0 runner    (1001) docker     (121)      947 2022-09-16 01:00:06.000000 rapidfuzz-2.9.0/tests/test_utils.py
```

### Comparing `rapidfuzz-2.8.0/CMakeLists.txt` & `rapidfuzz-2.9.0/CMakeLists.txt`

 * *Files 18% similar despite different names*

```diff
@@ -19,17 +19,14 @@
 find_package(PythonExtensions REQUIRED)
 find_package(Python COMPONENTS Interpreter Development)
 include(FetchContent)
 
 set(RF_BASE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/src)
 
 find_package(Taskflow 3.0.0 QUIET)
-if (NOT Taskflow_FOUND)
-    find_package(Taskflow 2.7.0 QUIET)
-endif()
 if (Taskflow_FOUND)
     message("Using system supplied version of Taskflow")
 else()
     message("Using packaged version of Taskflow")
     set(TF_BUILD_CUDA OFF CACHE BOOL "Enables build of CUDA code")
     set(TF_BUILD_TESTS OFF CACHE BOOL "Enables build of tests")
     set(TF_BUILD_EXAMPLES OFF CACHE BOOL "Enables build of examples")
```

### Comparing `rapidfuzz-2.8.0/LICENSE` & `rapidfuzz-2.9.0/LICENSE`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/MANIFEST.in` & `rapidfuzz-2.9.0/MANIFEST.in`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/PKG-INFO` & `rapidfuzz-2.9.0/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: rapidfuzz
-Version: 2.8.0
+Version: 2.9.0
 Summary: rapid fuzzy string matching
 Home-page: https://github.com/maxbachmann/RapidFuzz
 Author: Max Bachmann
 Author-email: pypi@maxbachmann.de
 License: MIT
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.6
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.1 Name: rapidfuzz Version: 2.8.0 Summary: rapid fuzzy
+Metadata-Version: 2.1 Name: rapidfuzz Version: 2.9.0 Summary: rapid fuzzy
 string matching Home-page: https://github.com/maxbachmann/RapidFuzz Author: Max
 Bachmann Author-email: pypi@maxbachmann.de License: MIT Classifier: Programming
 Language :: Python :: 3 Classifier: Programming Language :: Python :: 3.6
 Classifier: Programming Language :: Python :: 3.7 Classifier: Programming
 Language :: Python :: 3.8 Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python :: 3.10 Classifier: Programming
 Language :: Python :: 3.11 Classifier: License :: OSI Approved :: MIT License
```

### Comparing `rapidfuzz-2.8.0/README.md` & `rapidfuzz-2.9.0/README.md`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/_custom_build/backend.py` & `rapidfuzz-2.9.0/_custom_build/backend.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/CMakeLists.txt` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/CMakeLists.txt`

 * *Files 1% similar despite different names*

```diff
@@ -16,15 +16,15 @@
 # RapidFuzz's build breaks if done in-tree. You probably should not build
 # things in tree anyway, but we can allow projects that include RapidFuzz
 # as a subproject to build in-tree as long as it is not in our tree.
 if (CMAKE_BINARY_DIR STREQUAL CMAKE_CURRENT_SOURCE_DIR)
     message(FATAL_ERROR "Building in-source is not supported! Create a build dir and remove ${CMAKE_SOURCE_DIR}/CMakeCache.txt")
 endif()
 
-project(rapidfuzz LANGUAGES CXX VERSION 1.5.0)
+project(rapidfuzz LANGUAGES CXX VERSION 1.6.0)
 
 list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_LIST_DIR}/cmake")
 include(GNUInstallDirs)
 include(CMakePackageConfigHelpers)
 
 # Basic paths
 set(BASE_DIR ${CMAKE_CURRENT_SOURCE_DIR})
@@ -34,15 +34,15 @@
 set(EXAMPLES_DIR ${BASE_DIR}/examples)
 
 add_library(rapidfuzz INTERFACE)
 
 # provide a namespaced alias for clients to 'link' against if RapidFuzz is included as a sub-project
 add_library(rapidfuzz::rapidfuzz ALIAS rapidfuzz)
 
-target_compile_features(rapidfuzz INTERFACE cxx_std_14)
+target_compile_features(rapidfuzz INTERFACE cxx_std_17)
 
 target_include_directories(rapidfuzz
     INTERFACE
       $<BUILD_INTERFACE:${SOURCES_DIR}/..>
       $<INSTALL_INTERFACE:${CMAKE_INSTALL_INCLUDEDIR}>
 )
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/LICENSE` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/LICENSE`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/CharSet.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/CharSet.hpp`

 * *Files 4% similar despite different names*

```diff
@@ -4,16 +4,15 @@
 #pragma once
 #include <array>
 #include <limits>
 #include <stdio.h>
 #include <type_traits>
 #include <unordered_set>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 /*
  * taken from https://stackoverflow.com/a/17251989/11335032
  */
 template <typename T, typename U>
 bool CanTypeFitValue(const U value)
 {
@@ -67,9 +66,8 @@
     {
         if (!CanTypeFitValue<CharT1>(ch)) return false;
 
         return m_val.find(CharT1(ch)) != m_val.end();
     }
 };
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/GrowingHashmap.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/GrowingHashmap.hpp`

 * *Files 2% similar despite different names*

```diff
@@ -4,16 +4,15 @@
 #pragma once
 
 #include <array>
 #include <iterator>
 #include <new>
 #include <stdint.h>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 /* hashmap for integers which can only grow, but can't remove elements */
 template <typename T_Key, typename T_Entry>
 struct GrowingHashmap {
     using key_type = T_Key;
     using value_type = T_Entry;
     using size_type = unsigned int;
@@ -198,9 +197,8 @@
     }
 
 private:
     GrowingHashmap<key_type, value_type> m_map;
     std::array<value_type, 256> m_extendedAscii;
 };
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/Matrix.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/Matrix.hpp`

 * *Files 2% similar despite different names*

```diff
@@ -7,16 +7,15 @@
 #include <cstddef>
 #include <cstdint>
 #include <stdexcept>
 #include <stdint.h>
 #include <stdio.h>
 #include <vector>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 template <typename T, bool IsConst>
 struct BitMatrixView {
 
     using value_type = T;
     using size_type = size_t;
     using pointer = std::conditional_t<IsConst, const value_type*, value_type*>;
@@ -196,9 +195,8 @@
     }
 
 private:
     BitMatrix<value_type> m_matrix;
     std::vector<ptrdiff_t> m_offsets;
 };
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/PatternMatchVector.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/PatternMatchVector.hpp`

 * *Files 1% similar despite different names*

```diff
@@ -11,16 +11,15 @@
 #include <vector>
 
 #include <rapidfuzz/details/GrowingHashmap.hpp>
 #include <rapidfuzz/details/Matrix.hpp>
 #include <rapidfuzz/details/Range.hpp>
 #include <rapidfuzz/details/intrinsics.hpp>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 struct BitvectorHashmap {
     BitvectorHashmap() : m_map()
     {}
 
     template <typename CharT>
     uint64_t get(CharT key) const noexcept
@@ -220,9 +219,8 @@
 
 private:
     size_t m_block_count;
     BitvectorHashmap* m_map;
     BitMatrix<uint64_t> m_extendedAscii;
 };
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/Range.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/Range.hpp`

 * *Files 7% similar despite different names*

```diff
@@ -5,30 +5,62 @@
 
 #include <iterator>
 #include <limits>
 #include <ostream>
 #include <stdexcept>
 #include <vector>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
+
+template <typename CharT>
+CharT* to_begin(CharT* s)
+{
+    return s;
+}
+
+template <typename T>
+auto to_begin(T& x)
+{
+    using std::begin;
+    return begin(x);
+}
+
+template <typename CharT>
+CharT* to_end(CharT* s)
+{
+    while (*s != 0) {
+        ++s;
+    }
+    return s;
+}
+
+template <typename T>
+auto to_end(T& x)
+{
+    using std::end;
+    return end(x);
+}
 
 template <typename Iter>
 class Range {
     Iter _first;
     Iter _last;
 
 public:
     using value_type = typename std::iterator_traits<Iter>::value_type;
     using iterator = Iter;
     using reverse_iterator = std::reverse_iterator<iterator>;
 
     constexpr Range(Iter first, Iter last) : _first(first), _last(last)
     {}
 
+    template <typename T>
+    constexpr Range(T& x) : _first(to_begin(x)), _last(to_end(x))
+    {}
+
     constexpr iterator begin() const noexcept
     {
         return _first;
     }
     constexpr iterator end() const noexcept
     {
         return _last;
@@ -99,55 +131,16 @@
         for (auto x : seq)
             os << static_cast<uint64_t>(x) << ", ";
         os << "]";
         return os;
     }
 };
 
-template <typename CharT>
-CharT* to_begin(CharT* s)
-{
-    return s;
-}
-
 template <typename T>
-auto to_begin(T& x)
-{
-    using std::begin;
-    return begin(x);
-}
-
-template <typename CharT>
-CharT* to_end(CharT* s)
-{
-    while (*s != 0) {
-        ++s;
-    }
-    return s;
-}
-
-template <typename T>
-auto to_end(T& x)
-{
-    using std::end;
-    return end(x);
-}
-
-template <typename Iter>
-constexpr auto make_range(Iter first, Iter last)
-{
-    return Range<Iter>(first, last);
-}
-
-template <typename T>
-constexpr auto make_range(T& x)
-{
-    auto first = to_begin(x);
-    return Range<decltype(first)>(first, to_end(x));
-}
+Range(T& x) -> Range<decltype(to_begin(x))>;
 
 template <typename InputIt1, typename InputIt2>
 inline bool operator==(const Range<InputIt1>& a, const Range<InputIt2>& b)
 {
     return std::equal(a.begin(), a.end(), b.begin(), b.end());
 }
 
@@ -180,9 +173,8 @@
 {
     return !(a < b);
 }
 
 template <typename InputIt>
 using RangeVec = std::vector<Range<InputIt>>;
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/SplittedSentenceView.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/SplittedSentenceView.hpp`

 * *Files 5% similar despite different names*

```diff
@@ -1,22 +1,22 @@
 #pragma once
 #include <algorithm>
 #include <rapidfuzz/details/Range.hpp>
 #include <rapidfuzz/details/type_traits.hpp>
 #include <string>
 
-namespace rapidfuzz {
+namespace rapidfuzz::detail {
 
 template <typename InputIt>
 class SplittedSentenceView {
 public:
     using CharT = iter_value_t<InputIt>;
 
-    SplittedSentenceView(detail::RangeVec<InputIt> sentence) noexcept(
-        std::is_nothrow_move_constructible<detail::RangeVec<InputIt>>::value)
+    SplittedSentenceView(RangeVec<InputIt> sentence) noexcept(
+        std::is_nothrow_move_constructible_v<RangeVec<InputIt>>)
         : m_sentence(std::move(sentence))
     {}
 
     size_t dedupe();
     size_t size() const;
 
     size_t length() const
@@ -32,21 +32,21 @@
     size_t word_count() const
     {
         return m_sentence.size();
     }
 
     std::basic_string<CharT> join() const;
 
-    const detail::RangeVec<InputIt>& words() const
+    const RangeVec<InputIt>& words() const
     {
         return m_sentence;
     }
 
 private:
-    detail::RangeVec<InputIt> m_sentence;
+    RangeVec<InputIt> m_sentence;
 };
 
 template <typename InputIt>
 size_t SplittedSentenceView<InputIt>::dedupe()
 {
     size_t old_word_count = word_count();
     m_sentence.erase(std::unique(m_sentence.begin(), m_sentence.end()), m_sentence.end());
@@ -81,8 +81,8 @@
     for (; sentence_iter != m_sentence.end(); ++sentence_iter) {
         joined.append(whitespace)
             .append(std::basic_string<CharT>(sentence_iter->begin(), sentence_iter->end()));
     }
     return joined;
 }
 
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/common.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/common.hpp`

 * *Files 21% similar despite different names*

```diff
@@ -9,31 +9,29 @@
 #include <rapidfuzz/details/Range.hpp>
 #include <rapidfuzz/details/SplittedSentenceView.hpp>
 #include <rapidfuzz/details/intrinsics.hpp>
 #include <rapidfuzz/details/type_traits.hpp>
 #include <rapidfuzz/details/types.hpp>
 #include <vector>
 
-namespace rapidfuzz {
+namespace rapidfuzz::detail {
 
 template <typename InputIt1, typename InputIt2, typename InputIt3>
 struct DecomposedSet {
     SplittedSentenceView<InputIt1> difference_ab;
     SplittedSentenceView<InputIt2> difference_ba;
     SplittedSentenceView<InputIt3> intersection;
     DecomposedSet(SplittedSentenceView<InputIt1> diff_ab, SplittedSentenceView<InputIt2> diff_ba,
                   SplittedSentenceView<InputIt3> intersect)
         : difference_ab(std::move(diff_ab)),
           difference_ba(std::move(diff_ba)),
           intersection(std::move(intersect))
     {}
 };
 
-namespace detail {
-
 /**
  * @defgroup Common Common
  * Common utilities shared among multiple functions
  * @{
  */
 
 static inline double NormSim_to_NormDist(double score_cutoff, double imprecision = 0.00001)
@@ -72,31 +70,16 @@
 
 template <int Max = 1>
 static inline int64_t score_cutoff_to_distance(double score_cutoff, int64_t lensum)
 {
     return static_cast<int64_t>(std::ceil(static_cast<double>(lensum) * (1.0 - score_cutoff / Max)));
 }
 
-template <typename T>
-constexpr bool is_zero(T a, T tolerance = std::numeric_limits<T>::epsilon())
-{
-    return std::fabs(a) <= tolerance;
-}
-
-template <typename Sentence, typename CharT = char_type<Sentence>,
-          typename = std::enable_if_t<is_explicitly_convertible<Sentence, std::basic_string<CharT>>::value>>
-std::basic_string<CharT> to_string(Sentence&& str);
-
-template <typename Sentence, typename CharT = char_type<Sentence>,
-          typename = std::enable_if_t<!is_explicitly_convertible<Sentence, std::basic_string<CharT>>::value &&
-                                      has_data_and_size<Sentence>::value>>
-std::basic_string<CharT> to_string(const Sentence& str);
-
 template <typename InputIt1, typename InputIt2>
-StringAffix remove_common_affix(detail::Range<InputIt1>& s1, detail::Range<InputIt2>& s2);
+StringAffix remove_common_affix(Range<InputIt1>& s1, Range<InputIt2>& s2);
 
 template <typename InputIt1, typename InputIt2>
 StringAffix remove_common_affix(InputIt1& first1, InputIt1& last1, InputIt2& first2, InputIt2& last2);
 
 template <typename InputIt1, typename InputIt2>
 size_t remove_common_prefix(InputIt1& first1, InputIt1 last1, InputIt2& first2, InputIt2 last2);
 
@@ -104,11 +87,10 @@
 size_t remove_common_suffix(InputIt1 first1, InputIt1& last1, InputIt2 first2, InputIt2& last2);
 
 template <typename InputIt, typename CharT = iter_value_t<InputIt>>
 SplittedSentenceView<InputIt> sorted_split(InputIt first, InputIt last);
 
 /**@}*/
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
 
 #include <rapidfuzz/details/common_impl.hpp>
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/common_impl.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/common_impl.hpp`

 * *Files 5% similar despite different names*

```diff
@@ -2,16 +2,15 @@
 /* Copyright  2020 Max Bachmann */
 
 #include <algorithm>
 #include <array>
 #include <cctype>
 #include <cwctype>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 template <typename InputIt1, typename InputIt2>
 DecomposedSet<InputIt1, InputIt2, InputIt1> set_decomposition(SplittedSentenceView<InputIt1> a,
                                                               SplittedSentenceView<InputIt2> b)
 {
     a.dedupe();
     b.dedupe();
@@ -31,26 +30,14 @@
             difference_ab.push_back(current_a);
         }
     }
 
     return {difference_ab, difference_ba, intersection};
 }
 
-template <typename Sentence, typename CharT, typename>
-std::basic_string<CharT> to_string(Sentence&& str)
-{
-    return std::basic_string<CharT>(std::forward<Sentence>(str));
-}
-
-template <typename Sentence, typename CharT, typename>
-std::basic_string<CharT> to_string(const Sentence& str)
-{
-    return std::basic_string<CharT>(str.data(), str.size());
-}
-
 /**
  * Removes common prefix of two string views
  */
 template <typename InputIt1, typename InputIt2>
 size_t remove_common_prefix(InputIt1& first1, InputIt1 last1, InputIt2& first2, InputIt2 last2)
 {
     auto prefix = std::distance(first1, std::mismatch(first1, last1, first2, last2).first);
@@ -90,16 +77,16 @@
 StringAffix remove_common_affix(Range<InputIt1>& s1, Range<InputIt2>& s2)
 {
     InputIt1 first1 = s1.begin();
     InputIt1 last1 = s1.end();
     InputIt2 first2 = s2.begin();
     InputIt2 last2 = s2.end();
     StringAffix affix = remove_common_affix(first1, last1, first2, last2);
-    s1 = make_range(first1, last1);
-    s2 = make_range(first2, last2);
+    s1 = Range(first1, last1);
+    s2 = Range(first2, last2);
     return affix;
 }
 
 template <typename, typename = void>
 struct is_space_dispatch_tag : std::integral_constant<int, 0> {};
 
 template <typename CharT>
@@ -194,9 +181,8 @@
     }
 
     std::sort(splitted.begin(), splitted.end());
 
     return SplittedSentenceView<InputIt>(splitted);
 }
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/intrinsics.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/intrinsics.hpp`

 * *Files 10% similar despite different names*

```diff
@@ -10,16 +10,15 @@
 #include <stdint.h>
 #include <type_traits>
 
 #if defined(_MSC_VER) && !defined(__clang__)
 #    include <intrin.h>
 #endif
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 /*
  * shift right without undefined behavior for shifts > bit width
  */
 template <typename U>
 constexpr uint64_t shr64(uint64_t a, U shift)
 {
@@ -159,35 +158,20 @@
 
 static inline int countr_zero(uint64_t x)
 {
     return __builtin_ctzll(x);
 }
 #endif
 
-template <typename T, T N, T Pos = 0, bool IsEmpty = (N == 0)>
-struct UnrollImpl;
-
-template <typename T, T N, T Pos>
-struct UnrollImpl<T, N, Pos, false> {
-    template <typename F>
-    static void call(F&& f)
-    {
-        f(Pos);
-        UnrollImpl<T, N - 1, Pos + 1>::call(std::forward<F>(f));
-    }
-};
-
-template <typename T, T N, T Pos>
-struct UnrollImpl<T, N, Pos, true> {
-    template <typename F>
-    static void call(F&&)
-    {}
-};
+template <class T, T... inds, class F>
+constexpr void unroll_impl(std::integer_sequence<T, inds...>, F&& f)
+{
+    (f(std::integral_constant<T, inds>{}), ...);
+}
 
-template <typename T, int N, class F>
+template <class T, T count, class F>
 constexpr void unroll(F&& f)
 {
-    UnrollImpl<T, N>::call(f);
+    unroll_impl(std::make_integer_sequence<T, count>{}, std::forward<F>(f));
 }
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/details/types.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/details/types.hpp`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/DamerauLevenshtein.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/DamerauLevenshtein.hpp`

 * *Files 1% similar despite different names*

```diff
@@ -134,17 +134,15 @@
     {
         return damerau_levenshtein_distance(s1, s2, score_cutoff);
     }
 
     std::basic_string<CharT1> s1;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedDamerauLevenshtein(const Sentence1& s1_) -> CachedDamerauLevenshtein<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedDamerauLevenshtein(InputIt1 first1, InputIt1 last1) -> CachedDamerauLevenshtein<iter_value_t<InputIt1>>;
-#endif
 
 } // namespace experimental
 } // namespace rapidfuzz
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/DamerauLevenshtein_impl.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/DamerauLevenshtein_impl.hpp`

 * *Files 4% similar despite different names*

```diff
@@ -9,16 +9,15 @@
 #include <numeric>
 #include <rapidfuzz/details/GrowingHashmap.hpp>
 #include <rapidfuzz/details/Matrix.hpp>
 #include <rapidfuzz/details/Range.hpp>
 #include <rapidfuzz/details/common.hpp>
 #include <rapidfuzz/details/distance.hpp>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 template <typename IntType>
 struct RowId {
     IntType val = -1;
     friend bool operator==(const RowId& lhs, const RowId& rhs)
     {
         return lhs.val == rhs.val;
@@ -129,9 +128,8 @@
     template <typename InputIt1, typename InputIt2>
     static int64_t _distance(Range<InputIt1> s1, Range<InputIt2> s2, int64_t score_cutoff)
     {
         return damerau_levenshtein_distance(s1, s2, score_cutoff);
     }
 };
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Hamming.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Hamming.hpp`

 * *Files 1% similar despite different names*

```diff
@@ -135,18 +135,16 @@
     {
         return detail::Hamming::distance(s1, s2, score_cutoff);
     }
 
     std::basic_string<CharT1> s1;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedHamming(const Sentence1& s1_) -> CachedHamming<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedHamming(InputIt1 first1, InputIt1 last1) -> CachedHamming<iter_value_t<InputIt1>>;
-#endif
 
 /**@}*/
 
 } // namespace rapidfuzz
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Hamming_impl.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Hamming_impl.hpp`

 * *Files 8% similar despite different names*

```diff
@@ -2,16 +2,15 @@
 /* Copyright  2021 Max Bachmann */
 
 #pragma once
 #include <rapidfuzz/details/Range.hpp>
 #include <rapidfuzz/details/distance.hpp>
 #include <stdexcept>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 class Hamming : public DistanceBase<Hamming> {
     friend DistanceBase<Hamming>;
     friend NormalizedMetricBase<Hamming>;
 
     template <typename InputIt1, typename InputIt2>
     static int64_t maximum(Range<InputIt1> s1, Range<InputIt2>)
@@ -27,9 +26,9 @@
         int64_t dist = 0;
         for (ptrdiff_t i = 0; i < s1.size(); ++i)
             dist += bool(s1[i] != s2[i]);
 
         return (dist <= score_cutoff) ? dist : score_cutoff + 1;
     }
 };
-} // namespace detail
-} // namespace rapidfuzz
+
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Indel.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Indel.hpp`

 * *Files 3% similar despite different names*

```diff
@@ -76,15 +76,15 @@
 template <typename CharT1>
 struct CachedIndel : public detail::CachedDistanceBase<CachedIndel<CharT1>> {
     template <typename Sentence1>
     CachedIndel(const Sentence1& s1_) : CachedIndel(detail::to_begin(s1_), detail::to_end(s1_))
     {}
 
     template <typename InputIt1>
-    CachedIndel(InputIt1 first1, InputIt1 last1) : s1(first1, last1), PM(detail::make_range(first1, last1))
+    CachedIndel(InputIt1 first1, InputIt1 last1) : s1(first1, last1), PM(detail::Range(first1, last1))
     {}
 
 private:
     friend detail::CachedDistanceBase<CachedIndel<CharT1>>;
     friend detail::CachedNormalizedMetricBase<CachedIndel<CharT1>>;
 
     template <typename InputIt2>
@@ -92,23 +92,21 @@
     {
         return static_cast<int64_t>(s1.size()) + s2.size();
     }
 
     template <typename InputIt2>
     int64_t _distance(detail::Range<InputIt2> s2, int64_t score_cutoff) const
     {
-        return detail::indel_distance(PM, detail::make_range(s1), s2, score_cutoff);
+        return detail::indel_distance(PM, detail::Range(s1), s2, score_cutoff);
     }
 
     std::basic_string<CharT1> s1;
     detail::BlockPatternMatchVector PM;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedIndel(const Sentence1& s1_) -> CachedIndel<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedIndel(InputIt1 first1, InputIt1 last1) -> CachedIndel<iter_value_t<InputIt1>>;
-#endif
 
 } // namespace rapidfuzz
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Indel_impl.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Indel_impl.hpp`

 * *Files 3% similar despite different names*

```diff
@@ -4,16 +4,15 @@
 #include <rapidfuzz/details/PatternMatchVector.hpp>
 #include <rapidfuzz/details/Range.hpp>
 #include <rapidfuzz/details/common.hpp>
 #include <rapidfuzz/details/distance.hpp>
 #include <rapidfuzz/details/intrinsics.hpp>
 #include <rapidfuzz/distance/LCSseq.hpp>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 template <typename InputIt1, typename InputIt2>
 int64_t indel_distance(const BlockPatternMatchVector& block, Range<InputIt1> s1, Range<InputIt2> s2,
                        int64_t score_cutoff)
 {
     int64_t maximum = s1.size() + s2.size();
     int64_t lcs_cutoff = std::max<int64_t>(0, maximum / 2 - score_cutoff);
@@ -60,9 +59,8 @@
         int64_t lcs_cutoff = std::max<int64_t>(0, maximum / 2 - score_cutoff);
         int64_t lcs_sim = LCSseq::similarity(s1, s2, lcs_cutoff);
         int64_t dist = maximum - 2 * lcs_sim;
         return (dist <= score_cutoff) ? dist : score_cutoff + 1;
     }
 };
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/LCSseq.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/LCSseq.hpp`

 * *Files 4% similar despite different names*

```diff
@@ -62,31 +62,31 @@
 {
     return detail::LCSseq::normalized_similarity(s1, s2, score_cutoff);
 }
 
 template <typename InputIt1, typename InputIt2>
 Editops lcs_seq_editops(InputIt1 first1, InputIt1 last1, InputIt2 first2, InputIt2 last2)
 {
-    return detail::lcs_seq_editops(detail::make_range(first1, last1), detail::make_range(first2, last2));
+    return detail::lcs_seq_editops(detail::Range(first1, last1), detail::Range(first2, last2));
 }
 
 template <typename Sentence1, typename Sentence2>
 Editops lcs_seq_editops(const Sentence1& s1, const Sentence2& s2)
 {
-    return detail::lcs_seq_editops(detail::make_range(s1), detail::make_range(s2));
+    return detail::lcs_seq_editops(detail::Range(s1), detail::Range(s2));
 }
 
 template <typename CharT1>
 struct CachedLCSseq : detail::CachedSimilarityBase<CachedLCSseq<CharT1>> {
     template <typename Sentence1>
     CachedLCSseq(const Sentence1& s1_) : CachedLCSseq(detail::to_begin(s1_), detail::to_end(s1_))
     {}
 
     template <typename InputIt1>
-    CachedLCSseq(InputIt1 first1, InputIt1 last1) : s1(first1, last1), PM(detail::make_range(first1, last1))
+    CachedLCSseq(InputIt1 first1, InputIt1 last1) : s1(first1, last1), PM(detail::Range(first1, last1))
     {}
 
 private:
     friend detail::CachedSimilarityBase<CachedLCSseq<CharT1>>;
     friend detail::CachedNormalizedMetricBase<CachedLCSseq<CharT1>>;
 
     template <typename InputIt2>
@@ -94,23 +94,21 @@
     {
         return std::max(static_cast<ptrdiff_t>(s1.size()), s2.size());
     }
 
     template <typename InputIt2>
     int64_t _similarity(detail::Range<InputIt2> s2, int64_t score_cutoff) const
     {
-        return detail::lcs_seq_similarity(PM, detail::make_range(s1), s2, score_cutoff);
+        return detail::lcs_seq_similarity(PM, detail::Range(s1), s2, score_cutoff);
     }
 
     std::basic_string<CharT1> s1;
     detail::BlockPatternMatchVector PM;
 };
 
-#if __cplusplus >= 201703L
 template <typename Sentence1>
 CachedLCSseq(const Sentence1& s1_) -> CachedLCSseq<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedLCSseq(InputIt1 first1, InputIt1 last1) -> CachedLCSseq<iter_value_t<InputIt1>>;
-#endif
 
 } // namespace rapidfuzz
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/LCSseq_impl.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/LCSseq_impl.hpp`

 * *Files 4% similar despite different names*

```diff
@@ -7,16 +7,15 @@
 #include <rapidfuzz/details/common.hpp>
 #include <rapidfuzz/details/distance.hpp>
 #include <rapidfuzz/details/intrinsics.hpp>
 
 #include <algorithm>
 #include <array>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 template <bool RecordMatrix>
 struct LCSseqResult;
 
 template <>
 struct LCSseqResult<true> {
     ShiftedBitMatrix<uint64_t> S;
@@ -125,26 +124,25 @@
 auto lcs_unroll(const PMV& block, Range<InputIt1>, Range<InputIt2> s2, int64_t score_cutoff = 0)
     -> LCSseqResult<RecordMatrix>
 {
     uint64_t S[N];
     unroll<size_t, N>([&](size_t i) { S[i] = ~UINT64_C(0); });
 
     LCSseqResult<RecordMatrix> res;
-    static_if<RecordMatrix>(
-        [&](auto f) { f(res).S = ShiftedBitMatrix<uint64_t>(s2.size(), N, ~UINT64_C(0)); });
+    if constexpr (RecordMatrix) res.S = ShiftedBitMatrix<uint64_t>(s2.size(), N, ~UINT64_C(0));
 
     for (ptrdiff_t i = 0; i < s2.size(); ++i) {
         uint64_t carry = 0;
         unroll<size_t, N>([&](size_t word) {
             uint64_t Matches = block.get(word, s2[i]);
             uint64_t u = S[word] & Matches;
             uint64_t x = addc64(S[word], u, carry, &carry);
             S[word] = x | (S[word] - u);
 
-            static_if<RecordMatrix>([&](auto f) { f(res).S[i][word] = S[word]; });
+            if constexpr (RecordMatrix) res.S[i][word] = S[word];
         });
     }
 
     res.sim = 0;
     unroll<size_t, N>([&](size_t i) { res.sim += popcount(~S[i]); });
 
     if (res.sim < score_cutoff) res.sim = 0;
@@ -156,29 +154,28 @@
 auto lcs_blockwise(const PMV& block, Range<InputIt1>, Range<InputIt2> s2, int64_t score_cutoff = 0)
     -> LCSseqResult<RecordMatrix>
 {
     auto words = block.size();
     std::vector<uint64_t> S(words, ~UINT64_C(0));
 
     LCSseqResult<RecordMatrix> res;
-    static_if<RecordMatrix>(
-        [&](auto f) { f(res).S = ShiftedBitMatrix<uint64_t>(s2.size(), words, ~UINT64_C(0)); });
+    if constexpr (RecordMatrix) res.S = ShiftedBitMatrix<uint64_t>(s2.size(), words, ~UINT64_C(0));
 
     for (ptrdiff_t i = 0; i < s2.size(); ++i) {
         uint64_t carry = 0;
         for (size_t word = 0; word < words; ++word) {
             const uint64_t Matches = block.get(word, s2[i]);
             uint64_t Stemp = S[word];
 
             uint64_t u = Stemp & Matches;
 
             uint64_t x = addc64(Stemp, u, carry, &carry);
             S[word] = x | (Stemp - u);
 
-            static_if<RecordMatrix>([&](auto f) { f(res).S[i][word] = S[word]; });
+            if constexpr (RecordMatrix) res.S[i][word] = S[word];
         }
     }
 
     res.sim = 0;
     for (uint64_t Stemp : S)
         res.sim += popcount(~Stemp);
 
@@ -382,9 +379,8 @@
     template <typename InputIt1, typename InputIt2>
     static int64_t _similarity(Range<InputIt1> s1, Range<InputIt2> s2, int64_t score_cutoff)
     {
         return lcs_seq_similarity(s1, s2, score_cutoff);
     }
 };
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Levenshtein.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Levenshtein.hpp`

 * *Files 2% similar despite different names*

```diff
@@ -271,88 +271,86 @@
  *
  * @return Edit operations required to turn s1 into s2
  */
 template <typename InputIt1, typename InputIt2>
 Editops levenshtein_editops(InputIt1 first1, InputIt1 last1, InputIt2 first2, InputIt2 last2,
                             int64_t score_hint = std::numeric_limits<int64_t>::max())
 {
-    return detail::levenshtein_editops(detail::make_range(first1, last1), detail::make_range(first2, last2),
+    return detail::levenshtein_editops(detail::Range(first1, last1), detail::Range(first2, last2),
                                        score_hint);
 }
 
 template <typename Sentence1, typename Sentence2>
 Editops levenshtein_editops(const Sentence1& s1, const Sentence2& s2,
                             int64_t score_hint = std::numeric_limits<int64_t>::max())
 {
-    return detail::levenshtein_editops(detail::make_range(s1), detail::make_range(s2), score_hint);
+    return detail::levenshtein_editops(detail::Range(s1), detail::Range(s2), score_hint);
 }
 
 template <typename CharT1>
 struct CachedLevenshtein : public detail::CachedDistanceBase<CachedLevenshtein<CharT1>> {
     template <typename Sentence1>
     CachedLevenshtein(const Sentence1& s1_, LevenshteinWeightTable aWeights = {1, 1, 1})
         : CachedLevenshtein(detail::to_begin(s1_), detail::to_end(s1_), aWeights)
     {}
 
     template <typename InputIt1>
     CachedLevenshtein(InputIt1 first1, InputIt1 last1, LevenshteinWeightTable aWeights = {1, 1, 1})
-        : s1(first1, last1), PM(detail::make_range(first1, last1)), weights(aWeights)
+        : s1(first1, last1), PM(detail::Range(first1, last1)), weights(aWeights)
     {}
 
 private:
     friend detail::CachedDistanceBase<CachedLevenshtein<CharT1>>;
     friend detail::CachedNormalizedMetricBase<CachedLevenshtein<CharT1>>;
 
     template <typename InputIt2>
     int64_t maximum(detail::Range<InputIt2> s2) const
     {
-        return detail::levenshtein_maximum(detail::make_range(s1), s2, weights);
+        return detail::levenshtein_maximum(detail::Range(s1), s2, weights);
     }
 
     template <typename InputIt2>
     int64_t _distance(detail::Range<InputIt2> s2, int64_t score_cutoff) const
     {
         if (weights.insert_cost == weights.delete_cost) {
             /* when insertions + deletions operations are free there can not be any edit distance */
             if (weights.insert_cost == 0) return 0;
 
             /* uniform Levenshtein multiplied with the common factor */
             if (weights.insert_cost == weights.replace_cost) {
                 // max can make use of the common divisor of the three weights
                 int64_t new_max = detail::ceil_div(score_cutoff, weights.insert_cost);
-                int64_t dist = detail::uniform_levenshtein_distance(PM, detail::make_range(s1), s2, new_max);
+                int64_t dist = detail::uniform_levenshtein_distance(PM, detail::Range(s1), s2, new_max);
                 dist *= weights.insert_cost;
 
                 return (dist <= score_cutoff) ? dist : score_cutoff + 1;
             }
             /*
              * when replace_cost >= insert_cost + delete_cost no substitutions are performed
              * therefore this can be implemented as InDel distance multiplied with the common factor
              */
             else if (weights.replace_cost >= weights.insert_cost + weights.delete_cost) {
                 // max can make use of the common divisor of the three weights
                 int64_t new_max = detail::ceil_div(score_cutoff, weights.insert_cost);
-                int64_t dist = detail::indel_distance(PM, detail::make_range(s1), s2, new_max);
+                int64_t dist = detail::indel_distance(PM, detail::Range(s1), s2, new_max);
                 dist *= weights.insert_cost;
                 return (dist <= score_cutoff) ? dist : score_cutoff + 1;
             }
         }
 
-        return detail::generalized_levenshtein_distance(detail::make_range(s1), s2, weights, score_cutoff);
+        return detail::generalized_levenshtein_distance(detail::Range(s1), s2, weights, score_cutoff);
     }
 
     std::basic_string<CharT1> s1;
     detail::BlockPatternMatchVector PM;
     LevenshteinWeightTable weights;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedLevenshtein(const Sentence1& s1_, LevenshteinWeightTable aWeights)
     -> CachedLevenshtein<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedLevenshtein(InputIt1 first1, InputIt1 last1, LevenshteinWeightTable aWeights)
     -> CachedLevenshtein<iter_value_t<InputIt1>>;
-#endif
 
 } // namespace rapidfuzz
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Levenshtein_impl.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance/Levenshtein_impl.hpp`

 * *Files 10% similar despite different names*

```diff
@@ -11,16 +11,15 @@
 #include <rapidfuzz/details/PatternMatchVector.hpp>
 #include <rapidfuzz/details/common.hpp>
 #include <rapidfuzz/details/distance.hpp>
 #include <rapidfuzz/details/intrinsics.hpp>
 #include <rapidfuzz/distance/Indel.hpp>
 #include <stdexcept>
 
-namespace rapidfuzz {
-namespace detail {
+namespace rapidfuzz::detail {
 
 struct LevenshteinRow {
     uint64_t VP;
     uint64_t VN;
 
     LevenshteinRow() : VP(~UINT64_C(0)), VN(0)
     {}
@@ -235,18 +234,18 @@
 {
     /* VP is set to 1^m. Shifting by bitwidth would be undefined behavior */
     uint64_t VP = ~UINT64_C(0);
     uint64_t VN = 0;
 
     LevenshteinResult<RecordMatrix, RecordBitRow> res;
     res.dist = s1.size();
-    static_if<RecordMatrix>([&](auto f) {
-        f(res).VP = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), 1, ~UINT64_C(0));
-        f(res).VN = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), 1, 0);
-    });
+    if constexpr (RecordMatrix) {
+        res.VP = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), 1, ~UINT64_C(0));
+        res.VN = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), 1, 0);
+    }
 
     /* mask used when computing D[m,j] in the paper 10^(m-1) */
     uint64_t mask = UINT64_C(1) << (s1.size() - 1);
 
     /* Searching */
     for (ptrdiff_t i = 0; i < s2.size(); ++i) {
         /* Step 1: Computing D0 */
@@ -265,28 +264,28 @@
         /* Step 4: Computing Vp and VN */
         HP = (HP << 1) | 1;
         HN = (HN << 1);
 
         VP = HN | ~(D0 | HP);
         VN = HP & D0;
 
-        static_if<RecordMatrix>([&](auto f) {
-            f(res).VP[static_cast<size_t>(i)][0] = VP;
-            f(res).VN[static_cast<size_t>(i)][0] = VN;
-        });
+        if constexpr (RecordMatrix) {
+            res.VP[static_cast<size_t>(i)][0] = VP;
+            res.VN[static_cast<size_t>(i)][0] = VN;
+        }
     }
 
     if (res.dist > max) res.dist = max + 1;
 
-    static_if<RecordBitRow>([&](auto f) {
-        f(res).first_block = 0;
-        f(res).last_block = 0;
-        f(res).prev_score = s2.size();
-        f(res).vecs.emplace_back(VP, VN);
-    });
+    if constexpr (RecordBitRow) {
+        res.first_block = 0;
+        res.last_block = 0;
+        res.prev_score = s2.size();
+        res.vecs.emplace_back(VP, VN);
+    }
 
     return res;
 }
 
 template <typename InputIt1, typename InputIt2>
 int64_t levenshtein_hyrroe2003_small_band(const BlockPatternMatchVector& PM, Range<InputIt1> s1,
                                           Range<InputIt2> s2, int64_t max)
@@ -382,24 +381,24 @@
 
     /* VP is set to 1^m. Shifting by bitwidth would be undefined behavior */
     uint64_t VP = ~UINT64_C(0) << (64 - max - 1);
     uint64_t VN = 0;
 
     LevenshteinResult<RecordMatrix, false> res;
     res.dist = max;
-    static_if<RecordMatrix>([&](auto f) {
-        f(res).VP = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), 1, ~UINT64_C(0));
-        f(res).VN = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), 1, 0);
+    if constexpr (RecordMatrix) {
+        res.VP = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), 1, ~UINT64_C(0));
+        res.VN = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), 1, 0);
 
         ptrdiff_t start_offset = max + 2 - 64;
         for (ptrdiff_t i = 0; i < s2.size(); ++i) {
-            f(res).VP.set_offset(static_cast<size_t>(i), start_offset + i);
-            f(res).VN.set_offset(static_cast<size_t>(i), start_offset + i);
+            res.VP.set_offset(static_cast<size_t>(i), start_offset + i);
+            res.VN.set_offset(static_cast<size_t>(i), start_offset + i);
         }
-    });
+    }
 
     uint64_t diagonal_mask = UINT64_C(1) << 63;
     uint64_t horizontal_mask = UINT64_C(1) << 62;
 
     /* score can decrease along the horizontal, but not along the diagonal */
     int64_t break_score = max + s2.size() - (s1.size() - max);
     HybridGrowingHashmap<typename Range<InputIt1>::value_type, std::pair<ptrdiff_t, uint64_t>> PM;
@@ -441,18 +440,18 @@
             return res;
         }
 
         /* Step 4: Computing Vp and VN */
         VP = HN | ~((D0 >> 1) | HP);
         VN = (D0 >> 1) & HP;
 
-        static_if<RecordMatrix>([&](auto f) {
-            f(res).VP[static_cast<size_t>(i)][0] = VP;
-            f(res).VN[static_cast<size_t>(i)][0] = VN;
-        });
+        if constexpr (RecordMatrix) {
+            res.VP[static_cast<size_t>(i)][0] = VP;
+            res.VN[static_cast<size_t>(i)][0] = VN;
+        }
     }
 
     for (; i < s2.size(); ++i) {
         /* Step 1: Computing D0 */
         /* update bitmasks online */
         uint64_t PM_j = 0;
         if (i + max < s1.size()) {
@@ -482,18 +481,18 @@
             return res;
         }
 
         /* Step 4: Computing Vp and VN */
         VP = HN | ~((D0 >> 1) | HP);
         VN = (D0 >> 1) & HP;
 
-        static_if<RecordMatrix>([&](auto f) {
-            f(res).VP[static_cast<size_t>(i)][0] = VP;
-            f(res).VN[static_cast<size_t>(i)][0] = VN;
-        });
+        if constexpr (RecordMatrix) {
+            res.VP[static_cast<size_t>(i)][0] = VP;
+            res.VN[static_cast<size_t>(i)][0] = VN;
+        }
     }
 
     if (res.dist > max) res.dist = max + 1;
 
     return res;
 }
 
@@ -513,26 +512,26 @@
 
     for (size_t i = 0; i < words - 1; ++i)
         scores[i] = static_cast<int64_t>(i + 1) * word_size;
 
     scores[words - 1] = s1.size();
 
     LevenshteinResult<RecordMatrix, RecordBitRow> res;
-    static_if<RecordMatrix>([&](auto f) {
+    if constexpr (RecordMatrix) {
         int64_t full_band = std::min<int64_t>(s1.size(), 2 * max + 1);
         size_t full_band_words = std::min(words, static_cast<size_t>(full_band / word_size) + 2);
-        f(res).VP = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), full_band_words, ~UINT64_C(0));
-        f(res).VN = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), full_band_words, 0);
-    });
-
-    static_if<RecordBitRow>([&](auto f) {
-        f(res).first_block = 0;
-        f(res).last_block = 0;
-        f(res).prev_score = 0;
-    });
+        res.VP = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), full_band_words, ~UINT64_C(0));
+        res.VN = ShiftedBitMatrix<uint64_t>(static_cast<size_t>(s2.size()), full_band_words, 0);
+    }
+
+    if constexpr (RecordBitRow) {
+        res.first_block = 0;
+        res.last_block = 0;
+        res.prev_score = 0;
+    }
 
     max = std::min(max, static_cast<int64_t>(std::max(s1.size(), s2.size())));
 
     /* first_block is the index of the first block in Ukkonen band. */
     size_t first_block = 0;
     /* last_block is the index of the last block in Ukkonen band. */
     size_t last_block =
@@ -541,18 +540,18 @@
         1;
 
     /* Searching */
     for (ptrdiff_t row = 0; row < s2.size(); ++row) {
         uint64_t HP_carry = 1;
         uint64_t HN_carry = 0;
 
-        static_if<RecordMatrix>([&](auto f) {
-            f(res).VP.set_offset(static_cast<size_t>(row), static_cast<int64_t>(first_block) * word_size);
-            f(res).VN.set_offset(static_cast<size_t>(row), static_cast<int64_t>(first_block) * word_size);
-        });
+        if constexpr (RecordMatrix) {
+            res.VP.set_offset(static_cast<size_t>(row), static_cast<int64_t>(first_block) * word_size);
+            res.VN.set_offset(static_cast<size_t>(row), static_cast<int64_t>(first_block) * word_size);
+        }
 
         auto advance_block = [&](size_t word) {
             /* Step 1: Computing D0 */
             uint64_t PM_j = PM.get(word, s2[row]);
             uint64_t VN = vecs[word].VN;
             uint64_t VP = vecs[word].VP;
 
@@ -577,18 +576,18 @@
             /* Step 4: Computing Vp and VN */
             HP = (HP << 1) | HP_carry_temp;
             HN = (HN << 1) | HN_carry_temp;
 
             vecs[word].VP = HN | ~(D0 | HP);
             vecs[word].VN = HP & D0;
 
-            static_if<RecordMatrix>([&](auto f) {
-                f(res).VP[static_cast<size_t>(row)][word - first_block] = vecs[word].VP;
-                f(res).VN[static_cast<size_t>(row)][word - first_block] = vecs[word].VN;
-            });
+            if constexpr (RecordMatrix) {
+                res.VP[static_cast<size_t>(row)][word - first_block] = vecs[word].VP;
+                res.VN[static_cast<size_t>(row)][word - first_block] = vecs[word].VN;
+            }
 
             return static_cast<int64_t>(HP_carry) - static_cast<int64_t>(HN_carry);
         };
 
         auto get_row_num = [&](size_t word) {
             if (word + 1 == words) return s1.size() - 1;
             return static_cast<ptrdiff_t>(word + 1) * word_size - 1;
@@ -657,41 +656,38 @@
 
         /* distance is larger than max, so band stops to exist */
         if (last_block < first_block) {
             res.dist = max + 1;
             return res;
         }
 
-        bool exit_ = false;
-        static_if<RecordBitRow>([&](auto f) {
+        if constexpr (RecordBitRow) {
             if (row == stop_row) {
                 if (first_block == 0)
-                    f(res).prev_score = stop_row + 1;
+                    res.prev_score = stop_row + 1;
                 else {
                     /* count backwards to find score at last position in previous block */
                     ptrdiff_t relevant_bits =
                         std::min(static_cast<ptrdiff_t>((first_block + 1) * 64), s1.size()) % 64;
                     uint64_t mask = ~UINT64_C(0);
                     if (relevant_bits) mask >>= 64 - relevant_bits;
 
-                    f(res).prev_score = scores[first_block] + popcount(vecs[first_block].VN & mask) -
-                                        popcount(vecs[first_block].VP & mask);
+                    res.prev_score = scores[first_block] + popcount(vecs[first_block].VN & mask) -
+                                     popcount(vecs[first_block].VP & mask);
                 }
 
-                f(res).first_block = first_block;
-                f(res).last_block = last_block;
-                f(res).vecs = std::move(vecs);
+                res.first_block = first_block;
+                res.last_block = last_block;
+                res.vecs = std::move(vecs);
 
                 /* unknown so make sure it is <= max */
-                f(res).dist = 0;
-                exit_ = true;
+                res.dist = 0;
+                return res;
             }
-        });
-
-        if (exit_) return res;
+        }
     }
 
     res.dist = scores[words - 1];
 
     if (res.dist > max) res.dist = max + 1;
 
     return res;
@@ -1046,9 +1042,8 @@
     static int64_t _distance(Range<InputIt1> s1, Range<InputIt2> s2, LevenshteinWeightTable weights,
                              int64_t score_cutoff)
     {
         return levenshtein_distance(s1, s2, weights, score_cutoff);
     }
 };
 
-} // namespace detail
-} // namespace rapidfuzz
+} // namespace rapidfuzz::detail
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/distance.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/distance.hpp`

 * *Files 5% similar despite different names*

```diff
@@ -3,14 +3,15 @@
 
 #pragma once
 #include <rapidfuzz/distance/DamerauLevenshtein.hpp>
 #include <rapidfuzz/distance/Hamming.hpp>
 #include <rapidfuzz/distance/Indel.hpp>
 #include <rapidfuzz/distance/LCSseq.hpp>
 #include <rapidfuzz/distance/Levenshtein.hpp>
+#include <rapidfuzz/distance/OSA.hpp>
 
 namespace rapidfuzz {
 
 template <typename CharT, typename InputIt1, typename InputIt2>
 std::basic_string<CharT> editops_apply(const Editops& ops, InputIt1 first1, InputIt1 last1, InputIt2 first2,
                                        InputIt2 last2)
 {
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/fuzz.hpp` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/fuzz.hpp`

 * *Files 2% similar despite different names*

```diff
@@ -6,16 +6,15 @@
 #include <rapidfuzz/details/CharSet.hpp>
 #include <rapidfuzz/details/PatternMatchVector.hpp>
 #include <rapidfuzz/details/common.hpp>
 #include <rapidfuzz/distance/Indel.hpp>
 
 #include <type_traits>
 
-namespace rapidfuzz {
-namespace fuzz {
+namespace rapidfuzz::fuzz {
 
 /**
  * @defgroup Fuzz Fuzz
  * A collection of string matching algorithms from FuzzyWuzzy
  * @{
  */
 
@@ -66,21 +65,19 @@
     template <typename Sentence2>
     double similarity(const Sentence2& s2, double score_cutoff = 0) const;
 
     // private:
     CachedIndel<CharT1> cached_indel;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedRatio(const Sentence1& s1) -> CachedRatio<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedRatio(InputIt1 first1, InputIt1 last1) -> CachedRatio<iter_value_t<InputIt1>>;
-#endif
 
 template <typename InputIt1, typename InputIt2>
 ScoreAlignment<double> partial_ratio_alignment(InputIt1 first1, InputIt1 last1, InputIt2 first2,
                                                InputIt2 last2, double score_cutoff = 0);
 
 template <typename Sentence1, typename Sentence2>
 ScoreAlignment<double> partial_ratio_alignment(const Sentence1& s1, const Sentence2& s2,
@@ -139,21 +136,19 @@
 
 private:
     std::basic_string<CharT1> s1;
     rapidfuzz::detail::CharSet<CharT1> s1_char_set;
     CachedRatio<CharT1> cached_ratio;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedPartialRatio(const Sentence1& s1) -> CachedPartialRatio<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedPartialRatio(InputIt1 first1, InputIt1 last1) -> CachedPartialRatio<iter_value_t<InputIt1>>;
-#endif
 
 /**
  * @brief Sorts the words in the strings and calculates the fuzz::ratio between
  * them
  *
  * @details
  * @code{.cpp}
@@ -204,21 +199,19 @@
     double similarity(const Sentence2& s2, double score_cutoff = 0) const;
 
 private:
     std::basic_string<CharT1> s1_sorted;
     CachedRatio<CharT1> cached_ratio;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedTokenSortRatio(const Sentence1& s1) -> CachedTokenSortRatio<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedTokenSortRatio(InputIt1 first1, InputIt1 last1) -> CachedTokenSortRatio<iter_value_t<InputIt1>>;
-#endif
 
 /**
  * @brief Sorts the words in the strings and calculates the fuzz::partial_ratio
  * between them
  *
  *
  * @tparam Sentence1 This is a string that can be converted to
@@ -263,22 +256,20 @@
     double similarity(const Sentence2& s2, double score_cutoff = 0) const;
 
 private:
     std::basic_string<CharT1> s1_sorted;
     CachedPartialRatio<CharT1> cached_partial_ratio;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedPartialTokenSortRatio(const Sentence1& s1) -> CachedPartialTokenSortRatio<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedPartialTokenSortRatio(InputIt1 first1, InputIt1 last1)
     -> CachedPartialTokenSortRatio<iter_value_t<InputIt1>>;
-#endif
 
 /**
  * @brief Compares the words in the strings based on unique and common words
  * between them using fuzz::ratio
  *
  * @details
  * @code{.cpp}
@@ -328,24 +319,22 @@
     double similarity(InputIt2 first2, InputIt2 last2, double score_cutoff = 0) const;
 
     template <typename Sentence2>
     double similarity(const Sentence2& s2, double score_cutoff = 0) const;
 
 private:
     std::basic_string<CharT1> s1;
-    SplittedSentenceView<typename std::basic_string<CharT1>::iterator> tokens_s1;
+    detail::SplittedSentenceView<typename std::basic_string<CharT1>::iterator> tokens_s1;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedTokenSetRatio(const Sentence1& s1) -> CachedTokenSetRatio<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedTokenSetRatio(InputIt1 first1, InputIt1 last1) -> CachedTokenSetRatio<iter_value_t<InputIt1>>;
-#endif
 
 /**
  * @brief Compares the words in the strings based on unique and common words
  * between them using fuzz::partial_ratio
  *
  * @tparam Sentence1 This is a string that can be converted to
  * basic_string_view<char_type>
@@ -386,25 +375,23 @@
     double similarity(InputIt2 first2, InputIt2 last2, double score_cutoff = 0) const;
 
     template <typename Sentence2>
     double similarity(const Sentence2& s2, double score_cutoff = 0) const;
 
 private:
     std::basic_string<CharT1> s1;
-    SplittedSentenceView<typename std::basic_string<CharT1>::iterator> tokens_s1;
+    detail::SplittedSentenceView<typename std::basic_string<CharT1>::iterator> tokens_s1;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedPartialTokenSetRatio(const Sentence1& s1) -> CachedPartialTokenSetRatio<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedPartialTokenSetRatio(InputIt1 first1, InputIt1 last1)
     -> CachedPartialTokenSetRatio<iter_value_t<InputIt1>>;
-#endif
 
 /**
  * @brief Helper method that returns the maximum of fuzz::token_set_ratio and
  * fuzz::token_sort_ratio (faster than manually executing the two functions)
  *
  * @tparam Sentence1 This is a string that can be converted to
  * basic_string_view<char_type>
@@ -446,26 +433,24 @@
     double similarity(InputIt2 first2, InputIt2 last2, double score_cutoff = 0) const;
 
     template <typename Sentence2>
     double similarity(const Sentence2& s2, double score_cutoff = 0) const;
 
 private:
     std::basic_string<CharT1> s1;
-    SplittedSentenceView<typename std::basic_string<CharT1>::iterator> s1_tokens;
+    detail::SplittedSentenceView<typename std::basic_string<CharT1>::iterator> s1_tokens;
     std::basic_string<CharT1> s1_sorted;
     CachedRatio<CharT1> cached_ratio_s1_sorted;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedTokenRatio(const Sentence1& s1) -> CachedTokenRatio<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedTokenRatio(InputIt1 first1, InputIt1 last1) -> CachedTokenRatio<iter_value_t<InputIt1>>;
-#endif
 
 /**
  * @brief Helper method that returns the maximum of
  * fuzz::partial_token_set_ratio and fuzz::partial_token_sort_ratio (faster than
  * manually executing the two functions)
  *
  * @tparam Sentence1 This is a string that can be converted to
@@ -509,25 +494,23 @@
     double similarity(InputIt2 first2, InputIt2 last2, double score_cutoff = 0) const;
 
     template <typename Sentence2>
     double similarity(const Sentence2& s2, double score_cutoff = 0) const;
 
 private:
     std::basic_string<CharT1> s1;
-    SplittedSentenceView<typename std::basic_string<CharT1>::iterator> tokens_s1;
+    detail::SplittedSentenceView<typename std::basic_string<CharT1>::iterator> tokens_s1;
     std::basic_string<CharT1> s1_sorted;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedPartialTokenRatio(const Sentence1& s1) -> CachedPartialTokenRatio<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedPartialTokenRatio(InputIt1 first1, InputIt1 last1) -> CachedPartialTokenRatio<iter_value_t<InputIt1>>;
-#endif
 
 /**
  * @brief Calculates a weighted ratio based on the other ratio algorithms
  *
  * @details
  * @todo add a detailed description
  *
@@ -569,26 +552,24 @@
     double similarity(const Sentence2& s2, double score_cutoff = 0) const;
 
 private:
     // todo somehow implement this using other ratios with creating PatternMatchVector
     // multiple times
     std::basic_string<CharT1> s1;
     CachedPartialRatio<CharT1> cached_partial_ratio;
-    SplittedSentenceView<typename std::basic_string<CharT1>::iterator> tokens_s1;
+    detail::SplittedSentenceView<typename std::basic_string<CharT1>::iterator> tokens_s1;
     std::basic_string<CharT1> s1_sorted;
     rapidfuzz::detail::BlockPatternMatchVector blockmap_s1_sorted;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedWRatio(const Sentence1& s1) -> CachedWRatio<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedWRatio(InputIt1 first1, InputIt1 last1) -> CachedWRatio<iter_value_t<InputIt1>>;
-#endif
 
 /**
  * @brief Calculates a quick ratio between two strings using fuzz.ratio
  *
  * @details
  * @todo add a detailed description
  *
@@ -630,21 +611,18 @@
     double similarity(const Sentence2& s2, double score_cutoff = 0) const;
 
 private:
     std::basic_string<CharT1> s1;
     CachedRatio<CharT1> cached_ratio;
 };
 
-#if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
 template <typename Sentence1>
 CachedQRatio(const Sentence1& s1) -> CachedQRatio<char_type<Sentence1>>;
 
 template <typename InputIt1>
 CachedQRatio(InputIt1 first1, InputIt1 last1) -> CachedQRatio<iter_value_t<InputIt1>>;
-#endif
 
 /**@}*/
 
-} // namespace fuzz
-} // namespace rapidfuzz
+} // namespace rapidfuzz::fuzz
 
 #include <rapidfuzz/fuzz.impl>
```

### Comparing `rapidfuzz-2.8.0/extern/rapidfuzz-cpp/rapidfuzz/fuzz.impl` & `rapidfuzz-2.9.0/extern/rapidfuzz-cpp/rapidfuzz/fuzz.impl`

 * *Files 1% similar despite different names*

```diff
@@ -7,38 +7,37 @@
 
 #include <algorithm>
 #include <cmath>
 #include <iterator>
 #include <unordered_map>
 #include <vector>
 
-namespace rapidfuzz {
-namespace fuzz {
+namespace rapidfuzz::fuzz {
 
 /**********************************************
  *                  ratio
  *********************************************/
 
 template <typename InputIt1, typename InputIt2>
 double ratio(InputIt1 first1, InputIt1 last1, InputIt2 first2, InputIt2 last2, double score_cutoff)
 {
-    return ratio(detail::make_range(first1, last1), detail::make_range(first2, last2), score_cutoff);
+    return ratio(detail::Range(first1, last1), detail::Range(first2, last2), score_cutoff);
 }
 
 template <typename Sentence1, typename Sentence2>
 double ratio(const Sentence1& s1, const Sentence2& s2, const double score_cutoff)
 {
     return indel_normalized_similarity(s1, s2, score_cutoff / 100) * 100;
 }
 
 template <typename CharT1>
 template <typename InputIt2>
 double CachedRatio<CharT1>::similarity(InputIt2 first2, InputIt2 last2, double score_cutoff) const
 {
-    return similarity(detail::make_range(first2, last2), score_cutoff);
+    return similarity(detail::Range(first2, last2), score_cutoff);
 }
 
 template <typename CharT1>
 template <typename Sentence2>
 double CachedRatio<CharT1>::similarity(const Sentence2& s2, double score_cutoff) const
 {
     return cached_indel.normalized_similarity(s2, score_cutoff / 100) * 100;
@@ -186,16 +185,16 @@
     }
 
     if (score_cutoff > 100) return ScoreAlignment<double>(0, 0, len1, 0, len1);
 
     if (!len1 || !len2)
         return ScoreAlignment<double>(static_cast<double>(len1 == len2) * 100.0, 0, len1, 0, len1);
 
-    return fuzz_detail::partial_ratio_short_needle(detail::make_range(first1, last1),
-                                                   detail::make_range(first2, last2), score_cutoff);
+    return fuzz_detail::partial_ratio_short_needle(detail::Range(first1, last1), detail::Range(first2, last2),
+                                                   score_cutoff);
 }
 
 template <typename Sentence1, typename Sentence2>
 ScoreAlignment<double> partial_ratio_alignment(const Sentence1& s1, const Sentence2& s2, double score_cutoff)
 {
     return partial_ratio_alignment(detail::to_begin(s1), detail::to_end(s1), detail::to_begin(s2),
                                    detail::to_end(s2), score_cutoff);
@@ -232,15 +231,15 @@
     if (len1 > len2)
         return partial_ratio(detail::to_begin(s1), detail::to_end(s1), first2, last2, score_cutoff);
 
     if (score_cutoff > 100) return 0;
 
     if (!len1 || !len2) return static_cast<double>(len1 == len2) * 100.0;
 
-    return fuzz_detail::partial_ratio_short_needle(detail::make_range(s1), detail::make_range(first2, last2),
+    return fuzz_detail::partial_ratio_short_needle(detail::Range(s1), detail::Range(first2, last2),
                                                    cached_ratio, s1_char_set, score_cutoff)
         .score;
 }
 
 template <typename CharT1>
 template <typename Sentence2>
 double CachedPartialRatio<CharT1>::similarity(const Sentence2& s2, double score_cutoff) const
@@ -323,16 +322,16 @@
 
 /**********************************************
  *               token_set_ratio
  *********************************************/
 
 namespace fuzz_detail {
 template <typename InputIt1, typename InputIt2>
-double token_set_ratio(const SplittedSentenceView<InputIt1>& tokens_a,
-                       const SplittedSentenceView<InputIt2>& tokens_b, const double score_cutoff)
+double token_set_ratio(const rapidfuzz::detail::SplittedSentenceView<InputIt1>& tokens_a,
+                       const rapidfuzz::detail::SplittedSentenceView<InputIt2>& tokens_b, const double score_cutoff)
 {
     /* in FuzzyWuzzy this returns 0. For sake of compatibility return 0 here as well
      * see https://github.com/maxbachmann/RapidFuzz/issues/110 */
     if (tokens_a.empty() || tokens_b.empty()) return 0;
 
     auto decomposition = detail::set_decomposition(tokens_a, tokens_b);
     auto intersect = decomposition.intersection;
@@ -412,16 +411,16 @@
 
 /**********************************************
  *          partial_token_set_ratio
  *********************************************/
 
 namespace fuzz_detail {
 template <typename InputIt1, typename InputIt2>
-double partial_token_set_ratio(const SplittedSentenceView<InputIt1>& tokens_a,
-                               const SplittedSentenceView<InputIt2>& tokens_b, const double score_cutoff)
+double partial_token_set_ratio(const rapidfuzz::detail::SplittedSentenceView<InputIt1>& tokens_a,
+                               const rapidfuzz::detail::SplittedSentenceView<InputIt2>& tokens_b, const double score_cutoff)
 {
     /* in FuzzyWuzzy this returns 0. For sake of compatibility return 0 here as well
      * see https://github.com/maxbachmann/RapidFuzz/issues/110 */
     if (tokens_a.empty() || tokens_b.empty()) return 0;
 
     auto decomposition = detail::set_decomposition(tokens_a, tokens_b);
 
@@ -526,15 +525,15 @@
 {
     return token_ratio(detail::to_begin(s1), detail::to_end(s1), detail::to_begin(s2), detail::to_end(s2),
                        score_cutoff);
 }
 
 namespace fuzz_detail {
 template <typename CharT1, typename CachedCharT1, typename InputIt2>
-double token_ratio(const SplittedSentenceView<CharT1>& s1_tokens,
+double token_ratio(const rapidfuzz::detail::SplittedSentenceView<CharT1>& s1_tokens,
                    const CachedRatio<CachedCharT1>& cached_ratio_s1_sorted, InputIt2 first2, InputIt2 last2,
                    double score_cutoff)
 {
     if (score_cutoff > 100) return 0;
 
     auto s2_tokens = detail::sorted_split(first2, last2);
 
@@ -577,15 +576,15 @@
 
     return std::max({result, sect_ab_ratio, sect_ba_ratio});
 }
 
 // todo this is a temporary solution until WRatio is properly implemented using other scorers
 template <typename CharT1, typename InputIt1, typename InputIt2>
 double token_ratio(const std::basic_string<CharT1>& s1_sorted,
-                   const SplittedSentenceView<InputIt1>& tokens_s1,
+                   const rapidfuzz::detail::SplittedSentenceView<InputIt1>& tokens_s1,
                    const detail::BlockPatternMatchVector& blockmap_s1_sorted, InputIt2 first2, InputIt2 last2,
                    double score_cutoff)
 {
     if (score_cutoff > 100) return 0;
 
     auto tokens_b = detail::sorted_split(first2, last2);
 
@@ -602,17 +601,16 @@
     int64_t ab_len = diff_ab_joined.length();
     int64_t ba_len = diff_ba_joined.length();
     int64_t sect_len = intersect.length();
 
     double result = 0;
     auto s2_sorted = tokens_b.join();
     if (s1_sorted.size() < 65) {
-        double norm_sim =
-            detail::indel_normalized_similarity(blockmap_s1_sorted, detail::make_range(s1_sorted),
-                                                detail::make_range(s2_sorted), score_cutoff / 100);
+        double norm_sim = detail::indel_normalized_similarity(blockmap_s1_sorted, detail::Range(s1_sorted),
+                                                              detail::Range(s2_sorted), score_cutoff / 100);
         result = norm_sim * 100;
     }
     else {
         result = fuzz::ratio(s1_sorted, s2_sorted, score_cutoff);
     }
 
     // string length sect+ab <-> sect and sect+ba <-> sect
@@ -692,15 +690,15 @@
     return partial_token_ratio(detail::to_begin(s1), detail::to_end(s1), detail::to_begin(s2),
                                detail::to_end(s2), score_cutoff);
 }
 
 namespace fuzz_detail {
 template <typename CharT1, typename InputIt1, typename InputIt2>
 double partial_token_ratio(const std::basic_string<CharT1>& s1_sorted,
-                           const SplittedSentenceView<InputIt1>& tokens_s1, InputIt2 first2, InputIt2 last2,
+                           const rapidfuzz::detail::SplittedSentenceView<InputIt1>& tokens_s1, InputIt2 first2, InputIt2 last2,
                            double score_cutoff)
 {
     if (score_cutoff > 100) return 0;
 
     auto tokens_b = detail::sorted_split(first2, last2);
 
     auto decomposition = detail::set_decomposition(tokens_s1, tokens_b);
@@ -787,15 +785,15 @@
 template <typename Sentence1>
 template <typename InputIt1>
 CachedWRatio<Sentence1>::CachedWRatio(InputIt1 first1, InputIt1 last1)
     : s1(first1, last1),
       cached_partial_ratio(first1, last1),
       tokens_s1(detail::sorted_split(std::begin(s1), std::end(s1))),
       s1_sorted(tokens_s1.join()),
-      blockmap_s1_sorted(detail::make_range(s1_sorted))
+      blockmap_s1_sorted(detail::Range(s1_sorted))
 {}
 
 template <typename CharT1>
 template <typename InputIt2>
 double CachedWRatio<CharT1>::similarity(InputIt2 first2, InputIt2 last2, double score_cutoff) const
 {
     if (score_cutoff > 100) return 0;
@@ -880,9 +878,8 @@
 template <typename CharT1>
 template <typename Sentence2>
 double CachedQRatio<CharT1>::similarity(const Sentence2& s2, double score_cutoff) const
 {
     return similarity(detail::to_begin(s2), detail::to_end(s2), score_cutoff);
 }
 
-} // namespace fuzz
-} // namespace rapidfuzz
+} // namespace rapidfuzz::fuzz
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/CMakeLists.txt` & `rapidfuzz-2.9.0/extern/taskflow/CMakeLists.txt`

 * *Files 24% similar despite different names*

```diff
@@ -1,74 +1,143 @@
+# -------------------------------------------------------------------
+# Taskflow CMake 
+#
+# To enable thread sanitizer: 
+# -DCMAKE_CXX_FLAGS="-fsanitize=thread -g"
+#
+# To enable address and leak sanitizers
+# -DCMAKE_CXX_FLAGS="-fsanitize=address  -fsanitize=leak -g"
+# -------------------------------------------------------------------
+
+
 # CMake version
-cmake_minimum_required (VERSION 3.9)
+cmake_minimum_required (VERSION 3.12)
 MESSAGE(STATUS "CMAKE_ROOT: " ${CMAKE_ROOT})
 
-# Turn on the verbose
-set(CMAKE_VERBOSE_MAKEFILE ON)
-
 # Project name
-project(Taskflow VERSION 2.7.0 LANGUAGES CXX)
+project(Taskflow VERSION 3.4.0 LANGUAGES CXX)
 
 # build options
-option(TF_BUILD_BENCHMARKS "Enables build of benchmarks" OFF)
-option(TF_BUILD_CUDA "Enables build of CUDA code" ON)
-option(TF_BUILD_TESTS "Enables build of tests" ON)
-option(TF_BUILD_EXAMPLES "Enables build of examples" ON)
+option(TF_BUILD_BENCHMARKS "Enables builds of benchmarks" OFF)
+option(TF_BUILD_CUDA "Enables builds of cuda code" OFF)
+option(TF_BUILD_SYCL "Enables builds of sycl code" OFF)
+option(TF_BUILD_TESTS "Enables builds of tests" ON)
+option(TF_BUILD_EXAMPLES "Enables builds of examples" ON)
+
+# project-specific variables
+set(TF_UTEST_DIR ${PROJECT_SOURCE_DIR}/unittests)
+set(TF_EXAMPLE_DIR ${PROJECT_SOURCE_DIR}/examples)
+set(TF_BENCHMARK_DIR ${PROJECT_SOURCE_DIR}/benchmarks)
+set(TF_3RD_PARTY_DIR ${PROJECT_SOURCE_DIR}/3rd-party)
+set(TF_CMAKE_DIR ${PROJECT_SOURCE_DIR}/cmake)
+set(TF_DEFAULT_BUILD_TYPE "Release")
+
+# Turn on the verbose
+set(CMAKE_VERBOSE_MAKEFILE ON)
 
 # Include additional language check
 include(CheckLanguage)
 
+# Adhere to GNU conventions
+include(GNUInstallDirs)
+
 # Compiler vendors
 ## g++
 if (CMAKE_CXX_COMPILER_ID STREQUAL "GNU")
-  if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS "5.0")
+  if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS "7.0")
     message(STATUS "CMAKE_CXX_COMPILER_VERSION: ${CMAKE_CXX_COMPILER_VERSION}")
-    message(FATAL_ERROR "\nTaskflow requires g++ at least v5.0")
+    message(FATAL_ERROR "\nTaskflow requires g++ at least v7.0")
   endif()
 ## clang++
 elseif (CMAKE_CXX_COMPILER_ID STREQUAL "Clang")
-  if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS "4.0")
+  if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS "6.0")
     message(STATUS "CMAKE_CXX_COMPILER_VERSION: ${CMAKE_CXX_COMPILER_VERSION}")
-    message(FATAL_ERROR "\nTaskflow requires clang++ at least v4.0")
+    message(FATAL_ERROR "\nTaskflow requires clang++ at least v6.0")
   endif() 
 ## AppleClang
 elseif (CMAKE_CXX_COMPILER_ID STREQUAL "AppleClang")
   if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS "8.0")
     message(FATAL_ERROR "\nTaskflow requires AppleClang at least v8.0")
   endif()
 ## microsoft visual c++
 elseif (CMAKE_CXX_COMPILER_ID STREQUAL "MSVC")
   add_definitions(/bigobj)
   if(NOT MSVC_VERSION GREATER_EQUAL 1914)
     message(STATUS "CMAKE_CXX_COMPILER_VERSION: ${CMAKE_CXX_COMPILER_VERSION}")
     message(FATAL_ERROR "\nTaskflow requires MSVC++ at least v14.14") 
   endif()
+elseif (CMAKE_CXX_COMPILER_ID STREQUAL "Intel")
+  if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS "19.0.1")
+    message(STATUS "CMAKE_CXX_COMPILER_VERSION: ${CMAKE_CXX_COMPILER_VERSION}")
+    message(FATAL_ERROR "\nTaskflow requires icpc at least v19.0.1")
+  endif()
 else()
   message(FATAL_ERROR "\n\
 Taskflow currently supports the following compilers:\n\
-  - g++ v5.0 or above\n\
-  - clang++ v4.0 or above\n\
+  - g++ v7.0 or above\n\
+  - clang++ v6.0 or above\n\
   - MSVC++ v19.14 or above\n\
   - AppleClang v8 or above\n\
+  - Intel v19.0.1 or above\n\
 ")
 endif()
 
-# NVCC Compiler
+# -----------------------------------------------------------------------------
+# find nvcc
 # https://cliutils.gitlab.io/modern-cmake/chapters/packages/CUDA.html
-check_language(CUDA)
-if(CMAKE_CUDA_COMPILER AND TF_BUILD_CUDA)
+# -----------------------------------------------------------------------------
+if(TF_BUILD_CUDA)
+  message(STATUS "Configuring CUDA ...")
+  check_language(CUDA)
+  if(NOT CMAKE_CUDA_COMPILER)
+    message(FATAL_ERROR "\nNo CUDA compiler found")
+  endif()
   enable_language(CUDA)
-  if(CMAKE_CUDA_COMPILER_VERSION VERSION_LESS "10")
+  if(CMAKE_CUDA_COMPILER_VERSION VERSION_LESS "11")
     message(STATUS "CMAKE_CUDA_COMPILER_VERSION: ${CMAKE_CUDA_COMPILER_VERSION}")
-    message(FATAL_ERROR "\nTaskflow requires CUDA at least v10")
+    message(FATAL_ERROR "\nTaskflow requires CUDA at least v11")
   endif()
-endif(CMAKE_CUDA_COMPILER AND TF_BUILD_CUDA)
+  
+  ## configure cuBLAS
+  #message(STATUS "Configuring CUDA BLAS ...")
+  #list(APPEND CMAKE_MODULE_PATH ${TF_CMAKE_DIR}/cuda/modules/)
+  #find_package(cuBLAS)
+  #message(STATUS "CUBLAS_FOUND: ${CUBLAS_FOUND}")
+  #message(STATUS "CUBLAS_INCLUDE_DIRS: ${CUBLAS_INCLUDE_DIRS}")
+  #message(STATUS "CUBLAS_LIBRARIES: ${CUBLAS_LIBRARIES}")
+endif()
+
+# -----------------------------------------------------------------------------
+# find ComputeCpp
+# https://developer.codeplay.com/products/computecpp/ce/guides/integration-guide
+# -----------------------------------------------------------------------------
+# Users can specify:
+# 1. -DComputeCpp_DIR=/path/to/ComputeCpp/
+# 2. -DCOMPUTECPP_BITCODE=ptx64 (default spir64)
+# For example:
+# cmake ../ -DTF_BUILD_SYCL=ON 
+#           -DCOMPUTECPP_BITCODE=ptx64 
+#           -DComputeCpp_DIR=$COMPUTECPP_HOME
+#if(TF_BUILD_SYCL)
+#  message(STATUS "Configuring ComputeCpp for SYCL ...")
+#  message(STATUS "You may specify '-DComputeCpp_DIR=/path/to/ComputeCpp/'")
+#  message(STATUS "You may specify '-DCOMPUTECPP_BITCODE=ptx64' for Nvidia devices")
+#  list(APPEND CMAKE_MODULE_PATH ${TF_CMAKE_DIR}/ComputeCpp/Modules/)
+#  if(NOT ComputeCpp_DIR)
+#    message(FATAL_ERROR "Please specify -DComputeCpp_DIR=/path/to/ComputeCpp/")
+#  endif()
+#  find_package(ComputeCpp REQUIRED)
+#  message(STATUS "ComputeCpp_DIR: " ${ComputeCpp_DIR})
+#  message(STATUS "ComputeCpp_INCLUDE_DIRS: " ${ComputeCpp_INCLUDE_DIRS})
+#  include_directories(${ComputeCpp_INCLUDE_DIRS})
+#endif()
 
+# -----------------------------------------------------------------------------
 # defult release build
-set(TF_DEFAULT_BUILD_TYPE "Release")
+# -----------------------------------------------------------------------------
 if(NOT CMAKE_BUILD_TYPE AND NOT CMAKE_CONFIGURATION_TYPES)
   message(STATUS "Setting build type to '${TF_DEFAULT_BUILD_TYPE}'")
   set(
     CMAKE_BUILD_TYPE "${TF_DEFAULT_BUILD_TYPE}" 
     CACHE
     STRING "Choose the type of build." 
     FORCE
@@ -79,49 +148,61 @@
     CMAKE_BUILD_TYPE 
     PROPERTY STRINGS
     "Debug" "Release" "MinSizeRel" "RelWithDebInfo"
   )
 endif()
 
 
+# -----------------------------------------------------------------------------
+# tf::default_setting
+# -----------------------------------------------------------------------------
+
 # error setting
 add_library(error_settings INTERFACE)
 add_library(tf::error_settings ALIAS error_settings)
 
 target_compile_options(
   error_settings
   INTERFACE
   $<$<CXX_COMPILER_ID:AppleClang>:-Wall -Wextra -Wfatal-errors>
   $<$<AND:$<COMPILE_LANGUAGE:CXX>,$<CXX_COMPILER_ID:Clang>>:-Wall -Wextra -Wfatal-errors>
   $<$<AND:$<COMPILE_LANGUAGE:CXX>,$<CXX_COMPILER_ID:GNU>>:-Wall -Wextra -Wfatal-errors>
   $<$<AND:$<COMPILE_LANGUAGE:CXX>,$<CXX_COMPILER_ID:MSVC>>:/W3 /permissive->
-  #$<$<COMPILE_LANGUAGE:CUDA>:-Xcompiler=-Wall,-Wextra,-Wfatal-errors>
-  #$<$<CXX_COMPILER_ID:Clang>:-Wall -Wextra -Wfatal-errors>
-  #$<$<CXX_COMPILER_ID:GNU>:-Wall -Wextra -Wfatal-errors>
-  #$<$<CXX_COMPILER_ID:MSVC>:/W3 /permissive->
-  #$<$<CXX_COMPILER_ID:NVIDIA>:-Xcompiler=-Wall,-Wextra,-Wfatal-errors>
 )
 
-if(CMAKE_CUDA_COMPILER AND TF_BUILD_CUDA)
+# cuda compiler options
+if(TF_BUILD_CUDA)
+  message(STATUS "Configuring CUDA compiler options ...")
   target_compile_options(
     error_settings
     BEFORE
     INTERFACE
     $<$<COMPILE_LANGUAGE:CUDA>:--extended-lambda -Xcompiler=-Wall,-Wextra,-Wfatal-errors>
   )
-endif(CMAKE_CUDA_COMPILER AND TF_BUILD_CUDA)
+endif(TF_BUILD_CUDA)
+
+# sycl compiler options (currently support only DPC++)
+if(TF_BUILD_SYCL)
+  message(STATUS "Configuring SYCL compiler options ...")
+  message(STATUS "You may specify -DTF_BUILD_SYCL_BITCODE=ptx64 for CUDA devices")
+  list(APPEND TF_SYCL_OPTIONS -fsycl -fsycl-unnamed-lambda)
+  if(TF_BUILD_SYCL_BITCODE STREQUAL "ptx64")
+    message(STATUS "Configuring SYCL compiler options to CUDA ptx64 ...")
+    list(APPEND TF_SYCL_OPTIONS -fsycl-targets=nvptx64-nvidia-cuda)
+  endif()
+endif()
 
 # additional features
-add_library(features_settings INTERFACE)
-add_library(tf::features_settings ALIAS features_settings)
-target_compile_definitions(
-  features_settings 
-  INTERFACE 
-  $<$<CXX_COMPILER_ID:MSVC>:_ENABLE_EXTENDED_ALIGNED_STORAGE>
-)
+#add_library(features_settings INTERFACE)
+#add_library(tf::features_settings ALIAS features_settings)
+#target_compile_definitions(
+#  features_settings 
+#  INTERFACE 
+#  $<$<CXX_COMPILER_ID:MSVC>:_ENABLE_EXTENDED_ALIGNED_STORAGE>
+#)
 
 # optimization
 #
 ##! Msvc flags info
 # /Zi - Produces a program database (PDB) that contains type information 
 #       and symbolic debugging information for use with the debugger.
 # /FS - Allows multiple cl.exe processes to write to the same .pdb file
@@ -148,62 +229,52 @@
 add_library(default_settings INTERFACE)
 add_library(tf::default_settings ALIAS default_settings)
 target_link_libraries(
   default_settings 
   INTERFACE 
   tf::error_settings 
   #tf::optimize_settings 
-  tf::features_settings
+  #tf::features_settings
 )
 
-# CXX target properties
-#set(CMAKE_CXX_STANDARD 14)
-#set(CMAKE_CXX_STANDARD_REQUIRED ON)
-#set(CMAKE_CXX_EXTENSIONS OFF)
-
-# installation path
-set(TF_INC_INSTALL_DIR "${CMAKE_INSTALL_PREFIX}/include")
-set(TF_LIB_INSTALL_DIR "${CMAKE_INSTALL_PREFIX}/lib")
-set(TF_UTEST_DIR ${PROJECT_SOURCE_DIR}/unittests)
-set(TF_EXAMPLE_DIR ${PROJECT_SOURCE_DIR}/examples)
-set(TF_BENCHMARK_DIR ${PROJECT_SOURCE_DIR}/benchmarks)
-set(TF_3RD_PARTY_DIR ${PROJECT_SOURCE_DIR}/3rd-party)
+# -----------------------------------------------------------------------------
+# start build
+# -----------------------------------------------------------------------------
 
+message(STATUS "PROJECT_NAME: " ${PROJECT_NAME})
 message(STATUS "CMAKE_HOST_SYSTEM: ${CMAKE_HOST_SYSTEM}")
 message(STATUS "CMAKE_BUILD_TYPE: " ${CMAKE_BUILD_TYPE})
 message(STATUS "CMAKE_CXX_COMPILER: " ${CMAKE_CXX_COMPILER})
 message(STATUS "CMAKE_CXX_COMPILER_ID: " ${CMAKE_CXX_COMPILER_ID})
 message(STATUS "CMAKE_CXX_COMPILER_VERSION: " ${CMAKE_CXX_COMPILER_VERSION})
 message(STATUS "CMAKE_CXX_FLAGS: " ${CMAKE_CXX_FLAGS})
 message(STATUS "CMAKE_CUDA_COMPILER: " ${CMAKE_CUDA_COMPILER})
 message(STATUS "CMAKE_CUDA_COMPILER_ID: " ${CMAKE_CUDA_COMPILER_ID})
 message(STATUS "CMAKE_CUDA_COMPILER_VERSION: " ${CMAKE_CUDA_COMPILER_VERSION})
 message(STATUS "CMAKE_CUDA_FLAGS: " ${CMAKE_CUDA_FLAGS})
 message(STATUS "CMAKE_MODULE_PATH: " ${CMAKE_MODULE_PATH})
 message(STATUS "CMAKE_CURRENT_SOURCE_DIR: " ${CMAKE_CURRENT_SOURCE_DIR})
 message(STATUS "CMAKE_CURRENT_BINARY_DIR: " ${CMAKE_CURRENT_BINARY_DIR})
+message(STATUS "CMAKE_CURRENT_LIST_DIR: " ${CMAKE_CURRENT_LIST_DIR})
 message(STATUS "CMAKE_EXE_LINKER_FLAGS: " ${CMAKE_EXE_LINKER_FLAGS})
 message(STATUS "CMAKE_INSTALL_PREFIX: " ${CMAKE_INSTALL_PREFIX})
+message(STATUS "CMAKE_INSTALL_FULL_INCLUDEDIR: " ${CMAKE_INSTALL_FULL_INCLUDEDIR})
+message(STATUS "CMAKE_INSTALL_FULL_LIBDIR: " ${CMAKE_INSTALL_FULL_LIBDIR})
 message(STATUS "CMAKE_MODULE_PATH: " ${CMAKE_MODULE_PATH})
 message(STATUS "CMAKE_PREFIX_PATH: " ${CMAKE_PREFIX_PATH})
-message(STATUS "PROJECT_NAME: " ${PROJECT_NAME})
 message(STATUS "TF_BUILD_BENCHMARKS: " ${TF_BUILD_BENCHMARKS})
 message(STATUS "TF_BUILD_CUDA: " ${TF_BUILD_CUDA})
+message(STATUS "TF_BUILD_SYCL: " ${TF_BUILD_SYCL})
+message(STATUS "TF_BUILD_SYCL_BITCODE: " ${TF_BUILD_SYCL_BITCODE})
 message(STATUS "TF_BUILD_TESTS: " ${TF_BUILD_TESTS})
 message(STATUS "TF_BUILD_EXAMPLES: " ${TF_BUILD_EXAMPLES})
-message(STATUS "TF_INC_INSTALL_DIR: " ${TF_INC_INSTALL_DIR})
-message(STATUS "TF_LIB_INSTALL_DIR: " ${TF_LIB_INSTALL_DIR})
 message(STATUS "TF_UTEST_DIR: " ${TF_UTEST_DIR})
 message(STATUS "TF_EXAMPLE_DIR: " ${TF_EXAMPLE_DIR})
 message(STATUS "TF_BENCHMARK_DIR: " ${TF_BENCHMARK_DIR})
 message(STATUS "TF_3RD_PARTY_DIR: " ${TF_3RD_PARTY_DIR})
-if(NOT CMAKE_CUDA_COMPILER AND TF_BUILD_CUDA)
-  message(WARNING "TF_BUILD_CUDA set but no CUDA compiler found!\n"
-    "NOT building CUDA examples/benchmarks/...")
-endif()
 
 # add the binary tree to the search path for include files
 include_directories(${PROJECT_SOURCE_DIR})
 
 # -----------------------------------------------------------------------------
 # must-have package include
 # -----------------------------------------------------------------------------
@@ -215,37 +286,21 @@
 find_package(Threads REQUIRED)
 
 # -----------------------------------------------------------------------------
 # Taskflow library interface
 # -----------------------------------------------------------------------------
 
 add_library(${PROJECT_NAME} INTERFACE)
-target_compile_features(${PROJECT_NAME} INTERFACE cxx_std_14)
+target_compile_features(${PROJECT_NAME} INTERFACE cxx_std_17)
 target_link_libraries(${PROJECT_NAME} INTERFACE Threads::Threads)
 target_include_directories(${PROJECT_NAME} INTERFACE
   $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
   $<INSTALL_INTERFACE:include/> 
 )
 
-#add_library(TaskflowDSL INTERFACE)
-#target_compile_features(TaskflowDSL INTERFACE cxx_std_17)
-#target_link_libraries(TaskflowDSL INTERFACE Threads::Threads)
-#target_include_directories(TaskflowDSL INTERFACE
-#  $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
-#  $<INSTALL_INTERFACE:include/> 
-#)
-#
-#add_library(TensorFrame INTERFACE)
-#target_compile_features(TensorFrame INTERFACE cxx_std_17)
-#target_link_libraries(TensorFrame INTERFACE Threads::Threads)
-#target_include_directories(TensorFrame INTERFACE
-#  $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
-#  $<INSTALL_INTERFACE:include/> 
-#)
-
 # -----------------------------------------------------------------------------
 # Example program 
 # -----------------------------------------------------------------------------
 if(TF_BUILD_EXAMPLES)
   add_subdirectory(examples)
 endif(TF_BUILD_EXAMPLES)
 
@@ -253,27 +308,27 @@
 # Unittest
 # -----------------------------------------------------------------------------
 if(TF_BUILD_TESTS)
   add_subdirectory(unittests)
 endif(TF_BUILD_TESTS)
 
 # -----------------------------------------------------------------------------
-# Benchmarking (enabled by TF_BUILD_BENCHMARKS)
+# Benchmarking
 # -----------------------------------------------------------------------------
 
 if(TF_BUILD_BENCHMARKS)
   add_subdirectory(benchmarks)
 endif(TF_BUILD_BENCHMARKS)
 
 # -----------------------------------------------------------------------------
 # create find_package(Taskflow CONFIG)
 # -----------------------------------------------------------------------------
 
 # install header
-install(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/taskflow DESTINATION ${TF_INC_INSTALL_DIR})
+install(DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/taskflow DESTINATION ${CMAKE_INSTALL_INCLUDEDIR})
 
 # export target
 set_target_properties(${PROJECT_NAME} PROPERTIES EXPORT_NAME ${PROJECT_NAME})
 
 export(
   TARGETS ${PROJECT_NAME} 
   NAMESPACE ${PROJECT_NAME}:: 
@@ -281,31 +336,31 @@
 )
 export(PACKAGE ${PROJECT_NAME})
 
 install(TARGETS ${PROJECT_NAME} EXPORT ${PROJECT_NAME}Targets)
 install(
   EXPORT ${PROJECT_NAME}Targets 
   NAMESPACE ${PROJECT_NAME}:: 
-  DESTINATION ${TF_LIB_INSTALL_DIR}/cmake/${PROJECT_NAME}
+  DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME}
 )
 
 # set up config
 include(CMakePackageConfigHelpers)
 
 configure_package_config_file(
   ${PROJECT_NAME}Config.cmake.in
   ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}Config.cmake
-  INSTALL_DESTINATION ${TF_LIB_INSTALL_DIR}/cmake/${PROJECT_NAME}
-  PATH_VARS TF_INC_INSTALL_DIR
+  INSTALL_DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME}
+  PATH_VARS CMAKE_INSTALL_FULL_INCLUDEDIR
 )
 
 write_basic_package_version_file(
   ${PROJECT_NAME}ConfigVersion.cmake 
   COMPATIBILITY SameMajorVersion
 )
 
 install(
   FILES ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}Config.cmake
         ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}ConfigVersion.cmake
-  DESTINATION ${TF_LIB_INSTALL_DIR}/cmake/${PROJECT_NAME}
+  DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/${PROJECT_NAME}
 )
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/LICENSE` & `rapidfuzz-2.9.0/extern/taskflow/LICENSE`

 * *Files 12% similar despite different names*

```diff
@@ -1,13 +1,10 @@
-Taskflow LICENSE
+TASKFLOW MIT LICENSE 
 
-Copyright (c) 2018-2020 T.-W. Huang, C.-X. Lin, G. Guo, and M. Wong
-
-University of Utah, Salt Lake City, UT, USA
-University of Illinois at Urbana-Champaign, IL, USA
+Copyright (c) 2018-2022 Dr. Tsung-Wei Huang
 
 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/taskflow/core/error.hpp` & `rapidfuzz-2.9.0/extern/taskflow/taskflow/core/error.hpp`

 * *Files 4% similar despite different names*

```diff
@@ -1,26 +1,26 @@
 #pragma once
 
 #include <iostream>
 #include <sstream>
 #include <exception>
 
-#include "../utility/stringify.hpp"
+#include "../utility/stream.hpp"
 
 namespace tf {
 
 // Procedure: throw_se
 // Throws the system error under a given error code.
 template <typename... ArgsT>
 //void throw_se(const char* fname, const size_t line, Error::Code c, ArgsT&&... args) {
 void throw_re(const char* fname, const size_t line, ArgsT&&... args) {
   std::ostringstream oss;
   oss << "[" << fname << ":" << line << "] ";
-  ostreamize(oss, std::forward<ArgsT>(args)...);
-  //(oss << ... << args);
+  //ostreamize(oss, std::forward<ArgsT>(args)...);
+  (oss << ... << args);
   throw std::runtime_error(oss.str());
 }
 
 }  // ------------------------------------------------------------------------
 
 #define TF_THROW(...) tf::throw_re(__FILE__, __LINE__, __VA_ARGS__);
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/taskflow/core/executor.hpp` & `rapidfuzz-2.9.0/extern/taskflow/taskflow/core/executor-module-opt.hpp`

 * *Files 26% similar despite different names*

```diff
@@ -1,1465 +1,2024 @@
 #pragma once
 
-#include "tsq.hpp"
-#include "notifier.hpp"
 #include "observer.hpp"
 #include "taskflow.hpp"
 
-namespace tf {
+/**
+@file executor.hpp
+@brief executor include file
+*/
 
+namespace tf {
 
 // ----------------------------------------------------------------------------
 // Executor Definition
 // ----------------------------------------------------------------------------
 
-
 /** @class Executor
 
-@brief execution interface for running a taskflow graph
+@brief class to create an executor for running a taskflow graph
+
+An executor manages a set of worker threads to run one or multiple taskflows
+using an efficient work-stealing scheduling algorithm.
 
-An executor object manages a set of worker threads and internalements 
-an efficient work-stealing scheduling algorithm to run a taskflow.
+@code{.cpp}
+// Declare an executor and a taskflow
+tf::Executor executor;
+tf::Taskflow taskflow;
+
+// Add three tasks into the taskflow
+tf::Task A = taskflow.emplace([] () { std::cout << "This is TaskA\n"; });
+tf::Task B = taskflow.emplace([] () { std::cout << "This is TaskB\n"; });
+tf::Task C = taskflow.emplace([] () { std::cout << "This is TaskC\n"; });
+
+// Build precedence between tasks
+A.precede(B, C);
+
+tf::Future<void> fu = executor.run(taskflow);
+fu.wait();                // block until the execution completes
+
+executor.run(taskflow, [](){ std::cout << "end of 1 run"; }).wait();
+executor.run_n(taskflow, 4);
+executor.wait_for_all();  // block until all associated executions finish
+executor.run_n(taskflow, 4, [](){ std::cout << "end of 4 runs"; }).wait();
+executor.run_until(taskflow, [cnt=0] () mutable { return ++cnt == 10; });
+@endcode
 
+All the @c run methods are @em thread-safe. You can submit multiple
+taskflows at the same time to an executor from different threads.
 */
 class Executor {
 
+  friend class FlowBuilder;
   friend class Subflow;
-  friend class cudaFlow;
-
-  struct Worker {
-    size_t id;
-    size_t vtm;
-    Domain domain;
-    Executor* executor;
-    Notifier::Waiter* waiter;
-    std::mt19937 rdgen { std::random_device{}() };
-    TaskQueue<Node*> wsq[NUM_DOMAINS];
-  };
-    
-  struct PerThread {
-    Worker* worker {nullptr};
-  };
-
-#ifdef TF_ENABLE_CUDA
-  struct cudaDevice {
-    std::vector<cudaStream_t> streams;
-  };
-#endif
+  friend class Runtime;
 
   public:
 
-#ifdef TF_ENABLE_CUDA    
     /**
-    @brief constructs the executor with N/M cpu/gpu worker threads
-    */
-    explicit Executor(
-      size_t N = std::thread::hardware_concurrency(),
-      size_t M = cuda_num_devices()
-    );
-#else
-    /**
-    @brief constructs the executor with N worker threads
+    @brief constructs the executor with @c N worker threads
+
+    The constructor spawns @c N worker threads to run tasks in a
+    work-stealing loop. The number of workers must be greater than zero
+    or an exception will be thrown.
+    By default, the number of worker threads is equal to the maximum
+    hardware concurrency returned by std::thread::hardware_concurrency.
     */
     explicit Executor(size_t N = std::thread::hardware_concurrency());
-#endif
-    
+
     /**
-    @brief destructs the executor 
+    @brief destructs the executor
+
+    The destructor calls Executor::wait_for_all to wait for all submitted
+    taskflows to complete and then notifies all worker threads to stop
+    and join these threads.
     */
     ~Executor();
 
     /**
-    @brief runs the taskflow once
-    
+    @brief runs a taskflow once
+
+    @param taskflow a tf::Taskflow object
+
+    @return a tf::Future that holds the result of the execution
+
+    This member function executes the given taskflow once and returns a tf::Future
+    object that eventually holds the result of the execution.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run(taskflow);
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
+
+    @attention
+    The executor does not own the given taskflow. It is your responsibility to
+    ensure the taskflow remains alive during its execution.
+    */
+    tf::Future<void> run(Taskflow& taskflow);
+
+    /**
+    @brief runs a moved taskflow once
+
+    @param taskflow a moved tf::Taskflow object
+
+    @return a tf::Future that holds the result of the execution
+
+    This member function executes a moved taskflow once and returns a tf::Future
+    object that eventually holds the result of the execution.
+    The executor will take care of the lifetime of the moved taskflow.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run(std::move(taskflow));
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
+    */
+    tf::Future<void> run(Taskflow&& taskflow);
+
+    /**
+    @brief runs a taskflow once and invoke a callback upon completion
+
     @param taskflow a tf::Taskflow object
+    @param callable a callable object to be invoked after this run
+
+    @return a tf::Future that holds the result of the execution
 
-    @return a std::future to access the execution status of the taskflow
+    This member function executes the given taskflow once and invokes the given
+    callable when the execution completes.
+    This member function returns a tf::Future object that
+    eventually holds the result of the execution.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run(taskflow, [](){ std::cout << "done"; });
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
+
+    @attention
+    The executor does not own the given taskflow. It is your responsibility to
+    ensure the taskflow remains alive during its execution.
     */
-    std::future<void> run(Taskflow& taskflow);
+    template<typename C>
+    tf::Future<void> run(Taskflow& taskflow, C&& callable);
 
     /**
-    @brief runs the taskflow once and invoke a callback upon completion
+    @brief runs a moved taskflow once and invoke a callback upon completion
 
-    @param taskflow a tf::Taskflow object 
+    @param taskflow a moved tf::Taskflow object
     @param callable a callable object to be invoked after this run
 
-    @return a std::future to access the execution status of the taskflow
+    @return a tf::Future that holds the result of the execution
+
+    This member function executes a moved taskflow once and invokes the given
+    callable when the execution completes.
+    This member function returns a tf::Future object that
+    eventually holds the result of the execution.
+    The executor will take care of the lifetime of the moved taskflow.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run(
+      std::move(taskflow), [](){ std::cout << "done"; }
+    );
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
     */
     template<typename C>
-    std::future<void> run(Taskflow& taskflow, C&& callable);
+    tf::Future<void> run(Taskflow&& taskflow, C&& callable);
 
     /**
-    @brief runs the taskflow for N times
-    
+    @brief runs a taskflow for @c N times
+
     @param taskflow a tf::Taskflow object
     @param N number of runs
 
-    @return a std::future to access the execution status of the taskflow
+    @return a tf::Future that holds the result of the execution
+
+    This member function executes the given taskflow @c N times and returns a tf::Future
+    object that eventually holds the result of the execution.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run_n(taskflow, 2);  // run taskflow 2 times
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
+
+    @attention
+    The executor does not own the given taskflow. It is your responsibility to
+    ensure the taskflow remains alive during its execution.
+    */
+    tf::Future<void> run_n(Taskflow& taskflow, size_t N);
+
+    /**
+    @brief runs a moved taskflow for @c N times
+
+    @param taskflow a moved tf::Taskflow object
+    @param N number of runs
+
+    @return a tf::Future that holds the result of the execution
+
+    This member function executes a moved taskflow @c N times and returns a tf::Future
+    object that eventually holds the result of the execution.
+    The executor will take care of the lifetime of the moved taskflow.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run_n(
+      std::move(taskflow), 2    // run the moved taskflow 2 times
+    );
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
     */
-    std::future<void> run_n(Taskflow& taskflow, size_t N);
+    tf::Future<void> run_n(Taskflow&& taskflow, size_t N);
+
+    /**
+    @brief runs a taskflow for @c N times and then invokes a callback
+
+    @param taskflow a tf::Taskflow
+    @param N number of runs
+    @param callable a callable object to be invoked after this run
+
+    @return a tf::Future that holds the result of the execution
+
+    This member function executes the given taskflow @c N times and invokes the given
+    callable when the execution completes.
+    This member function returns a tf::Future object that
+    eventually holds the result of the execution.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run(
+      taskflow, 2, [](){ std::cout << "done"; }  // runs taskflow 2 times and invoke
+                                                 // the lambda to print "done"
+    );
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
+
+    @attention
+    The executor does not own the given taskflow. It is your responsibility to
+    ensure the taskflow remains alive during its execution.
+    */
+    template<typename C>
+    tf::Future<void> run_n(Taskflow& taskflow, size_t N, C&& callable);
 
     /**
-    @brief runs the taskflow for N times and then invokes a callback
+    @brief runs a moved taskflow for @c N times and then invokes a callback
 
-    @param taskflow a tf::Taskflow 
+    @param taskflow a moved tf::Taskflow
     @param N number of runs
     @param callable a callable object to be invoked after this run
 
-    @return a std::future to access the execution status of the taskflow
+    @return a tf::Future that holds the result of the execution
+
+    This member function executes a moved taskflow @c N times and invokes the given
+    callable when the execution completes.
+    This member function returns a tf::Future object that
+    eventually holds the result of the execution.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run(
+      // run the moved taskflow 2 times and invoke the lambda to print "done"
+      std::move(taskflow), 2, [](){ std::cout << "done"; }
+    );
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
     */
     template<typename C>
-    std::future<void> run_n(Taskflow& taskflow, size_t N, C&& callable);
+    tf::Future<void> run_n(Taskflow&& taskflow, size_t N, C&& callable);
 
     /**
-    @brief runs the taskflow multiple times until the predicate becomes true and 
-           then invokes a callback
+    @brief runs a taskflow multiple times until the predicate becomes true
+
+    @param taskflow a tf::Taskflow
+    @param pred a boolean predicate to return @c true for stop
+
+    @return a tf::Future that holds the result of the execution
 
-    @param taskflow a tf::Taskflow 
-    @param pred a boolean predicate to return true for stop
+    This member function executes the given taskflow multiple times until
+    the predicate returns @c true.
+    This member function returns a tf::Future object that
+    eventually holds the result of the execution.
 
-    @return a std::future to access the execution status of the taskflow
+    @code{.cpp}
+    tf::Future<void> future = executor.run(
+      taskflow, [](){ return rand()%10 == 0 }
+    );
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
+
+    @attention
+    The executor does not own the given taskflow. It is your responsibility to
+    ensure the taskflow remains alive during its execution.
     */
     template<typename P>
-    std::future<void> run_until(Taskflow& taskflow, P&& pred);
+    tf::Future<void> run_until(Taskflow& taskflow, P&& pred);
 
     /**
-    @brief runs the taskflow multiple times until the predicate becomes true and 
+    @brief runs a moved taskflow and keeps running it
+           until the predicate becomes true
+
+    @param taskflow a moved tf::Taskflow object
+    @param pred a boolean predicate to return @c true for stop
+
+    @return a tf::Future that holds the result of the execution
+
+    This member function executes a moved taskflow multiple times until
+    the predicate returns @c true.
+    This member function returns a tf::Future object that
+    eventually holds the result of the execution.
+    The executor will take care of the lifetime of the moved taskflow.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run(
+      std::move(taskflow), [](){ return rand()%10 == 0 }
+    );
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
+    */
+    template<typename P>
+    tf::Future<void> run_until(Taskflow&& taskflow, P&& pred);
+
+    /**
+    @brief runs a taskflow multiple times until the predicate becomes true and
            then invokes the callback
 
-    @param taskflow a tf::Taskflow 
-    @param pred a boolean predicate to return true for stop
-    @param callable a callable object to be invoked after this run
+    @param taskflow a tf::Taskflow
+    @param pred a boolean predicate to return @c true for stop
+    @param callable a callable object to be invoked after this run completes
+
+    @return a tf::Future that holds the result of the execution
+
+    This member function executes the given taskflow multiple times until
+    the predicate returns @c true and then invokes the given callable when
+    the execution completes.
+    This member function returns a tf::Future object that
+    eventually holds the result of the execution.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run(
+      taskflow, [](){ return rand()%10 == 0 }, [](){ std::cout << "done"; }
+    );
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
+
+    @attention
+    The executor does not own the given taskflow. It is your responsibility to
+    ensure the taskflow remains alive during its execution.
+    */
+    template<typename P, typename C>
+    tf::Future<void> run_until(Taskflow& taskflow, P&& pred, C&& callable);
 
-    @return a std::future to access the execution status of the taskflow
+    /**
+    @brief runs a moved taskflow and keeps running
+           it until the predicate becomes true and then invokes the callback
+
+    @param taskflow a moved tf::Taskflow
+    @param pred a boolean predicate to return @c true for stop
+    @param callable a callable object to be invoked after this run completes
+
+    @return a tf::Future that holds the result of the execution
+
+    This member function executes a moved taskflow multiple times until
+    the predicate returns @c true and then invokes the given callable when
+    the execution completes.
+    This member function returns a tf::Future object that
+    eventually holds the result of the execution.
+    The executor will take care of the lifetime of the moved taskflow.
+
+    @code{.cpp}
+    tf::Future<void> future = executor.run(
+      std::move(taskflow),
+      [](){ return rand()%10 == 0 }, [](){ std::cout << "done"; }
+    );
+    // do something else
+    future.wait();
+    @endcode
+
+    This member function is thread-safe.
     */
     template<typename P, typename C>
-    std::future<void> run_until(Taskflow& taskflow, P&& pred, C&& callable);
-    
+    tf::Future<void> run_until(Taskflow&& taskflow, P&& pred, C&& callable);
+
     /**
-    @brief wait for all pending graphs to complete
+    @brief wait for all tasks to complete
+
+    This member function waits until all submitted tasks
+    (e.g., taskflows, asynchronous tasks) to finish.
+
+    @code{.cpp}
+    executor.run(taskflow1);
+    executor.run_n(taskflow2, 10);
+    executor.run_n(taskflow3, 100);
+    executor.wait_for_all();  // wait until the above submitted taskflows finish
+    @endcode
     */
     void wait_for_all();
 
     /**
-    @brief queries the number of worker threads (can be zero)
+    @brief queries the number of worker threads
+
+    Each worker represents one unique thread spawned by an executor
+    upon its construction time.
+
+    @code{.cpp}
+    tf::Executor executor(4);
+    std::cout << executor.num_workers();    // 4
+    @endcode
     */
-    size_t num_workers() const;
-    
+    size_t num_workers() const noexcept;
+
     /**
     @brief queries the number of running topologies at the time of this call
 
     When a taskflow is submitted to an executor, a topology is created to store
     runtime metadata of the running taskflow.
+    When the execution of the submitted taskflow finishes,
+    its corresponding topology will be removed from the executor.
+
+    @code{.cpp}
+    executor.run(taskflow);
+    std::cout << executor.num_topologies();  // 0 or 1 (taskflow still running)
+    @endcode
     */
     size_t num_topologies() const;
 
     /**
-    @brief queries the number of worker domains 
+    @brief queries the number of running taskflows with moved ownership
 
-    Each domain manages a subset of worker threads to execute domain-specific tasks,
-    for example, HOST tasks and CUDA tasks.
+    @code{.cpp}
+    executor.run(std::move(taskflow));
+    std::cout << executor.num_taskflows();  // 0 or 1 (taskflow still running)
+    @endcode
     */
-    size_t num_domains() const;
+    size_t num_taskflows() const;
 
     /**
     @brief queries the id of the caller thread in this executor
 
-    Each worker has an unique id from 0 to N-1 exclusive to the associated executor.
-    If the caller thread does not belong to the executor, -1 is returned.
+    Each worker has an unique id in the range of @c 0 to @c N-1 associated with
+    its parent executor.
+    If the caller thread does not belong to the executor, @c -1 is returned.
+
+    @code{.cpp}
+    tf::Executor executor(4);   // 4 workers in the executor
+    executor.this_worker_id();  // -1 (main thread is not a worker)
+
+    taskflow.emplace([&](){
+      std::cout << executor.this_worker_id();  // 0, 1, 2, or 3
+    });
+    executor.run(taskflow);
+    @endcode
     */
     int this_worker_id() const;
 
-    /** 
+    /**
     @brief runs a given function asynchronously
 
     @tparam F callable type
     @tparam ArgsT parameter types
 
     @param f callable object to call
     @param args parameters to pass to the callable
-    
-    @return a std::future that will eventually hold the result of the function call
+
+    @return a tf::Future that will holds the result of the execution
+
+    The method creates an asynchronous task to launch the given
+    function on the given arguments.
+    Unlike std::async, the return here is a @em tf::Future that holds
+    an optional object to the result.
+    If the asynchronous task is cancelled before it runs, the return is
+    a @c std::nullopt, or the value returned by the callable.
+
+    @code{.cpp}
+    tf::Fugure<std::optional<int>> future = executor.async([](){
+      std::cout << "create an asynchronous task and returns 1\n";
+      return 1;
+    });
+    @endcode
+
+    This member function is thread-safe.
     */
     template <typename F, typename... ArgsT>
-    std::enable_if_t<
-      !std::is_same<typename function_traits<F>::return_type, void>::value,
-      std::future<typename function_traits<F>::return_type>
-    >
-    async(F&& f, ArgsT&&... args);
-    
+    auto async(F&& f, ArgsT&&... args);
+
     /**
-    @brief runs a given function asynchronously
-    
-    @tparam F callable type (return void)
+    @brief runs a given function asynchronously and gives a name to this task
+
+    @tparam F callable type
     @tparam ArgsT parameter types
 
+    @param name name of the asynchronous task
     @param f callable object to call
     @param args parameters to pass to the callable
-    
-    @return a std::future that will eventually hold the result of the function call
+
+    @return a tf::Future that will holds the result of the execution
+
+    The method creates a named asynchronous task to launch the given
+    function on the given arguments.
+    Naming an asynchronous task is primarily used for profiling and visualizing
+    the task execution timeline.
+    Unlike std::async, the return here is a tf::Future that holds
+    an optional object to the result.
+    If the asynchronous task is cancelled before it runs, the return is
+    a @c std::nullopt, or the value returned by the callable.
+
+    @code{.cpp}
+    tf::Fugure<std::optional<int>> future = executor.named_async("name", [](){
+      std::cout << "create an asynchronous task with a name and returns 1\n";
+      return 1;
+    });
+    @endcode
+
+    This member function is thread-safe.
     */
     template <typename F, typename... ArgsT>
-    std::enable_if_t<
-      std::is_same<typename function_traits<F>::return_type, void>::value,
-      std::future<void>
-    >
-    async(F&& f, ArgsT&&... args);
-    
+    auto named_async(const std::string& name, F&& f, ArgsT&&... args);
+
+    /**
+    @brief similar to tf::Executor::async but does not return a future object
+
+    This member function is more efficient than tf::Executor::async
+    and is encouraged to use when there is no data returned.
+
+    @code{.cpp}
+    executor.silent_async([](){
+      std::cout << "create an asynchronous task with no return\n";
+    });
+    @endcode
+
+    This member function is thread-safe.
+    */
+    template <typename F, typename... ArgsT>
+    void silent_async(F&& f, ArgsT&&... args);
+
+    /**
+    @brief similar to tf::Executor::named_async but does not return a future object
+
+    This member function is more efficient than tf::Executor::named_async
+    and is encouraged to use when there is no data returned.
+
+    @code{.cpp}
+    executor.named_silent_async("name", [](){
+      std::cout << "create an asynchronous task with a name and no return\n";
+    });
+    @endcode
+
+    This member function is thread-safe.
+    */
+    template <typename F, typename... ArgsT>
+    void named_silent_async(const std::string& name, F&& f, ArgsT&&... args);
+
     /**
     @brief constructs an observer to inspect the activities of worker threads
 
-    Each executor manage a list of observers in shared ownership with callers.
-    
     @tparam Observer observer type derived from tf::ObserverInterface
-    @tparam ArgsT... argument parameter pack
+    @tparam ArgsT argument parameter pack
 
     @param args arguments to forward to the constructor of the observer
-    
+
     @return a shared pointer to the created observer
+
+    Each executor manages a list of observers with shared ownership with callers.
+    For each of these observers, the two member functions,
+    tf::ObserverInterface::on_entry and tf::ObserverInterface::on_exit
+    will be called before and after the execution of a task.
+
+    This member function is not thread-safe.
     */
-    template <typename Observer, typename... Args>
-    std::shared_ptr<Observer> make_observer(Args&&... args);
-    
+    template <typename Observer, typename... ArgsT>
+    std::shared_ptr<Observer> make_observer(ArgsT&&... args);
+
     /**
-    @brief removes the associated observer
+    @brief removes an observer from the executor
+
+    This member function is not thread-safe.
     */
     template <typename Observer>
     void remove_observer(std::shared_ptr<Observer> observer);
 
     /**
     @brief queries the number of observers
     */
-    size_t num_observers() const;
+    size_t num_observers() const noexcept;
 
   private:
-    
-    const size_t _VICTIM_BEG;
-    const size_t _VICTIM_END;
-    const size_t _MAX_STEALS;
-    const size_t _MAX_YIELDS;
-   
+
     std::condition_variable _topology_cv;
+    std::mutex _taskflow_mutex;
     std::mutex _topology_mutex;
     std::mutex _wsq_mutex;
 
     size_t _num_topologies {0};
-    
+
+    std::unordered_map<std::thread::id, size_t> _wids;
     std::vector<Worker> _workers;
     std::vector<std::thread> _threads;
+    std::list<Taskflow> _taskflows;
 
-#ifdef TF_ENABLE_CUDA
-    std::vector<cudaDevice> _cuda_devices;
-#endif
-    
-    Notifier _notifier[NUM_DOMAINS];
+    Notifier _notifier;
 
-    TaskQueue<Node*> _wsq[NUM_DOMAINS];
+    TaskQueue<Node*> _wsq;
 
-    size_t _id_offset[NUM_DOMAINS] = {0};
-
-    std::atomic<size_t> _num_actives[NUM_DOMAINS];
-    std::atomic<size_t> _num_thieves[NUM_DOMAINS];
+    std::atomic<size_t> _num_actives {0};
+    std::atomic<size_t> _num_thieves {0};
     std::atomic<bool>   _done {0};
-    
+
     std::unordered_set<std::shared_ptr<ObserverInterface>> _observers;
 
-    TFProfObserver* _tfprof;
-    
-    PerThread& _per_thread() const;
+    Worker* _this_worker();
 
     bool _wait_for_task(Worker&, Node*&);
-    
-    void _instantiate_tfprof();
-    void _flush_tfprof();
+
     void _observer_prologue(Worker&, Node*);
     void _observer_epilogue(Worker&, Node*);
-    void _spawn(size_t, Domain);
+    void _spawn(size_t);
     void _worker_loop(Worker&);
     void _exploit_task(Worker&, Node*&);
     void _explore_task(Worker&, Node*&);
+    void _consume_task(Worker&, Node*);
+    void _schedule(Worker&, Node*);
     void _schedule(Node*);
-    void _schedule(PassiveVector<Node*>&);
-    void _invoke(Worker&, Node*);
-    void _invoke_static_work(Worker&, Node*);
-    void _invoke_dynamic_work(Worker&, Node*);
-    void _invoke_dynamic_work_internal(Worker&, Node*, Graph&, bool);
-    void _invoke_dynamic_work_external(Node*, Graph&, bool);
-    void _invoke_condition_work(Worker&, Node*, int&);
-    void _invoke_module_work(Worker&, Node*);
-    void _invoke_async_work(Worker&, Node*);
-    void _set_up_topology(Topology*);
-    void _tear_down_topology(Topology*); 
+    void _schedule(Worker&, const SmallVector<Node*>&);
+    void _schedule(const SmallVector<Node*>&);
+    void _set_up_topology(Worker*, Topology*);
+    void _tear_down_topology(Worker&, Topology*);
+    void _tear_down_async(Node*);
+    void _tear_down_invoke(Worker&, Node*);
+    void _cancel_invoke(Worker&, Node*);
     void _increment_topology();
     void _decrement_topology();
     void _decrement_topology_and_notify();
+    void _invoke(Worker&, Node*);
+    void _invoke_static_task(Worker&, Node*);
+    void _invoke_dynamic_task(Worker&, Node*);
+    void _invoke_dynamic_task_external(Worker&, Node*, Graph&, bool);
+    void _invoke_dynamic_task_internal(Worker&, Node*, Graph&);
+    void _invoke_condition_task(Worker&, Node*, SmallVector<int>&);
+    void _invoke_multi_condition_task(Worker&, Node*, SmallVector<int>&);
+    void _invoke_module_task(Worker&, Node*, bool&);
+    void _invoke_module_task_internal(Worker&, Node*, Graph&, bool&);
+    void _invoke_async_task(Worker&, Node*);
+    void _invoke_silent_async_task(Worker&, Node*);
+    void _invoke_cudaflow_task(Worker&, Node*);
+    void _invoke_syclflow_task(Worker&, Node*);
+    void _invoke_runtime_task(Worker&, Node*);
 
-#ifdef TF_ENABLE_CUDA
-    void _invoke_cudaflow_work(Worker&, Node*);
-    
-    template <typename P>
-    void _invoke_cudaflow_work_internal(Worker&, cudaFlow&, P&&);
-    
-    template <typename P>
-    void _invoke_cudaflow_work_external(cudaFlow&, P&&);
-#endif
-};
-
-
-#ifdef TF_ENABLE_CUDA
-// Constructor
-inline Executor::Executor(size_t N, size_t M) :
-  _VICTIM_BEG   {0},
-  _VICTIM_END   {N + M - 1},
-  _MAX_STEALS   {(N + M + 1) << 1},
-  _MAX_YIELDS   {100},
-  _workers      {N + M},
-  _cuda_devices {cuda_num_devices()},
-  _notifier     {Notifier(N), Notifier(M)} {
-
-  if(N == 0) {
-    TF_THROW("no cpu workers to execute taskflows");
-  }
-
-  if(M == 0) {
-    TF_THROW("no gpu workers to execute cudaflows");
-  }
-
-  for(int i=0; i<NUM_DOMAINS; ++i) {
-    _num_actives[i].store(0, std::memory_order_relaxed);
-    _num_thieves[i].store(0, std::memory_order_relaxed); 
-  }
-  
-  // create a per-worker stream on each cuda device
-  for(size_t i=0; i<_cuda_devices.size(); ++i) {
-    _cuda_devices[i].streams.resize(M);
-    cudaScopedDevice ctx(i);
-    for(size_t m=0; m<M; ++m) {
-      TF_CHECK_CUDA(
-        cudaStreamCreate(&(_cuda_devices[i].streams[m])),
-        "failed to create a cudaStream for worker ", m, " on device ", i
-      );
-    }
-  }
-
-  _spawn(N, HOST);
-  _spawn(M, CUDA);
+    template <typename C,
+      std::enable_if_t<is_cudaflow_task_v<C>, void>* = nullptr
+    >
+    void _invoke_cudaflow_task_entry(Node*, C&&);
 
-  // initiate the observer if requested
-  _instantiate_tfprof();
-}
+    template <typename C, typename Q,
+      std::enable_if_t<is_syclflow_task_v<C>, void>* = nullptr
+    >
+    void _invoke_syclflow_task_entry(Node*, C&&, Q&);
+};
 
-#else
 // Constructor
-inline Executor::Executor(size_t N) : 
-  _VICTIM_BEG {0},
-  _VICTIM_END {N - 1},
-  _MAX_STEALS {(N + 1) << 1},
-  _MAX_YIELDS {100},
+inline Executor::Executor(size_t N) :
   _workers    {N},
-  _notifier   {Notifier(N)} {
-  
+  _notifier   {N} {
+
   if(N == 0) {
     TF_THROW("no cpu workers to execute taskflows");
   }
-  
-  for(int i=0; i<NUM_DOMAINS; ++i) {
-    _num_actives[i].store(0, std::memory_order_relaxed);
-    _num_thieves[i].store(0, std::memory_order_relaxed); 
-  }
 
-  _spawn(N, HOST);
+  _spawn(N);
 
   // instantite the default observer if requested
-  _instantiate_tfprof();
+  if(has_env(TF_ENABLE_PROFILER)) {
+    TFProfManager::get()._manage(make_observer<TFProfObserver>());
+  }
 }
-#endif
 
 // Destructor
 inline Executor::~Executor() {
-  
+
   // wait for all topologies to complete
   wait_for_all();
-  
+
   // shut down the scheduler
   _done = true;
 
-  for(int i=0; i<NUM_DOMAINS; ++i) {
-    _notifier[i].notify(true);
-  }
-  
+  _notifier.notify(true);
+
   for(auto& t : _threads){
     t.join();
-  } 
-  
-#ifdef TF_ENABLE_CUDA  
-  // clean up the cuda streams
-  for(size_t i=0; i<_cuda_devices.size(); ++i) {
-    cudaScopedDevice ctx(i);
-    for(size_t m=0; m<_cuda_devices[i].streams.size(); ++m) {
-      cudaStreamDestroy(_cuda_devices[i].streams[m]);
-    }
-  }
-#endif
-  
-  // flush the default observer
-  _flush_tfprof();
-}
-
-// Procedure: _instantiate_tfprof
-inline void Executor::_instantiate_tfprof() {
-  // TF_OBSERVER_TYPE
-  _tfprof = get_env("TF_ENABLE_PROFILER").empty() ? 
-    nullptr : make_observer<TFProfObserver>().get();
-}
-
-// Procedure: _flush_tfprof
-inline void Executor::_flush_tfprof() {
-  if(_tfprof) {
-    std::ostringstream fpath;
-    fpath << get_env("TF_ENABLE_PROFILER") << _tfprof->_uuid << ".tfp";
-    std::ofstream ofs(fpath.str());
-    _tfprof->dump(ofs);
   }
 }
 
 // Function: num_workers
-inline size_t Executor::num_workers() const {
+inline size_t Executor::num_workers() const noexcept {
   return _workers.size();
 }
 
-// Function: num_domains
-inline size_t Executor::num_domains() const {
-  return NUM_DOMAINS;
-}
-
 // Function: num_topologies
 inline size_t Executor::num_topologies() const {
   return _num_topologies;
 }
-    
-// Function: async
+
+// Function: num_taskflows
+inline size_t Executor::num_taskflows() const {
+  return _taskflows.size();
+}
+
+// Function: _this_worker
+inline Worker* Executor::_this_worker() {
+  auto itr = _wids.find(std::this_thread::get_id());
+  return itr == _wids.end() ? nullptr : &_workers[itr->second];
+}
+
+// Function: named_async
 template <typename F, typename... ArgsT>
-std::enable_if_t<
-  !std::is_same<typename function_traits<F>::return_type, void>::value,
-  std::future<typename function_traits<F>::return_type>
->
-Executor::async(F&& f, ArgsT&&... args) {
+auto Executor::named_async(const std::string& name, F&& f, ArgsT&&... args) {
 
   _increment_topology();
 
-  using R = typename function_traits<F>::return_type;
+  using T = std::invoke_result_t<F, ArgsT...>;
+  using R = std::conditional_t<std::is_same_v<T, void>, void, std::optional<T>>;
 
   std::promise<R> p;
 
-  auto fu = p.get_future();
+  auto tpg = std::make_shared<AsyncTopology>();
 
-  auto node = Graph::_node_pool().animate(
-    nstd::in_place_type_t<Node::AsyncWork>{},
-    [p=make_moc(std::move(p)), f=std::forward<F>(f), args...] () {
-      p.object.set_value(f(args...));
-    }
+  Future<R> fu(p.get_future(), tpg);
+
+  auto node = node_pool.animate(
+    std::in_place_type_t<Node::Async>{},
+    [p=make_moc(std::move(p)), f=std::forward<F>(f), args...]
+    (bool cancel) mutable {
+      if constexpr(std::is_same_v<R, void>) {
+        if(!cancel) {
+          f(args...);
+        }
+        p.object.set_value();
+      }
+      else {
+        p.object.set_value(cancel ? std::nullopt : std::make_optional(f(args...)));
+      }
+    },
+    std::move(tpg)
   );
 
-  _schedule(node);
+  node->_name = name;
+
+  if(auto w = _this_worker(); w) {
+    _schedule(*w, node);
+  }
+  else{
+    _schedule(node);
+  }
 
   return fu;
 }
 
 // Function: async
 template <typename F, typename... ArgsT>
-std::enable_if_t<
-  std::is_same<typename function_traits<F>::return_type, void>::value,
-  std::future<void>
->
-Executor::async(F&& f, ArgsT&&... args) {
-
-  _increment_topology();
+auto Executor::async(F&& f, ArgsT&&... args) {
+  return named_async("", std::forward<F>(f), std::forward<ArgsT>(args)...);
+}
 
-  std::promise<void> p;
+// Function: named_silent_async
+template <typename F, typename... ArgsT>
+void Executor::named_silent_async(
+  const std::string& name, F&& f, ArgsT&&... args
+) {
 
-  auto fu = p.get_future();
+  _increment_topology();
 
-  auto node = Graph::_node_pool().animate(
-    nstd::in_place_type_t<Node::AsyncWork>{},
-    [p=make_moc(std::move(p)), f=std::forward<F>(f), args...] () {
+  Node* node = node_pool.animate(
+    std::in_place_type_t<Node::SilentAsync>{},
+    [f=std::forward<F>(f), args...] () mutable {
       f(args...);
-      p.object.set_value();
     }
   );
 
-  _schedule(node);
+  node->_name = name;
 
-  return fu;
+  if(auto w = _this_worker(); w) {
+    _schedule(*w, node);
+  }
+  else {
+    _schedule(node);
+  }
 }
 
-// Function: _per_thread
-inline Executor::PerThread& Executor::_per_thread() const {
-  thread_local PerThread pt;
-  return pt;
+// Function: silent_async
+template <typename F, typename... ArgsT>
+void Executor::silent_async(F&& f, ArgsT&&... args) {
+  named_silent_async("", std::forward<F>(f), std::forward<ArgsT>(args)...);
 }
 
 // Function: this_worker_id
 inline int Executor::this_worker_id() const {
-  auto worker = _per_thread().worker;
-  return worker ? static_cast<int>(worker->id) : -1;
+  auto i = _wids.find(std::this_thread::get_id());
+  return i == _wids.end() ? -1 : static_cast<int>(_workers[i->second]._id);
 }
 
 // Procedure: _spawn
-inline void Executor::_spawn(size_t N, Domain d) {
-  
-  auto id = _threads.size();
-
-  _id_offset[d] = id;
-
-  for(size_t i=0; i<N; ++i, ++id) {
-
-    _workers[id].id = id;
-    _workers[id].vtm = id;
-    _workers[id].domain = d;
-    _workers[id].executor = this;
-    _workers[id].waiter = &_notifier[d]._waiters[i];
-    
-    _threads.emplace_back([this] (Worker& w) -> void {
+inline void Executor::_spawn(size_t N) {
 
-      PerThread& pt = _per_thread();  
-      pt.worker = &w;
+  std::mutex mutex;
+  std::condition_variable cond;
+  size_t n=0;
+
+  for(size_t id=0; id<N; ++id) {
+
+    _workers[id]._id = id;
+    _workers[id]._vtm = id;
+    _workers[id]._executor = this;
+    _workers[id]._waiter = &_notifier._waiters[id];
+
+    _threads.emplace_back([this] (
+      Worker& w, std::mutex& mutex, std::condition_variable& cond, size_t& n
+    ) -> void {
+
+      // enables the mapping
+      {
+        std::scoped_lock lock(mutex);
+        _wids[std::this_thread::get_id()] = w._id;
+        if(n++; n == num_workers()) {
+          cond.notify_one();
+        }
+      }
+
+      //this_worker().worker = &w;
 
       Node* t = nullptr;
 
       // must use 1 as condition instead of !done
       while(1) {
-        
+
         // execute the tasks.
         _exploit_task(w, t);
 
         // wait for tasks
         if(_wait_for_task(w, t) == false) {
           break;
         }
       }
-      
-    }, std::ref(_workers[id]));     
+
+    }, std::ref(_workers[id]), std::ref(mutex), std::ref(cond), std::ref(n));
   }
 
+  std::unique_lock<std::mutex> lock(mutex);
+  cond.wait(lock, [&](){ return n==N; });
+}
+
+// Function: _consume_task
+inline void Executor::_consume_task(Worker& w, Node* p) {
+
+  std::uniform_int_distribution<size_t> rdvtm(0, _workers.size()-1);
+
+  while(p->_join_counter != 0) {
+    exploit:
+    if(auto t = w._wsq.pop(); t) {
+      _invoke(w, t);
+    }
+    else {
+      size_t num_steals = 0;
+      //size_t num_pauses = 0;
+      size_t max_steals = ((_workers.size() + 1) << 1);
+
+      explore:
+
+      t = (w._id == w._vtm) ? _wsq.steal() : _workers[w._vtm]._wsq.steal();
+      if(t) {
+        _invoke(w, t);
+        goto exploit;
+      }
+      else if(p->_join_counter != 0){
+
+        if(num_steals++ > max_steals) {
+          std::this_thread::yield();
+        }
+
+        //std::this_thread::yield();
+        w._vtm = rdvtm(w._rdgen);
+        goto explore;
+      }
+      else {
+        break;
+      }
+    }
+  }
 }
 
 // Function: _explore_task
 inline void Executor::_explore_task(Worker& w, Node*& t) {
-  
-  //assert(_workers[w].wsq.empty());
-  assert(!t);
 
-  const auto d = w.domain;
+  //assert(_workers[w].wsq.empty());
+  //assert(!t);
 
   size_t num_steals = 0;
   size_t num_yields = 0;
+  size_t max_steals = ((_workers.size() + 1) << 1);
 
-  std::uniform_int_distribution<size_t> rdvtm(_VICTIM_BEG, _VICTIM_END);
-
-  //while(!_done) {
-  //
-  //  size_t vtm = rdvtm(w.rdgen);
-  //    
-  //  t = (vtm == w.id) ? _wsq[d].steal() : _workers[vtm].wsq[d].steal();
-
-  //  if(t) {
-  //    break;
-  //  }
-
-  //  if(num_steal++ > _MAX_STEALS) {
-  //    std::this_thread::yield();
-  //    if(num_yields++ > _MAX_YIELDS) {
-  //      break;
-  //    }
-  //  }
-  //}
+  std::uniform_int_distribution<size_t> rdvtm(0, _workers.size()-1);
 
   do {
-    t = (w.id == w.vtm) ? _wsq[d].steal() : _workers[w.vtm].wsq[d].steal();
+    t = (w._id == w._vtm) ? _wsq.steal() : _workers[w._vtm]._wsq.steal();
 
     if(t) {
       break;
     }
-    
-    if(num_steals++ > _MAX_STEALS) {
+
+    if(num_steals++ > max_steals) {
       std::this_thread::yield();
-      if(num_yields++ > _MAX_YIELDS) {
+      if(num_yields++ > 100) {
         break;
       }
     }
-    
-    w.vtm = rdvtm(w.rdgen);
+
+    w._vtm = rdvtm(w._rdgen);
   } while(!_done);
 
 }
 
 // Procedure: _exploit_task
 inline void Executor::_exploit_task(Worker& w, Node*& t) {
-  
-  if(t) {
 
-    const auto d = w.domain;
+  if(t) {
 
-    if(_num_actives[d].fetch_add(1) == 0 && _num_thieves[d] == 0) {
-      _notifier[d].notify(false);
+    if(_num_actives.fetch_add(1) == 0 && _num_thieves == 0) {
+      _notifier.notify(false);
     }
 
     while(t) {
       _invoke(w, t);
-      
-      //if(t->_parent == nullptr) {
-      //  if(t->_topology->_join_counter.fetch_sub(1) == 1) {
-      //    _tear_down_topology(t->_topology);
-      //  }
-      //}
-      //else {  // joined subflow
-      //  t->_parent->_join_counter.fetch_sub(1);
-      //}
-
-      t = w.wsq[d].pop();
+      t = w._wsq.pop();
     }
 
-    --_num_actives[d];
+    --_num_actives;
   }
 }
 
 // Function: _wait_for_task
 inline bool Executor::_wait_for_task(Worker& worker, Node*& t) {
 
-  const auto d = worker.domain;
-
   wait_for_task:
 
-  assert(!t);
+  //assert(!t);
 
-  ++_num_thieves[d];
+  ++_num_thieves;
 
   explore_task:
 
   _explore_task(worker, t);
 
   if(t) {
-    if(_num_thieves[d].fetch_sub(1) == 1) {
-      _notifier[d].notify(false);
+    if(_num_thieves.fetch_sub(1) == 1) {
+      _notifier.notify(false);
     }
     return true;
   }
 
-  _notifier[d].prepare_wait(worker.waiter);
-  
+  _notifier.prepare_wait(worker._waiter);
+
   //if(auto vtm = _find_vtm(me); vtm != _workers.size()) {
-  if(!_wsq[d].empty()) {
+  if(!_wsq.empty()) {
 
-    _notifier[d].cancel_wait(worker.waiter);
+    _notifier.cancel_wait(worker._waiter);
     //t = (vtm == me) ? _wsq.steal() : _workers[vtm].wsq.steal();
-    
-    t = _wsq[d].steal();  // must steal here
+
+    t = _wsq.steal();  // must steal here
     if(t) {
-      if(_num_thieves[d].fetch_sub(1) == 1) {
-        _notifier[d].notify(false);
+      if(_num_thieves.fetch_sub(1) == 1) {
+        _notifier.notify(false);
       }
       return true;
     }
     else {
-      worker.vtm = worker.id;
+      worker._vtm = worker._id;
       goto explore_task;
     }
   }
 
   if(_done) {
-    _notifier[d].cancel_wait(worker.waiter);
-    for(int i=0; i<NUM_DOMAINS; ++i) {
-      _notifier[i].notify(true);
-    }
-    --_num_thieves[d];
+    _notifier.cancel_wait(worker._waiter);
+    _notifier.notify(true);
+    --_num_thieves;
     return false;
   }
 
-  if(_num_thieves[d].fetch_sub(1) == 1) {
-    if(_num_actives[d]) {
-      _notifier[d].cancel_wait(worker.waiter);
+  if(_num_thieves.fetch_sub(1) == 1) {
+    if(_num_actives) {
+      _notifier.cancel_wait(worker._waiter);
       goto wait_for_task;
     }
-    // check all domain queue again
+    // check all queues again
     for(auto& w : _workers) {
-      if(!w.wsq[d].empty()) {
-        worker.vtm = w.id;
-        _notifier[d].cancel_wait(worker.waiter);
+      if(!w._wsq.empty()) {
+        worker._vtm = w._id;
+        _notifier.cancel_wait(worker._waiter);
         goto wait_for_task;
       }
     }
   }
-    
+
   // Now I really need to relinguish my self to others
-  _notifier[d].commit_wait(worker.waiter);
+  _notifier.commit_wait(worker._waiter);
 
   return true;
 }
 
-// Function: make_observer    
-template<typename Observer, typename... Args>
-std::shared_ptr<Observer> Executor::make_observer(Args&&... args) {
+// Function: make_observer
+template<typename Observer, typename... ArgsT>
+std::shared_ptr<Observer> Executor::make_observer(ArgsT&&... args) {
 
   static_assert(
-    std::is_base_of<ObserverInterface, Observer>::value,
+    std::is_base_of_v<ObserverInterface, Observer>,
     "Observer must be derived from ObserverInterface"
   );
-  
-  // use a local variable to mimic the constructor 
-  auto ptr = std::make_shared<Observer>(std::forward<Args>(args)...);
-  
+
+  // use a local variable to mimic the constructor
+  auto ptr = std::make_shared<Observer>(std::forward<ArgsT>(args)...);
+
   ptr->set_up(_workers.size());
 
   _observers.emplace(std::static_pointer_cast<ObserverInterface>(ptr));
 
   return ptr;
 }
 
 // Procedure: remove_observer
 template <typename Observer>
 void Executor::remove_observer(std::shared_ptr<Observer> ptr) {
-  
+
   static_assert(
-    std::is_base_of<ObserverInterface, Observer>::value,
+    std::is_base_of_v<ObserverInterface, Observer>,
     "Observer must be derived from ObserverInterface"
   );
 
   _observers.erase(std::static_pointer_cast<ObserverInterface>(ptr));
 }
 
 // Function: num_observers
-inline size_t Executor::num_observers() const {
+inline size_t Executor::num_observers() const noexcept {
   return _observers.size();
 }
 
 // Procedure: _schedule
-// The main procedure to schedule a give task node.
-// Each task node has two types of tasks - regular and subflow.
-inline void Executor::_schedule(Node* node) {
-  
-  //assert(_workers.size() != 0);
+inline void Executor::_schedule(Worker& worker, Node* node) {
 
-  const auto d = node->domain();
-  
-  // caller is a worker to this pool
-  auto worker = _per_thread().worker;
+  node->_state.fetch_or(Node::READY, std::memory_order_release);
 
-  if(worker != nullptr && worker->executor == this) {
-    worker->wsq[d].push(node);
-    if(worker->domain != d) {
-      if(_num_actives[d] == 0 && _num_thieves[d] == 0) {
-        _notifier[d].notify(false);
-      }
-    }
+  // caller is a worker to this pool
+  if(worker._executor == this) {
+    worker._wsq.push(node);
     return;
   }
 
-  // other threads
   {
     std::lock_guard<std::mutex> lock(_wsq_mutex);
-    _wsq[d].push(node);
+    _wsq.push(node);
   }
 
-  _notifier[d].notify(false);
+  _notifier.notify(false);
 }
 
 // Procedure: _schedule
-// The main procedure to schedule a set of task nodes.
-// Each task node has two types of tasks - regular and subflow.
-inline void Executor::_schedule(PassiveVector<Node*>& nodes) {
+inline void Executor::_schedule(Node* node) {
+
+  node->_state.fetch_or(Node::READY, std::memory_order_release);
+
+  {
+    std::lock_guard<std::mutex> lock(_wsq_mutex);
+    _wsq.push(node);
+  }
+
+  _notifier.notify(false);
+}
+
+// Procedure: _schedule
+inline void Executor::_schedule(
+  Worker& worker, const SmallVector<Node*>& nodes
+) {
 
-  //assert(_workers.size() != 0);
-  
   // We need to cacth the node count to avoid accessing the nodes
   // vector while the parent topology is removed!
   const auto num_nodes = nodes.size();
-  
+
   if(num_nodes == 0) {
     return;
   }
 
-  // worker thread
-  auto worker = _per_thread().worker;
-
-  // task counts
-  size_t tcount[NUM_DOMAINS] = {0};
+  // make the node ready
+  for(size_t i=0; i<num_nodes; ++i) {
+    nodes[i]->_state.fetch_or(Node::READY, std::memory_order_release);
+  }
 
-  if(worker != nullptr && worker->executor == this) {
+  if(worker._executor == this) {
     for(size_t i=0; i<num_nodes; ++i) {
-      const auto d = nodes[i]->domain();
-      worker->wsq[d].push(nodes[i]);
-      tcount[d]++;
-    }
-    
-    for(int d=0; d<NUM_DOMAINS; ++d) {
-      if(tcount[d] && d != worker->domain) {
-        if(_num_actives[d] == 0 && _num_thieves[d] == 0) {
-          _notifier[d].notify_n(tcount[d]);
-        }
-      }
+      worker._wsq.push(nodes[i]);
     }
-
     return;
   }
-  
-  // other threads
+
   {
     std::lock_guard<std::mutex> lock(_wsq_mutex);
     for(size_t k=0; k<num_nodes; ++k) {
-      const auto d = nodes[k]->domain();
-      _wsq[d].push(nodes[k]);
-      tcount[d]++;
+      _wsq.push(nodes[k]);
     }
   }
-  
-  for(int d=0; d<NUM_DOMAINS; ++d) {
-    _notifier[d].notify_n(tcount[d]);
-  }
+
+  _notifier.notify_n(num_nodes);
 }
 
+// Procedure: _schedule
+inline void Executor::_schedule(const SmallVector<Node*>& nodes) {
+
+  // parent topology may be removed!
+  const auto num_nodes = nodes.size();
+
+  if(num_nodes == 0) {
+    return;
+  }
+
+  // make the node ready
+  for(size_t i=0; i<num_nodes; ++i) {
+    nodes[i]->_state.fetch_or(Node::READY, std::memory_order_release);
+  }
+
+  {
+    std::lock_guard<std::mutex> lock(_wsq_mutex);
+    for(size_t k=0; k<num_nodes; ++k) {
+      _wsq.push(nodes[k]);
+    }
+  }
+
+  _notifier.notify_n(num_nodes);
+}
 
 // Procedure: _invoke
 inline void Executor::_invoke(Worker& worker, Node* node) {
 
-  //assert(_workers.size() != 0);
+  int state;
+  SmallVector<int> conds;
+
+  // synchronize all outstanding memory operations caused by reordering
+  do {
+    state = node->_state.load(std::memory_order_acquire);
+  } while(! (state & Node::READY));
+
+  // unwind stack for deferred node
+  if(state & Node::DEFERRED) {
+    node->_state.fetch_and(~Node::DEFERRED, std::memory_order_relaxed);
+    goto invoke_epilogue;
+  }
+
+  //while(!(node->_state.load(std::memory_order_acquire) & Node::READY));
+
+  invoke_prologue:
+
+  // no need to do other things if the topology is cancelled
+  if(node->_is_cancelled()) {
+    _cancel_invoke(worker, node);
+    return;
+  }
+
+  // if acquiring semaphore(s) exists, acquire them first
+  if(node->_semaphores && !node->_semaphores->to_acquire.empty()) {
+    SmallVector<Node*> nodes;
+    if(!node->_acquire_all(nodes)) {
+      _schedule(worker, nodes);
+      return;
+    }
+    node->_state.fetch_or(Node::ACQUIRED, std::memory_order_release);
+  }
 
-  // Here we need to fetch the num_successors first to avoid the invalid memory
-  // access caused by topology clear.
-  const auto num_successors = node->num_successors();
-  
-  // task type
-  auto type = node->_handle.index();
-  
   // condition task
-  int cond = -1;
-  
+  //int cond = -1;
+  //SmallVector<int> conds = { -1 };
+
   // switch is faster than nested if-else due to jump table
-  switch(type) {
+  switch(node->_handle.index()) {
     // static task
-    case Node::STATIC_WORK:{
-      _invoke_static_work(worker, node);
-    } 
+    case Node::STATIC:{
+      _invoke_static_task(worker, node);
+    }
     break;
-    
+
     // dynamic task
-    case Node::DYNAMIC_WORK: {
-      _invoke_dynamic_work(worker, node);
+    case Node::DYNAMIC: {
+      _invoke_dynamic_task(worker, node);
     }
     break;
-    
+
     // condition task
-    case Node::CONDITION_WORK: {
-      _invoke_condition_work(worker, node, cond);
+    case Node::CONDITION: {
+      _invoke_condition_task(worker, node, conds);
+    }
+    break;
+
+    // multi-condition task
+    case Node::MULTI_CONDITION: {
+      _invoke_multi_condition_task(worker, node, conds);
     }
     break;
-    //}  // no need to add a break here due to the immediate return
 
     // module task
-    case Node::MODULE_WORK: {
-      _invoke_module_work(worker, node);
+    case Node::MODULE: {
+      bool deferred = false;
+      _invoke_module_task(worker, node, deferred);
+      if(deferred) {
+        return;
+      }
     }
     break;
 
     // async task
-    case Node::ASYNC_WORK: {
-      _invoke_async_work(worker, node);
-      _decrement_topology_and_notify();
+    case Node::ASYNC: {
+      _invoke_async_task(worker, node);
+      _tear_down_async(node);
+      return ;
+    }
+    break;
+
+    // silent async task
+    case Node::SILENT_ASYNC: {
+      _invoke_silent_async_task(worker, node);
+      _tear_down_async(node);
       return ;
     }
     break;
 
     // cudaflow task
-#ifdef TF_ENABLE_CUDA
-    case Node::CUDAFLOW_WORK: {
-      _invoke_cudaflow_work(worker, node);
+    case Node::CUDAFLOW: {
+      _invoke_cudaflow_task(worker, node);
+    }
+    break;
+
+    // syclflow task
+    case Node::SYCLFLOW: {
+      _invoke_syclflow_task(worker, node);
     }
-    break; 
-#endif
+    break;
+
+    // runtime task
+    case Node::RUNTIME: {
+      _invoke_runtime_task(worker, node);
+    }
+    break;
 
-    // monostate
+    // monostate (placeholder)
     default:
     break;
   }
 
+  invoke_epilogue:
+
+  // if releasing semaphores exist, release them
+  if(node->_semaphores && !node->_semaphores->to_release.empty()) {
+    _schedule(worker, node->_release_all());
+  }
+
   // We MUST recover the dependency since the graph may have cycles.
-  // This must be done before scheduling the successors, otherwise this might cause 
+  // This must be done before scheduling the successors, otherwise this might cause
   // race condition on the _dependents
-  if(node->_has_state(Node::BRANCHED)) {
+  if((node->_state.load(std::memory_order_relaxed) & Node::CONDITIONED)) {
     node->_join_counter = node->num_strong_dependents();
   }
   else {
     node->_join_counter = node->num_dependents();
   }
-  
+
   // acquire the parent flow counter
-  auto& c = (node->_parent) ? node->_parent->_join_counter : 
+  auto& j = (node->_parent) ? node->_parent->_join_counter :
                               node->_topology->_join_counter;
-  
+
+  Node* cache {nullptr};
+
   // At this point, the node storage might be destructed (to be verified)
   // case 1: non-condition task
-  if(type != Node::CONDITION_WORK) {
-    for(size_t i=0; i<num_successors; ++i) {
-      if(--(node->_successors[i]->_join_counter) == 0) {
-        c.fetch_add(1);
-        _schedule(node->_successors[i]);
+  switch(node->_handle.index()) {
+
+    // condition and multi-condition tasks
+    case Node::CONDITION:
+    case Node::MULTI_CONDITION: {
+      for(auto cond : conds) {
+        if(cond >= 0 && static_cast<size_t>(cond) < node->_successors.size()) {
+          auto s = node->_successors[cond];
+          // zeroing the join counter for invariant
+          s->_join_counter.store(0, std::memory_order_relaxed);
+          j.fetch_add(1);
+          if(cache) {
+            _schedule(worker, cache);
+          }
+          cache = s;
+        }
+      }
+    }
+    break;
+
+    // non-condition task
+    default: {
+      for(size_t i=0; i<node->_successors.size(); ++i) {
+        if(--(node->_successors[i]->_join_counter) == 0) {
+          j.fetch_add(1);
+          if(cache) {
+            _schedule(worker, cache);
+          }
+          cache = node->_successors[i];
+        }
       }
     }
+    break;
+  }
+
+  // tear_down the invoke
+  _tear_down_invoke(worker, node);
+
+  // perform tail recursion elimination for the right-most child to reduce
+  // the number of expensive pop/push operations through the task queue
+  if(cache) {
+    node = cache;
+    //node->_state.fetch_or(Node::READY, std::memory_order_release);
+    goto invoke_prologue;
+  }
+}
+
+// Procedure: _tear_down_async
+inline void Executor::_tear_down_async(Node* node) {
+  if(node->_parent) {
+    node->_parent->_join_counter.fetch_sub(1);
   }
-  // case 2: condition task
   else {
-    if(cond >= 0 && static_cast<size_t>(cond) < num_successors) {
-      auto s = node->_successors[cond];
-      s->_join_counter.store(0);  // seems redundant but just for invariant
-      c.fetch_add(1);
-      _schedule(s);
-    }
+    _decrement_topology_and_notify();
   }
+  node_pool.recycle(node);
+}
 
-  // tear down topology if the node is the last one
-  if(node->_parent == nullptr) {
+// Proecdure: _tear_down_invoke
+inline void Executor::_tear_down_invoke(Worker& worker, Node* node) {
+  // we must check parent first before substracting the join counter,
+  // or it can introduce data race
+  if(auto parent = node->_parent; parent == nullptr) {
     if(node->_topology->_join_counter.fetch_sub(1) == 1) {
-      _tear_down_topology(node->_topology);
+      _tear_down_topology(worker, node->_topology);
     }
   }
-  else {  // joined subflow
-    node->_parent->_join_counter.fetch_sub(1);
+  else {
+    // prefetch the deferred status, as subtracting the join counter can
+    // immediately cause the other worker to release the subflow
+    auto deferred = parent->_state.load(std::memory_order_relaxed) & Node::DEFERRED;
+    if(parent->_join_counter.fetch_sub(1) == 1 && deferred) {
+      _schedule(worker, parent);
+    }
+  }
+}
+
+// Procedure: _cancel_invoke
+inline void Executor::_cancel_invoke(Worker& worker, Node* node) {
+
+  switch(node->_handle.index()) {
+    // async task needs to carry out the promise
+    case Node::ASYNC:
+      std::get_if<Node::Async>(&(node->_handle))->work(true);
+      _tear_down_async(node);
+    break;
+
+    // silent async doesn't need to carry out the promise
+    case Node::SILENT_ASYNC:
+      _tear_down_async(node);
+    break;
+
+    // tear down topology if the node is the last leaf
+    default: {
+      _tear_down_invoke(worker, node);
+    }
+    break;
   }
 }
 
 // Procedure: _observer_prologue
 inline void Executor::_observer_prologue(Worker& worker, Node* node) {
   for(auto& observer : _observers) {
-    observer->on_entry(worker.id, TaskView(node));
+    observer->on_entry(WorkerView(worker), TaskView(*node));
   }
 }
 
 // Procedure: _observer_epilogue
 inline void Executor::_observer_epilogue(Worker& worker, Node* node) {
   for(auto& observer : _observers) {
-    observer->on_exit(worker.id, TaskView(node));
+    observer->on_exit(WorkerView(worker), TaskView(*node));
   }
 }
 
-// Procedure: _invoke_static_work
-inline void Executor::_invoke_static_work(Worker& worker, Node* node) {
+// Procedure: _invoke_static_task
+inline void Executor::_invoke_static_task(Worker& worker, Node* node) {
   _observer_prologue(worker, node);
-  nstd::get<Node::StaticWork>(node->_handle).work();
+  std::get_if<Node::Static>(&node->_handle)->work();
   _observer_epilogue(worker, node);
 }
 
-// Procedure: _invoke_dynamic_work
-inline void Executor::_invoke_dynamic_work(Worker& w, Node* node) {
+// Procedure: _invoke_dynamic_task
+inline void Executor::_invoke_dynamic_task(Worker& w, Node* node) {
 
   _observer_prologue(w, node);
 
-  auto& handle = nstd::get<Node::DynamicWork>(node->_handle);
+  auto handle = std::get_if<Node::Dynamic>(&node->_handle);
 
-  handle.subgraph.clear();
+  handle->subgraph._clear();
 
-  Subflow sf(*this, node, handle.subgraph); 
+  Subflow sf(*this, w, node, handle->subgraph);
 
-  handle.work(sf);
+  handle->work(sf);
 
   if(sf._joinable) {
-    _invoke_dynamic_work_internal(w, node, handle.subgraph, false);
+    _invoke_dynamic_task_internal(w, node, handle->subgraph);
   }
-  
-  // TODO 
-  _observer_epilogue(w, node);
-}
-
-// Procedure: _invoke_dynamic_work_external
-inline void Executor::_invoke_dynamic_work_external(Node*p, Graph& g, bool detach) {
 
-  auto worker = _per_thread().worker;
-
-  assert(worker && worker->executor == this);
-  
-  _invoke_dynamic_work_internal(*worker, p, g, detach);
+  _observer_epilogue(w, node);
 }
 
-// Procedure: _invoke_dynamic_work_internal
-inline void Executor::_invoke_dynamic_work_internal(
+// Procedure: _invoke_dynamic_task_external
+inline void Executor::_invoke_dynamic_task_external(
   Worker& w, Node* p, Graph& g, bool detach
 ) {
 
-  assert(p);
-
-  if(g.empty()) return;
+  // graph is empty and has no async tasks
+  if(g.empty() && p->_join_counter == 0) {
+    return;
+  }
 
-  PassiveVector<Node*> src; 
+  SmallVector<Node*> src;
 
   for(auto n : g._nodes) {
 
     n->_topology = p->_topology;
+    n->_state.store(0, std::memory_order_relaxed);
     n->_set_up_join_counter();
 
     if(detach) {
       n->_parent = nullptr;
-      n->_set_state(Node::DETACHED);
+      n->_state.fetch_or(Node::DETACHED, std::memory_order_relaxed);
     }
     else {
       n->_parent = p;
     }
-    
+
     if(n->num_dependents() == 0) {
       src.push_back(n);
     }
   }
-  
+
   // detach here
-  if(detach) {    
-    
+  if(detach) {
+
     {
-      std::lock_guard<std::mutex> lock(p->_topology->_taskflow._mtx);
-      p->_topology->_taskflow._graph.merge(std::move(g));
+      std::lock_guard<std::mutex> lock(p->_topology->_taskflow._mutex);
+      p->_topology->_taskflow._graph._merge(std::move(g));
     }
 
     p->_topology->_join_counter.fetch_add(src.size());
-    _schedule(src);
+    _schedule(w, src);
   }
   // join here
-  else {  
+  else {
     p->_join_counter.fetch_add(src.size());
-    _schedule(src);
-    Node* t = nullptr;
-  
-    std::uniform_int_distribution<size_t> rdvtm(_VICTIM_BEG, _VICTIM_END);
-
-    while(p->_join_counter != 0) {
+    _schedule(w, src);
+    _consume_task(w, p);
+  }
+}
 
-      t = w.wsq[w.domain].pop();
+// Procedure: _invoke_dynamic_task_internal
+inline void Executor::_invoke_dynamic_task_internal(
+  Worker& w, Node* p, Graph& g
+) {
 
-      exploit:
+  // graph is empty and has no async tasks
+  if(g.empty() && p->_join_counter == 0) {
+    return;
+  }
 
-      if(t) {
-        _invoke(w, t);
-        //if(t->_parent == nullptr) {
-        //  if(t->_topology->_join_counter.fetch_sub(1) == 1) {
-        //    _tear_down_topology(t->_topology);
-        //  }
-        //}
-        //else {  // joined subflow
-        //  t->_parent->_join_counter.fetch_sub(1);
-        //}
-      }
-      else {
+  SmallVector<Node*> src;
 
-        explore:
-        t = (w.id == w.vtm) ? _wsq[w.domain].steal() : 
-                              _workers[w.vtm].wsq[w.domain].steal();
-        if(t) {
-          goto exploit;
-        }
-        else if(p->_join_counter != 0){
-          std::this_thread::yield();
-          w.vtm = rdvtm(w.rdgen);
-          goto explore;
-        }
-        else {
-          break;
-        }
-      }
+  for(auto n : g._nodes) {
+    n->_topology = p->_topology;
+    n->_state.store(0, std::memory_order_relaxed);
+    n->_set_up_join_counter();
+    n->_parent = p;
+    if(n->num_dependents() == 0) {
+      src.push_back(n);
     }
   }
+  p->_join_counter.fetch_add(src.size());
+  _schedule(w, src);
+  _consume_task(w, p);
 }
 
-// Procedure: _invoke_condition_work
-inline void Executor::_invoke_condition_work(Worker& worker, Node* node, int& cond) {
+// Procedure: _invoke_module_task_internal
+inline void Executor::_invoke_module_task_internal(
+  Worker& w, Node* p, Graph& g, bool& deferred
+) {
 
-  _observer_prologue(worker, node);
-  
-  cond = nstd::get<Node::ConditionWork>(node->_handle).work();
+  // graph is empty and has no async tasks
+  if(g.empty()) {
+    return;
+  }
 
-  _observer_epilogue(worker, node);
-}
+  // set deferred
+  deferred = true;
+  p->_state.fetch_or(Node::DEFERRED, std::memory_order_relaxed);
 
-#ifdef TF_ENABLE_CUDA
-// Procedure: _invoke_cudaflow_work
-inline void Executor::_invoke_cudaflow_work(Worker& worker, Node* node) {
-
-  _observer_prologue(worker, node);  
-  
-  assert(worker.domain == node->domain());
-  
-  // create a cudaflow
-  auto& h = nstd::get<Node::cudaFlowWork>(node->_handle);
-
-  h.graph.clear();
-
-  cudaFlow cf(*this, h.graph);
-
-  h.work(cf); 
-  
-  // join the cudaflow
-  if(cf._joinable) {
-    _invoke_cudaflow_work_internal(
-      worker, cf, [repeat=1] () mutable { return repeat-- == 0; }
-    );  
-    cf._joinable = false;
+  SmallVector<Node*> src;
+
+  for(auto n : g._nodes) {
+    n->_topology = p->_topology;
+    n->_state.store(0, std::memory_order_relaxed);
+    n->_set_up_join_counter();
+    n->_parent = p;
+    if(n->num_dependents() == 0) {
+      src.push_back(n);
+    }
   }
+  p->_join_counter.fetch_add(src.size());
+  _schedule(w, src);
+}
 
+// Procedure: _invoke_condition_task
+inline void Executor::_invoke_condition_task(
+  Worker& worker, Node* node, SmallVector<int>& conds
+) {
+  _observer_prologue(worker, node);
+  conds = { std::get_if<Node::Condition>(&node->_handle)->work() };
   _observer_epilogue(worker, node);
 }
 
-// Procedure: _invoke_cudaflow_work_internal
-template <typename P>
-void Executor::_invoke_cudaflow_work_internal(
-  Worker& w, cudaFlow& cf, P&& predicate
+// Procedure: _invoke_multi_condition_task
+inline void Executor::_invoke_multi_condition_task(
+  Worker& worker, Node* node, SmallVector<int>& conds
 ) {
-  
-  if(cf.empty()) {
-    return;
-  }
-  
-  // by default, we stick with device 0  
-  auto d = (cf._device == -1) ? 0 : cf._device;
-
-  cudaScopedDevice ctx(d);
-  
-  auto s = _cuda_devices[d].streams[w.id - _id_offset[w.domain]];
-  
-  // transforms cudaFlow to a native cudaGraph under the specified device
-  // and launches the graph through a given or an internal device stream
-  // TODO: need to leverage cudaGraphExecUpdate for changes between
-  //       successive offload calls; right now, we assume the graph
-  //       is not changed (only update parameter is allowed)
-  cf._graph._create_native_graph();
-
-  while(!predicate()) {
-
-    TF_CHECK_CUDA(
-      cudaGraphLaunch(cf._graph._native_handle.image, s), 
-      "failed to launch cudaFlow on device ", d
-    );
-
-    TF_CHECK_CUDA(
-      cudaStreamSynchronize(s), 
-      "failed to synchronize cudaFlow on device ", d
-    );
-  }
-
-  cf._graph._destroy_native_graph();
+  _observer_prologue(worker, node);
+  conds = std::get_if<Node::MultiCondition>(&node->_handle)->work();
+  _observer_epilogue(worker, node);
 }
 
-// Procedure: _invoke_cudaflow_work_external
-template <typename P>
-void Executor::_invoke_cudaflow_work_external(cudaFlow& cf, P&& predicate) {
-
-  auto w = _per_thread().worker;
-  
-  assert(w && w->executor == this);
+// Procedure: _invoke_cudaflow_task
+inline void Executor::_invoke_cudaflow_task(Worker& worker, Node* node) {
+  _observer_prologue(worker, node);
+  std::get_if<Node::cudaFlow>(&node->_handle)->work(*this, node);
+  _observer_epilogue(worker, node);
+}
 
-  _invoke_cudaflow_work_internal(*w, cf, std::forward<P>(predicate));
+// Procedure: _invoke_syclflow_task
+inline void Executor::_invoke_syclflow_task(Worker& worker, Node* node) {
+  _observer_prologue(worker, node);
+  std::get_if<Node::syclFlow>(&node->_handle)->work(*this, node);
+  _observer_epilogue(worker, node);
 }
-#endif
 
-// Procedure: _invoke_module_work
-inline void Executor::_invoke_module_work(Worker& w, Node* node) {
+// Procedure: _invoke_module_task
+inline void Executor::_invoke_module_task(Worker& w, Node* node, bool& deferred) {
+  _observer_prologue(w, node);
+  _invoke_module_task_internal(
+    w, node, std::get_if<Node::Module>(&node->_handle)->graph, deferred
+  );
+  _observer_epilogue(w, node);
+}
 
+// Procedure: _invoke_async_task
+inline void Executor::_invoke_async_task(Worker& w, Node* node) {
   _observer_prologue(w, node);
-  
-  auto module = nstd::get<Node::ModuleWork>(node->_handle).module;
-  
-  _invoke_dynamic_work_internal(w, node, module->_graph, false);
-  
-  _observer_epilogue(w, node);  
+  std::get_if<Node::Async>(&node->_handle)->work(false);
+  _observer_epilogue(w, node);
 }
 
-// Procedure: _invoke_async_work
-inline void Executor::_invoke_async_work(Worker& w, Node* node) {
+// Procedure: _invoke_silent_async_task
+inline void Executor::_invoke_silent_async_task(Worker& w, Node* node) {
   _observer_prologue(w, node);
-  
-  nstd::get<Node::AsyncWork>(node->_handle).work();
+  std::get_if<Node::SilentAsync>(&node->_handle)->work();
+  _observer_epilogue(w, node);
+}
 
-  _observer_epilogue(w, node);  
-  
-  // recycle the node
-  Graph::_node_pool().recycle(node);
+// Procedure: _invoke_runtime_task
+inline void Executor::_invoke_runtime_task(Worker& w, Node* node) {
+  _observer_prologue(w, node);
+  Runtime rt(*this, w, node);
+  std::get_if<Node::Runtime>(&node->_handle)->work(rt);
+  _observer_epilogue(w, node);
 }
 
 // Function: run
-inline std::future<void> Executor::run(Taskflow& f) {
+inline tf::Future<void> Executor::run(Taskflow& f) {
   return run_n(f, 1, [](){});
 }
 
 // Function: run
+inline tf::Future<void> Executor::run(Taskflow&& f) {
+  return run_n(std::move(f), 1, [](){});
+}
+
+// Function: run
 template <typename C>
-std::future<void> Executor::run(Taskflow& f, C&& c) {
+tf::Future<void> Executor::run(Taskflow& f, C&& c) {
   return run_n(f, 1, std::forward<C>(c));
 }
 
+// Function: run
+template <typename C>
+tf::Future<void> Executor::run(Taskflow&& f, C&& c) {
+  return run_n(std::move(f), 1, std::forward<C>(c));
+}
+
 // Function: run_n
-inline std::future<void> Executor::run_n(Taskflow& f, size_t repeat) {
+inline tf::Future<void> Executor::run_n(Taskflow& f, size_t repeat) {
   return run_n(f, repeat, [](){});
 }
 
 // Function: run_n
+inline tf::Future<void> Executor::run_n(Taskflow&& f, size_t repeat) {
+  return run_n(std::move(f), repeat, [](){});
+}
+
+// Function: run_n
 template <typename C>
-std::future<void> Executor::run_n(Taskflow& f, size_t repeat, C&& c) {
+tf::Future<void> Executor::run_n(Taskflow& f, size_t repeat, C&& c) {
   return run_until(
     f, [repeat]() mutable { return repeat-- == 0; }, std::forward<C>(c)
   );
 }
 
-// Function: run_until    
+// Function: run_n
+template <typename C>
+tf::Future<void> Executor::run_n(Taskflow&& f, size_t repeat, C&& c) {
+  return run_until(
+    std::move(f), [repeat]() mutable { return repeat-- == 0; }, std::forward<C>(c)
+  );
+}
+
+// Function: run_until
 template<typename P>
-std::future<void> Executor::run_until(Taskflow& f, P&& pred) {
+tf::Future<void> Executor::run_until(Taskflow& f, P&& pred) {
   return run_until(f, std::forward<P>(pred), [](){});
 }
 
+// Function: run_until
+template<typename P>
+tf::Future<void> Executor::run_until(Taskflow&& f, P&& pred) {
+  return run_until(std::move(f), std::forward<P>(pred), [](){});
+}
+
+// Function: run_until
+template <typename P, typename C>
+tf::Future<void> Executor::run_until(Taskflow& f, P&& p, C&& c) {
+
+  _increment_topology();
+
+  // Need to check the empty under the lock since dynamic task may
+  // define detached blocks that modify the taskflow at the same time
+  bool empty;
+  {
+    std::lock_guard<std::mutex> lock(f._mutex);
+    empty = f.empty();
+  }
+
+  // No need to create a real topology but returns an dummy future
+  if(empty || p()) {
+    c();
+    std::promise<void> promise;
+    promise.set_value();
+    _decrement_topology_and_notify();
+    return tf::Future<void>(promise.get_future(), std::monostate{});
+  }
+
+  // create a topology for this run
+  auto t = std::make_shared<Topology>(f, std::forward<P>(p), std::forward<C>(c));
+
+  // need to create future before the topology got torn down quickly
+  tf::Future<void> future(t->_promise.get_future(), t);
+
+  // modifying topology needs to be protected under the lock
+  {
+    std::lock_guard<std::mutex> lock(f._mutex);
+    f._topologies.push(t);
+    if(f._topologies.size() == 1) {
+      _set_up_topology(_this_worker(), t.get());
+    }
+  }
+
+  return future;
+}
+
+// Function: run_until
+template <typename P, typename C>
+tf::Future<void> Executor::run_until(Taskflow&& f, P&& pred, C&& c) {
+
+  std::list<Taskflow>::iterator itr;
+
+  {
+    std::scoped_lock<std::mutex> lock(_taskflow_mutex);
+    itr = _taskflows.emplace(_taskflows.end(), std::move(f));
+    itr->_satellite = itr;
+  }
+
+  return run_until(*itr, std::forward<P>(pred), std::forward<C>(c));
+}
+
+// Procedure: _increment_topology
+inline void Executor::_increment_topology() {
+  std::lock_guard<std::mutex> lock(_topology_mutex);
+  ++_num_topologies;
+}
+
+// Procedure: _decrement_topology_and_notify
+inline void Executor::_decrement_topology_and_notify() {
+  std::lock_guard<std::mutex> lock(_topology_mutex);
+  if(--_num_topologies == 0) {
+    _topology_cv.notify_all();
+  }
+}
+
+// Procedure: _decrement_topology
+inline void Executor::_decrement_topology() {
+  std::lock_guard<std::mutex> lock(_topology_mutex);
+  --_num_topologies;
+}
+
+// Procedure: wait_for_all
+inline void Executor::wait_for_all() {
+  std::unique_lock<std::mutex> lock(_topology_mutex);
+  _topology_cv.wait(lock, [&](){ return _num_topologies == 0; });
+}
+
 // Function: _set_up_topology
-inline void Executor::_set_up_topology(Topology* tpg) {
+inline void Executor::_set_up_topology(Worker* worker, Topology* tpg) {
+
+  // ---- under taskflow lock ----
 
   tpg->_sources.clear();
-  tpg->_taskflow._graph.clear_detached();
-  
+  tpg->_taskflow._graph._clear_detached();
+
   // scan each node in the graph and build up the links
   for(auto node : tpg->_taskflow._graph._nodes) {
-    
+
     node->_topology = tpg;
-    node->_clear_state();
+    node->_state.store(0, std::memory_order_relaxed);
 
     if(node->num_dependents() == 0) {
       tpg->_sources.push_back(node);
     }
 
     node->_set_up_join_counter();
   }
 
-  tpg->_join_counter.store(tpg->_sources.size(), std::memory_order_relaxed);
+  tpg->_join_counter = tpg->_sources.size();
+
+  if(worker) {
+    _schedule(*worker, tpg->_sources);
+  }
+  else {
+    _schedule(tpg->_sources);
+  }
 }
 
 // Function: _tear_down_topology
-inline void Executor::_tear_down_topology(Topology* tpg) {
+inline void Executor::_tear_down_topology(Worker& worker, Topology* tpg) {
 
   auto &f = tpg->_taskflow;
 
   //assert(&tpg == &(f._topologies.front()));
 
   // case 1: we still need to run the topology again
-  if(! tpg->_pred() ) {
-    //tpg->_recover_num_sinks();
-
-    assert(tpg->_join_counter == 0);
+  if(!tpg->_is_cancelled && !tpg->_pred()) {
+    //assert(tpg->_join_counter == 0);
+    std::lock_guard<std::mutex> lock(f._mutex);
     tpg->_join_counter = tpg->_sources.size();
-
-    _schedule(tpg->_sources); 
+    _schedule(worker, tpg->_sources);
   }
   // case 2: the final run of this topology
   else {
-    
+
+    // TODO: if the topology is cancelled, need to release all semaphores
+
     if(tpg->_call != nullptr) {
       tpg->_call();
     }
 
-    f._mtx.lock();
-
     // If there is another run (interleave between lock)
-    if(f._topologies.size() > 1) {
-
-      assert(tpg->_join_counter == 0);
+    if(std::unique_lock<std::mutex> lock(f._mutex); f._topologies.size()>1) {
+      //assert(tpg->_join_counter == 0);
 
       // Set the promise
       tpg->_promise.set_value();
-      f._topologies.pop_front();
-      f._mtx.unlock();
-      
+      f._topologies.pop();
+      tpg = f._topologies.front().get();
+
       // decrement the topology but since this is not the last we don't notify
       _decrement_topology();
 
-      tpg = &(f._topologies.front());
-
-      _set_up_topology(tpg);
-      _schedule(tpg->_sources);
-
-      //f._topologies.front()._bind(f._graph);
-      //*tpg = &(f._topologies.front());
-
-      //assert(f._topologies.front()._join_counter == 0);
-
-      //f._topologies.front()._join_counter = f._topologies.front()._sources.size();
-
-      //_schedule(f._topologies.front()._sources);
+      // set up topology needs to be under the lock or it can
+      // introduce memory order error with pop
+      _set_up_topology(&worker, tpg);
     }
     else {
-      assert(f._topologies.size() == 1);
+      //assert(f._topologies.size() == 1);
 
-      // Need to back up the promise first here becuz taskflow might be 
-      // destroy before taskflow leaves
+      // Need to back up the promise first here becuz taskflow might be
+      // destroy soon after calling get
       auto p {std::move(tpg->_promise)};
 
-      // Back up lambda capture in case it has the topology pointer, to avoid it releasing on 
-      // pop_front ahead of _mtx.unlock & _promise.set_value. Released safely when leaving scope.
-      auto bc{ std::move( tpg->_call ) };
+      // Back up lambda capture in case it has the topology pointer,
+      // to avoid it releasing on pop_front ahead of _mutex.unlock &
+      // _promise.set_value. Released safely when leaving scope.
+      auto c {std::move(tpg->_call)};
+
+      // Get the satellite if any
+      auto s {f._satellite};
 
-      f._topologies.pop_front();
+      // Now we remove the topology from this taskflow
+      f._topologies.pop();
 
-      f._mtx.unlock();
+      //f._mutex.unlock();
+      lock.unlock();
 
-      // We set the promise in the end in case taskflow leaves before taskflow
+      // We set the promise in the end in case taskflow leaves the scope.
+      // After set_value, the caller will return from wait
       p.set_value();
 
       _decrement_topology_and_notify();
-    }
-  }
-}
 
-// Function: run_until
-template <typename P, typename C>
-std::future<void> Executor::run_until(Taskflow& f, P&& pred, C&& c) {
-
-  _increment_topology();
-
-  // Special case of predicate
-  if(f.empty() || pred()) {
-    std::promise<void> promise;
-    promise.set_value();
-    _decrement_topology_and_notify();
-    return promise.get_future();
-  }
-  
-  // Multi-threaded execution.
-  bool run_now {false};
-  Topology* tpg;
-  std::future<void> future;
-  
-  {
-    std::lock_guard<std::mutex> lock(f._mtx);
-
-    // create a topology for this run
-    //tpg = &(f._topologies.emplace_back(f, std::forward<P>(pred), std::forward<C>(c)));
-    f._topologies.emplace_back(f, std::forward<P>(pred), std::forward<C>(c));
-    tpg = &(f._topologies.back());
-    future = tpg->_promise.get_future();
-   
-    if(f._topologies.size() == 1) {
-      run_now = true;
-      //tpg->_bind(f._graph);
-      //_schedule(tpg->_sources);
+      // remove the taskflow if it is managed by the executor
+      // TODO: in the future, we may need to synchronize on wait
+      // (which means the following code should the moved before set_value)
+      if(s) {
+        std::scoped_lock<std::mutex> lock(_taskflow_mutex);
+        _taskflows.erase(*s);
+      }
     }
   }
-  
-  // Notice here calling schedule may cause the topology to be removed sonner 
-  // before the function leaves.
-  if(run_now) {
-    _set_up_topology(tpg);
-    _schedule(tpg->_sources);
-  }
-
-  return future;
 }
 
-// Procedure: _increment_topology
-inline void Executor::_increment_topology() {
-  std::lock_guard<std::mutex> lock(_topology_mutex);
-  ++_num_topologies;
-}
-
-// Procedure: _decrement_topology_and_notify
-inline void Executor::_decrement_topology_and_notify() {
-  std::lock_guard<std::mutex> lock(_topology_mutex);
-  if(--_num_topologies == 0) {
-    _topology_cv.notify_all();
-  }
-}
-
-// Procedure: _decrement_topology
-inline void Executor::_decrement_topology() {
-  std::lock_guard<std::mutex> lock(_topology_mutex);
-  --_num_topologies;
-}
-
-// Procedure: wait_for_all
-inline void Executor::wait_for_all() {
-  std::unique_lock<std::mutex> lock(_topology_mutex);
-  _topology_cv.wait(lock, [&](){ return _num_topologies == 0; });
-}
-
-// ----------------------------------------------------------------------------
-// Subflow Definition
-// ----------------------------------------------------------------------------
+// ############################################################################
+// Forward Declaration: Subflow
+// ############################################################################
 
 inline void Subflow::join() {
 
+  // assert(this_worker().worker == &_worker);
+
   if(!_joinable) {
     TF_THROW("subflow not joinable");
   }
 
-  _executor._invoke_dynamic_work_external(_parent, _graph, false);
+  // only the parent worker can join the subflow
+  _executor._invoke_dynamic_task_external(_worker, _parent, _graph, false);
   _joinable = false;
 }
 
 inline void Subflow::detach() {
 
+  // assert(this_worker().worker == &_worker);
+
   if(!_joinable) {
     TF_THROW("subflow already joined or detached");
   }
 
-  _executor._invoke_dynamic_work_external(_parent, _graph, true);
+  // only the parent worker can detach the subflow
+  _executor._invoke_dynamic_task_external(_worker, _parent, _graph, true);
   _joinable = false;
 }
 
-// ----------------------------------------------------------------------------
-// cudaFlow
-// ----------------------------------------------------------------------------
+// Function: named_async
+template <typename F, typename... ArgsT>
+auto Subflow::named_async(const std::string& name, F&& f, ArgsT&&... args) {
+  return _named_async(
+    *_executor._this_worker(), name, std::forward<F>(f), std::forward<ArgsT>(args)...
+  );
+}
 
-#ifdef TF_ENABLE_CUDA
+// Function: _named_async
+template <typename F, typename... ArgsT>
+auto Subflow::_named_async(
+  Worker& w,
+  const std::string& name,
+  F&& f,
+  ArgsT&&... args
+) {
 
-// Procedure: offload_until
-template <typename P>
-void cudaFlow::offload_until(P&& predicate) {
+  _parent->_join_counter.fetch_add(1);
 
-  if(!_joinable) {
-    TF_THROW("cudaFlow already joined");
-  }
+  using T = std::invoke_result_t<F, ArgsT...>;
+  using R = std::conditional_t<std::is_same_v<T, void>, void, std::optional<T>>;
 
-  _executor._invoke_cudaflow_work_external(*this, std::forward<P>(predicate));
-}
+  std::promise<R> p;
+
+  auto tpg = std::make_shared<AsyncTopology>();
+
+  Future<R> fu(p.get_future(), tpg);
+
+  auto node = node_pool.animate(
+    std::in_place_type_t<Node::Async>{},
+    [p=make_moc(std::move(p)), f=std::forward<F>(f), args...]
+    (bool cancel) mutable {
+      if constexpr(std::is_same_v<R, void>) {
+        if(!cancel) {
+          f(args...);
+        }
+        p.object.set_value();
+      }
+      else {
+        p.object.set_value(cancel ? std::nullopt : std::make_optional(f(args...)));
+      }
+    },
+    std::move(tpg)
+  );
+
+  node->_name = name;
+  node->_topology = _parent->_topology;
+  node->_parent = _parent;
 
-// Procedure: offload_n
-inline void cudaFlow::offload_n(size_t n) {
-  offload_until([repeat=n] () mutable { return repeat-- == 0; });
+  _executor._schedule(w, node);
+
+  return fu;
 }
 
-// Procedure: offload
-inline void cudaFlow::offload() {
-  offload_until([repeat=1] () mutable { return repeat-- == 0; });
+// Function: async
+template <typename F, typename... ArgsT>
+auto Subflow::async(F&& f, ArgsT&&... args) {
+  return named_async("", std::forward<F>(f), std::forward<ArgsT>(args)...);
 }
 
-// Procedure: join_until
-template <typename P>
-void cudaFlow::join_until(P&& predicate) {
+// Function: _named_silent_async
+template <typename F, typename... ArgsT>
+void Subflow::_named_silent_async(
+  Worker& w, const std::string& name, F&& f, ArgsT&&... args
+) {
 
-  if(!_joinable) {
-    TF_THROW("cudaFlow already joined");
-  }
+  _parent->_join_counter.fetch_add(1);
 
-  _executor._invoke_cudaflow_work_external(*this, std::forward<P>(predicate));
-  _joinable = false;
-}
+  auto node = node_pool.animate(
+    std::in_place_type_t<Node::SilentAsync>{},
+    [f=std::forward<F>(f), args...] () mutable {
+      f(args...);
+    }
+  );
+
+  node->_name = name;
+  node->_topology = _parent->_topology;
+  node->_parent = _parent;
 
-// Procedure: join_n
-inline void cudaFlow::join_n(size_t n) {
-  join_until([repeat=n] () mutable { return repeat-- == 0; });
+  _executor._schedule(w, node);
 }
 
-// Procedure: join
-inline void cudaFlow::join() {
-  join_until([repeat=1] () mutable { return repeat-- == 0; });
+// Function: silent_async
+template <typename F, typename... ArgsT>
+void Subflow::named_silent_async(const std::string& name, F&& f, ArgsT&&... args) {
+  _named_silent_async(
+    *_executor._this_worker(), name, std::forward<F>(f), std::forward<ArgsT>(args)...
+  );
 }
 
+// Function: named_silent_async
+template <typename F, typename... ArgsT>
+void Subflow::silent_async(F&& f, ArgsT&&... args) {
+  named_silent_async("", std::forward<F>(f), std::forward<ArgsT>(args)...);
+}
 
-#endif
+// ############################################################################
+// Forward Declaration: Runtime
+// ############################################################################
 
-}  // end of namespace tf -----------------------------------------------------
+// Procedure: schedule
+inline void Runtime::schedule(Task task) {
+  auto node = task._node;
+  auto& j = node->_parent ? node->_parent->_join_counter :
+                            node->_topology->_join_counter;
+  j.fetch_add(1);
+  _executor._schedule(_worker, node);
+}
 
+// Procedure: run
+template <typename C>
+void Runtime::run(C&& callable) {
 
+  // dynamic task (subflow)
+  if constexpr(is_dynamic_task_v<C>) {
+    Graph graph;
+    Subflow sf(_executor, _worker, _parent, graph);
+    callable(sf);
+    if(sf._joinable) {
+      _executor._invoke_dynamic_task_internal(_worker, _parent, graph);
+    }
+  }
+  else {
+    static_assert(dependent_false_v<C>, "unsupported task callable to run");
+  }
+}
 
+}  // end of namespace tf -----------------------------------------------------
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/taskflow/core/notifier.hpp` & `rapidfuzz-2.9.0/extern/taskflow/taskflow/core/notifier.hpp`

 * *Files 3% similar despite different names*

```diff
@@ -63,15 +63,15 @@
 // the waiter, or both. But it can't happen that both threads don't see each
 // other changes, which would lead to deadlock.
 class Notifier {
 
   friend class Executor;
 
   public:
-  
+
   struct Waiter {
     std::atomic<Waiter*> next;
     std::mutex mu;
     std::condition_variable cv;
     uint64_t epoch;
     unsigned state;
     enum {
@@ -117,15 +117,16 @@
         continue;
       }
       // We've already been notified.
       if (int64_t((state & kEpochMask) - epoch) > 0) return;
       // Remove this thread from prewait counter and add it to the waiter list.
       assert((state & kWaiterMask) != 0);
       uint64_t newstate = state - kWaiterInc + kEpochInc;
-      newstate = (newstate & ~kStackMask) | (w - &_waiters[0]);
+      //newstate = (newstate & ~kStackMask) | (w - &_waiters[0]);
+      newstate = static_cast<uint64_t>((newstate & ~kStackMask) | static_cast<uint64_t>(w - &_waiters[0]));
       if ((state & kStackMask) == kStackMask)
         w->next.store(nullptr, std::memory_order_relaxed);
       else
         w->next.store(&_waiters[state & kStackMask], std::memory_order_relaxed);
       if (_state.compare_exchange_weak(state, newstate,
                                        std::memory_order_release))
         break;
@@ -175,15 +176,16 @@
         // There is a thread in pre-wait state, unblock it.
         newstate = state + kEpochInc - kWaiterInc;
       } else {
         // Pop a waiter from list and unpark it.
         Waiter* w = &_waiters[state & kStackMask];
         Waiter* wnext = w->next.load(std::memory_order_relaxed);
         uint64_t next = kStackMask;
-        if (wnext != nullptr) next = wnext - &_waiters[0];
+        //if (wnext != nullptr) next = wnext - &_waiters[0];
+        if (wnext != nullptr) next = static_cast<uint64_t>(wnext - &_waiters[0]);
         // Note: we don't add kEpochInc here. ABA problem on the lock-free stack
         // can't happen because a waiter is re-pushed onto the stack only after
         // it was in the pre-wait state which inevitably leads to epoch
         // increment.
         newstate = (state & kEpochMask) + next;
       }
       if (_state.compare_exchange_weak(state, newstate,
@@ -193,15 +195,15 @@
         Waiter* w = &_waiters[state & kStackMask];
         if (!all) w->next.store(nullptr, std::memory_order_relaxed);
         _unpark(w);
         return;
       }
     }
   }
-  
+
   // notify n workers
   void notify_n(size_t n) {
     if(n >= _waiters.size()) {
       notify(true);
     }
     else {
       for(size_t k=0; k<n; ++k) {
@@ -253,22 +255,13 @@
         w->state = Waiter::kSignaled;
       }
       // Avoid notifying if it wasn't waiting.
       if (state == Waiter::kWaiting) w->cv.notify_one();
     }
   }
 
-  Notifier(const Notifier&) = delete;
-  Notifier& operator=(const Notifier&) = delete;
-
-  Notifier(Notifier&& rhs) : 
-    _state   {rhs._state.load()},
-    _waiters {std::move(rhs._waiters)} {
-  }
-
-  
 };
 
 
 
 }  // namespace tf ------------------------------------------------------------
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/taskflow/core/task.hpp` & `rapidfuzz-2.9.0/extern/taskflow/taskflow/core/task.hpp`

 * *Files 17% similar despite different names*

```diff
@@ -1,276 +1,356 @@
 #pragma once
 
 #include "graph.hpp"
 
+/**
+@file task.hpp
+@brief task include file
+*/
+
 namespace tf {
 
 // ----------------------------------------------------------------------------
 // Task Types
 // ----------------------------------------------------------------------------
 
 /**
 @enum TaskType
 
 @brief enumeration of all task types
 */
-enum TaskType {
-  PLACEHOLDER_TASK = Node::PLACEHOLDER_WORK,
-#ifdef TF_ENABLE_CUDA
-  CUDAFLOW_TASK    = Node::CUDAFLOW_WORK,
-#endif
-  STATIC_TASK      = Node::STATIC_WORK,
-  DYNAMIC_TASK     = Node::DYNAMIC_WORK,
-  CONDITION_TASK   = Node::CONDITION_WORK,
-  MODULE_TASK      = Node::MODULE_WORK,
-  ASYNC_TASK       = Node::ASYNC_WORK,
-  NUM_TASK_TYPES
+enum class TaskType : int {
+  /** @brief placeholder task type */
+  PLACEHOLDER = 0,
+  /** @brief cudaFlow task type */
+  CUDAFLOW,
+  /** @brief syclFlow task type */
+  SYCLFLOW,
+  /** @brief static task type */
+  STATIC,
+  /** @brief dynamic (subflow) task type */
+  DYNAMIC,
+  /** @brief condition task type */
+  CONDITION,
+  /** @brief multi-condition task type */
+  MULTI_CONDITION,
+  /** @brief module task type */
+  MODULE,
+  /** @brief asynchronous task type */
+  ASYNC,
+  /** @brief runtime task type */
+  RUNTIME,
+  /** @brief undefined task type (for internal use only) */
+  UNDEFINED
+};
+
+/**
+@private
+@brief array of all task types (used for iterating task types)
+*/
+inline constexpr std::array<TaskType, 10> TASK_TYPES = {
+  TaskType::PLACEHOLDER,
+  TaskType::CUDAFLOW,
+  TaskType::SYCLFLOW,
+  TaskType::STATIC,
+  TaskType::DYNAMIC,
+  TaskType::CONDITION,
+  TaskType::MULTI_CONDITION,
+  TaskType::MODULE,
+  TaskType::ASYNC,
+  TaskType::RUNTIME
 };
 
 /**
 @brief convert a task type to a human-readable string
+
+The name of each task type is the litte-case string of its characters.
+
+@code{.cpp}
+TaskType::PLACEHOLDER     ->  "placeholder"
+TaskType::CUDAFLOW        ->  "cudaflow"
+TaskType::SYCLFLOW        ->  "syclflow"
+TaskType::STATIC          ->  "static"
+TaskType::DYNAMIC         ->  "subflow"
+TaskType::CONDITION       ->  "condition"
+TaskType::MULTI_CONDITION ->  "multi_condition"
+TaskType::MODULE          ->  "module"
+TaskType::ASYNC           ->  "async"
+TaskType::RUNTIME         ->  "runtime"
+@endcode
 */
-inline const char* task_type_to_string(TaskType type) {
+inline const char* to_string(TaskType type) {
 
   const char* val;
 
   switch(type) {
-    case PLACEHOLDER_TASK: val = "placeholder"; break;
-#ifdef TF_ENABLE_CUDA
-    case CUDAFLOW_TASK:    val = "cudaflow";    break;
-#endif
-    case STATIC_TASK:      val = "static";      break;
-    case DYNAMIC_TASK:     val = "subflow";     break;
-    case CONDITION_TASK:   val = "condition";   break;
-    case MODULE_TASK:      val = "module";      break;
-    case ASYNC_TASK:       val = "async";       break;
-    default:               val = "undefined";   break;
+    case TaskType::PLACEHOLDER:      val = "placeholder";     break;
+    case TaskType::CUDAFLOW:         val = "cudaflow";        break;
+    case TaskType::SYCLFLOW:         val = "syclflow";        break;
+    case TaskType::STATIC:           val = "static";          break;
+    case TaskType::DYNAMIC:          val = "subflow";         break;
+    case TaskType::CONDITION:        val = "condition";       break;
+    case TaskType::MULTI_CONDITION:  val = "multi_condition"; break;
+    case TaskType::MODULE:           val = "module";          break;
+    case TaskType::ASYNC:            val = "async";           break;
+    case TaskType::RUNTIME:          val = "runtime";         break;
+    default:                         val = "undefined";       break;
   }
 
   return val;
 }
 
 // ----------------------------------------------------------------------------
 // Task Traits
 // ----------------------------------------------------------------------------
 
 /**
-@struct is_static_task
-
 @brief determines if a callable is a static task
 
 A static task is a callable object constructible from std::function<void()>.
 */
 template <typename C>
-constexpr bool is_static_task_v = is_invocable_r_v<void, C> &&
-                                 !is_invocable_r_v<int, C>;
+constexpr bool is_static_task_v =
+  std::is_invocable_r_v<void, C> &&
+  !std::is_invocable_r_v<int, C> &&
+  !std::is_invocable_r_v<tf::SmallVector<int>, C>;
 
 /**
-@struct is_dynamic_task
-
 @brief determines if a callable is a dynamic task
 
 A dynamic task is a callable object constructible from std::function<void(Subflow&)>.
 */
 template <typename C>
-constexpr bool is_dynamic_task_v = is_invocable_r_v<void, C, Subflow&>;
+constexpr bool is_dynamic_task_v = std::is_invocable_r_v<void, C, Subflow&>;
 
 /**
-@struct is_condition_task
-
 @brief determines if a callable is a condition task
 
 A condition task is a callable object constructible from std::function<int()>.
 */
 template <typename C>
-constexpr bool is_condition_task_v = is_invocable_r_v<int, C>;
+constexpr bool is_condition_task_v = std::is_invocable_r_v<int, C>;
+
+/**
+@brief determines if a callable is a multi-condition task
+
+A multi-condition task is a callable object constructible from
+std::function<tf::SmallVector<int>()>.
+*/
+template <typename C>
+constexpr bool is_multi_condition_task_v =
+  std::is_invocable_r_v<SmallVector<int>, C>;
 
-#ifdef TF_ENABLE_CUDA
 /**
-@struct is_cudaflow_task
+@brief determines if a callable is a %cudaFlow task
 
-@brief determines if a callable is a cudaflow task
+A cudaFlow task is a callable object constructible from
+std::function<void(tf::cudaFlow&)> or std::function<void(tf::cudaFlowCapturer&)>.
+*/
+template <typename C>
+constexpr bool is_cudaflow_task_v = std::is_invocable_r_v<void, C, cudaFlow&> ||
+                                    std::is_invocable_r_v<void, C, cudaFlowCapturer&>;
+
+/**
+@brief determines if a callable is a %syclFlow task
 
-A cudaFlow task is a callable object constructible from std::function<void(cudaFlow&)>.
+A syclFlow task is a callable object constructible from
+std::function<void(tf::syclFlow&)>.
 */
 template <typename C>
-constexpr bool is_cudaflow_task_v = is_invocable_r_v<void, C, cudaFlow&>;
-#endif
+constexpr bool is_syclflow_task_v = std::is_invocable_r_v<void, C, syclFlow&>;
 
+/**
+@brief determines if a callable is a runtime task
 
+A runtime task is a callable object constructible from
+std::function<void(tf::Runtime&)>.
+*/
+template <typename C>
+constexpr bool is_runtime_task_v = std::is_invocable_r_v<void, C, Runtime&>;
 
 // ----------------------------------------------------------------------------
 // Task
 // ----------------------------------------------------------------------------
 
 /**
 @class Task
 
-@brief handle to a node in a task dependency graph
-
-A Task is handle object of a node in a dependency graph. 
-It provides a set of methods for users to access and modify the attributes of 
-the associated graph node.
+@brief class to create a task handle over a node in a taskflow graph
 
+A task is a wrapper over a node in a taskflow graph.
+It provides a set of methods for users to access and modify the attributes of
+the associated node in the taskflow graph.
+A task is very lightweight object (i.e., only storing a node pointer) that
+can be trivially copied around,
+and it does not own the lifetime of the associated node.
 */
 class Task {
 
   friend class FlowBuilder;
+  friend class Runtime;
   friend class Taskflow;
   friend class TaskView;
-  
+  friend class Executor;
+
   public:
 
     /**
     @brief constructs an empty task
     */
     Task() = default;
 
     /**
     @brief constructs the task with the copy of the other task
     */
     Task(const Task& other);
-    
+
     /**
     @brief replaces the contents with a copy of the other task
     */
     Task& operator = (const Task&);
-    
+
     /**
     @brief replaces the contents with a null pointer
     */
     Task& operator = (std::nullptr_t);
 
     /**
     @brief compares if two tasks are associated with the same graph node
     */
     bool operator == (const Task& rhs) const;
 
     /**
     @brief compares if two tasks are not associated with the same graph node
     */
     bool operator != (const Task& rhs) const;
-    
+
     /**
     @brief queries the name of the task
     */
     const std::string& name() const;
-    
+
     /**
     @brief queries the number of successors of the task
     */
     size_t num_successors() const;
 
     /**
     @brief queries the number of predecessors of the task
     */
     size_t num_dependents() const;
-    
+
     /**
     @brief queries the number of strong dependents of the task
     */
     size_t num_strong_dependents() const;
 
     /**
     @brief queries the number of weak dependents of the task
     */
     size_t num_weak_dependents() const;
-    
+
     /**
     @brief assigns a name to the task
 
     @param name a @std_string acceptable string
 
     @return @c *this
     */
     Task& name(const std::string& name);
 
     /**
-    @brief assigns a static task
+    @brief assigns a callable
 
-    @tparam C callable object type
+    @tparam C callable type
 
-    @param callable a callable object constructible from std::function<void()>
+    @param callable callable to construct one of the static, dynamic, condition,
+           and cudaFlow tasks
 
     @return @c *this
     */
     template <typename C>
-    std::enable_if_t<is_static_task_v<C>, Task>& work(C&& callable);
-    
-    /**
-    @brief assigns a dynamic task
+    Task& work(C&& callable);
 
-    @tparam C callable object type
+    /**
+    @brief creates a module task from a taskflow
 
-    @param callable a callable object constructible from std::function<void(Subflow&)>
+    @tparam T object type
+    @param object a custom object that defines @c T::graph() method
 
     @return @c *this
     */
-    template <typename C>
-    std::enable_if_t<is_dynamic_task_v<C>, Task>& work(C&& callable);
-    
+    template <typename T>
+    Task& composed_of(T& object);
+
     /**
-    @brief assigns a condition task
+    @brief adds precedence links from this to other tasks
 
-    @tparam C callable object type
+    @tparam Ts parameter pack
 
-    @param callable a callable object constructible from std::function<int()>
+    @param tasks one or multiple tasks
 
     @return @c *this
     */
-    template <typename C>
-    std::enable_if_t<is_condition_task_v<C>, Task>& work(C&& callable);
+    template <typename... Ts>
+    Task& precede(Ts&&... tasks);
 
-#ifdef TF_ENABLE_CUDA    
     /**
-    @brief assigns a cudaFlow task
+    @brief adds precedence links from other tasks to this
 
-    @tparam C callable object type
+    @tparam Ts parameter pack
 
-    @param callable a callable object constructible from std::function<void(cudaFlow&)>
+    @param tasks one or multiple tasks
 
     @return @c *this
     */
-    template <typename C>
-    std::enable_if_t<is_cudaflow_task_v<C>, Task>& work(C&& callable);
-#endif
+    template <typename... Ts>
+    Task& succeed(Ts&&... tasks);
 
     /**
-    @brief creates a module task from a taskflow
-
-    @param taskflow a taskflow object for the module
+    @brief makes the task release this semaphore
+    */
+    Task& release(Semaphore& semaphore);
 
-    @return @c *this
+    /**
+    @brief makes the task acquire this semaphore
     */
-    Task& composed_of(Taskflow& taskflow);
-    
+    Task& acquire(Semaphore& semaphore);
+
     /**
-    @brief adds precedence links from this to other tasks
+    @brief assigns pointer to user data
 
-    @tparam Ts... parameter pack
+    @param data pointer to user data
 
-    @param tasks one or multiple tasks
+    The following example shows how to attach user data to a task and
+    run the task iteratively while changing the data value:
 
-    @return @c *this
-    */
-    template <typename... Ts>
-    Task& precede(Ts&&... tasks);
-    
-    /**
-    @brief adds precedence links from other tasks to this
+    @code{.cpp}
+    tf::Executor executor;
+    tf::Taskflow taskflow("attach data to a task");
 
-    @tparam Ts parameter pack 
+    int data;
 
-    @param tasks one or multiple tasks
+    // create a task and attach it the data
+    auto A = taskflow.placeholder();
+    A.data(&data).work([A](){
+      auto d = *static_cast<int*>(A.data());
+      std::cout << "data is " << d << std::endl;
+    });
+
+    // run the taskflow iteratively with changing data
+    for(data = 0; data<10; data++){
+      executor.run(taskflow).wait();
+    }
+    @endcode
 
     @return @c *this
     */
-    template <typename... Ts>
-    Task& succeed(Ts&&... tasks);
-    
+    Task& data(void* data);
+
     /**
     @brief resets the task handle to null
     */
     void reset();
 
     /**
     @brief resets the associated work to a placeholder
@@ -282,113 +362,83 @@
     */
     bool empty() const;
 
     /**
     @brief queries if the task has a work assigned
     */
     bool has_work() const;
-    
+
     /**
     @brief applies an visitor callable to each successor of the task
     */
     template <typename V>
     void for_each_successor(V&& visitor) const;
-    
+
     /**
     @brief applies an visitor callable to each dependents of the task
     */
     template <typename V>
     void for_each_dependent(V&& visitor) const;
 
     /**
     @brief obtains a hash value of the underlying node
     */
     size_t hash_value() const;
-    
+
     /**
     @brief returns the task type
     */
     TaskType type() const;
 
+    /**
+    @brief dumps the task through an output stream
+    */
+    void dump(std::ostream& ostream) const;
+
+    /**
+    @brief queries pointer to user data
+    */
+    void* data() const;
+
+
   private:
-    
+
     Task(Node*);
 
     Node* _node {nullptr};
-
-    template <typename T>
-    void _precede(T&&);
-    
-    template <typename T, typename... Rest>
-    void _precede(T&&, Rest&&...);
-    
-    template <typename T>
-    void _succeed(T&&);
-    
-    template <typename T, typename... Rest>
-    void _succeed(T&&, Rest&&...);
 };
 
 // Constructor
 inline Task::Task(Node* node) : _node {node} {
 }
 
 // Constructor
 inline Task::Task(const Task& rhs) : _node {rhs._node} {
 }
 
 // Function: precede
 template <typename... Ts>
 Task& Task::precede(Ts&&... tasks) {
-  //(_node->_precede(tgts._node), ...);
-  _precede(std::forward<Ts>(tasks)...);
+  (_node->_precede(tasks._node), ...);
+  //_precede(std::forward<Ts>(tasks)...);
   return *this;
 }
 
-/// @private
-// Procedure: _precede
-template <typename T>
-void Task::_precede(T&& other) {
-  _node->_precede(other._node);
-}
-
-/// @private
-// Procedure: _precede
-template <typename T, typename... Ts>
-void Task::_precede(T&& task, Ts&&... others) {
-  _precede(std::forward<T>(task));
-  _precede(std::forward<Ts>(others)...);
-}
-
 // Function: succeed
 template <typename... Ts>
 Task& Task::succeed(Ts&&... tasks) {
-  //(tasks._node->_precede(_node), ...);
-  _succeed(std::forward<Ts>(tasks)...);
+  (tasks._node->_precede(_node), ...);
+  //_succeed(std::forward<Ts>(tasks)...);
   return *this;
 }
 
-/// @private
-// Procedure: succeed
-template <typename T>
-void Task::_succeed(T&& other) {
-  other._node->_precede(_node);
-}
-
-/// @private
-// Procedure: _succeed
-template <typename T, typename... Ts>
-void Task::_succeed(T&& task, Ts&&... others) {
-  _succeed(std::forward<T>(task));
-  _succeed(std::forward<Ts>(others)...);
-}
-
 // Function: composed_of
-inline Task& Task::composed_of(Taskflow& tf) {
-  _node->_handle.emplace<Node::ModuleWork>(&tf);
+template <typename T>
+Task& Task::composed_of(T& object) {
+  _node->_handle.emplace<Node::Module>(object);
   return *this;
 }
 
 // Operator =
 inline Task& Task::operator = (const Task& rhs) {
   _node = rhs._node;
   return *this;
@@ -412,22 +462,41 @@
 
 // Function: name
 inline Task& Task::name(const std::string& name) {
   _node->_name = name;
   return *this;
 }
 
+// Function: acquire
+inline Task& Task::acquire(Semaphore& s) {
+  if(!_node->_semaphores) {
+    _node->_semaphores = std::make_unique<Node::Semaphores>();
+  }
+  _node->_semaphores->to_acquire.push_back(&s);
+  return *this;
+}
+
+// Function: release
+inline Task& Task::release(Semaphore& s) {
+  if(!_node->_semaphores) {
+    //_node->_semaphores.emplace();
+    _node->_semaphores = std::make_unique<Node::Semaphores>();
+  }
+  _node->_semaphores->to_release.push_back(&s);
+  return *this;
+}
+
 // Procedure: reset
 inline void Task::reset() {
   _node = nullptr;
 }
 
 // Procedure: reset_work
 inline void Task::reset_work() {
-  _node->_handle = nstd::monostate{};
+  _node->_handle.emplace<std::monostate>();
 }
 
 // Function: name
 inline const std::string& Task::name() const {
   return _node->_name;
 }
 
@@ -459,15 +528,28 @@
 // Function: has_work
 inline bool Task::has_work() const {
   return _node ? _node->_handle.index() != 0 : false;
 }
 
 // Function: task_type
 inline TaskType Task::type() const {
-  return static_cast<TaskType>(_node->_handle.index());
+  switch(_node->_handle.index()) {
+    case Node::PLACEHOLDER:     return TaskType::PLACEHOLDER;
+    case Node::STATIC:          return TaskType::STATIC;
+    case Node::DYNAMIC:         return TaskType::DYNAMIC;
+    case Node::CONDITION:       return TaskType::CONDITION;
+    case Node::MULTI_CONDITION: return TaskType::MULTI_CONDITION;
+    case Node::MODULE:          return TaskType::MODULE;
+    case Node::ASYNC:           return TaskType::ASYNC;
+    case Node::SILENT_ASYNC:    return TaskType::ASYNC;
+    case Node::CUDAFLOW:        return TaskType::CUDAFLOW;
+    case Node::SYCLFLOW:        return TaskType::SYCLFLOW;
+    case Node::RUNTIME:         return TaskType::RUNTIME;
+    default:                    return TaskType::UNDEFINED;
+  }
 }
 
 // Function: for_each_successor
 template <typename V>
 void Task::for_each_successor(V&& visitor) const {
   for(size_t i=0; i<_node->_successors.size(); ++i) {
     visitor(Task(_node->_successors[i]));
@@ -483,270 +565,234 @@
 }
 
 // Function: hash_value
 inline size_t Task::hash_value() const {
   return std::hash<Node*>{}(_node);
 }
 
-// Function: work
-// assign a static work
-template <typename C>
-std::enable_if_t<is_static_task_v<C>, Task>& Task::work(C&& c) {
-  _node->_handle.emplace<Node::StaticWork>(std::forward<C>(c));
-  return *this;
+// Procedure: dump
+inline void Task::dump(std::ostream& os) const {
+  os << "task ";
+  if(name().empty()) os << _node;
+  else os << name();
+  os << " [type=" << to_string(type()) << ']';
 }
 
 // Function: work
-// assigns a dynamic work
 template <typename C>
-std::enable_if_t<is_dynamic_task_v<C>, Task>& Task::work(C&& c) {
-  _node->_handle.emplace<Node::DynamicWork>(std::forward<C>(c));
+Task& Task::work(C&& c) {
+
+  if constexpr(is_static_task_v<C>) {
+    _node->_handle.emplace<Node::Static>(std::forward<C>(c));
+  }
+  else if constexpr(is_dynamic_task_v<C>) {
+    _node->_handle.emplace<Node::Dynamic>(std::forward<C>(c));
+  }
+  else if constexpr(is_condition_task_v<C>) {
+    _node->_handle.emplace<Node::Condition>(std::forward<C>(c));
+  }
+  else if constexpr(is_multi_condition_task_v<C>) {
+    _node->_handle.emplace<Node::MultiCondition>(std::forward<C>(c));
+  }
+  else if constexpr(is_cudaflow_task_v<C>) {
+    _node->_handle.emplace<Node::cudaFlow>(std::forward<C>(c));
+  }
+  else if constexpr(is_runtime_task_v<C>) {
+    _node->_handle.emplace<Node::Runtime>(std::forward<C>(c));
+  }
+  else {
+    static_assert(dependent_false_v<C>, "invalid task callable");
+  }
   return *this;
 }
 
-// Function: work
-// assigns a condition work
-template <typename C>
-std::enable_if_t<is_condition_task_v<C>, Task>& Task::work(C&& c) {
-  _node->_handle.emplace<Node::ConditionWork>(std::forward<C>(c));
-  return *this;
+// Function: name
+inline void* Task::data() const {
+  return _node->_data;
 }
 
-#ifdef TF_ENABLE_CUDA
-// Function: work
-// assigns a cudaFlow work
-template <typename C>
-std::enable_if_t<is_cudaflow_task_v<C>, Task>& Task::work(C&& c) {
-  _node->_handle.emplace<Node::cudaFlowWork>(std::forward<C>(c));
+// Function: name
+inline Task& Task::data(void* data) {
+  _node->_data = data;
   return *this;
 }
-#endif
+
+// ----------------------------------------------------------------------------
+// global ostream
+// ----------------------------------------------------------------------------
+
+/**
+@brief overload of ostream inserter operator for cudaTask
+*/
+inline std::ostream& operator << (std::ostream& os, const Task& task) {
+  task.dump(os);
+  return os;
+}
 
 // ----------------------------------------------------------------------------
 
 /**
 @class TaskView
 
 @brief class to access task information from the observer interface
 */
 class TaskView {
-  
+
   friend class Executor;
 
   public:
 
     /**
-    @brief constructs an empty task view
-    */
-    TaskView() = default;
-
-    /**
-    @brief constructs a task view from a task
-    */
-    TaskView(const Task& task);
-    
-    /**
-    @brief constructs the task with the copy of the other task
-    */
-    TaskView(const TaskView& other);
-    
-    /**
-    @brief replaces the contents with a copy of the other task
-    */
-    TaskView& operator = (const TaskView& other);
-    
-    /**
-    @brief replaces the contents with another task
-    */
-    TaskView& operator = (const Task& other);
-    
-    /**
-    @brief replaces the contents with a null pointer
-    */
-    TaskView& operator = (std::nullptr_t);
-
-    /**
-    @brief compares if two taskviews are associated with the same task
-    */
-    bool operator == (const TaskView&) const;
-    
-    /**
-    @brief compares if two taskviews are associated with different tasks
-    */
-    bool operator != (const TaskView&) const;
-    
-    /**
     @brief queries the name of the task
     */
     const std::string& name() const;
-    
+
     /**
     @brief queries the number of successors of the task
     */
     size_t num_successors() const;
 
     /**
     @brief queries the number of predecessors of the task
     */
     size_t num_dependents() const;
-    
+
     /**
     @brief queries the number of strong dependents of the task
     */
     size_t num_strong_dependents() const;
 
     /**
     @brief queries the number of weak dependents of the task
     */
     size_t num_weak_dependents() const;
 
     /**
-    @brief resets to an empty view
-    */
-    void reset();
-
-    /**
-    @brief queries if the task view is empty
-    */
-    bool empty() const;
-    
-    /**
     @brief applies an visitor callable to each successor of the task
     */
     template <typename V>
     void for_each_successor(V&& visitor) const;
-    
+
     /**
     @brief applies an visitor callable to each dependents of the task
     */
     template <typename V>
     void for_each_dependent(V&& visitor) const;
 
     /**
     @brief queries the task type
     */
     TaskType type() const;
-    
-  private:
-    
-    TaskView(Node*);
-
-    Node* _node {nullptr};
-};
 
-// Constructor
-inline TaskView::TaskView(Node* node) : _node {node} {
-}
+    /**
+    @brief obtains a hash value of the underlying node
+    */
+    size_t hash_value() const;
 
-// Constructor
-inline TaskView::TaskView(const TaskView& rhs) : _node {rhs._node} {
-}
+  private:
 
-// Constructor
-inline TaskView::TaskView(const Task& task) : _node {task._node} {
-}
+    TaskView(const Node&);
+    TaskView(const TaskView&) = default;
 
-// Operator =
-inline TaskView& TaskView::operator = (const TaskView& rhs) {
-  _node = rhs._node;
-  return *this;
-}
-
-// Operator =
-inline TaskView& TaskView::operator = (const Task& rhs) {
-  _node = rhs._node;
-  return *this;
-}
+    const Node& _node;
+};
 
-// Operator =
-inline TaskView& TaskView::operator = (std::nullptr_t ptr) {
-  _node = ptr;
-  return *this;
+// Constructor
+inline TaskView::TaskView(const Node& node) : _node {node} {
 }
 
 // Function: name
 inline const std::string& TaskView::name() const {
-  return _node->_name;
+  return _node._name;
 }
 
 // Function: num_dependents
 inline size_t TaskView::num_dependents() const {
-  return _node->num_dependents();
+  return _node.num_dependents();
 }
 
 // Function: num_strong_dependents
 inline size_t TaskView::num_strong_dependents() const {
-  return _node->num_strong_dependents();
+  return _node.num_strong_dependents();
 }
 
 // Function: num_weak_dependents
 inline size_t TaskView::num_weak_dependents() const {
-  return _node->num_weak_dependents();
+  return _node.num_weak_dependents();
 }
 
 // Function: num_successors
 inline size_t TaskView::num_successors() const {
-  return _node->num_successors();
-}
-
-// Function: reset
-inline void TaskView::reset() {
-  _node = nullptr;
-}
-
-// Function: empty
-inline bool TaskView::empty() const {
-  return _node == nullptr;
+  return _node.num_successors();
 }
 
 // Function: type
 inline TaskType TaskView::type() const {
-  return static_cast<TaskType>(_node->_handle.index());
-}
-
-// Operator ==
-inline bool TaskView::operator == (const TaskView& rhs) const {
-  return _node == rhs._node;
+  switch(_node._handle.index()) {
+    case Node::PLACEHOLDER:     return TaskType::PLACEHOLDER;
+    case Node::STATIC:          return TaskType::STATIC;
+    case Node::DYNAMIC:         return TaskType::DYNAMIC;
+    case Node::CONDITION:       return TaskType::CONDITION;
+    case Node::MULTI_CONDITION: return TaskType::MULTI_CONDITION;
+    case Node::MODULE:          return TaskType::MODULE;
+    case Node::ASYNC:           return TaskType::ASYNC;
+    case Node::SILENT_ASYNC:    return TaskType::ASYNC;
+    case Node::CUDAFLOW:        return TaskType::CUDAFLOW;
+    case Node::SYCLFLOW:        return TaskType::SYCLFLOW;
+    case Node::RUNTIME:         return TaskType::RUNTIME;
+    default:                    return TaskType::UNDEFINED;
+  }
 }
 
-// Operator !=
-inline bool TaskView::operator != (const TaskView& rhs) const {
-  return _node != rhs._node;
+// Function: hash_value
+inline size_t TaskView::hash_value() const {
+  return std::hash<const Node*>{}(&_node);
 }
 
 // Function: for_each_successor
 template <typename V>
 void TaskView::for_each_successor(V&& visitor) const {
-  for(size_t i=0; i<_node->_successors.size(); ++i) {
-    visitor(TaskView(_node->_successors[i]));
+  for(size_t i=0; i<_node._successors.size(); ++i) {
+    visitor(TaskView(_node._successors[i]));
   }
 }
 
 // Function: for_each_dependent
 template <typename V>
 void TaskView::for_each_dependent(V&& visitor) const {
-  for(size_t i=0; i<_node->_dependents.size(); ++i) {
-    visitor(TaskView(_node->_dependents[i]));
+  for(size_t i=0; i<_node._dependents.size(); ++i) {
+    visitor(TaskView(_node._dependents[i]));
   }
 }
 
 }  // end of namespace tf. ---------------------------------------------------
 
 namespace std {
 
 /**
-@class hash<tf::Task>
+@struct hash
 
 @brief hash specialization for std::hash<tf::Task>
-
 */
 template <>
 struct hash<tf::Task> {
   auto operator() (const tf::Task& task) const noexcept {
     return task.hash_value();
   }
 };
 
+/**
+@struct hash
+
+@brief hash specialization for std::hash<tf::TaskView>
+*/
+template <>
+struct hash<tf::TaskView> {
+  auto operator() (const tf::TaskView& task_view) const noexcept {
+    return task_view.hash_value();
+  }
+};
+
 }  // end of namespace std ----------------------------------------------------
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/taskflow/core/tsq.hpp` & `rapidfuzz-2.9.0/extern/taskflow/taskflow/core/tsq.hpp`

 * *Files 12% similar despite different names*

```diff
@@ -1,63 +1,59 @@
-// 2020/02/24 - created by twhuang
-//  - specialized work stealing queue for pointer
-
 #pragma once
 
 #include <atomic>
 #include <vector>
 #include <cassert>
 #include <cstdint>
 #include <cstddef>
 #include <cstdlib>
 
 namespace tf {
 
 /**
 @class: TaskQueue
 
-@tparam T data type (must be a pointer)
+@tparam T data type (must be a pointer type)
 
 @brief Lock-free unbounded single-producer multiple-consumer queue.
 
-This class implements the work stealing queue described in the paper, 
+This class implements the work stealing queue described in the paper,
 "Correct and Efficient Work-Stealing for Weak Memory Models,"
 available at https://www.di.ens.fr/~zappa/readings/ppopp13.pdf.
 
 Only the queue owner can perform pop and push operations,
 while others can steal data from the queue.
 */
 template <typename T>
 class TaskQueue {
 
-  static_assert(std::is_pointer<T>::value, "T must be a pointer type");
+  static_assert(std::is_pointer_v<T>, "T must be a pointer type");
 
   struct Array {
 
     int64_t C;
     int64_t M;
     std::atomic<T>* S;
 
-    explicit Array(int64_t c) : 
+    explicit Array(int64_t c) :
       C {c},
       M {c-1},
       S {new std::atomic<T>[static_cast<size_t>(C)]} {
     }
 
     ~Array() {
       delete [] S;
     }
 
     int64_t capacity() const noexcept {
       return C;
     }
-    
-    template <typename O>
-    void push(int64_t i, O&& o) noexcept {
-      S[i & M].store(std::forward<O>(o), std::memory_order_relaxed);
+
+    void push(int64_t i, T o) noexcept {
+      S[i & M].store(o, std::memory_order_relaxed);
     }
 
     T pop(int64_t i) noexcept {
       return S[i & M].load(std::memory_order_relaxed);
     }
 
     Array* resize(int64_t b, int64_t t) {
@@ -66,69 +62,73 @@
         ptr->push(i, pop(i));
       }
       return ptr;
     }
 
   };
 
-  std::atomic<int64_t> _top;
-  std::atomic<int64_t> _bottom;
+  // Doubling the alignment by 2 seems to generate the most
+  // decent performance.
+  alignas(2*TF_CACHELINE_SIZE) std::atomic<int64_t> _top;
+  alignas(2*TF_CACHELINE_SIZE) std::atomic<int64_t> _bottom;
   std::atomic<Array*> _array;
   std::vector<Array*> _garbage;
 
+  //std::atomic<T> _cache {nullptr};
+
   public:
-    
+
     /**
     @brief constructs the queue with a given capacity
 
     @param capacity the capacity of the queue (must be power of 2)
     */
     explicit TaskQueue(int64_t capacity = 1024);
 
     /**
     @brief destructs the queue
     */
     ~TaskQueue();
-    
+
     /**
     @brief queries if the queue is empty at the time of this call
     */
     bool empty() const noexcept;
-    
+
     /**
     @brief queries the number of items at the time of this call
     */
     size_t size() const noexcept;
 
     /**
     @brief queries the capacity of the queue
     */
     int64_t capacity() const noexcept;
-    
+
     /**
     @brief inserts an item to the queue
 
-    Only the owner thread can insert an item to the queue. 
-    The operation can trigger the queue to resize its capacity 
+    Only the owner thread can insert an item to the queue.
+    The operation can trigger the queue to resize its capacity
     if more space is required.
 
-    @tparam O data type 
+    @tparam O data type
 
-    @param item the item to perfect-forward to the queue
+    @param item the item to push to the queue
     */
     void push(T item);
-    
+
     /**
     @brief pops out an item from the queue
 
-    Only the owner thread can pop out an item from the queue. 
+    Only the owner thread can pop out an item from the queue.
     The return can be a nullptr if this operation failed (empty queue).
     */
     T pop();
-    
+
     /**
     @brief steals an item from the queue
 
     Any threads can try to steal an item from the queue.
     The return can be a nullptr if this operation failed (not necessary empty).
     */
     T steal();
@@ -148,68 +148,83 @@
 template <typename T>
 TaskQueue<T>::~TaskQueue() {
   for(auto a : _garbage) {
     delete a;
   }
   delete _array.load();
 }
-  
+
 // Function: empty
 template <typename T>
 bool TaskQueue<T>::empty() const noexcept {
   int64_t b = _bottom.load(std::memory_order_relaxed);
   int64_t t = _top.load(std::memory_order_relaxed);
-  return b <= t;
+  return (b <= t);
+  // && (_cache.load(std::memory_order_relaxed) == nullptr);
 }
 
 // Function: size
 template <typename T>
 size_t TaskQueue<T>::size() const noexcept {
   int64_t b = _bottom.load(std::memory_order_relaxed);
   int64_t t = _top.load(std::memory_order_relaxed);
   return static_cast<size_t>(b >= t ? b - t : 0);
+         //+ (_cache.load(std::memory_order_relaxed) == nullptr ? 0: 1);
 }
 
 // Function: push
 template <typename T>
 void TaskQueue<T>::push(T o) {
+  //if(auto tmp = _cache.load(std::memory_order_relaxed); tmp) {
+  //  uncached_push(tmp);
+  //}
+  //_cache.store(o, std::memory_order_relaxed);
+
   int64_t b = _bottom.load(std::memory_order_relaxed);
   int64_t t = _top.load(std::memory_order_acquire);
   Array* a = _array.load(std::memory_order_relaxed);
 
   // queue is full
   if(a->capacity() - 1 < (b - t)) {
     Array* tmp = a->resize(b, t);
     _garbage.push_back(a);
     std::swap(a, tmp);
-    _array.store(a, std::memory_order_relaxed);
+    _array.store(a, std::memory_order_release);
+    // Note: the original paper using relaxed causes t-san to complain
+    //_array.store(a, std::memory_order_relaxed);
   }
 
   a->push(b, o);
   std::atomic_thread_fence(std::memory_order_release);
   _bottom.store(b + 1, std::memory_order_relaxed);
 }
 
 // Function: pop
 template <typename T>
 T TaskQueue<T>::pop() {
+
+  //if(auto tmp = _cache.load(std::memory_order_relaxed); tmp) {
+  //  _cache.store(nullptr, std::memory_order_relaxed);
+  //  return tmp;
+  //}
+
   int64_t b = _bottom.load(std::memory_order_relaxed) - 1;
   Array* a = _array.load(std::memory_order_relaxed);
   _bottom.store(b, std::memory_order_relaxed);
   std::atomic_thread_fence(std::memory_order_seq_cst);
   int64_t t = _top.load(std::memory_order_relaxed);
 
   T item {nullptr};
 
   if(t <= b) {
     item = a->pop(b);
     if(t == b) {
       // the last item just got stolen
-      if(!_top.compare_exchange_strong(t, t+1, 
-                                       std::memory_order_seq_cst, 
+      if(!_top.compare_exchange_strong(t, t+1,
+                                       std::memory_order_seq_cst,
                                        std::memory_order_relaxed)) {
         item = nullptr;
       }
       _bottom.store(b + 1, std::memory_order_relaxed);
     }
   }
   else {
@@ -221,15 +236,15 @@
 
 // Function: steal
 template <typename T>
 T TaskQueue<T>::steal() {
   int64_t t = _top.load(std::memory_order_acquire);
   std::atomic_thread_fence(std::memory_order_seq_cst);
   int64_t b = _bottom.load(std::memory_order_acquire);
-  
+
   T item {nullptr};
 
   if(t < b) {
     Array* a = _array.load(std::memory_order_consume);
     item = a->pop(t);
     if(!_top.compare_exchange_strong(t, t+1,
                                      std::memory_order_seq_cst,
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/iterator.hpp` & `rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/iterator.hpp`

 * *Files 12% similar despite different names*

```diff
@@ -1,21 +1,22 @@
 #pragma once
 
+#include <cstddef>
 #include <type_traits>
 
 namespace tf {
 
 template <typename T>
 constexpr std::enable_if_t<std::is_integral<std::decay_t<T>>::value, size_t>
 distance(T beg, T end, T step) {
   return (end - beg + step + (step > 0 ? -1 : 1)) / step;
 }
 
 template <typename T>
 constexpr std::enable_if_t<std::is_integral<std::decay_t<T>>::value, bool>
 is_range_invalid(T beg, T end, T step) {
-  return ((step == 0 && beg != end) || 
-          (beg < end && step <=  0) || 
+  return ((step == 0 && beg != end) ||
+          (beg < end && step <=  0) ||
           (beg > end && step >=  0));
 }
 
 }  // end of namespace tf -----------------------------------------------------
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/object_pool.hpp` & `rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/object_pool.hpp`

 * *Files 2% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 // 2020/03/13 - modified by Tsung-Wei Huang
 //  - fixed bug in aligning memory
 //
 // 2020/02/02 - modified by Tsung-Wei Huang
 //  - new implementation motivated by Hoard
-// 
+//
 // 2019/07/10 - modified by Tsung-Wei Huang
 //  - replace raw pointer with smart pointer
 //
 // 2019/06/13 - created by Tsung-Wei Huang
 //  - implemented an object pool class
 
 #pragma once
@@ -24,15 +24,15 @@
 #define TF_ENABLE_POOLABLE_ON_THIS                          \
   template <typename T, size_t S> friend class ObjectPool;  \
   void* _object_pool_block
 
 // Class: ObjectPool
 //
 // The class implements an efficient thread-safe object pool motivated
-// by the Hoard memory allocator algorithm. 
+// by the Hoard memory allocator algorithm.
 // Different from the normal memory allocator, object pool allocates
 // only one object at a time.
 //
 // Internall, we use the following variables to maintain blocks and heaps:
 // X: size in byte of a item slot
 // M: number of items per block
 // F: emptiness threshold
@@ -40,131 +40,129 @@
 // W: number of items per bin
 // K: shrinkness constant
 //
 // Example scenario 1:
 // M = 30
 // F = 4
 // W = (30+4-1)/4 = 8
-// 
+//
 // b0: 0, 1, 2, 3, 4, 5, 6, 7
 // b1: 8, 9, 10, 11, 12, 13, 14, 15
 // b2: 16, 17, 18, 19, 20, 21, 22, 23
 // b3: 24, 25, 26, 27, 28, 29
 // b4: 30 (anything equal to M)
-// 
+//
 // Example scenario 2:
 // M = 32
 // F = 4
 // W = (32+4-1)/4 = 8
 // b0: 0, 1, 2, 3, 4, 5, 6, 7
 // b1: 8, 9, 10, 11, 12, 13, 14, 15
 // b2: 16, 17, 18, 19, 20, 21, 22, 23
 // b3: 24, 25, 26, 27, 28, 29, 30, 31
 // b4: 32 (anything equal to M)
 //
 template <typename T, size_t S = 65536>
-class ObjectPool { 
-  
-  // the data column must be sufficient to hold the pointer in freelist  
-  constexpr static size_t X = std::max(sizeof(T*), sizeof(T));
+class ObjectPool {
+
+  // the data column must be sufficient to hold the pointer in freelist
+  constexpr static size_t X = (std::max)(sizeof(T*), sizeof(T));
   //constexpr static size_t X = sizeof(long double) + std::max(sizeof(T*), sizeof(T));
   //constexpr static size_t M = (S - offsetof(Block, data)) / X;
   constexpr static size_t M = S / X;
-  constexpr static size_t F = 4;   
+  constexpr static size_t F = 4;
   constexpr static size_t B = F + 1;
   constexpr static size_t W = (M + F - 1) / F;
   constexpr static size_t K = 4;
 
   static_assert(
     S && (!(S & (S-1))), "block size S must be a power of two"
   );
 
   static_assert(
     M >= 128, "block size S must be larger enough to pool at least 128 objects"
   );
-  
+
   struct Blocklist {
     Blocklist* prev;
     Blocklist* next;
   };
 
-  class GlobalHeap {
-    friend class ObjectPool;
+  struct GlobalHeap {
     std::mutex mutex;
     Blocklist list;
   };
 
-  class LocalHeap {
-    friend class ObjectPool;
+  struct LocalHeap {
     std::mutex mutex;
     Blocklist lists[B];
     size_t u {0};
     size_t a {0};
   };
 
   struct Block {
-    LocalHeap* heap;
+    std::atomic<LocalHeap*> heap;
     Blocklist list_node;
     size_t i;
     size_t u;
     T* top;
     // long double padding;
     char data[S];
   };
 
   public:
-    
+
     /**
     @brief constructs an object pool from a number of anticipated threads
     */
     explicit ObjectPool(unsigned = std::thread::hardware_concurrency());
 
     /**
     @brief destructs the object pool
     */
     ~ObjectPool();
-    
+
     /**
     @brief acquires a pointer to a object constructed from a given argument list
     */
     template <typename... ArgsT>
     T* animate(ArgsT&&... args);
-    
+
     /**
     @brief recycles a object pointed by @c ptr and destroys it
     */
     void recycle(T* ptr);
-    
+
     size_t num_bins_per_local_heap() const;
     size_t num_objects_per_bin() const;
     size_t num_objects_per_block() const;
     size_t num_available_objects() const;
     size_t num_allocated_objects() const;
     size_t capacity() const;
     size_t num_local_heaps() const;
     size_t num_global_heaps() const;
     size_t num_heaps() const;
-    
+
     float emptiness_threshold() const;
 
   private:
 
     const size_t _lheap_mask;
 
     GlobalHeap _gheap;
 
     std::vector<LocalHeap> _lheaps;
 
     LocalHeap& _this_heap();
 
-    constexpr unsigned _next_power_of_two(unsigned n) const;
+    constexpr unsigned _next_pow2(unsigned n) const;
 
     template <class P, class Q>
     constexpr size_t _offset_in_class(const Q P::*member) const;
-    
+
     template <class P, class Q>
     constexpr P* _parent_class_of(Q*, const Q P::*member);
 
     template <class P, class Q>
     constexpr P* _parent_class_of(const Q*, const Q P::*member) const;
 
     constexpr Block* _block_of(Blocklist*);
@@ -192,26 +190,26 @@
     template <typename C>
     void _for_each_block_safe(Blocklist*, C&&);
 
     template <typename C>
     void _for_each_block(Blocklist*, C&&);
 
 };
-    
+
 // ----------------------------------------------------------------------------
 // ObjectPool definition
 // ----------------------------------------------------------------------------
 
 // Constructor
 template <typename T, size_t S>
 ObjectPool<T, S>::ObjectPool(unsigned t) :
-  //_heap_mask   {(_next_power_of_two(t) << 1) - 1u},
-  //_heap_mask   { _next_power_of_two(t<<1) - 1u },
+  //_heap_mask   {(_next_pow2(t) << 1) - 1u},
+  //_heap_mask   { _next_pow2(t<<1) - 1u },
   //_heap_mask   {(t << 1) - 1},
-  _lheap_mask { _next_power_of_two((t+1) << 1) - 1 },
+  _lheap_mask { _next_pow2((t+1) << 1) - 1 },
   _lheaps     { _lheap_mask + 1 } {
 
   _blocklist_init_head(&_gheap.list);
 
   for(auto& h : _lheaps) {
     for(size_t i=0; i<B; ++i) {
       _blocklist_init_head(&h.lists[i]);
@@ -222,26 +220,28 @@
 // Destructor
 template <typename T, size_t S>
 ObjectPool<T, S>::~ObjectPool() {
 
   // clear local heaps
   for(auto& h : _lheaps) {
     for(size_t i=0; i<B; ++i) {
-      _for_each_block_safe(&h.lists[i], [] (Block* b) { 
-        std::free(b); 
+      _for_each_block_safe(&h.lists[i], [] (Block* b) {
+        //std::free(b);
+        delete b;
       });
     }
   }
-  
+
   // clear global heap
-  _for_each_block_safe(&_gheap.list, [] (Block* b) { 
-    std::free(b);
+  _for_each_block_safe(&_gheap.list, [] (Block* b) {
+    //std::free(b);
+    delete b;
   });
 }
-    
+
 // Function: num_bins_per_local_heap
 template <typename T, size_t S>
 size_t ObjectPool<T, S>::num_bins_per_local_heap() const {
   return B;
 }
 
 // Function: num_objects_per_bin
@@ -279,19 +279,19 @@
 size_t ObjectPool<T, S>::num_heaps() const {
   return _lheaps.size() + 1;
 }
 
 // Function: capacity
 template <typename T, size_t S>
 size_t ObjectPool<T, S>::capacity() const {
-  
+
   size_t n = 0;
-  
+
   // global heap
-  for(auto p=_gheap.list.next; p!=&_gheap.list; p=p->next) {  
+  for(auto p=_gheap.list.next; p!=&_gheap.list; p=p->next) {
     n += M;
   };
 
   // local heap
   for(auto& h : _lheaps) {
     n += h.a;
   }
@@ -300,35 +300,35 @@
 }
 
 // Function: num_available_objects
 template <typename T, size_t S>
 size_t ObjectPool<T, S>::num_available_objects() const {
 
   size_t n = 0;
-  
+
   // global heap
-  for(auto p=_gheap.list.next; p!=&_gheap.list; p=p->next) {  
+  for(auto p=_gheap.list.next; p!=&_gheap.list; p=p->next) {
     n += (M - _block_of(p)->u);
   };
 
   // local heap
   for(auto& h : _lheaps) {
     n += (h.a - h.u);
   }
   return n;
 }
 
 // Function: num_allocated_objects
 template <typename T, size_t S>
 size_t ObjectPool<T, S>::num_allocated_objects() const {
-  
+
   size_t n = 0;
-  
+
   // global heap
-  for(auto p=_gheap.list.next; p!=&_gheap.list; p=p->next) {  
+  for(auto p=_gheap.list.next; p!=&_gheap.list; p=p->next) {
     n += _block_of(p)->u;
   };
 
   // local heap
   for(auto& h : _lheaps) {
     n += h.u;
   }
@@ -366,36 +366,36 @@
   const Q* ptr, const Q P::*member
 ) const {
   return (P*)( (char*)ptr - _offset_in_class(member));
 }
 
 // Function: _block_of
 template <typename T, size_t S>
-constexpr typename ObjectPool<T, S>::Block* 
+constexpr typename ObjectPool<T, S>::Block*
 ObjectPool<T, S>::_block_of(Blocklist* list) {
   return _parent_class_of(list, &Block::list_node);
 }
 
 // Function: _block_of
 template <typename T, size_t S>
-constexpr typename ObjectPool<T, S>::Block* 
+constexpr typename ObjectPool<T, S>::Block*
 ObjectPool<T, S>::_block_of(const Blocklist* list) const {
   return _parent_class_of(list, &Block::list_node);
 }
 
 // Procedure: initialize a list head
 template <typename T, size_t S>
 void ObjectPool<T, S>::_blocklist_init_head(Blocklist *list) {
   list->next = list;
   list->prev = list;
 }
 
 // Procedure: _blocklist_add_impl
 // Insert a new entry between two known consecutive entries.
-// 
+//
 // This is only for internal list manipulation where we know
 // the prev/next entries already!
 template <typename T, size_t S>
 void ObjectPool<T, S>::_blocklist_add_impl(
   Blocklist *curr, Blocklist *prev, Blocklist *next
 ) {
   next->prev = curr;
@@ -403,45 +403,45 @@
   curr->prev = prev;
   prev->next = curr;
 }
 
 // list_push_front - add a new entry
 // @curr: curr entry to be added
 // @head: list head to add it after
-// 
+//
 // Insert a new entry after the specified head.
 // This is good for implementing stacks.
-// 
+//
 template <typename T, size_t S>
 void ObjectPool<T, S>::_blocklist_push_front(
   Blocklist *curr, Blocklist *head
 ) {
   _blocklist_add_impl(curr, head, head->next);
 }
 
 // list_add_tail - add a new entry
 // @curr: curr entry to be added
 // @head: list head to add it before
-// 
+//
 // Insert a new entry before the specified head.
 // This is useful for implementing queues.
-// 
+//
 template <typename T, size_t S>
 void ObjectPool<T, S>::_blocklist_push_back(
   Blocklist *curr, Blocklist *head
 ) {
   _blocklist_add_impl(curr, head->prev, head);
 }
 
 // Delete a list entry by making the prev/next entries
 // point to each other.
-// 
+//
 // This is only for internal list manipulation where we know
 // the prev/next entries already!
-// 
+//
 template <typename T, size_t S>
 void ObjectPool<T, S>::_blocklist_del_impl(
   Blocklist * prev, Blocklist * next
 ) {
   next->prev = prev;
   prev->next = next;
 }
@@ -456,15 +456,15 @@
   entry->next = nullptr;
   entry->prev = nullptr;
 }
 
 // list_replace - replace old entry by new one
 // @old : the element to be replaced
 // @curr : the new element to insert
-// 
+//
 // If @old was empty, it will be overwritten.
 template <typename T, size_t S>
 void ObjectPool<T, S>::_blocklist_replace(
   Blocklist *old, Blocklist *curr
 ) {
   curr->next = old->next;
   curr->next->prev = curr;
@@ -535,15 +535,15 @@
 template <typename C>
 void ObjectPool<T, S>::_for_each_block(Blocklist* head, C&& c) {
   Blocklist* p;
   for(p=head->next; p!=head; p=p->next) {
     c(_block_of(p));
   }
 }
-      
+
 // Procedure: _for_each_block_safe
 // Iterate each item of a list - safe to free
 template <typename T, size_t S>
 template <typename C>
 void ObjectPool<T, S>::_for_each_block_safe(Blocklist* head, C&& c) {
   Blocklist* p;
   Blocklist* t;
@@ -575,40 +575,40 @@
 
 // Function: allocate
 template <typename T, size_t S>
 template <typename... ArgsT>
 T* ObjectPool<T, S>::animate(ArgsT&&... args) {
 
   //std::cout << "construct a new item\n";
-    
+
   // my logically mapped heap
-  LocalHeap& h = _this_heap(); 
-  
+  LocalHeap& h = _this_heap();
+
   Block* s {nullptr};
 
   h.mutex.lock();
-  
+
   // scan the list of superblocks from most full to least
   int f = static_cast<int>(F-1);
   for(; f>=0; f--) {
     if(!_blocklist_is_empty(&h.lists[f])) {
       s = _block_of(h.lists[f].next);
       break;
     }
   }
-  
+
   // no superblock found
   if(f == -1) {
 
     // check heap 0 for a superblock
     _gheap.mutex.lock();
     if(!_blocklist_is_empty(&_gheap.list)) {
-      
+
       s = _block_of(_gheap.list.next);
-      
+
       //printf("get a superblock from global heap %lu\n", s->u);
       assert(s->u < M && s->heap == nullptr);
       f = static_cast<int>(_bin(s->u + 1));
 
       _blocklist_move_front(&s->list_node, &h.lists[f]);
 
       s->heap = &h;  // must be within the global heap lock
@@ -618,15 +618,16 @@
       h.a = h.a + M;
     }
     // create a new block
     else {
       //printf("create a new superblock\n");
       _gheap.mutex.unlock();
       f = 0;
-      s = static_cast<Block*>(std::malloc(sizeof(Block)));
+      //s = static_cast<Block*>(std::malloc(sizeof(Block)));
+      s = new Block();
 
       if(s == nullptr) {
         throw std::bad_alloc();
       }
 
       s->heap = &h;
       s->i = 0;
@@ -634,28 +635,28 @@
       s->top = nullptr;
 
       _blocklist_push_front(&s->list_node, &h.lists[f]);
 
       h.a = h.a + M;
     }
   }
-  
+
   // the superblock must have at least one space
   //assert(s->u < M);
   //printf("%lu %lu %lu\n", h.u, h.a, s->u);
   //assert(h.u < h.a);
 
   h.u = h.u + 1;
   s->u = s->u + 1;
 
   // take one item from the superblock
   T* mem = _allocate(s);
-  
+
   int b = static_cast<int>(_bin(s->u));
-  
+
   if(b != f) {
     //printf("move superblock from list[%d] to list[%d]\n", f, b);
     _blocklist_move_front(&s->list_node, &h.lists[b]);
   }
 
   //std::cout << "s.i " << s->i << '\n'
   //          << "s.u " << s->u << '\n'
@@ -668,38 +669,38 @@
 
   new (mem) T(std::forward<ArgsT>(args)...);
 
   mem->_object_pool_block = s;
 
   return mem;
 }
-  
+
 // Function: destruct
 template <typename T, size_t S>
 void ObjectPool<T, S>::recycle(T* mem) {
 
   //Block* s = *reinterpret_cast<Block**>(
   //  reinterpret_cast<char*>(mem) - sizeof(Block**)
   //);
 
   //Block* s= *(reinterpret_cast<Block**>(mem) - O); //  (mem) - 1
 
   Block* s = static_cast<Block*>(mem->_object_pool_block);
 
   mem->~T();
-  
+
   //printf("deallocate %p (s=%p) M=%lu W=%lu X=%lu\n", mem, s, M, W, X);
 
   // here we need a loop because when we lock the heap,
   // other threads may have removed the superblock to another heap
   bool sync = false;
 
   do {
-    auto h = s->heap;    
-    
+    LocalHeap* h = s->heap.load(std::memory_order_relaxed);
+
     // the block is in global heap
     if(h == nullptr) {
       std::lock_guard<std::mutex> glock(_gheap.mutex);
       if(s->heap == h) {
         sync = true;
         _deallocate(s, mem);
         s->u = s->u - 1;
@@ -737,40 +738,41 @@
               break;
             }
           }
         }
       }
     }
   } while(!sync);
-  
+
   //std::cout << "s.i " << s->i << '\n'
   //          << "s.u " << s->u << '\n';
 }
-    
+
 // Function: _this_heap
 template <typename T, size_t S>
-typename ObjectPool<T, S>::LocalHeap& 
+typename ObjectPool<T, S>::LocalHeap&
 ObjectPool<T, S>::_this_heap() {
   // here we don't use thread local since object pool might be
   // created and destroyed multiple times
-  thread_local auto hv = std::hash<std::thread::id>()(std::this_thread::get_id());
-  return _lheaps[hv & _lheap_mask];
+  //thread_local auto hv = std::hash<std::thread::id>()(std::this_thread::get_id());
+  //return _lheaps[hv & _lheap_mask];
 
-  //return _lheaps[
-  //  std::hash<std::thread::id>()(std::this_thread::get_id()) & _lheap_mask
-  //];
-}
-
-// Function: _next_power_of_two
-template <typename T, size_t S>
-constexpr unsigned ObjectPool<T, S>::_next_power_of_two(unsigned n) const { 
-  n--; 
-  n |= n >> 1; 
-  n |= n >> 2; 
-  n |= n >> 4; 
-  n |= n >> 8; 
-  n |= n >> 16; 
-  n++; 
-  return n; 
-}  
+  return _lheaps[
+    std::hash<std::thread::id>()(std::this_thread::get_id()) & _lheap_mask
+  ];
+}
+
+// Function: _next_pow2
+template <typename T, size_t S>
+constexpr unsigned ObjectPool<T, S>::_next_pow2(unsigned n) const {
+  if(n == 0) return 1;
+  n--;
+  n |= n >> 1;
+  n |= n >> 2;
+  n |= n >> 4;
+  n |= n >> 8;
+  n |= n >> 16;
+  n++;
+  return n;
+}
 
 }  // end namespace tf --------------------------------------------------------
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/singleton.hpp` & `rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/singleton.hpp`

 * *Files 14% similar despite different names*

```diff
@@ -7,19 +7,19 @@
 @brief class template to create a thread-safe singleton object
 
 */
 template <typename T>
 class Singleton {
 
   public:
-  
+
   /**
   @brief get a reference to the singleton object
   */
-  static T& get() {
+  inline static T& get() {
     static T instance;
     return instance;
   }
 
   private:
 
     Singleton() = default;
```

### Comparing `rapidfuzz-2.8.0/extern/taskflow/taskflow/utility/uuid.hpp` & `rapidfuzz-2.9.0/extern/taskflow/taskflow/utility/uuid.hpp`

 * *Files 4% similar despite different names*

```diff
@@ -1,31 +1,30 @@
 #pragma once
 
 #include <iostream>
-#include <cstdio>
-#include <cstdlib>
+#include <string>
 #include <cstring>
-#include <cstddef>
+#include <limits>
 #include <random>
 #include <chrono>
 
 namespace tf {
 
 // Class: UUID
 //
-// A universally unique identifier (UUID) is an identifier standard used in software 
-// construction. A UUID is simply a 128-bit value. The meaning of each bit is defined 
+// A universally unique identifier (UUID) is an identifier standard used in software
+// construction. A UUID is simply a 128-bit value. The meaning of each bit is defined
 // by any of several variants.
-// For human-readable display, many systems use a canonical format using hexadecimal 
+// For human-readable display, many systems use a canonical format using hexadecimal
 // text with inserted hyphen characters.
-// 
+//
 // For example: 123e4567-e89b-12d3-a456-426655440000
 //
-// The intent of UUIDs is to enable distributed systems to uniquely identify information 
-// without significant central coordination. 
+// The intent of UUIDs is to enable distributed systems to uniquely identify information
+// without significant central coordination.
 //
 //   Copyright 2006 Andy Tompkins.
 //   Distributed under the Boost Software License, Version 1.0. (See
 //   accompanying file LICENSE_1_0.txt or copy at
 //   http://www.boost.org/LICENSE_1_0.txt)
 //
 struct UUID {
@@ -41,90 +40,91 @@
   inline UUID();
 
   UUID(const UUID&) = default;
   UUID(UUID&&) = default;
 
   UUID& operator = (const UUID&) = default;
   UUID& operator = (UUID&&) = default;
-    
-  inline static size_type size(); 
-  inline iterator begin(); 
-  inline const_iterator begin() const; 
-  inline iterator end(); 
-  inline const_iterator end() const; 
+
+  inline static size_type size();
+  inline iterator begin();
+  inline const_iterator begin() const;
+  inline iterator end();
+  inline const_iterator end() const;
 
   inline bool is_nil() const;
   inline void swap(UUID& rhs);
   inline size_t hash_value() const;
 
   inline bool operator == (const UUID&) const;
   inline bool operator <  (const UUID&) const;
   inline bool operator >  (const UUID&) const;
   inline bool operator != (const UUID&) const;
   inline bool operator >= (const UUID&) const;
-  inline bool operator <= (const UUID&) const; 
+  inline bool operator <= (const UUID&) const;
 
   uint8_t data[16] {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
 
   inline std::string to_string() const;
 };
 
 // Constructor
 inline UUID::UUID() {
 
-  static thread_local std::random_device rd;
-  static thread_local std::mt19937 engine {rd()};
+  static thread_local std::default_random_engine engine {
+    std::random_device{}()
+  };
 
   std::uniform_int_distribution<unsigned long> distribution(
-    std::numeric_limits<unsigned long>::min(),
-    std::numeric_limits<unsigned long>::max()
+    (std::numeric_limits<unsigned long>::min)(),
+    (std::numeric_limits<unsigned long>::max)()
   );
-  
+
   int i = 0;
   auto random_value = distribution(engine);
   for (auto it=begin(); it!=end(); ++it, ++i) {
     if (i == sizeof(unsigned long)) {
       random_value = distribution(engine);
       i = 0;
     }
     *it = static_cast<UUID::value_type>((random_value >> (i*8)) & 0xFF);
   }
-  
+
   // set variant: must be 0b10xxxxxx
   *(begin()+8) &= 0xBF;
   *(begin()+8) |= 0x80;
 
   // set version: must be 0b0100xxxx
   *(begin()+6) &= 0x4F; //0b01001111
-  *(begin()+6) |= 0x40; //0b01000000 
+  *(begin()+6) |= 0x40; //0b01000000
 }
-  
+
 // Function: size
-inline typename UUID::size_type UUID::size() { 
-  return 16;          
+inline typename UUID::size_type UUID::size() {
+  return 16;
 }
 
 // Function: begin
-inline typename UUID::iterator UUID::begin() { 
-  return data;        
+inline typename UUID::iterator UUID::begin() {
+  return data;
 }
 
 // Function: begin
-inline typename UUID::const_iterator UUID::begin() const { 
-  return data;        
+inline typename UUID::const_iterator UUID::begin() const {
+  return data;
 }
 
 // Function: end
-inline typename UUID::iterator UUID::end() { 
-  return data+size(); 
+inline typename UUID::iterator UUID::end() {
+  return data+size();
 }
 
 // Function: end
-inline typename UUID::const_iterator UUID::end() const { 
-  return data+size(); 
+inline typename UUID::const_iterator UUID::end() const {
+  return data+size();
 }
 
 // Function: is_nil
 inline bool UUID::is_nil() const {
   for (std::size_t i = 0; i < sizeof(this->data); ++i) {
     if (this->data[i] != 0U) {
       return false;
@@ -217,15 +217,14 @@
   return os;
 }
 
 }  // End of namespace tf. ----------------------------------------------------
 
 //-----------------------------------------------------------------------------
 
-
 namespace std {
 
 // Partial specialization: hash<tf::UUID>
 template <>
 struct hash<tf::UUID> {
   size_t operator()(const tf::UUID& rhs) const { return rhs.hash_value(); }
 };
```

### Comparing `rapidfuzz-2.8.0/setup.py` & `rapidfuzz-2.9.0/setup.py`

 * *Files 0% similar despite different names*

```diff
@@ -7,15 +7,15 @@
     print("=" * 74)
 
 with open('README.md', 'rt', encoding="utf8") as f:
     readme = f.read()
 
 setup_args = {
     "name": "rapidfuzz",
-    "version": "2.8.0",
+    "version": "2.9.0",
     "install_requires": ["jarowinkler >= 1.2.0, < 2.0.0"],
     "extras_require": {'full': ['numpy']},
     "url": "https://github.com/maxbachmann/RapidFuzz",
     "author": "Max Bachmann",
     "author_email": "pypi@maxbachmann.de",
     "description": "rapid fuzzy string matching",
     "long_description": readme,
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/CMakeLists.txt` & `rapidfuzz-2.9.0/src/rapidfuzz/CMakeLists.txt`

 * *Files 13% similar despite different names*

```diff
@@ -23,27 +23,19 @@
 add_library(fuzz_cpp MODULE ${fuzz_cpp})
 target_compile_features(fuzz_cpp PUBLIC cxx_std_17)
 target_include_directories(fuzz_cpp PRIVATE ${RF_CAPI_PATH} ${RF_BASE_DIR}/rapidfuzz)
 target_link_libraries(fuzz_cpp PRIVATE rapidfuzz::rapidfuzz)
 python_extension_module(fuzz_cpp)
 install(TARGETS fuzz_cpp LIBRARY DESTINATION src/rapidfuzz)
 
-create_cython_target(process_cpp)
-add_library(process_cpp MODULE ${process_cpp})
-target_compile_features(process_cpp PUBLIC cxx_std_17)
-target_include_directories(process_cpp PRIVATE ${RF_CAPI_PATH} ${RF_BASE_DIR}/rapidfuzz)
-target_link_libraries(process_cpp PRIVATE rapidfuzz::rapidfuzz)
-python_extension_module(process_cpp)
-install(TARGETS process_cpp LIBRARY DESTINATION src/rapidfuzz)
-
-create_cython_target(process_cdist_cpp_impl)
-add_library(process_cdist_cpp_impl MODULE ${process_cdist_cpp_impl})
-target_compile_features(process_cdist_cpp_impl PUBLIC cxx_std_17)
-target_include_directories(process_cdist_cpp_impl PRIVATE ${RF_CAPI_PATH} ${RF_BASE_DIR}/rapidfuzz)
-target_link_libraries(process_cdist_cpp_impl PRIVATE Taskflow::Taskflow rapidfuzz::rapidfuzz)
+create_cython_target(process_cpp_impl)
+add_library(process_cpp_impl MODULE ${process_cpp_impl})
+target_compile_features(process_cpp_impl PUBLIC cxx_std_17)
+target_include_directories(process_cpp_impl PRIVATE ${RF_CAPI_PATH} ${RF_BASE_DIR}/rapidfuzz)
+target_link_libraries(process_cpp_impl PRIVATE Taskflow::Taskflow rapidfuzz::rapidfuzz)
 
 # check if we need to link with libatomic (not needed on Windows)
 if (NOT Windows)
 	# TODO: migrate to CheckSourceCompiles in CMake >= 3.19
 	include(CheckCXXSourceCompiles)
 
 	set(ATOMICS_TEST_SOURCE [=[
@@ -70,17 +62,17 @@
 		check_cxx_source_compiles("${ATOMICS8_TEST_SOURCE}" HAVE_CXX_ATOMICS8_WITH_LIB)
 		check_cxx_source_compiles("${ATOMICS64_TEST_SOURCE}" HAVE_CXX_ATOMICS64_WITH_LIB)
 		if ((NOT HAVE_CXX_ATOMICS_WITH_LIB) OR (NOT HAVE_CXX_ATOMICS8_WITH_LIB) OR (NOT HAVE_CXX_ATOMICS64_WITH_LIB))
 			message(FATAL_ERROR "No native support for std::atomic, or libatomic not found!")
 		else()
 			message(STATUS "Linking with libatomic for atomics support")
 			unset(CMAKE_REQUIRED_LIBRARIES)
-			target_link_libraries(process_cdist_cpp_impl PUBLIC atomic)
+			target_link_libraries(process_cpp_impl PUBLIC atomic)
 		endif()
 	endif()
 	if(APPLE)
 		unset(CMAKE_REQUIRED_FLAGS)
 	endif()
 endif()
 
-python_extension_module(process_cdist_cpp_impl)
-install(TARGETS process_cdist_cpp_impl LIBRARY DESTINATION src/rapidfuzz)
+python_extension_module(process_cpp_impl)
+install(TARGETS process_cpp_impl LIBRARY DESTINATION src/rapidfuzz)
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/cpp_common.hpp` & `rapidfuzz-2.9.0/src/rapidfuzz/cpp_common.hpp`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/cpp_common.pxd` & `rapidfuzz-2.9.0/src/rapidfuzz/cpp_common.pxd`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/DamerauLevenshtein.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/DamerauLevenshtein.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/DamerauLevenshtein_cpp.cxx` & `rapidfuzz-2.9.0/src/rapidfuzz/fuzz_cpp.cxx`

 * *Files 10% similar despite different names*

```diff
@@ -1034,16 +1034,16 @@
   #ifdef __cplusplus
     #define __PYX_EXTERN_C extern "C"
   #else
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
-#define __PYX_HAVE__rapidfuzz__distance__DamerauLevenshtein_cpp
-#define __PYX_HAVE_API__rapidfuzz__distance__DamerauLevenshtein_cpp
+#define __PYX_HAVE__rapidfuzz__fuzz_cpp
+#define __PYX_HAVE_API__rapidfuzz__fuzz_cpp
 /* Early includes */
 #include <stdint.h>
 #include "rapidfuzz_capi.h"
 #include <string.h>
 #include <stdlib.h>
 #include <stddef.h>
 #include "ios"
@@ -1063,15 +1063,15 @@
 
     #endif
     
 #include <stdio.h>
 #include <vector>
 #include "rapidfuzz/details/types.hpp"
 #include "cpp_common.hpp"
-#include "edit_based.hpp"
+#include "fuzz_cpp.hpp"
 #ifdef _OPENMP
 #include <omp.h>
 #endif /* _OPENMP */
 
 #if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
 #define CYTHON_WITHOUT_ASSERTIONS
 #endif
@@ -1285,15 +1285,15 @@
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm = __FILE__;
 static const char *__pyx_filename;
 
 /* #### Code section: filename_table ### */
 
 static const char *__pyx_f[] = {
-  "src/rapidfuzz/distance/DamerauLevenshtein_cpp.pyx",
+  "src/rapidfuzz/fuzz_cpp.pyx",
   "./src/rapidfuzz/cpp_common.pxd",
   "type.pxd",
 };
 /* #### Code section: utility_code_proto_before_types ### */
 /* NoFastGil.proto */
 #define __Pyx_PyGILState_Ensure PyGILState_Ensure
 #define __Pyx_PyGILState_Release PyGILState_Release
@@ -1307,14 +1307,54 @@
 #endif
 
 /* #### Code section: numeric_typedefs ### */
 /* #### Code section: complex_type_declarations ### */
 /* #### Code section: type_declarations ### */
 
 /*--- Type declarations ---*/
+struct __pyx_defaults;
+typedef struct __pyx_defaults __pyx_defaults;
+struct __pyx_defaults1;
+typedef struct __pyx_defaults1 __pyx_defaults1;
+struct __pyx_defaults2;
+typedef struct __pyx_defaults2 __pyx_defaults2;
+struct __pyx_defaults3;
+typedef struct __pyx_defaults3 __pyx_defaults3;
+struct __pyx_defaults4;
+typedef struct __pyx_defaults4 __pyx_defaults4;
+struct __pyx_defaults5;
+typedef struct __pyx_defaults5 __pyx_defaults5;
+struct __pyx_defaults6;
+typedef struct __pyx_defaults6 __pyx_defaults6;
+struct __pyx_defaults7;
+typedef struct __pyx_defaults7 __pyx_defaults7;
+struct __pyx_defaults {
+  PyObject *__pyx_arg_processor;
+};
+struct __pyx_defaults1 {
+  PyObject *__pyx_arg_processor;
+};
+struct __pyx_defaults2 {
+  PyObject *__pyx_arg_processor;
+};
+struct __pyx_defaults3 {
+  PyObject *__pyx_arg_processor;
+};
+struct __pyx_defaults4 {
+  PyObject *__pyx_arg_processor;
+};
+struct __pyx_defaults5 {
+  PyObject *__pyx_arg_processor;
+};
+struct __pyx_defaults6 {
+  PyObject *__pyx_arg_processor;
+};
+struct __pyx_defaults7 {
+  PyObject *__pyx_arg_processor;
+};
 /* #### Code section: utility_code_proto ### */
 
 /* --- Runtime support code (head) --- */
 /* Refnanny.proto */
 #ifndef CYTHON_REFNANNY
   #define CYTHON_REFNANNY 0
 #endif
@@ -1389,71 +1429,14 @@
 #define __Pyx_DECREF_SET(r, v) do {\
         PyObject *tmp = (PyObject *) r;\
         r = v; __Pyx_DECREF(tmp);\
     } while (0)
 #define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
 #define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)
 
-/* PyErrExceptionMatches.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
-#else
-#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
-#endif
-
-/* PyThreadStateGet.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
-#define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
-#define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
-#else
-#define __Pyx_PyThreadState_declare
-#define __Pyx_PyThreadState_assign
-#define __Pyx_PyErr_Occurred()  PyErr_Occurred()
-#endif
-
-/* PyErrFetchRestore.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_PyErr_Clear() __Pyx_ErrRestore(NULL, NULL, NULL)
-#define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
-#define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
-#define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
-#define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
-static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#if CYTHON_COMPILING_IN_CPYTHON
-#define __Pyx_PyErr_SetNone(exc) (Py_INCREF(exc), __Pyx_ErrRestore((exc), NULL, NULL))
-#else
-#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
-#endif
-#else
-#define __Pyx_PyErr_Clear() PyErr_Clear()
-#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
-#define __Pyx_ErrRestoreWithState(type, value, tb)  PyErr_Restore(type, value, tb)
-#define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
-#define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
-#define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
-#define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
-#define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
-#endif
-
-/* PyObjectGetAttrStr.proto */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
-#else
-#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
-#endif
-
-/* PyObjectGetAttrStrNoError.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
-
-/* GetBuiltinName.proto */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name);
-
 /* TupleAndListFromArray.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n);
 static CYTHON_INLINE PyObject* __Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n);
 #endif
 
 /* IncludeStringH.proto */
@@ -1501,14 +1484,50 @@
 
 /* ParseKeywords.proto */
 static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject *const *kwvalues,
     PyObject **argnames[],
     PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,
     const char* function_name);
 
+/* PyThreadStateGet.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
+#define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
+#define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
+#else
+#define __Pyx_PyThreadState_declare
+#define __Pyx_PyThreadState_assign
+#define __Pyx_PyErr_Occurred()  PyErr_Occurred()
+#endif
+
+/* PyErrFetchRestore.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_PyErr_Clear() __Pyx_ErrRestore(NULL, NULL, NULL)
+#define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
+#define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
+#define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
+#define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
+static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#if CYTHON_COMPILING_IN_CPYTHON
+#define __Pyx_PyErr_SetNone(exc) (Py_INCREF(exc), __Pyx_ErrRestore((exc), NULL, NULL))
+#else
+#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
+#endif
+#else
+#define __Pyx_PyErr_Clear() PyErr_Clear()
+#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
+#define __Pyx_ErrRestoreWithState(type, value, tb)  PyErr_Restore(type, value, tb)
+#define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
+#define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
+#define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
+#define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
+#define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
+#endif
+
 /* Profile.proto */
 #ifndef CYTHON_PROFILE
 #if CYTHON_COMPILING_IN_LIMITED_API || CYTHON_COMPILING_IN_PYPY
   #define CYTHON_PROFILE 0
 #else
   #define CYTHON_PROFILE 1
 #endif
@@ -1733,83 +1752,34 @@
       }\
   }
   #endif
 #else
   #define __Pyx_TraceLine(lineno, nogil, goto_error)   if ((1)); else goto_error;
 #endif
 
-/* PyObjectCall.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
-#else
-#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
-#endif
-
-/* RaiseException.proto */
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
-
-/* KeywordStringCheck.proto */
-static int __Pyx_CheckKeywordStrings(PyObject *kw, const char* function_name, int kw_allowed);
-
-/* GetItemInt.proto */
-#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
-    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
-               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
-#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
-    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
-                                                              int wraparound, int boundscheck);
-#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
-    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
-                                                              int wraparound, int boundscheck);
-static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
-                                                     int is_list, int wraparound, int boundscheck);
-
-/* GetTopmostException.proto */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
-#endif
-
-/* SaveResetException.proto */
+/* PyErrExceptionMatches.proto */
 #if CYTHON_FAST_THREAD_STATE
-#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
+#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
 #else
-#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
-#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
+#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
 #endif
 
-/* GetException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
-static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+/* PyObjectGetAttrStr.proto */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
 #else
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
+#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
 #endif
 
-/* SwapException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_ExceptionSwap(type, value, tb)  __Pyx__ExceptionSwap(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#else
-static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
-#endif
+/* PyObjectGetAttrStrNoError.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
-/* PyIntCompare.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);
+/* GetBuiltinName.proto */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name);
 
 /* PyDictVersioning.proto */
 #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
 #define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
 #define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
     (version_var) = __PYX_GET_DICT_VERSION(dict);\
@@ -1850,40 +1820,22 @@
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
-/* PyObjectFormatSimple.proto */
-#if CYTHON_COMPILING_IN_PYPY
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        PyObject_Format(s, f))
-#elif PY_MAJOR_VERSION < 3
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        likely(PyString_CheckExact(s)) ? PyUnicode_FromEncodedObject(s, NULL, "strict") :\
-        PyObject_Format(s, f))
-#elif CYTHON_USE_TYPE_SLOTS
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        likely(PyLong_CheckExact(s)) ? PyLong_Type.tp_repr(s) :\
-        likely(PyFloat_CheckExact(s)) ? PyFloat_Type.tp_repr(s) :\
-        PyObject_Format(s, f))
+/* MoveIfSupported.proto */
+#if __cplusplus >= 201103L || (defined(_MSC_VER) && _MSC_VER >= 1600)
+  #include <utility>
+  #define __PYX_STD_MOVE_IF_SUPPORTED(x) std::move(x)
 #else
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        PyObject_Format(s, f))
+  #define __PYX_STD_MOVE_IF_SUPPORTED(x) x
 #endif
 
-/* JoinPyUnicode.proto */
-static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
-                                      Py_UCS4 max_char);
-
 /* PyFunctionFastCall.proto */
 #if CYTHON_FAST_PYCALL
 #if !CYTHON_VECTORCALL
 #define __Pyx_PyFunction_FastCall(func, args, nargs)\
     __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
 static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs);
 #endif
@@ -1911,26 +1863,122 @@
      (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
   #define __Pyx_PyFrame_GetLocalsplus(frame)\
     (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
 #endif
 #endif
 #endif
 
+/* PyObjectCall.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
+#else
+#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
+#endif
+
 /* PyObjectCallMethO.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
 #endif
 
 /* PyObjectFastCall.proto */
 #define __Pyx_PyObject_FastCall(func, args, nargs)  __Pyx_PyObject_FastCallDict(func, args, (size_t)(nargs), NULL)
 static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs);
 
+/* KeywordStringCheck.proto */
+static int __Pyx_CheckKeywordStrings(PyObject *kw, const char* function_name, int kw_allowed);
+
+/* GetItemInt.proto */
+#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
+    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
+    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
+    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
+               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
+#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
+    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
+    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
+    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
+                                                              int wraparound, int boundscheck);
+#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
+    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
+    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
+    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
+                                                              int wraparound, int boundscheck);
+static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
+                                                     int is_list, int wraparound, int boundscheck);
+
+/* GetTopmostException.proto */
+#if CYTHON_USE_EXC_INFO_STACK
+static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
+#endif
+
+/* SaveResetException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
+#else
+#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
+#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
+#endif
+
+/* GetException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
+static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#else
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
+#endif
+
+/* SwapException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_ExceptionSwap(type, value, tb)  __Pyx__ExceptionSwap(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#else
+static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
+#endif
+
+/* PyIntCompare.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);
+
+/* PyObjectFormatSimple.proto */
+#if CYTHON_COMPILING_IN_PYPY
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        PyObject_Format(s, f))
+#elif PY_MAJOR_VERSION < 3
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        likely(PyString_CheckExact(s)) ? PyUnicode_FromEncodedObject(s, NULL, "strict") :\
+        PyObject_Format(s, f))
+#elif CYTHON_USE_TYPE_SLOTS
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        likely(PyLong_CheckExact(s)) ? PyLong_Type.tp_repr(s) :\
+        likely(PyFloat_CheckExact(s)) ? PyFloat_Type.tp_repr(s) :\
+        PyObject_Format(s, f))
+#else
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        PyObject_Format(s, f))
+#endif
+
+/* JoinPyUnicode.proto */
+static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
+                                      Py_UCS4 max_char);
+
 /* PyObjectCallOneArg.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
 
+/* RaiseException.proto */
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+
 /* GetAttr3.proto */
 static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *, PyObject *, PyObject *);
 
 /* py_dict_keys.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyDict_Keys(PyObject* d);
 
 /* UnpackUnboundCMethod.proto */
@@ -2154,19 +2202,14 @@
 static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);
 #endif
 
 /* AddTraceback.proto */
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename);
 
-/* GCCDiagnostics.proto */
-#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
-#define __Pyx_HAS_GCC_DIAGNOSTIC
-#endif
-
 /* CppExceptionConversion.proto */
 #ifndef __Pyx_CppExn2PyErr
 #include <new>
 #include <typeinfo>
 #include <stdexcept>
 #include <ios>
 static void __Pyx_CppExn2PyErr() {
@@ -2215,28 +2258,33 @@
 #else
   #define __PYX_ENUM_CLASS_DECL enum
 #endif
 
 /* UnicodeAsUCS4.proto */
 static CYTHON_INLINE Py_UCS4 __Pyx_PyUnicode_AsPy_UCS4(PyObject*);
 
+/* GCCDiagnostics.proto */
+#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
+#define __Pyx_HAS_GCC_DIAGNOSTIC
+#endif
+
+/* ObjectAsUCS4.proto */
+#define __Pyx_PyObject_AsPy_UCS4(x)\
+    (likely(PyUnicode_Check(x)) ? __Pyx_PyUnicode_AsPy_UCS4(x) : __Pyx__PyObject_AsPy_UCS4(x))
+static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject*);
+
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int64_t(int64_t value);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE int64_t __Pyx_PyInt_As_int64_t(PyObject *);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE uint64_t __Pyx_PyInt_As_uint64_t(PyObject *);
 
-/* ObjectAsUCS4.proto */
-#define __Pyx_PyObject_AsPy_UCS4(x)\
-    (likely(PyUnicode_Check(x)) ? __Pyx_PyUnicode_AsPy_UCS4(x) : __Pyx__PyObject_AsPy_UCS4(x))
-static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject*);
-
 /* FormatTypeName.proto */
 #if CYTHON_COMPILING_IN_LIMITED_API
 typedef PyObject *__Pyx_TypeName;
 #define __Pyx_FMT_TYPENAME "%U"
 static __Pyx_TypeName __Pyx_PyType_GetName(PyTypeObject* tp);
 #define __Pyx_DECREF_TypeName(obj) Py_XDECREF(obj)
 #else
@@ -2346,176 +2394,197 @@
 #endif
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_hash_array(PyObject *); /*proto*/
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_hash_sequence(PyObject *); /*proto*/
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_conv_sequence(PyObject *); /*proto*/
 static CYTHON_INLINE void __pyx_f_10cpp_common_preprocess_strings(PyObject *, PyObject *, PyObject *, RF_StringWrapper *, RF_StringWrapper *, PyObject *); /*proto*/
 static CYTHON_INLINE bool __pyx_f_10cpp_common_NoKwargsInit(RF_Kwargs *, PyObject *); /*proto*/
 static CYTHON_INLINE RF_Scorer __pyx_f_10cpp_common_CreateScorerContext(RF_KwargsInit, RF_GetScorerFlags, RF_ScorerFuncInit); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_10cpp_common_CreateScorerContextPy(PyObject *); /*proto*/
+static CYTHON_INLINE bool __pyx_f_10cpp_common_AddScorerContext(PyObject *, PyObject *, RF_Scorer *); /*proto*/
 
-/* Module declarations from "cpython.list" */
+/* Module declarations from "rapidfuzz.fuzz_cpp" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
-
-/* Module declarations from "cpython.ref" */
-#if !CYTHON_USE_MODULE_STATE
-#endif
-
-/* Module declarations from "rapidfuzz.distance.DamerauLevenshtein_cpp" */
-#if !CYTHON_USE_MODULE_STATE
-#endif
-static RF_Scorer __pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinDistanceContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinNormalizedDistanceContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinSimilarityContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinNormalizedSimilarityContext;
-static bool __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
-static bool __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinNormalizedDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
-static bool __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
-static bool __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static PyObject *__pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy = 0;
+static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_RatioContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_PartialRatioContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_TokenSortRatioContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_TokenSetRatioContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_TokenRatioContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSortRatioContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSetRatioContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenRatioContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_WRatioContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_QRatioContext;
+static bool __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
 /* #### Code section: typeinfo ### */
 /* #### Code section: before_global_var ### */
-#define __Pyx_MODULE_NAME "rapidfuzz.distance.DamerauLevenshtein_cpp"
-extern int __pyx_module_is_main_rapidfuzz__distance__DamerauLevenshtein_cpp;
-int __pyx_module_is_main_rapidfuzz__distance__DamerauLevenshtein_cpp = 0;
+#define __Pyx_MODULE_NAME "rapidfuzz.fuzz_cpp"
+extern int __pyx_module_is_main_rapidfuzz__fuzz_cpp;
+int __pyx_module_is_main_rapidfuzz__fuzz_cpp = 0;
 
-/* Implementation of "rapidfuzz.distance.DamerauLevenshtein_cpp" */
+/* Implementation of "rapidfuzz.fuzz_cpp" */
 /* #### Code section: global_var ### */
-static PyObject *__pyx_builtin_ValueError;
 static PyObject *__pyx_builtin_MemoryError;
 static PyObject *__pyx_builtin_range;
 static PyObject *__pyx_builtin_TypeError;
 /* #### Code section: string_decls ### */
 static const char __pyx_k_s1[] = "s1";
 static const char __pyx_k_s2[] = "s2";
-static const char __pyx_k__10[] = " - ";
-static const char __pyx_k__11[] = ", ";
-static const char __pyx_k__12[] = ".";
-static const char __pyx_k__15[] = "?";
+static const char __pyx_k__13[] = " - ";
+static const char __pyx_k__14[] = ", ";
+static const char __pyx_k__15[] = ".";
+static const char __pyx_k__19[] = "?";
+static const char __pyx_k_res[] = "res";
 static const char __pyx_k_keys[] = "keys";
 static const char __pyx_k_main[] = "__main__";
 static const char __pyx_k_name[] = "__name__";
 static const char __pyx_k_test[] = "__test__";
 static const char __pyx_k_array[] = "array";
 static const char __pyx_k_flags[] = "flags";
 static const char __pyx_k_range[] = "range";
+static const char __pyx_k_ratio[] = "ratio";
+static const char __pyx_k_QRatio[] = "QRatio";
+static const char __pyx_k_WRatio[] = "WRatio";
 static const char __pyx_k_import[] = "__import__";
 static const char __pyx_k_kwargs[] = "kwargs";
 static const char __pyx_k_s1_proc[] = "s1_proc";
 static const char __pyx_k_s2_proc[] = "s2_proc";
-static const char __pyx_k_distance[] = "distance";
 static const char __pyx_k_typecode[] = "typecode";
 static const char __pyx_k_RF_Scorer[] = "_RF_Scorer";
 static const char __pyx_k_TypeError[] = "TypeError";
 static const char __pyx_k_processor[] = "processor";
-static const char __pyx_k_ValueError[] = "ValueError";
-static const char __pyx_k_similarity[] = "similarity";
 static const char __pyx_k_MemoryError[] = "MemoryError";
 static const char __pyx_k_RF_ScorerPy[] = "_RF_ScorerPy";
+static const char __pyx_k_token_ratio[] = "token_ratio";
 static const char __pyx_k_worst_score[] = "worst_score";
 static const char __pyx_k_is_coroutine[] = "_is_coroutine";
 static const char __pyx_k_score_cutoff[] = "score_cutoff";
 static const char __pyx_k_RF_Preprocess[] = "_RF_Preprocess";
 static const char __pyx_k_optimal_score[] = "optimal_score";
+static const char __pyx_k_partial_ratio[] = "partial_ratio";
+static const char __pyx_k_ScoreAlignment[] = "ScoreAlignment";
 static const char __pyx_k_c_score_cutoff[] = "c_score_cutoff";
-static const char __pyx_k_distance_line_34[] = "distance (line 34)";
+static const char __pyx_k_default_process[] = "default_process";
+static const char __pyx_k_rapidfuzz_utils[] = "rapidfuzz.utils";
+static const char __pyx_k_token_set_ratio[] = "token_set_ratio";
 static const char __pyx_k_get_scorer_flags[] = "get_scorer_flags";
+static const char __pyx_k_token_sort_ratio[] = "token_sort_ratio";
 static const char __pyx_k_asyncio_coroutines[] = "asyncio.coroutines";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
-static const char __pyx_k_normalized_distance[] = "normalized_distance";
-static const char __pyx_k_normalized_similarity[] = "normalized_similarity";
-static const char __pyx_k_GetScorerFlagsDistance[] = "_GetScorerFlagsDistance";
+static const char __pyx_k_rapidfuzz_fuzz_cpp[] = "rapidfuzz.fuzz_cpp";
+static const char __pyx_k_partial_token_ratio[] = "partial_token_ratio";
+static const char __pyx_k_partial_ratio_alignment[] = "partial_ratio_alignment";
+static const char __pyx_k_partial_token_set_ratio[] = "partial_token_set_ratio";
 static const char __pyx_k_GetScorerFlagsSimilarity[] = "_GetScorerFlagsSimilarity";
-static const char __pyx_k_score_cutoff_has_to_be_0[] = "score_cutoff has to be >= 0";
-static const char __pyx_k_Calculates_the_minimum_number_o[] = "\n    Calculates the minimum number of insertions and deletions\n    required to change one sequence into the other. This is equivalent to the\n    Levenshtein distance with a substitution weight of 2.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : int, optional\n        Maximum distance between s1 and s2, that is\n        considered as a result. If the distance is bigger than score_cutoff,\n        score_cutoff + 1 is returned instead. Default is None, which deactivates\n        this behaviour.\n\n    Returns\n    -------\n    distance : int\n        distance between s1 and s2\n\n    Examples\n    --------\n    Find the Damerau Levenshtein distance between two strings:\n\n    >>> from rapidfuzz.distance import DamerauLevenshtein\n    >>> DamerauLevenshtein.distance(\"CA\", \"ABC\")\n    2\n    ";
-static const char __pyx_k_GetScorerFlagsNormalizedDistanc[] = "_GetScorerFlagsNormalizedDistance";
-static const char __pyx_k_GetScorerFlagsNormalizedSimilar[] = "_GetScorerFlagsNormalizedSimilarity";
+static const char __pyx_k_distance__initialize_cpp[] = "distance._initialize_cpp";
+static const char __pyx_k_partial_token_sort_ratio[] = "partial_token_sort_ratio";
+static const char __pyx_k_src_rapidfuzz_fuzz_cpp_pyx[] = "src/rapidfuzz/fuzz_cpp.pyx";
 static const char __pyx_k_Got_unexpected_keyword_arguments[] = "Got unexpected keyword arguments: ";
-static const char __pyx_k_rapidfuzz_distance_DamerauLevens[] = "rapidfuzz.distance.DamerauLevenshtein_cpp";
 static const char __pyx_k_score_cutoff_has_to_be_in_the_ra[] = "score_cutoff has to be in the range of ";
-static const char __pyx_k_src_rapidfuzz_distance_DamerauLe[] = "src/rapidfuzz/distance/DamerauLevenshtein_cpp.pyx";
 #if !CYTHON_USE_MODULE_STATE
-static PyObject *__pyx_kp_u_Calculates_the_minimum_number_o;
-static PyObject *__pyx_n_s_GetScorerFlagsDistance;
-static PyObject *__pyx_n_s_GetScorerFlagsNormalizedDistanc;
-static PyObject *__pyx_n_s_GetScorerFlagsNormalizedSimilar;
 static PyObject *__pyx_n_s_GetScorerFlagsSimilarity;
 static PyObject *__pyx_kp_u_Got_unexpected_keyword_arguments;
 static PyObject *__pyx_n_s_MemoryError;
+static PyObject *__pyx_n_s_QRatio;
 static PyObject *__pyx_n_u_RF_Preprocess;
 static PyObject *__pyx_n_s_RF_Scorer;
 static PyObject *__pyx_n_s_RF_ScorerPy;
+static PyObject *__pyx_n_s_ScoreAlignment;
 static PyObject *__pyx_n_s_TypeError;
-static PyObject *__pyx_n_s_ValueError;
-static PyObject *__pyx_kp_u__10;
-static PyObject *__pyx_kp_u__11;
-static PyObject *__pyx_kp_u__12;
-static PyObject *__pyx_n_s__15;
+static PyObject *__pyx_n_s_WRatio;
+static PyObject *__pyx_kp_u__13;
+static PyObject *__pyx_kp_u__14;
+static PyObject *__pyx_kp_u__15;
+static PyObject *__pyx_n_s__19;
 static PyObject *__pyx_n_s_array;
 static PyObject *__pyx_n_s_asyncio_coroutines;
 static PyObject *__pyx_n_s_c_score_cutoff;
 static PyObject *__pyx_n_s_cline_in_traceback;
-static PyObject *__pyx_n_s_distance;
-static PyObject *__pyx_kp_u_distance_line_34;
+static PyObject *__pyx_n_s_default_process;
+static PyObject *__pyx_n_s_distance__initialize_cpp;
 static PyObject *__pyx_n_u_flags;
 static PyObject *__pyx_n_u_get_scorer_flags;
 static PyObject *__pyx_n_s_import;
 static PyObject *__pyx_n_s_is_coroutine;
 static PyObject *__pyx_n_s_keys;
 static PyObject *__pyx_n_s_kwargs;
 static PyObject *__pyx_n_s_main;
 static PyObject *__pyx_n_s_name;
-static PyObject *__pyx_n_s_normalized_distance;
-static PyObject *__pyx_n_s_normalized_similarity;
 static PyObject *__pyx_n_u_optimal_score;
+static PyObject *__pyx_n_s_partial_ratio;
+static PyObject *__pyx_n_s_partial_ratio_alignment;
+static PyObject *__pyx_n_s_partial_token_ratio;
+static PyObject *__pyx_n_s_partial_token_set_ratio;
+static PyObject *__pyx_n_s_partial_token_sort_ratio;
 static PyObject *__pyx_n_s_processor;
 static PyObject *__pyx_n_s_range;
-static PyObject *__pyx_n_s_rapidfuzz_distance_DamerauLevens;
+static PyObject *__pyx_n_s_rapidfuzz_fuzz_cpp;
+static PyObject *__pyx_n_s_rapidfuzz_utils;
+static PyObject *__pyx_n_s_ratio;
+static PyObject *__pyx_n_s_res;
 static PyObject *__pyx_n_s_s1;
 static PyObject *__pyx_n_s_s1_proc;
 static PyObject *__pyx_n_s_s2;
 static PyObject *__pyx_n_s_s2_proc;
 static PyObject *__pyx_n_s_score_cutoff;
-static PyObject *__pyx_kp_u_score_cutoff_has_to_be_0;
 static PyObject *__pyx_kp_u_score_cutoff_has_to_be_in_the_ra;
-static PyObject *__pyx_n_s_similarity;
-static PyObject *__pyx_kp_s_src_rapidfuzz_distance_DamerauLe;
+static PyObject *__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx;
 static PyObject *__pyx_n_s_test;
+static PyObject *__pyx_n_s_token_ratio;
+static PyObject *__pyx_n_s_token_set_ratio;
+static PyObject *__pyx_n_s_token_sort_ratio;
 static PyObject *__pyx_n_s_typecode;
 static PyObject *__pyx_n_u_worst_score;
 #endif
 /* #### Code section: decls ### */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_2similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_4normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_6normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_8_GetScorerFlagsDistance(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_10_GetScorerFlagsSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_12_GetScorerFlagsNormalizedDistance(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_14_GetScorerFlagsNormalizedSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_2partial_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_4partial_ratio_alignment(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_24__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_6token_sort_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_26__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_8token_set_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_28__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_10token_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_30__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_12partial_token_sort_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_32__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_14partial_token_set_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_34__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_16partial_token_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_36__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_18WRatio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_38__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_20QRatio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_22_GetScorerFlagsSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs); /* proto */
 static __Pyx_CachedCFunction __pyx_umethod_PyDict_Type_keys = {0, 0, 0, 0, 0};
 #if !CYTHON_USE_MODULE_STATE
-static PyObject *__pyx_float_0_0;
 static PyObject *__pyx_int_0;
-static PyObject *__pyx_int_1;
 static PyObject *__pyx_int_32;
-static PyObject *__pyx_int_64;
-static PyObject *__pyx_int_9223372036854775807;
+static PyObject *__pyx_int_100;
 static PyObject *__pyx_int_neg_1;
 #endif
 #if !CYTHON_USE_MODULE_STATE
 static PyObject *__pyx_codeobj_;
-static PyObject *__pyx_tuple__2;
-static PyObject *__pyx_tuple__13;
-static PyObject *__pyx_tuple__14;
+static PyObject *__pyx_tuple__16;
+static PyObject *__pyx_tuple__17;
+static PyObject *__pyx_tuple__18;
+static PyObject *__pyx_codeobj__2;
 static PyObject *__pyx_codeobj__3;
 static PyObject *__pyx_codeobj__4;
 static PyObject *__pyx_codeobj__5;
 static PyObject *__pyx_codeobj__6;
 static PyObject *__pyx_codeobj__7;
 static PyObject *__pyx_codeobj__8;
 static PyObject *__pyx_codeobj__9;
+static PyObject *__pyx_codeobj__10;
+static PyObject *__pyx_codeobj__11;
+static PyObject *__pyx_codeobj__12;
 #endif
 /* #### Code section: late_includes ### */
 /* #### Code section: module_state ### */
 #if CYTHON_USE_MODULE_STATE
 typedef struct {
   PyObject *__pyx_d;
   PyObject *__pyx_b;
@@ -2526,80 +2595,86 @@
   #ifdef __Pyx_CyFunction_USED
   PyTypeObject *__pyx_CyFunctionType;
   #endif
   #ifdef __Pyx_FusedFunction_USED
   PyTypeObject *__pyx_FusedFunctionType;
   #endif
   PyTypeObject *__pyx_ptype_7cpython_4type_type;
-  PyObject *__pyx_kp_u_Calculates_the_minimum_number_o;
-  PyObject *__pyx_n_s_GetScorerFlagsDistance;
-  PyObject *__pyx_n_s_GetScorerFlagsNormalizedDistanc;
-  PyObject *__pyx_n_s_GetScorerFlagsNormalizedSimilar;
   PyObject *__pyx_n_s_GetScorerFlagsSimilarity;
   PyObject *__pyx_kp_u_Got_unexpected_keyword_arguments;
   PyObject *__pyx_n_s_MemoryError;
+  PyObject *__pyx_n_s_QRatio;
   PyObject *__pyx_n_u_RF_Preprocess;
   PyObject *__pyx_n_s_RF_Scorer;
   PyObject *__pyx_n_s_RF_ScorerPy;
+  PyObject *__pyx_n_s_ScoreAlignment;
   PyObject *__pyx_n_s_TypeError;
-  PyObject *__pyx_n_s_ValueError;
-  PyObject *__pyx_kp_u__10;
-  PyObject *__pyx_kp_u__11;
-  PyObject *__pyx_kp_u__12;
-  PyObject *__pyx_n_s__15;
+  PyObject *__pyx_n_s_WRatio;
+  PyObject *__pyx_kp_u__13;
+  PyObject *__pyx_kp_u__14;
+  PyObject *__pyx_kp_u__15;
+  PyObject *__pyx_n_s__19;
   PyObject *__pyx_n_s_array;
   PyObject *__pyx_n_s_asyncio_coroutines;
   PyObject *__pyx_n_s_c_score_cutoff;
   PyObject *__pyx_n_s_cline_in_traceback;
-  PyObject *__pyx_n_s_distance;
-  PyObject *__pyx_kp_u_distance_line_34;
+  PyObject *__pyx_n_s_default_process;
+  PyObject *__pyx_n_s_distance__initialize_cpp;
   PyObject *__pyx_n_u_flags;
   PyObject *__pyx_n_u_get_scorer_flags;
   PyObject *__pyx_n_s_import;
   PyObject *__pyx_n_s_is_coroutine;
   PyObject *__pyx_n_s_keys;
   PyObject *__pyx_n_s_kwargs;
   PyObject *__pyx_n_s_main;
   PyObject *__pyx_n_s_name;
-  PyObject *__pyx_n_s_normalized_distance;
-  PyObject *__pyx_n_s_normalized_similarity;
   PyObject *__pyx_n_u_optimal_score;
+  PyObject *__pyx_n_s_partial_ratio;
+  PyObject *__pyx_n_s_partial_ratio_alignment;
+  PyObject *__pyx_n_s_partial_token_ratio;
+  PyObject *__pyx_n_s_partial_token_set_ratio;
+  PyObject *__pyx_n_s_partial_token_sort_ratio;
   PyObject *__pyx_n_s_processor;
   PyObject *__pyx_n_s_range;
-  PyObject *__pyx_n_s_rapidfuzz_distance_DamerauLevens;
+  PyObject *__pyx_n_s_rapidfuzz_fuzz_cpp;
+  PyObject *__pyx_n_s_rapidfuzz_utils;
+  PyObject *__pyx_n_s_ratio;
+  PyObject *__pyx_n_s_res;
   PyObject *__pyx_n_s_s1;
   PyObject *__pyx_n_s_s1_proc;
   PyObject *__pyx_n_s_s2;
   PyObject *__pyx_n_s_s2_proc;
   PyObject *__pyx_n_s_score_cutoff;
-  PyObject *__pyx_kp_u_score_cutoff_has_to_be_0;
   PyObject *__pyx_kp_u_score_cutoff_has_to_be_in_the_ra;
-  PyObject *__pyx_n_s_similarity;
-  PyObject *__pyx_kp_s_src_rapidfuzz_distance_DamerauLe;
+  PyObject *__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx;
   PyObject *__pyx_n_s_test;
+  PyObject *__pyx_n_s_token_ratio;
+  PyObject *__pyx_n_s_token_set_ratio;
+  PyObject *__pyx_n_s_token_sort_ratio;
   PyObject *__pyx_n_s_typecode;
   PyObject *__pyx_n_u_worst_score;
-  PyObject *__pyx_float_0_0;
   PyObject *__pyx_int_0;
-  PyObject *__pyx_int_1;
   PyObject *__pyx_int_32;
-  PyObject *__pyx_int_64;
-  PyObject *__pyx_int_9223372036854775807;
+  PyObject *__pyx_int_100;
   PyObject *__pyx_int_neg_1;
   PyObject *__pyx_codeobj_;
-  PyObject *__pyx_tuple__2;
-  PyObject *__pyx_tuple__13;
-  PyObject *__pyx_tuple__14;
+  PyObject *__pyx_tuple__16;
+  PyObject *__pyx_tuple__17;
+  PyObject *__pyx_tuple__18;
+  PyObject *__pyx_codeobj__2;
   PyObject *__pyx_codeobj__3;
   PyObject *__pyx_codeobj__4;
   PyObject *__pyx_codeobj__5;
   PyObject *__pyx_codeobj__6;
   PyObject *__pyx_codeobj__7;
   PyObject *__pyx_codeobj__8;
   PyObject *__pyx_codeobj__9;
+  PyObject *__pyx_codeobj__10;
+  PyObject *__pyx_codeobj__11;
+  PyObject *__pyx_codeobj__12;
 } __pyx_mstate;
 
 #ifdef __cplusplus
 namespace {
   extern struct PyModuleDef __pyx_moduledef;
 } /* anonymous namespace */
 #else
@@ -2626,80 +2701,86 @@
   #ifdef __Pyx_CyFunction_USED
   Py_CLEAR(clear_module_state->__pyx_CyFunctionType);
   #endif
   #ifdef __Pyx_FusedFunction_USED
   Py_CLEAR(clear_module_state->__pyx_FusedFunctionType);
   #endif
   Py_CLEAR(clear_module_state->__pyx_ptype_7cpython_4type_type);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculates_the_minimum_number_o);
-  Py_CLEAR(clear_module_state->__pyx_n_s_GetScorerFlagsDistance);
-  Py_CLEAR(clear_module_state->__pyx_n_s_GetScorerFlagsNormalizedDistanc);
-  Py_CLEAR(clear_module_state->__pyx_n_s_GetScorerFlagsNormalizedSimilar);
   Py_CLEAR(clear_module_state->__pyx_n_s_GetScorerFlagsSimilarity);
   Py_CLEAR(clear_module_state->__pyx_kp_u_Got_unexpected_keyword_arguments);
   Py_CLEAR(clear_module_state->__pyx_n_s_MemoryError);
+  Py_CLEAR(clear_module_state->__pyx_n_s_QRatio);
   Py_CLEAR(clear_module_state->__pyx_n_u_RF_Preprocess);
   Py_CLEAR(clear_module_state->__pyx_n_s_RF_Scorer);
   Py_CLEAR(clear_module_state->__pyx_n_s_RF_ScorerPy);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ScoreAlignment);
   Py_CLEAR(clear_module_state->__pyx_n_s_TypeError);
-  Py_CLEAR(clear_module_state->__pyx_n_s_ValueError);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__10);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__11);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__12);
-  Py_CLEAR(clear_module_state->__pyx_n_s__15);
+  Py_CLEAR(clear_module_state->__pyx_n_s_WRatio);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__13);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__14);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__15);
+  Py_CLEAR(clear_module_state->__pyx_n_s__19);
   Py_CLEAR(clear_module_state->__pyx_n_s_array);
   Py_CLEAR(clear_module_state->__pyx_n_s_asyncio_coroutines);
   Py_CLEAR(clear_module_state->__pyx_n_s_c_score_cutoff);
   Py_CLEAR(clear_module_state->__pyx_n_s_cline_in_traceback);
-  Py_CLEAR(clear_module_state->__pyx_n_s_distance);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_distance_line_34);
+  Py_CLEAR(clear_module_state->__pyx_n_s_default_process);
+  Py_CLEAR(clear_module_state->__pyx_n_s_distance__initialize_cpp);
   Py_CLEAR(clear_module_state->__pyx_n_u_flags);
   Py_CLEAR(clear_module_state->__pyx_n_u_get_scorer_flags);
   Py_CLEAR(clear_module_state->__pyx_n_s_import);
   Py_CLEAR(clear_module_state->__pyx_n_s_is_coroutine);
   Py_CLEAR(clear_module_state->__pyx_n_s_keys);
   Py_CLEAR(clear_module_state->__pyx_n_s_kwargs);
   Py_CLEAR(clear_module_state->__pyx_n_s_main);
   Py_CLEAR(clear_module_state->__pyx_n_s_name);
-  Py_CLEAR(clear_module_state->__pyx_n_s_normalized_distance);
-  Py_CLEAR(clear_module_state->__pyx_n_s_normalized_similarity);
   Py_CLEAR(clear_module_state->__pyx_n_u_optimal_score);
+  Py_CLEAR(clear_module_state->__pyx_n_s_partial_ratio);
+  Py_CLEAR(clear_module_state->__pyx_n_s_partial_ratio_alignment);
+  Py_CLEAR(clear_module_state->__pyx_n_s_partial_token_ratio);
+  Py_CLEAR(clear_module_state->__pyx_n_s_partial_token_set_ratio);
+  Py_CLEAR(clear_module_state->__pyx_n_s_partial_token_sort_ratio);
   Py_CLEAR(clear_module_state->__pyx_n_s_processor);
   Py_CLEAR(clear_module_state->__pyx_n_s_range);
-  Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_distance_DamerauLevens);
+  Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_fuzz_cpp);
+  Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_utils);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ratio);
+  Py_CLEAR(clear_module_state->__pyx_n_s_res);
   Py_CLEAR(clear_module_state->__pyx_n_s_s1);
   Py_CLEAR(clear_module_state->__pyx_n_s_s1_proc);
   Py_CLEAR(clear_module_state->__pyx_n_s_s2);
   Py_CLEAR(clear_module_state->__pyx_n_s_s2_proc);
   Py_CLEAR(clear_module_state->__pyx_n_s_score_cutoff);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_score_cutoff_has_to_be_0);
   Py_CLEAR(clear_module_state->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
-  Py_CLEAR(clear_module_state->__pyx_n_s_similarity);
-  Py_CLEAR(clear_module_state->__pyx_kp_s_src_rapidfuzz_distance_DamerauLe);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx);
   Py_CLEAR(clear_module_state->__pyx_n_s_test);
+  Py_CLEAR(clear_module_state->__pyx_n_s_token_ratio);
+  Py_CLEAR(clear_module_state->__pyx_n_s_token_set_ratio);
+  Py_CLEAR(clear_module_state->__pyx_n_s_token_sort_ratio);
   Py_CLEAR(clear_module_state->__pyx_n_s_typecode);
   Py_CLEAR(clear_module_state->__pyx_n_u_worst_score);
-  Py_CLEAR(clear_module_state->__pyx_float_0_0);
   Py_CLEAR(clear_module_state->__pyx_int_0);
-  Py_CLEAR(clear_module_state->__pyx_int_1);
   Py_CLEAR(clear_module_state->__pyx_int_32);
-  Py_CLEAR(clear_module_state->__pyx_int_64);
-  Py_CLEAR(clear_module_state->__pyx_int_9223372036854775807);
+  Py_CLEAR(clear_module_state->__pyx_int_100);
   Py_CLEAR(clear_module_state->__pyx_int_neg_1);
   Py_CLEAR(clear_module_state->__pyx_codeobj_);
-  Py_CLEAR(clear_module_state->__pyx_tuple__2);
-  Py_CLEAR(clear_module_state->__pyx_tuple__13);
-  Py_CLEAR(clear_module_state->__pyx_tuple__14);
+  Py_CLEAR(clear_module_state->__pyx_tuple__16);
+  Py_CLEAR(clear_module_state->__pyx_tuple__17);
+  Py_CLEAR(clear_module_state->__pyx_tuple__18);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__2);
   Py_CLEAR(clear_module_state->__pyx_codeobj__3);
   Py_CLEAR(clear_module_state->__pyx_codeobj__4);
   Py_CLEAR(clear_module_state->__pyx_codeobj__5);
   Py_CLEAR(clear_module_state->__pyx_codeobj__6);
   Py_CLEAR(clear_module_state->__pyx_codeobj__7);
   Py_CLEAR(clear_module_state->__pyx_codeobj__8);
   Py_CLEAR(clear_module_state->__pyx_codeobj__9);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__10);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__11);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__12);
   return 0;
 }
 #endif
 /* #### Code section: module_state_traverse ### */
 #if CYTHON_USE_MODULE_STATE
 static int __pyx_m_traverse(PyObject *m, visitproc visit, void *arg) {
   __pyx_mstate *traverse_module_state = __pyx_mstate(m);
@@ -2713,80 +2794,86 @@
   #ifdef __Pyx_CyFunction_USED
   Py_VISIT(traverse_module_state->__pyx_CyFunctionType);
   #endif
   #ifdef __Pyx_FusedFunction_USED
   Py_VISIT(traverse_module_state->__pyx_FusedFunctionType);
   #endif
   Py_VISIT(traverse_module_state->__pyx_ptype_7cpython_4type_type);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculates_the_minimum_number_o);
-  Py_VISIT(traverse_module_state->__pyx_n_s_GetScorerFlagsDistance);
-  Py_VISIT(traverse_module_state->__pyx_n_s_GetScorerFlagsNormalizedDistanc);
-  Py_VISIT(traverse_module_state->__pyx_n_s_GetScorerFlagsNormalizedSimilar);
   Py_VISIT(traverse_module_state->__pyx_n_s_GetScorerFlagsSimilarity);
   Py_VISIT(traverse_module_state->__pyx_kp_u_Got_unexpected_keyword_arguments);
   Py_VISIT(traverse_module_state->__pyx_n_s_MemoryError);
+  Py_VISIT(traverse_module_state->__pyx_n_s_QRatio);
   Py_VISIT(traverse_module_state->__pyx_n_u_RF_Preprocess);
   Py_VISIT(traverse_module_state->__pyx_n_s_RF_Scorer);
   Py_VISIT(traverse_module_state->__pyx_n_s_RF_ScorerPy);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ScoreAlignment);
   Py_VISIT(traverse_module_state->__pyx_n_s_TypeError);
-  Py_VISIT(traverse_module_state->__pyx_n_s_ValueError);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__10);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__11);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__12);
-  Py_VISIT(traverse_module_state->__pyx_n_s__15);
+  Py_VISIT(traverse_module_state->__pyx_n_s_WRatio);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__13);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__14);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__15);
+  Py_VISIT(traverse_module_state->__pyx_n_s__19);
   Py_VISIT(traverse_module_state->__pyx_n_s_array);
   Py_VISIT(traverse_module_state->__pyx_n_s_asyncio_coroutines);
   Py_VISIT(traverse_module_state->__pyx_n_s_c_score_cutoff);
   Py_VISIT(traverse_module_state->__pyx_n_s_cline_in_traceback);
-  Py_VISIT(traverse_module_state->__pyx_n_s_distance);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_distance_line_34);
+  Py_VISIT(traverse_module_state->__pyx_n_s_default_process);
+  Py_VISIT(traverse_module_state->__pyx_n_s_distance__initialize_cpp);
   Py_VISIT(traverse_module_state->__pyx_n_u_flags);
   Py_VISIT(traverse_module_state->__pyx_n_u_get_scorer_flags);
   Py_VISIT(traverse_module_state->__pyx_n_s_import);
   Py_VISIT(traverse_module_state->__pyx_n_s_is_coroutine);
   Py_VISIT(traverse_module_state->__pyx_n_s_keys);
   Py_VISIT(traverse_module_state->__pyx_n_s_kwargs);
   Py_VISIT(traverse_module_state->__pyx_n_s_main);
   Py_VISIT(traverse_module_state->__pyx_n_s_name);
-  Py_VISIT(traverse_module_state->__pyx_n_s_normalized_distance);
-  Py_VISIT(traverse_module_state->__pyx_n_s_normalized_similarity);
   Py_VISIT(traverse_module_state->__pyx_n_u_optimal_score);
+  Py_VISIT(traverse_module_state->__pyx_n_s_partial_ratio);
+  Py_VISIT(traverse_module_state->__pyx_n_s_partial_ratio_alignment);
+  Py_VISIT(traverse_module_state->__pyx_n_s_partial_token_ratio);
+  Py_VISIT(traverse_module_state->__pyx_n_s_partial_token_set_ratio);
+  Py_VISIT(traverse_module_state->__pyx_n_s_partial_token_sort_ratio);
   Py_VISIT(traverse_module_state->__pyx_n_s_processor);
   Py_VISIT(traverse_module_state->__pyx_n_s_range);
-  Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_distance_DamerauLevens);
+  Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_fuzz_cpp);
+  Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_utils);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ratio);
+  Py_VISIT(traverse_module_state->__pyx_n_s_res);
   Py_VISIT(traverse_module_state->__pyx_n_s_s1);
   Py_VISIT(traverse_module_state->__pyx_n_s_s1_proc);
   Py_VISIT(traverse_module_state->__pyx_n_s_s2);
   Py_VISIT(traverse_module_state->__pyx_n_s_s2_proc);
   Py_VISIT(traverse_module_state->__pyx_n_s_score_cutoff);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_score_cutoff_has_to_be_0);
   Py_VISIT(traverse_module_state->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
-  Py_VISIT(traverse_module_state->__pyx_n_s_similarity);
-  Py_VISIT(traverse_module_state->__pyx_kp_s_src_rapidfuzz_distance_DamerauLe);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx);
   Py_VISIT(traverse_module_state->__pyx_n_s_test);
+  Py_VISIT(traverse_module_state->__pyx_n_s_token_ratio);
+  Py_VISIT(traverse_module_state->__pyx_n_s_token_set_ratio);
+  Py_VISIT(traverse_module_state->__pyx_n_s_token_sort_ratio);
   Py_VISIT(traverse_module_state->__pyx_n_s_typecode);
   Py_VISIT(traverse_module_state->__pyx_n_u_worst_score);
-  Py_VISIT(traverse_module_state->__pyx_float_0_0);
   Py_VISIT(traverse_module_state->__pyx_int_0);
-  Py_VISIT(traverse_module_state->__pyx_int_1);
   Py_VISIT(traverse_module_state->__pyx_int_32);
-  Py_VISIT(traverse_module_state->__pyx_int_64);
-  Py_VISIT(traverse_module_state->__pyx_int_9223372036854775807);
+  Py_VISIT(traverse_module_state->__pyx_int_100);
   Py_VISIT(traverse_module_state->__pyx_int_neg_1);
   Py_VISIT(traverse_module_state->__pyx_codeobj_);
-  Py_VISIT(traverse_module_state->__pyx_tuple__2);
-  Py_VISIT(traverse_module_state->__pyx_tuple__13);
-  Py_VISIT(traverse_module_state->__pyx_tuple__14);
+  Py_VISIT(traverse_module_state->__pyx_tuple__16);
+  Py_VISIT(traverse_module_state->__pyx_tuple__17);
+  Py_VISIT(traverse_module_state->__pyx_tuple__18);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__2);
   Py_VISIT(traverse_module_state->__pyx_codeobj__3);
   Py_VISIT(traverse_module_state->__pyx_codeobj__4);
   Py_VISIT(traverse_module_state->__pyx_codeobj__5);
   Py_VISIT(traverse_module_state->__pyx_codeobj__6);
   Py_VISIT(traverse_module_state->__pyx_codeobj__7);
   Py_VISIT(traverse_module_state->__pyx_codeobj__8);
   Py_VISIT(traverse_module_state->__pyx_codeobj__9);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__10);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__11);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__12);
   return 0;
 }
 #endif
 /* #### Code section: module_state_defines ### */
 #if CYTHON_USE_MODULE_STATE
 #define __pyx_d __pyx_mstate_global->__pyx_d
 #define __pyx_b __pyx_mstate_global->__pyx_b
@@ -2797,102 +2884,107 @@
 #ifdef __Pyx_CyFunction_USED
 #define __pyx_CyFunctionType __pyx_mstate_global->__pyx_CyFunctionType
 #endif
 #ifdef __Pyx_FusedFunction_USED
 #define __pyx_FusedFunctionType __pyx_mstate_global->__pyx_FusedFunctionType
 #endif
 #define __pyx_ptype_7cpython_4type_type __pyx_mstate_global->__pyx_ptype_7cpython_4type_type
-#define __pyx_kp_u_Calculates_the_minimum_number_o __pyx_mstate_global->__pyx_kp_u_Calculates_the_minimum_number_o
-#define __pyx_n_s_GetScorerFlagsDistance __pyx_mstate_global->__pyx_n_s_GetScorerFlagsDistance
-#define __pyx_n_s_GetScorerFlagsNormalizedDistanc __pyx_mstate_global->__pyx_n_s_GetScorerFlagsNormalizedDistanc
-#define __pyx_n_s_GetScorerFlagsNormalizedSimilar __pyx_mstate_global->__pyx_n_s_GetScorerFlagsNormalizedSimilar
 #define __pyx_n_s_GetScorerFlagsSimilarity __pyx_mstate_global->__pyx_n_s_GetScorerFlagsSimilarity
 #define __pyx_kp_u_Got_unexpected_keyword_arguments __pyx_mstate_global->__pyx_kp_u_Got_unexpected_keyword_arguments
 #define __pyx_n_s_MemoryError __pyx_mstate_global->__pyx_n_s_MemoryError
+#define __pyx_n_s_QRatio __pyx_mstate_global->__pyx_n_s_QRatio
 #define __pyx_n_u_RF_Preprocess __pyx_mstate_global->__pyx_n_u_RF_Preprocess
 #define __pyx_n_s_RF_Scorer __pyx_mstate_global->__pyx_n_s_RF_Scorer
 #define __pyx_n_s_RF_ScorerPy __pyx_mstate_global->__pyx_n_s_RF_ScorerPy
+#define __pyx_n_s_ScoreAlignment __pyx_mstate_global->__pyx_n_s_ScoreAlignment
 #define __pyx_n_s_TypeError __pyx_mstate_global->__pyx_n_s_TypeError
-#define __pyx_n_s_ValueError __pyx_mstate_global->__pyx_n_s_ValueError
-#define __pyx_kp_u__10 __pyx_mstate_global->__pyx_kp_u__10
-#define __pyx_kp_u__11 __pyx_mstate_global->__pyx_kp_u__11
-#define __pyx_kp_u__12 __pyx_mstate_global->__pyx_kp_u__12
-#define __pyx_n_s__15 __pyx_mstate_global->__pyx_n_s__15
+#define __pyx_n_s_WRatio __pyx_mstate_global->__pyx_n_s_WRatio
+#define __pyx_kp_u__13 __pyx_mstate_global->__pyx_kp_u__13
+#define __pyx_kp_u__14 __pyx_mstate_global->__pyx_kp_u__14
+#define __pyx_kp_u__15 __pyx_mstate_global->__pyx_kp_u__15
+#define __pyx_n_s__19 __pyx_mstate_global->__pyx_n_s__19
 #define __pyx_n_s_array __pyx_mstate_global->__pyx_n_s_array
 #define __pyx_n_s_asyncio_coroutines __pyx_mstate_global->__pyx_n_s_asyncio_coroutines
 #define __pyx_n_s_c_score_cutoff __pyx_mstate_global->__pyx_n_s_c_score_cutoff
 #define __pyx_n_s_cline_in_traceback __pyx_mstate_global->__pyx_n_s_cline_in_traceback
-#define __pyx_n_s_distance __pyx_mstate_global->__pyx_n_s_distance
-#define __pyx_kp_u_distance_line_34 __pyx_mstate_global->__pyx_kp_u_distance_line_34
+#define __pyx_n_s_default_process __pyx_mstate_global->__pyx_n_s_default_process
+#define __pyx_n_s_distance__initialize_cpp __pyx_mstate_global->__pyx_n_s_distance__initialize_cpp
 #define __pyx_n_u_flags __pyx_mstate_global->__pyx_n_u_flags
 #define __pyx_n_u_get_scorer_flags __pyx_mstate_global->__pyx_n_u_get_scorer_flags
 #define __pyx_n_s_import __pyx_mstate_global->__pyx_n_s_import
 #define __pyx_n_s_is_coroutine __pyx_mstate_global->__pyx_n_s_is_coroutine
 #define __pyx_n_s_keys __pyx_mstate_global->__pyx_n_s_keys
 #define __pyx_n_s_kwargs __pyx_mstate_global->__pyx_n_s_kwargs
 #define __pyx_n_s_main __pyx_mstate_global->__pyx_n_s_main
 #define __pyx_n_s_name __pyx_mstate_global->__pyx_n_s_name
-#define __pyx_n_s_normalized_distance __pyx_mstate_global->__pyx_n_s_normalized_distance
-#define __pyx_n_s_normalized_similarity __pyx_mstate_global->__pyx_n_s_normalized_similarity
 #define __pyx_n_u_optimal_score __pyx_mstate_global->__pyx_n_u_optimal_score
+#define __pyx_n_s_partial_ratio __pyx_mstate_global->__pyx_n_s_partial_ratio
+#define __pyx_n_s_partial_ratio_alignment __pyx_mstate_global->__pyx_n_s_partial_ratio_alignment
+#define __pyx_n_s_partial_token_ratio __pyx_mstate_global->__pyx_n_s_partial_token_ratio
+#define __pyx_n_s_partial_token_set_ratio __pyx_mstate_global->__pyx_n_s_partial_token_set_ratio
+#define __pyx_n_s_partial_token_sort_ratio __pyx_mstate_global->__pyx_n_s_partial_token_sort_ratio
 #define __pyx_n_s_processor __pyx_mstate_global->__pyx_n_s_processor
 #define __pyx_n_s_range __pyx_mstate_global->__pyx_n_s_range
-#define __pyx_n_s_rapidfuzz_distance_DamerauLevens __pyx_mstate_global->__pyx_n_s_rapidfuzz_distance_DamerauLevens
+#define __pyx_n_s_rapidfuzz_fuzz_cpp __pyx_mstate_global->__pyx_n_s_rapidfuzz_fuzz_cpp
+#define __pyx_n_s_rapidfuzz_utils __pyx_mstate_global->__pyx_n_s_rapidfuzz_utils
+#define __pyx_n_s_ratio __pyx_mstate_global->__pyx_n_s_ratio
+#define __pyx_n_s_res __pyx_mstate_global->__pyx_n_s_res
 #define __pyx_n_s_s1 __pyx_mstate_global->__pyx_n_s_s1
 #define __pyx_n_s_s1_proc __pyx_mstate_global->__pyx_n_s_s1_proc
 #define __pyx_n_s_s2 __pyx_mstate_global->__pyx_n_s_s2
 #define __pyx_n_s_s2_proc __pyx_mstate_global->__pyx_n_s_s2_proc
 #define __pyx_n_s_score_cutoff __pyx_mstate_global->__pyx_n_s_score_cutoff
-#define __pyx_kp_u_score_cutoff_has_to_be_0 __pyx_mstate_global->__pyx_kp_u_score_cutoff_has_to_be_0
 #define __pyx_kp_u_score_cutoff_has_to_be_in_the_ra __pyx_mstate_global->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra
-#define __pyx_n_s_similarity __pyx_mstate_global->__pyx_n_s_similarity
-#define __pyx_kp_s_src_rapidfuzz_distance_DamerauLe __pyx_mstate_global->__pyx_kp_s_src_rapidfuzz_distance_DamerauLe
+#define __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx __pyx_mstate_global->__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx
 #define __pyx_n_s_test __pyx_mstate_global->__pyx_n_s_test
+#define __pyx_n_s_token_ratio __pyx_mstate_global->__pyx_n_s_token_ratio
+#define __pyx_n_s_token_set_ratio __pyx_mstate_global->__pyx_n_s_token_set_ratio
+#define __pyx_n_s_token_sort_ratio __pyx_mstate_global->__pyx_n_s_token_sort_ratio
 #define __pyx_n_s_typecode __pyx_mstate_global->__pyx_n_s_typecode
 #define __pyx_n_u_worst_score __pyx_mstate_global->__pyx_n_u_worst_score
-#define __pyx_float_0_0 __pyx_mstate_global->__pyx_float_0_0
 #define __pyx_int_0 __pyx_mstate_global->__pyx_int_0
-#define __pyx_int_1 __pyx_mstate_global->__pyx_int_1
 #define __pyx_int_32 __pyx_mstate_global->__pyx_int_32
-#define __pyx_int_64 __pyx_mstate_global->__pyx_int_64
-#define __pyx_int_9223372036854775807 __pyx_mstate_global->__pyx_int_9223372036854775807
+#define __pyx_int_100 __pyx_mstate_global->__pyx_int_100
 #define __pyx_int_neg_1 __pyx_mstate_global->__pyx_int_neg_1
 #define __pyx_codeobj_ __pyx_mstate_global->__pyx_codeobj_
-#define __pyx_tuple__2 __pyx_mstate_global->__pyx_tuple__2
-#define __pyx_tuple__13 __pyx_mstate_global->__pyx_tuple__13
-#define __pyx_tuple__14 __pyx_mstate_global->__pyx_tuple__14
+#define __pyx_tuple__16 __pyx_mstate_global->__pyx_tuple__16
+#define __pyx_tuple__17 __pyx_mstate_global->__pyx_tuple__17
+#define __pyx_tuple__18 __pyx_mstate_global->__pyx_tuple__18
+#define __pyx_codeobj__2 __pyx_mstate_global->__pyx_codeobj__2
 #define __pyx_codeobj__3 __pyx_mstate_global->__pyx_codeobj__3
 #define __pyx_codeobj__4 __pyx_mstate_global->__pyx_codeobj__4
 #define __pyx_codeobj__5 __pyx_mstate_global->__pyx_codeobj__5
 #define __pyx_codeobj__6 __pyx_mstate_global->__pyx_codeobj__6
 #define __pyx_codeobj__7 __pyx_mstate_global->__pyx_codeobj__7
 #define __pyx_codeobj__8 __pyx_mstate_global->__pyx_codeobj__8
 #define __pyx_codeobj__9 __pyx_mstate_global->__pyx_codeobj__9
+#define __pyx_codeobj__10 __pyx_mstate_global->__pyx_codeobj__10
+#define __pyx_codeobj__11 __pyx_mstate_global->__pyx_codeobj__11
+#define __pyx_codeobj__12 __pyx_mstate_global->__pyx_codeobj__12
 #endif
 /* #### Code section: module_code ### */
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":34
- *     bool DamerauLevenshteinNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
+/* "rapidfuzz/fuzz_cpp.pyx":50
+ *     bool QRatioInit(                RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
  * 
- * def distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the minimum number of insertions and deletions
+ * def ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_1distance(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_1ratio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_distance, "\n    Calculates the minimum number of insertions and deletions\n    required to change one sequence into the other. This is equivalent to the\n    Levenshtein distance with a substitution weight of 2.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : int, optional\n        Maximum distance between s1 and s2, that is\n        considered as a result. If the distance is bigger than score_cutoff,\n        score_cutoff + 1 is returned instead. Default is None, which deactivates\n        this behaviour.\n\n    Returns\n    -------\n    distance : int\n        distance between s1 and s2\n\n    Examples\n    --------\n    Find the Damerau Levenshtein distance between two strings:\n\n    >>> from rapidfuzz.distance import DamerauLevenshtein\n    >>> DamerauLevenshtein.distance(\"CA\", \"ABC\")\n    2\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_1distance = {"distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_1distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_distance};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_1distance(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_1ratio = {"ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_1ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_1ratio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -2904,15 +2996,15 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("distance (wrapper)", 0);
+  __Pyx_RefNannySetupContext("ratio (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
@@ -2928,201 +3020,211 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 34, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 50, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 34, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 50, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("distance", 1, 2, 2, 1); __PYX_ERR(0, 34, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("ratio", 1, 2, 2, 1); __PYX_ERR(0, 50, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 34, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 50, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "distance") < 0)) __PYX_ERR(0, 34, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "ratio") < 0)) __PYX_ERR(0, 50, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 34, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 50, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
-  int64_t __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  int64_t __pyx_t_1;
+  double __pyx_t_1;
   int __pyx_t_2;
-  int64_t __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
+  double __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_TraceFrameInit(__pyx_codeobj_)
-  __Pyx_RefNannySetupContext("distance", 0);
-  __Pyx_TraceCall("distance", __pyx_f[0], 34, 0, __PYX_ERR(0, 34, __pyx_L1_error));
+  __Pyx_RefNannySetupContext("ratio", 0);
+  __Pyx_TraceCall("ratio", __pyx_f[0], 50, 0, __PYX_ERR(0, 50, __pyx_L1_error));
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":69
- *     """
+  /* "rapidfuzz/fuzz_cpp.pyx":51
+ * 
+ * def ratio(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
  *     cdef RF_StringWrapper s1_proc, s2_proc
- *     cdef int64_t c_score_cutoff = INT64_MAX if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")
+ * 
  */
-  __Pyx_TraceLine(69,0,__PYX_ERR(0, 69, __pyx_L1_error))
+  __Pyx_TraceLine(51,0,__PYX_ERR(0, 51, __pyx_L1_error))
   __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
   if (__pyx_t_2) {
-    __pyx_t_1 = INT64_MAX;
+    __pyx_t_1 = 0.0;
   } else {
-    __pyx_t_3 = __Pyx_PyInt_As_int64_t(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 69, __pyx_L1_error)
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 51, __pyx_L1_error)
     __pyx_t_1 = __pyx_t_3;
   }
   __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":70
+  /* "rapidfuzz/fuzz_cpp.pyx":54
  *     cdef RF_StringWrapper s1_proc, s2_proc
- *     cdef int64_t c_score_cutoff = INT64_MAX if score_cutoff is None else score_cutoff
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
-  __Pyx_TraceLine(70,0,__PYX_ERR(0, 70, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_c_score_cutoff < 0);
-  if (unlikely(__pyx_t_2)) {
+  __Pyx_TraceLine(54,0,__PYX_ERR(0, 54, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
+  } else {
+    __pyx_t_2 = __pyx_t_4;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":71
- *     cdef int64_t c_score_cutoff = INT64_MAX if score_cutoff is None else score_cutoff
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
+    /* "rapidfuzz/fuzz_cpp.pyx":55
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
  */
-    __Pyx_TraceLine(71,0,__PYX_ERR(0, 71, __pyx_L1_error))
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 71, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 71, __pyx_L1_error)
+    __Pyx_TraceLine(55,0,__PYX_ERR(0, 55, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":70
+    /* "rapidfuzz/fuzz_cpp.pyx":54
  *     cdef RF_StringWrapper s1_proc, s2_proc
- *     cdef int64_t c_score_cutoff = INT64_MAX if score_cutoff is None else score_cutoff
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":73
- *         raise ValueError("score_cutoff has to be >= 0")
+  /* "rapidfuzz/fuzz_cpp.pyx":57
+ *         return 0
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
- *     return damerau_levenshtein_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     return ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(73,0,__PYX_ERR(0, 73, __pyx_L1_error))
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L1_error)
+  __Pyx_TraceLine(57,0,__PYX_ERR(0, 57, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 57, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 57, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":74
+  /* "rapidfuzz/fuzz_cpp.pyx":58
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- *     return damerau_levenshtein_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     return ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(74,0,__PYX_ERR(0, 74, __pyx_L1_error))
+  __Pyx_TraceLine(58,0,__PYX_ERR(0, 58, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = damerau_levenshtein_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_1 = ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 74, __pyx_L1_error)
+    __PYX_ERR(0, 58, __pyx_L1_error)
   }
-  __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 74, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_r = __pyx_t_4;
-  __pyx_t_4 = 0;
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 58, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":34
- *     bool DamerauLevenshteinNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
+  /* "rapidfuzz/fuzz_cpp.pyx":50
+ *     bool QRatioInit(                RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
  * 
- * def distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the minimum number of insertions and deletions
+ * def ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":78
+/* "rapidfuzz/fuzz_cpp.pyx":61
  * 
  * 
- * def similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Damerau Levenshtein similarity in the range [max, 0].
+ * def partial_ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_3similarity(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_3partial_ratio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_2similarity, "\n    Calculates the Damerau Levenshtein similarity in the range [max, 0].\n\n    This is calculated as ``(len1 + len2) - distance``.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : int, optional\n        Maximum distance between s1 and s2, that is\n        considered as a result. If the similarity is smaller than score_cutoff,\n        0 is returned instead. Default is None, which deactivates\n        this behaviour.\n\n    Returns\n    -------\n    similarity : int\n        similarity between s1 and s2\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_3similarity = {"similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_3similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_2similarity};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_3similarity(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_3partial_ratio = {"partial_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_3partial_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_3partial_ratio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -3134,15 +3236,15 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("similarity (wrapper)", 0);
+  __Pyx_RefNannySetupContext("partial_ratio (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
@@ -3158,202 +3260,211 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 78, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 61, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 78, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 61, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("similarity", 1, 2, 2, 1); __PYX_ERR(0, 78, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("partial_ratio", 1, 2, 2, 1); __PYX_ERR(0, 61, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 78, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 61, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "similarity") < 0)) __PYX_ERR(0, 78, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "partial_ratio") < 0)) __PYX_ERR(0, 61, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 78, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("partial_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 61, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_2similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_2partial_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_2similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_2partial_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
-  int64_t __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  int64_t __pyx_t_1;
+  double __pyx_t_1;
   int __pyx_t_2;
-  int64_t __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
+  double __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__3)
-  __Pyx_RefNannySetupContext("similarity", 0);
-  __Pyx_TraceCall("similarity", __pyx_f[0], 78, 0, __PYX_ERR(0, 78, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__2)
+  __Pyx_RefNannySetupContext("partial_ratio", 0);
+  __Pyx_TraceCall("partial_ratio", __pyx_f[0], 61, 0, __PYX_ERR(0, 61, __pyx_L1_error));
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":105
- *     """
+  /* "rapidfuzz/fuzz_cpp.pyx":62
+ * 
+ * def partial_ratio(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
  *     cdef RF_StringWrapper s1_proc, s2_proc
- *     cdef int64_t c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
  * 
- *     if c_score_cutoff < 0:
  */
-  __Pyx_TraceLine(105,0,__PYX_ERR(0, 105, __pyx_L1_error))
+  __Pyx_TraceLine(62,0,__PYX_ERR(0, 62, __pyx_L1_error))
   __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
   if (__pyx_t_2) {
-    __pyx_t_3 = __Pyx_PyInt_As_int64_t(__pyx_float_0_0); if (unlikely((__pyx_t_3 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 105, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
+    __pyx_t_1 = 0.0;
   } else {
-    __pyx_t_3 = __Pyx_PyInt_As_int64_t(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 105, __pyx_L1_error)
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 62, __pyx_L1_error)
     __pyx_t_1 = __pyx_t_3;
   }
   __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":107
- *     cdef int64_t c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+  /* "rapidfuzz/fuzz_cpp.pyx":65
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
-  __Pyx_TraceLine(107,0,__PYX_ERR(0, 107, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_c_score_cutoff < 0);
-  if (unlikely(__pyx_t_2)) {
+  __Pyx_TraceLine(65,0,__PYX_ERR(0, 65, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
+  } else {
+    __pyx_t_2 = __pyx_t_4;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":108
+    /* "rapidfuzz/fuzz_cpp.pyx":66
  * 
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
  */
-    __Pyx_TraceLine(108,0,__PYX_ERR(0, 108, __pyx_L1_error))
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 108, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 108, __pyx_L1_error)
+    __Pyx_TraceLine(66,0,__PYX_ERR(0, 66, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":107
- *     cdef int64_t c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+    /* "rapidfuzz/fuzz_cpp.pyx":65
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":110
- *         raise ValueError("score_cutoff has to be >= 0")
+  /* "rapidfuzz/fuzz_cpp.pyx":68
+ *         return 0
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
- *     return damerau_levenshtein_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     return partial_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(110,0,__PYX_ERR(0, 110, __pyx_L1_error))
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L1_error)
+  __Pyx_TraceLine(68,0,__PYX_ERR(0, 68, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 68, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 68, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":111
+  /* "rapidfuzz/fuzz_cpp.pyx":69
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- *     return damerau_levenshtein_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     return partial_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(111,0,__PYX_ERR(0, 111, __pyx_L1_error))
+  __Pyx_TraceLine(69,0,__PYX_ERR(0, 69, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = damerau_levenshtein_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_1 = partial_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 111, __pyx_L1_error)
+    __PYX_ERR(0, 69, __pyx_L1_error)
   }
-  __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 111, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_r = __pyx_t_4;
-  __pyx_t_4 = 0;
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 69, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":78
+  /* "rapidfuzz/fuzz_cpp.pyx":61
  * 
  * 
- * def similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Damerau Levenshtein similarity in the range [max, 0].
+ * def partial_ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":114
+/* "rapidfuzz/fuzz_cpp.pyx":72
  * 
  * 
- * def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized levenshtein similarity in the range [1, 0].
+ * def partial_ratio_alignment(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_5normalized_distance(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_5partial_ratio_alignment(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_4normalized_distance, "\n    Calculates a normalized levenshtein similarity in the range [1, 0].\n\n    This is calculated as ``distance / (len1 + len2)``.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 1.0.\n        For norm_dist > score_cutoff 1.0 is returned instead. Default is 1.0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    norm_dist : float\n        normalized distance between s1 and s2 as a float between 0 and 1.0\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_5normalized_distance = {"normalized_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_5normalized_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_4normalized_distance};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_5normalized_distance(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_5partial_ratio_alignment = {"partial_ratio_alignment", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_5partial_ratio_alignment, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_5partial_ratio_alignment(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -3365,15 +3476,15 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("normalized_distance (wrapper)", 0);
+  __Pyx_RefNannySetupContext("partial_ratio_alignment (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
@@ -3389,243 +3500,347 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 114, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 72, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 114, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 72, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("normalized_distance", 1, 2, 2, 1); __PYX_ERR(0, 114, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("partial_ratio_alignment", 1, 2, 2, 1); __PYX_ERR(0, 72, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 114, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 72, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "normalized_distance") < 0)) __PYX_ERR(0, 114, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "partial_ratio_alignment") < 0)) __PYX_ERR(0, 72, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("normalized_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 114, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("partial_ratio_alignment", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 72, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_ratio_alignment", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_4normalized_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_4partial_ratio_alignment(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_4normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_4partial_ratio_alignment(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
-  double __pyx_v_c_score_cutoff;
+  rapidfuzz::ScoreAlignment<double>  __pyx_v_res;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
+  double __pyx_t_1;
   int __pyx_t_2;
   double __pyx_t_3;
-  double __pyx_t_4;
+  int __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
+  rapidfuzz::ScoreAlignment<double>  __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
+  PyObject *__pyx_t_10 = NULL;
+  PyObject *__pyx_t_11 = NULL;
+  PyObject *__pyx_t_12 = NULL;
+  PyObject *__pyx_t_13 = NULL;
+  int __pyx_t_14;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__4)
-  __Pyx_RefNannySetupContext("normalized_distance", 0);
-  __Pyx_TraceCall("normalized_distance", __pyx_f[0], 114, 0, __PYX_ERR(0, 114, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__3)
+  __Pyx_RefNannySetupContext("partial_ratio_alignment", 0);
+  __Pyx_TraceCall("partial_ratio_alignment", __pyx_f[0], 72, 0, __PYX_ERR(0, 72, __pyx_L1_error));
+
+  /* "rapidfuzz/fuzz_cpp.pyx":73
+ * 
+ * def partial_ratio_alignment(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ */
+  __Pyx_TraceLine(73,0,__PYX_ERR(0, 73, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_2) {
+    __pyx_t_1 = 0.0;
+  } else {
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L1_error)
+    __pyx_t_1 = __pyx_t_3;
+  }
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":140
- *     """
+  /* "rapidfuzz/fuzz_cpp.pyx":76
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
+ *         return None
  * 
  */
-  __Pyx_TraceLine(140,0,__PYX_ERR(0, 140, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_2) {
+  __Pyx_TraceLine(76,0,__PYX_ERR(0, 76, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
   } else {
-    __pyx_t_1 = __pyx_t_2;
+    __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_2 = (__pyx_v_s2 == Py_None);
-  __pyx_t_1 = __pyx_t_2;
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_1) {
+  if (__pyx_t_2) {
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":141
- *     cdef RF_StringWrapper s1_proc, s2_proc
+    /* "rapidfuzz/fuzz_cpp.pyx":77
+ * 
  *     if s1 is None or s2 is None:
- *         return 0             # <<<<<<<<<<<<<<
+ *         return None             # <<<<<<<<<<<<<<
  * 
- *     cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
  */
-    __Pyx_TraceLine(141,0,__PYX_ERR(0, 141, __pyx_L1_error))
+    __Pyx_TraceLine(77,0,__PYX_ERR(0, 77, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_int_0);
-    __pyx_r = __pyx_int_0;
+    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":140
- *     """
+    /* "rapidfuzz/fuzz_cpp.pyx":76
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
+ *         return None
  * 
  */
   }
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":143
- *         return 0
+  /* "rapidfuzz/fuzz_cpp.pyx":79
+ *         return None
  * 
- *     cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     res = partial_ratio_alignment_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
- *     if c_score_cutoff < 0:
  */
-  __Pyx_TraceLine(143,0,__PYX_ERR(0, 143, __pyx_L1_error))
-  __pyx_t_1 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_1) {
-    __pyx_t_3 = 1.0;
-  } else {
-    __pyx_t_4 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_4 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 143, __pyx_L1_error)
-    __pyx_t_3 = __pyx_t_4;
-  }
-  __pyx_v_c_score_cutoff = __pyx_t_3;
+  __Pyx_TraceLine(79,0,__PYX_ERR(0, 79, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 79, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 79, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":145
- *     cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff
+  /* "rapidfuzz/fuzz_cpp.pyx":80
  * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     res = partial_ratio_alignment_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
+ *     if res.score >= c_score_cutoff:
  */
-  __Pyx_TraceLine(145,0,__PYX_ERR(0, 145, __pyx_L1_error))
-  __pyx_t_1 = (__pyx_v_c_score_cutoff < 0.0);
-  if (unlikely(__pyx_t_1)) {
+  __Pyx_TraceLine(80,0,__PYX_ERR(0, 80, __pyx_L1_error))
+  try {
+    __pyx_t_6 = partial_ratio_alignment_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 80, __pyx_L1_error)
+  }
+  __pyx_v_res = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_6);
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":146
- * 
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/fuzz_cpp.pyx":82
+ *     res = partial_ratio_alignment_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     if res.score >= c_score_cutoff:             # <<<<<<<<<<<<<<
+ *         return ScoreAlignment(res.score, res.src_start, res.src_end, res.dest_start, res.dest_end)
+ *     else:
  */
-    __Pyx_TraceLine(146,0,__PYX_ERR(0, 146, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 146, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __PYX_ERR(0, 146, __pyx_L1_error)
+  __Pyx_TraceLine(82,0,__PYX_ERR(0, 82, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_res.score >= __pyx_v_c_score_cutoff);
+  if (__pyx_t_2) {
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":145
- *     cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff
- * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
+    /* "rapidfuzz/fuzz_cpp.pyx":83
  * 
+ *     if res.score >= c_score_cutoff:
+ *         return ScoreAlignment(res.score, res.src_start, res.src_end, res.dest_start, res.dest_end)             # <<<<<<<<<<<<<<
+ *     else:
+ *         return None
  */
-  }
+    __Pyx_TraceLine(83,0,__PYX_ERR(0, 83, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_ScoreAlignment); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 83, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __pyx_t_8 = PyFloat_FromDouble(__pyx_v_res.score); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 83, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_res.src_start); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 83, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_9);
+    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_res.src_end); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 83, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_10);
+    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_res.dest_start); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 83, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_11);
+    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_res.dest_end); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 83, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_12);
+    __pyx_t_13 = NULL;
+    __pyx_t_14 = 0;
+    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
+      __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_7);
+      if (likely(__pyx_t_13)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
+        __Pyx_INCREF(__pyx_t_13);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_7, function);
+        __pyx_t_14 = 1;
+      }
+    }
+    {
+      PyObject *__pyx_callargs[6] = {__pyx_t_13, __pyx_t_8, __pyx_t_9, __pyx_t_10, __pyx_t_11, __pyx_t_12};
+      __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_14, 5+__pyx_t_14);
+      __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
+      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
+      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
+      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
+      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 83, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+    }
+    __pyx_r = __pyx_t_5;
+    __pyx_t_5 = 0;
+    goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":148
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
- *     return damerau_levenshtein_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+    /* "rapidfuzz/fuzz_cpp.pyx":82
+ *     res = partial_ratio_alignment_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
+ *     if res.score >= c_score_cutoff:             # <<<<<<<<<<<<<<
+ *         return ScoreAlignment(res.score, res.src_start, res.src_end, res.dest_start, res.dest_end)
+ *     else:
  */
-  __Pyx_TraceLine(148,0,__PYX_ERR(0, 148, __pyx_L1_error))
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 148, __pyx_L1_error)
+  }
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":149
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- *     return damerau_levenshtein_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/fuzz_cpp.pyx":85
+ *         return ScoreAlignment(res.score, res.src_start, res.src_end, res.dest_start, res.dest_end)
+ *     else:
+ *         return None             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(149,0,__PYX_ERR(0, 149, __pyx_L1_error))
-  __Pyx_XDECREF(__pyx_r);
-  try {
-    __pyx_t_3 = damerau_levenshtein_normalized_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
-  } catch(...) {
-    __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 149, __pyx_L1_error)
+  __Pyx_TraceLine(85,0,__PYX_ERR(0, 85, __pyx_L1_error))
+  /*else*/ {
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+    goto __pyx_L0;
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 149, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
-  goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":114
+  /* "rapidfuzz/fuzz_cpp.pyx":72
  * 
  * 
- * def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized levenshtein similarity in the range [1, 0].
+ * def partial_ratio_alignment(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_XDECREF(__pyx_t_9);
+  __Pyx_XDECREF(__pyx_t_10);
+  __Pyx_XDECREF(__pyx_t_11);
+  __Pyx_XDECREF(__pyx_t_12);
+  __Pyx_XDECREF(__pyx_t_13);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_ratio_alignment", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":152
+/* "rapidfuzz/fuzz_cpp.pyx":88
  * 
  * 
- * def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized indel similarity in the range [0, 1].
+ * def token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_24__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__defaults__", 0);
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 88, 0, __PYX_ERR(0, 88, __pyx_L1_error));
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_7normalized_similarity(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_7token_sort_ratio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_6normalized_similarity, "\n    Calculates a normalized indel similarity in the range [0, 1].\n\n    This is calculated as ``1 - normalized_distance``\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 1.0.\n        For norm_sim < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    norm_sim : float\n        normalized similarity between s1 and s2 as a float between 0 and 1.0\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_7normalized_similarity = {"normalized_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_7normalized_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_6normalized_similarity};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_7normalized_similarity(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_7token_sort_ratio = {"token_sort_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_7token_sort_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_7token_sort_ratio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -3637,23 +3852,24 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("normalized_similarity (wrapper)", 0);
+  __Pyx_RefNannySetupContext("token_sort_ratio (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
-    values[2] = ((PyObject *)((PyObject *)Py_None));
+    __pyx_defaults *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self);
+    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
@@ -3661,920 +3877,2523 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 152, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 88, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 152, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 88, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("normalized_similarity", 1, 2, 2, 1); __PYX_ERR(0, 152, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("token_sort_ratio", 1, 2, 2, 1); __PYX_ERR(0, 88, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 152, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 88, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "normalized_similarity") < 0)) __PYX_ERR(0, 152, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "token_sort_ratio") < 0)) __PYX_ERR(0, 88, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("normalized_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 152, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("token_sort_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 88, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_sort_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_6normalized_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_6token_sort_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_6normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_6token_sort_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
-  double __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
+  double __pyx_t_1;
   int __pyx_t_2;
   double __pyx_t_3;
-  double __pyx_t_4;
+  int __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__5)
-  __Pyx_RefNannySetupContext("normalized_similarity", 0);
-  __Pyx_TraceCall("normalized_similarity", __pyx_f[0], 152, 0, __PYX_ERR(0, 152, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__4)
+  __Pyx_RefNannySetupContext("token_sort_ratio", 0);
+  __Pyx_TraceCall("token_sort_ratio", __pyx_f[0], 88, 0, __PYX_ERR(0, 88, __pyx_L1_error));
+
+  /* "rapidfuzz/fuzz_cpp.pyx":89
+ * 
+ * def token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ */
+  __Pyx_TraceLine(89,0,__PYX_ERR(0, 89, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_2) {
+    __pyx_t_1 = 0.0;
+  } else {
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 89, __pyx_L1_error)
+    __pyx_t_1 = __pyx_t_3;
+  }
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":178
- *     """
+  /* "rapidfuzz/fuzz_cpp.pyx":92
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
-  __Pyx_TraceLine(178,0,__PYX_ERR(0, 178, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_2) {
+  __Pyx_TraceLine(92,0,__PYX_ERR(0, 92, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
   } else {
-    __pyx_t_1 = __pyx_t_2;
+    __pyx_t_2 = __pyx_t_4;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_2 = (__pyx_v_s2 == Py_None);
-  __pyx_t_1 = __pyx_t_2;
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_1) {
+  if (__pyx_t_2) {
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":179
- *     cdef RF_StringWrapper s1_proc, s2_proc
+    /* "rapidfuzz/fuzz_cpp.pyx":93
+ * 
  *     if s1 is None or s2 is None:
  *         return 0             # <<<<<<<<<<<<<<
  * 
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
  */
-    __Pyx_TraceLine(179,0,__PYX_ERR(0, 179, __pyx_L1_error))
+    __Pyx_TraceLine(93,0,__PYX_ERR(0, 93, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_int_0);
     __pyx_r = __pyx_int_0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":178
- *     """
+    /* "rapidfuzz/fuzz_cpp.pyx":92
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":181
+  /* "rapidfuzz/fuzz_cpp.pyx":95
  *         return 0
  * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     return token_sort_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(95,0,__PYX_ERR(0, 95, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 95, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":96
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     return token_sort_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(96,0,__PYX_ERR(0, 96, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_1 = token_sort_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 96, __pyx_L1_error)
+  }
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 96, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":88
+ * 
+ * 
+ * def token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_sort_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/fuzz_cpp.pyx":99
+ * 
+ * 
+ * def token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_26__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__defaults__", 0);
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 99, 0, __PYX_ERR(0, 99, __pyx_L1_error));
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 99, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 99, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_9token_set_ratio(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_9token_set_ratio = {"token_set_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_9token_set_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_9token_set_ratio(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("token_set_ratio (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    __pyx_defaults1 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self);
+    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 99, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 99, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("token_set_ratio", 1, 2, 2, 1); __PYX_ERR(0, 99, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 99, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "token_set_ratio") < 0)) __PYX_ERR(0, 99, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("token_set_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 99, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_set_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_8token_set_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_8token_set_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  double __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__5)
+  __Pyx_RefNannySetupContext("token_set_ratio", 0);
+  __Pyx_TraceCall("token_set_ratio", __pyx_f[0], 99, 0, __PYX_ERR(0, 99, __pyx_L1_error));
+
+  /* "rapidfuzz/fuzz_cpp.pyx":100
+ * 
+ * def token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):
  *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
- *     if c_score_cutoff < 0:
  */
-  __Pyx_TraceLine(181,0,__PYX_ERR(0, 181, __pyx_L1_error))
-  __pyx_t_1 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_1) {
-    __pyx_t_3 = 0.0;
+  __Pyx_TraceLine(100,0,__PYX_ERR(0, 100, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_2) {
+    __pyx_t_1 = 0.0;
   } else {
-    __pyx_t_4 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_4 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 181, __pyx_L1_error)
-    __pyx_t_3 = __pyx_t_4;
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 100, __pyx_L1_error)
+    __pyx_t_1 = __pyx_t_3;
   }
-  __pyx_v_c_score_cutoff = __pyx_t_3;
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":183
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+  /* "rapidfuzz/fuzz_cpp.pyx":103
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
-  __Pyx_TraceLine(183,0,__PYX_ERR(0, 183, __pyx_L1_error))
-  __pyx_t_1 = (__pyx_v_c_score_cutoff < 0.0);
-  if (unlikely(__pyx_t_1)) {
+  __Pyx_TraceLine(103,0,__PYX_ERR(0, 103, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
+  } else {
+    __pyx_t_2 = __pyx_t_4;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":184
+    /* "rapidfuzz/fuzz_cpp.pyx":104
  * 
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
  */
-    __Pyx_TraceLine(184,0,__PYX_ERR(0, 184, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __PYX_ERR(0, 184, __pyx_L1_error)
+    __Pyx_TraceLine(104,0,__PYX_ERR(0, 104, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
 
-    /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":183
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+    /* "rapidfuzz/fuzz_cpp.pyx":103
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":186
- *         raise ValueError("score_cutoff has to be >= 0")
+  /* "rapidfuzz/fuzz_cpp.pyx":106
+ *         return 0
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
- *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     return token_set_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(186,0,__PYX_ERR(0, 186, __pyx_L1_error))
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 186, __pyx_L1_error)
+  __Pyx_TraceLine(106,0,__PYX_ERR(0, 106, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 106, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 106, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":187
+  /* "rapidfuzz/fuzz_cpp.pyx":107
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     return token_set_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
  */
-  __Pyx_TraceLine(187,0,__PYX_ERR(0, 187, __pyx_L1_error))
+  __Pyx_TraceLine(107,0,__PYX_ERR(0, 107, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_3 = damerau_levenshtein_normalized_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_1 = token_set_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 187, __pyx_L1_error)
+    __PYX_ERR(0, 107, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 187, __pyx_L1_error)
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 107, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":152
+  /* "rapidfuzz/fuzz_cpp.pyx":99
  * 
  * 
- * def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized indel similarity in the range [0, 1].
+ * def token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_set_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":189
- *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+/* "rapidfuzz/fuzz_cpp.pyx":110
+ * 
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = 0
+ * def token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
-static bool __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
-  bool __pyx_r;
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_28__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  #ifdef WITH_THREAD
-  PyGILState_STATE __pyx_gilstate_save;
+  __Pyx_RefNannySetupContext("__defaults__", 0);
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 110, 0, __PYX_ERR(0, 110, __pyx_L1_error));
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_11token_ratio(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_11token_ratio = {"token_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_11token_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_11token_ratio(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
-  __Pyx_TraceCall("GetScorerFlagsDamerauLevenshteinDistance", __pyx_f[0], 189, 1, __PYX_ERR(0, 189, __pyx_L1_error));
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("token_ratio (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    __pyx_defaults2 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self);
+    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("token_ratio", 1, 2, 2, 1); __PYX_ERR(0, 110, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 110, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "token_ratio") < 0)) __PYX_ERR(0, 110, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("token_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 110, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_10token_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":190
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_10token_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  double __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__6)
+  __Pyx_RefNannySetupContext("token_ratio", 0);
+  __Pyx_TraceCall("token_ratio", __pyx_f[0], 110, 0, __PYX_ERR(0, 110, __pyx_L1_error));
+
+  /* "rapidfuzz/fuzz_cpp.pyx":111
+ * 
+ * def token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).optimal_score.i64 = 0
- *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
- */
-  __Pyx_TraceLine(190,1,__PYX_ERR(0, 190, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
-
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":191
- * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = 0             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
- *     return True
  */
-  __Pyx_TraceLine(191,1,__PYX_ERR(0, 191, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).optimal_score.i64 = 0;
+  __Pyx_TraceLine(111,0,__PYX_ERR(0, 111, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_2) {
+    __pyx_t_1 = 0.0;
+  } else {
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 111, __pyx_L1_error)
+    __pyx_t_1 = __pyx_t_3;
+  }
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":192
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = 0
- *     dereference(scorer_flags).worst_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
- *     return True
+  /* "rapidfuzz/fuzz_cpp.pyx":114
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
-  __Pyx_TraceLine(192,1,__PYX_ERR(0, 192, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).worst_score.i64 = INT64_MAX;
+  __Pyx_TraceLine(114,0,__PYX_ERR(0, 114, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
+  } else {
+    __pyx_t_2 = __pyx_t_4;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":193
- *     dereference(scorer_flags).optimal_score.i64 = 0
- *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
- *     return True             # <<<<<<<<<<<<<<
+    /* "rapidfuzz/fuzz_cpp.pyx":115
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
  */
-  __Pyx_TraceLine(193,1,__PYX_ERR(0, 193, __pyx_L1_error))
-  __pyx_r = 1;
+    __Pyx_TraceLine(115,0,__PYX_ERR(0, 115, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/fuzz_cpp.pyx":114
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  }
+
+  /* "rapidfuzz/fuzz_cpp.pyx":117
+ *         return 0
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     return token_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(117,0,__PYX_ERR(0, 117, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 117, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":118
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     return token_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(118,0,__PYX_ERR(0, 118, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_1 = token_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 118, __pyx_L1_error)
+  }
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 118, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":189
- *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+  /* "rapidfuzz/fuzz_cpp.pyx":110
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = 0
+ * 
+ * def token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  #ifdef WITH_THREAD
-  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-  #endif
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.GetScorerFlagsDamerauLevenshteinDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  #ifdef WITH_THREAD
-  __Pyx_PyGILState_Release(__pyx_gilstate_save);
-  #endif
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_TraceReturn(Py_None, 1);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":195
- *     return True
+/* "rapidfuzz/fuzz_cpp.pyx":121
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ * 
+ * def partial_token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
-static bool __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinNormalizedDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
-  bool __pyx_r;
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_30__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  #ifdef WITH_THREAD
-  PyGILState_STATE __pyx_gilstate_save;
+  __Pyx_RefNannySetupContext("__defaults__", 0);
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 121, 0, __PYX_ERR(0, 121, __pyx_L1_error));
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_13partial_token_sort_ratio(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_13partial_token_sort_ratio = {"partial_token_sort_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_13partial_token_sort_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_13partial_token_sort_ratio(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
-  __Pyx_TraceCall("GetScorerFlagsDamerauLevenshteinNormalizedDistance", __pyx_f[0], 195, 1, __PYX_ERR(0, 195, __pyx_L1_error));
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("partial_token_sort_ratio (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    __pyx_defaults3 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self);
+    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 121, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 121, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("partial_token_sort_ratio", 1, 2, 2, 1); __PYX_ERR(0, 121, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 121, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "partial_token_sort_ratio") < 0)) __PYX_ERR(0, 121, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("partial_token_sort_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 121, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_sort_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_12partial_token_sort_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":196
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_12partial_token_sort_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  double __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__7)
+  __Pyx_RefNannySetupContext("partial_token_sort_ratio", 0);
+  __Pyx_TraceCall("partial_token_sort_ratio", __pyx_f[0], 121, 0, __PYX_ERR(0, 121, __pyx_L1_error));
+
+  /* "rapidfuzz/fuzz_cpp.pyx":122
+ * 
+ * def partial_token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
- *     dereference(scorer_flags).worst_score.f64 = 1
  */
-  __Pyx_TraceLine(196,1,__PYX_ERR(0, 196, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+  __Pyx_TraceLine(122,0,__PYX_ERR(0, 122, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_2) {
+    __pyx_t_1 = 0.0;
+  } else {
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 122, __pyx_L1_error)
+    __pyx_t_1 = __pyx_t_3;
+  }
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":197
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 0.0             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).worst_score.f64 = 1
- *     return True
+  /* "rapidfuzz/fuzz_cpp.pyx":125
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
  */
-  __Pyx_TraceLine(197,1,__PYX_ERR(0, 197, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).optimal_score.f64 = 0.0;
+  __Pyx_TraceLine(125,0,__PYX_ERR(0, 125, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
+  } else {
+    __pyx_t_2 = __pyx_t_4;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":198
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
- *     dereference(scorer_flags).worst_score.f64 = 1             # <<<<<<<<<<<<<<
- *     return True
+    /* "rapidfuzz/fuzz_cpp.pyx":126
  * 
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
  */
-  __Pyx_TraceLine(198,1,__PYX_ERR(0, 198, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).worst_score.f64 = 1.0;
+    __Pyx_TraceLine(126,0,__PYX_ERR(0, 126, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":199
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
- *     dereference(scorer_flags).worst_score.f64 = 1
- *     return True             # <<<<<<<<<<<<<<
+    /* "rapidfuzz/fuzz_cpp.pyx":125
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
  */
-  __Pyx_TraceLine(199,1,__PYX_ERR(0, 199, __pyx_L1_error))
-  __pyx_r = 1;
+  }
+
+  /* "rapidfuzz/fuzz_cpp.pyx":128
+ *         return 0
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     return partial_token_sort_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(128,0,__PYX_ERR(0, 128, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 128, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 128, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":129
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     return partial_token_sort_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(129,0,__PYX_ERR(0, 129, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_1 = partial_token_sort_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 129, __pyx_L1_error)
+  }
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 129, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":195
- *     return True
+  /* "rapidfuzz/fuzz_cpp.pyx":121
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ * 
+ * def partial_token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  #ifdef WITH_THREAD
-  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-  #endif
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.GetScorerFlagsDamerauLevenshteinNormalizedDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  #ifdef WITH_THREAD
-  __Pyx_PyGILState_Release(__pyx_gilstate_save);
-  #endif
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_sort_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_TraceReturn(Py_None, 1);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":201
- *     return True
+/* "rapidfuzz/fuzz_cpp.pyx":132
+ * 
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ * def partial_token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
-static bool __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
-  bool __pyx_r;
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_32__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  #ifdef WITH_THREAD
-  PyGILState_STATE __pyx_gilstate_save;
+  __Pyx_RefNannySetupContext("__defaults__", 0);
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 132, 0, __PYX_ERR(0, 132, __pyx_L1_error));
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults4, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_15partial_token_set_ratio(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_15partial_token_set_ratio = {"partial_token_set_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_15partial_token_set_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_15partial_token_set_ratio(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
-  __Pyx_TraceCall("GetScorerFlagsDamerauLevenshteinSimilarity", __pyx_f[0], 201, 1, __PYX_ERR(0, 201, __pyx_L1_error));
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("partial_token_set_ratio (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    __pyx_defaults4 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults4, __pyx_self);
+    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 132, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 132, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("partial_token_set_ratio", 1, 2, 2, 1); __PYX_ERR(0, 132, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 132, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "partial_token_set_ratio") < 0)) __PYX_ERR(0, 132, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("partial_token_set_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 132, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_set_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_14partial_token_set_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_14partial_token_set_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  double __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__8)
+  __Pyx_RefNannySetupContext("partial_token_set_ratio", 0);
+  __Pyx_TraceCall("partial_token_set_ratio", __pyx_f[0], 132, 0, __PYX_ERR(0, 132, __pyx_L1_error));
+  __Pyx_INCREF(__pyx_v_processor);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":202
+  /* "rapidfuzz/fuzz_cpp.pyx":133
+ * 
+ * def partial_token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
- *     dereference(scorer_flags).worst_score.i64 = 0
- */
-  __Pyx_TraceLine(202,1,__PYX_ERR(0, 202, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
-
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":203
- * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).worst_score.i64 = 0
- *     return True
  */
-  __Pyx_TraceLine(203,1,__PYX_ERR(0, 203, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).optimal_score.i64 = INT64_MAX;
+  __Pyx_TraceLine(133,0,__PYX_ERR(0, 133, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_2) {
+    __pyx_t_1 = 0.0;
+  } else {
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 133, __pyx_L1_error)
+    __pyx_t_1 = __pyx_t_3;
+  }
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":204
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
- *     dereference(scorer_flags).worst_score.i64 = 0             # <<<<<<<<<<<<<<
- *     return True
+  /* "rapidfuzz/fuzz_cpp.pyx":136
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
-  __Pyx_TraceLine(204,1,__PYX_ERR(0, 204, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).worst_score.i64 = 0;
+  __Pyx_TraceLine(136,0,__PYX_ERR(0, 136, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
+  } else {
+    __pyx_t_2 = __pyx_t_4;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":205
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
- *     dereference(scorer_flags).worst_score.i64 = 0
- *     return True             # <<<<<<<<<<<<<<
+    /* "rapidfuzz/fuzz_cpp.pyx":137
+ * 
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     if processor is True:
  */
-  __Pyx_TraceLine(205,1,__PYX_ERR(0, 205, __pyx_L1_error))
-  __pyx_r = 1;
-  goto __pyx_L0;
+    __Pyx_TraceLine(137,0,__PYX_ERR(0, 137, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":201
- *     return True
+    /* "rapidfuzz/fuzz_cpp.pyx":136
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
  */
+  }
 
-  /* function exit code */
-  __pyx_L1_error:;
-  #ifdef WITH_THREAD
-  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-  #endif
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.GetScorerFlagsDamerauLevenshteinSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  #ifdef WITH_THREAD
-  __Pyx_PyGILState_Release(__pyx_gilstate_save);
-  #endif
-  __pyx_L0:;
-  __Pyx_TraceReturn(Py_None, 1);
-  return __pyx_r;
-}
-
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":207
- *     return True
+  /* "rapidfuzz/fuzz_cpp.pyx":139
+ *         return 0
+ * 
+ *     if processor is True:             # <<<<<<<<<<<<<<
+ *         processor = default_process
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
  */
+  __Pyx_TraceLine(139,0,__PYX_ERR(0, 139, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_processor == Py_True);
+  if (__pyx_t_2) {
 
-static bool __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
-  bool __pyx_r;
-  __Pyx_TraceDeclarations
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  #ifdef WITH_THREAD
-  PyGILState_STATE __pyx_gilstate_save;
-  #endif
-  __Pyx_TraceCall("GetScorerFlagsDamerauLevenshteinNormalizedSimilarity", __pyx_f[0], 207, 1, __PYX_ERR(0, 207, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":208
+    /* "rapidfuzz/fuzz_cpp.pyx":140
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
- *     dereference(scorer_flags).worst_score.f64 = 0
+ *     if processor is True:
+ *         processor = default_process             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
  */
-  __Pyx_TraceLine(208,1,__PYX_ERR(0, 208, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+    __Pyx_TraceLine(140,0,__PYX_ERR(0, 140, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 140, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF_SET(__pyx_v_processor, __pyx_t_5);
+    __pyx_t_5 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":209
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 1.0             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).worst_score.f64 = 0
- *     return True
+    /* "rapidfuzz/fuzz_cpp.pyx":139
+ *         return 0
+ * 
+ *     if processor is True:             # <<<<<<<<<<<<<<
+ *         processor = default_process
+ * 
  */
-  __Pyx_TraceLine(209,1,__PYX_ERR(0, 209, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).optimal_score.f64 = 1.0;
+  }
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":210
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
- *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
- *     return True
+  /* "rapidfuzz/fuzz_cpp.pyx":142
+ *         processor = default_process
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     return partial_token_set_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(210,1,__PYX_ERR(0, 210, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+  __Pyx_TraceLine(142,0,__PYX_ERR(0, 142, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 142, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 142, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":211
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
- *     dereference(scorer_flags).worst_score.f64 = 0
- *     return True             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/fuzz_cpp.pyx":143
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     return partial_token_set_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
  * 
- * cdef RF_Scorer DamerauLevenshteinDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinDistance, DamerauLevenshteinDistanceInit)
  */
-  __Pyx_TraceLine(211,1,__PYX_ERR(0, 211, __pyx_L1_error))
-  __pyx_r = 1;
+  __Pyx_TraceLine(143,0,__PYX_ERR(0, 143, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_1 = partial_token_set_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 143, __pyx_L1_error)
+  }
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 143, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":207
- *     return True
+  /* "rapidfuzz/fuzz_cpp.pyx":132
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ * 
+ * def partial_token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  #ifdef WITH_THREAD
-  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-  #endif
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp.GetScorerFlagsDamerauLevenshteinNormalizedSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  #ifdef WITH_THREAD
-  __Pyx_PyGILState_Release(__pyx_gilstate_save);
-  #endif
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_set_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_TraceReturn(Py_None, 1);
+  __Pyx_XDECREF(__pyx_v_processor);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":225
- * normalized_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedSimilarityContext, NULL, NULL)
+/* "rapidfuzz/fuzz_cpp.pyx":146
  * 
- * def _GetScorerFlagsDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
  * 
+ * def partial_token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_34__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__defaults__", 0);
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 146, 0, __PYX_ERR(0, 146, __pyx_L1_error));
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 146, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 146, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_9_GetScorerFlagsDistance(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_17partial_token_ratio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_9_GetScorerFlagsDistance = {"_GetScorerFlagsDistance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_9_GetScorerFlagsDistance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_9_GetScorerFlagsDistance(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_17partial_token_ratio = {"partial_token_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_17partial_token_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_17partial_token_ratio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
-  CYTHON_UNUSED PyObject *__pyx_v_kwargs = 0;
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
   #if !CYTHON_METH_FASTCALL
   CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("_GetScorerFlagsDistance (wrapper)", 0);
-  if (unlikely(__pyx_nargs > 0)) {
-    __Pyx_RaiseArgtupleInvalid("_GetScorerFlagsDistance", 1, 0, 0, __pyx_nargs); return NULL;}
-  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "_GetScorerFlagsDistance", 1))) return NULL;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_8_GetScorerFlagsDistance(__pyx_self, __pyx_v_kwargs);
+  __Pyx_RefNannySetupContext("partial_token_ratio (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    __pyx_defaults5 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_self);
+    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 146, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 146, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("partial_token_ratio", 1, 2, 2, 1); __PYX_ERR(0, 146, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 146, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "partial_token_ratio") < 0)) __PYX_ERR(0, 146, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("partial_token_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 146, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_16partial_token_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
-  __Pyx_XDECREF(__pyx_v_kwargs);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_8_GetScorerFlagsDistance(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs) {
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_16partial_token_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  double __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__6)
-  __Pyx_RefNannySetupContext("_GetScorerFlagsDistance", 0);
-  __Pyx_TraceCall("_GetScorerFlagsDistance", __pyx_f[0], 225, 0, __PYX_ERR(0, 225, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__9)
+  __Pyx_RefNannySetupContext("partial_token_ratio", 0);
+  __Pyx_TraceCall("partial_token_ratio", __pyx_f[0], 146, 0, __PYX_ERR(0, 146, __pyx_L1_error));
+
+  /* "rapidfuzz/fuzz_cpp.pyx":147
+ * 
+ * def partial_token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ */
+  __Pyx_TraceLine(147,0,__PYX_ERR(0, 147, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_2) {
+    __pyx_t_1 = 0.0;
+  } else {
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 147, __pyx_L1_error)
+    __pyx_t_1 = __pyx_t_3;
+  }
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":226
+  /* "rapidfuzz/fuzz_cpp.pyx":150
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
- * def _GetScorerFlagsDistance(**kwargs):
- *     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}             # <<<<<<<<<<<<<<
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
+ */
+  __Pyx_TraceLine(150,0,__PYX_ERR(0, 150, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
+  } else {
+    __pyx_t_2 = __pyx_t_4;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
+
+    /* "rapidfuzz/fuzz_cpp.pyx":151
  * 
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
  */
-  __Pyx_TraceLine(226,0,__PYX_ERR(0, 226, __pyx_L1_error))
+    __Pyx_TraceLine(151,0,__PYX_ERR(0, 151, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/fuzz_cpp.pyx":150
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  }
+
+  /* "rapidfuzz/fuzz_cpp.pyx":153
+ *         return 0
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     return partial_token_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(153,0,__PYX_ERR(0, 153, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 153, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 153, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":154
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     return partial_token_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(154,0,__PYX_ERR(0, 154, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 226, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_optimal_score, __pyx_int_0) < 0) __PYX_ERR(0, 226, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_worst_score, __pyx_int_9223372036854775807) < 0) __PYX_ERR(0, 226, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_flags, __pyx_int_64) < 0) __PYX_ERR(0, 226, __pyx_L1_error)
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  try {
+    __pyx_t_1 = partial_token_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 154, __pyx_L1_error)
+  }
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 154, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":225
- * normalized_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedSimilarityContext, NULL, NULL)
+  /* "rapidfuzz/fuzz_cpp.pyx":146
  * 
- * def _GetScorerFlagsDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
  * 
+ * def partial_token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp._GetScorerFlagsDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":229
- * 
+/* "rapidfuzz/fuzz_cpp.pyx":157
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
  * 
+ * def WRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_36__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__defaults__", 0);
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 157, 0, __PYX_ERR(0, 157, __pyx_L1_error));
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults6, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 157, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 157, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_11_GetScorerFlagsSimilarity(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_19WRatio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_11_GetScorerFlagsSimilarity = {"_GetScorerFlagsSimilarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_11_GetScorerFlagsSimilarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_11_GetScorerFlagsSimilarity(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_19WRatio = {"WRatio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_19WRatio, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_19WRatio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
-  CYTHON_UNUSED PyObject *__pyx_v_kwargs = 0;
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
   #if !CYTHON_METH_FASTCALL
   CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("_GetScorerFlagsSimilarity (wrapper)", 0);
-  if (unlikely(__pyx_nargs > 0)) {
-    __Pyx_RaiseArgtupleInvalid("_GetScorerFlagsSimilarity", 1, 0, 0, __pyx_nargs); return NULL;}
-  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "_GetScorerFlagsSimilarity", 1))) return NULL;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_10_GetScorerFlagsSimilarity(__pyx_self, __pyx_v_kwargs);
+  __Pyx_RefNannySetupContext("WRatio (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    __pyx_defaults6 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults6, __pyx_self);
+    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 157, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 157, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("WRatio", 1, 2, 2, 1); __PYX_ERR(0, 157, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 157, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "WRatio") < 0)) __PYX_ERR(0, 157, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("WRatio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 157, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.WRatio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_18WRatio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
-  __Pyx_XDECREF(__pyx_v_kwargs);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_10_GetScorerFlagsSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs) {
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_18WRatio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  double __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__7)
-  __Pyx_RefNannySetupContext("_GetScorerFlagsSimilarity", 0);
-  __Pyx_TraceCall("_GetScorerFlagsSimilarity", __pyx_f[0], 229, 0, __PYX_ERR(0, 229, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__10)
+  __Pyx_RefNannySetupContext("WRatio", 0);
+  __Pyx_TraceCall("WRatio", __pyx_f[0], 157, 0, __PYX_ERR(0, 157, __pyx_L1_error));
+  __Pyx_INCREF(__pyx_v_processor);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":230
+  /* "rapidfuzz/fuzz_cpp.pyx":158
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):
- *     return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}             # <<<<<<<<<<<<<<
+ * def WRatio(s1, s2, *, processor=default_process, score_cutoff=None):
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ */
+  __Pyx_TraceLine(158,0,__PYX_ERR(0, 158, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_2) {
+    __pyx_t_1 = 0.0;
+  } else {
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 158, __pyx_L1_error)
+    __pyx_t_1 = __pyx_t_3;
+  }
+  __pyx_v_c_score_cutoff = __pyx_t_1;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":161
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
-  __Pyx_TraceLine(230,0,__PYX_ERR(0, 230, __pyx_L1_error))
+  __Pyx_TraceLine(161,0,__PYX_ERR(0, 161, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
+  } else {
+    __pyx_t_2 = __pyx_t_4;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
+
+    /* "rapidfuzz/fuzz_cpp.pyx":162
+ * 
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
+ * 
+ *     if processor is True:
+ */
+    __Pyx_TraceLine(162,0,__PYX_ERR(0, 162, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/fuzz_cpp.pyx":161
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  }
+
+  /* "rapidfuzz/fuzz_cpp.pyx":164
+ *         return 0
+ * 
+ *     if processor is True:             # <<<<<<<<<<<<<<
+ *         processor = default_process
+ * 
+ */
+  __Pyx_TraceLine(164,0,__PYX_ERR(0, 164, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_processor == Py_True);
+  if (__pyx_t_2) {
+
+    /* "rapidfuzz/fuzz_cpp.pyx":165
+ * 
+ *     if processor is True:
+ *         processor = default_process             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ */
+    __Pyx_TraceLine(165,0,__PYX_ERR(0, 165, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 165, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF_SET(__pyx_v_processor, __pyx_t_5);
+    __pyx_t_5 = 0;
+
+    /* "rapidfuzz/fuzz_cpp.pyx":164
+ *         return 0
+ * 
+ *     if processor is True:             # <<<<<<<<<<<<<<
+ *         processor = default_process
+ * 
+ */
+  }
+
+  /* "rapidfuzz/fuzz_cpp.pyx":167
+ *         processor = default_process
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(167,0,__PYX_ERR(0, 167, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 167, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 167, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":168
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):
+ */
+  __Pyx_TraceLine(168,0,__PYX_ERR(0, 168, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_optimal_score, __pyx_int_9223372036854775807) < 0) __PYX_ERR(0, 230, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_worst_score, __pyx_int_0) < 0) __PYX_ERR(0, 230, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_flags, __pyx_int_64) < 0) __PYX_ERR(0, 230, __pyx_L1_error)
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  try {
+    __pyx_t_1 = WRatio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 168, __pyx_L1_error)
+  }
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 168, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":229
+  /* "rapidfuzz/fuzz_cpp.pyx":157
  * 
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
- * 
+ * def WRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp._GetScorerFlagsSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.WRatio", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_processor);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":233
- * 
- * 
- * def _GetScorerFlagsNormalizedDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
+/* "rapidfuzz/fuzz_cpp.pyx":170
+ *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
+ * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_38__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__defaults__", 0);
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 170, 0, __PYX_ERR(0, 170, __pyx_L1_error));
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 170, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults7, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 170, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 170, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 170, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_13_GetScorerFlagsNormalizedDistance(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_21QRatio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_13_GetScorerFlagsNormalizedDistance = {"_GetScorerFlagsNormalizedDistance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_13_GetScorerFlagsNormalizedDistance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_13_GetScorerFlagsNormalizedDistance(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_21QRatio = {"QRatio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_21QRatio, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_21QRatio(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
-  CYTHON_UNUSED PyObject *__pyx_v_kwargs = 0;
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
   #if !CYTHON_METH_FASTCALL
   CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("_GetScorerFlagsNormalizedDistance (wrapper)", 0);
-  if (unlikely(__pyx_nargs > 0)) {
-    __Pyx_RaiseArgtupleInvalid("_GetScorerFlagsNormalizedDistance", 1, 0, 0, __pyx_nargs); return NULL;}
-  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "_GetScorerFlagsNormalizedDistance", 1))) return NULL;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_12_GetScorerFlagsNormalizedDistance(__pyx_self, __pyx_v_kwargs);
+  __Pyx_RefNannySetupContext("QRatio (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    __pyx_defaults7 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults7, __pyx_self);
+    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 170, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 170, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("QRatio", 1, 2, 2, 1); __PYX_ERR(0, 170, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 170, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "QRatio") < 0)) __PYX_ERR(0, 170, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("QRatio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 170, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.QRatio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_20QRatio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
-  __Pyx_XDECREF(__pyx_v_kwargs);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_12_GetScorerFlagsNormalizedDistance(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs) {
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_20QRatio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  double __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  double __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__8)
-  __Pyx_RefNannySetupContext("_GetScorerFlagsNormalizedDistance", 0);
-  __Pyx_TraceCall("_GetScorerFlagsNormalizedDistance", __pyx_f[0], 233, 0, __PYX_ERR(0, 233, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__11)
+  __Pyx_RefNannySetupContext("QRatio", 0);
+  __Pyx_TraceCall("QRatio", __pyx_f[0], 170, 0, __PYX_ERR(0, 170, __pyx_L1_error));
+  __Pyx_INCREF(__pyx_v_processor);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":234
+  /* "rapidfuzz/fuzz_cpp.pyx":171
  * 
- * def _GetScorerFlagsNormalizedDistance(**kwargs):
- *     return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}             # <<<<<<<<<<<<<<
+ * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
+ */
+  __Pyx_TraceLine(171,0,__PYX_ERR(0, 171, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_2) {
+    __pyx_t_1 = 0.0;
+  } else {
+    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 171, __pyx_L1_error)
+    __pyx_t_1 = __pyx_t_3;
+  }
+  __pyx_v_c_score_cutoff = __pyx_t_1;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":174
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
-  __Pyx_TraceLine(234,0,__PYX_ERR(0, 234, __pyx_L1_error))
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 234, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_optimal_score, __pyx_int_0) < 0) __PYX_ERR(0, 234, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_worst_score, __pyx_int_1) < 0) __PYX_ERR(0, 234, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_flags, __pyx_int_32) < 0) __PYX_ERR(0, 234, __pyx_L1_error)
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
+  __Pyx_TraceLine(174,0,__PYX_ERR(0, 174, __pyx_L1_error))
+  __pyx_t_4 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_4) {
+  } else {
+    __pyx_t_2 = __pyx_t_4;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_4 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_4;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":233
+    /* "rapidfuzz/fuzz_cpp.pyx":175
  * 
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
  * 
- * def _GetScorerFlagsNormalizedDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
+ *     if processor is True:
+ */
+    __Pyx_TraceLine(175,0,__PYX_ERR(0, 175, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/fuzz_cpp.pyx":174
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
+  }
+
+  /* "rapidfuzz/fuzz_cpp.pyx":177
+ *         return 0
+ * 
+ *     if processor is True:             # <<<<<<<<<<<<<<
+ *         processor = default_process
+ * 
+ */
+  __Pyx_TraceLine(177,0,__PYX_ERR(0, 177, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_processor == Py_True);
+  if (__pyx_t_2) {
+
+    /* "rapidfuzz/fuzz_cpp.pyx":178
+ * 
+ *     if processor is True:
+ *         processor = default_process             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ */
+    __Pyx_TraceLine(178,0,__PYX_ERR(0, 178, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 178, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF_SET(__pyx_v_processor, __pyx_t_5);
+    __pyx_t_5 = 0;
+
+    /* "rapidfuzz/fuzz_cpp.pyx":177
+ *         return 0
+ * 
+ *     if processor is True:             # <<<<<<<<<<<<<<
+ *         processor = default_process
+ * 
+ */
+  }
+
+  /* "rapidfuzz/fuzz_cpp.pyx":180
+ *         processor = default_process
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
+ *     return QRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(180,0,__PYX_ERR(0, 180, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 180, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 180, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":181
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     return QRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(181,0,__PYX_ERR(0, 181, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_1 = QRatio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 181, __pyx_L1_error)
+  }
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 181, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __pyx_r = __pyx_t_5;
+  __pyx_t_5 = 0;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":170
+ *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp._GetScorerFlagsNormalizedDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.QRatio", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_processor);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":237
+/* "rapidfuzz/fuzz_cpp.pyx":184
+ * 
+ * 
+ * cdef bool GetScorerFlagsFuzzSymmetric(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ */
+
+static bool __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsFuzzSymmetric", __pyx_f[0], 184, 1, __PYX_ERR(0, 184, __pyx_L1_error));
+
+  /* "rapidfuzz/fuzz_cpp.pyx":185
+ * 
+ * cdef bool GetScorerFlagsFuzzSymmetric(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ */
+  __Pyx_TraceLine(185,1,__PYX_ERR(0, 185, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/fuzz_cpp.pyx":186
+ * cdef bool GetScorerFlagsFuzzSymmetric(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 100             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(186,1,__PYX_ERR(0, 186, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 100.0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":187
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(187,1,__PYX_ERR(0, 187, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":188
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(188,1,__PYX_ERR(0, 188, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":184
  * 
  * 
- * def _GetScorerFlagsNormalizedSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
+ * cdef bool GetScorerFlagsFuzzSymmetric(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.GetScorerFlagsFuzzSymmetric", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/fuzz_cpp.pyx":190
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ */
+
+static bool __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsFuzz", __pyx_f[0], 190, 1, __PYX_ERR(0, 190, __pyx_L1_error));
+
+  /* "rapidfuzz/fuzz_cpp.pyx":191
+ * 
+ * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ */
+  __Pyx_TraceLine(191,1,__PYX_ERR(0, 191, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":192
+ * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     dereference(scorer_flags).optimal_score.f64 = 100             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(192,1,__PYX_ERR(0, 192, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 100.0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":193
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(193,1,__PYX_ERR(0, 193, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":194
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * def _GetScorerFlagsSimilarity(**kwargs):
+ */
+  __Pyx_TraceLine(194,1,__PYX_ERR(0, 194, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":190
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.GetScorerFlagsFuzz", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/fuzz_cpp.pyx":196
+ *     return True
+ * 
+ * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
+ *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_15_GetScorerFlagsNormalizedSimilarity(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_23_GetScorerFlagsSimilarity(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_15_GetScorerFlagsNormalizedSimilarity = {"_GetScorerFlagsNormalizedSimilarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_15_GetScorerFlagsNormalizedSimilarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_15_GetScorerFlagsNormalizedSimilarity(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_23_GetScorerFlagsSimilarity = {"_GetScorerFlagsSimilarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_23_GetScorerFlagsSimilarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_23_GetScorerFlagsSimilarity(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   CYTHON_UNUSED PyObject *__pyx_v_kwargs = 0;
   #if !CYTHON_METH_FASTCALL
   CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("_GetScorerFlagsNormalizedSimilarity (wrapper)", 0);
+  __Pyx_RefNannySetupContext("_GetScorerFlagsSimilarity (wrapper)", 0);
   if (unlikely(__pyx_nargs > 0)) {
-    __Pyx_RaiseArgtupleInvalid("_GetScorerFlagsNormalizedSimilarity", 1, 0, 0, __pyx_nargs); return NULL;}
-  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "_GetScorerFlagsNormalizedSimilarity", 1))) return NULL;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_14_GetScorerFlagsNormalizedSimilarity(__pyx_self, __pyx_v_kwargs);
+    __Pyx_RaiseArgtupleInvalid("_GetScorerFlagsSimilarity", 1, 0, 0, __pyx_nargs); return NULL;}
+  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "_GetScorerFlagsSimilarity", 1))) return NULL;
+  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_22_GetScorerFlagsSimilarity(__pyx_self, __pyx_v_kwargs);
 
   /* function exit code */
   __Pyx_XDECREF(__pyx_v_kwargs);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_14_GetScorerFlagsNormalizedSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs) {
+static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_22_GetScorerFlagsSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs) {
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__9)
-  __Pyx_RefNannySetupContext("_GetScorerFlagsNormalizedSimilarity", 0);
-  __Pyx_TraceCall("_GetScorerFlagsNormalizedSimilarity", __pyx_f[0], 237, 0, __PYX_ERR(0, 237, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__12)
+  __Pyx_RefNannySetupContext("_GetScorerFlagsSimilarity", 0);
+  __Pyx_TraceCall("_GetScorerFlagsSimilarity", __pyx_f[0], 196, 0, __PYX_ERR(0, 196, __pyx_L1_error));
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":238
- * 
- * def _GetScorerFlagsNormalizedSimilarity(**kwargs):
- *     return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/fuzz_cpp.pyx":197
  * 
+ * def _GetScorerFlagsSimilarity(**kwargs):
+ *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}             # <<<<<<<<<<<<<<
  * 
+ * cdef dict FuzzContextPy = CreateScorerContextPy(_GetScorerFlagsSimilarity)
  */
-  __Pyx_TraceLine(238,0,__PYX_ERR(0, 238, __pyx_L1_error))
+  __Pyx_TraceLine(197,0,__PYX_ERR(0, 197, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 238, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 197, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_optimal_score, __pyx_int_1) < 0) __PYX_ERR(0, 238, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_worst_score, __pyx_int_0) < 0) __PYX_ERR(0, 238, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_flags, __pyx_int_32) < 0) __PYX_ERR(0, 238, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_optimal_score, __pyx_int_100) < 0) __PYX_ERR(0, 197, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_worst_score, __pyx_int_0) < 0) __PYX_ERR(0, 197, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_flags, __pyx_int_32) < 0) __PYX_ERR(0, 197, __pyx_L1_error)
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":237
- * 
+  /* "rapidfuzz/fuzz_cpp.pyx":196
+ *     return True
  * 
- * def _GetScorerFlagsNormalizedSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
+ * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
+ *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.distance.DamerauLevenshtein_cpp._GetScorerFlagsNormalizedSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp._GetScorerFlagsSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
@@ -5960,18 +7779,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__10);
+        __Pyx_INCREF(__pyx_kp_u__13);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__10);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__10);
+        __Pyx_GIVEREF(__pyx_kp_u__13);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__13);
         __pyx_t_8 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -6059,18 +7878,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__10);
+        __Pyx_INCREF(__pyx_kp_u__13);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__10);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__10);
+        __Pyx_GIVEREF(__pyx_kp_u__13);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__13);
         __pyx_t_8 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -6289,18 +8108,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__10);
+        __Pyx_INCREF(__pyx_kp_u__13);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__10);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__10);
+        __Pyx_GIVEREF(__pyx_kp_u__13);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__13);
         __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -6388,18 +8207,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__10);
+        __Pyx_INCREF(__pyx_kp_u__13);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__10);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__10);
+        __Pyx_GIVEREF(__pyx_kp_u__13);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__13);
         __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -6843,15 +8662,15 @@
     __Pyx_TraceLine(390,0,__PYX_ERR(1, 390, __pyx_L1_error))
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "keys");
       __PYX_ERR(1, 390, __pyx_L1_error)
     }
     __pyx_t_3 = __Pyx_PyDict_Keys(__pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__11, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 390, __pyx_L1_error)
+    __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__14, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_kp_u_Got_unexpected_keyword_arguments);
     __Pyx_GIVEREF(__pyx_kp_u_Got_unexpected_keyword_arguments);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_Got_unexpected_keyword_arguments);
@@ -7149,288 +8968,327 @@
     #define CYTHON_SMALL_CODE
 #endif
 #endif
 /* #### Code section: pystring_table ### */
 
 static __Pyx_StringTabEntry __pyx_string_tab[] = {
   #if CYTHON_USE_MODULE_STATE
-  {0, __pyx_k_Calculates_the_minimum_number_o, sizeof(__pyx_k_Calculates_the_minimum_number_o), 0, 1, 0, 0},
-  {0, __pyx_k_GetScorerFlagsDistance, sizeof(__pyx_k_GetScorerFlagsDistance), 0, 0, 1, 1},
-  {0, __pyx_k_GetScorerFlagsNormalizedDistanc, sizeof(__pyx_k_GetScorerFlagsNormalizedDistanc), 0, 0, 1, 1},
-  {0, __pyx_k_GetScorerFlagsNormalizedSimilar, sizeof(__pyx_k_GetScorerFlagsNormalizedSimilar), 0, 0, 1, 1},
   {0, __pyx_k_GetScorerFlagsSimilarity, sizeof(__pyx_k_GetScorerFlagsSimilarity), 0, 0, 1, 1},
   {0, __pyx_k_Got_unexpected_keyword_arguments, sizeof(__pyx_k_Got_unexpected_keyword_arguments), 0, 1, 0, 0},
   {0, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
+  {0, __pyx_k_QRatio, sizeof(__pyx_k_QRatio), 0, 0, 1, 1},
   {0, __pyx_k_RF_Preprocess, sizeof(__pyx_k_RF_Preprocess), 0, 1, 0, 1},
   {0, __pyx_k_RF_Scorer, sizeof(__pyx_k_RF_Scorer), 0, 0, 1, 1},
   {0, __pyx_k_RF_ScorerPy, sizeof(__pyx_k_RF_ScorerPy), 0, 0, 1, 1},
+  {0, __pyx_k_ScoreAlignment, sizeof(__pyx_k_ScoreAlignment), 0, 0, 1, 1},
   {0, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
-  {0, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
-  {0, __pyx_k__10, sizeof(__pyx_k__10), 0, 1, 0, 0},
-  {0, __pyx_k__11, sizeof(__pyx_k__11), 0, 1, 0, 0},
-  {0, __pyx_k__12, sizeof(__pyx_k__12), 0, 1, 0, 0},
-  {0, __pyx_k__15, sizeof(__pyx_k__15), 0, 0, 1, 1},
+  {0, __pyx_k_WRatio, sizeof(__pyx_k_WRatio), 0, 0, 1, 1},
+  {0, __pyx_k__13, sizeof(__pyx_k__13), 0, 1, 0, 0},
+  {0, __pyx_k__14, sizeof(__pyx_k__14), 0, 1, 0, 0},
+  {0, __pyx_k__15, sizeof(__pyx_k__15), 0, 1, 0, 0},
+  {0, __pyx_k__19, sizeof(__pyx_k__19), 0, 0, 1, 1},
   {0, __pyx_k_array, sizeof(__pyx_k_array), 0, 0, 1, 1},
   {0, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
   {0, __pyx_k_c_score_cutoff, sizeof(__pyx_k_c_score_cutoff), 0, 0, 1, 1},
   {0, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
-  {0, __pyx_k_distance, sizeof(__pyx_k_distance), 0, 0, 1, 1},
-  {0, __pyx_k_distance_line_34, sizeof(__pyx_k_distance_line_34), 0, 1, 0, 0},
+  {0, __pyx_k_default_process, sizeof(__pyx_k_default_process), 0, 0, 1, 1},
+  {0, __pyx_k_distance__initialize_cpp, sizeof(__pyx_k_distance__initialize_cpp), 0, 0, 1, 1},
   {0, __pyx_k_flags, sizeof(__pyx_k_flags), 0, 1, 0, 1},
   {0, __pyx_k_get_scorer_flags, sizeof(__pyx_k_get_scorer_flags), 0, 1, 0, 1},
   {0, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
   {0, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
   {0, __pyx_k_keys, sizeof(__pyx_k_keys), 0, 0, 1, 1},
   {0, __pyx_k_kwargs, sizeof(__pyx_k_kwargs), 0, 0, 1, 1},
   {0, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {0, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
-  {0, __pyx_k_normalized_distance, sizeof(__pyx_k_normalized_distance), 0, 0, 1, 1},
-  {0, __pyx_k_normalized_similarity, sizeof(__pyx_k_normalized_similarity), 0, 0, 1, 1},
   {0, __pyx_k_optimal_score, sizeof(__pyx_k_optimal_score), 0, 1, 0, 1},
+  {0, __pyx_k_partial_ratio, sizeof(__pyx_k_partial_ratio), 0, 0, 1, 1},
+  {0, __pyx_k_partial_ratio_alignment, sizeof(__pyx_k_partial_ratio_alignment), 0, 0, 1, 1},
+  {0, __pyx_k_partial_token_ratio, sizeof(__pyx_k_partial_token_ratio), 0, 0, 1, 1},
+  {0, __pyx_k_partial_token_set_ratio, sizeof(__pyx_k_partial_token_set_ratio), 0, 0, 1, 1},
+  {0, __pyx_k_partial_token_sort_ratio, sizeof(__pyx_k_partial_token_sort_ratio), 0, 0, 1, 1},
   {0, __pyx_k_processor, sizeof(__pyx_k_processor), 0, 0, 1, 1},
   {0, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
-  {0, __pyx_k_rapidfuzz_distance_DamerauLevens, sizeof(__pyx_k_rapidfuzz_distance_DamerauLevens), 0, 0, 1, 1},
+  {0, __pyx_k_rapidfuzz_fuzz_cpp, sizeof(__pyx_k_rapidfuzz_fuzz_cpp), 0, 0, 1, 1},
+  {0, __pyx_k_rapidfuzz_utils, sizeof(__pyx_k_rapidfuzz_utils), 0, 0, 1, 1},
+  {0, __pyx_k_ratio, sizeof(__pyx_k_ratio), 0, 0, 1, 1},
+  {0, __pyx_k_res, sizeof(__pyx_k_res), 0, 0, 1, 1},
   {0, __pyx_k_s1, sizeof(__pyx_k_s1), 0, 0, 1, 1},
   {0, __pyx_k_s1_proc, sizeof(__pyx_k_s1_proc), 0, 0, 1, 1},
   {0, __pyx_k_s2, sizeof(__pyx_k_s2), 0, 0, 1, 1},
   {0, __pyx_k_s2_proc, sizeof(__pyx_k_s2_proc), 0, 0, 1, 1},
   {0, __pyx_k_score_cutoff, sizeof(__pyx_k_score_cutoff), 0, 0, 1, 1},
-  {0, __pyx_k_score_cutoff_has_to_be_0, sizeof(__pyx_k_score_cutoff_has_to_be_0), 0, 1, 0, 0},
   {0, __pyx_k_score_cutoff_has_to_be_in_the_ra, sizeof(__pyx_k_score_cutoff_has_to_be_in_the_ra), 0, 1, 0, 0},
-  {0, __pyx_k_similarity, sizeof(__pyx_k_similarity), 0, 0, 1, 1},
-  {0, __pyx_k_src_rapidfuzz_distance_DamerauLe, sizeof(__pyx_k_src_rapidfuzz_distance_DamerauLe), 0, 0, 1, 0},
+  {0, __pyx_k_src_rapidfuzz_fuzz_cpp_pyx, sizeof(__pyx_k_src_rapidfuzz_fuzz_cpp_pyx), 0, 0, 1, 0},
   {0, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
+  {0, __pyx_k_token_ratio, sizeof(__pyx_k_token_ratio), 0, 0, 1, 1},
+  {0, __pyx_k_token_set_ratio, sizeof(__pyx_k_token_set_ratio), 0, 0, 1, 1},
+  {0, __pyx_k_token_sort_ratio, sizeof(__pyx_k_token_sort_ratio), 0, 0, 1, 1},
   {0, __pyx_k_typecode, sizeof(__pyx_k_typecode), 0, 0, 1, 1},
   {0, __pyx_k_worst_score, sizeof(__pyx_k_worst_score), 0, 1, 0, 1},
   #else
-  {&__pyx_kp_u_Calculates_the_minimum_number_o, __pyx_k_Calculates_the_minimum_number_o, sizeof(__pyx_k_Calculates_the_minimum_number_o), 0, 1, 0, 0},
-  {&__pyx_n_s_GetScorerFlagsDistance, __pyx_k_GetScorerFlagsDistance, sizeof(__pyx_k_GetScorerFlagsDistance), 0, 0, 1, 1},
-  {&__pyx_n_s_GetScorerFlagsNormalizedDistanc, __pyx_k_GetScorerFlagsNormalizedDistanc, sizeof(__pyx_k_GetScorerFlagsNormalizedDistanc), 0, 0, 1, 1},
-  {&__pyx_n_s_GetScorerFlagsNormalizedSimilar, __pyx_k_GetScorerFlagsNormalizedSimilar, sizeof(__pyx_k_GetScorerFlagsNormalizedSimilar), 0, 0, 1, 1},
   {&__pyx_n_s_GetScorerFlagsSimilarity, __pyx_k_GetScorerFlagsSimilarity, sizeof(__pyx_k_GetScorerFlagsSimilarity), 0, 0, 1, 1},
   {&__pyx_kp_u_Got_unexpected_keyword_arguments, __pyx_k_Got_unexpected_keyword_arguments, sizeof(__pyx_k_Got_unexpected_keyword_arguments), 0, 1, 0, 0},
   {&__pyx_n_s_MemoryError, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
+  {&__pyx_n_s_QRatio, __pyx_k_QRatio, sizeof(__pyx_k_QRatio), 0, 0, 1, 1},
   {&__pyx_n_u_RF_Preprocess, __pyx_k_RF_Preprocess, sizeof(__pyx_k_RF_Preprocess), 0, 1, 0, 1},
   {&__pyx_n_s_RF_Scorer, __pyx_k_RF_Scorer, sizeof(__pyx_k_RF_Scorer), 0, 0, 1, 1},
   {&__pyx_n_s_RF_ScorerPy, __pyx_k_RF_ScorerPy, sizeof(__pyx_k_RF_ScorerPy), 0, 0, 1, 1},
+  {&__pyx_n_s_ScoreAlignment, __pyx_k_ScoreAlignment, sizeof(__pyx_k_ScoreAlignment), 0, 0, 1, 1},
   {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
-  {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
-  {&__pyx_kp_u__10, __pyx_k__10, sizeof(__pyx_k__10), 0, 1, 0, 0},
-  {&__pyx_kp_u__11, __pyx_k__11, sizeof(__pyx_k__11), 0, 1, 0, 0},
-  {&__pyx_kp_u__12, __pyx_k__12, sizeof(__pyx_k__12), 0, 1, 0, 0},
-  {&__pyx_n_s__15, __pyx_k__15, sizeof(__pyx_k__15), 0, 0, 1, 1},
+  {&__pyx_n_s_WRatio, __pyx_k_WRatio, sizeof(__pyx_k_WRatio), 0, 0, 1, 1},
+  {&__pyx_kp_u__13, __pyx_k__13, sizeof(__pyx_k__13), 0, 1, 0, 0},
+  {&__pyx_kp_u__14, __pyx_k__14, sizeof(__pyx_k__14), 0, 1, 0, 0},
+  {&__pyx_kp_u__15, __pyx_k__15, sizeof(__pyx_k__15), 0, 1, 0, 0},
+  {&__pyx_n_s__19, __pyx_k__19, sizeof(__pyx_k__19), 0, 0, 1, 1},
   {&__pyx_n_s_array, __pyx_k_array, sizeof(__pyx_k_array), 0, 0, 1, 1},
   {&__pyx_n_s_asyncio_coroutines, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
   {&__pyx_n_s_c_score_cutoff, __pyx_k_c_score_cutoff, sizeof(__pyx_k_c_score_cutoff), 0, 0, 1, 1},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
-  {&__pyx_n_s_distance, __pyx_k_distance, sizeof(__pyx_k_distance), 0, 0, 1, 1},
-  {&__pyx_kp_u_distance_line_34, __pyx_k_distance_line_34, sizeof(__pyx_k_distance_line_34), 0, 1, 0, 0},
+  {&__pyx_n_s_default_process, __pyx_k_default_process, sizeof(__pyx_k_default_process), 0, 0, 1, 1},
+  {&__pyx_n_s_distance__initialize_cpp, __pyx_k_distance__initialize_cpp, sizeof(__pyx_k_distance__initialize_cpp), 0, 0, 1, 1},
   {&__pyx_n_u_flags, __pyx_k_flags, sizeof(__pyx_k_flags), 0, 1, 0, 1},
   {&__pyx_n_u_get_scorer_flags, __pyx_k_get_scorer_flags, sizeof(__pyx_k_get_scorer_flags), 0, 1, 0, 1},
   {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
   {&__pyx_n_s_is_coroutine, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
   {&__pyx_n_s_keys, __pyx_k_keys, sizeof(__pyx_k_keys), 0, 0, 1, 1},
   {&__pyx_n_s_kwargs, __pyx_k_kwargs, sizeof(__pyx_k_kwargs), 0, 0, 1, 1},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
-  {&__pyx_n_s_normalized_distance, __pyx_k_normalized_distance, sizeof(__pyx_k_normalized_distance), 0, 0, 1, 1},
-  {&__pyx_n_s_normalized_similarity, __pyx_k_normalized_similarity, sizeof(__pyx_k_normalized_similarity), 0, 0, 1, 1},
   {&__pyx_n_u_optimal_score, __pyx_k_optimal_score, sizeof(__pyx_k_optimal_score), 0, 1, 0, 1},
+  {&__pyx_n_s_partial_ratio, __pyx_k_partial_ratio, sizeof(__pyx_k_partial_ratio), 0, 0, 1, 1},
+  {&__pyx_n_s_partial_ratio_alignment, __pyx_k_partial_ratio_alignment, sizeof(__pyx_k_partial_ratio_alignment), 0, 0, 1, 1},
+  {&__pyx_n_s_partial_token_ratio, __pyx_k_partial_token_ratio, sizeof(__pyx_k_partial_token_ratio), 0, 0, 1, 1},
+  {&__pyx_n_s_partial_token_set_ratio, __pyx_k_partial_token_set_ratio, sizeof(__pyx_k_partial_token_set_ratio), 0, 0, 1, 1},
+  {&__pyx_n_s_partial_token_sort_ratio, __pyx_k_partial_token_sort_ratio, sizeof(__pyx_k_partial_token_sort_ratio), 0, 0, 1, 1},
   {&__pyx_n_s_processor, __pyx_k_processor, sizeof(__pyx_k_processor), 0, 0, 1, 1},
   {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
-  {&__pyx_n_s_rapidfuzz_distance_DamerauLevens, __pyx_k_rapidfuzz_distance_DamerauLevens, sizeof(__pyx_k_rapidfuzz_distance_DamerauLevens), 0, 0, 1, 1},
+  {&__pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_k_rapidfuzz_fuzz_cpp, sizeof(__pyx_k_rapidfuzz_fuzz_cpp), 0, 0, 1, 1},
+  {&__pyx_n_s_rapidfuzz_utils, __pyx_k_rapidfuzz_utils, sizeof(__pyx_k_rapidfuzz_utils), 0, 0, 1, 1},
+  {&__pyx_n_s_ratio, __pyx_k_ratio, sizeof(__pyx_k_ratio), 0, 0, 1, 1},
+  {&__pyx_n_s_res, __pyx_k_res, sizeof(__pyx_k_res), 0, 0, 1, 1},
   {&__pyx_n_s_s1, __pyx_k_s1, sizeof(__pyx_k_s1), 0, 0, 1, 1},
   {&__pyx_n_s_s1_proc, __pyx_k_s1_proc, sizeof(__pyx_k_s1_proc), 0, 0, 1, 1},
   {&__pyx_n_s_s2, __pyx_k_s2, sizeof(__pyx_k_s2), 0, 0, 1, 1},
   {&__pyx_n_s_s2_proc, __pyx_k_s2_proc, sizeof(__pyx_k_s2_proc), 0, 0, 1, 1},
   {&__pyx_n_s_score_cutoff, __pyx_k_score_cutoff, sizeof(__pyx_k_score_cutoff), 0, 0, 1, 1},
-  {&__pyx_kp_u_score_cutoff_has_to_be_0, __pyx_k_score_cutoff_has_to_be_0, sizeof(__pyx_k_score_cutoff_has_to_be_0), 0, 1, 0, 0},
   {&__pyx_kp_u_score_cutoff_has_to_be_in_the_ra, __pyx_k_score_cutoff_has_to_be_in_the_ra, sizeof(__pyx_k_score_cutoff_has_to_be_in_the_ra), 0, 1, 0, 0},
-  {&__pyx_n_s_similarity, __pyx_k_similarity, sizeof(__pyx_k_similarity), 0, 0, 1, 1},
-  {&__pyx_kp_s_src_rapidfuzz_distance_DamerauLe, __pyx_k_src_rapidfuzz_distance_DamerauLe, sizeof(__pyx_k_src_rapidfuzz_distance_DamerauLe), 0, 0, 1, 0},
+  {&__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_k_src_rapidfuzz_fuzz_cpp_pyx, sizeof(__pyx_k_src_rapidfuzz_fuzz_cpp_pyx), 0, 0, 1, 0},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
+  {&__pyx_n_s_token_ratio, __pyx_k_token_ratio, sizeof(__pyx_k_token_ratio), 0, 0, 1, 1},
+  {&__pyx_n_s_token_set_ratio, __pyx_k_token_set_ratio, sizeof(__pyx_k_token_set_ratio), 0, 0, 1, 1},
+  {&__pyx_n_s_token_sort_ratio, __pyx_k_token_sort_ratio, sizeof(__pyx_k_token_sort_ratio), 0, 0, 1, 1},
   {&__pyx_n_s_typecode, __pyx_k_typecode, sizeof(__pyx_k_typecode), 0, 0, 1, 1},
   {&__pyx_n_u_worst_score, __pyx_k_worst_score, sizeof(__pyx_k_worst_score), 0, 1, 0, 1},
   #endif
   {0, 0, 0, 0, 0, 0, 0}
 };
 /* #### Code section: cached_builtins ### */
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 71, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 251, __pyx_L1_error)
   __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(1, 257, __pyx_L1_error)
   __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 338, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 /* #### Code section: cached_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":71
- *     cdef int64_t c_score_cutoff = INT64_MAX if score_cutoff is None else score_cutoff
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/fuzz_cpp.pyx":50
+ *     bool QRatioInit(                RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ * def ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_score_cutoff_has_to_be_0); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 71, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__2);
-  __Pyx_GIVEREF(__pyx_tuple__2);
+  __pyx_tuple__16 = PyTuple_Pack(7, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_c_score_cutoff, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 50, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__16);
+  __Pyx_GIVEREF(__pyx_tuple__16);
+  __pyx_codeobj_ = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_ratio, 50, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj_)) __PYX_ERR(0, 50, __pyx_L1_error)
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":34
- *     bool DamerauLevenshteinNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
+  /* "rapidfuzz/fuzz_cpp.pyx":61
  * 
- * def distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the minimum number of insertions and deletions
+ * 
+ * def partial_ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __pyx_tuple__13 = PyTuple_Pack(7, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc, __pyx_n_s_c_score_cutoff); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 34, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__13);
-  __Pyx_GIVEREF(__pyx_tuple__13);
-  __pyx_codeobj_ = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__13, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_DamerauLe, __pyx_n_s_distance, 34, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj_)) __PYX_ERR(0, 34, __pyx_L1_error)
+  __pyx_codeobj__2 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_partial_ratio, 61, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__2)) __PYX_ERR(0, 61, __pyx_L1_error)
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":78
+  /* "rapidfuzz/fuzz_cpp.pyx":72
  * 
  * 
- * def similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Damerau Levenshtein similarity in the range [max, 0].
+ * def partial_ratio_alignment(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __pyx_codeobj__3 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__13, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_DamerauLe, __pyx_n_s_similarity, 78, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__3)) __PYX_ERR(0, 78, __pyx_L1_error)
+  __pyx_tuple__17 = PyTuple_Pack(8, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_c_score_cutoff, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc, __pyx_n_s_res); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 72, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__17);
+  __Pyx_GIVEREF(__pyx_tuple__17);
+  __pyx_codeobj__3 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__17, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_partial_ratio_alignment, 72, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__3)) __PYX_ERR(0, 72, __pyx_L1_error)
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":114
+  /* "rapidfuzz/fuzz_cpp.pyx":88
  * 
  * 
- * def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized levenshtein similarity in the range [1, 0].
+ * def token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __pyx_codeobj__4 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__13, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_DamerauLe, __pyx_n_s_normalized_distance, 114, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 114, __pyx_L1_error)
+  __pyx_codeobj__4 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_token_sort_ratio, 88, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 88, __pyx_L1_error)
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":152
+  /* "rapidfuzz/fuzz_cpp.pyx":99
  * 
  * 
- * def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized indel similarity in the range [0, 1].
+ * def token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __pyx_codeobj__5 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__13, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_DamerauLe, __pyx_n_s_normalized_similarity, 152, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __pyx_codeobj__5 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_token_set_ratio, 99, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 99, __pyx_L1_error)
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":225
- * normalized_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedSimilarityContext, NULL, NULL)
+  /* "rapidfuzz/fuzz_cpp.pyx":110
  * 
- * def _GetScorerFlagsDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
  * 
+ * def token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_n_s_kwargs); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 225, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__14);
-  __Pyx_GIVEREF(__pyx_tuple__14);
-  __pyx_codeobj__6 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_DamerauLe, __pyx_n_s_GetScorerFlagsDistance, 225, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__6)) __PYX_ERR(0, 225, __pyx_L1_error)
+  __pyx_codeobj__6 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_token_ratio, 110, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__6)) __PYX_ERR(0, 110, __pyx_L1_error)
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":229
+  /* "rapidfuzz/fuzz_cpp.pyx":121
  * 
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
+ * def partial_token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__7 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_partial_token_sort_ratio, 121, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 121, __pyx_L1_error)
+
+  /* "rapidfuzz/fuzz_cpp.pyx":132
+ * 
  * 
+ * def partial_token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __pyx_codeobj__7 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_DamerauLe, __pyx_n_s_GetScorerFlagsSimilarity, 229, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_partial_token_set_ratio, 132, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 132, __pyx_L1_error)
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":233
+  /* "rapidfuzz/fuzz_cpp.pyx":146
  * 
  * 
- * def _GetScorerFlagsNormalizedDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
+ * def partial_token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__9 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_partial_token_ratio, 146, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__9)) __PYX_ERR(0, 146, __pyx_L1_error)
+
+  /* "rapidfuzz/fuzz_cpp.pyx":157
+ * 
  * 
+ * def WRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_DamerauLe, __pyx_n_s_GetScorerFlagsNormalizedDistanc, 233, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 233, __pyx_L1_error)
+  __pyx_codeobj__10 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_WRatio, 157, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__10)) __PYX_ERR(0, 157, __pyx_L1_error)
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":237
+  /* "rapidfuzz/fuzz_cpp.pyx":170
+ *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
+ * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__11 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_QRatio, 170, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 170, __pyx_L1_error)
+
+  /* "rapidfuzz/fuzz_cpp.pyx":196
+ *     return True
  * 
- * def _GetScorerFlagsNormalizedSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
+ * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
+ *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
  * 
  */
-  __pyx_codeobj__9 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_DamerauLe, __pyx_n_s_GetScorerFlagsNormalizedSimilar, 237, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__9)) __PYX_ERR(0, 237, __pyx_L1_error)
+  __pyx_tuple__18 = PyTuple_Pack(1, __pyx_n_s_kwargs); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 196, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__18);
+  __Pyx_GIVEREF(__pyx_tuple__18);
+  __pyx_codeobj__12 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__18, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_GetScorerFlagsSimilarity, 196, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__12)) __PYX_ERR(0, 196, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 /* #### Code section: init_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitConstants(void) {
   __pyx_umethod_PyDict_Type_keys.type = (PyObject*)&PyDict_Type;
   __pyx_umethod_PyDict_Type_keys.method_name = &__pyx_n_s_keys;
   #if CYTHON_USE_MODULE_STATE
-  if (__Pyx_InitString(__pyx_string_tab[0], &__pyx_kp_u_Calculates_the_minimum_number_o) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[1], &__pyx_n_s_GetScorerFlagsDistance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[2], &__pyx_n_s_GetScorerFlagsNormalizedDistanc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[3], &__pyx_n_s_GetScorerFlagsNormalizedSimilar) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[4], &__pyx_n_s_GetScorerFlagsSimilarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[5], &__pyx_kp_u_Got_unexpected_keyword_arguments) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[6], &__pyx_n_s_MemoryError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[7], &__pyx_n_u_RF_Preprocess) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[8], &__pyx_n_s_RF_Scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[9], &__pyx_n_s_RF_ScorerPy) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[10], &__pyx_n_s_TypeError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[11], &__pyx_n_s_ValueError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[12], &__pyx_kp_u__10) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[13], &__pyx_kp_u__11) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[14], &__pyx_kp_u__12) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[15], &__pyx_n_s__15) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[16], &__pyx_n_s_array) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[17], &__pyx_n_s_asyncio_coroutines) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[18], &__pyx_n_s_c_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[19], &__pyx_n_s_cline_in_traceback) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[20], &__pyx_n_s_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[21], &__pyx_kp_u_distance_line_34) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[22], &__pyx_n_u_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[23], &__pyx_n_u_get_scorer_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[24], &__pyx_n_s_import) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[25], &__pyx_n_s_is_coroutine) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[26], &__pyx_n_s_keys) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[27], &__pyx_n_s_kwargs) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[28], &__pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[29], &__pyx_n_s_name) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[30], &__pyx_n_s_normalized_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[31], &__pyx_n_s_normalized_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[32], &__pyx_n_u_optimal_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[33], &__pyx_n_s_processor) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[34], &__pyx_n_s_range) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[35], &__pyx_n_s_rapidfuzz_distance_DamerauLevens) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[36], &__pyx_n_s_s1) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[37], &__pyx_n_s_s1_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[38], &__pyx_n_s_s2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[39], &__pyx_n_s_s2_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[40], &__pyx_n_s_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[41], &__pyx_kp_u_score_cutoff_has_to_be_0) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[42], &__pyx_kp_u_score_cutoff_has_to_be_in_the_ra) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[43], &__pyx_n_s_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[44], &__pyx_kp_s_src_rapidfuzz_distance_DamerauLe) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[45], &__pyx_n_s_test) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[46], &__pyx_n_s_typecode) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[47], &__pyx_n_u_worst_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[0], &__pyx_n_s_GetScorerFlagsSimilarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[1], &__pyx_kp_u_Got_unexpected_keyword_arguments) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[2], &__pyx_n_s_MemoryError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[3], &__pyx_n_s_QRatio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[4], &__pyx_n_u_RF_Preprocess) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[5], &__pyx_n_s_RF_Scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[6], &__pyx_n_s_RF_ScorerPy) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[7], &__pyx_n_s_ScoreAlignment) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[8], &__pyx_n_s_TypeError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[9], &__pyx_n_s_WRatio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[10], &__pyx_kp_u__13) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[11], &__pyx_kp_u__14) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[12], &__pyx_kp_u__15) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[13], &__pyx_n_s__19) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[14], &__pyx_n_s_array) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[15], &__pyx_n_s_asyncio_coroutines) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[16], &__pyx_n_s_c_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[17], &__pyx_n_s_cline_in_traceback) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[18], &__pyx_n_s_default_process) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[19], &__pyx_n_s_distance__initialize_cpp) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[20], &__pyx_n_u_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[21], &__pyx_n_u_get_scorer_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[22], &__pyx_n_s_import) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[23], &__pyx_n_s_is_coroutine) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[24], &__pyx_n_s_keys) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[25], &__pyx_n_s_kwargs) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[26], &__pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[27], &__pyx_n_s_name) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[28], &__pyx_n_u_optimal_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[29], &__pyx_n_s_partial_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[30], &__pyx_n_s_partial_ratio_alignment) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[31], &__pyx_n_s_partial_token_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[32], &__pyx_n_s_partial_token_set_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[33], &__pyx_n_s_partial_token_sort_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[34], &__pyx_n_s_processor) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[35], &__pyx_n_s_range) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[36], &__pyx_n_s_rapidfuzz_fuzz_cpp) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[37], &__pyx_n_s_rapidfuzz_utils) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[38], &__pyx_n_s_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[39], &__pyx_n_s_res) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[40], &__pyx_n_s_s1) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[41], &__pyx_n_s_s1_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[42], &__pyx_n_s_s2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[43], &__pyx_n_s_s2_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[44], &__pyx_n_s_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[45], &__pyx_kp_u_score_cutoff_has_to_be_in_the_ra) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[46], &__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[47], &__pyx_n_s_test) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[48], &__pyx_n_s_token_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[49], &__pyx_n_s_token_set_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[50], &__pyx_n_s_token_sort_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[51], &__pyx_n_s_typecode) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[52], &__pyx_n_u_worst_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   #endif
   #if !CYTHON_USE_MODULE_STATE
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   #endif
-  __pyx_float_0_0 = PyFloat_FromDouble(0.0); if (unlikely(!__pyx_float_0_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_32 = PyInt_FromLong(32); if (unlikely(!__pyx_int_32)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_64 = PyInt_FromLong(64); if (unlikely(!__pyx_int_64)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_9223372036854775807 = PyInt_FromString((char *)"9223372036854775807", 0, 0); if (unlikely(!__pyx_int_9223372036854775807)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_int_100 = PyInt_FromLong(100); if (unlikely(!__pyx_int_100)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 /* #### Code section: init_globals ### */
 
@@ -7447,14 +9305,15 @@
 static CYTHON_SMALL_CODE int __Pyx_modinit_variable_import_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_function_import_code(void); /*proto*/
 
 static int __Pyx_modinit_global_init_code(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_modinit_global_init_code", 0);
   /*--- Global init code ---*/
+  __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy = ((PyObject*)Py_None); Py_INCREF(Py_None);
   __Pyx_RefNannyFinishContext();
   return 0;
 }
 
 static int __Pyx_modinit_variable_export_code(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_modinit_variable_export_code", 0);
@@ -7524,31 +9383,31 @@
   return 0;
 }
 
 
 #if PY_MAJOR_VERSION >= 3
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
-static int __pyx_pymod_exec_DamerauLevenshtein_cpp(PyObject* module); /*proto*/
+static int __pyx_pymod_exec_fuzz_cpp(PyObject* module); /*proto*/
 static PyModuleDef_Slot __pyx_moduledef_slots[] = {
   {Py_mod_create, (void*)__pyx_pymod_create},
-  {Py_mod_exec, (void*)__pyx_pymod_exec_DamerauLevenshtein_cpp},
+  {Py_mod_exec, (void*)__pyx_pymod_exec_fuzz_cpp},
   {0, NULL}
 };
 #endif
 
 #ifdef __cplusplus
 namespace {
   struct PyModuleDef __pyx_moduledef =
   #else
   static struct PyModuleDef __pyx_moduledef =
   #endif
   {
       PyModuleDef_HEAD_INIT,
-      "DamerauLevenshtein_cpp",
+      "fuzz_cpp",
       0, /* m_doc */
     #if CYTHON_PEP489_MULTI_PHASE_INIT
       0, /* m_size */
     #elif CYTHON_USE_MODULE_STATE
       sizeof(__pyx_mstate), /* m_size */
     #else
       -1, /* m_size */
@@ -7588,19 +9447,19 @@
 #else
 #define __Pyx_PyMODINIT_FUNC PyObject *
 #endif
 #endif
 
 
 #if PY_MAJOR_VERSION < 3
-__Pyx_PyMODINIT_FUNC initDamerauLevenshtein_cpp(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC initDamerauLevenshtein_cpp(void)
+__Pyx_PyMODINIT_FUNC initfuzz_cpp(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC initfuzz_cpp(void)
 #else
-__Pyx_PyMODINIT_FUNC PyInit_DamerauLevenshtein_cpp(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC PyInit_DamerauLevenshtein_cpp(void)
+__Pyx_PyMODINIT_FUNC PyInit_fuzz_cpp(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC PyInit_fuzz_cpp(void)
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 {
   return PyModuleDef_Init(&__pyx_moduledef);
 }
 static CYTHON_SMALL_CODE int __Pyx_check_single_interpreter(void) {
     #if PY_VERSION_HEX >= 0x030700A1
     static PY_INT64_T main_interpreter_id = -1;
@@ -7673,43 +9532,44 @@
     return module;
 bad:
     Py_XDECREF(module);
     return NULL;
 }
 
 
-static CYTHON_SMALL_CODE int __pyx_pymod_exec_DamerauLevenshtein_cpp(PyObject *__pyx_pyinit_module)
+static CYTHON_SMALL_CODE int __pyx_pymod_exec_fuzz_cpp(PyObject *__pyx_pyinit_module)
 #endif
 #endif
 {
   int stringtab_initialized = 0;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
+  bool __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   if (__pyx_m) {
     if (__pyx_m == __pyx_pyinit_module) return 0;
-    PyErr_SetString(PyExc_RuntimeError, "Module 'DamerauLevenshtein_cpp' has already been imported. Re-initialisation is not supported.");
+    PyErr_SetString(PyExc_RuntimeError, "Module 'fuzz_cpp' has already been imported. Re-initialisation is not supported.");
     return -1;
   }
   #elif PY_MAJOR_VERSION >= 3
   if (__pyx_m) return __Pyx_NewRef(__pyx_m);
   #endif
   /*--- Module creation code ---*/
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   __pyx_m = __pyx_pyinit_module;
   Py_INCREF(__pyx_m);
   #else
   #if PY_MAJOR_VERSION < 3
-  __pyx_m = Py_InitModule4("DamerauLevenshtein_cpp", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
+  __pyx_m = Py_InitModule4("fuzz_cpp", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
   if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
   #elif CYTHON_COMPILING_IN_LIMITED_API
   __pyx_t_1 = PyModule_Create(&__pyx_moduledef); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   {
     int add_module_result = PyState_AddModule(__pyx_t_1, &__pyx_moduledef);
     Py_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (unlikely((add_module_result < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -7732,15 +9592,15 @@
 if (!__Pyx_RefNanny) {
   PyErr_Clear();
   __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
   if (!__Pyx_RefNanny)
       Py_FatalError("failed to import 'refnanny' module");
 }
 #endif
-  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_DamerauLevenshtein_cpp(void)", 0);
+  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_fuzz_cpp(void)", 0);
   if (__Pyx_check_binary_version() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #ifdef __Pxy_PyFrame_Initialize_Offsets
   __Pxy_PyFrame_Initialize_Offsets();
   #endif
   __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -7770,22 +9630,22 @@
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   stringtab_initialized = 1;
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  if (__pyx_module_is_main_rapidfuzz__distance__DamerauLevenshtein_cpp) {
+  if (__pyx_module_is_main_rapidfuzz__fuzz_cpp) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   }
   #if PY_MAJOR_VERSION >= 3
   {
     PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
-    if (!PyDict_GetItemString(modules, "rapidfuzz.distance.DamerauLevenshtein_cpp")) {
-      if (unlikely((PyDict_SetItemString(modules, "rapidfuzz.distance.DamerauLevenshtein_cpp", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
+    if (!PyDict_GetItemString(modules, "rapidfuzz.fuzz_cpp")) {
+      if (unlikely((PyDict_SetItemString(modules, "rapidfuzz.fuzz_cpp", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
     }
   }
   #endif
   /*--- Builtin init code ---*/
   if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Constants init code ---*/
   if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -7797,418 +9657,639 @@
   if (unlikely((__Pyx_modinit_type_import_code() < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  __Pyx_TraceCall("__Pyx_PyMODINIT_FUNC PyInit_DamerauLevenshtein_cpp(void)", __pyx_f[0], 1, 0, __PYX_ERR(0, 1, __pyx_L1_error));
+  __Pyx_TraceCall("__Pyx_PyMODINIT_FUNC PyInit_fuzz_cpp(void)", __pyx_f[0], 1, 0, __PYX_ERR(0, 1, __pyx_L1_error));
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":12
- * )
- * # required for preprocess_strings
- * from array import array             # <<<<<<<<<<<<<<
- * from cpp_common cimport RF_StringWrapper, preprocess_strings, NoKwargsInit, CreateScorerContext
+  /* "rapidfuzz/fuzz_cpp.pyx":4
+ * # cython: language_level=3, binding=True, linetrace=True
  * 
+ * from .distance._initialize_cpp import ScoreAlignment             # <<<<<<<<<<<<<<
+ * 
+ * from rapidfuzz_capi cimport (
+ */
+  __Pyx_TraceLine(4,0,__PYX_ERR(0, 4, __pyx_L1_error))
+  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(__pyx_n_s_ScoreAlignment);
+  __Pyx_GIVEREF(__pyx_n_s_ScoreAlignment);
+  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_ScoreAlignment);
+  __pyx_t_3 = __Pyx_Import(__pyx_n_s_distance__initialize_cpp, __pyx_t_2, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_ScoreAlignment); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ScoreAlignment, __pyx_t_2) < 0) __PYX_ERR(0, 4, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":12
+ * 
+ * # required for preprocess_strings
+ * from rapidfuzz.utils import default_process             # <<<<<<<<<<<<<<
+ * from array import array
+ * from cpp_common cimport (
  */
   __Pyx_TraceLine(12,0,__PYX_ERR(0, 12, __pyx_L1_error))
-  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 12, __pyx_L1_error)
+  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 12, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_INCREF(__pyx_n_s_default_process);
+  __Pyx_GIVEREF(__pyx_n_s_default_process);
+  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_default_process);
+  __pyx_t_2 = __Pyx_Import(__pyx_n_s_rapidfuzz_utils, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 12, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 12, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_default_process, __pyx_t_3) < 0) __PYX_ERR(0, 12, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":13
+ * # required for preprocess_strings
+ * from rapidfuzz.utils import default_process
+ * from array import array             # <<<<<<<<<<<<<<
+ * from cpp_common cimport (
+ *     RF_StringWrapper, preprocess_strings, RfScoreAlignment, NoKwargsInit,
+ */
+  __Pyx_TraceLine(13,0,__PYX_ERR(0, 13, __pyx_L1_error))
+  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 13, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_n_s_array);
   __Pyx_GIVEREF(__pyx_n_s_array);
   PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_array);
-  __pyx_t_3 = __Pyx_Import(__pyx_n_s_array, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 12, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Import(__pyx_n_s_array, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 13, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 12, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 13, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_2) < 0) __PYX_ERR(0, 12, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_2) < 0) __PYX_ERR(0, 13, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":34
- *     bool DamerauLevenshteinNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
+  /* "rapidfuzz/fuzz_cpp.pyx":23
+ * from cython.operator cimport dereference
  * 
- * def distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the minimum number of insertions and deletions
+ * from array import array             # <<<<<<<<<<<<<<
+ * 
+ * cdef extern from "fuzz_cpp.hpp":
  */
-  __Pyx_TraceLine(34,0,__PYX_ERR(0, 34, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 34, __pyx_L1_error)
+  __Pyx_TraceLine(23,0,__PYX_ERR(0, 23, __pyx_L1_error))
+  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_1distance, 0, __pyx_n_s_distance, NULL, __pyx_n_s_rapidfuzz_distance_DamerauLevens, __pyx_d, ((PyObject *)__pyx_codeobj_)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 34, __pyx_L1_error)
+  __Pyx_INCREF(__pyx_n_s_array);
+  __Pyx_GIVEREF(__pyx_n_s_array);
+  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_array);
+  __pyx_t_2 = __Pyx_Import(__pyx_n_s_array, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_distance, __pyx_t_2) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_3) < 0) __PYX_ERR(0, 23, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":78
- * 
+  /* "rapidfuzz/fuzz_cpp.pyx":50
+ *     bool QRatioInit(                RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
  * 
- * def similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Damerau Levenshtein similarity in the range [max, 0].
+ * def ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __Pyx_TraceLine(78,0,__PYX_ERR(0, 78, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 78, __pyx_L1_error)
+  __Pyx_TraceLine(50,0,__PYX_ERR(0, 50, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 50, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 78, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 78, __pyx_L1_error)
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_3similarity, 0, __pyx_n_s_similarity, NULL, __pyx_n_s_rapidfuzz_distance_DamerauLevens, __pyx_d, ((PyObject *)__pyx_codeobj__3)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 78, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_1ratio, 0, __pyx_n_s_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj_)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 50, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_similarity, __pyx_t_3) < 0) __PYX_ERR(0, 78, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":114
+  /* "rapidfuzz/fuzz_cpp.pyx":61
  * 
  * 
- * def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized levenshtein similarity in the range [1, 0].
+ * def partial_ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __Pyx_TraceLine(114,0,__PYX_ERR(0, 114, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 114, __pyx_L1_error)
+  __Pyx_TraceLine(61,0,__PYX_ERR(0, 61, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 61, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_5normalized_distance, 0, __pyx_n_s_normalized_distance, NULL, __pyx_n_s_rapidfuzz_distance_DamerauLevens, __pyx_d, ((PyObject *)__pyx_codeobj__4)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 114, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 61, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 61, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_3partial_ratio, 0, __pyx_n_s_partial_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__2)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 61, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_normalized_distance, __pyx_t_2) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_partial_ratio, __pyx_t_2) < 0) __PYX_ERR(0, 61, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":152
+  /* "rapidfuzz/fuzz_cpp.pyx":72
  * 
  * 
- * def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized indel similarity in the range [0, 1].
+ * def partial_ratio_alignment(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __Pyx_TraceLine(152,0,__PYX_ERR(0, 152, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 152, __pyx_L1_error)
+  __Pyx_TraceLine(72,0,__PYX_ERR(0, 72, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 72, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 152, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 152, __pyx_L1_error)
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_7normalized_similarity, 0, __pyx_n_s_normalized_similarity, NULL, __pyx_n_s_rapidfuzz_distance_DamerauLevens, __pyx_d, ((PyObject *)__pyx_codeobj__5)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 152, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 72, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 72, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_5partial_ratio_alignment, 0, __pyx_n_s_partial_ratio_alignment, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__3)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 72, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_normalized_similarity, __pyx_t_3) < 0) __PYX_ERR(0, 152, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_partial_ratio_alignment, __pyx_t_3) < 0) __PYX_ERR(0, 72, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":88
+ * 
+ * 
+ * def token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(88,0,__PYX_ERR(0, 88, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_7token_sort_ratio, 0, __pyx_n_s_token_sort_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__4)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults), 1)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_24__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_token_sort_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 88, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":189
- *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+  /* "rapidfuzz/fuzz_cpp.pyx":99
+ * 
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = 0
+ * def token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __Pyx_TraceLine(189,0,__PYX_ERR(0, 189, __pyx_L1_error))
+  __Pyx_TraceLine(99,0,__PYX_ERR(0, 99, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_9token_set_ratio, 0, __pyx_n_s_token_set_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__5)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults1), 1)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_26__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_token_set_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
+  /* "rapidfuzz/fuzz_cpp.pyx":110
+ * 
+ * 
+ * def token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(110,0,__PYX_ERR(0, 110, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_11token_ratio, 0, __pyx_n_s_token_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__6)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults2), 1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_28__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_token_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":195
- *     return True
+  /* "rapidfuzz/fuzz_cpp.pyx":121
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ * 
+ * def partial_token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __Pyx_TraceLine(195,0,__PYX_ERR(0, 195, __pyx_L1_error))
+  __Pyx_TraceLine(121,0,__PYX_ERR(0, 121, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_13partial_token_sort_ratio, 0, __pyx_n_s_partial_token_sort_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__7)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults3), 1)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_30__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_partial_token_sort_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
+  /* "rapidfuzz/fuzz_cpp.pyx":132
+ * 
+ * 
+ * def partial_token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(132,0,__PYX_ERR(0, 132, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_15partial_token_set_ratio, 0, __pyx_n_s_partial_token_set_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults4), 1)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_Defaults(__pyx_defaults4, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_32__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_partial_token_set_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":201
- *     return True
+  /* "rapidfuzz/fuzz_cpp.pyx":146
+ * 
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ * def partial_token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __Pyx_TraceLine(201,0,__PYX_ERR(0, 201, __pyx_L1_error))
+  __Pyx_TraceLine(146,0,__PYX_ERR(0, 146, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_17partial_token_ratio, 0, __pyx_n_s_partial_token_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__9)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 146, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults5), 1)) __PYX_ERR(0, 146, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 146, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_34__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_partial_token_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 146, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/fuzz_cpp.pyx":157
+ * 
+ * 
+ * def WRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(157,0,__PYX_ERR(0, 157, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_19WRatio, 0, __pyx_n_s_WRatio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__10)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults6), 1)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 157, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_Defaults(__pyx_defaults6, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_36__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_WRatio, __pyx_t_3) < 0) __PYX_ERR(0, 157, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
+  /* "rapidfuzz/fuzz_cpp.pyx":170
+ *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(170,0,__PYX_ERR(0, 170, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_21QRatio, 0, __pyx_n_s_QRatio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__11)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 170, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults7), 1)) __PYX_ERR(0, 170, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 170, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_Defaults(__pyx_defaults7, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_38__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_QRatio, __pyx_t_3) < 0) __PYX_ERR(0, 170, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":207
- *     return True
+  /* "rapidfuzz/fuzz_cpp.pyx":184
+ * 
  * 
- * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ * cdef bool GetScorerFlagsFuzzSymmetric(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
  *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).optimal_score.f64 = 100
  */
-  __Pyx_TraceLine(207,0,__PYX_ERR(0, 207, __pyx_L1_error))
+  __Pyx_TraceLine(184,0,__PYX_ERR(0, 184, __pyx_L1_error))
 
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":213
+  /* "rapidfuzz/fuzz_cpp.pyx":190
  *     return True
  * 
- * cdef RF_Scorer DamerauLevenshteinDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinDistance, DamerauLevenshteinDistanceInit)             # <<<<<<<<<<<<<<
- * distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinDistanceContext, NULL, NULL)
+ * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     dereference(scorer_flags).optimal_score.f64 = 100
+ */
+  __Pyx_TraceLine(190,0,__PYX_ERR(0, 190, __pyx_L1_error))
+
+
+  /* "rapidfuzz/fuzz_cpp.pyx":196
+ *     return True
+ * 
+ * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
+ *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
  * 
  */
-  __Pyx_TraceLine(213,0,__PYX_ERR(0, 213, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinDistance, DamerauLevenshteinDistanceInit);
+  __Pyx_TraceLine(196,0,__PYX_ERR(0, 196, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_23_GetScorerFlagsSimilarity, 0, __pyx_n_s_GetScorerFlagsSimilarity, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__12)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 196, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_GetScorerFlagsSimilarity, __pyx_t_3) < 0) __PYX_ERR(0, 196, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":214
+  /* "rapidfuzz/fuzz_cpp.pyx":199
+ *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
  * 
- * cdef RF_Scorer DamerauLevenshteinDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinDistance, DamerauLevenshteinDistanceInit)
- * distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * cdef dict FuzzContextPy = CreateScorerContextPy(_GetScorerFlagsSimilarity)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer DamerauLevenshteinNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedDistance, DamerauLevenshteinNormalizedDistanceInit)
+ * cdef RF_Scorer RatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, RatioInit)
  */
-  __Pyx_TraceLine(214,0,__PYX_ERR(0, 214, __pyx_L1_error))
-  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __Pyx_TraceLine(199,0,__PYX_ERR(0, 199, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_GetScorerFlagsSimilarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_10cpp_common_CreateScorerContextPy(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 214, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_XGOTREF(__pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy);
+  __Pyx_DECREF_SET(__pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy, ((PyObject*)__pyx_t_2));
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":216
- * distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinDistanceContext, NULL, NULL)
+  /* "rapidfuzz/fuzz_cpp.pyx":201
+ * cdef dict FuzzContextPy = CreateScorerContextPy(_GetScorerFlagsSimilarity)
  * 
- * cdef RF_Scorer DamerauLevenshteinNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedDistance, DamerauLevenshteinNormalizedDistanceInit)             # <<<<<<<<<<<<<<
- * normalized_distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedDistanceContext, NULL, NULL)
+ * cdef RF_Scorer RatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, RatioInit)             # <<<<<<<<<<<<<<
+ * AddScorerContext(ratio, FuzzContextPy, &RatioContext)
  * 
  */
-  __Pyx_TraceLine(216,0,__PYX_ERR(0, 216, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinNormalizedDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinNormalizedDistance, DamerauLevenshteinNormalizedDistanceInit);
+  __Pyx_TraceLine(201,0,__PYX_ERR(0, 201, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8fuzz_cpp_RatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric, RatioInit);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":217
+  /* "rapidfuzz/fuzz_cpp.pyx":202
  * 
- * cdef RF_Scorer DamerauLevenshteinNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedDistance, DamerauLevenshteinNormalizedDistanceInit)
- * normalized_distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer RatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, RatioInit)
+ * AddScorerContext(ratio, FuzzContextPy, &RatioContext)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer DamerauLevenshteinSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinSimilarity, DamerauLevenshteinSimilarityInit)
+ * cdef RF_Scorer PartialRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialRatioInit)
  */
-  __Pyx_TraceLine(217,0,__PYX_ERR(0, 217, __pyx_L1_error))
-  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinNormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 217, __pyx_L1_error)
+  __Pyx_TraceLine(202,0,__PYX_ERR(0, 202, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_ratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 202, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_normalized_distance); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 217, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 217, __pyx_L1_error)
+  __pyx_t_3 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
+  __Pyx_INCREF(__pyx_t_3);
+  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_2, __pyx_t_3, (&__pyx_v_9rapidfuzz_8fuzz_cpp_RatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 202, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":219
- * normalized_distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedDistanceContext, NULL, NULL)
+  /* "rapidfuzz/fuzz_cpp.pyx":204
+ * AddScorerContext(ratio, FuzzContextPy, &RatioContext)
  * 
- * cdef RF_Scorer DamerauLevenshteinSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinSimilarity, DamerauLevenshteinSimilarityInit)             # <<<<<<<<<<<<<<
- * similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinSimilarityContext, NULL, NULL)
+ * cdef RF_Scorer PartialRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialRatioInit)             # <<<<<<<<<<<<<<
+ * AddScorerContext(partial_ratio, FuzzContextPy, &PartialRatioContext)
  * 
  */
-  __Pyx_TraceLine(219,0,__PYX_ERR(0, 219, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinSimilarity, DamerauLevenshteinSimilarityInit);
+  __Pyx_TraceLine(204,0,__PYX_ERR(0, 204, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8fuzz_cpp_PartialRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz, PartialRatioInit);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":220
+  /* "rapidfuzz/fuzz_cpp.pyx":205
  * 
- * cdef RF_Scorer DamerauLevenshteinSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinSimilarity, DamerauLevenshteinSimilarityInit)
- * similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer PartialRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialRatioInit)
+ * AddScorerContext(partial_ratio, FuzzContextPy, &PartialRatioContext)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer DamerauLevenshteinNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedSimilarity, DamerauLevenshteinNormalizedSimilarityInit)
+ * cdef RF_Scorer TokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSortRatioInit)
  */
-  __Pyx_TraceLine(220,0,__PYX_ERR(0, 220, __pyx_L1_error))
-  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 220, __pyx_L1_error)
+  __Pyx_TraceLine(205,0,__PYX_ERR(0, 205, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_partial_ratio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 205, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_similarity); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 220, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 220, __pyx_L1_error)
+  __pyx_t_2 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
+  __Pyx_INCREF(__pyx_t_2);
+  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_3, __pyx_t_2, (&__pyx_v_9rapidfuzz_8fuzz_cpp_PartialRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 205, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":222
- * similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinSimilarityContext, NULL, NULL)
+  /* "rapidfuzz/fuzz_cpp.pyx":207
+ * AddScorerContext(partial_ratio, FuzzContextPy, &PartialRatioContext)
  * 
- * cdef RF_Scorer DamerauLevenshteinNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedSimilarity, DamerauLevenshteinNormalizedSimilarityInit)             # <<<<<<<<<<<<<<
- * normalized_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedSimilarityContext, NULL, NULL)
+ * cdef RF_Scorer TokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSortRatioInit)             # <<<<<<<<<<<<<<
+ * AddScorerContext(token_sort_ratio, FuzzContextPy, &TokenSortRatioContext)
  * 
  */
-  __Pyx_TraceLine(222,0,__PYX_ERR(0, 222, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinNormalizedSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_GetScorerFlagsDamerauLevenshteinNormalizedSimilarity, DamerauLevenshteinNormalizedSimilarityInit);
+  __Pyx_TraceLine(207,0,__PYX_ERR(0, 207, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8fuzz_cpp_TokenSortRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric, TokenSortRatioInit);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":223
+  /* "rapidfuzz/fuzz_cpp.pyx":208
  * 
- * cdef RF_Scorer DamerauLevenshteinNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedSimilarity, DamerauLevenshteinNormalizedSimilarityInit)
- * normalized_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer TokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSortRatioInit)
+ * AddScorerContext(token_sort_ratio, FuzzContextPy, &TokenSortRatioContext)             # <<<<<<<<<<<<<<
  * 
- * def _GetScorerFlagsDistance(**kwargs):
+ * cdef RF_Scorer TokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSetRatioInit)
  */
-  __Pyx_TraceLine(223,0,__PYX_ERR(0, 223, __pyx_L1_error))
-  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_DamerauLevenshteinNormalizedSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 223, __pyx_L1_error)
+  __Pyx_TraceLine(208,0,__PYX_ERR(0, 208, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_token_sort_ratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_normalized_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 223, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 223, __pyx_L1_error)
+  __pyx_t_3 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
+  __Pyx_INCREF(__pyx_t_3);
+  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_2, __pyx_t_3, (&__pyx_v_9rapidfuzz_8fuzz_cpp_TokenSortRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 208, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":225
- * normalized_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedSimilarityContext, NULL, NULL)
+  /* "rapidfuzz/fuzz_cpp.pyx":210
+ * AddScorerContext(token_sort_ratio, FuzzContextPy, &TokenSortRatioContext)
  * 
- * def _GetScorerFlagsDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
+ * cdef RF_Scorer TokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSetRatioInit)             # <<<<<<<<<<<<<<
+ * AddScorerContext(token_set_ratio, FuzzContextPy, &TokenSetRatioContext)
  * 
  */
-  __Pyx_TraceLine(225,0,__PYX_ERR(0, 225, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_9_GetScorerFlagsDistance, 0, __pyx_n_s_GetScorerFlagsDistance, NULL, __pyx_n_s_rapidfuzz_distance_DamerauLevens, __pyx_d, ((PyObject *)__pyx_codeobj__6)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 225, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_GetScorerFlagsDistance, __pyx_t_3) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_TraceLine(210,0,__PYX_ERR(0, 210, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8fuzz_cpp_TokenSetRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric, TokenSetRatioInit);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":229
+  /* "rapidfuzz/fuzz_cpp.pyx":211
  * 
+ * cdef RF_Scorer TokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSetRatioInit)
+ * AddScorerContext(token_set_ratio, FuzzContextPy, &TokenSetRatioContext)             # <<<<<<<<<<<<<<
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
- * 
+ * cdef RF_Scorer TokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenRatioInit)
  */
-  __Pyx_TraceLine(229,0,__PYX_ERR(0, 229, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_11_GetScorerFlagsSimilarity, 0, __pyx_n_s_GetScorerFlagsSimilarity, NULL, __pyx_n_s_rapidfuzz_distance_DamerauLevens, __pyx_d, ((PyObject *)__pyx_codeobj__7)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 229, __pyx_L1_error)
+  __Pyx_TraceLine(211,0,__PYX_ERR(0, 211, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_token_set_ratio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 211, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_GetScorerFlagsSimilarity, __pyx_t_3) < 0) __PYX_ERR(0, 229, __pyx_L1_error)
+  __pyx_t_2 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
+  __Pyx_INCREF(__pyx_t_2);
+  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_3, __pyx_t_2, (&__pyx_v_9rapidfuzz_8fuzz_cpp_TokenSetRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 211, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":233
+  /* "rapidfuzz/fuzz_cpp.pyx":213
+ * AddScorerContext(token_set_ratio, FuzzContextPy, &TokenSetRatioContext)
+ * 
+ * cdef RF_Scorer TokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenRatioInit)             # <<<<<<<<<<<<<<
+ * AddScorerContext(token_ratio, FuzzContextPy, &TokenRatioContext)
  * 
+ */
+  __Pyx_TraceLine(213,0,__PYX_ERR(0, 213, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8fuzz_cpp_TokenRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric, TokenRatioInit);
+
+  /* "rapidfuzz/fuzz_cpp.pyx":214
  * 
- * def _GetScorerFlagsNormalizedDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
+ * cdef RF_Scorer TokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenRatioInit)
+ * AddScorerContext(token_ratio, FuzzContextPy, &TokenRatioContext)             # <<<<<<<<<<<<<<
  * 
+ * cdef RF_Scorer PartialTokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSortRatioInit)
  */
-  __Pyx_TraceLine(233,0,__PYX_ERR(0, 233, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_13_GetScorerFlagsNormalizedDistance, 0, __pyx_n_s_GetScorerFlagsNormalizedDistanc, NULL, __pyx_n_s_rapidfuzz_distance_DamerauLevens, __pyx_d, ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 233, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_GetScorerFlagsNormalizedDistanc, __pyx_t_3) < 0) __PYX_ERR(0, 233, __pyx_L1_error)
+  __Pyx_TraceLine(214,0,__PYX_ERR(0, 214, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_token_ratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
+  __Pyx_INCREF(__pyx_t_3);
+  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_2, __pyx_t_3, (&__pyx_v_9rapidfuzz_8fuzz_cpp_TokenRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 214, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":237
+  /* "rapidfuzz/fuzz_cpp.pyx":216
+ * AddScorerContext(token_ratio, FuzzContextPy, &TokenRatioContext)
+ * 
+ * cdef RF_Scorer PartialTokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSortRatioInit)             # <<<<<<<<<<<<<<
+ * AddScorerContext(partial_token_sort_ratio, FuzzContextPy, &PartialTokenSortRatioContext)
  * 
+ */
+  __Pyx_TraceLine(216,0,__PYX_ERR(0, 216, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSortRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz, PartialTokenSortRatioInit);
+
+  /* "rapidfuzz/fuzz_cpp.pyx":217
  * 
- * def _GetScorerFlagsNormalizedSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
+ * cdef RF_Scorer PartialTokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSortRatioInit)
+ * AddScorerContext(partial_token_sort_ratio, FuzzContextPy, &PartialTokenSortRatioContext)             # <<<<<<<<<<<<<<
  * 
+ * cdef RF_Scorer PartialTokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSetRatioInit)
  */
-  __Pyx_TraceLine(237,0,__PYX_ERR(0, 237, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_22DamerauLevenshtein_cpp_15_GetScorerFlagsNormalizedSimilarity, 0, __pyx_n_s_GetScorerFlagsNormalizedSimilar, NULL, __pyx_n_s_rapidfuzz_distance_DamerauLevens, __pyx_d, ((PyObject *)__pyx_codeobj__9)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 237, __pyx_L1_error)
+  __Pyx_TraceLine(217,0,__PYX_ERR(0, 217, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_partial_token_sort_ratio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 217, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_GetScorerFlagsNormalizedSimilar, __pyx_t_3) < 0) __PYX_ERR(0, 237, __pyx_L1_error)
+  __pyx_t_2 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
+  __Pyx_INCREF(__pyx_t_2);
+  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_3, __pyx_t_2, (&__pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSortRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 217, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":241
+  /* "rapidfuzz/fuzz_cpp.pyx":219
+ * AddScorerContext(partial_token_sort_ratio, FuzzContextPy, &PartialTokenSortRatioContext)
  * 
+ * cdef RF_Scorer PartialTokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSetRatioInit)             # <<<<<<<<<<<<<<
+ * AddScorerContext(partial_token_set_ratio, FuzzContextPy, &PartialTokenSetRatioContext)
  * 
- * distance._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}             # <<<<<<<<<<<<<<
+ */
+  __Pyx_TraceLine(219,0,__PYX_ERR(0, 219, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSetRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz, PartialTokenSetRatioInit);
+
+  /* "rapidfuzz/fuzz_cpp.pyx":220
+ * 
+ * cdef RF_Scorer PartialTokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSetRatioInit)
+ * AddScorerContext(partial_token_set_ratio, FuzzContextPy, &PartialTokenSetRatioContext)             # <<<<<<<<<<<<<<
  * 
- * similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
+ * cdef RF_Scorer PartialTokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenRatioInit)
  */
-  __Pyx_TraceLine(241,0,__PYX_ERR(0, 241, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 241, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_GetScorerFlagsDistance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 241, __pyx_L1_error)
+  __Pyx_TraceLine(220,0,__PYX_ERR(0, 220, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_partial_token_set_ratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_get_scorer_flags, __pyx_t_2) < 0) __PYX_ERR(0, 241, __pyx_L1_error)
+  __pyx_t_3 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
+  __Pyx_INCREF(__pyx_t_3);
+  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_2, __pyx_t_3, (&__pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSetRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 220, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 241, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_ScorerPy, __pyx_t_3) < 0) __PYX_ERR(0, 241, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":243
- * distance._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}
+  /* "rapidfuzz/fuzz_cpp.pyx":222
+ * AddScorerContext(partial_token_set_ratio, FuzzContextPy, &PartialTokenSetRatioContext)
  * 
- * similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer PartialTokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenRatioInit)             # <<<<<<<<<<<<<<
+ * AddScorerContext(partial_token_ratio, FuzzContextPy, &PartialTokenRatioContext)
  * 
- * normalized_distance._RF_ScorerPy = {
  */
-  __Pyx_TraceLine(243,0,__PYX_ERR(0, 243, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 243, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_GetScorerFlagsSimilarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 243, __pyx_L1_error)
+  __Pyx_TraceLine(222,0,__PYX_ERR(0, 222, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz, PartialTokenRatioInit);
+
+  /* "rapidfuzz/fuzz_cpp.pyx":223
+ * 
+ * cdef RF_Scorer PartialTokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenRatioInit)
+ * AddScorerContext(partial_token_ratio, FuzzContextPy, &PartialTokenRatioContext)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer WRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, WRatioInit)
+ */
+  __Pyx_TraceLine(223,0,__PYX_ERR(0, 223, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_partial_token_ratio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 223, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_get_scorer_flags, __pyx_t_3) < 0) __PYX_ERR(0, 243, __pyx_L1_error)
+  __pyx_t_2 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
+  __Pyx_INCREF(__pyx_t_2);
+  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_3, __pyx_t_2, (&__pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 223, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 243, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_ScorerPy, __pyx_t_2) < 0) __PYX_ERR(0, 243, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":246
+  /* "rapidfuzz/fuzz_cpp.pyx":225
+ * AddScorerContext(partial_token_ratio, FuzzContextPy, &PartialTokenRatioContext)
  * 
- * normalized_distance._RF_ScorerPy = {
- *     "get_scorer_flags": _GetScorerFlagsNormalizedDistance             # <<<<<<<<<<<<<<
- * }
+ * cdef RF_Scorer WRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, WRatioInit)             # <<<<<<<<<<<<<<
+ * AddScorerContext(WRatio, FuzzContextPy, &WRatioContext)
  * 
  */
-  __Pyx_TraceLine(246,0,__PYX_ERR(0, 246, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 246, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_GetScorerFlagsNormalizedDistanc); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 246, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_get_scorer_flags, __pyx_t_2) < 0) __PYX_ERR(0, 246, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_TraceLine(225,0,__PYX_ERR(0, 225, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8fuzz_cpp_WRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz, WRatioInit);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":245
- * similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
+  /* "rapidfuzz/fuzz_cpp.pyx":226
+ * 
+ * cdef RF_Scorer WRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, WRatioInit)
+ * AddScorerContext(WRatio, FuzzContextPy, &WRatioContext)             # <<<<<<<<<<<<<<
  * 
- * normalized_distance._RF_ScorerPy = {             # <<<<<<<<<<<<<<
- *     "get_scorer_flags": _GetScorerFlagsNormalizedDistance
- * }
+ * cdef RF_Scorer QRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, QRatioInit)
  */
-  __Pyx_TraceLine(245,0,__PYX_ERR(0, 245, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_normalized_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 245, __pyx_L1_error)
+  __Pyx_TraceLine(226,0,__PYX_ERR(0, 226, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_WRatio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 226, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_ScorerPy, __pyx_t_3) < 0) __PYX_ERR(0, 245, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
+  __Pyx_INCREF(__pyx_t_3);
+  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_2, __pyx_t_3, (&__pyx_v_9rapidfuzz_8fuzz_cpp_WRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 226, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":250
+  /* "rapidfuzz/fuzz_cpp.pyx":228
+ * AddScorerContext(WRatio, FuzzContextPy, &WRatioContext)
  * 
- * normalized_similarity._RF_ScorerPy = {
- *     "get_scorer_flags": _GetScorerFlagsNormalizedSimilarity             # <<<<<<<<<<<<<<
- * }
+ * cdef RF_Scorer QRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, QRatioInit)             # <<<<<<<<<<<<<<
+ * AddScorerContext(QRatio, FuzzContextPy, &QRatioContext)
  */
-  __Pyx_TraceLine(250,0,__PYX_ERR(0, 250, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 250, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_GetScorerFlagsNormalizedSimilar); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 250, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_get_scorer_flags, __pyx_t_3) < 0) __PYX_ERR(0, 250, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_TraceLine(228,0,__PYX_ERR(0, 228, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8fuzz_cpp_QRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric, QRatioInit);
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":249
- * }
+  /* "rapidfuzz/fuzz_cpp.pyx":229
  * 
- * normalized_similarity._RF_ScorerPy = {             # <<<<<<<<<<<<<<
- *     "get_scorer_flags": _GetScorerFlagsNormalizedSimilarity
- * }
+ * cdef RF_Scorer QRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, QRatioInit)
+ * AddScorerContext(QRatio, FuzzContextPy, &QRatioContext)             # <<<<<<<<<<<<<<
  */
-  __Pyx_TraceLine(249,0,__PYX_ERR(0, 249, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_normalized_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 249, __pyx_L1_error)
+  __Pyx_TraceLine(229,0,__PYX_ERR(0, 229, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_QRatio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 229, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_ScorerPy, __pyx_t_2) < 0) __PYX_ERR(0, 249, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
+  __Pyx_INCREF(__pyx_t_2);
+  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_3, __pyx_t_2, (&__pyx_v_9rapidfuzz_8fuzz_cpp_QRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 229, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/distance/DamerauLevenshtein_cpp.pyx":1
+  /* "rapidfuzz/fuzz_cpp.pyx":1
  * # distutils: language=c++             # <<<<<<<<<<<<<<
  * # cython: language_level=3, binding=True, linetrace=True
  * 
  */
   __Pyx_TraceLine(1,0,__PYX_ERR(0, 1, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_kp_u_distance_line_34, __pyx_kp_u_Calculates_the_minimum_number_o) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_3) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "cpp_common.pxd":242
  *     void validate_string(object py_str, const char* err) except +
  * 
  * cdef inline RF_String hash_array(arr) except *:             # <<<<<<<<<<<<<<
  *     # TODO on Cpython this does not require any copies
  *     cdef RF_String s_proc
@@ -8301,37 +10382,31 @@
  * 
  * cdef inline bool AddScorerContext(func, py_context, RF_Scorer* c_context) except False:             # <<<<<<<<<<<<<<
  *     func._RF_Scorer = PyCapsule_New(c_context, NULL, NULL)
  *     func._RF_ScorerPy = py_context
  */
   __Pyx_TraceLine(407,0,__PYX_ERR(1, 407, __pyx_L1_error))
 
-
-  /* "cpython/ref.pxd":1
- * from .object cimport PyObject, PyTypeObject, Py_TYPE  # legacy imports for re-export             # <<<<<<<<<<<<<<
- * 
- * cdef extern from "Python.h":
- */
   __Pyx_TraceReturn(Py_None, 0);
 
   /*--- Wrapped vars code ---*/
 
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   if (__pyx_m) {
     if (__pyx_d && stringtab_initialized) {
-      __Pyx_AddTraceback("init rapidfuzz.distance.DamerauLevenshtein_cpp", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      __Pyx_AddTraceback("init rapidfuzz.fuzz_cpp", __pyx_clineno, __pyx_lineno, __pyx_filename);
     }
     #if !CYTHON_USE_MODULE_STATE
     Py_CLEAR(__pyx_m);
     #endif
   } else if (!PyErr_Occurred()) {
-    PyErr_SetString(PyExc_ImportError, "init rapidfuzz.distance.DamerauLevenshtein_cpp");
+    PyErr_SetString(PyExc_ImportError, "init rapidfuzz.fuzz_cpp");
   }
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   return (__pyx_m != NULL) ? 0 : -1;
   #elif PY_MAJOR_VERSION >= 3
   return __pyx_m;
@@ -8370,113 +10445,14 @@
 end:
     Py_XDECREF(p);
     Py_XDECREF(m);
     return (__Pyx_RefNannyAPIStruct *)r;
 }
 #endif
 
-/* PyErrExceptionMatches */
-#if CYTHON_FAST_THREAD_STATE
-static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
-    Py_ssize_t i, n;
-    n = PyTuple_GET_SIZE(tuple);
-#if PY_MAJOR_VERSION >= 3
-    for (i=0; i<n; i++) {
-        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
-    }
-#endif
-    for (i=0; i<n; i++) {
-        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
-    }
-    return 0;
-}
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
-    PyObject *exc_type = tstate->curexc_type;
-    if (exc_type == err) return 1;
-    if (unlikely(!exc_type)) return 0;
-    if (unlikely(PyTuple_Check(err)))
-        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
-    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
-}
-#endif
-
-/* PyErrFetchRestore */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    tmp_type = tstate->curexc_type;
-    tmp_value = tstate->curexc_value;
-    tmp_tb = tstate->curexc_traceback;
-    tstate->curexc_type = type;
-    tstate->curexc_value = value;
-    tstate->curexc_traceback = tb;
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    *type = tstate->curexc_type;
-    *value = tstate->curexc_value;
-    *tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-}
-#endif
-
-/* PyObjectGetAttrStr */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
-    PyTypeObject* tp = Py_TYPE(obj);
-    if (likely(tp->tp_getattro))
-        return tp->tp_getattro(obj, attr_name);
-#if PY_MAJOR_VERSION < 3
-    if (likely(tp->tp_getattr))
-        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
-#endif
-    return PyObject_GetAttr(obj, attr_name);
-}
-#endif
-
-/* PyObjectGetAttrStrNoError */
-static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
-        __Pyx_PyErr_Clear();
-}
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
-    PyObject *result;
-#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
-    PyTypeObject* tp = Py_TYPE(obj);
-    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
-        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
-    }
-#endif
-    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
-    if (unlikely(!result)) {
-        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
-    }
-    return result;
-}
-
-/* GetBuiltinName */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
-    PyObject* result = __Pyx_PyObject_GetAttrStrNoError(__pyx_b, name);
-    if (unlikely(!result) && !PyErr_Occurred()) {
-        PyErr_Format(PyExc_NameError,
-#if PY_MAJOR_VERSION >= 3
-            "name '%U' is not defined", name);
-#else
-            "name '%.200s' is not defined", PyString_AS_STRING(name));
-#endif
-    }
-    return result;
-}
-
 /* TupleAndListFromArray */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE void __Pyx_copy_object_array(PyObject *const *CYTHON_RESTRICT src, PyObject** CYTHON_RESTRICT dest, Py_ssize_t length) {
     PyObject *v;
     Py_ssize_t i;
     for (i = 0; i < length; i++) {
         v = dest[i] = src[i];
@@ -8832,14 +10808,38 @@
         "%s() got an unexpected keyword argument '%U'",
         function_name, key);
     #endif
 bad:
     return -1;
 }
 
+/* PyErrFetchRestore */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    tmp_type = tstate->curexc_type;
+    tmp_value = tstate->curexc_value;
+    tmp_tb = tstate->curexc_traceback;
+    tstate->curexc_type = type;
+    tstate->curexc_value = value;
+    tstate->curexc_traceback = tb;
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+}
+static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+    *type = tstate->curexc_type;
+    *value = tstate->curexc_value;
+    *tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+}
+#endif
+
 /* Profile */
 #if CYTHON_PROFILE
 static int __Pyx_TraceSetupAndCall(PyCodeObject** code,
                                    PyFrameObject** frame,
                                    PyThreadState* tstate,
                                    const char *funcname,
                                    const char *srcfile,
@@ -8922,14 +10922,275 @@
     Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
 #endif
     return py_code;
 }
 #endif
 
+/* PyErrExceptionMatches */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
+    Py_ssize_t i, n;
+    n = PyTuple_GET_SIZE(tuple);
+#if PY_MAJOR_VERSION >= 3
+    for (i=0; i<n; i++) {
+        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
+    }
+#endif
+    for (i=0; i<n; i++) {
+        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
+    }
+    return 0;
+}
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
+    PyObject *exc_type = tstate->curexc_type;
+    if (exc_type == err) return 1;
+    if (unlikely(!exc_type)) return 0;
+    if (unlikely(PyTuple_Check(err)))
+        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
+    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
+}
+#endif
+
+/* PyObjectGetAttrStr */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro))
+        return tp->tp_getattro(obj, attr_name);
+#if PY_MAJOR_VERSION < 3
+    if (likely(tp->tp_getattr))
+        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
+#endif
+    return PyObject_GetAttr(obj, attr_name);
+}
+#endif
+
+/* PyObjectGetAttrStrNoError */
+static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
+        __Pyx_PyErr_Clear();
+}
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
+    PyObject *result;
+#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
+        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
+    }
+#endif
+    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
+    if (unlikely(!result)) {
+        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
+    }
+    return result;
+}
+
+/* GetBuiltinName */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
+    PyObject* result = __Pyx_PyObject_GetAttrStrNoError(__pyx_b, name);
+    if (unlikely(!result) && !PyErr_Occurred()) {
+        PyErr_Format(PyExc_NameError,
+#if PY_MAJOR_VERSION >= 3
+            "name '%U' is not defined", name);
+#else
+            "name '%.200s' is not defined", PyString_AS_STRING(name));
+#endif
+    }
+    return result;
+}
+
+/* PyDictVersioning */
+#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
+}
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
+    PyObject **dictptr = NULL;
+    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
+    if (offset) {
+#if CYTHON_COMPILING_IN_CPYTHON
+        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
+#else
+        dictptr = _PyObject_GetDictPtr(obj);
+#endif
+    }
+    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
+}
+static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
+        return 0;
+    return obj_dict_version == __Pyx_get_object_dict_version(obj);
+}
+#endif
+
+/* GetModuleGlobalName */
+#if CYTHON_USE_DICT_VERSIONS
+static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
+#else
+static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
+#endif
+{
+    PyObject *result;
+#if !CYTHON_AVOID_BORROWED_REFS
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
+    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    } else if (unlikely(PyErr_Occurred())) {
+        return NULL;
+    }
+#elif CYTHON_COMPILING_IN_LIMITED_API
+    if (unlikely(!__pyx_m)) {
+        return NULL;
+    }
+    result = PyObject_GetAttr(__pyx_m, name);
+    if (likely(result)) {
+        return result;
+    }
+#else
+    result = PyDict_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
+#endif
+#else
+    result = PyObject_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
+    PyErr_Clear();
+#endif
+    return __Pyx_GetBuiltinName(name);
+}
+
+/* PyFunctionFastCall */
+#if CYTHON_FAST_PYCALL && !CYTHON_VECTORCALL
+static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
+                                               PyObject *globals) {
+    PyFrameObject *f;
+    PyThreadState *tstate = __Pyx_PyThreadState_Current;
+    PyObject **fastlocals;
+    Py_ssize_t i;
+    PyObject *result;
+    assert(globals != NULL);
+    /* XXX Perhaps we should create a specialized
+       PyFrame_New() that doesn't take locals, but does
+       take builtins without sanity checking them.
+       */
+    assert(tstate != NULL);
+    f = PyFrame_New(tstate, co, globals, NULL);
+    if (f == NULL) {
+        return NULL;
+    }
+    fastlocals = __Pyx_PyFrame_GetLocalsplus(f);
+    for (i = 0; i < na; i++) {
+        Py_INCREF(*args);
+        fastlocals[i] = *args++;
+    }
+    result = PyEval_EvalFrameEx(f,0);
+    ++tstate->recursion_depth;
+    Py_DECREF(f);
+    --tstate->recursion_depth;
+    return result;
+}
+static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs) {
+    PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
+    PyObject *globals = PyFunction_GET_GLOBALS(func);
+    PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
+    PyObject *closure;
+#if PY_MAJOR_VERSION >= 3
+    PyObject *kwdefs;
+#endif
+    PyObject *kwtuple, **k;
+    PyObject **d;
+    Py_ssize_t nd;
+    Py_ssize_t nk;
+    PyObject *result;
+    assert(kwargs == NULL || PyDict_Check(kwargs));
+    nk = kwargs ? PyDict_Size(kwargs) : 0;
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object"))) {
+        return NULL;
+    }
+    if (
+#if PY_MAJOR_VERSION >= 3
+            co->co_kwonlyargcount == 0 &&
+#endif
+            likely(kwargs == NULL || nk == 0) &&
+            co->co_flags == (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)) {
+        if (argdefs == NULL && co->co_argcount == nargs) {
+            result = __Pyx_PyFunction_FastCallNoKw(co, args, nargs, globals);
+            goto done;
+        }
+        else if (nargs == 0 && argdefs != NULL
+                 && co->co_argcount == Py_SIZE(argdefs)) {
+            /* function called with no arguments, but all parameters have
+               a default value: use default values as arguments .*/
+            args = &PyTuple_GET_ITEM(argdefs, 0);
+            result =__Pyx_PyFunction_FastCallNoKw(co, args, Py_SIZE(argdefs), globals);
+            goto done;
+        }
+    }
+    if (kwargs != NULL) {
+        Py_ssize_t pos, i;
+        kwtuple = PyTuple_New(2 * nk);
+        if (kwtuple == NULL) {
+            result = NULL;
+            goto done;
+        }
+        k = &PyTuple_GET_ITEM(kwtuple, 0);
+        pos = i = 0;
+        while (PyDict_Next(kwargs, &pos, &k[i], &k[i+1])) {
+            Py_INCREF(k[i]);
+            Py_INCREF(k[i+1]);
+            i += 2;
+        }
+        nk = i / 2;
+    }
+    else {
+        kwtuple = NULL;
+        k = NULL;
+    }
+    closure = PyFunction_GET_CLOSURE(func);
+#if PY_MAJOR_VERSION >= 3
+    kwdefs = PyFunction_GET_KW_DEFAULTS(func);
+#endif
+    if (argdefs != NULL) {
+        d = &PyTuple_GET_ITEM(argdefs, 0);
+        nd = Py_SIZE(argdefs);
+    }
+    else {
+        d = NULL;
+        nd = 0;
+    }
+#if PY_MAJOR_VERSION >= 3
+    result = PyEval_EvalCodeEx((PyObject*)co, globals, (PyObject *)NULL,
+                               args, (int)nargs,
+                               k, (int)nk,
+                               d, (int)nd, kwdefs, closure);
+#else
+    result = PyEval_EvalCodeEx(co, globals, (PyObject *)NULL,
+                               args, (int)nargs,
+                               k, (int)nk,
+                               d, (int)nd, closure);
+#endif
+    Py_XDECREF(kwtuple);
+done:
+    Py_LeaveRecursiveCall();
+    return result;
+}
+#endif
+
 /* PyObjectCall */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
     PyObject *result;
     ternaryfunc call = Py_TYPE(func)->tp_call;
     if (unlikely(!call))
         return PyObject_Call(func, arg, kw);
@@ -8942,172 +11203,110 @@
             PyExc_SystemError,
             "NULL result without error in PyObject_Call");
     }
     return result;
 }
 #endif
 
-/* RaiseException */
-#if PY_MAJOR_VERSION < 3
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
-    __Pyx_PyThreadState_declare
-    CYTHON_UNUSED_VAR(cause);
-    Py_XINCREF(type);
-    if (!value || value == Py_None)
-        value = NULL;
-    else
-        Py_INCREF(value);
-    if (!tb || tb == Py_None)
-        tb = NULL;
-    else {
-        Py_INCREF(tb);
-        if (!PyTraceBack_Check(tb)) {
-            PyErr_SetString(PyExc_TypeError,
-                "raise: arg 3 must be a traceback or None");
-            goto raise_error;
-        }
+/* PyObjectCallMethO */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
+    PyObject *self, *result;
+    PyCFunction cfunc;
+    cfunc = PyCFunction_GET_FUNCTION(func);
+    self = PyCFunction_GET_SELF(func);
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
+        return NULL;
+    result = cfunc(self, arg);
+    Py_LeaveRecursiveCall();
+    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
+        PyErr_SetString(
+            PyExc_SystemError,
+            "NULL result without error in PyObject_Call");
     }
-    if (PyType_Check(type)) {
-#if CYTHON_COMPILING_IN_PYPY
-        if (!value) {
-            Py_INCREF(Py_None);
-            value = Py_None;
-        }
+    return result;
+}
 #endif
-        PyErr_NormalizeException(&type, &value, &tb);
-    } else {
-        if (value) {
-            PyErr_SetString(PyExc_TypeError,
-                "instance exception may not have a separate value");
-            goto raise_error;
-        }
-        value = type;
-        type = (PyObject*) Py_TYPE(type);
-        Py_INCREF(type);
-        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
-            PyErr_SetString(PyExc_TypeError,
-                "raise: exception class must be a subclass of BaseException");
-            goto raise_error;
-        }
+
+/* PyObjectFastCall */
+static PyObject* __Pyx_PyObject_FastCall_fallback(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs) {
+    PyObject *argstuple;
+    PyObject *result;
+    size_t i;
+    argstuple = PyTuple_New((Py_ssize_t)nargs);
+    if (unlikely(!argstuple)) return NULL;
+    for (i = 0; i < nargs; i++) {
+        Py_INCREF(args[i]);
+        PyTuple_SET_ITEM(argstuple, (Py_ssize_t)i, args[i]);
     }
-    __Pyx_PyThreadState_assign
-    __Pyx_ErrRestore(type, value, tb);
-    return;
-raise_error:
-    Py_XDECREF(value);
-    Py_XDECREF(type);
-    Py_XDECREF(tb);
-    return;
+    result = __Pyx_PyObject_Call(func, argstuple, kwargs);
+    Py_DECREF(argstuple);
+    return result;
 }
+static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t _nargs, PyObject *kwargs) {
+    Py_ssize_t nargs = __Pyx_PyVectorcall_NARGS(_nargs);
+#if CYTHON_COMPILING_IN_CPYTHON
+    if (nargs == 0 && kwargs == NULL) {
+#ifdef __Pyx_CyFunction_USED
+        if (__Pyx_IsCyOrPyCFunction(func))
 #else
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
-    PyObject* owned_instance = NULL;
-    if (tb == Py_None) {
-        tb = 0;
-    } else if (tb && !PyTraceBack_Check(tb)) {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: arg 3 must be a traceback or None");
-        goto bad;
-    }
-    if (value == Py_None)
-        value = 0;
-    if (PyExceptionInstance_Check(type)) {
-        if (value) {
-            PyErr_SetString(PyExc_TypeError,
-                "instance exception may not have a separate value");
-            goto bad;
-        }
-        value = type;
-        type = (PyObject*) Py_TYPE(value);
-    } else if (PyExceptionClass_Check(type)) {
-        PyObject *instance_class = NULL;
-        if (value && PyExceptionInstance_Check(value)) {
-            instance_class = (PyObject*) Py_TYPE(value);
-            if (instance_class != type) {
-                int is_subclass = PyObject_IsSubclass(instance_class, type);
-                if (!is_subclass) {
-                    instance_class = NULL;
-                } else if (unlikely(is_subclass == -1)) {
-                    goto bad;
-                } else {
-                    type = instance_class;
-                }
+        if (PyCFunction_Check(func))
+#endif
+        {
+            if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
+                return __Pyx_PyObject_CallMethO(func, NULL);
             }
         }
-        if (!instance_class) {
-            PyObject *args;
-            if (!value)
-                args = PyTuple_New(0);
-            else if (PyTuple_Check(value)) {
-                Py_INCREF(value);
-                args = value;
-            } else
-                args = PyTuple_Pack(1, value);
-            if (!args)
-                goto bad;
-            owned_instance = PyObject_Call(type, args, NULL);
-            Py_DECREF(args);
-            if (!owned_instance)
-                goto bad;
-            value = owned_instance;
-            if (!PyExceptionInstance_Check(value)) {
-                PyErr_Format(PyExc_TypeError,
-                             "calling %R should have returned an instance of "
-                             "BaseException, not %R",
-                             type, Py_TYPE(value));
-                goto bad;
+    }
+    else if (nargs == 1 && kwargs == NULL) {
+        if (PyCFunction_Check(func))
+        {
+            if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
+                return __Pyx_PyObject_CallMethO(func, args[0]);
             }
         }
-    } else {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: exception class must be a subclass of BaseException");
-        goto bad;
     }
-    if (cause) {
-        PyObject *fixed_cause;
-        if (cause == Py_None) {
-            fixed_cause = NULL;
-        } else if (PyExceptionClass_Check(cause)) {
-            fixed_cause = PyObject_CallObject(cause, NULL);
-            if (fixed_cause == NULL)
-                goto bad;
-        } else if (PyExceptionInstance_Check(cause)) {
-            fixed_cause = cause;
-            Py_INCREF(fixed_cause);
+#endif
+    #if PY_VERSION_HEX < 0x030800B1
+    #if CYTHON_FAST_PYCCALL
+    if (PyCFunction_Check(func)) {
+        if (kwargs) {
+            return _PyCFunction_FastCallDict(func, args, nargs, kwargs);
         } else {
-            PyErr_SetString(PyExc_TypeError,
-                            "exception causes must derive from "
-                            "BaseException");
-            goto bad;
+            return _PyCFunction_FastCallKeywords(func, args, nargs, NULL);
         }
-        PyException_SetCause(value, fixed_cause);
     }
-    PyErr_SetObject(type, value);
-    if (tb) {
-#if CYTHON_COMPILING_IN_PYPY ||  CYTHON_COMPILING_IN_LIMITED_API
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
-        PyThreadState *tstate = __Pyx_PyThreadState_Current;
-        PyObject* tmp_tb = tstate->curexc_traceback;
-        if (tb != tmp_tb) {
-            Py_INCREF(tb);
-            tstate->curexc_traceback = tb;
-            Py_XDECREF(tmp_tb);
-        }
-#endif
+    #if PY_VERSION_HEX >= 0x030700A1
+    if (!kwargs && __Pyx_IS_TYPE(func, &PyMethodDescr_Type)) {
+        return _PyMethodDescr_FastCallKeywords(func, args, nargs, NULL);
     }
-bad:
-    Py_XDECREF(owned_instance);
-    return;
+    #endif
+    #endif
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(func)) {
+        return __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs);
+    }
+    #endif
+    #endif
+    #if CYTHON_VECTORCALL
+    vectorcallfunc f = _PyVectorcall_Function(func);
+    if (f) {
+        return f(func, args, (size_t)nargs, kwargs);
+    }
+    #elif defined(__Pyx_CyFunction_USED) && CYTHON_BACKPORT_VECTORCALL
+    if (__Pyx_CyFunction_CheckExact(func)) {
+        __pyx_vectorcallfunc f = __Pyx_CyFunction_func_vectorcall(func);
+        if (f) return f(func, args, (size_t)nargs, kwargs);
+    }
+    #endif
+    if (nargs == 0) {
+        return __Pyx_PyObject_Call(func, __pyx_empty_tuple, kwargs);
+    }
+    return __Pyx_PyObject_FastCall_fallback(func, args, (size_t)nargs, kwargs);
 }
-#endif
 
 /* KeywordStringCheck */
 static int __Pyx_CheckKeywordStrings(
     PyObject *kw,
     const char* function_name,
     int kw_allowed)
 {
@@ -9540,83 +11739,14 @@
 #endif
         if ((double)a == (double)b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
     }
     return (
         PyObject_RichCompare(op1, op2, Py_EQ));
 }
 
-/* PyDictVersioning */
-#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
-}
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
-    PyObject **dictptr = NULL;
-    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
-    if (offset) {
-#if CYTHON_COMPILING_IN_CPYTHON
-        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
-#else
-        dictptr = _PyObject_GetDictPtr(obj);
-#endif
-    }
-    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
-}
-static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
-        return 0;
-    return obj_dict_version == __Pyx_get_object_dict_version(obj);
-}
-#endif
-
-/* GetModuleGlobalName */
-#if CYTHON_USE_DICT_VERSIONS
-static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
-#else
-static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
-#endif
-{
-    PyObject *result;
-#if !CYTHON_AVOID_BORROWED_REFS
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
-    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    } else if (unlikely(PyErr_Occurred())) {
-        return NULL;
-    }
-#elif CYTHON_COMPILING_IN_LIMITED_API
-    if (unlikely(!__pyx_m)) {
-        return NULL;
-    }
-    result = PyObject_GetAttr(__pyx_m, name);
-    if (likely(result)) {
-        return result;
-    }
-#else
-    result = PyDict_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-#endif
-#else
-    result = PyObject_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-    PyErr_Clear();
-#endif
-    return __Pyx_GetBuiltinName(name);
-}
-
 /* JoinPyUnicode */
 static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
                                       Py_UCS4 max_char) {
 #if CYTHON_USE_UNICODE_INTERNALS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     PyObject *result_uval;
     int result_ukind, kind_shift;
     Py_ssize_t i, char_pos;
@@ -9676,233 +11806,178 @@
     CYTHON_UNUSED_VAR(max_char);
     CYTHON_UNUSED_VAR(result_ulength);
     CYTHON_UNUSED_VAR(value_count);
     return PyUnicode_Join(__pyx_empty_unicode, value_tuple);
 #endif
 }
 
-/* PyFunctionFastCall */
-#if CYTHON_FAST_PYCALL && !CYTHON_VECTORCALL
-static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
-                                               PyObject *globals) {
-    PyFrameObject *f;
-    PyThreadState *tstate = __Pyx_PyThreadState_Current;
-    PyObject **fastlocals;
-    Py_ssize_t i;
-    PyObject *result;
-    assert(globals != NULL);
-    /* XXX Perhaps we should create a specialized
-       PyFrame_New() that doesn't take locals, but does
-       take builtins without sanity checking them.
-       */
-    assert(tstate != NULL);
-    f = PyFrame_New(tstate, co, globals, NULL);
-    if (f == NULL) {
-        return NULL;
-    }
-    fastlocals = __Pyx_PyFrame_GetLocalsplus(f);
-    for (i = 0; i < na; i++) {
-        Py_INCREF(*args);
-        fastlocals[i] = *args++;
-    }
-    result = PyEval_EvalFrameEx(f,0);
-    ++tstate->recursion_depth;
-    Py_DECREF(f);
-    --tstate->recursion_depth;
-    return result;
+/* PyObjectCallOneArg */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
+    PyObject *args[2] = {NULL, arg};
+    return __Pyx_PyObject_FastCall(func, args+1, 1 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
 }
-static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs) {
-    PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
-    PyObject *globals = PyFunction_GET_GLOBALS(func);
-    PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
-    PyObject *closure;
-#if PY_MAJOR_VERSION >= 3
-    PyObject *kwdefs;
-#endif
-    PyObject *kwtuple, **k;
-    PyObject **d;
-    Py_ssize_t nd;
-    Py_ssize_t nk;
-    PyObject *result;
-    assert(kwargs == NULL || PyDict_Check(kwargs));
-    nk = kwargs ? PyDict_Size(kwargs) : 0;
-    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object"))) {
-        return NULL;
-    }
-    if (
-#if PY_MAJOR_VERSION >= 3
-            co->co_kwonlyargcount == 0 &&
-#endif
-            likely(kwargs == NULL || nk == 0) &&
-            co->co_flags == (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)) {
-        if (argdefs == NULL && co->co_argcount == nargs) {
-            result = __Pyx_PyFunction_FastCallNoKw(co, args, nargs, globals);
-            goto done;
-        }
-        else if (nargs == 0 && argdefs != NULL
-                 && co->co_argcount == Py_SIZE(argdefs)) {
-            /* function called with no arguments, but all parameters have
-               a default value: use default values as arguments .*/
-            args = &PyTuple_GET_ITEM(argdefs, 0);
-            result =__Pyx_PyFunction_FastCallNoKw(co, args, Py_SIZE(argdefs), globals);
-            goto done;
+
+/* RaiseException */
+#if PY_MAJOR_VERSION < 3
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
+    __Pyx_PyThreadState_declare
+    CYTHON_UNUSED_VAR(cause);
+    Py_XINCREF(type);
+    if (!value || value == Py_None)
+        value = NULL;
+    else
+        Py_INCREF(value);
+    if (!tb || tb == Py_None)
+        tb = NULL;
+    else {
+        Py_INCREF(tb);
+        if (!PyTraceBack_Check(tb)) {
+            PyErr_SetString(PyExc_TypeError,
+                "raise: arg 3 must be a traceback or None");
+            goto raise_error;
         }
     }
-    if (kwargs != NULL) {
-        Py_ssize_t pos, i;
-        kwtuple = PyTuple_New(2 * nk);
-        if (kwtuple == NULL) {
-            result = NULL;
-            goto done;
-        }
-        k = &PyTuple_GET_ITEM(kwtuple, 0);
-        pos = i = 0;
-        while (PyDict_Next(kwargs, &pos, &k[i], &k[i+1])) {
-            Py_INCREF(k[i]);
-            Py_INCREF(k[i+1]);
-            i += 2;
+    if (PyType_Check(type)) {
+#if CYTHON_COMPILING_IN_PYPY
+        if (!value) {
+            Py_INCREF(Py_None);
+            value = Py_None;
         }
-        nk = i / 2;
-    }
-    else {
-        kwtuple = NULL;
-        k = NULL;
-    }
-    closure = PyFunction_GET_CLOSURE(func);
-#if PY_MAJOR_VERSION >= 3
-    kwdefs = PyFunction_GET_KW_DEFAULTS(func);
-#endif
-    if (argdefs != NULL) {
-        d = &PyTuple_GET_ITEM(argdefs, 0);
-        nd = Py_SIZE(argdefs);
-    }
-    else {
-        d = NULL;
-        nd = 0;
-    }
-#if PY_MAJOR_VERSION >= 3
-    result = PyEval_EvalCodeEx((PyObject*)co, globals, (PyObject *)NULL,
-                               args, (int)nargs,
-                               k, (int)nk,
-                               d, (int)nd, kwdefs, closure);
-#else
-    result = PyEval_EvalCodeEx(co, globals, (PyObject *)NULL,
-                               args, (int)nargs,
-                               k, (int)nk,
-                               d, (int)nd, closure);
-#endif
-    Py_XDECREF(kwtuple);
-done:
-    Py_LeaveRecursiveCall();
-    return result;
-}
 #endif
-
-/* PyObjectCallMethO */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
-    PyObject *self, *result;
-    PyCFunction cfunc;
-    cfunc = PyCFunction_GET_FUNCTION(func);
-    self = PyCFunction_GET_SELF(func);
-    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
-        return NULL;
-    result = cfunc(self, arg);
-    Py_LeaveRecursiveCall();
-    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
-        PyErr_SetString(
-            PyExc_SystemError,
-            "NULL result without error in PyObject_Call");
-    }
-    return result;
-}
-#endif
-
-/* PyObjectFastCall */
-static PyObject* __Pyx_PyObject_FastCall_fallback(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs) {
-    PyObject *argstuple;
-    PyObject *result;
-    size_t i;
-    argstuple = PyTuple_New((Py_ssize_t)nargs);
-    if (unlikely(!argstuple)) return NULL;
-    for (i = 0; i < nargs; i++) {
-        Py_INCREF(args[i]);
-        PyTuple_SET_ITEM(argstuple, (Py_ssize_t)i, args[i]);
+        PyErr_NormalizeException(&type, &value, &tb);
+    } else {
+        if (value) {
+            PyErr_SetString(PyExc_TypeError,
+                "instance exception may not have a separate value");
+            goto raise_error;
+        }
+        value = type;
+        type = (PyObject*) Py_TYPE(type);
+        Py_INCREF(type);
+        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
+            PyErr_SetString(PyExc_TypeError,
+                "raise: exception class must be a subclass of BaseException");
+            goto raise_error;
+        }
     }
-    result = __Pyx_PyObject_Call(func, argstuple, kwargs);
-    Py_DECREF(argstuple);
-    return result;
+    __Pyx_PyThreadState_assign
+    __Pyx_ErrRestore(type, value, tb);
+    return;
+raise_error:
+    Py_XDECREF(value);
+    Py_XDECREF(type);
+    Py_XDECREF(tb);
+    return;
 }
-static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t _nargs, PyObject *kwargs) {
-    Py_ssize_t nargs = __Pyx_PyVectorcall_NARGS(_nargs);
-#if CYTHON_COMPILING_IN_CPYTHON
-    if (nargs == 0 && kwargs == NULL) {
-#ifdef __Pyx_CyFunction_USED
-        if (__Pyx_IsCyOrPyCFunction(func))
 #else
-        if (PyCFunction_Check(func))
-#endif
-        {
-            if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
-                return __Pyx_PyObject_CallMethO(func, NULL);
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
+    PyObject* owned_instance = NULL;
+    if (tb == Py_None) {
+        tb = 0;
+    } else if (tb && !PyTraceBack_Check(tb)) {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: arg 3 must be a traceback or None");
+        goto bad;
+    }
+    if (value == Py_None)
+        value = 0;
+    if (PyExceptionInstance_Check(type)) {
+        if (value) {
+            PyErr_SetString(PyExc_TypeError,
+                "instance exception may not have a separate value");
+            goto bad;
+        }
+        value = type;
+        type = (PyObject*) Py_TYPE(value);
+    } else if (PyExceptionClass_Check(type)) {
+        PyObject *instance_class = NULL;
+        if (value && PyExceptionInstance_Check(value)) {
+            instance_class = (PyObject*) Py_TYPE(value);
+            if (instance_class != type) {
+                int is_subclass = PyObject_IsSubclass(instance_class, type);
+                if (!is_subclass) {
+                    instance_class = NULL;
+                } else if (unlikely(is_subclass == -1)) {
+                    goto bad;
+                } else {
+                    type = instance_class;
+                }
             }
         }
-    }
-    else if (nargs == 1 && kwargs == NULL) {
-        if (PyCFunction_Check(func))
-        {
-            if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
-                return __Pyx_PyObject_CallMethO(func, args[0]);
+        if (!instance_class) {
+            PyObject *args;
+            if (!value)
+                args = PyTuple_New(0);
+            else if (PyTuple_Check(value)) {
+                Py_INCREF(value);
+                args = value;
+            } else
+                args = PyTuple_Pack(1, value);
+            if (!args)
+                goto bad;
+            owned_instance = PyObject_Call(type, args, NULL);
+            Py_DECREF(args);
+            if (!owned_instance)
+                goto bad;
+            value = owned_instance;
+            if (!PyExceptionInstance_Check(value)) {
+                PyErr_Format(PyExc_TypeError,
+                             "calling %R should have returned an instance of "
+                             "BaseException, not %R",
+                             type, Py_TYPE(value));
+                goto bad;
             }
         }
+    } else {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: exception class must be a subclass of BaseException");
+        goto bad;
     }
-#endif
-    #if PY_VERSION_HEX < 0x030800B1
-    #if CYTHON_FAST_PYCCALL
-    if (PyCFunction_Check(func)) {
-        if (kwargs) {
-            return _PyCFunction_FastCallDict(func, args, nargs, kwargs);
+    if (cause) {
+        PyObject *fixed_cause;
+        if (cause == Py_None) {
+            fixed_cause = NULL;
+        } else if (PyExceptionClass_Check(cause)) {
+            fixed_cause = PyObject_CallObject(cause, NULL);
+            if (fixed_cause == NULL)
+                goto bad;
+        } else if (PyExceptionInstance_Check(cause)) {
+            fixed_cause = cause;
+            Py_INCREF(fixed_cause);
         } else {
-            return _PyCFunction_FastCallKeywords(func, args, nargs, NULL);
+            PyErr_SetString(PyExc_TypeError,
+                            "exception causes must derive from "
+                            "BaseException");
+            goto bad;
         }
+        PyException_SetCause(value, fixed_cause);
     }
-    #if PY_VERSION_HEX >= 0x030700A1
-    if (!kwargs && __Pyx_IS_TYPE(func, &PyMethodDescr_Type)) {
-        return _PyMethodDescr_FastCallKeywords(func, args, nargs, NULL);
-    }
-    #endif
-    #endif
-    #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(func)) {
-        return __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs);
-    }
-    #endif
-    #endif
-    #if CYTHON_VECTORCALL
-    vectorcallfunc f = _PyVectorcall_Function(func);
-    if (f) {
-        return f(func, args, (size_t)nargs, kwargs);
-    }
-    #elif defined(__Pyx_CyFunction_USED) && CYTHON_BACKPORT_VECTORCALL
-    if (__Pyx_CyFunction_CheckExact(func)) {
-        __pyx_vectorcallfunc f = __Pyx_CyFunction_func_vectorcall(func);
-        if (f) return f(func, args, (size_t)nargs, kwargs);
-    }
-    #endif
-    if (nargs == 0) {
-        return __Pyx_PyObject_Call(func, __pyx_empty_tuple, kwargs);
+    PyErr_SetObject(type, value);
+    if (tb) {
+#if CYTHON_COMPILING_IN_PYPY ||  CYTHON_COMPILING_IN_LIMITED_API
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
+#else
+        PyThreadState *tstate = __Pyx_PyThreadState_Current;
+        PyObject* tmp_tb = tstate->curexc_traceback;
+        if (tb != tmp_tb) {
+            Py_INCREF(tb);
+            tstate->curexc_traceback = tb;
+            Py_XDECREF(tmp_tb);
+        }
+#endif
     }
-    return __Pyx_PyObject_FastCall_fallback(func, args, (size_t)nargs, kwargs);
-}
-
-/* PyObjectCallOneArg */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-    PyObject *args[2] = {NULL, arg};
-    return __Pyx_PyObject_FastCall(func, args+1, 1 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
+bad:
+    Py_XDECREF(owned_instance);
+    return;
 }
+#endif
 
 /* GetAttr3 */
 static PyObject *__Pyx_GetAttr3Default(PyObject *d) {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         return NULL;
@@ -10187,15 +12262,15 @@
         PyObject* module_dot = 0;
         PyObject* full_name = 0;
         PyErr_Clear();
         module_name_str = PyModule_GetName(module);
         if (unlikely(!module_name_str)) { goto modbad; }
         module_name = PyUnicode_FromString(module_name_str);
         if (unlikely(!module_name)) { goto modbad; }
-        module_dot = PyUnicode_Concat(module_name, __pyx_kp_u__12);
+        module_dot = PyUnicode_Concat(module_name, __pyx_kp_u__15);
         if (unlikely(!module_dot)) { goto modbad; }
         full_name = PyUnicode_Concat(module_dot, name);
         if (unlikely(!full_name)) { goto modbad; }
         #if PY_VERSION_HEX < 0x030700A1 || (CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM  < 0x07030400)
         {
             PyObject *modules = PyImport_GetModuleDict();
             if (unlikely(!modules))
@@ -11574,36 +13649,14 @@
     PyTraceBack_Here(py_frame);
 bad:
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
 #endif
 
-/* CIntFromPyVerify */
-#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
-    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
-#define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
-    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
-#define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
-    {\
-        func_type value = func_value;\
-        if (sizeof(target_type) < sizeof(func_type)) {\
-            if (unlikely(value != (func_type) (target_type) value)) {\
-                func_type zero = 0;\
-                if (exc && unlikely(value == (func_type)-1 && PyErr_Occurred()))\
-                    return (target_type) -1;\
-                if (is_unsigned && unlikely(value < zero))\
-                    goto raise_neg_overflow;\
-                else\
-                    goto raise_overflow;\
-            }\
-        }\
-        return (target_type) value;\
-    }
-
 /* UnicodeAsUCS4 */
 static CYTHON_INLINE Py_UCS4 __Pyx_PyUnicode_AsPy_UCS4(PyObject* x) {
    Py_ssize_t length;
    #if CYTHON_PEP393_ENABLED
    length = PyUnicode_GET_LENGTH(x);
    if (likely(length == 1)) {
        return PyUnicode_READ_CHAR(x, 0);
@@ -11627,14 +13680,57 @@
    #endif
    PyErr_Format(PyExc_ValueError,
                 "only single character unicode strings can be converted to Py_UCS4, "
                 "got length %" CYTHON_FORMAT_SSIZE_T "d", length);
    return (Py_UCS4)-1;
 }
 
+/* CIntFromPyVerify */
+#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
+    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
+#define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
+    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
+#define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
+    {\
+        func_type value = func_value;\
+        if (sizeof(target_type) < sizeof(func_type)) {\
+            if (unlikely(value != (func_type) (target_type) value)) {\
+                func_type zero = 0;\
+                if (exc && unlikely(value == (func_type)-1 && PyErr_Occurred()))\
+                    return (target_type) -1;\
+                if (is_unsigned && unlikely(value < zero))\
+                    goto raise_neg_overflow;\
+                else\
+                    goto raise_overflow;\
+            }\
+        }\
+        return (target_type) value;\
+    }
+
+/* ObjectAsUCS4 */
+static Py_UCS4 __Pyx__PyObject_AsPy_UCS4_raise_error(long ival) {
+   if (ival < 0) {
+       if (!PyErr_Occurred())
+           PyErr_SetString(PyExc_OverflowError,
+                           "cannot convert negative value to Py_UCS4");
+   } else {
+       PyErr_SetString(PyExc_OverflowError,
+                       "value too large to convert to Py_UCS4");
+   }
+   return (Py_UCS4)-1;
+}
+static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject* x) {
+   long ival;
+   ival = __Pyx_PyInt_As_long(x);
+   if (unlikely(!__Pyx_is_valid_index(ival, 1114111 + 1))) {
+       return __Pyx__PyObject_AsPy_UCS4_raise_error(ival);
+   }
+   return (Py_UCS4)ival;
+}
+
 /* CIntToPy */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int64_t(int64_t value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int64_t neg_one = (int64_t) -1, const_zero = (int64_t) 0;
@@ -12057,45 +14153,24 @@
     return (uint64_t) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to uint64_t");
     return (uint64_t) -1;
 }
 
-/* ObjectAsUCS4 */
-static Py_UCS4 __Pyx__PyObject_AsPy_UCS4_raise_error(long ival) {
-   if (ival < 0) {
-       if (!PyErr_Occurred())
-           PyErr_SetString(PyExc_OverflowError,
-                           "cannot convert negative value to Py_UCS4");
-   } else {
-       PyErr_SetString(PyExc_OverflowError,
-                       "value too large to convert to Py_UCS4");
-   }
-   return (Py_UCS4)-1;
-}
-static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject* x) {
-   long ival;
-   ival = __Pyx_PyInt_As_long(x);
-   if (unlikely(!__Pyx_is_valid_index(ival, 1114111 + 1))) {
-       return __Pyx__PyObject_AsPy_UCS4_raise_error(ival);
-   }
-   return (Py_UCS4)ival;
-}
-
 /* FormatTypeName */
 #if CYTHON_COMPILING_IN_LIMITED_API
 static __Pyx_TypeName
 __Pyx_PyType_GetName(PyTypeObject* tp)
 {
     PyObject *name = __Pyx_PyObject_GetAttrStr((PyObject *)tp,
                                                __pyx_n_s_name);
     if (unlikely(name == NULL) || unlikely(!PyUnicode_Check(name))) {
         PyErr_Clear();
-        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__15));
+        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__19));
     }
     return name;
 }
 #endif
 
 /* CIntToPy */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/DamerauLevenshtein_py.py` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/LCSseq_py.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,141 +1,133 @@
 # SPDX-License-Identifier: MIT
 # Copyright (C) 2022 Max Bachmann
 
 
-def _damerau_levenshtein_distance_zhao(s1, s2):
-    maxVal = max(len(s1), len(s2)) + 1
-    last_row_id = {}
-    last_row_id_get = last_row_id.get
-    size = len(s2) + 2
-    FR = [maxVal] * size
-    R1 = [maxVal] * size
-    R = [x for x in range(size)]
-    R[-1] = maxVal
-
-    for i in range(1, len(s1) + 1):
-        R, R1 = R1, R
-        last_col_id = -1
-        last_i2l1 = R[0]
-        R[0] = i
-        T = maxVal
-
-        for j in range(1, len(s2) + 1):
-            diag = R1[j - 1] + (s1[i - 1] != s2[j - 1])
-            left = R[j - 1] + 1
-            up = R1[j] + 1
-            temp = min(diag, left, up)
-
-            if s1[i - 1] == s2[j - 1]:
-                last_col_id = j  # last occurence of s1_i
-                FR[j] = R1[j - 2]  # save H_k-1,j-2
-                T = last_i2l1  # save H_i-2,l-1
-            else:
-                k = last_row_id_get(s2[j - 1], -1)
-                l = last_col_id
-
-                if (j - l) == 1:
-                    transpose = FR[j] + (i - k)
-                    temp = min(temp, transpose)
-                elif (i - k) == 1:
-                    transpose = T + (j - l)
-                    temp = min(temp, transpose)
-
-            last_i2l1 = R[j]
-            R[j] = temp
-
-        last_row_id[s1[i - 1]] = i
-
-    dist = R[len(s2)]
-    return dist
-
-
-def distance(s1, s2, *, processor=None, score_cutoff=None):
+def similarity(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates the minimum number of insertions and deletions
-    required to change one sequence into the other. This is equivalent to the
-    Levenshtein distance with a substitution weight of 2.
+    Calculates the length of the longest common subsequence
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
     score_cutoff : int, optional
         Maximum distance between s1 and s2, that is
-        considered as a result. If the distance is bigger than score_cutoff,
-        score_cutoff + 1 is returned instead. Default is None, which deactivates
+        considered as a result. If the similarity is smaller than score_cutoff,
+        0 is returned instead. Default is None, which deactivates
         this behaviour.
 
     Returns
     -------
-    distance : int
-        distance between s1 and s2
-
-    Examples
-    --------
-    Find the Damerau Levenshtein distance between two strings:
-
-    >>> from rapidfuzz.distance import DamerauLevenshtein
-    >>> DamerauLevenshtein.distance("CA", "ABC")
-    2
+    similarity : int
+        similarity between s1 and s2
     """
     if processor is not None:
         s1 = processor(s1)
         s2 = processor(s2)
 
-    dist = _damerau_levenshtein_distance_zhao(s1, s2)
-    return dist if (score_cutoff is None or dist <= score_cutoff) else score_cutoff + 1
+    if not s1:
+        return 0
 
+    S = (1 << len(s1)) - 1
+    block = {}
+    block_get = block.get
+    x = 1
+    for ch1 in s1:
+        block[ch1] = block_get(ch1, 0) | x
+        x <<= 1
+
+    for ch2 in s2:
+        Matches = block_get(ch2, 0)
+        u = S & Matches
+        S = (S + u) | (S - u)
+
+    # calculate the equivalent of popcount(~S) in C. This breaks for len(s1) == 0
+    res = bin(S)[-len(s1) :].count("0")
+    return res if (score_cutoff is None or res >= score_cutoff) else 0
+
+
+def _block_similarity(block, s1, s2, score_cutoff=None):
+    if not s1:
+        return 0
+
+    S = (1 << len(s1)) - 1
+    block_get = block.get
+
+    for ch2 in s2:
+        Matches = block_get(ch2, 0)
+        u = S & Matches
+        S = (S + u) | (S - u)
+
+    # calculate the equivalent of popcount(~S) in C. This breaks for len(s1) == 0
+    res = bin(S)[-len(s1) :].count("0")
+    return res if (score_cutoff is None or res >= score_cutoff) else 0
 
-def similarity(s1, s2, *, processor=None, score_cutoff=None):
+
+def distance(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates the Damerau Levenshtein similarity in the range [max, 0].
+    Calculates the LCS distance in the range [0, max].
 
-    This is calculated as ``(len1 + len2) - distance``.
+    This is calculated as ``max(len1, len2) - similarity``.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
     score_cutoff : int, optional
         Maximum distance between s1 and s2, that is
-        considered as a result. If the similarity is smaller than score_cutoff,
-        0 is returned instead. Default is None, which deactivates
+        considered as a result. If the distance is bigger than score_cutoff,
+        score_cutoff + 1 is returned instead. Default is None, which deactivates
         this behaviour.
 
     Returns
     -------
-    similarity : int
-        similarity between s1 and s2
+    distance : int
+        distance between s1 and s2
+
+    Examples
+    --------
+    Find the LCS distance between two strings:
+
+    >>> from rapidfuzz.distance import LCSseq
+    >>> LCSseq.distance("lewenstein", "levenshtein")
+    2
+
+    Setting a maximum distance allows the implementation to select
+    a more efficient implementation:
+
+    >>> LCSseq.distance("lewenstein", "levenshtein", score_cutoff=1)
+    2
+
     """
     if processor is not None:
         s1 = processor(s1)
         s2 = processor(s2)
 
     maximum = max(len(s1), len(s2))
-    dist = distance(s1, s2)
-    sim = maximum - dist
-    return sim if (score_cutoff is None or sim >= score_cutoff) else 0
+    sim = similarity(s1, s2)
+    dist = maximum - sim
+    return dist if (score_cutoff is None or dist <= score_cutoff) else score_cutoff + 1
 
 
 def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates a normalized levenshtein similarity in the range [1, 0].
+    Calculates a normalized LCS similarity in the range [1, 0].
 
-    This is calculated as ``distance / (len1 + len2)``.
+    This is calculated as ``distance / max(len1, len2)``.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
@@ -152,23 +144,25 @@
     norm_dist : float
         normalized distance between s1 and s2 as a float between 0 and 1.0
     """
     if processor is not None:
         s1 = processor(s1)
         s2 = processor(s2)
 
+    if not s1 or not s2:
+        return 0
+
     maximum = max(len(s1), len(s2))
-    dist = distance(s1, s2)
-    norm_dist = dist / maximum if maximum else 0
-    return norm_dist if (score_cutoff is None or norm_dist <= score_cutoff) else 1
+    norm_sim = distance(s1, s2) / maximum
+    return norm_sim if (score_cutoff is None or norm_sim <= score_cutoff) else 1
 
 
 def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates a normalized indel similarity in the range [0, 1].
+    Calculates a normalized LCS similarity in the range [0, 1].
 
     This is calculated as ``1 - normalized_distance``
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
@@ -182,44 +176,123 @@
         For norm_sim < score_cutoff 0 is returned instead. Default is 0,
         which deactivates this behaviour.
 
     Returns
     -------
     norm_sim : float
         normalized similarity between s1 and s2 as a float between 0 and 1.0
+
+    Examples
+    --------
+    Find the normalized LCS similarity between two strings:
+
+    >>> from rapidfuzz.distance import LCSseq
+    >>> LCSseq.normalized_similarity("lewenstein", "levenshtein")
+    0.8181818181818181
+
+    Setting a score_cutoff allows the implementation to select
+    a more efficient implementation:
+
+    >>> LCSseq.normalized_similarity("lewenstein", "levenshtein", score_cutoff=0.9)
+    0.0
+
+    When a different processor is used s1 and s2 do not have to be strings
+
+    >>> LCSseq.normalized_similarity(["lewenstein"], ["levenshtein"], processor=lambda s: s[0])
+    0.81818181818181
     """
     if processor is not None:
         s1 = processor(s1)
         s2 = processor(s2)
 
-    norm_dist = normalized_distance(s1, s2)
-    norm_sim = 1.0 - norm_dist
+    norm_sim = 1.0 - normalized_distance(s1, s2)
     return norm_sim if (score_cutoff is None or norm_sim >= score_cutoff) else 0
 
 
-def _GetScorerFlagsDistance(**kwargs):
-    return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
+def editops(s1, s2, *, processor=None):
+    """
+    Return Editops describing how to turn s1 into s2.
+
+    Parameters
+    ----------
+    s1 : Sequence[Hashable]
+        First string to compare.
+    s2 : Sequence[Hashable]
+        Second string to compare.
+    processor: callable, optional
+        Optional callable that is used to preprocess the strings before
+        comparing them. Default is None, which deactivates this behaviour.
+
+    Returns
+    -------
+    editops : Editops
+        edit operations required to turn s1 into s2
 
+    Notes
+    -----
+    The alignment is calculated using an algorithm of Heikki Hyyr, which is
+    described [6]_. It has a time complexity and memory usage of ``O([N/64] * M)``.
 
-def _GetScorerFlagsSimilarity(**kwargs):
-    return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
+    References
+    ----------
+    .. [6] Hyyr, Heikki. "A Note on Bit-Parallel Alignment Computation."
+           Stringology (2004).
 
+    Examples
+    --------
+    >>> from rapidfuzz.distance import LCSseq
+    >>> for tag, src_pos, dest_pos in LCSseq.editops("qabxcd", "abycdf"):
+    ...    print(("%7s s1[%d] s2[%d]" % (tag, src_pos, dest_pos)))
+     delete s1[0] s2[0]
+     delete s1[3] s2[2]
+     insert s1[4] s2[2]
+     insert s1[6] s2[5]
+    """
+    raise NotImplementedError
 
-def _GetScorerFlagsNormalizedDistance(**kwargs):
-    return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
 
+def opcodes(s1, s2, *, processor=None):
+    """
+    Return Opcodes describing how to turn s1 into s2.
 
-def _GetScorerFlagsNormalizedSimilarity(**kwargs):
-    return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
+    Parameters
+    ----------
+    s1 : Sequence[Hashable]
+        First string to compare.
+    s2 : Sequence[Hashable]
+        Second string to compare.
+    processor: callable, optional
+        Optional callable that is used to preprocess the strings before
+        comparing them. Default is None, which deactivates this behaviour.
 
+    Returns
+    -------
+    opcodes : Opcodes
+        edit operations required to turn s1 into s2
 
-distance._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}
+    Notes
+    -----
+    The alignment is calculated using an algorithm of Heikki Hyyr, which is
+    described [7]_. It has a time complexity and memory usage of ``O([N/64] * M)``.
 
-similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
+    References
+    ----------
+    .. [7] Hyyr, Heikki. "A Note on Bit-Parallel Alignment Computation."
+           Stringology (2004).
 
-normalized_distance._RF_ScorerPy = {
-    "get_scorer_flags": _GetScorerFlagsNormalizedDistance
-}
+    Examples
+    --------
+    >>> from rapidfuzz.distance import LCSseq
 
-normalized_similarity._RF_ScorerPy = {
-    "get_scorer_flags": _GetScorerFlagsNormalizedSimilarity
-}
+    >>> a = "qabxcd"
+    >>> b = "abycdf"
+    >>> for tag, i1, i2, j1, j2 in LCSseq.opcodes(a, b):
+    ...    print(("%7s a[%d:%d] (%s) b[%d:%d] (%s)" %
+    ...           (tag, i1, i2, a[i1:i2], j1, j2, b[j1:j2])))
+     delete a[0:1] (q) b[0:0] ()
+      equal a[1:3] (ab) b[0:2] (ab)
+     delete a[3:4] (x) b[2:2] ()
+     insert a[4:4] () b[2:3] (y)
+      equal a[4:6] (cd) b[3:5] (cd)
+     insert a[6:6] () b[5:6] (f)
+    """
+    raise NotImplementedError
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/DamerauLevenshtein_py.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/DamerauLevenshtein_py.pyi`

 * *Files 4% similar despite different names*

```diff
@@ -1,9 +1,8 @@
 from typing import Callable, Hashable, Sequence, Optional, TypeVar, Any, Dict
-from rapidfuzz.distance import Editops, Opcodes
 from typing_extensions import Protocol
 
 class _ScorerAttributes(Protocol):
     _RF_ScorerPy: Dict
 
 def _attr_decorator(func: Any) -> _ScorerAttributes:
     return func
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/Hamming.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming_cpp.cxx` & `rapidfuzz-2.9.0/src/rapidfuzz/utils_cpp.cxx`

 * *Files 14% similar despite different names*

```diff
@@ -1034,16 +1034,16 @@
   #ifdef __cplusplus
     #define __PYX_EXTERN_C extern "C"
   #else
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
-#define __PYX_HAVE__rapidfuzz__distance__Hamming_cpp
-#define __PYX_HAVE_API__rapidfuzz__distance__Hamming_cpp
+#define __PYX_HAVE__rapidfuzz__utils_cpp
+#define __PYX_HAVE_API__rapidfuzz__utils_cpp
 /* Early includes */
 #include <stdint.h>
 #include "rapidfuzz_capi.h"
 #include <string.h>
 #include <stdlib.h>
 #include <stddef.h>
 #include "ios"
@@ -1063,15 +1063,15 @@
 
     #endif
     
 #include <stdio.h>
 #include <vector>
 #include "rapidfuzz/details/types.hpp"
 #include "cpp_common.hpp"
-#include "edit_based.hpp"
+#include "utils_cpp.hpp"
 #ifdef _OPENMP
 #include <omp.h>
 #endif /* _OPENMP */
 
 #if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
 #define CYTHON_WITHOUT_ASSERTIONS
 #endif
@@ -1285,31 +1285,26 @@
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm = __FILE__;
 static const char *__pyx_filename;
 
 /* #### Code section: filename_table ### */
 
 static const char *__pyx_f[] = {
-  "src/rapidfuzz/distance/Hamming_cpp.pyx",
+  "src/rapidfuzz/utils_cpp.pyx",
   "./src/rapidfuzz/cpp_common.pxd",
   "type.pxd",
 };
 /* #### Code section: utility_code_proto_before_types ### */
 /* NoFastGil.proto */
 #define __Pyx_PyGILState_Ensure PyGILState_Ensure
 #define __Pyx_PyGILState_Release PyGILState_Release
 #define __Pyx_FastGIL_Remember()
 #define __Pyx_FastGIL_Forget()
 #define __Pyx_FastGilFuncInit()
 
-/* ForceInitThreads.proto */
-#ifndef __PYX_FORCE_INIT_THREADS
-  #define __PYX_FORCE_INIT_THREADS 0
-#endif
-
 /* #### Code section: numeric_typedefs ### */
 /* #### Code section: complex_type_declarations ### */
 /* #### Code section: type_declarations ### */
 
 /*--- Type declarations ---*/
 /* #### Code section: utility_code_proto ### */
 
@@ -1389,71 +1384,14 @@
 #define __Pyx_DECREF_SET(r, v) do {\
         PyObject *tmp = (PyObject *) r;\
         r = v; __Pyx_DECREF(tmp);\
     } while (0)
 #define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
 #define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)
 
-/* PyErrExceptionMatches.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
-#else
-#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
-#endif
-
-/* PyThreadStateGet.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
-#define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
-#define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
-#else
-#define __Pyx_PyThreadState_declare
-#define __Pyx_PyThreadState_assign
-#define __Pyx_PyErr_Occurred()  PyErr_Occurred()
-#endif
-
-/* PyErrFetchRestore.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_PyErr_Clear() __Pyx_ErrRestore(NULL, NULL, NULL)
-#define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
-#define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
-#define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
-#define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
-static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#if CYTHON_COMPILING_IN_CPYTHON
-#define __Pyx_PyErr_SetNone(exc) (Py_INCREF(exc), __Pyx_ErrRestore((exc), NULL, NULL))
-#else
-#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
-#endif
-#else
-#define __Pyx_PyErr_Clear() PyErr_Clear()
-#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
-#define __Pyx_ErrRestoreWithState(type, value, tb)  PyErr_Restore(type, value, tb)
-#define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
-#define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
-#define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
-#define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
-#define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
-#endif
-
-/* PyObjectGetAttrStr.proto */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
-#else
-#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
-#endif
-
-/* PyObjectGetAttrStrNoError.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
-
-/* GetBuiltinName.proto */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name);
-
 /* TupleAndListFromArray.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n);
 static CYTHON_INLINE PyObject* __Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n);
 #endif
 
 /* IncludeStringH.proto */
@@ -1488,27 +1426,63 @@
 #define __Pyx_ArgsSlice_VARARGS(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_VARARGS(args, start), stop - start)
 #define __Pyx_ArgsSlice_FASTCALL(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_FASTCALL(args, start), stop - start)
 #else
 #define __Pyx_ArgsSlice_VARARGS(args, start, stop) PyTuple_GetSlice(args, start, stop)
 #define __Pyx_ArgsSlice_FASTCALL(args, start, stop) PyTuple_GetSlice(args, start, stop)
 #endif
 
-/* RaiseArgTupleInvalid.proto */
-static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
-    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
-
 /* RaiseDoubleKeywords.proto */
 static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
 
 /* ParseKeywords.proto */
 static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject *const *kwvalues,
     PyObject **argnames[],
     PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,
     const char* function_name);
 
+/* RaiseArgTupleInvalid.proto */
+static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
+    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
+
+/* PyThreadStateGet.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
+#define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
+#define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
+#else
+#define __Pyx_PyThreadState_declare
+#define __Pyx_PyThreadState_assign
+#define __Pyx_PyErr_Occurred()  PyErr_Occurred()
+#endif
+
+/* PyErrFetchRestore.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_PyErr_Clear() __Pyx_ErrRestore(NULL, NULL, NULL)
+#define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
+#define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
+#define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
+#define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
+static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#if CYTHON_COMPILING_IN_CPYTHON
+#define __Pyx_PyErr_SetNone(exc) (Py_INCREF(exc), __Pyx_ErrRestore((exc), NULL, NULL))
+#else
+#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
+#endif
+#else
+#define __Pyx_PyErr_Clear() PyErr_Clear()
+#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
+#define __Pyx_ErrRestoreWithState(type, value, tb)  PyErr_Restore(type, value, tb)
+#define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
+#define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
+#define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
+#define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
+#define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
+#endif
+
 /* Profile.proto */
 #ifndef CYTHON_PROFILE
 #if CYTHON_COMPILING_IN_LIMITED_API || CYTHON_COMPILING_IN_PYPY
   #define CYTHON_PROFILE 0
 #else
   #define CYTHON_PROFILE 1
 #endif
@@ -1733,26 +1707,58 @@
       }\
   }
   #endif
 #else
   #define __Pyx_TraceLine(lineno, nogil, goto_error)   if ((1)); else goto_error;
 #endif
 
-/* PyObjectCall.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
+/* GetTopmostException.proto */
+#if CYTHON_USE_EXC_INFO_STACK
+static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
+#endif
+
+/* SaveResetException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
 #else
-#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
+#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
+#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
 #endif
 
-/* RaiseException.proto */
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+/* GetException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
+static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#else
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
+#endif
 
-/* KeywordStringCheck.proto */
-static int __Pyx_CheckKeywordStrings(PyObject *kw, const char* function_name, int kw_allowed);
+/* PyErrExceptionMatches.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
+#else
+#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
+#endif
+
+/* PyObjectGetAttrStr.proto */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
+#else
+#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
+#endif
+
+/* PyObjectGetAttrStrNoError.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
+
+/* GetBuiltinName.proto */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name);
 
 /* GetItemInt.proto */
 #define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
     (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
     __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
     (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
                __Pyx_GetItemInt_Generic(o, to_py_func(i))))
@@ -1768,38 +1774,14 @@
     (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
 static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                               int wraparound, int boundscheck);
 static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
 static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
                                                      int is_list, int wraparound, int boundscheck);
 
-/* GetTopmostException.proto */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
-#endif
-
-/* SaveResetException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
-#else
-#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
-#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
-#endif
-
-/* GetException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
-static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#else
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
-#endif
-
 /* SwapException.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_ExceptionSwap(type, value, tb)  __Pyx__ExceptionSwap(__pyx_tstate, type, value, tb)
 static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
 #else
 static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
 #endif
@@ -1911,26 +1893,36 @@
      (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
   #define __Pyx_PyFrame_GetLocalsplus(frame)\
     (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
 #endif
 #endif
 #endif
 
+/* PyObjectCall.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
+#else
+#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
+#endif
+
 /* PyObjectCallMethO.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
 #endif
 
 /* PyObjectFastCall.proto */
 #define __Pyx_PyObject_FastCall(func, args, nargs)  __Pyx_PyObject_FastCallDict(func, args, (size_t)(nargs), NULL)
 static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs);
 
 /* PyObjectCallOneArg.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
 
+/* RaiseException.proto */
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+
 /* GetAttr3.proto */
 static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *, PyObject *, PyObject *);
 
 /* py_dict_keys.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyDict_Keys(PyObject* d);
 
 /* UnpackUnboundCMethod.proto */
@@ -2154,19 +2146,14 @@
 static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);
 #endif
 
 /* AddTraceback.proto */
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename);
 
-/* GCCDiagnostics.proto */
-#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
-#define __Pyx_HAS_GCC_DIAGNOSTIC
-#endif
-
 /* CppExceptionConversion.proto */
 #ifndef __Pyx_CppExn2PyErr
 #include <new>
 #include <typeinfo>
 #include <stdexcept>
 #include <ios>
 static void __Pyx_CppExn2PyErr() {
@@ -2215,28 +2202,33 @@
 #else
   #define __PYX_ENUM_CLASS_DECL enum
 #endif
 
 /* UnicodeAsUCS4.proto */
 static CYTHON_INLINE Py_UCS4 __Pyx_PyUnicode_AsPy_UCS4(PyObject*);
 
+/* GCCDiagnostics.proto */
+#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
+#define __Pyx_HAS_GCC_DIAGNOSTIC
+#endif
+
+/* ObjectAsUCS4.proto */
+#define __Pyx_PyObject_AsPy_UCS4(x)\
+    (likely(PyUnicode_Check(x)) ? __Pyx_PyUnicode_AsPy_UCS4(x) : __Pyx__PyObject_AsPy_UCS4(x))
+static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject*);
+
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int64_t(int64_t value);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE int64_t __Pyx_PyInt_As_int64_t(PyObject *);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE uint64_t __Pyx_PyInt_As_uint64_t(PyObject *);
 
-/* ObjectAsUCS4.proto */
-#define __Pyx_PyObject_AsPy_UCS4(x)\
-    (likely(PyUnicode_Check(x)) ? __Pyx_PyUnicode_AsPy_UCS4(x) : __Pyx__PyObject_AsPy_UCS4(x))
-static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject*);
-
 /* FormatTypeName.proto */
 #if CYTHON_COMPILING_IN_LIMITED_API
 typedef PyObject *__Pyx_TypeName;
 #define __Pyx_FMT_TYPENAME "%U"
 static __Pyx_TypeName __Pyx_PyType_GetName(PyTypeObject* tp);
 #define __Pyx_DECREF_TypeName(obj) Py_XDECREF(obj)
 #else
@@ -2343,167 +2335,98 @@
 
 /* Module declarations from "cpp_common" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_hash_array(PyObject *); /*proto*/
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_hash_sequence(PyObject *); /*proto*/
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_conv_sequence(PyObject *); /*proto*/
-static CYTHON_INLINE void __pyx_f_10cpp_common_preprocess_strings(PyObject *, PyObject *, PyObject *, RF_StringWrapper *, RF_StringWrapper *, PyObject *); /*proto*/
-static CYTHON_INLINE bool __pyx_f_10cpp_common_NoKwargsInit(RF_Kwargs *, PyObject *); /*proto*/
-static CYTHON_INLINE RF_Scorer __pyx_f_10cpp_common_CreateScorerContext(RF_KwargsInit, RF_GetScorerFlags, RF_ScorerFuncInit); /*proto*/
 
-/* Module declarations from "rapidfuzz.distance.Hamming_cpp" */
+/* Module declarations from "rapidfuzz.utils_cpp" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
-static RF_Scorer __pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingDistanceContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingNormalizedDistanceContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingSimilarityContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingNormalizedSimilarityContext;
-static bool __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
-static bool __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingNormalizedDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
-static bool __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
-static bool __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingNormalizedSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static RF_Preprocessor __pyx_v_9rapidfuzz_9utils_cpp_DefaultProcessContext;
+static bool __pyx_f_9rapidfuzz_9utils_cpp_default_process_capi(PyObject *, RF_String *); /*proto*/
 /* #### Code section: typeinfo ### */
 /* #### Code section: before_global_var ### */
-#define __Pyx_MODULE_NAME "rapidfuzz.distance.Hamming_cpp"
-extern int __pyx_module_is_main_rapidfuzz__distance__Hamming_cpp;
-int __pyx_module_is_main_rapidfuzz__distance__Hamming_cpp = 0;
+#define __Pyx_MODULE_NAME "rapidfuzz.utils_cpp"
+extern int __pyx_module_is_main_rapidfuzz__utils_cpp;
+int __pyx_module_is_main_rapidfuzz__utils_cpp = 0;
 
-/* Implementation of "rapidfuzz.distance.Hamming_cpp" */
+/* Implementation of "rapidfuzz.utils_cpp" */
 /* #### Code section: global_var ### */
-static PyObject *__pyx_builtin_ValueError;
 static PyObject *__pyx_builtin_MemoryError;
 static PyObject *__pyx_builtin_range;
 static PyObject *__pyx_builtin_TypeError;
 /* #### Code section: string_decls ### */
-static const char __pyx_k_s1[] = "s1";
-static const char __pyx_k_s2[] = "s2";
-static const char __pyx_k__10[] = " - ";
-static const char __pyx_k__11[] = ", ";
-static const char __pyx_k__12[] = ".";
-static const char __pyx_k__16[] = "?";
+static const char __pyx_k__2[] = " - ";
+static const char __pyx_k__3[] = ", ";
+static const char __pyx_k__4[] = ".";
+static const char __pyx_k__6[] = "?";
 static const char __pyx_k_keys[] = "keys";
 static const char __pyx_k_main[] = "__main__";
 static const char __pyx_k_name[] = "__name__";
 static const char __pyx_k_test[] = "__test__";
 static const char __pyx_k_array[] = "array";
-static const char __pyx_k_flags[] = "flags";
 static const char __pyx_k_range[] = "range";
 static const char __pyx_k_import[] = "__import__";
-static const char __pyx_k_kwargs[] = "kwargs";
-static const char __pyx_k_s1_proc[] = "s1_proc";
-static const char __pyx_k_s2_proc[] = "s2_proc";
-static const char __pyx_k_distance[] = "distance";
+static const char __pyx_k_sentence[] = "sentence";
 static const char __pyx_k_typecode[] = "typecode";
 static const char __pyx_k_RF_Scorer[] = "_RF_Scorer";
 static const char __pyx_k_TypeError[] = "TypeError";
-static const char __pyx_k_processor[] = "processor";
-static const char __pyx_k_ValueError[] = "ValueError";
-static const char __pyx_k_similarity[] = "similarity";
 static const char __pyx_k_MemoryError[] = "MemoryError";
 static const char __pyx_k_RF_ScorerPy[] = "_RF_ScorerPy";
-static const char __pyx_k_worst_score[] = "worst_score";
 static const char __pyx_k_is_coroutine[] = "_is_coroutine";
-static const char __pyx_k_score_cutoff[] = "score_cutoff";
 static const char __pyx_k_RF_Preprocess[] = "_RF_Preprocess";
-static const char __pyx_k_optimal_score[] = "optimal_score";
-static const char __pyx_k_c_score_cutoff[] = "c_score_cutoff";
+static const char __pyx_k_default_process[] = "default_process";
 static const char __pyx_k_get_scorer_flags[] = "get_scorer_flags";
 static const char __pyx_k_asyncio_coroutines[] = "asyncio.coroutines";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
-static const char __pyx_k_normalized_distance[] = "normalized_distance";
-static const char __pyx_k_normalized_similarity[] = "normalized_similarity";
-static const char __pyx_k_GetScorerFlagsDistance[] = "_GetScorerFlagsDistance";
-static const char __pyx_k_GetScorerFlagsSimilarity[] = "_GetScorerFlagsSimilarity";
-static const char __pyx_k_score_cutoff_has_to_be_0[] = "score_cutoff has to be >= 0";
-static const char __pyx_k_rapidfuzz_distance_Hamming_cpp[] = "rapidfuzz.distance.Hamming_cpp";
-static const char __pyx_k_GetScorerFlagsNormalizedDistanc[] = "_GetScorerFlagsNormalizedDistance";
-static const char __pyx_k_GetScorerFlagsNormalizedSimilar[] = "_GetScorerFlagsNormalizedSimilarity";
+static const char __pyx_k_rapidfuzz_utils_cpp[] = "rapidfuzz.utils_cpp";
+static const char __pyx_k_src_rapidfuzz_utils_cpp_pyx[] = "src/rapidfuzz/utils_cpp.pyx";
 static const char __pyx_k_Got_unexpected_keyword_arguments[] = "Got unexpected keyword arguments: ";
 static const char __pyx_k_score_cutoff_has_to_be_in_the_ra[] = "score_cutoff has to be in the range of ";
-static const char __pyx_k_src_rapidfuzz_distance_Hamming_c[] = "src/rapidfuzz/distance/Hamming_cpp.pyx";
 #if !CYTHON_USE_MODULE_STATE
-static PyObject *__pyx_n_s_GetScorerFlagsDistance;
-static PyObject *__pyx_n_s_GetScorerFlagsNormalizedDistanc;
-static PyObject *__pyx_n_s_GetScorerFlagsNormalizedSimilar;
-static PyObject *__pyx_n_s_GetScorerFlagsSimilarity;
 static PyObject *__pyx_kp_u_Got_unexpected_keyword_arguments;
 static PyObject *__pyx_n_s_MemoryError;
+static PyObject *__pyx_n_s_RF_Preprocess;
 static PyObject *__pyx_n_u_RF_Preprocess;
 static PyObject *__pyx_n_s_RF_Scorer;
 static PyObject *__pyx_n_s_RF_ScorerPy;
 static PyObject *__pyx_n_s_TypeError;
-static PyObject *__pyx_n_s_ValueError;
-static PyObject *__pyx_kp_u__10;
-static PyObject *__pyx_kp_u__11;
-static PyObject *__pyx_kp_u__12;
-static PyObject *__pyx_n_s__16;
+static PyObject *__pyx_kp_u__2;
+static PyObject *__pyx_kp_u__3;
+static PyObject *__pyx_kp_u__4;
+static PyObject *__pyx_n_s__6;
 static PyObject *__pyx_n_s_array;
 static PyObject *__pyx_n_s_asyncio_coroutines;
-static PyObject *__pyx_n_s_c_score_cutoff;
 static PyObject *__pyx_n_s_cline_in_traceback;
-static PyObject *__pyx_n_s_distance;
-static PyObject *__pyx_n_u_flags;
+static PyObject *__pyx_n_s_default_process;
 static PyObject *__pyx_n_u_get_scorer_flags;
 static PyObject *__pyx_n_s_import;
 static PyObject *__pyx_n_s_is_coroutine;
 static PyObject *__pyx_n_s_keys;
-static PyObject *__pyx_n_s_kwargs;
 static PyObject *__pyx_n_s_main;
 static PyObject *__pyx_n_s_name;
-static PyObject *__pyx_n_s_normalized_distance;
-static PyObject *__pyx_n_s_normalized_similarity;
-static PyObject *__pyx_n_u_optimal_score;
-static PyObject *__pyx_n_s_processor;
 static PyObject *__pyx_n_s_range;
-static PyObject *__pyx_n_s_rapidfuzz_distance_Hamming_cpp;
-static PyObject *__pyx_n_s_s1;
-static PyObject *__pyx_n_s_s1_proc;
-static PyObject *__pyx_n_s_s2;
-static PyObject *__pyx_n_s_s2_proc;
-static PyObject *__pyx_n_s_score_cutoff;
-static PyObject *__pyx_kp_u_score_cutoff_has_to_be_0;
+static PyObject *__pyx_n_s_rapidfuzz_utils_cpp;
 static PyObject *__pyx_kp_u_score_cutoff_has_to_be_in_the_ra;
-static PyObject *__pyx_n_s_similarity;
-static PyObject *__pyx_kp_s_src_rapidfuzz_distance_Hamming_c;
+static PyObject *__pyx_n_s_sentence;
+static PyObject *__pyx_kp_s_src_rapidfuzz_utils_cpp_pyx;
 static PyObject *__pyx_n_s_test;
 static PyObject *__pyx_n_s_typecode;
-static PyObject *__pyx_n_u_worst_score;
 #endif
 /* #### Code section: decls ### */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_2similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_4normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_6normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_8_GetScorerFlagsDistance(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_10_GetScorerFlagsSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_12_GetScorerFlagsNormalizedDistance(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_14_GetScorerFlagsNormalizedSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_9utils_cpp_default_process(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_sentence); /* proto */
 static __Pyx_CachedCFunction __pyx_umethod_PyDict_Type_keys = {0, 0, 0, 0, 0};
 #if !CYTHON_USE_MODULE_STATE
-static PyObject *__pyx_int_0;
-static PyObject *__pyx_int_1;
-static PyObject *__pyx_int_32;
-static PyObject *__pyx_int_64;
-static PyObject *__pyx_int_9223372036854775807;
 static PyObject *__pyx_int_neg_1;
 #endif
 #if !CYTHON_USE_MODULE_STATE
 static PyObject *__pyx_codeobj_;
-static PyObject *__pyx_tuple__2;
-static PyObject *__pyx_tuple__13;
-static PyObject *__pyx_tuple__14;
-static PyObject *__pyx_tuple__15;
-static PyObject *__pyx_codeobj__3;
-static PyObject *__pyx_codeobj__4;
-static PyObject *__pyx_codeobj__5;
-static PyObject *__pyx_codeobj__6;
-static PyObject *__pyx_codeobj__7;
-static PyObject *__pyx_codeobj__8;
-static PyObject *__pyx_codeobj__9;
+static PyObject *__pyx_tuple__5;
 #endif
 /* #### Code section: late_includes ### */
 /* #### Code section: module_state ### */
 #if CYTHON_USE_MODULE_STATE
 typedef struct {
   PyObject *__pyx_d;
   PyObject *__pyx_b;
@@ -2514,78 +2437,45 @@
   #ifdef __Pyx_CyFunction_USED
   PyTypeObject *__pyx_CyFunctionType;
   #endif
   #ifdef __Pyx_FusedFunction_USED
   PyTypeObject *__pyx_FusedFunctionType;
   #endif
   PyTypeObject *__pyx_ptype_7cpython_4type_type;
-  PyObject *__pyx_n_s_GetScorerFlagsDistance;
-  PyObject *__pyx_n_s_GetScorerFlagsNormalizedDistanc;
-  PyObject *__pyx_n_s_GetScorerFlagsNormalizedSimilar;
-  PyObject *__pyx_n_s_GetScorerFlagsSimilarity;
   PyObject *__pyx_kp_u_Got_unexpected_keyword_arguments;
   PyObject *__pyx_n_s_MemoryError;
+  PyObject *__pyx_n_s_RF_Preprocess;
   PyObject *__pyx_n_u_RF_Preprocess;
   PyObject *__pyx_n_s_RF_Scorer;
   PyObject *__pyx_n_s_RF_ScorerPy;
   PyObject *__pyx_n_s_TypeError;
-  PyObject *__pyx_n_s_ValueError;
-  PyObject *__pyx_kp_u__10;
-  PyObject *__pyx_kp_u__11;
-  PyObject *__pyx_kp_u__12;
-  PyObject *__pyx_n_s__16;
+  PyObject *__pyx_kp_u__2;
+  PyObject *__pyx_kp_u__3;
+  PyObject *__pyx_kp_u__4;
+  PyObject *__pyx_n_s__6;
   PyObject *__pyx_n_s_array;
   PyObject *__pyx_n_s_asyncio_coroutines;
-  PyObject *__pyx_n_s_c_score_cutoff;
   PyObject *__pyx_n_s_cline_in_traceback;
-  PyObject *__pyx_n_s_distance;
-  PyObject *__pyx_n_u_flags;
+  PyObject *__pyx_n_s_default_process;
   PyObject *__pyx_n_u_get_scorer_flags;
   PyObject *__pyx_n_s_import;
   PyObject *__pyx_n_s_is_coroutine;
   PyObject *__pyx_n_s_keys;
-  PyObject *__pyx_n_s_kwargs;
   PyObject *__pyx_n_s_main;
   PyObject *__pyx_n_s_name;
-  PyObject *__pyx_n_s_normalized_distance;
-  PyObject *__pyx_n_s_normalized_similarity;
-  PyObject *__pyx_n_u_optimal_score;
-  PyObject *__pyx_n_s_processor;
   PyObject *__pyx_n_s_range;
-  PyObject *__pyx_n_s_rapidfuzz_distance_Hamming_cpp;
-  PyObject *__pyx_n_s_s1;
-  PyObject *__pyx_n_s_s1_proc;
-  PyObject *__pyx_n_s_s2;
-  PyObject *__pyx_n_s_s2_proc;
-  PyObject *__pyx_n_s_score_cutoff;
-  PyObject *__pyx_kp_u_score_cutoff_has_to_be_0;
+  PyObject *__pyx_n_s_rapidfuzz_utils_cpp;
   PyObject *__pyx_kp_u_score_cutoff_has_to_be_in_the_ra;
-  PyObject *__pyx_n_s_similarity;
-  PyObject *__pyx_kp_s_src_rapidfuzz_distance_Hamming_c;
+  PyObject *__pyx_n_s_sentence;
+  PyObject *__pyx_kp_s_src_rapidfuzz_utils_cpp_pyx;
   PyObject *__pyx_n_s_test;
   PyObject *__pyx_n_s_typecode;
-  PyObject *__pyx_n_u_worst_score;
-  PyObject *__pyx_int_0;
-  PyObject *__pyx_int_1;
-  PyObject *__pyx_int_32;
-  PyObject *__pyx_int_64;
-  PyObject *__pyx_int_9223372036854775807;
   PyObject *__pyx_int_neg_1;
   PyObject *__pyx_codeobj_;
-  PyObject *__pyx_tuple__2;
-  PyObject *__pyx_tuple__13;
-  PyObject *__pyx_tuple__14;
-  PyObject *__pyx_tuple__15;
-  PyObject *__pyx_codeobj__3;
-  PyObject *__pyx_codeobj__4;
-  PyObject *__pyx_codeobj__5;
-  PyObject *__pyx_codeobj__6;
-  PyObject *__pyx_codeobj__7;
-  PyObject *__pyx_codeobj__8;
-  PyObject *__pyx_codeobj__9;
+  PyObject *__pyx_tuple__5;
 } __pyx_mstate;
 
 #ifdef __cplusplus
 namespace {
   extern struct PyModuleDef __pyx_moduledef;
 } /* anonymous namespace */
 #else
@@ -2612,78 +2502,45 @@
   #ifdef __Pyx_CyFunction_USED
   Py_CLEAR(clear_module_state->__pyx_CyFunctionType);
   #endif
   #ifdef __Pyx_FusedFunction_USED
   Py_CLEAR(clear_module_state->__pyx_FusedFunctionType);
   #endif
   Py_CLEAR(clear_module_state->__pyx_ptype_7cpython_4type_type);
-  Py_CLEAR(clear_module_state->__pyx_n_s_GetScorerFlagsDistance);
-  Py_CLEAR(clear_module_state->__pyx_n_s_GetScorerFlagsNormalizedDistanc);
-  Py_CLEAR(clear_module_state->__pyx_n_s_GetScorerFlagsNormalizedSimilar);
-  Py_CLEAR(clear_module_state->__pyx_n_s_GetScorerFlagsSimilarity);
   Py_CLEAR(clear_module_state->__pyx_kp_u_Got_unexpected_keyword_arguments);
   Py_CLEAR(clear_module_state->__pyx_n_s_MemoryError);
+  Py_CLEAR(clear_module_state->__pyx_n_s_RF_Preprocess);
   Py_CLEAR(clear_module_state->__pyx_n_u_RF_Preprocess);
   Py_CLEAR(clear_module_state->__pyx_n_s_RF_Scorer);
   Py_CLEAR(clear_module_state->__pyx_n_s_RF_ScorerPy);
   Py_CLEAR(clear_module_state->__pyx_n_s_TypeError);
-  Py_CLEAR(clear_module_state->__pyx_n_s_ValueError);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__10);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__11);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__12);
-  Py_CLEAR(clear_module_state->__pyx_n_s__16);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__2);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__3);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__4);
+  Py_CLEAR(clear_module_state->__pyx_n_s__6);
   Py_CLEAR(clear_module_state->__pyx_n_s_array);
   Py_CLEAR(clear_module_state->__pyx_n_s_asyncio_coroutines);
-  Py_CLEAR(clear_module_state->__pyx_n_s_c_score_cutoff);
   Py_CLEAR(clear_module_state->__pyx_n_s_cline_in_traceback);
-  Py_CLEAR(clear_module_state->__pyx_n_s_distance);
-  Py_CLEAR(clear_module_state->__pyx_n_u_flags);
+  Py_CLEAR(clear_module_state->__pyx_n_s_default_process);
   Py_CLEAR(clear_module_state->__pyx_n_u_get_scorer_flags);
   Py_CLEAR(clear_module_state->__pyx_n_s_import);
   Py_CLEAR(clear_module_state->__pyx_n_s_is_coroutine);
   Py_CLEAR(clear_module_state->__pyx_n_s_keys);
-  Py_CLEAR(clear_module_state->__pyx_n_s_kwargs);
   Py_CLEAR(clear_module_state->__pyx_n_s_main);
   Py_CLEAR(clear_module_state->__pyx_n_s_name);
-  Py_CLEAR(clear_module_state->__pyx_n_s_normalized_distance);
-  Py_CLEAR(clear_module_state->__pyx_n_s_normalized_similarity);
-  Py_CLEAR(clear_module_state->__pyx_n_u_optimal_score);
-  Py_CLEAR(clear_module_state->__pyx_n_s_processor);
   Py_CLEAR(clear_module_state->__pyx_n_s_range);
-  Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_distance_Hamming_cpp);
-  Py_CLEAR(clear_module_state->__pyx_n_s_s1);
-  Py_CLEAR(clear_module_state->__pyx_n_s_s1_proc);
-  Py_CLEAR(clear_module_state->__pyx_n_s_s2);
-  Py_CLEAR(clear_module_state->__pyx_n_s_s2_proc);
-  Py_CLEAR(clear_module_state->__pyx_n_s_score_cutoff);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_score_cutoff_has_to_be_0);
+  Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_utils_cpp);
   Py_CLEAR(clear_module_state->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
-  Py_CLEAR(clear_module_state->__pyx_n_s_similarity);
-  Py_CLEAR(clear_module_state->__pyx_kp_s_src_rapidfuzz_distance_Hamming_c);
+  Py_CLEAR(clear_module_state->__pyx_n_s_sentence);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_src_rapidfuzz_utils_cpp_pyx);
   Py_CLEAR(clear_module_state->__pyx_n_s_test);
   Py_CLEAR(clear_module_state->__pyx_n_s_typecode);
-  Py_CLEAR(clear_module_state->__pyx_n_u_worst_score);
-  Py_CLEAR(clear_module_state->__pyx_int_0);
-  Py_CLEAR(clear_module_state->__pyx_int_1);
-  Py_CLEAR(clear_module_state->__pyx_int_32);
-  Py_CLEAR(clear_module_state->__pyx_int_64);
-  Py_CLEAR(clear_module_state->__pyx_int_9223372036854775807);
   Py_CLEAR(clear_module_state->__pyx_int_neg_1);
   Py_CLEAR(clear_module_state->__pyx_codeobj_);
-  Py_CLEAR(clear_module_state->__pyx_tuple__2);
-  Py_CLEAR(clear_module_state->__pyx_tuple__13);
-  Py_CLEAR(clear_module_state->__pyx_tuple__14);
-  Py_CLEAR(clear_module_state->__pyx_tuple__15);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__3);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__4);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__5);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__6);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__7);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__8);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__9);
+  Py_CLEAR(clear_module_state->__pyx_tuple__5);
   return 0;
 }
 #endif
 /* #### Code section: module_state_traverse ### */
 #if CYTHON_USE_MODULE_STATE
 static int __pyx_m_traverse(PyObject *m, visitproc visit, void *arg) {
   __pyx_mstate *traverse_module_state = __pyx_mstate(m);
@@ -2697,78 +2554,45 @@
   #ifdef __Pyx_CyFunction_USED
   Py_VISIT(traverse_module_state->__pyx_CyFunctionType);
   #endif
   #ifdef __Pyx_FusedFunction_USED
   Py_VISIT(traverse_module_state->__pyx_FusedFunctionType);
   #endif
   Py_VISIT(traverse_module_state->__pyx_ptype_7cpython_4type_type);
-  Py_VISIT(traverse_module_state->__pyx_n_s_GetScorerFlagsDistance);
-  Py_VISIT(traverse_module_state->__pyx_n_s_GetScorerFlagsNormalizedDistanc);
-  Py_VISIT(traverse_module_state->__pyx_n_s_GetScorerFlagsNormalizedSimilar);
-  Py_VISIT(traverse_module_state->__pyx_n_s_GetScorerFlagsSimilarity);
   Py_VISIT(traverse_module_state->__pyx_kp_u_Got_unexpected_keyword_arguments);
   Py_VISIT(traverse_module_state->__pyx_n_s_MemoryError);
+  Py_VISIT(traverse_module_state->__pyx_n_s_RF_Preprocess);
   Py_VISIT(traverse_module_state->__pyx_n_u_RF_Preprocess);
   Py_VISIT(traverse_module_state->__pyx_n_s_RF_Scorer);
   Py_VISIT(traverse_module_state->__pyx_n_s_RF_ScorerPy);
   Py_VISIT(traverse_module_state->__pyx_n_s_TypeError);
-  Py_VISIT(traverse_module_state->__pyx_n_s_ValueError);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__10);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__11);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__12);
-  Py_VISIT(traverse_module_state->__pyx_n_s__16);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__2);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__3);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__4);
+  Py_VISIT(traverse_module_state->__pyx_n_s__6);
   Py_VISIT(traverse_module_state->__pyx_n_s_array);
   Py_VISIT(traverse_module_state->__pyx_n_s_asyncio_coroutines);
-  Py_VISIT(traverse_module_state->__pyx_n_s_c_score_cutoff);
   Py_VISIT(traverse_module_state->__pyx_n_s_cline_in_traceback);
-  Py_VISIT(traverse_module_state->__pyx_n_s_distance);
-  Py_VISIT(traverse_module_state->__pyx_n_u_flags);
+  Py_VISIT(traverse_module_state->__pyx_n_s_default_process);
   Py_VISIT(traverse_module_state->__pyx_n_u_get_scorer_flags);
   Py_VISIT(traverse_module_state->__pyx_n_s_import);
   Py_VISIT(traverse_module_state->__pyx_n_s_is_coroutine);
   Py_VISIT(traverse_module_state->__pyx_n_s_keys);
-  Py_VISIT(traverse_module_state->__pyx_n_s_kwargs);
   Py_VISIT(traverse_module_state->__pyx_n_s_main);
   Py_VISIT(traverse_module_state->__pyx_n_s_name);
-  Py_VISIT(traverse_module_state->__pyx_n_s_normalized_distance);
-  Py_VISIT(traverse_module_state->__pyx_n_s_normalized_similarity);
-  Py_VISIT(traverse_module_state->__pyx_n_u_optimal_score);
-  Py_VISIT(traverse_module_state->__pyx_n_s_processor);
   Py_VISIT(traverse_module_state->__pyx_n_s_range);
-  Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_distance_Hamming_cpp);
-  Py_VISIT(traverse_module_state->__pyx_n_s_s1);
-  Py_VISIT(traverse_module_state->__pyx_n_s_s1_proc);
-  Py_VISIT(traverse_module_state->__pyx_n_s_s2);
-  Py_VISIT(traverse_module_state->__pyx_n_s_s2_proc);
-  Py_VISIT(traverse_module_state->__pyx_n_s_score_cutoff);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_score_cutoff_has_to_be_0);
+  Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_utils_cpp);
   Py_VISIT(traverse_module_state->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
-  Py_VISIT(traverse_module_state->__pyx_n_s_similarity);
-  Py_VISIT(traverse_module_state->__pyx_kp_s_src_rapidfuzz_distance_Hamming_c);
+  Py_VISIT(traverse_module_state->__pyx_n_s_sentence);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_src_rapidfuzz_utils_cpp_pyx);
   Py_VISIT(traverse_module_state->__pyx_n_s_test);
   Py_VISIT(traverse_module_state->__pyx_n_s_typecode);
-  Py_VISIT(traverse_module_state->__pyx_n_u_worst_score);
-  Py_VISIT(traverse_module_state->__pyx_int_0);
-  Py_VISIT(traverse_module_state->__pyx_int_1);
-  Py_VISIT(traverse_module_state->__pyx_int_32);
-  Py_VISIT(traverse_module_state->__pyx_int_64);
-  Py_VISIT(traverse_module_state->__pyx_int_9223372036854775807);
   Py_VISIT(traverse_module_state->__pyx_int_neg_1);
   Py_VISIT(traverse_module_state->__pyx_codeobj_);
-  Py_VISIT(traverse_module_state->__pyx_tuple__2);
-  Py_VISIT(traverse_module_state->__pyx_tuple__13);
-  Py_VISIT(traverse_module_state->__pyx_tuple__14);
-  Py_VISIT(traverse_module_state->__pyx_tuple__15);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__3);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__4);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__5);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__6);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__7);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__8);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__9);
+  Py_VISIT(traverse_module_state->__pyx_tuple__5);
   return 0;
 }
 #endif
 /* #### Code section: module_state_defines ### */
 #if CYTHON_USE_MODULE_STATE
 #define __pyx_d __pyx_mstate_global->__pyx_d
 #define __pyx_b __pyx_mstate_global->__pyx_b
@@ -2779,1869 +2603,399 @@
 #ifdef __Pyx_CyFunction_USED
 #define __pyx_CyFunctionType __pyx_mstate_global->__pyx_CyFunctionType
 #endif
 #ifdef __Pyx_FusedFunction_USED
 #define __pyx_FusedFunctionType __pyx_mstate_global->__pyx_FusedFunctionType
 #endif
 #define __pyx_ptype_7cpython_4type_type __pyx_mstate_global->__pyx_ptype_7cpython_4type_type
-#define __pyx_n_s_GetScorerFlagsDistance __pyx_mstate_global->__pyx_n_s_GetScorerFlagsDistance
-#define __pyx_n_s_GetScorerFlagsNormalizedDistanc __pyx_mstate_global->__pyx_n_s_GetScorerFlagsNormalizedDistanc
-#define __pyx_n_s_GetScorerFlagsNormalizedSimilar __pyx_mstate_global->__pyx_n_s_GetScorerFlagsNormalizedSimilar
-#define __pyx_n_s_GetScorerFlagsSimilarity __pyx_mstate_global->__pyx_n_s_GetScorerFlagsSimilarity
 #define __pyx_kp_u_Got_unexpected_keyword_arguments __pyx_mstate_global->__pyx_kp_u_Got_unexpected_keyword_arguments
 #define __pyx_n_s_MemoryError __pyx_mstate_global->__pyx_n_s_MemoryError
+#define __pyx_n_s_RF_Preprocess __pyx_mstate_global->__pyx_n_s_RF_Preprocess
 #define __pyx_n_u_RF_Preprocess __pyx_mstate_global->__pyx_n_u_RF_Preprocess
 #define __pyx_n_s_RF_Scorer __pyx_mstate_global->__pyx_n_s_RF_Scorer
 #define __pyx_n_s_RF_ScorerPy __pyx_mstate_global->__pyx_n_s_RF_ScorerPy
 #define __pyx_n_s_TypeError __pyx_mstate_global->__pyx_n_s_TypeError
-#define __pyx_n_s_ValueError __pyx_mstate_global->__pyx_n_s_ValueError
-#define __pyx_kp_u__10 __pyx_mstate_global->__pyx_kp_u__10
-#define __pyx_kp_u__11 __pyx_mstate_global->__pyx_kp_u__11
-#define __pyx_kp_u__12 __pyx_mstate_global->__pyx_kp_u__12
-#define __pyx_n_s__16 __pyx_mstate_global->__pyx_n_s__16
+#define __pyx_kp_u__2 __pyx_mstate_global->__pyx_kp_u__2
+#define __pyx_kp_u__3 __pyx_mstate_global->__pyx_kp_u__3
+#define __pyx_kp_u__4 __pyx_mstate_global->__pyx_kp_u__4
+#define __pyx_n_s__6 __pyx_mstate_global->__pyx_n_s__6
 #define __pyx_n_s_array __pyx_mstate_global->__pyx_n_s_array
 #define __pyx_n_s_asyncio_coroutines __pyx_mstate_global->__pyx_n_s_asyncio_coroutines
-#define __pyx_n_s_c_score_cutoff __pyx_mstate_global->__pyx_n_s_c_score_cutoff
 #define __pyx_n_s_cline_in_traceback __pyx_mstate_global->__pyx_n_s_cline_in_traceback
-#define __pyx_n_s_distance __pyx_mstate_global->__pyx_n_s_distance
-#define __pyx_n_u_flags __pyx_mstate_global->__pyx_n_u_flags
+#define __pyx_n_s_default_process __pyx_mstate_global->__pyx_n_s_default_process
 #define __pyx_n_u_get_scorer_flags __pyx_mstate_global->__pyx_n_u_get_scorer_flags
 #define __pyx_n_s_import __pyx_mstate_global->__pyx_n_s_import
 #define __pyx_n_s_is_coroutine __pyx_mstate_global->__pyx_n_s_is_coroutine
 #define __pyx_n_s_keys __pyx_mstate_global->__pyx_n_s_keys
-#define __pyx_n_s_kwargs __pyx_mstate_global->__pyx_n_s_kwargs
 #define __pyx_n_s_main __pyx_mstate_global->__pyx_n_s_main
 #define __pyx_n_s_name __pyx_mstate_global->__pyx_n_s_name
-#define __pyx_n_s_normalized_distance __pyx_mstate_global->__pyx_n_s_normalized_distance
-#define __pyx_n_s_normalized_similarity __pyx_mstate_global->__pyx_n_s_normalized_similarity
-#define __pyx_n_u_optimal_score __pyx_mstate_global->__pyx_n_u_optimal_score
-#define __pyx_n_s_processor __pyx_mstate_global->__pyx_n_s_processor
 #define __pyx_n_s_range __pyx_mstate_global->__pyx_n_s_range
-#define __pyx_n_s_rapidfuzz_distance_Hamming_cpp __pyx_mstate_global->__pyx_n_s_rapidfuzz_distance_Hamming_cpp
-#define __pyx_n_s_s1 __pyx_mstate_global->__pyx_n_s_s1
-#define __pyx_n_s_s1_proc __pyx_mstate_global->__pyx_n_s_s1_proc
-#define __pyx_n_s_s2 __pyx_mstate_global->__pyx_n_s_s2
-#define __pyx_n_s_s2_proc __pyx_mstate_global->__pyx_n_s_s2_proc
-#define __pyx_n_s_score_cutoff __pyx_mstate_global->__pyx_n_s_score_cutoff
-#define __pyx_kp_u_score_cutoff_has_to_be_0 __pyx_mstate_global->__pyx_kp_u_score_cutoff_has_to_be_0
+#define __pyx_n_s_rapidfuzz_utils_cpp __pyx_mstate_global->__pyx_n_s_rapidfuzz_utils_cpp
 #define __pyx_kp_u_score_cutoff_has_to_be_in_the_ra __pyx_mstate_global->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra
-#define __pyx_n_s_similarity __pyx_mstate_global->__pyx_n_s_similarity
-#define __pyx_kp_s_src_rapidfuzz_distance_Hamming_c __pyx_mstate_global->__pyx_kp_s_src_rapidfuzz_distance_Hamming_c
+#define __pyx_n_s_sentence __pyx_mstate_global->__pyx_n_s_sentence
+#define __pyx_kp_s_src_rapidfuzz_utils_cpp_pyx __pyx_mstate_global->__pyx_kp_s_src_rapidfuzz_utils_cpp_pyx
 #define __pyx_n_s_test __pyx_mstate_global->__pyx_n_s_test
 #define __pyx_n_s_typecode __pyx_mstate_global->__pyx_n_s_typecode
-#define __pyx_n_u_worst_score __pyx_mstate_global->__pyx_n_u_worst_score
-#define __pyx_int_0 __pyx_mstate_global->__pyx_int_0
-#define __pyx_int_1 __pyx_mstate_global->__pyx_int_1
-#define __pyx_int_32 __pyx_mstate_global->__pyx_int_32
-#define __pyx_int_64 __pyx_mstate_global->__pyx_int_64
-#define __pyx_int_9223372036854775807 __pyx_mstate_global->__pyx_int_9223372036854775807
 #define __pyx_int_neg_1 __pyx_mstate_global->__pyx_int_neg_1
 #define __pyx_codeobj_ __pyx_mstate_global->__pyx_codeobj_
-#define __pyx_tuple__2 __pyx_mstate_global->__pyx_tuple__2
-#define __pyx_tuple__13 __pyx_mstate_global->__pyx_tuple__13
-#define __pyx_tuple__14 __pyx_mstate_global->__pyx_tuple__14
-#define __pyx_tuple__15 __pyx_mstate_global->__pyx_tuple__15
-#define __pyx_codeobj__3 __pyx_mstate_global->__pyx_codeobj__3
-#define __pyx_codeobj__4 __pyx_mstate_global->__pyx_codeobj__4
-#define __pyx_codeobj__5 __pyx_mstate_global->__pyx_codeobj__5
-#define __pyx_codeobj__6 __pyx_mstate_global->__pyx_codeobj__6
-#define __pyx_codeobj__7 __pyx_mstate_global->__pyx_codeobj__7
-#define __pyx_codeobj__8 __pyx_mstate_global->__pyx_codeobj__8
-#define __pyx_codeobj__9 __pyx_mstate_global->__pyx_codeobj__9
+#define __pyx_tuple__5 __pyx_mstate_global->__pyx_tuple__5
 #endif
 /* #### Code section: module_code ### */
 
-/* "rapidfuzz/distance/Hamming_cpp.pyx":29
- *     bool HammingNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
+/* "rapidfuzz/utils_cpp.pyx":19
+ *     RF_String default_process_func(RF_String sentence) except +
  * 
- * def distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Hamming distance between two strings.
+ * def default_process(sentence):             # <<<<<<<<<<<<<<
+ *     validate_string(sentence, "sentence must be a String")
+ *     return default_process_impl(sentence)
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_1distance(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_9utils_cpp_1default_process(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8distance_11Hamming_cpp_distance, "\n    Calculates the Hamming distance between two strings.\n    The hamming distance is defined as the number of positions\n    where the two strings differ. It describes the minimum\n    amount of substitutions required to transform s1 into s2.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : int or None, optional\n        Maximum distance between s1 and s2, that is\n        considered as a result. If the distance is bigger than score_cutoff,\n        score_cutoff + 1 is returned instead. Default is None, which deactivates\n        this behaviour.\n\n    Returns\n    -------\n    distance : int\n        distance between s1 and s2\n\n    Raises\n    ------\n    ValueError\n        If s1 and s2 have a different length\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_1distance = {"distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_1distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8distance_11Hamming_cpp_distance};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_1distance(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_9utils_cpp_1default_process = {"default_process", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_9utils_cpp_1default_process, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_9utils_cpp_1default_process(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
-  PyObject *__pyx_v_s1 = 0;
-  PyObject *__pyx_v_s2 = 0;
-  PyObject *__pyx_v_processor = 0;
-  PyObject *__pyx_v_score_cutoff = 0;
+  PyObject *__pyx_v_sentence = 0;
   #if !CYTHON_METH_FASTCALL
   CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("distance (wrapper)", 0);
+  __Pyx_RefNannySetupContext("default_process (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
-    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_sentence,0};
     #else
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_sentence,0};
     #endif
-    PyObject* values[4] = {0,0,0,0};
-    values[2] = ((PyObject *)((PyObject *)Py_None));
-    values[3] = ((PyObject *)((PyObject *)Py_None));
+    PyObject* values[1] = {0};
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
-        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 29, __pyx_L3_error)
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sentence)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 19, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
-        CYTHON_FALLTHROUGH;
-        case  1:
-        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 29, __pyx_L3_error)
-        else {
-          __Pyx_RaiseArgtupleInvalid("distance", 1, 2, 2, 1); __PYX_ERR(0, 29, __pyx_L3_error)
-        }
-      }
-      if (kw_args > 0 && likely(kw_args <= 2)) {
-        Py_ssize_t index;
-        for (index = 2; index < 4 && kw_args > 0; index++) {
-          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
-          if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 29, __pyx_L3_error)
-        }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "distance") < 0)) __PYX_ERR(0, 29, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "default_process") < 0)) __PYX_ERR(0, 19, __pyx_L3_error)
       }
-    } else if (unlikely(__pyx_nargs != 2)) {
+    } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
-      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
-    __pyx_v_s1 = values[0];
-    __pyx_v_s2 = values[1];
-    __pyx_v_processor = values[2];
-    __pyx_v_score_cutoff = values[3];
+    __pyx_v_sentence = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 29, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("default_process", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 19, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.utils_cpp.default_process", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_9utils_cpp_default_process(__pyx_self, __pyx_v_sentence);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  int64_t __pyx_v_c_score_cutoff;
-  RF_StringWrapper __pyx_v_s1_proc;
-  RF_StringWrapper __pyx_v_s2_proc;
+static PyObject *__pyx_pf_9rapidfuzz_9utils_cpp_default_process(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_sentence) {
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  int64_t __pyx_t_1;
-  int __pyx_t_2;
-  int64_t __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
+  PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_TraceFrameInit(__pyx_codeobj_)
-  __Pyx_RefNannySetupContext("distance", 0);
-  __Pyx_TraceCall("distance", __pyx_f[0], 29, 0, __PYX_ERR(0, 29, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":61
- *         If s1 and s2 have a different length
- *     """
- *     cdef int64_t c_score_cutoff = INT64_MAX if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
- *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
- */
-  __Pyx_TraceLine(61,0,__PYX_ERR(0, 61, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = INT64_MAX;
-  } else {
-    __pyx_t_3 = __Pyx_PyInt_As_int64_t(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 61, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
-  }
-  __pyx_v_c_score_cutoff = __pyx_t_1;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":64
- *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- */
-  __Pyx_TraceLine(64,0,__PYX_ERR(0, 64, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_c_score_cutoff < 0);
-  if (unlikely(__pyx_t_2)) {
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":65
- * 
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
- * 
- *     if s1 is None or s2 is None:
- */
-    __Pyx_TraceLine(65,0,__PYX_ERR(0, 65, __pyx_L1_error))
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 65, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 65, __pyx_L1_error)
+  __Pyx_RefNannySetupContext("default_process", 0);
+  __Pyx_TraceCall("default_process", __pyx_f[0], 19, 0, __PYX_ERR(0, 19, __pyx_L1_error));
 
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":64
- *     cdef RF_StringWrapper s1_proc, s2_proc
+  /* "rapidfuzz/utils_cpp.pyx":20
  * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
+ * def default_process(sentence):
+ *     validate_string(sentence, "sentence must be a String")             # <<<<<<<<<<<<<<
+ *     return default_process_impl(sentence)
  * 
  */
-  }
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":67
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
- * 
- */
-  __Pyx_TraceLine(67,0,__PYX_ERR(0, 67, __pyx_L1_error))
-  __pyx_t_5 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_5) {
-  } else {
-    __pyx_t_2 = __pyx_t_5;
-    goto __pyx_L5_bool_binop_done;
-  }
-  __pyx_t_5 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_5;
-  __pyx_L5_bool_binop_done:;
-  if (__pyx_t_2) {
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":68
- * 
- *     if s1 is None or s2 is None:
- *         return 0             # <<<<<<<<<<<<<<
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- */
-    __Pyx_TraceLine(68,0,__PYX_ERR(0, 68, __pyx_L1_error))
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_int_0);
-    __pyx_r = __pyx_int_0;
-    goto __pyx_L0;
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":67
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
- * 
- */
-  }
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":70
- *         return 0
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
- *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
- */
-  __Pyx_TraceLine(70,0,__PYX_ERR(0, 70, __pyx_L1_error))
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 70, __pyx_L1_error)
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":71
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
- * 
- * def similarity(s1, s2, *, processor=None, score_cutoff=None):
- */
-  __Pyx_TraceLine(71,0,__PYX_ERR(0, 71, __pyx_L1_error))
-  __Pyx_XDECREF(__pyx_r);
+  __Pyx_TraceLine(20,0,__PYX_ERR(0, 20, __pyx_L1_error))
   try {
-    __pyx_t_1 = hamming_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    validate_string(__pyx_v_sentence, ((char const *)"sentence must be a String"));
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 71, __pyx_L1_error)
-  }
-  __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 71, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_r = __pyx_t_4;
-  __pyx_t_4 = 0;
-  goto __pyx_L0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":29
- *     bool HammingNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
- * 
- * def distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Hamming distance between two strings.
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_TraceReturn(__pyx_r, 0);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "rapidfuzz/distance/Hamming_cpp.pyx":73
- *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
- * def similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Hamming similarity between two strings.
- */
-
-/* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_3similarity(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8distance_11Hamming_cpp_2similarity, "\n    Calculates the Hamming similarity between two strings.\n    \n    This is calculated as ``len1 - distance``.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : int, optional\n        Maximum distance between s1 and s2, that is\n        considered as a result. If the similarity is smaller than score_cutoff,\n        0 is returned instead. Default is None, which deactivates\n        this behaviour.\n\n    Returns\n    -------\n    distance : int\n        distance between s1 and s2\n\n    Raises\n    ------\n    ValueError\n        If s1 and s2 have a different length\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_3similarity = {"similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_3similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8distance_11Hamming_cpp_2similarity};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_3similarity(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-) {
-  PyObject *__pyx_v_s1 = 0;
-  PyObject *__pyx_v_s2 = 0;
-  PyObject *__pyx_v_processor = 0;
-  PyObject *__pyx_v_score_cutoff = 0;
-  #if !CYTHON_METH_FASTCALL
-  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
-  #endif
-  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("similarity (wrapper)", 0);
-  {
-    #if CYTHON_USE_MODULE_STATE
-    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
-    #else
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
-    #endif
-    PyObject* values[4] = {0,0,0,0};
-    values[2] = ((PyObject *)((PyObject *)Py_None));
-    values[3] = ((PyObject *)((PyObject *)Py_None));
-    if (__pyx_kwds) {
-      Py_ssize_t kw_args;
-      switch (__pyx_nargs) {
-        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
-        CYTHON_FALLTHROUGH;
-        case  0: break;
-        default: goto __pyx_L5_argtuple_error;
-      }
-      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
-      switch (__pyx_nargs) {
-        case  0:
-        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L3_error)
-        else goto __pyx_L5_argtuple_error;
-        CYTHON_FALLTHROUGH;
-        case  1:
-        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L3_error)
-        else {
-          __Pyx_RaiseArgtupleInvalid("similarity", 1, 2, 2, 1); __PYX_ERR(0, 73, __pyx_L3_error)
-        }
-      }
-      if (kw_args > 0 && likely(kw_args <= 2)) {
-        Py_ssize_t index;
-        for (index = 2; index < 4 && kw_args > 0; index++) {
-          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
-          if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 73, __pyx_L3_error)
-        }
-      }
-      if (unlikely(kw_args > 0)) {
-        const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "similarity") < 0)) __PYX_ERR(0, 73, __pyx_L3_error)
-      }
-    } else if (unlikely(__pyx_nargs != 2)) {
-      goto __pyx_L5_argtuple_error;
-    } else {
-      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
-      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
-    }
-    __pyx_v_s1 = values[0];
-    __pyx_v_s2 = values[1];
-    __pyx_v_processor = values[2];
-    __pyx_v_score_cutoff = values[3];
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 73, __pyx_L3_error)
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __Pyx_RefNannyFinishContext();
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_2similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
-
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_2similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  int64_t __pyx_v_c_score_cutoff;
-  RF_StringWrapper __pyx_v_s1_proc;
-  RF_StringWrapper __pyx_v_s2_proc;
-  PyObject *__pyx_r = NULL;
-  __Pyx_TraceDeclarations
-  __Pyx_RefNannyDeclarations
-  int64_t __pyx_t_1;
-  int __pyx_t_2;
-  int64_t __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__3)
-  __Pyx_RefNannySetupContext("similarity", 0);
-  __Pyx_TraceCall("similarity", __pyx_f[0], 73, 0, __PYX_ERR(0, 73, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":104
- *         If s1 and s2 have a different length
- *     """
- *     cdef int64_t c_score_cutoff = 0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
- *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
- */
-  __Pyx_TraceLine(104,0,__PYX_ERR(0, 104, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0;
-  } else {
-    __pyx_t_3 = __Pyx_PyInt_As_int64_t(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 104, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
-  }
-  __pyx_v_c_score_cutoff = __pyx_t_1;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":107
- *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- */
-  __Pyx_TraceLine(107,0,__PYX_ERR(0, 107, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_c_score_cutoff < 0);
-  if (unlikely(__pyx_t_2)) {
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":108
- * 
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
- * 
- *     if s1 is None or s2 is None:
- */
-    __Pyx_TraceLine(108,0,__PYX_ERR(0, 108, __pyx_L1_error))
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 108, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 108, __pyx_L1_error)
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":107
- *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- */
-  }
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":110
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
- * 
- */
-  __Pyx_TraceLine(110,0,__PYX_ERR(0, 110, __pyx_L1_error))
-  __pyx_t_5 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_5) {
-  } else {
-    __pyx_t_2 = __pyx_t_5;
-    goto __pyx_L5_bool_binop_done;
+    __PYX_ERR(0, 20, __pyx_L1_error)
   }
-  __pyx_t_5 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_5;
-  __pyx_L5_bool_binop_done:;
-  if (__pyx_t_2) {
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":111
- * 
- *     if s1 is None or s2 is None:
- *         return 0             # <<<<<<<<<<<<<<
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- */
-    __Pyx_TraceLine(111,0,__PYX_ERR(0, 111, __pyx_L1_error))
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_int_0);
-    __pyx_r = __pyx_int_0;
-    goto __pyx_L0;
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":110
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
- * 
- */
-  }
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":113
- *         return 0
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
- *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
- */
-  __Pyx_TraceLine(113,0,__PYX_ERR(0, 113, __pyx_L1_error))
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 113, __pyx_L1_error)
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":114
+  /* "rapidfuzz/utils_cpp.pyx":21
+ * def default_process(sentence):
+ *     validate_string(sentence, "sentence must be a String")
+ *     return default_process_impl(sentence)             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
- * def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
  */
-  __Pyx_TraceLine(114,0,__PYX_ERR(0, 114, __pyx_L1_error))
+  __Pyx_TraceLine(21,0,__PYX_ERR(0, 21, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = hamming_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_1 = default_process_impl(__pyx_v_sentence);
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 21, __pyx_L1_error)
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 114, __pyx_L1_error)
+    __PYX_ERR(0, 21, __pyx_L1_error)
   }
-  __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 114, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_r = __pyx_t_4;
-  __pyx_t_4 = 0;
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":73
- *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+  /* "rapidfuzz/utils_cpp.pyx":19
+ *     RF_String default_process_func(RF_String sentence) except +
  * 
- * def similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Hamming similarity between two strings.
+ * def default_process(sentence):             # <<<<<<<<<<<<<<
+ *     validate_string(sentence, "sentence must be a String")
+ *     return default_process_impl(sentence)
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("rapidfuzz.utils_cpp.default_process", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/distance/Hamming_cpp.pyx":116
- *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+/* "rapidfuzz/utils_cpp.pyx":24
  * 
- * def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized levenshtein similarity in the range [1, 0].
+ * 
+ * cdef bool default_process_capi(sentence, RF_String* str_) except False:             # <<<<<<<<<<<<<<
+ *     proc_str = conv_sequence(sentence)
+ *     try:
  */
 
-/* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_5normalized_distance(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8distance_11Hamming_cpp_4normalized_distance, "\n    Calculates a normalized levenshtein similarity in the range [1, 0].\n\n    This is calculated as ``distance / (len1 + len2)``.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 1.0.\n        For norm_dist > score_cutoff 1.0 is returned instead. Default is 1.0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    norm_dist : float\n        normalized distance between s1 and s2 as a float between 0 and 1.0\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_5normalized_distance = {"normalized_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_5normalized_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8distance_11Hamming_cpp_4normalized_distance};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_5normalized_distance(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-) {
-  PyObject *__pyx_v_s1 = 0;
-  PyObject *__pyx_v_s2 = 0;
-  PyObject *__pyx_v_processor = 0;
-  PyObject *__pyx_v_score_cutoff = 0;
-  #if !CYTHON_METH_FASTCALL
-  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
-  #endif
-  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("normalized_distance (wrapper)", 0);
-  {
-    #if CYTHON_USE_MODULE_STATE
-    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
-    #else
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
-    #endif
-    PyObject* values[4] = {0,0,0,0};
-    values[2] = ((PyObject *)((PyObject *)Py_None));
-    values[3] = ((PyObject *)((PyObject *)Py_None));
-    if (__pyx_kwds) {
-      Py_ssize_t kw_args;
-      switch (__pyx_nargs) {
-        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
-        CYTHON_FALLTHROUGH;
-        case  0: break;
-        default: goto __pyx_L5_argtuple_error;
-      }
-      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
-      switch (__pyx_nargs) {
-        case  0:
-        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 116, __pyx_L3_error)
-        else goto __pyx_L5_argtuple_error;
-        CYTHON_FALLTHROUGH;
-        case  1:
-        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 116, __pyx_L3_error)
-        else {
-          __Pyx_RaiseArgtupleInvalid("normalized_distance", 1, 2, 2, 1); __PYX_ERR(0, 116, __pyx_L3_error)
-        }
-      }
-      if (kw_args > 0 && likely(kw_args <= 2)) {
-        Py_ssize_t index;
-        for (index = 2; index < 4 && kw_args > 0; index++) {
-          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
-          if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 116, __pyx_L3_error)
-        }
-      }
-      if (unlikely(kw_args > 0)) {
-        const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "normalized_distance") < 0)) __PYX_ERR(0, 116, __pyx_L3_error)
-      }
-    } else if (unlikely(__pyx_nargs != 2)) {
-      goto __pyx_L5_argtuple_error;
-    } else {
-      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
-      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
-    }
-    __pyx_v_s1 = values[0];
-    __pyx_v_s2 = values[1];
-    __pyx_v_processor = values[2];
-    __pyx_v_score_cutoff = values[3];
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("normalized_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 116, __pyx_L3_error)
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __Pyx_RefNannyFinishContext();
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_4normalized_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
-
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_4normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  RF_StringWrapper __pyx_v_s1_proc;
-  RF_StringWrapper __pyx_v_s2_proc;
-  double __pyx_v_c_score_cutoff;
-  PyObject *__pyx_r = NULL;
+static bool __pyx_f_9rapidfuzz_9utils_cpp_default_process_capi(PyObject *__pyx_v_sentence, RF_String *__pyx_v_str_) {
+  RF_String __pyx_v_proc_str;
+  bool __pyx_r;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  int __pyx_t_2;
-  double __pyx_t_3;
-  double __pyx_t_4;
+  RF_String __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  int __pyx_t_8;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__4)
-  __Pyx_RefNannySetupContext("normalized_distance", 0);
-  __Pyx_TraceCall("normalized_distance", __pyx_f[0], 116, 0, __PYX_ERR(0, 116, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":142
- *     """
- *     cdef RF_StringWrapper s1_proc, s2_proc
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
- * 
- */
-  __Pyx_TraceLine(142,0,__PYX_ERR(0, 142, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_2) {
-  } else {
-    __pyx_t_1 = __pyx_t_2;
-    goto __pyx_L4_bool_binop_done;
-  }
-  __pyx_t_2 = (__pyx_v_s2 == Py_None);
-  __pyx_t_1 = __pyx_t_2;
-  __pyx_L4_bool_binop_done:;
-  if (__pyx_t_1) {
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":143
- *     cdef RF_StringWrapper s1_proc, s2_proc
- *     if s1 is None or s2 is None:
- *         return 0             # <<<<<<<<<<<<<<
- * 
- *     cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff
- */
-    __Pyx_TraceLine(143,0,__PYX_ERR(0, 143, __pyx_L1_error))
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_int_0);
-    __pyx_r = __pyx_int_0;
-    goto __pyx_L0;
+  __Pyx_RefNannySetupContext("default_process_capi", 0);
+  __Pyx_TraceCall("default_process_capi", __pyx_f[0], 24, 0, __PYX_ERR(0, 24, __pyx_L1_error));
 
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":142
- *     """
- *     cdef RF_StringWrapper s1_proc, s2_proc
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
+  /* "rapidfuzz/utils_cpp.pyx":25
  * 
+ * cdef bool default_process_capi(sentence, RF_String* str_) except False:
+ *     proc_str = conv_sequence(sentence)             # <<<<<<<<<<<<<<
+ *     try:
+ *         proc_str = default_process_func(proc_str)
  */
-  }
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":145
- *         return 0
- * 
- *     cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
- * 
- *     if c_score_cutoff < 0:
- */
-  __Pyx_TraceLine(145,0,__PYX_ERR(0, 145, __pyx_L1_error))
-  __pyx_t_1 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_1) {
-    __pyx_t_3 = 1.0;
-  } else {
-    __pyx_t_4 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_4 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 145, __pyx_L1_error)
-    __pyx_t_3 = __pyx_t_4;
-  }
-  __pyx_v_c_score_cutoff = __pyx_t_3;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":147
- *     cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff
- * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- */
-  __Pyx_TraceLine(147,0,__PYX_ERR(0, 147, __pyx_L1_error))
-  __pyx_t_1 = (__pyx_v_c_score_cutoff < 0.0);
-  if (unlikely(__pyx_t_1)) {
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":148
- * 
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- */
-    __Pyx_TraceLine(148,0,__PYX_ERR(0, 148, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 148, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __PYX_ERR(0, 148, __pyx_L1_error)
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":147
- *     cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff
- * 
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- */
-  }
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":150
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
- *     return hamming_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
- */
-  __Pyx_TraceLine(150,0,__PYX_ERR(0, 150, __pyx_L1_error))
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 150, __pyx_L1_error)
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":151
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- *     return hamming_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __Pyx_TraceLine(151,0,__PYX_ERR(0, 151, __pyx_L1_error))
-  __Pyx_XDECREF(__pyx_r);
-  try {
-    __pyx_t_3 = hamming_normalized_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
-  } catch(...) {
-    __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 151, __pyx_L1_error)
-  }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 151, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
-  goto __pyx_L0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":116
- *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
- * def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized levenshtein similarity in the range [1, 0].
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_TraceReturn(__pyx_r, 0);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "rapidfuzz/distance/Hamming_cpp.pyx":154
- * 
- * 
- * def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized hamming similarity in the range [0, 1].
+  __Pyx_TraceLine(25,0,__PYX_ERR(0, 25, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_sentence); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_v_proc_str = __pyx_t_1;
+
+  /* "rapidfuzz/utils_cpp.pyx":26
+ * cdef bool default_process_capi(sentence, RF_String* str_) except False:
+ *     proc_str = conv_sequence(sentence)
+ *     try:             # <<<<<<<<<<<<<<
+ *         proc_str = default_process_func(proc_str)
+ *     except:
  */
-
-/* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_7normalized_similarity(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8distance_11Hamming_cpp_6normalized_similarity, "\n    Calculates a normalized hamming similarity in the range [0, 1].\n\n    This is calculated as ``1 - normalized_distance``\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 1.0.\n        For norm_sim < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    norm_sim : float\n        normalized similarity between s1 and s2 as a float between 0 and 1.0\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_7normalized_similarity = {"normalized_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_7normalized_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8distance_11Hamming_cpp_6normalized_similarity};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_7normalized_similarity(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-) {
-  PyObject *__pyx_v_s1 = 0;
-  PyObject *__pyx_v_s2 = 0;
-  PyObject *__pyx_v_processor = 0;
-  PyObject *__pyx_v_score_cutoff = 0;
-  #if !CYTHON_METH_FASTCALL
-  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
-  #endif
-  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("normalized_similarity (wrapper)", 0);
+  __Pyx_TraceLine(26,0,__PYX_ERR(0, 26, __pyx_L1_error))
   {
-    #if CYTHON_USE_MODULE_STATE
-    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
-    #else
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
-    #endif
-    PyObject* values[4] = {0,0,0,0};
-    values[2] = ((PyObject *)((PyObject *)Py_None));
-    values[3] = ((PyObject *)((PyObject *)Py_None));
-    if (__pyx_kwds) {
-      Py_ssize_t kw_args;
-      switch (__pyx_nargs) {
-        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
-        CYTHON_FALLTHROUGH;
-        case  0: break;
-        default: goto __pyx_L5_argtuple_error;
-      }
-      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
-      switch (__pyx_nargs) {
-        case  0:
-        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L3_error)
-        else goto __pyx_L5_argtuple_error;
-        CYTHON_FALLTHROUGH;
-        case  1:
-        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L3_error)
-        else {
-          __Pyx_RaiseArgtupleInvalid("normalized_similarity", 1, 2, 2, 1); __PYX_ERR(0, 154, __pyx_L3_error)
-        }
-      }
-      if (kw_args > 0 && likely(kw_args <= 2)) {
-        Py_ssize_t index;
-        for (index = 2; index < 4 && kw_args > 0; index++) {
-          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
-          if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L3_error)
-        }
-      }
-      if (unlikely(kw_args > 0)) {
-        const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "normalized_similarity") < 0)) __PYX_ERR(0, 154, __pyx_L3_error)
-      }
-    } else if (unlikely(__pyx_nargs != 2)) {
-      goto __pyx_L5_argtuple_error;
-    } else {
-      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
-      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
-    }
-    __pyx_v_s1 = values[0];
-    __pyx_v_s2 = values[1];
-    __pyx_v_processor = values[2];
-    __pyx_v_score_cutoff = values[3];
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("normalized_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 154, __pyx_L3_error)
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __Pyx_RefNannyFinishContext();
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_6normalized_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
-
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_6normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  RF_StringWrapper __pyx_v_s1_proc;
-  RF_StringWrapper __pyx_v_s2_proc;
-  double __pyx_v_c_score_cutoff;
-  PyObject *__pyx_r = NULL;
-  __Pyx_TraceDeclarations
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  int __pyx_t_2;
-  double __pyx_t_3;
-  double __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__5)
-  __Pyx_RefNannySetupContext("normalized_similarity", 0);
-  __Pyx_TraceCall("normalized_similarity", __pyx_f[0], 154, 0, __PYX_ERR(0, 154, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":180
- *     """
- *     cdef RF_StringWrapper s1_proc, s2_proc
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
- * 
- */
-  __Pyx_TraceLine(180,0,__PYX_ERR(0, 180, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_2) {
-  } else {
-    __pyx_t_1 = __pyx_t_2;
-    goto __pyx_L4_bool_binop_done;
-  }
-  __pyx_t_2 = (__pyx_v_s2 == Py_None);
-  __pyx_t_1 = __pyx_t_2;
-  __pyx_L4_bool_binop_done:;
-  if (__pyx_t_1) {
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":181
- *     cdef RF_StringWrapper s1_proc, s2_proc
- *     if s1 is None or s2 is None:
- *         return 0             # <<<<<<<<<<<<<<
- * 
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
- */
-    __Pyx_TraceLine(181,0,__PYX_ERR(0, 181, __pyx_L1_error))
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_int_0);
-    __pyx_r = __pyx_int_0;
-    goto __pyx_L0;
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    __Pyx_ExceptionSave(&__pyx_t_2, &__pyx_t_3, &__pyx_t_4);
+    __Pyx_XGOTREF(__pyx_t_2);
+    __Pyx_XGOTREF(__pyx_t_3);
+    __Pyx_XGOTREF(__pyx_t_4);
+    /*try:*/ {
 
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":180
- *     """
- *     cdef RF_StringWrapper s1_proc, s2_proc
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
- * 
- */
-  }
+      /* "rapidfuzz/utils_cpp.pyx":27
+ *     proc_str = conv_sequence(sentence)
+ *     try:
+ *         proc_str = default_process_func(proc_str)             # <<<<<<<<<<<<<<
+ *     except:
+ *         if proc_str.dtor:
+ */
+      __Pyx_TraceLine(27,0,__PYX_ERR(0, 27, __pyx_L3_error))
+      try {
+        __pyx_t_1 = default_process_func(__pyx_v_proc_str);
+      } catch(...) {
+        __Pyx_CppExn2PyErr();
+        __PYX_ERR(0, 27, __pyx_L3_error)
+      }
+      __pyx_v_proc_str = __pyx_t_1;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":183
- *         return 0
- * 
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")
+      /* "rapidfuzz/utils_cpp.pyx":26
+ * cdef bool default_process_capi(sentence, RF_String* str_) except False:
+ *     proc_str = conv_sequence(sentence)
+ *     try:             # <<<<<<<<<<<<<<
+ *         proc_str = default_process_func(proc_str)
+ *     except:
  */
-  __Pyx_TraceLine(183,0,__PYX_ERR(0, 183, __pyx_L1_error))
-  __pyx_t_1 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_1) {
-    __pyx_t_3 = 0.0;
-  } else {
-    __pyx_t_4 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_4 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 183, __pyx_L1_error)
-    __pyx_t_3 = __pyx_t_4;
-  }
-  __pyx_v_c_score_cutoff = __pyx_t_3;
+    }
+    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    goto __pyx_L8_try_end;
+    __pyx_L3_error:;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":184
- * 
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
+    /* "rapidfuzz/utils_cpp.pyx":28
+ *     try:
+ *         proc_str = default_process_func(proc_str)
+ *     except:             # <<<<<<<<<<<<<<
+ *         if proc_str.dtor:
+ *             proc_str.dtor(&proc_str)
+ */
+    __Pyx_TraceLine(28,0,__PYX_ERR(0, 28, __pyx_L5_except_error))
+    /*except:*/ {
+      __Pyx_AddTraceback("rapidfuzz.utils_cpp.default_process_capi", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(0, 28, __pyx_L5_except_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __Pyx_GOTREF(__pyx_t_6);
+      __Pyx_GOTREF(__pyx_t_7);
+
+      /* "rapidfuzz/utils_cpp.pyx":29
+ *         proc_str = default_process_func(proc_str)
+ *     except:
+ *         if proc_str.dtor:             # <<<<<<<<<<<<<<
+ *             proc_str.dtor(&proc_str)
+ *         raise
  */
-  __Pyx_TraceLine(184,0,__PYX_ERR(0, 184, __pyx_L1_error))
-  __pyx_t_1 = (__pyx_v_c_score_cutoff < 0.0);
-  if (unlikely(__pyx_t_1)) {
-
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":185
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
+      __Pyx_TraceLine(29,0,__PYX_ERR(0, 29, __pyx_L5_except_error))
+      __pyx_t_8 = (__pyx_v_proc_str.dtor != 0);
+      if (__pyx_t_8) {
+
+        /* "rapidfuzz/utils_cpp.pyx":30
+ *     except:
+ *         if proc_str.dtor:
+ *             proc_str.dtor(&proc_str)             # <<<<<<<<<<<<<<
+ *         raise
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
  */
-    __Pyx_TraceLine(185,0,__PYX_ERR(0, 185, __pyx_L1_error))
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 185, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __PYX_ERR(0, 185, __pyx_L1_error)
+        __Pyx_TraceLine(30,0,__PYX_ERR(0, 30, __pyx_L5_except_error))
+        __pyx_v_proc_str.dtor((&__pyx_v_proc_str));
 
-    /* "rapidfuzz/distance/Hamming_cpp.pyx":184
- * 
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
- *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
+        /* "rapidfuzz/utils_cpp.pyx":29
+ *         proc_str = default_process_func(proc_str)
+ *     except:
+ *         if proc_str.dtor:             # <<<<<<<<<<<<<<
+ *             proc_str.dtor(&proc_str)
+ *         raise
  */
-  }
+      }
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":187
- *         raise ValueError("score_cutoff has to be >= 0")
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
- *     return hamming_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+      /* "rapidfuzz/utils_cpp.pyx":31
+ *         if proc_str.dtor:
+ *             proc_str.dtor(&proc_str)
+ *         raise             # <<<<<<<<<<<<<<
  * 
+ *     str_[0] = proc_str
  */
-  __Pyx_TraceLine(187,0,__PYX_ERR(0, 187, __pyx_L1_error))
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 187, __pyx_L1_error)
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":188
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
- *     return hamming_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
- * 
- * 
+      __Pyx_TraceLine(31,0,__PYX_ERR(0, 31, __pyx_L5_except_error))
+      __Pyx_GIVEREF(__pyx_t_5);
+      __Pyx_GIVEREF(__pyx_t_6);
+      __Pyx_XGIVEREF(__pyx_t_7);
+      __Pyx_ErrRestoreWithState(__pyx_t_5, __pyx_t_6, __pyx_t_7);
+      __pyx_t_5 = 0; __pyx_t_6 = 0; __pyx_t_7 = 0; 
+      __PYX_ERR(0, 31, __pyx_L5_except_error)
+    }
+    __pyx_L5_except_error:;
+
+    /* "rapidfuzz/utils_cpp.pyx":26
+ * cdef bool default_process_capi(sentence, RF_String* str_) except False:
+ *     proc_str = conv_sequence(sentence)
+ *     try:             # <<<<<<<<<<<<<<
+ *         proc_str = default_process_func(proc_str)
+ *     except:
  */
-  __Pyx_TraceLine(188,0,__PYX_ERR(0, 188, __pyx_L1_error))
-  __Pyx_XDECREF(__pyx_r);
-  try {
-    __pyx_t_3 = hamming_normalized_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
-  } catch(...) {
-    __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 188, __pyx_L1_error)
+    __Pyx_XGIVEREF(__pyx_t_2);
+    __Pyx_XGIVEREF(__pyx_t_3);
+    __Pyx_XGIVEREF(__pyx_t_4);
+    __Pyx_ExceptionReset(__pyx_t_2, __pyx_t_3, __pyx_t_4);
+    goto __pyx_L1_error;
+    __pyx_L8_try_end:;
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 188, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
-  goto __pyx_L0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":154
- * 
- * 
- * def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized hamming similarity in the range [0, 1].
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_TraceReturn(__pyx_r, 0);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
 
-/* "rapidfuzz/distance/Hamming_cpp.pyx":191
- * 
- * 
- * cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = 0
- */
-
-static bool __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
-  bool __pyx_r;
-  __Pyx_TraceDeclarations
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  #ifdef WITH_THREAD
-  PyGILState_STATE __pyx_gilstate_save;
-  #endif
-  __Pyx_TraceCall("GetScorerFlagsHammingDistance", __pyx_f[0], 191, 1, __PYX_ERR(0, 191, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":192
- * 
- * cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).optimal_score.i64 = 0
- *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
- */
-  __Pyx_TraceLine(192,1,__PYX_ERR(0, 192, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":193
- * cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = 0             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
- *     return True
- */
-  __Pyx_TraceLine(193,1,__PYX_ERR(0, 193, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).optimal_score.i64 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":194
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = 0
- *     dereference(scorer_flags).worst_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
- *     return True
- * 
- */
-  __Pyx_TraceLine(194,1,__PYX_ERR(0, 194, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).worst_score.i64 = INT64_MAX;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":195
- *     dereference(scorer_flags).optimal_score.i64 = 0
- *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
- *     return True             # <<<<<<<<<<<<<<
- * 
- * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- */
-  __Pyx_TraceLine(195,1,__PYX_ERR(0, 195, __pyx_L1_error))
-  __pyx_r = 1;
-  goto __pyx_L0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":191
- * 
+  /* "rapidfuzz/utils_cpp.pyx":33
+ *         raise
  * 
- * cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = 0
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  #ifdef WITH_THREAD
-  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-  #endif
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.GetScorerFlagsHammingDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  #ifdef WITH_THREAD
-  __Pyx_PyGILState_Release(__pyx_gilstate_save);
-  #endif
-  __pyx_L0:;
-  __Pyx_TraceReturn(Py_None, 1);
-  return __pyx_r;
-}
-
-/* "rapidfuzz/distance/Hamming_cpp.pyx":197
+ *     str_[0] = proc_str             # <<<<<<<<<<<<<<
  *     return True
  * 
- * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
- */
-
-static bool __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingNormalizedDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
-  bool __pyx_r;
-  __Pyx_TraceDeclarations
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  #ifdef WITH_THREAD
-  PyGILState_STATE __pyx_gilstate_save;
-  #endif
-  __Pyx_TraceCall("GetScorerFlagsHammingNormalizedDistance", __pyx_f[0], 197, 1, __PYX_ERR(0, 197, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":198
- * 
- * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
- *     dereference(scorer_flags).worst_score.f64 = 1.0
- */
-  __Pyx_TraceLine(198,1,__PYX_ERR(0, 198, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":199
- * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 0.0             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).worst_score.f64 = 1.0
- *     return True
  */
-  __Pyx_TraceLine(199,1,__PYX_ERR(0, 199, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).optimal_score.f64 = 0.0;
+  __Pyx_TraceLine(33,0,__PYX_ERR(0, 33, __pyx_L1_error))
+  (__pyx_v_str_[0]) = __pyx_v_proc_str;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":200
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
- *     dereference(scorer_flags).worst_score.f64 = 1.0             # <<<<<<<<<<<<<<
- *     return True
+  /* "rapidfuzz/utils_cpp.pyx":34
  * 
- */
-  __Pyx_TraceLine(200,1,__PYX_ERR(0, 200, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).worst_score.f64 = 1.0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":201
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
- *     dereference(scorer_flags).worst_score.f64 = 1.0
+ *     str_[0] = proc_str
  *     return True             # <<<<<<<<<<<<<<
  * 
- * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ * cdef RF_Preprocessor DefaultProcessContext
  */
-  __Pyx_TraceLine(201,1,__PYX_ERR(0, 201, __pyx_L1_error))
+  __Pyx_TraceLine(34,0,__PYX_ERR(0, 34, __pyx_L1_error))
   __pyx_r = 1;
   goto __pyx_L0;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":197
- *     return True
- * 
- * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  #ifdef WITH_THREAD
-  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-  #endif
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.GetScorerFlagsHammingNormalizedDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  #ifdef WITH_THREAD
-  __Pyx_PyGILState_Release(__pyx_gilstate_save);
-  #endif
-  __pyx_L0:;
-  __Pyx_TraceReturn(Py_None, 1);
-  return __pyx_r;
-}
-
-/* "rapidfuzz/distance/Hamming_cpp.pyx":203
- *     return True
+  /* "rapidfuzz/utils_cpp.pyx":24
  * 
- * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
- */
-
-static bool __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
-  bool __pyx_r;
-  __Pyx_TraceDeclarations
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  #ifdef WITH_THREAD
-  PyGILState_STATE __pyx_gilstate_save;
-  #endif
-  __Pyx_TraceCall("GetScorerFlagsHammingSimilarity", __pyx_f[0], 203, 1, __PYX_ERR(0, 203, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":204
  * 
- * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
- *     dereference(scorer_flags).worst_score.i64 = 0
- */
-  __Pyx_TraceLine(204,1,__PYX_ERR(0, 204, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":205
- * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).worst_score.i64 = 0
- *     return True
- */
-  __Pyx_TraceLine(205,1,__PYX_ERR(0, 205, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).optimal_score.i64 = INT64_MAX;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":206
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
- *     dereference(scorer_flags).worst_score.i64 = 0             # <<<<<<<<<<<<<<
- *     return True
- * 
- */
-  __Pyx_TraceLine(206,1,__PYX_ERR(0, 206, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).worst_score.i64 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":207
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
- *     dereference(scorer_flags).worst_score.i64 = 0
- *     return True             # <<<<<<<<<<<<<<
- * 
- * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- */
-  __Pyx_TraceLine(207,1,__PYX_ERR(0, 207, __pyx_L1_error))
-  __pyx_r = 1;
-  goto __pyx_L0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":203
- *     return True
- * 
- * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  #ifdef WITH_THREAD
-  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-  #endif
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.GetScorerFlagsHammingSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  #ifdef WITH_THREAD
-  __Pyx_PyGILState_Release(__pyx_gilstate_save);
-  #endif
-  __pyx_L0:;
-  __Pyx_TraceReturn(Py_None, 1);
-  return __pyx_r;
-}
-
-/* "rapidfuzz/distance/Hamming_cpp.pyx":209
- *     return True
- * 
- * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
- */
-
-static bool __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingNormalizedSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
-  bool __pyx_r;
-  __Pyx_TraceDeclarations
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  #ifdef WITH_THREAD
-  PyGILState_STATE __pyx_gilstate_save;
-  #endif
-  __Pyx_TraceCall("GetScorerFlagsHammingNormalizedSimilarity", __pyx_f[0], 209, 1, __PYX_ERR(0, 209, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":210
- * 
- * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
- *     dereference(scorer_flags).worst_score.f64 = 0
- */
-  __Pyx_TraceLine(210,1,__PYX_ERR(0, 210, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":211
- * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 1.0             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).worst_score.f64 = 0
- *     return True
- */
-  __Pyx_TraceLine(211,1,__PYX_ERR(0, 211, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).optimal_score.f64 = 1.0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":212
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
- *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
- *     return True
- * 
- */
-  __Pyx_TraceLine(212,1,__PYX_ERR(0, 212, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":213
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
- *     dereference(scorer_flags).worst_score.f64 = 0
- *     return True             # <<<<<<<<<<<<<<
- * 
- * cdef RF_Scorer HammingDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingDistance, HammingDistanceInit)
- */
-  __Pyx_TraceLine(213,1,__PYX_ERR(0, 213, __pyx_L1_error))
-  __pyx_r = 1;
-  goto __pyx_L0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":209
- *     return True
- * 
- * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ * cdef bool default_process_capi(sentence, RF_String* str_) except False:             # <<<<<<<<<<<<<<
+ *     proc_str = conv_sequence(sentence)
+ *     try:
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  #ifdef WITH_THREAD
-  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-  #endif
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp.GetScorerFlagsHammingNormalizedSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_AddTraceback("rapidfuzz.utils_cpp.default_process_capi", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
-  #ifdef WITH_THREAD
-  __Pyx_PyGILState_Release(__pyx_gilstate_save);
-  #endif
   __pyx_L0:;
-  __Pyx_TraceReturn(Py_None, 1);
-  return __pyx_r;
-}
-
-/* "rapidfuzz/distance/Hamming_cpp.pyx":227
- * normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
- * 
- * def _GetScorerFlagsDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
- * 
- */
-
-/* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_9_GetScorerFlagsDistance(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_9_GetScorerFlagsDistance = {"_GetScorerFlagsDistance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_9_GetScorerFlagsDistance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_9_GetScorerFlagsDistance(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-) {
-  CYTHON_UNUSED PyObject *__pyx_v_kwargs = 0;
-  #if !CYTHON_METH_FASTCALL
-  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
-  #endif
-  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("_GetScorerFlagsDistance (wrapper)", 0);
-  if (unlikely(__pyx_nargs > 0)) {
-    __Pyx_RaiseArgtupleInvalid("_GetScorerFlagsDistance", 1, 0, 0, __pyx_nargs); return NULL;}
-  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "_GetScorerFlagsDistance", 1))) return NULL;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_8_GetScorerFlagsDistance(__pyx_self, __pyx_v_kwargs);
-
-  /* function exit code */
-  __Pyx_XDECREF(__pyx_v_kwargs);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_8_GetScorerFlagsDistance(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_TraceDeclarations
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__6)
-  __Pyx_RefNannySetupContext("_GetScorerFlagsDistance", 0);
-  __Pyx_TraceCall("_GetScorerFlagsDistance", __pyx_f[0], 227, 0, __PYX_ERR(0, 227, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":228
- * 
- * def _GetScorerFlagsDistance(**kwargs):
- *     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __Pyx_TraceLine(228,0,__PYX_ERR(0, 228, __pyx_L1_error))
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 228, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_optimal_score, __pyx_int_0) < 0) __PYX_ERR(0, 228, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_worst_score, __pyx_int_9223372036854775807) < 0) __PYX_ERR(0, 228, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_flags, __pyx_int_64) < 0) __PYX_ERR(0, 228, __pyx_L1_error)
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":227
- * normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
- * 
- * def _GetScorerFlagsDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp._GetScorerFlagsDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_TraceReturn(__pyx_r, 0);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "rapidfuzz/distance/Hamming_cpp.pyx":231
- * 
- * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
- * 
- */
-
-/* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_11_GetScorerFlagsSimilarity(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_11_GetScorerFlagsSimilarity = {"_GetScorerFlagsSimilarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_11_GetScorerFlagsSimilarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_11_GetScorerFlagsSimilarity(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-) {
-  CYTHON_UNUSED PyObject *__pyx_v_kwargs = 0;
-  #if !CYTHON_METH_FASTCALL
-  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
-  #endif
-  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("_GetScorerFlagsSimilarity (wrapper)", 0);
-  if (unlikely(__pyx_nargs > 0)) {
-    __Pyx_RaiseArgtupleInvalid("_GetScorerFlagsSimilarity", 1, 0, 0, __pyx_nargs); return NULL;}
-  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "_GetScorerFlagsSimilarity", 1))) return NULL;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_10_GetScorerFlagsSimilarity(__pyx_self, __pyx_v_kwargs);
-
-  /* function exit code */
-  __Pyx_XDECREF(__pyx_v_kwargs);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_10_GetScorerFlagsSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_TraceDeclarations
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__7)
-  __Pyx_RefNannySetupContext("_GetScorerFlagsSimilarity", 0);
-  __Pyx_TraceCall("_GetScorerFlagsSimilarity", __pyx_f[0], 231, 0, __PYX_ERR(0, 231, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":232
- * 
- * def _GetScorerFlagsSimilarity(**kwargs):
- *     return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __Pyx_TraceLine(232,0,__PYX_ERR(0, 232, __pyx_L1_error))
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 232, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_optimal_score, __pyx_int_9223372036854775807) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_worst_score, __pyx_int_0) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_flags, __pyx_int_64) < 0) __PYX_ERR(0, 232, __pyx_L1_error)
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":231
- * 
- * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp._GetScorerFlagsSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_TraceReturn(__pyx_r, 0);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "rapidfuzz/distance/Hamming_cpp.pyx":235
- * 
- * 
- * def _GetScorerFlagsNormalizedDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
- * 
- */
-
-/* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_13_GetScorerFlagsNormalizedDistance(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_13_GetScorerFlagsNormalizedDistance = {"_GetScorerFlagsNormalizedDistance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_13_GetScorerFlagsNormalizedDistance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_13_GetScorerFlagsNormalizedDistance(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-) {
-  CYTHON_UNUSED PyObject *__pyx_v_kwargs = 0;
-  #if !CYTHON_METH_FASTCALL
-  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
-  #endif
-  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("_GetScorerFlagsNormalizedDistance (wrapper)", 0);
-  if (unlikely(__pyx_nargs > 0)) {
-    __Pyx_RaiseArgtupleInvalid("_GetScorerFlagsNormalizedDistance", 1, 0, 0, __pyx_nargs); return NULL;}
-  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "_GetScorerFlagsNormalizedDistance", 1))) return NULL;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_12_GetScorerFlagsNormalizedDistance(__pyx_self, __pyx_v_kwargs);
-
-  /* function exit code */
-  __Pyx_XDECREF(__pyx_v_kwargs);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_12_GetScorerFlagsNormalizedDistance(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_TraceDeclarations
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__8)
-  __Pyx_RefNannySetupContext("_GetScorerFlagsNormalizedDistance", 0);
-  __Pyx_TraceCall("_GetScorerFlagsNormalizedDistance", __pyx_f[0], 235, 0, __PYX_ERR(0, 235, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":236
- * 
- * def _GetScorerFlagsNormalizedDistance(**kwargs):
- *     return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __Pyx_TraceLine(236,0,__PYX_ERR(0, 236, __pyx_L1_error))
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 236, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_optimal_score, __pyx_int_0) < 0) __PYX_ERR(0, 236, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_worst_score, __pyx_int_1) < 0) __PYX_ERR(0, 236, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_flags, __pyx_int_32) < 0) __PYX_ERR(0, 236, __pyx_L1_error)
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":235
- * 
- * 
- * def _GetScorerFlagsNormalizedDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp._GetScorerFlagsNormalizedDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_TraceReturn(__pyx_r, 0);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "rapidfuzz/distance/Hamming_cpp.pyx":239
- * 
- * 
- * def _GetScorerFlagsNormalizedSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
- * 
- */
-
-/* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_15_GetScorerFlagsNormalizedSimilarity(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_15_GetScorerFlagsNormalizedSimilarity = {"_GetScorerFlagsNormalizedSimilarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_15_GetScorerFlagsNormalizedSimilarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_8distance_11Hamming_cpp_15_GetScorerFlagsNormalizedSimilarity(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-) {
-  CYTHON_UNUSED PyObject *__pyx_v_kwargs = 0;
-  #if !CYTHON_METH_FASTCALL
-  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
-  #endif
-  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("_GetScorerFlagsNormalizedSimilarity (wrapper)", 0);
-  if (unlikely(__pyx_nargs > 0)) {
-    __Pyx_RaiseArgtupleInvalid("_GetScorerFlagsNormalizedSimilarity", 1, 0, 0, __pyx_nargs); return NULL;}
-  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "_GetScorerFlagsNormalizedSimilarity", 1))) return NULL;
-  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_14_GetScorerFlagsNormalizedSimilarity(__pyx_self, __pyx_v_kwargs);
-
-  /* function exit code */
-  __Pyx_XDECREF(__pyx_v_kwargs);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_9rapidfuzz_8distance_11Hamming_cpp_14_GetScorerFlagsNormalizedSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_TraceDeclarations
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__9)
-  __Pyx_RefNannySetupContext("_GetScorerFlagsNormalizedSimilarity", 0);
-  __Pyx_TraceCall("_GetScorerFlagsNormalizedSimilarity", __pyx_f[0], 239, 0, __PYX_ERR(0, 239, __pyx_L1_error));
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":240
- * 
- * def _GetScorerFlagsNormalizedSimilarity(**kwargs):
- *     return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __Pyx_TraceLine(240,0,__PYX_ERR(0, 240, __pyx_L1_error))
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 240, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_optimal_score, __pyx_int_1) < 0) __PYX_ERR(0, 240, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_worst_score, __pyx_int_0) < 0) __PYX_ERR(0, 240, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_flags, __pyx_int_32) < 0) __PYX_ERR(0, 240, __pyx_L1_error)
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":239
- * 
- * 
- * def _GetScorerFlagsNormalizedSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.distance.Hamming_cpp._GetScorerFlagsNormalizedSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_TraceReturn(Py_None, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "cpp_common.pxd":242
  *     void validate_string(object py_str, const char* err) except +
  * 
@@ -6023,18 +4377,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__10);
+        __Pyx_INCREF(__pyx_kp_u__2);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__10);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__10);
+        __Pyx_GIVEREF(__pyx_kp_u__2);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__2);
         __pyx_t_8 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -6122,18 +4476,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__10);
+        __Pyx_INCREF(__pyx_kp_u__2);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__10);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__10);
+        __Pyx_GIVEREF(__pyx_kp_u__2);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__2);
         __pyx_t_8 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -6352,18 +4706,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__10);
+        __Pyx_INCREF(__pyx_kp_u__2);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__10);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__10);
+        __Pyx_GIVEREF(__pyx_kp_u__2);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__2);
         __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -6451,18 +4805,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__10);
+        __Pyx_INCREF(__pyx_kp_u__2);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__10);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__10);
+        __Pyx_GIVEREF(__pyx_kp_u__2);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__2);
         __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -6906,15 +5260,15 @@
     __Pyx_TraceLine(390,0,__PYX_ERR(1, 390, __pyx_L1_error))
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "keys");
       __PYX_ERR(1, 390, __pyx_L1_error)
     }
     __pyx_t_3 = __Pyx_PyDict_Keys(__pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__11, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 390, __pyx_L1_error)
+    __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__3, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_kp_u_Got_unexpected_keyword_arguments);
     __Pyx_GIVEREF(__pyx_kp_u_Got_unexpected_keyword_arguments);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_Got_unexpected_keyword_arguments);
@@ -7212,284 +5566,144 @@
     #define CYTHON_SMALL_CODE
 #endif
 #endif
 /* #### Code section: pystring_table ### */
 
 static __Pyx_StringTabEntry __pyx_string_tab[] = {
   #if CYTHON_USE_MODULE_STATE
-  {0, __pyx_k_GetScorerFlagsDistance, sizeof(__pyx_k_GetScorerFlagsDistance), 0, 0, 1, 1},
-  {0, __pyx_k_GetScorerFlagsNormalizedDistanc, sizeof(__pyx_k_GetScorerFlagsNormalizedDistanc), 0, 0, 1, 1},
-  {0, __pyx_k_GetScorerFlagsNormalizedSimilar, sizeof(__pyx_k_GetScorerFlagsNormalizedSimilar), 0, 0, 1, 1},
-  {0, __pyx_k_GetScorerFlagsSimilarity, sizeof(__pyx_k_GetScorerFlagsSimilarity), 0, 0, 1, 1},
   {0, __pyx_k_Got_unexpected_keyword_arguments, sizeof(__pyx_k_Got_unexpected_keyword_arguments), 0, 1, 0, 0},
   {0, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
+  {0, __pyx_k_RF_Preprocess, sizeof(__pyx_k_RF_Preprocess), 0, 0, 1, 1},
   {0, __pyx_k_RF_Preprocess, sizeof(__pyx_k_RF_Preprocess), 0, 1, 0, 1},
   {0, __pyx_k_RF_Scorer, sizeof(__pyx_k_RF_Scorer), 0, 0, 1, 1},
   {0, __pyx_k_RF_ScorerPy, sizeof(__pyx_k_RF_ScorerPy), 0, 0, 1, 1},
   {0, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
-  {0, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
-  {0, __pyx_k__10, sizeof(__pyx_k__10), 0, 1, 0, 0},
-  {0, __pyx_k__11, sizeof(__pyx_k__11), 0, 1, 0, 0},
-  {0, __pyx_k__12, sizeof(__pyx_k__12), 0, 1, 0, 0},
-  {0, __pyx_k__16, sizeof(__pyx_k__16), 0, 0, 1, 1},
+  {0, __pyx_k__2, sizeof(__pyx_k__2), 0, 1, 0, 0},
+  {0, __pyx_k__3, sizeof(__pyx_k__3), 0, 1, 0, 0},
+  {0, __pyx_k__4, sizeof(__pyx_k__4), 0, 1, 0, 0},
+  {0, __pyx_k__6, sizeof(__pyx_k__6), 0, 0, 1, 1},
   {0, __pyx_k_array, sizeof(__pyx_k_array), 0, 0, 1, 1},
   {0, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
-  {0, __pyx_k_c_score_cutoff, sizeof(__pyx_k_c_score_cutoff), 0, 0, 1, 1},
   {0, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
-  {0, __pyx_k_distance, sizeof(__pyx_k_distance), 0, 0, 1, 1},
-  {0, __pyx_k_flags, sizeof(__pyx_k_flags), 0, 1, 0, 1},
+  {0, __pyx_k_default_process, sizeof(__pyx_k_default_process), 0, 0, 1, 1},
   {0, __pyx_k_get_scorer_flags, sizeof(__pyx_k_get_scorer_flags), 0, 1, 0, 1},
   {0, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
   {0, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
   {0, __pyx_k_keys, sizeof(__pyx_k_keys), 0, 0, 1, 1},
-  {0, __pyx_k_kwargs, sizeof(__pyx_k_kwargs), 0, 0, 1, 1},
   {0, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {0, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
-  {0, __pyx_k_normalized_distance, sizeof(__pyx_k_normalized_distance), 0, 0, 1, 1},
-  {0, __pyx_k_normalized_similarity, sizeof(__pyx_k_normalized_similarity), 0, 0, 1, 1},
-  {0, __pyx_k_optimal_score, sizeof(__pyx_k_optimal_score), 0, 1, 0, 1},
-  {0, __pyx_k_processor, sizeof(__pyx_k_processor), 0, 0, 1, 1},
   {0, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
-  {0, __pyx_k_rapidfuzz_distance_Hamming_cpp, sizeof(__pyx_k_rapidfuzz_distance_Hamming_cpp), 0, 0, 1, 1},
-  {0, __pyx_k_s1, sizeof(__pyx_k_s1), 0, 0, 1, 1},
-  {0, __pyx_k_s1_proc, sizeof(__pyx_k_s1_proc), 0, 0, 1, 1},
-  {0, __pyx_k_s2, sizeof(__pyx_k_s2), 0, 0, 1, 1},
-  {0, __pyx_k_s2_proc, sizeof(__pyx_k_s2_proc), 0, 0, 1, 1},
-  {0, __pyx_k_score_cutoff, sizeof(__pyx_k_score_cutoff), 0, 0, 1, 1},
-  {0, __pyx_k_score_cutoff_has_to_be_0, sizeof(__pyx_k_score_cutoff_has_to_be_0), 0, 1, 0, 0},
+  {0, __pyx_k_rapidfuzz_utils_cpp, sizeof(__pyx_k_rapidfuzz_utils_cpp), 0, 0, 1, 1},
   {0, __pyx_k_score_cutoff_has_to_be_in_the_ra, sizeof(__pyx_k_score_cutoff_has_to_be_in_the_ra), 0, 1, 0, 0},
-  {0, __pyx_k_similarity, sizeof(__pyx_k_similarity), 0, 0, 1, 1},
-  {0, __pyx_k_src_rapidfuzz_distance_Hamming_c, sizeof(__pyx_k_src_rapidfuzz_distance_Hamming_c), 0, 0, 1, 0},
+  {0, __pyx_k_sentence, sizeof(__pyx_k_sentence), 0, 0, 1, 1},
+  {0, __pyx_k_src_rapidfuzz_utils_cpp_pyx, sizeof(__pyx_k_src_rapidfuzz_utils_cpp_pyx), 0, 0, 1, 0},
   {0, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
   {0, __pyx_k_typecode, sizeof(__pyx_k_typecode), 0, 0, 1, 1},
-  {0, __pyx_k_worst_score, sizeof(__pyx_k_worst_score), 0, 1, 0, 1},
   #else
-  {&__pyx_n_s_GetScorerFlagsDistance, __pyx_k_GetScorerFlagsDistance, sizeof(__pyx_k_GetScorerFlagsDistance), 0, 0, 1, 1},
-  {&__pyx_n_s_GetScorerFlagsNormalizedDistanc, __pyx_k_GetScorerFlagsNormalizedDistanc, sizeof(__pyx_k_GetScorerFlagsNormalizedDistanc), 0, 0, 1, 1},
-  {&__pyx_n_s_GetScorerFlagsNormalizedSimilar, __pyx_k_GetScorerFlagsNormalizedSimilar, sizeof(__pyx_k_GetScorerFlagsNormalizedSimilar), 0, 0, 1, 1},
-  {&__pyx_n_s_GetScorerFlagsSimilarity, __pyx_k_GetScorerFlagsSimilarity, sizeof(__pyx_k_GetScorerFlagsSimilarity), 0, 0, 1, 1},
   {&__pyx_kp_u_Got_unexpected_keyword_arguments, __pyx_k_Got_unexpected_keyword_arguments, sizeof(__pyx_k_Got_unexpected_keyword_arguments), 0, 1, 0, 0},
   {&__pyx_n_s_MemoryError, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
+  {&__pyx_n_s_RF_Preprocess, __pyx_k_RF_Preprocess, sizeof(__pyx_k_RF_Preprocess), 0, 0, 1, 1},
   {&__pyx_n_u_RF_Preprocess, __pyx_k_RF_Preprocess, sizeof(__pyx_k_RF_Preprocess), 0, 1, 0, 1},
   {&__pyx_n_s_RF_Scorer, __pyx_k_RF_Scorer, sizeof(__pyx_k_RF_Scorer), 0, 0, 1, 1},
   {&__pyx_n_s_RF_ScorerPy, __pyx_k_RF_ScorerPy, sizeof(__pyx_k_RF_ScorerPy), 0, 0, 1, 1},
   {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
-  {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
-  {&__pyx_kp_u__10, __pyx_k__10, sizeof(__pyx_k__10), 0, 1, 0, 0},
-  {&__pyx_kp_u__11, __pyx_k__11, sizeof(__pyx_k__11), 0, 1, 0, 0},
-  {&__pyx_kp_u__12, __pyx_k__12, sizeof(__pyx_k__12), 0, 1, 0, 0},
-  {&__pyx_n_s__16, __pyx_k__16, sizeof(__pyx_k__16), 0, 0, 1, 1},
+  {&__pyx_kp_u__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 1, 0, 0},
+  {&__pyx_kp_u__3, __pyx_k__3, sizeof(__pyx_k__3), 0, 1, 0, 0},
+  {&__pyx_kp_u__4, __pyx_k__4, sizeof(__pyx_k__4), 0, 1, 0, 0},
+  {&__pyx_n_s__6, __pyx_k__6, sizeof(__pyx_k__6), 0, 0, 1, 1},
   {&__pyx_n_s_array, __pyx_k_array, sizeof(__pyx_k_array), 0, 0, 1, 1},
   {&__pyx_n_s_asyncio_coroutines, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
-  {&__pyx_n_s_c_score_cutoff, __pyx_k_c_score_cutoff, sizeof(__pyx_k_c_score_cutoff), 0, 0, 1, 1},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
-  {&__pyx_n_s_distance, __pyx_k_distance, sizeof(__pyx_k_distance), 0, 0, 1, 1},
-  {&__pyx_n_u_flags, __pyx_k_flags, sizeof(__pyx_k_flags), 0, 1, 0, 1},
+  {&__pyx_n_s_default_process, __pyx_k_default_process, sizeof(__pyx_k_default_process), 0, 0, 1, 1},
   {&__pyx_n_u_get_scorer_flags, __pyx_k_get_scorer_flags, sizeof(__pyx_k_get_scorer_flags), 0, 1, 0, 1},
   {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
   {&__pyx_n_s_is_coroutine, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
   {&__pyx_n_s_keys, __pyx_k_keys, sizeof(__pyx_k_keys), 0, 0, 1, 1},
-  {&__pyx_n_s_kwargs, __pyx_k_kwargs, sizeof(__pyx_k_kwargs), 0, 0, 1, 1},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
-  {&__pyx_n_s_normalized_distance, __pyx_k_normalized_distance, sizeof(__pyx_k_normalized_distance), 0, 0, 1, 1},
-  {&__pyx_n_s_normalized_similarity, __pyx_k_normalized_similarity, sizeof(__pyx_k_normalized_similarity), 0, 0, 1, 1},
-  {&__pyx_n_u_optimal_score, __pyx_k_optimal_score, sizeof(__pyx_k_optimal_score), 0, 1, 0, 1},
-  {&__pyx_n_s_processor, __pyx_k_processor, sizeof(__pyx_k_processor), 0, 0, 1, 1},
   {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
-  {&__pyx_n_s_rapidfuzz_distance_Hamming_cpp, __pyx_k_rapidfuzz_distance_Hamming_cpp, sizeof(__pyx_k_rapidfuzz_distance_Hamming_cpp), 0, 0, 1, 1},
-  {&__pyx_n_s_s1, __pyx_k_s1, sizeof(__pyx_k_s1), 0, 0, 1, 1},
-  {&__pyx_n_s_s1_proc, __pyx_k_s1_proc, sizeof(__pyx_k_s1_proc), 0, 0, 1, 1},
-  {&__pyx_n_s_s2, __pyx_k_s2, sizeof(__pyx_k_s2), 0, 0, 1, 1},
-  {&__pyx_n_s_s2_proc, __pyx_k_s2_proc, sizeof(__pyx_k_s2_proc), 0, 0, 1, 1},
-  {&__pyx_n_s_score_cutoff, __pyx_k_score_cutoff, sizeof(__pyx_k_score_cutoff), 0, 0, 1, 1},
-  {&__pyx_kp_u_score_cutoff_has_to_be_0, __pyx_k_score_cutoff_has_to_be_0, sizeof(__pyx_k_score_cutoff_has_to_be_0), 0, 1, 0, 0},
+  {&__pyx_n_s_rapidfuzz_utils_cpp, __pyx_k_rapidfuzz_utils_cpp, sizeof(__pyx_k_rapidfuzz_utils_cpp), 0, 0, 1, 1},
   {&__pyx_kp_u_score_cutoff_has_to_be_in_the_ra, __pyx_k_score_cutoff_has_to_be_in_the_ra, sizeof(__pyx_k_score_cutoff_has_to_be_in_the_ra), 0, 1, 0, 0},
-  {&__pyx_n_s_similarity, __pyx_k_similarity, sizeof(__pyx_k_similarity), 0, 0, 1, 1},
-  {&__pyx_kp_s_src_rapidfuzz_distance_Hamming_c, __pyx_k_src_rapidfuzz_distance_Hamming_c, sizeof(__pyx_k_src_rapidfuzz_distance_Hamming_c), 0, 0, 1, 0},
+  {&__pyx_n_s_sentence, __pyx_k_sentence, sizeof(__pyx_k_sentence), 0, 0, 1, 1},
+  {&__pyx_kp_s_src_rapidfuzz_utils_cpp_pyx, __pyx_k_src_rapidfuzz_utils_cpp_pyx, sizeof(__pyx_k_src_rapidfuzz_utils_cpp_pyx), 0, 0, 1, 0},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
   {&__pyx_n_s_typecode, __pyx_k_typecode, sizeof(__pyx_k_typecode), 0, 0, 1, 1},
-  {&__pyx_n_u_worst_score, __pyx_k_worst_score, sizeof(__pyx_k_worst_score), 0, 1, 0, 1},
   #endif
   {0, 0, 0, 0, 0, 0, 0}
 };
 /* #### Code section: cached_builtins ### */
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 65, __pyx_L1_error)
   __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 251, __pyx_L1_error)
   __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(1, 257, __pyx_L1_error)
   __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 338, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 /* #### Code section: cached_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":65
- * 
- *     if c_score_cutoff < 0:
- *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
- * 
- *     if s1 is None or s2 is None:
- */
-  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_score_cutoff_has_to_be_0); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 65, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__2);
-  __Pyx_GIVEREF(__pyx_tuple__2);
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":29
- *     bool HammingNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
- * 
- * def distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Hamming distance between two strings.
- */
-  __pyx_tuple__13 = PyTuple_Pack(7, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_c_score_cutoff, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 29, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__13);
-  __Pyx_GIVEREF(__pyx_tuple__13);
-  __pyx_codeobj_ = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__13, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_Hamming_c, __pyx_n_s_distance, 29, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj_)) __PYX_ERR(0, 29, __pyx_L1_error)
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":73
- *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
- * def similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Hamming similarity between two strings.
- */
-  __pyx_codeobj__3 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__13, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_Hamming_c, __pyx_n_s_similarity, 73, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__3)) __PYX_ERR(0, 73, __pyx_L1_error)
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":116
- *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
- * def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized levenshtein similarity in the range [1, 0].
- */
-  __pyx_tuple__14 = PyTuple_Pack(7, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc, __pyx_n_s_c_score_cutoff); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 116, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__14);
-  __Pyx_GIVEREF(__pyx_tuple__14);
-  __pyx_codeobj__4 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_Hamming_c, __pyx_n_s_normalized_distance, 116, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 116, __pyx_L1_error)
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":154
- * 
- * 
- * def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized hamming similarity in the range [0, 1].
- */
-  __pyx_codeobj__5 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_Hamming_c, __pyx_n_s_normalized_similarity, 154, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 154, __pyx_L1_error)
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":227
- * normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
- * 
- * def _GetScorerFlagsDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
- * 
- */
-  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_n_s_kwargs); if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 227, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__15);
-  __Pyx_GIVEREF(__pyx_tuple__15);
-  __pyx_codeobj__6 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__15, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_Hamming_c, __pyx_n_s_GetScorerFlagsDistance, 227, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__6)) __PYX_ERR(0, 227, __pyx_L1_error)
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":231
+  /* "rapidfuzz/utils_cpp.pyx":19
+ *     RF_String default_process_func(RF_String sentence) except +
  * 
- * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
- * 
- */
-  __pyx_codeobj__7 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__15, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_Hamming_c, __pyx_n_s_GetScorerFlagsSimilarity, 231, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 231, __pyx_L1_error)
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":235
- * 
- * 
- * def _GetScorerFlagsNormalizedDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
- * 
- */
-  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__15, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_Hamming_c, __pyx_n_s_GetScorerFlagsNormalizedDistanc, 235, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 235, __pyx_L1_error)
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":239
- * 
- * 
- * def _GetScorerFlagsNormalizedSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
- * 
- */
-  __pyx_codeobj__9 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__15, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_Hamming_c, __pyx_n_s_GetScorerFlagsNormalizedSimilar, 239, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__9)) __PYX_ERR(0, 239, __pyx_L1_error)
+ * def default_process(sentence):             # <<<<<<<<<<<<<<
+ *     validate_string(sentence, "sentence must be a String")
+ *     return default_process_impl(sentence)
+ */
+  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_n_s_sentence); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 19, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__5);
+  __Pyx_GIVEREF(__pyx_tuple__5);
+  __pyx_codeobj_ = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__5, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_utils_cpp_pyx, __pyx_n_s_default_process, 19, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj_)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 /* #### Code section: init_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitConstants(void) {
   __pyx_umethod_PyDict_Type_keys.type = (PyObject*)&PyDict_Type;
   __pyx_umethod_PyDict_Type_keys.method_name = &__pyx_n_s_keys;
   #if CYTHON_USE_MODULE_STATE
-  if (__Pyx_InitString(__pyx_string_tab[0], &__pyx_n_s_GetScorerFlagsDistance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[1], &__pyx_n_s_GetScorerFlagsNormalizedDistanc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[2], &__pyx_n_s_GetScorerFlagsNormalizedSimilar) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[3], &__pyx_n_s_GetScorerFlagsSimilarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[4], &__pyx_kp_u_Got_unexpected_keyword_arguments) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[5], &__pyx_n_s_MemoryError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[6], &__pyx_n_u_RF_Preprocess) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[7], &__pyx_n_s_RF_Scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[8], &__pyx_n_s_RF_ScorerPy) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[9], &__pyx_n_s_TypeError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[10], &__pyx_n_s_ValueError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[11], &__pyx_kp_u__10) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[12], &__pyx_kp_u__11) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[13], &__pyx_kp_u__12) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[14], &__pyx_n_s__16) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[15], &__pyx_n_s_array) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[16], &__pyx_n_s_asyncio_coroutines) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[17], &__pyx_n_s_c_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[18], &__pyx_n_s_cline_in_traceback) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[19], &__pyx_n_s_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[20], &__pyx_n_u_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[21], &__pyx_n_u_get_scorer_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[22], &__pyx_n_s_import) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[23], &__pyx_n_s_is_coroutine) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[24], &__pyx_n_s_keys) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[25], &__pyx_n_s_kwargs) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[26], &__pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[27], &__pyx_n_s_name) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[28], &__pyx_n_s_normalized_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[29], &__pyx_n_s_normalized_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[30], &__pyx_n_u_optimal_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[31], &__pyx_n_s_processor) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[32], &__pyx_n_s_range) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[33], &__pyx_n_s_rapidfuzz_distance_Hamming_cpp) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[34], &__pyx_n_s_s1) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[35], &__pyx_n_s_s1_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[36], &__pyx_n_s_s2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[37], &__pyx_n_s_s2_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[38], &__pyx_n_s_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[39], &__pyx_kp_u_score_cutoff_has_to_be_0) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[40], &__pyx_kp_u_score_cutoff_has_to_be_in_the_ra) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[41], &__pyx_n_s_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[42], &__pyx_kp_s_src_rapidfuzz_distance_Hamming_c) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[43], &__pyx_n_s_test) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[44], &__pyx_n_s_typecode) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[45], &__pyx_n_u_worst_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[0], &__pyx_kp_u_Got_unexpected_keyword_arguments) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[1], &__pyx_n_s_MemoryError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[2], &__pyx_n_s_RF_Preprocess) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[3], &__pyx_n_u_RF_Preprocess) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[4], &__pyx_n_s_RF_Scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[5], &__pyx_n_s_RF_ScorerPy) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[6], &__pyx_n_s_TypeError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[7], &__pyx_kp_u__2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[8], &__pyx_kp_u__3) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[9], &__pyx_kp_u__4) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[10], &__pyx_n_s__6) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[11], &__pyx_n_s_array) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[12], &__pyx_n_s_asyncio_coroutines) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[13], &__pyx_n_s_cline_in_traceback) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[14], &__pyx_n_s_default_process) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[15], &__pyx_n_u_get_scorer_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[16], &__pyx_n_s_import) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[17], &__pyx_n_s_is_coroutine) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[18], &__pyx_n_s_keys) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[19], &__pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[20], &__pyx_n_s_name) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[21], &__pyx_n_s_range) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[22], &__pyx_n_s_rapidfuzz_utils_cpp) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[23], &__pyx_kp_u_score_cutoff_has_to_be_in_the_ra) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[24], &__pyx_n_s_sentence) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[25], &__pyx_kp_s_src_rapidfuzz_utils_cpp_pyx) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[26], &__pyx_n_s_test) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[27], &__pyx_n_s_typecode) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   #endif
   #if !CYTHON_USE_MODULE_STATE
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   #endif
-  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_32 = PyInt_FromLong(32); if (unlikely(!__pyx_int_32)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_64 = PyInt_FromLong(64); if (unlikely(!__pyx_int_64)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_9223372036854775807 = PyInt_FromString((char *)"9223372036854775807", 0, 0); if (unlikely(!__pyx_int_9223372036854775807)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 /* #### Code section: init_globals ### */
 
@@ -7583,31 +5797,31 @@
   return 0;
 }
 
 
 #if PY_MAJOR_VERSION >= 3
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
-static int __pyx_pymod_exec_Hamming_cpp(PyObject* module); /*proto*/
+static int __pyx_pymod_exec_utils_cpp(PyObject* module); /*proto*/
 static PyModuleDef_Slot __pyx_moduledef_slots[] = {
   {Py_mod_create, (void*)__pyx_pymod_create},
-  {Py_mod_exec, (void*)__pyx_pymod_exec_Hamming_cpp},
+  {Py_mod_exec, (void*)__pyx_pymod_exec_utils_cpp},
   {0, NULL}
 };
 #endif
 
 #ifdef __cplusplus
 namespace {
   struct PyModuleDef __pyx_moduledef =
   #else
   static struct PyModuleDef __pyx_moduledef =
   #endif
   {
       PyModuleDef_HEAD_INIT,
-      "Hamming_cpp",
+      "utils_cpp",
       0, /* m_doc */
     #if CYTHON_PEP489_MULTI_PHASE_INIT
       0, /* m_size */
     #elif CYTHON_USE_MODULE_STATE
       sizeof(__pyx_mstate), /* m_size */
     #else
       -1, /* m_size */
@@ -7647,19 +5861,19 @@
 #else
 #define __Pyx_PyMODINIT_FUNC PyObject *
 #endif
 #endif
 
 
 #if PY_MAJOR_VERSION < 3
-__Pyx_PyMODINIT_FUNC initHamming_cpp(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC initHamming_cpp(void)
+__Pyx_PyMODINIT_FUNC initutils_cpp(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC initutils_cpp(void)
 #else
-__Pyx_PyMODINIT_FUNC PyInit_Hamming_cpp(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC PyInit_Hamming_cpp(void)
+__Pyx_PyMODINIT_FUNC PyInit_utils_cpp(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC PyInit_utils_cpp(void)
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 {
   return PyModuleDef_Init(&__pyx_moduledef);
 }
 static CYTHON_SMALL_CODE int __Pyx_check_single_interpreter(void) {
     #if PY_VERSION_HEX >= 0x030700A1
     static PY_INT64_T main_interpreter_id = -1;
@@ -7732,15 +5946,15 @@
     return module;
 bad:
     Py_XDECREF(module);
     return NULL;
 }
 
 
-static CYTHON_SMALL_CODE int __pyx_pymod_exec_Hamming_cpp(PyObject *__pyx_pyinit_module)
+static CYTHON_SMALL_CODE int __pyx_pymod_exec_utils_cpp(PyObject *__pyx_pyinit_module)
 #endif
 #endif
 {
   int stringtab_initialized = 0;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
@@ -7748,27 +5962,27 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   if (__pyx_m) {
     if (__pyx_m == __pyx_pyinit_module) return 0;
-    PyErr_SetString(PyExc_RuntimeError, "Module 'Hamming_cpp' has already been imported. Re-initialisation is not supported.");
+    PyErr_SetString(PyExc_RuntimeError, "Module 'utils_cpp' has already been imported. Re-initialisation is not supported.");
     return -1;
   }
   #elif PY_MAJOR_VERSION >= 3
   if (__pyx_m) return __Pyx_NewRef(__pyx_m);
   #endif
   /*--- Module creation code ---*/
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   __pyx_m = __pyx_pyinit_module;
   Py_INCREF(__pyx_m);
   #else
   #if PY_MAJOR_VERSION < 3
-  __pyx_m = Py_InitModule4("Hamming_cpp", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
+  __pyx_m = Py_InitModule4("utils_cpp", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
   if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
   #elif CYTHON_COMPILING_IN_LIMITED_API
   __pyx_t_1 = PyModule_Create(&__pyx_moduledef); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   {
     int add_module_result = PyState_AddModule(__pyx_t_1, &__pyx_moduledef);
     Py_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (unlikely((add_module_result < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -7791,15 +6005,15 @@
 if (!__Pyx_RefNanny) {
   PyErr_Clear();
   __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
   if (!__Pyx_RefNanny)
       Py_FatalError("failed to import 'refnanny' module");
 }
 #endif
-  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_Hamming_cpp(void)", 0);
+  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_utils_cpp(void)", 0);
   if (__Pyx_check_binary_version() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #ifdef __Pxy_PyFrame_Initialize_Offsets
   __Pxy_PyFrame_Initialize_Offsets();
   #endif
   __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -7829,22 +6043,22 @@
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   stringtab_initialized = 1;
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  if (__pyx_module_is_main_rapidfuzz__distance__Hamming_cpp) {
+  if (__pyx_module_is_main_rapidfuzz__utils_cpp) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   }
   #if PY_MAJOR_VERSION >= 3
   {
     PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
-    if (!PyDict_GetItemString(modules, "rapidfuzz.distance.Hamming_cpp")) {
-      if (unlikely((PyDict_SetItemString(modules, "rapidfuzz.distance.Hamming_cpp", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
+    if (!PyDict_GetItemString(modules, "rapidfuzz.utils_cpp")) {
+      if (unlikely((PyDict_SetItemString(modules, "rapidfuzz.utils_cpp", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
     }
   }
   #endif
   /*--- Builtin init code ---*/
   if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Constants init code ---*/
   if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -7856,417 +6070,104 @@
   if (unlikely((__Pyx_modinit_type_import_code() < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  __Pyx_TraceCall("__Pyx_PyMODINIT_FUNC PyInit_Hamming_cpp(void)", __pyx_f[0], 1, 0, __PYX_ERR(0, 1, __pyx_L1_error));
+  __Pyx_TraceCall("__Pyx_PyMODINIT_FUNC PyInit_utils_cpp(void)", __pyx_f[0], 1, 0, __PYX_ERR(0, 1, __pyx_L1_error));
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":10
- * 
- * # required for preprocess_strings
+  /* "rapidfuzz/utils_cpp.pyx":12
+ * from cpython.pycapsule cimport PyCapsule_New
+ * from libcpp cimport bool
  * from array import array             # <<<<<<<<<<<<<<
- * from cpp_common cimport RF_StringWrapper, preprocess_strings, NoKwargsInit, CreateScorerContext
- * from libc.stdint cimport INT64_MAX, int64_t
+ * 
+ * cdef extern from "utils_cpp.hpp":
  */
-  __Pyx_TraceLine(10,0,__PYX_ERR(0, 10, __pyx_L1_error))
-  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 10, __pyx_L1_error)
+  __Pyx_TraceLine(12,0,__PYX_ERR(0, 12, __pyx_L1_error))
+  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_n_s_array);
   __Pyx_GIVEREF(__pyx_n_s_array);
   PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_array);
-  __pyx_t_3 = __Pyx_Import(__pyx_n_s_array, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 10, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 10, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_2) < 0) __PYX_ERR(0, 10, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":29
- *     bool HammingNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
- * 
- * def distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Hamming distance between two strings.
- */
-  __Pyx_TraceLine(29,0,__PYX_ERR(0, 29, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 29, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_1distance, 0, __pyx_n_s_distance, NULL, __pyx_n_s_rapidfuzz_distance_Hamming_cpp, __pyx_d, ((PyObject *)__pyx_codeobj_)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_distance, __pyx_t_2) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":73
- *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
- * def similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the Hamming similarity between two strings.
- */
-  __Pyx_TraceLine(73,0,__PYX_ERR(0, 73, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 73, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 73, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 73, __pyx_L1_error)
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_3similarity, 0, __pyx_n_s_similarity, NULL, __pyx_n_s_rapidfuzz_distance_Hamming_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__3)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 73, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_similarity, __pyx_t_3) < 0) __PYX_ERR(0, 73, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":116
- *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
- * def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized levenshtein similarity in the range [1, 0].
- */
-  __Pyx_TraceLine(116,0,__PYX_ERR(0, 116, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 116, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_5normalized_distance, 0, __pyx_n_s_normalized_distance, NULL, __pyx_n_s_rapidfuzz_distance_Hamming_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__4)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 116, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_normalized_distance, __pyx_t_2) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":154
- * 
- * 
- * def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a normalized hamming similarity in the range [0, 1].
- */
-  __Pyx_TraceLine(154,0,__PYX_ERR(0, 154, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 154, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 154, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 154, __pyx_L1_error)
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_7normalized_similarity, 0, __pyx_n_s_normalized_similarity, NULL, __pyx_n_s_rapidfuzz_distance_Hamming_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__5)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 154, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_normalized_similarity, __pyx_t_3) < 0) __PYX_ERR(0, 154, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":191
- * 
- * 
- * cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = 0
- */
-  __Pyx_TraceLine(191,0,__PYX_ERR(0, 191, __pyx_L1_error))
-
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":197
- *     return True
- * 
- * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 0.0
- */
-  __Pyx_TraceLine(197,0,__PYX_ERR(0, 197, __pyx_L1_error))
-
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":203
- *     return True
- * 
- * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
- */
-  __Pyx_TraceLine(203,0,__PYX_ERR(0, 203, __pyx_L1_error))
-
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":209
- *     return True
- * 
- * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 1.0
- */
-  __Pyx_TraceLine(209,0,__PYX_ERR(0, 209, __pyx_L1_error))
-
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":215
- *     return True
- * 
- * cdef RF_Scorer HammingDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingDistance, HammingDistanceInit)             # <<<<<<<<<<<<<<
- * distance._RF_Scorer = PyCapsule_New(&HammingDistanceContext, NULL, NULL)
- * 
- */
-  __Pyx_TraceLine(215,0,__PYX_ERR(0, 215, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingDistance, HammingDistanceInit);
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":216
- * 
- * cdef RF_Scorer HammingDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingDistance, HammingDistanceInit)
- * distance._RF_Scorer = PyCapsule_New(&HammingDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
- * 
- * cdef RF_Scorer HammingNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedDistance, HammingNormalizedDistanceInit)
- */
-  __Pyx_TraceLine(216,0,__PYX_ERR(0, 216, __pyx_L1_error))
-  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 216, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Import(__pyx_n_s_array, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 216, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 216, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":218
- * distance._RF_Scorer = PyCapsule_New(&HammingDistanceContext, NULL, NULL)
- * 
- * cdef RF_Scorer HammingNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedDistance, HammingNormalizedDistanceInit)             # <<<<<<<<<<<<<<
- * normalized_distance._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
- * 
- */
-  __Pyx_TraceLine(218,0,__PYX_ERR(0, 218, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingNormalizedDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingNormalizedDistance, HammingNormalizedDistanceInit);
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":219
- * 
- * cdef RF_Scorer HammingNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedDistance, HammingNormalizedDistanceInit)
- * normalized_distance._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
- * 
- * cdef RF_Scorer HammingSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingSimilarity, HammingSimilarityInit)
- */
-  __Pyx_TraceLine(219,0,__PYX_ERR(0, 219, __pyx_L1_error))
-  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingNormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 219, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_normalized_distance); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 219, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 219, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_2) < 0) __PYX_ERR(0, 12, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":221
- * normalized_distance._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
- * 
- * cdef RF_Scorer HammingSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingSimilarity, HammingSimilarityInit)             # <<<<<<<<<<<<<<
- * similarity._RF_Scorer = PyCapsule_New(&HammingSimilarityContext, NULL, NULL)
- * 
- */
-  __Pyx_TraceLine(221,0,__PYX_ERR(0, 221, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingSimilarity, HammingSimilarityInit);
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":222
- * 
- * cdef RF_Scorer HammingSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingSimilarity, HammingSimilarityInit)
- * similarity._RF_Scorer = PyCapsule_New(&HammingSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
- * 
- * cdef RF_Scorer HammingNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedSimilarity, HammingNormalizedSimilarityInit)
- */
-  __Pyx_TraceLine(222,0,__PYX_ERR(0, 222, __pyx_L1_error))
-  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 222, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_similarity); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 222, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 222, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":224
- * similarity._RF_Scorer = PyCapsule_New(&HammingSimilarityContext, NULL, NULL)
- * 
- * cdef RF_Scorer HammingNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedSimilarity, HammingNormalizedSimilarityInit)             # <<<<<<<<<<<<<<
- * normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
- * 
- */
-  __Pyx_TraceLine(224,0,__PYX_ERR(0, 224, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingNormalizedSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11Hamming_cpp_GetScorerFlagsHammingNormalizedSimilarity, HammingNormalizedSimilarityInit);
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":225
+  /* "rapidfuzz/utils_cpp.pyx":19
+ *     RF_String default_process_func(RF_String sentence) except +
  * 
- * cdef RF_Scorer HammingNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedSimilarity, HammingNormalizedSimilarityInit)
- * normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
- * 
- * def _GetScorerFlagsDistance(**kwargs):
+ * def default_process(sentence):             # <<<<<<<<<<<<<<
+ *     validate_string(sentence, "sentence must be a String")
+ *     return default_process_impl(sentence)
  */
-  __Pyx_TraceLine(225,0,__PYX_ERR(0, 225, __pyx_L1_error))
-  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11Hamming_cpp_HammingNormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 225, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_normalized_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 225, __pyx_L1_error)
+  __Pyx_TraceLine(19,0,__PYX_ERR(0, 19, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_9utils_cpp_1default_process, 0, __pyx_n_s_default_process, NULL, __pyx_n_s_rapidfuzz_utils_cpp, __pyx_d, ((PyObject *)__pyx_codeobj_)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 225, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_default_process, __pyx_t_3) < 0) __PYX_ERR(0, 19, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":227
- * normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
+  /* "rapidfuzz/utils_cpp.pyx":24
  * 
- * def _GetScorerFlagsDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
  * 
+ * cdef bool default_process_capi(sentence, RF_String* str_) except False:             # <<<<<<<<<<<<<<
+ *     proc_str = conv_sequence(sentence)
+ *     try:
  */
-  __Pyx_TraceLine(227,0,__PYX_ERR(0, 227, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_9_GetScorerFlagsDistance, 0, __pyx_n_s_GetScorerFlagsDistance, NULL, __pyx_n_s_rapidfuzz_distance_Hamming_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__6)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 227, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_GetScorerFlagsDistance, __pyx_t_3) < 0) __PYX_ERR(0, 227, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_TraceLine(24,0,__PYX_ERR(0, 24, __pyx_L1_error))
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":231
- * 
- * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
- * 
- */
-  __Pyx_TraceLine(231,0,__PYX_ERR(0, 231, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_11_GetScorerFlagsSimilarity, 0, __pyx_n_s_GetScorerFlagsSimilarity, NULL, __pyx_n_s_rapidfuzz_distance_Hamming_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__7)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 231, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_GetScorerFlagsSimilarity, __pyx_t_3) < 0) __PYX_ERR(0, 231, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":235
- * 
- * 
- * def _GetScorerFlagsNormalizedDistance(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
+  /* "rapidfuzz/utils_cpp.pyx":37
  * 
+ * cdef RF_Preprocessor DefaultProcessContext
+ * DefaultProcessContext.version = PREPROCESSOR_STRUCT_VERSION             # <<<<<<<<<<<<<<
+ * DefaultProcessContext.preprocess = default_process_capi
+ * default_process._RF_Preprocess = PyCapsule_New(&DefaultProcessContext, NULL, NULL)
  */
-  __Pyx_TraceLine(235,0,__PYX_ERR(0, 235, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_13_GetScorerFlagsNormalizedDistance, 0, __pyx_n_s_GetScorerFlagsNormalizedDistanc, NULL, __pyx_n_s_rapidfuzz_distance_Hamming_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 235, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_GetScorerFlagsNormalizedDistanc, __pyx_t_3) < 0) __PYX_ERR(0, 235, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_TraceLine(37,0,__PYX_ERR(0, 37, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_9utils_cpp_DefaultProcessContext.version = PREPROCESSOR_STRUCT_VERSION;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":239
- * 
- * 
- * def _GetScorerFlagsNormalizedSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
- * 
+  /* "rapidfuzz/utils_cpp.pyx":38
+ * cdef RF_Preprocessor DefaultProcessContext
+ * DefaultProcessContext.version = PREPROCESSOR_STRUCT_VERSION
+ * DefaultProcessContext.preprocess = default_process_capi             # <<<<<<<<<<<<<<
+ * default_process._RF_Preprocess = PyCapsule_New(&DefaultProcessContext, NULL, NULL)
  */
-  __Pyx_TraceLine(239,0,__PYX_ERR(0, 239, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11Hamming_cpp_15_GetScorerFlagsNormalizedSimilarity, 0, __pyx_n_s_GetScorerFlagsNormalizedSimilar, NULL, __pyx_n_s_rapidfuzz_distance_Hamming_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__9)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 239, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_GetScorerFlagsNormalizedSimilar, __pyx_t_3) < 0) __PYX_ERR(0, 239, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_TraceLine(38,0,__PYX_ERR(0, 38, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_9utils_cpp_DefaultProcessContext.preprocess = __pyx_f_9rapidfuzz_9utils_cpp_default_process_capi;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":243
- * 
- * 
- * distance._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}             # <<<<<<<<<<<<<<
- * 
- * similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
+  /* "rapidfuzz/utils_cpp.pyx":39
+ * DefaultProcessContext.version = PREPROCESSOR_STRUCT_VERSION
+ * DefaultProcessContext.preprocess = default_process_capi
+ * default_process._RF_Preprocess = PyCapsule_New(&DefaultProcessContext, NULL, NULL)             # <<<<<<<<<<<<<<
  */
-  __Pyx_TraceLine(243,0,__PYX_ERR(0, 243, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 243, __pyx_L1_error)
+  __Pyx_TraceLine(39,0,__PYX_ERR(0, 39, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_9utils_cpp_DefaultProcessContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_GetScorerFlagsDistance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 243, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_get_scorer_flags, __pyx_t_2) < 0) __PYX_ERR(0, 243, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 243, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_ScorerPy, __pyx_t_3) < 0) __PYX_ERR(0, 243, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Preprocess, __pyx_t_3) < 0) __PYX_ERR(0, 39, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":245
- * distance._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}
- * 
- * similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}             # <<<<<<<<<<<<<<
- * 
- * normalized_distance._RF_ScorerPy = {
- */
-  __Pyx_TraceLine(245,0,__PYX_ERR(0, 245, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 245, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_GetScorerFlagsSimilarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 245, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_get_scorer_flags, __pyx_t_3) < 0) __PYX_ERR(0, 245, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 245, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_ScorerPy, __pyx_t_2) < 0) __PYX_ERR(0, 245, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":248
- * 
- * normalized_distance._RF_ScorerPy = {
- *     "get_scorer_flags": _GetScorerFlagsNormalizedDistance             # <<<<<<<<<<<<<<
- * }
- * 
- */
-  __Pyx_TraceLine(248,0,__PYX_ERR(0, 248, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 248, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_GetScorerFlagsNormalizedDistanc); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 248, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_u_get_scorer_flags, __pyx_t_2) < 0) __PYX_ERR(0, 248, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":247
- * similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
- * 
- * normalized_distance._RF_ScorerPy = {             # <<<<<<<<<<<<<<
- *     "get_scorer_flags": _GetScorerFlagsNormalizedDistance
- * }
- */
-  __Pyx_TraceLine(247,0,__PYX_ERR(0, 247, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_normalized_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 247, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_ScorerPy, __pyx_t_3) < 0) __PYX_ERR(0, 247, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":252
- * 
- * normalized_similarity._RF_ScorerPy = {
- *     "get_scorer_flags": _GetScorerFlagsNormalizedSimilarity             # <<<<<<<<<<<<<<
- * }
- */
-  __Pyx_TraceLine(252,0,__PYX_ERR(0, 252, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 252, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_GetScorerFlagsNormalizedSimilar); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 252, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_get_scorer_flags, __pyx_t_3) < 0) __PYX_ERR(0, 252, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":251
- * }
- * 
- * normalized_similarity._RF_ScorerPy = {             # <<<<<<<<<<<<<<
- *     "get_scorer_flags": _GetScorerFlagsNormalizedSimilarity
- * }
- */
-  __Pyx_TraceLine(251,0,__PYX_ERR(0, 251, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_normalized_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 251, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_ScorerPy, __pyx_t_2) < 0) __PYX_ERR(0, 251, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-
-  /* "rapidfuzz/distance/Hamming_cpp.pyx":1
+  /* "rapidfuzz/utils_cpp.pyx":1
  * # distutils: language=c++             # <<<<<<<<<<<<<<
  * # cython: language_level=3, binding=True, linetrace=True
  * 
  */
   __Pyx_TraceLine(1,0,__PYX_ERR(0, 1, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_3) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "cpp_common.pxd":242
  *     void validate_string(object py_str, const char* err) except +
  * 
  * cdef inline RF_String hash_array(arr) except *:             # <<<<<<<<<<<<<<
  *     # TODO on Cpython this does not require any copies
  *     cdef RF_String s_proc
@@ -8369,21 +6270,21 @@
 
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   if (__pyx_m) {
     if (__pyx_d && stringtab_initialized) {
-      __Pyx_AddTraceback("init rapidfuzz.distance.Hamming_cpp", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      __Pyx_AddTraceback("init rapidfuzz.utils_cpp", __pyx_clineno, __pyx_lineno, __pyx_filename);
     }
     #if !CYTHON_USE_MODULE_STATE
     Py_CLEAR(__pyx_m);
     #endif
   } else if (!PyErr_Occurred()) {
-    PyErr_SetString(PyExc_ImportError, "init rapidfuzz.distance.Hamming_cpp");
+    PyErr_SetString(PyExc_ImportError, "init rapidfuzz.utils_cpp");
   }
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   return (__pyx_m != NULL) ? 0 : -1;
   #elif PY_MAJOR_VERSION >= 3
   return __pyx_m;
@@ -8422,113 +6323,14 @@
 end:
     Py_XDECREF(p);
     Py_XDECREF(m);
     return (__Pyx_RefNannyAPIStruct *)r;
 }
 #endif
 
-/* PyErrExceptionMatches */
-#if CYTHON_FAST_THREAD_STATE
-static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
-    Py_ssize_t i, n;
-    n = PyTuple_GET_SIZE(tuple);
-#if PY_MAJOR_VERSION >= 3
-    for (i=0; i<n; i++) {
-        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
-    }
-#endif
-    for (i=0; i<n; i++) {
-        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
-    }
-    return 0;
-}
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
-    PyObject *exc_type = tstate->curexc_type;
-    if (exc_type == err) return 1;
-    if (unlikely(!exc_type)) return 0;
-    if (unlikely(PyTuple_Check(err)))
-        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
-    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
-}
-#endif
-
-/* PyErrFetchRestore */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    tmp_type = tstate->curexc_type;
-    tmp_value = tstate->curexc_value;
-    tmp_tb = tstate->curexc_traceback;
-    tstate->curexc_type = type;
-    tstate->curexc_value = value;
-    tstate->curexc_traceback = tb;
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    *type = tstate->curexc_type;
-    *value = tstate->curexc_value;
-    *tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-}
-#endif
-
-/* PyObjectGetAttrStr */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
-    PyTypeObject* tp = Py_TYPE(obj);
-    if (likely(tp->tp_getattro))
-        return tp->tp_getattro(obj, attr_name);
-#if PY_MAJOR_VERSION < 3
-    if (likely(tp->tp_getattr))
-        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
-#endif
-    return PyObject_GetAttr(obj, attr_name);
-}
-#endif
-
-/* PyObjectGetAttrStrNoError */
-static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
-        __Pyx_PyErr_Clear();
-}
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
-    PyObject *result;
-#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
-    PyTypeObject* tp = Py_TYPE(obj);
-    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
-        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
-    }
-#endif
-    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
-    if (unlikely(!result)) {
-        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
-    }
-    return result;
-}
-
-/* GetBuiltinName */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
-    PyObject* result = __Pyx_PyObject_GetAttrStrNoError(__pyx_b, name);
-    if (unlikely(!result) && !PyErr_Occurred()) {
-        PyErr_Format(PyExc_NameError,
-#if PY_MAJOR_VERSION >= 3
-            "name '%U' is not defined", name);
-#else
-            "name '%.200s' is not defined", PyString_AS_STRING(name));
-#endif
-    }
-    return result;
-}
-
 /* TupleAndListFromArray */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE void __Pyx_copy_object_array(PyObject *const *CYTHON_RESTRICT src, PyObject** CYTHON_RESTRICT dest, Py_ssize_t length) {
     PyObject *v;
     Py_ssize_t i;
     for (i = 0; i < length; i++) {
         v = dest[i] = src[i];
@@ -8728,40 +6530,14 @@
             return kwvalues[i];
         }
     }
     return NULL;  // not found (no exception set)
 }
 #endif
 
-/* RaiseArgTupleInvalid */
-static void __Pyx_RaiseArgtupleInvalid(
-    const char* func_name,
-    int exact,
-    Py_ssize_t num_min,
-    Py_ssize_t num_max,
-    Py_ssize_t num_found)
-{
-    Py_ssize_t num_expected;
-    const char *more_or_less;
-    if (num_found < num_min) {
-        num_expected = num_min;
-        more_or_less = "at least";
-    } else {
-        num_expected = num_max;
-        more_or_less = "at most";
-    }
-    if (exact) {
-        more_or_less = "exactly";
-    }
-    PyErr_Format(PyExc_TypeError,
-                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
-                 func_name, more_or_less, num_expected,
-                 (num_expected == 1) ? "" : "s", num_found);
-}
-
 /* RaiseDoubleKeywords */
 static void __Pyx_RaiseDoubleKeywordsError(
     const char* func_name,
     PyObject* kw_name)
 {
     PyErr_Format(PyExc_TypeError,
         #if PY_MAJOR_VERSION >= 3
@@ -8884,14 +6660,64 @@
         "%s() got an unexpected keyword argument '%U'",
         function_name, key);
     #endif
 bad:
     return -1;
 }
 
+/* RaiseArgTupleInvalid */
+static void __Pyx_RaiseArgtupleInvalid(
+    const char* func_name,
+    int exact,
+    Py_ssize_t num_min,
+    Py_ssize_t num_max,
+    Py_ssize_t num_found)
+{
+    Py_ssize_t num_expected;
+    const char *more_or_less;
+    if (num_found < num_min) {
+        num_expected = num_min;
+        more_or_less = "at least";
+    } else {
+        num_expected = num_max;
+        more_or_less = "at most";
+    }
+    if (exact) {
+        more_or_less = "exactly";
+    }
+    PyErr_Format(PyExc_TypeError,
+                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
+                 func_name, more_or_less, num_expected,
+                 (num_expected == 1) ? "" : "s", num_found);
+}
+
+/* PyErrFetchRestore */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    tmp_type = tstate->curexc_type;
+    tmp_value = tstate->curexc_value;
+    tmp_tb = tstate->curexc_traceback;
+    tstate->curexc_type = type;
+    tstate->curexc_value = value;
+    tstate->curexc_traceback = tb;
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+}
+static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+    *type = tstate->curexc_type;
+    *value = tstate->curexc_value;
+    *tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+}
+#endif
+
 /* Profile */
 #if CYTHON_PROFILE
 static int __Pyx_TraceSetupAndCall(PyCodeObject** code,
                                    PyFrameObject** frame,
                                    PyThreadState* tstate,
                                    const char *funcname,
                                    const char *srcfile,
@@ -8974,345 +6800,14 @@
     Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
 #endif
     return py_code;
 }
 #endif
 
-/* PyObjectCall */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
-    PyObject *result;
-    ternaryfunc call = Py_TYPE(func)->tp_call;
-    if (unlikely(!call))
-        return PyObject_Call(func, arg, kw);
-    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
-        return NULL;
-    result = (*call)(func, arg, kw);
-    Py_LeaveRecursiveCall();
-    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
-        PyErr_SetString(
-            PyExc_SystemError,
-            "NULL result without error in PyObject_Call");
-    }
-    return result;
-}
-#endif
-
-/* RaiseException */
-#if PY_MAJOR_VERSION < 3
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
-    __Pyx_PyThreadState_declare
-    CYTHON_UNUSED_VAR(cause);
-    Py_XINCREF(type);
-    if (!value || value == Py_None)
-        value = NULL;
-    else
-        Py_INCREF(value);
-    if (!tb || tb == Py_None)
-        tb = NULL;
-    else {
-        Py_INCREF(tb);
-        if (!PyTraceBack_Check(tb)) {
-            PyErr_SetString(PyExc_TypeError,
-                "raise: arg 3 must be a traceback or None");
-            goto raise_error;
-        }
-    }
-    if (PyType_Check(type)) {
-#if CYTHON_COMPILING_IN_PYPY
-        if (!value) {
-            Py_INCREF(Py_None);
-            value = Py_None;
-        }
-#endif
-        PyErr_NormalizeException(&type, &value, &tb);
-    } else {
-        if (value) {
-            PyErr_SetString(PyExc_TypeError,
-                "instance exception may not have a separate value");
-            goto raise_error;
-        }
-        value = type;
-        type = (PyObject*) Py_TYPE(type);
-        Py_INCREF(type);
-        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
-            PyErr_SetString(PyExc_TypeError,
-                "raise: exception class must be a subclass of BaseException");
-            goto raise_error;
-        }
-    }
-    __Pyx_PyThreadState_assign
-    __Pyx_ErrRestore(type, value, tb);
-    return;
-raise_error:
-    Py_XDECREF(value);
-    Py_XDECREF(type);
-    Py_XDECREF(tb);
-    return;
-}
-#else
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
-    PyObject* owned_instance = NULL;
-    if (tb == Py_None) {
-        tb = 0;
-    } else if (tb && !PyTraceBack_Check(tb)) {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: arg 3 must be a traceback or None");
-        goto bad;
-    }
-    if (value == Py_None)
-        value = 0;
-    if (PyExceptionInstance_Check(type)) {
-        if (value) {
-            PyErr_SetString(PyExc_TypeError,
-                "instance exception may not have a separate value");
-            goto bad;
-        }
-        value = type;
-        type = (PyObject*) Py_TYPE(value);
-    } else if (PyExceptionClass_Check(type)) {
-        PyObject *instance_class = NULL;
-        if (value && PyExceptionInstance_Check(value)) {
-            instance_class = (PyObject*) Py_TYPE(value);
-            if (instance_class != type) {
-                int is_subclass = PyObject_IsSubclass(instance_class, type);
-                if (!is_subclass) {
-                    instance_class = NULL;
-                } else if (unlikely(is_subclass == -1)) {
-                    goto bad;
-                } else {
-                    type = instance_class;
-                }
-            }
-        }
-        if (!instance_class) {
-            PyObject *args;
-            if (!value)
-                args = PyTuple_New(0);
-            else if (PyTuple_Check(value)) {
-                Py_INCREF(value);
-                args = value;
-            } else
-                args = PyTuple_Pack(1, value);
-            if (!args)
-                goto bad;
-            owned_instance = PyObject_Call(type, args, NULL);
-            Py_DECREF(args);
-            if (!owned_instance)
-                goto bad;
-            value = owned_instance;
-            if (!PyExceptionInstance_Check(value)) {
-                PyErr_Format(PyExc_TypeError,
-                             "calling %R should have returned an instance of "
-                             "BaseException, not %R",
-                             type, Py_TYPE(value));
-                goto bad;
-            }
-        }
-    } else {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: exception class must be a subclass of BaseException");
-        goto bad;
-    }
-    if (cause) {
-        PyObject *fixed_cause;
-        if (cause == Py_None) {
-            fixed_cause = NULL;
-        } else if (PyExceptionClass_Check(cause)) {
-            fixed_cause = PyObject_CallObject(cause, NULL);
-            if (fixed_cause == NULL)
-                goto bad;
-        } else if (PyExceptionInstance_Check(cause)) {
-            fixed_cause = cause;
-            Py_INCREF(fixed_cause);
-        } else {
-            PyErr_SetString(PyExc_TypeError,
-                            "exception causes must derive from "
-                            "BaseException");
-            goto bad;
-        }
-        PyException_SetCause(value, fixed_cause);
-    }
-    PyErr_SetObject(type, value);
-    if (tb) {
-#if CYTHON_COMPILING_IN_PYPY ||  CYTHON_COMPILING_IN_LIMITED_API
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
-        PyThreadState *tstate = __Pyx_PyThreadState_Current;
-        PyObject* tmp_tb = tstate->curexc_traceback;
-        if (tb != tmp_tb) {
-            Py_INCREF(tb);
-            tstate->curexc_traceback = tb;
-            Py_XDECREF(tmp_tb);
-        }
-#endif
-    }
-bad:
-    Py_XDECREF(owned_instance);
-    return;
-}
-#endif
-
-/* KeywordStringCheck */
-static int __Pyx_CheckKeywordStrings(
-    PyObject *kw,
-    const char* function_name,
-    int kw_allowed)
-{
-    PyObject* key = 0;
-    Py_ssize_t pos = 0;
-#if CYTHON_COMPILING_IN_PYPY
-    if (!kw_allowed && PyDict_Next(kw, &pos, &key, 0))
-        goto invalid_keyword;
-    return 1;
-#else
-    if (CYTHON_METH_FASTCALL && likely(PyTuple_Check(kw))) {
-        if (unlikely(PyTuple_GET_SIZE(kw) == 0))
-            return 1;
-        if (!kw_allowed) {
-            key = PyTuple_GET_ITEM(kw, 0);
-            goto invalid_keyword;
-        }
-#if PY_VERSION_HEX < 0x03090000
-        for (pos = 0; pos < PyTuple_GET_SIZE(kw); pos++) {
-            key = PyTuple_GET_ITEM(kw, pos);
-            if (unlikely(!PyUnicode_Check(key)))
-                goto invalid_keyword_type;
-        }
-#endif
-        return 1;
-    }
-    while (PyDict_Next(kw, &pos, &key, 0)) {
-        #if PY_MAJOR_VERSION < 3
-        if (unlikely(!PyString_Check(key)))
-        #endif
-            if (unlikely(!PyUnicode_Check(key)))
-                goto invalid_keyword_type;
-    }
-    if (!kw_allowed && unlikely(key))
-        goto invalid_keyword;
-    return 1;
-invalid_keyword_type:
-    PyErr_Format(PyExc_TypeError,
-        "%.200s() keywords must be strings", function_name);
-    return 0;
-#endif
-invalid_keyword:
-    #if PY_MAJOR_VERSION < 3
-    PyErr_Format(PyExc_TypeError,
-        "%.200s() got an unexpected keyword argument '%.200s'",
-        function_name, PyString_AsString(key));
-    #else
-    PyErr_Format(PyExc_TypeError,
-        "%s() got an unexpected keyword argument '%U'",
-        function_name, key);
-    #endif
-    return 0;
-}
-
-/* GetItemInt */
-static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
-    PyObject *r;
-    if (unlikely(!j)) return NULL;
-    r = PyObject_GetItem(o, j);
-    Py_DECREF(j);
-    return r;
-}
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
-                                                              CYTHON_NCP_UNUSED int wraparound,
-                                                              CYTHON_NCP_UNUSED int boundscheck) {
-#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    Py_ssize_t wrapped_i = i;
-    if (wraparound & unlikely(i < 0)) {
-        wrapped_i += PyList_GET_SIZE(o);
-    }
-    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyList_GET_SIZE(o)))) {
-        PyObject *r = PyList_GET_ITEM(o, wrapped_i);
-        Py_INCREF(r);
-        return r;
-    }
-    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
-#else
-    return PySequence_GetItem(o, i);
-#endif
-}
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
-                                                              CYTHON_NCP_UNUSED int wraparound,
-                                                              CYTHON_NCP_UNUSED int boundscheck) {
-#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    Py_ssize_t wrapped_i = i;
-    if (wraparound & unlikely(i < 0)) {
-        wrapped_i += PyTuple_GET_SIZE(o);
-    }
-    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyTuple_GET_SIZE(o)))) {
-        PyObject *r = PyTuple_GET_ITEM(o, wrapped_i);
-        Py_INCREF(r);
-        return r;
-    }
-    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
-#else
-    return PySequence_GetItem(o, i);
-#endif
-}
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int is_list,
-                                                     CYTHON_NCP_UNUSED int wraparound,
-                                                     CYTHON_NCP_UNUSED int boundscheck) {
-#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
-    if (is_list || PyList_CheckExact(o)) {
-        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
-        if ((!boundscheck) || (likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o))))) {
-            PyObject *r = PyList_GET_ITEM(o, n);
-            Py_INCREF(r);
-            return r;
-        }
-    }
-    else if (PyTuple_CheckExact(o)) {
-        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
-        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyTuple_GET_SIZE(o)))) {
-            PyObject *r = PyTuple_GET_ITEM(o, n);
-            Py_INCREF(r);
-            return r;
-        }
-    } else {
-        PyMappingMethods *mm = Py_TYPE(o)->tp_as_mapping;
-        PySequenceMethods *sm = Py_TYPE(o)->tp_as_sequence;
-        if (mm && mm->mp_subscript) {
-            PyObject *r, *key = PyInt_FromSsize_t(i);
-            if (unlikely(!key)) return NULL;
-            r = mm->mp_subscript(o, key);
-            Py_DECREF(key);
-            return r;
-        }
-        if (likely(sm && sm->sq_item)) {
-            if (wraparound && unlikely(i < 0) && likely(sm->sq_length)) {
-                Py_ssize_t l = sm->sq_length(o);
-                if (likely(l >= 0)) {
-                    i += l;
-                } else {
-                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
-                        return NULL;
-                    PyErr_Clear();
-                }
-            }
-            return sm->sq_item(o, i);
-        }
-    }
-#else
-    if (is_list || PySequence_Check(o)) {
-        return PySequence_GetItem(o, i);
-    }
-#endif
-    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
-}
-
 /* GetTopmostException */
 #if CYTHON_USE_EXC_INFO_STACK
 static _PyErr_StackItem *
 __Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
 {
     _PyErr_StackItem *exc_info = tstate->exc_info;
     while ((exc_info->exc_value == NULL || exc_info->exc_value == Py_None) &&
@@ -9470,14 +6965,184 @@
     *tb = 0;
     Py_XDECREF(local_type);
     Py_XDECREF(local_value);
     Py_XDECREF(local_tb);
     return -1;
 }
 
+/* PyErrExceptionMatches */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
+    Py_ssize_t i, n;
+    n = PyTuple_GET_SIZE(tuple);
+#if PY_MAJOR_VERSION >= 3
+    for (i=0; i<n; i++) {
+        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
+    }
+#endif
+    for (i=0; i<n; i++) {
+        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
+    }
+    return 0;
+}
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
+    PyObject *exc_type = tstate->curexc_type;
+    if (exc_type == err) return 1;
+    if (unlikely(!exc_type)) return 0;
+    if (unlikely(PyTuple_Check(err)))
+        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
+    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
+}
+#endif
+
+/* PyObjectGetAttrStr */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro))
+        return tp->tp_getattro(obj, attr_name);
+#if PY_MAJOR_VERSION < 3
+    if (likely(tp->tp_getattr))
+        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
+#endif
+    return PyObject_GetAttr(obj, attr_name);
+}
+#endif
+
+/* PyObjectGetAttrStrNoError */
+static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
+        __Pyx_PyErr_Clear();
+}
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
+    PyObject *result;
+#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
+        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
+    }
+#endif
+    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
+    if (unlikely(!result)) {
+        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
+    }
+    return result;
+}
+
+/* GetBuiltinName */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
+    PyObject* result = __Pyx_PyObject_GetAttrStrNoError(__pyx_b, name);
+    if (unlikely(!result) && !PyErr_Occurred()) {
+        PyErr_Format(PyExc_NameError,
+#if PY_MAJOR_VERSION >= 3
+            "name '%U' is not defined", name);
+#else
+            "name '%.200s' is not defined", PyString_AS_STRING(name));
+#endif
+    }
+    return result;
+}
+
+/* GetItemInt */
+static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
+    PyObject *r;
+    if (unlikely(!j)) return NULL;
+    r = PyObject_GetItem(o, j);
+    Py_DECREF(j);
+    return r;
+}
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
+                                                              CYTHON_NCP_UNUSED int wraparound,
+                                                              CYTHON_NCP_UNUSED int boundscheck) {
+#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    Py_ssize_t wrapped_i = i;
+    if (wraparound & unlikely(i < 0)) {
+        wrapped_i += PyList_GET_SIZE(o);
+    }
+    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyList_GET_SIZE(o)))) {
+        PyObject *r = PyList_GET_ITEM(o, wrapped_i);
+        Py_INCREF(r);
+        return r;
+    }
+    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
+#else
+    return PySequence_GetItem(o, i);
+#endif
+}
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
+                                                              CYTHON_NCP_UNUSED int wraparound,
+                                                              CYTHON_NCP_UNUSED int boundscheck) {
+#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    Py_ssize_t wrapped_i = i;
+    if (wraparound & unlikely(i < 0)) {
+        wrapped_i += PyTuple_GET_SIZE(o);
+    }
+    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyTuple_GET_SIZE(o)))) {
+        PyObject *r = PyTuple_GET_ITEM(o, wrapped_i);
+        Py_INCREF(r);
+        return r;
+    }
+    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
+#else
+    return PySequence_GetItem(o, i);
+#endif
+}
+static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int is_list,
+                                                     CYTHON_NCP_UNUSED int wraparound,
+                                                     CYTHON_NCP_UNUSED int boundscheck) {
+#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
+    if (is_list || PyList_CheckExact(o)) {
+        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
+        if ((!boundscheck) || (likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o))))) {
+            PyObject *r = PyList_GET_ITEM(o, n);
+            Py_INCREF(r);
+            return r;
+        }
+    }
+    else if (PyTuple_CheckExact(o)) {
+        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
+        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyTuple_GET_SIZE(o)))) {
+            PyObject *r = PyTuple_GET_ITEM(o, n);
+            Py_INCREF(r);
+            return r;
+        }
+    } else {
+        PyMappingMethods *mm = Py_TYPE(o)->tp_as_mapping;
+        PySequenceMethods *sm = Py_TYPE(o)->tp_as_sequence;
+        if (mm && mm->mp_subscript) {
+            PyObject *r, *key = PyInt_FromSsize_t(i);
+            if (unlikely(!key)) return NULL;
+            r = mm->mp_subscript(o, key);
+            Py_DECREF(key);
+            return r;
+        }
+        if (likely(sm && sm->sq_item)) {
+            if (wraparound && unlikely(i < 0) && likely(sm->sq_length)) {
+                Py_ssize_t l = sm->sq_length(o);
+                if (likely(l >= 0)) {
+                    i += l;
+                } else {
+                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
+                        return NULL;
+                    PyErr_Clear();
+                }
+            }
+            return sm->sq_item(o, i);
+        }
+    }
+#else
+    if (is_list || PySequence_Check(o)) {
+        return PySequence_GetItem(o, i);
+    }
+#endif
+    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
+}
+
 /* SwapException */
 #if CYTHON_FAST_THREAD_STATE
 static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
     PyObject *tmp_type, *tmp_value, *tmp_tb;
   #if CYTHON_USE_EXC_INFO_STACK && PY_VERSION_HEX >= 0x030B00a4
     _PyErr_StackItem *exc_info = tstate->exc_info;
     tmp_value = exc_info->exc_value;
@@ -9845,14 +7510,34 @@
     Py_XDECREF(kwtuple);
 done:
     Py_LeaveRecursiveCall();
     return result;
 }
 #endif
 
+/* PyObjectCall */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
+    PyObject *result;
+    ternaryfunc call = Py_TYPE(func)->tp_call;
+    if (unlikely(!call))
+        return PyObject_Call(func, arg, kw);
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
+        return NULL;
+    result = (*call)(func, arg, kw);
+    Py_LeaveRecursiveCall();
+    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
+        PyErr_SetString(
+            PyExc_SystemError,
+            "NULL result without error in PyObject_Call");
+    }
+    return result;
+}
+#endif
+
 /* PyObjectCallMethO */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
     PyObject *self, *result;
     PyCFunction cfunc;
     cfunc = PyCFunction_GET_FUNCTION(func);
     self = PyCFunction_GET_SELF(func);
@@ -9948,14 +7633,173 @@
 
 /* PyObjectCallOneArg */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
     PyObject *args[2] = {NULL, arg};
     return __Pyx_PyObject_FastCall(func, args+1, 1 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
 }
 
+/* RaiseException */
+#if PY_MAJOR_VERSION < 3
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
+    __Pyx_PyThreadState_declare
+    CYTHON_UNUSED_VAR(cause);
+    Py_XINCREF(type);
+    if (!value || value == Py_None)
+        value = NULL;
+    else
+        Py_INCREF(value);
+    if (!tb || tb == Py_None)
+        tb = NULL;
+    else {
+        Py_INCREF(tb);
+        if (!PyTraceBack_Check(tb)) {
+            PyErr_SetString(PyExc_TypeError,
+                "raise: arg 3 must be a traceback or None");
+            goto raise_error;
+        }
+    }
+    if (PyType_Check(type)) {
+#if CYTHON_COMPILING_IN_PYPY
+        if (!value) {
+            Py_INCREF(Py_None);
+            value = Py_None;
+        }
+#endif
+        PyErr_NormalizeException(&type, &value, &tb);
+    } else {
+        if (value) {
+            PyErr_SetString(PyExc_TypeError,
+                "instance exception may not have a separate value");
+            goto raise_error;
+        }
+        value = type;
+        type = (PyObject*) Py_TYPE(type);
+        Py_INCREF(type);
+        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
+            PyErr_SetString(PyExc_TypeError,
+                "raise: exception class must be a subclass of BaseException");
+            goto raise_error;
+        }
+    }
+    __Pyx_PyThreadState_assign
+    __Pyx_ErrRestore(type, value, tb);
+    return;
+raise_error:
+    Py_XDECREF(value);
+    Py_XDECREF(type);
+    Py_XDECREF(tb);
+    return;
+}
+#else
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
+    PyObject* owned_instance = NULL;
+    if (tb == Py_None) {
+        tb = 0;
+    } else if (tb && !PyTraceBack_Check(tb)) {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: arg 3 must be a traceback or None");
+        goto bad;
+    }
+    if (value == Py_None)
+        value = 0;
+    if (PyExceptionInstance_Check(type)) {
+        if (value) {
+            PyErr_SetString(PyExc_TypeError,
+                "instance exception may not have a separate value");
+            goto bad;
+        }
+        value = type;
+        type = (PyObject*) Py_TYPE(value);
+    } else if (PyExceptionClass_Check(type)) {
+        PyObject *instance_class = NULL;
+        if (value && PyExceptionInstance_Check(value)) {
+            instance_class = (PyObject*) Py_TYPE(value);
+            if (instance_class != type) {
+                int is_subclass = PyObject_IsSubclass(instance_class, type);
+                if (!is_subclass) {
+                    instance_class = NULL;
+                } else if (unlikely(is_subclass == -1)) {
+                    goto bad;
+                } else {
+                    type = instance_class;
+                }
+            }
+        }
+        if (!instance_class) {
+            PyObject *args;
+            if (!value)
+                args = PyTuple_New(0);
+            else if (PyTuple_Check(value)) {
+                Py_INCREF(value);
+                args = value;
+            } else
+                args = PyTuple_Pack(1, value);
+            if (!args)
+                goto bad;
+            owned_instance = PyObject_Call(type, args, NULL);
+            Py_DECREF(args);
+            if (!owned_instance)
+                goto bad;
+            value = owned_instance;
+            if (!PyExceptionInstance_Check(value)) {
+                PyErr_Format(PyExc_TypeError,
+                             "calling %R should have returned an instance of "
+                             "BaseException, not %R",
+                             type, Py_TYPE(value));
+                goto bad;
+            }
+        }
+    } else {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: exception class must be a subclass of BaseException");
+        goto bad;
+    }
+    if (cause) {
+        PyObject *fixed_cause;
+        if (cause == Py_None) {
+            fixed_cause = NULL;
+        } else if (PyExceptionClass_Check(cause)) {
+            fixed_cause = PyObject_CallObject(cause, NULL);
+            if (fixed_cause == NULL)
+                goto bad;
+        } else if (PyExceptionInstance_Check(cause)) {
+            fixed_cause = cause;
+            Py_INCREF(fixed_cause);
+        } else {
+            PyErr_SetString(PyExc_TypeError,
+                            "exception causes must derive from "
+                            "BaseException");
+            goto bad;
+        }
+        PyException_SetCause(value, fixed_cause);
+    }
+    PyErr_SetObject(type, value);
+    if (tb) {
+#if CYTHON_COMPILING_IN_PYPY ||  CYTHON_COMPILING_IN_LIMITED_API
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
+#else
+        PyThreadState *tstate = __Pyx_PyThreadState_Current;
+        PyObject* tmp_tb = tstate->curexc_traceback;
+        if (tb != tmp_tb) {
+            Py_INCREF(tb);
+            tstate->curexc_traceback = tb;
+            Py_XDECREF(tmp_tb);
+        }
+#endif
+    }
+bad:
+    Py_XDECREF(owned_instance);
+    return;
+}
+#endif
+
 /* GetAttr3 */
 static PyObject *__Pyx_GetAttr3Default(PyObject *d) {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         return NULL;
     __Pyx_PyErr_Clear();
@@ -10239,15 +8083,15 @@
         PyObject* module_dot = 0;
         PyObject* full_name = 0;
         PyErr_Clear();
         module_name_str = PyModule_GetName(module);
         if (unlikely(!module_name_str)) { goto modbad; }
         module_name = PyUnicode_FromString(module_name_str);
         if (unlikely(!module_name)) { goto modbad; }
-        module_dot = PyUnicode_Concat(module_name, __pyx_kp_u__12);
+        module_dot = PyUnicode_Concat(module_name, __pyx_kp_u__4);
         if (unlikely(!module_dot)) { goto modbad; }
         full_name = PyUnicode_Concat(module_dot, name);
         if (unlikely(!full_name)) { goto modbad; }
         #if PY_VERSION_HEX < 0x030700A1 || (CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM  < 0x07030400)
         {
             PyObject *modules = PyImport_GetModuleDict();
             if (unlikely(!modules))
@@ -11626,36 +9470,14 @@
     PyTraceBack_Here(py_frame);
 bad:
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
 #endif
 
-/* CIntFromPyVerify */
-#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
-    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
-#define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
-    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
-#define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
-    {\
-        func_type value = func_value;\
-        if (sizeof(target_type) < sizeof(func_type)) {\
-            if (unlikely(value != (func_type) (target_type) value)) {\
-                func_type zero = 0;\
-                if (exc && unlikely(value == (func_type)-1 && PyErr_Occurred()))\
-                    return (target_type) -1;\
-                if (is_unsigned && unlikely(value < zero))\
-                    goto raise_neg_overflow;\
-                else\
-                    goto raise_overflow;\
-            }\
-        }\
-        return (target_type) value;\
-    }
-
 /* UnicodeAsUCS4 */
 static CYTHON_INLINE Py_UCS4 __Pyx_PyUnicode_AsPy_UCS4(PyObject* x) {
    Py_ssize_t length;
    #if CYTHON_PEP393_ENABLED
    length = PyUnicode_GET_LENGTH(x);
    if (likely(length == 1)) {
        return PyUnicode_READ_CHAR(x, 0);
@@ -11679,14 +9501,57 @@
    #endif
    PyErr_Format(PyExc_ValueError,
                 "only single character unicode strings can be converted to Py_UCS4, "
                 "got length %" CYTHON_FORMAT_SSIZE_T "d", length);
    return (Py_UCS4)-1;
 }
 
+/* CIntFromPyVerify */
+#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
+    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
+#define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
+    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
+#define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
+    {\
+        func_type value = func_value;\
+        if (sizeof(target_type) < sizeof(func_type)) {\
+            if (unlikely(value != (func_type) (target_type) value)) {\
+                func_type zero = 0;\
+                if (exc && unlikely(value == (func_type)-1 && PyErr_Occurred()))\
+                    return (target_type) -1;\
+                if (is_unsigned && unlikely(value < zero))\
+                    goto raise_neg_overflow;\
+                else\
+                    goto raise_overflow;\
+            }\
+        }\
+        return (target_type) value;\
+    }
+
+/* ObjectAsUCS4 */
+static Py_UCS4 __Pyx__PyObject_AsPy_UCS4_raise_error(long ival) {
+   if (ival < 0) {
+       if (!PyErr_Occurred())
+           PyErr_SetString(PyExc_OverflowError,
+                           "cannot convert negative value to Py_UCS4");
+   } else {
+       PyErr_SetString(PyExc_OverflowError,
+                       "value too large to convert to Py_UCS4");
+   }
+   return (Py_UCS4)-1;
+}
+static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject* x) {
+   long ival;
+   ival = __Pyx_PyInt_As_long(x);
+   if (unlikely(!__Pyx_is_valid_index(ival, 1114111 + 1))) {
+       return __Pyx__PyObject_AsPy_UCS4_raise_error(ival);
+   }
+   return (Py_UCS4)ival;
+}
+
 /* CIntToPy */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int64_t(int64_t value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int64_t neg_one = (int64_t) -1, const_zero = (int64_t) 0;
@@ -12109,45 +9974,24 @@
     return (uint64_t) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to uint64_t");
     return (uint64_t) -1;
 }
 
-/* ObjectAsUCS4 */
-static Py_UCS4 __Pyx__PyObject_AsPy_UCS4_raise_error(long ival) {
-   if (ival < 0) {
-       if (!PyErr_Occurred())
-           PyErr_SetString(PyExc_OverflowError,
-                           "cannot convert negative value to Py_UCS4");
-   } else {
-       PyErr_SetString(PyExc_OverflowError,
-                       "value too large to convert to Py_UCS4");
-   }
-   return (Py_UCS4)-1;
-}
-static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject* x) {
-   long ival;
-   ival = __Pyx_PyInt_As_long(x);
-   if (unlikely(!__Pyx_is_valid_index(ival, 1114111 + 1))) {
-       return __Pyx__PyObject_AsPy_UCS4_raise_error(ival);
-   }
-   return (Py_UCS4)ival;
-}
-
 /* FormatTypeName */
 #if CYTHON_COMPILING_IN_LIMITED_API
 static __Pyx_TypeName
 __Pyx_PyType_GetName(PyTypeObject* tp)
 {
     PyObject *name = __Pyx_PyObject_GetAttrStr((PyObject *)tp,
                                                __pyx_n_s_name);
     if (unlikely(name == NULL) || unlikely(!PyUnicode_Check(name))) {
         PyErr_Clear();
-        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__16));
+        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__6));
     }
     return name;
 }
 #endif
 
 /* CIntToPy */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming_cpp.pyx` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/Indel_py.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,84 +1,79 @@
-# distutils: language=c++
-# cython: language_level=3, binding=True, linetrace=True
+# SPDX-License-Identifier: MIT
+# Copyright (C) 2022 Max Bachmann
 
-from rapidfuzz_capi cimport (
-    RF_String, RF_Scorer, RF_Kwargs, RF_ScorerFunc, RF_Preprocess, RF_ScorerFlags,
-    RF_SCORER_FLAG_RESULT_F64, RF_SCORER_FLAG_RESULT_I64, RF_SCORER_FLAG_SYMMETRIC
+from .LCSseq_py import (
+    similarity as lcs_seq_similarity,
+    _block_similarity as lcs_seq_block_similarity,
 )
 
-# required for preprocess_strings
-from array import array
-from cpp_common cimport RF_StringWrapper, preprocess_strings, NoKwargsInit, CreateScorerContext
-from libc.stdint cimport INT64_MAX, int64_t
-
-from libcpp cimport bool
-from cpython.pycapsule cimport PyCapsule_New, PyCapsule_IsValid, PyCapsule_GetPointer
-from cython.operator cimport dereference
-
-cdef extern from "edit_based.hpp":
-    double hamming_normalized_distance_func(  const RF_String&, const RF_String&, double) nogil except +
-    int64_t hamming_distance_func(            const RF_String&, const RF_String&, int64_t) nogil except +
-    double hamming_normalized_similarity_func(const RF_String&, const RF_String&, double) nogil except +
-    int64_t hamming_similarity_func(          const RF_String&, const RF_String&, int64_t) nogil except +
-
-    bool HammingDistanceInit(            RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
-    bool HammingNormalizedDistanceInit(  RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
-    bool HammingSimilarityInit(          RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
-    bool HammingNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
 
 def distance(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates the Hamming distance between two strings.
-    The hamming distance is defined as the number of positions
-    where the two strings differ. It describes the minimum
-    amount of substitutions required to transform s1 into s2.
+    Calculates the minimum number of insertions and deletions
+    required to change one sequence into the other. This is equivalent to the
+    Levenshtein distance with a substitution weight of 2.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
-    score_cutoff : int or None, optional
+    score_cutoff : int, optional
         Maximum distance between s1 and s2, that is
         considered as a result. If the distance is bigger than score_cutoff,
         score_cutoff + 1 is returned instead. Default is None, which deactivates
         this behaviour.
 
     Returns
     -------
     distance : int
         distance between s1 and s2
 
-    Raises
-    ------
-    ValueError
-        If s1 and s2 have a different length
-    """
-    cdef int64_t c_score_cutoff = INT64_MAX if score_cutoff is None else score_cutoff
-    cdef RF_StringWrapper s1_proc, s2_proc
+    Examples
+    --------
+    Find the Indel distance between two strings:
+
+    >>> from rapidfuzz.distance import Indel
+    >>> Indel.distance("lewenstein", "levenshtein")
+    3
+
+    Setting a maximum distance allows the implementation to select
+    a more efficient implementation:
+
+    >>> Indel.distance("lewenstein", "levenshtein", score_cutoff=1)
+    2
+
+    """
+    if processor is not None:
+        s1 = processor(s1)
+        s2 = processor(s2)
+
+    maximum = len(s1) + len(s2)
+    lcs_sim = lcs_seq_similarity(s1, s2)
+    dist = maximum - 2 * lcs_sim
+    return dist if (score_cutoff is None or dist <= score_cutoff) else score_cutoff + 1
 
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
 
-    if s1 is None or s2 is None:
-        return 0
+def _block_distance(block, s1, s2, score_cutoff=None):
+    maximum = len(s1) + len(s2)
+    lcs_sim = lcs_seq_block_similarity(block, s1, s2)
+    dist = maximum - 2 * lcs_sim
+    return dist if (score_cutoff is None or dist <= score_cutoff) else score_cutoff + 1
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
 
 def similarity(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates the Hamming similarity between two strings.
-    
-    This is calculated as ``len1 - distance``.
+    Calculates the Indel similarity in the range [max, 0].
+
+    This is calculated as ``(len1 + len2) - distance``.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
@@ -89,33 +84,26 @@
         Maximum distance between s1 and s2, that is
         considered as a result. If the similarity is smaller than score_cutoff,
         0 is returned instead. Default is None, which deactivates
         this behaviour.
 
     Returns
     -------
-    distance : int
-        distance between s1 and s2
-
-    Raises
-    ------
-    ValueError
-        If s1 and s2 have a different length
-    """
-    cdef int64_t c_score_cutoff = 0 if score_cutoff is None else score_cutoff
-    cdef RF_StringWrapper s1_proc, s2_proc
-
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
-
-    if s1 is None or s2 is None:
-        return 0
+    similarity : int
+        similarity between s1 and s2
+    """
+    if processor is not None:
+        s1 = processor(s1)
+        s2 = processor(s2)
+
+    maximum = len(s1) + len(s2)
+    dist = distance(s1, s2)
+    sim = maximum - dist
+    return sim if (score_cutoff is None or sim >= score_cutoff) else 0
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
 
 def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
     """
     Calculates a normalized levenshtein similarity in the range [1, 0].
 
     This is calculated as ``distance / (len1 + len2)``.
 
@@ -134,30 +122,34 @@
         which deactivates this behaviour.
 
     Returns
     -------
     norm_dist : float
         normalized distance between s1 and s2 as a float between 0 and 1.0
     """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    if s1 is None or s2 is None:
-        return 0
-
-    cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff
+    if processor is not None:
+        s1 = processor(s1)
+        s2 = processor(s2)
+
+    maximum = len(s1) + len(s2)
+    dist = distance(s1, s2)
+    norm_dist = dist / maximum if maximum else 0
+    return norm_dist if (score_cutoff is None or norm_dist <= score_cutoff) else 1
 
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return hamming_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+def _block_normalized_distance(block, s1, s2, score_cutoff=None):
+    maximum = len(s1) + len(s2)
+    dist = _block_distance(block, s1, s2)
+    norm_dist = dist / maximum if maximum else 0
+    return norm_dist if (score_cutoff is None or norm_dist <= score_cutoff) else 1
 
 
 def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates a normalized hamming similarity in the range [0, 1].
+    Calculates a normalized indel similarity in the range [0, 1].
 
     This is calculated as ``1 - normalized_distance``
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
@@ -171,83 +163,130 @@
         For norm_sim < score_cutoff 0 is returned instead. Default is 0,
         which deactivates this behaviour.
 
     Returns
     -------
     norm_sim : float
         normalized similarity between s1 and s2 as a float between 0 and 1.0
-    """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    if s1 is None or s2 is None:
-        return 0
 
-    cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
+    Examples
+    --------
+    Find the normalized Indel similarity between two strings:
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return hamming_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+    >>> from rapidfuzz.distance import Indel
+    >>> Indel.normalized_similarity("lewenstein", "levenshtein")
+    0.85714285714285
 
+    Setting a score_cutoff allows the implementation to select
+    a more efficient implementation:
 
-cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.i64 = 0
-    dereference(scorer_flags).worst_score.i64 = INT64_MAX
-    return True
+    >>> Indel.normalized_similarity("lewenstein", "levenshtein", score_cutoff=0.9)
+    0.0
 
-cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.f64 = 0.0
-    dereference(scorer_flags).worst_score.f64 = 1.0
-    return True
+    When a different processor is used s1 and s2 do not have to be strings
 
-cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.i64 = INT64_MAX
-    dereference(scorer_flags).worst_score.i64 = 0
-    return True
+    >>> Indel.normalized_similarity(["lewenstein"], ["levenshtein"], processor=lambda s: s[0])
+    0.8571428571428572
+    """
+    if processor is not None:
+        s1 = processor(s1)
+        s2 = processor(s2)
 
-cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.f64 = 1.0
-    dereference(scorer_flags).worst_score.f64 = 0
-    return True
+    norm_dist = normalized_distance(s1, s2)
+    norm_sim = 1.0 - norm_dist
+    return norm_sim if (score_cutoff is None or norm_sim >= score_cutoff) else 0
 
-cdef RF_Scorer HammingDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingDistance, HammingDistanceInit)
-distance._RF_Scorer = PyCapsule_New(&HammingDistanceContext, NULL, NULL)
 
-cdef RF_Scorer HammingNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedDistance, HammingNormalizedDistanceInit)
-normalized_distance._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
+def _block_normalized_similarity(block, s1, s2, score_cutoff=None):
+    norm_dist = _block_normalized_distance(block, s1, s2)
+    norm_sim = 1.0 - norm_dist
+    return norm_sim if (score_cutoff is None or norm_sim >= score_cutoff) else 0
 
-cdef RF_Scorer HammingSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingSimilarity, HammingSimilarityInit)
-similarity._RF_Scorer = PyCapsule_New(&HammingSimilarityContext, NULL, NULL)
 
-cdef RF_Scorer HammingNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedSimilarity, HammingNormalizedSimilarityInit)
-normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
+def editops(s1, s2, *, processor=None):
+    """
+    Return Editops describing how to turn s1 into s2.
 
-def _GetScorerFlagsDistance(**kwargs):
-    return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
+    Parameters
+    ----------
+    s1 : Sequence[Hashable]
+        First string to compare.
+    s2 : Sequence[Hashable]
+        Second string to compare.
+    processor: callable, optional
+        Optional callable that is used to preprocess the strings before
+        comparing them. Default is None, which deactivates this behaviour.
 
+    Returns
+    -------
+    editops : Editops
+        edit operations required to turn s1 into s2
 
-def _GetScorerFlagsSimilarity(**kwargs):
-    return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
+    Notes
+    -----
+    The alignment is calculated using an algorithm of Heikki Hyyr, which is
+    described [6]_. It has a time complexity and memory usage of ``O([N/64] * M)``.
 
+    References
+    ----------
+    .. [6] Hyyr, Heikki. "A Note on Bit-Parallel Alignment Computation."
+           Stringology (2004).
 
-def _GetScorerFlagsNormalizedDistance(**kwargs):
-    return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
+    Examples
+    --------
+    >>> from rapidfuzz.distance import Indel
+    >>> for tag, src_pos, dest_pos in Indel.editops("qabxcd", "abycdf"):
+    ...    print(("%7s s1[%d] s2[%d]" % (tag, src_pos, dest_pos)))
+     delete s1[0] s2[0]
+     delete s1[3] s2[2]
+     insert s1[4] s2[2]
+     insert s1[6] s2[5]
+    """
+    raise NotImplementedError
 
 
-def _GetScorerFlagsNormalizedSimilarity(**kwargs):
-    return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
+def opcodes(s1, s2, *, processor=None):
+    """
+    Return Opcodes describing how to turn s1 into s2.
 
+    Parameters
+    ----------
+    s1 : Sequence[Hashable]
+        First string to compare.
+    s2 : Sequence[Hashable]
+        Second string to compare.
+    processor: callable, optional
+        Optional callable that is used to preprocess the strings before
+        comparing them. Default is None, which deactivates this behaviour.
 
-distance._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}
+    Returns
+    -------
+    opcodes : Opcodes
+        edit operations required to turn s1 into s2
 
-similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
+    Notes
+    -----
+    The alignment is calculated using an algorithm of Heikki Hyyr, which is
+    described [7]_. It has a time complexity and memory usage of ``O([N/64] * M)``.
 
-normalized_distance._RF_ScorerPy = {
-    "get_scorer_flags": _GetScorerFlagsNormalizedDistance
-}
+    References
+    ----------
+    .. [7] Hyyr, Heikki. "A Note on Bit-Parallel Alignment Computation."
+           Stringology (2004).
 
-normalized_similarity._RF_ScorerPy = {
-    "get_scorer_flags": _GetScorerFlagsNormalizedSimilarity
-}
+    Examples
+    --------
+    >>> from rapidfuzz.distance import Indel
+
+    >>> a = "qabxcd"
+    >>> b = "abycdf"
+    >>> for tag, i1, i2, j1, j2 in Indel.opcodes(a, b):
+    ...    print(("%7s a[%d:%d] (%s) b[%d:%d] (%s)" %
+    ...           (tag, i1, i2, a[i1:i2], j1, j2, b[j1:j2])))
+     delete a[0:1] (q) b[0:0] ()
+      equal a[1:3] (ab) b[0:2] (ab)
+     delete a[3:4] (x) b[2:2] ()
+     insert a[4:4] () b[2:3] (y)
+      equal a[4:6] (cd) b[3:5] (cd)
+     insert a[6:6] () b[5:6] (f)
+    """
+    raise NotImplementedError
```

#### encoding

```diff
@@ -1 +1 @@
-us-ascii
+utf-8
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming_py.py` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/OSA_py.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,62 +1,98 @@
 # SPDX-License-Identifier: MIT
 # Copyright (C) 2022 Max Bachmann
 
+def _osa_distance_hyrroe2003(s1, s2):
+    if not s1:
+        return len(s2)
+
+    VP = (1 << len(s1)) - 1
+    VN = 0
+    D0 = 0
+    PM_j_old = 0
+    currDist = len(s1)
+    mask = 1 << (len(s1) - 1)
+
+    block = {}
+    block_get = block.get
+    x = 1
+    for ch1 in s1:
+        block[ch1] = block_get(ch1, 0) | x
+        x <<= 1
+
+    for ch2 in s2:
+        # Step 1: Computing D0
+        PM_j = block_get(ch2, 0)
+        TR = (((~D0) & PM_j) << 1) & PM_j_old
+        D0 = (((PM_j & VP) + VP) ^ VP) | PM_j | VN
+        D0 = D0 | TR
+
+        # Step 2: Computing HP and HN
+        HP = VN | ~(D0 | VP)
+        HN = D0 & VP
+
+        # Step 3: Computing the value D[m,j]
+        currDist += (HP & mask) != 0
+        currDist -= (HN & mask) != 0
+
+        # Step 4: Computing Vp and VN
+        HP = (HP << 1) | 1
+        HN = HN << 1
+        VP = HN | ~(D0 | HP)
+        VN = HP & D0
+        PM_j_old = PM_j
+
+    return currDist
+
 
 def distance(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates the Hamming distance between two strings.
-    The hamming distance is defined as the number of positions
-    where the two strings differ. It describes the minimum
-    amount of substitutions required to transform s1 into s2.
+    Calculates the optimal string alignment (OSA) distance.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
-    score_cutoff : int or None, optional
+    score_cutoff : int, optional
         Maximum distance between s1 and s2, that is
         considered as a result. If the distance is bigger than score_cutoff,
         score_cutoff + 1 is returned instead. Default is None, which deactivates
         this behaviour.
 
     Returns
     -------
     distance : int
         distance between s1 and s2
 
-    Raises
-    ------
-    ValueError
-        If s1 and s2 have a different length
+    Examples
+    --------
+    Find the Damerau Levenshtein distance between two strings:
+
+    >>> from rapidfuzz.distance import DamerauLevenshtein
+    >>> DamerauLevenshtein.distance("CA", "ABC")
+    2
     """
     if processor is not None:
         s1 = processor(s1)
         s2 = processor(s2)
 
-    dist = 0
-    if len(s1) != len(s2):
-        raise ValueError("Sequences are not the same length.")
-
-    for i in range(len(s1)):
-        dist += s1[i] != s2[i]
-
+    dist = _osa_distance_hyrroe2003(s1, s2)
     return dist if (score_cutoff is None or dist <= score_cutoff) else score_cutoff + 1
 
 
 def similarity(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates the Hamming similarity between two strings.
+    Calculates the optimal string alignment (OSA) similarity in the range [max, 0].
 
-    This is calculated as ``len1 - distance``.
+    This is calculated as ``max(len1, len2) - distance``.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
@@ -67,38 +103,32 @@
         Maximum distance between s1 and s2, that is
         considered as a result. If the similarity is smaller than score_cutoff,
         0 is returned instead. Default is None, which deactivates
         this behaviour.
 
     Returns
     -------
-    distance : int
-        distance between s1 and s2
-
-    Raises
-    ------
-    ValueError
-        If s1 and s2 have a different length
+    similarity : int
+        similarity between s1 and s2
     """
     if processor is not None:
         s1 = processor(s1)
         s2 = processor(s2)
 
-    maximum = len(s1)
+    maximum = max(len(s1), len(s2))
     dist = distance(s1, s2)
     sim = maximum - dist
-
     return sim if (score_cutoff is None or sim >= score_cutoff) else 0
 
 
 def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates a normalized levenshtein similarity in the range [1, 0].
+    Calculates a normalized optimal string alignment (OSA) similarity in the range [1, 0].
 
-    This is calculated as ``distance / (len1 + len2)``.
+    This is calculated as ``distance / max(len1, len2)``.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
@@ -115,24 +145,23 @@
     norm_dist : float
         normalized distance between s1 and s2 as a float between 0 and 1.0
     """
     if processor is not None:
         s1 = processor(s1)
         s2 = processor(s2)
 
-    maximum = len(s1)
+    maximum = max(len(s1), len(s2))
     dist = distance(s1, s2)
     norm_dist = dist / maximum if maximum else 0
-
-    return norm_dist if (score_cutoff is None or norm_dist <= score_cutoff) else 1.0
+    return norm_dist if (score_cutoff is None or norm_dist <= score_cutoff) else 1
 
 
 def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Calculates a normalized hamming similarity in the range [0, 1].
+    Calculates a normalized optimal string alignment (OSA) similarity in the range [0, 1].
 
     This is calculated as ``1 - normalized_distance``
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
@@ -147,40 +176,14 @@
         which deactivates this behaviour.
 
     Returns
     -------
     norm_sim : float
         normalized similarity between s1 and s2 as a float between 0 and 1.0
     """
-    norm_dist = normalized_distance(s1, s2, processor=processor)
-    norm_sim = 1 - norm_dist
-
-    return norm_sim if (score_cutoff is None or norm_dist >= score_cutoff) else 0.0
-
-
-def _GetScorerFlagsDistance(**kwargs):
-    return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
-
-
-def _GetScorerFlagsSimilarity(**kwargs):
-    return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
-
-
-def _GetScorerFlagsNormalizedDistance(**kwargs):
-    return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
-
-
-def _GetScorerFlagsNormalizedSimilarity(**kwargs):
-    return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
-
-
-distance._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}
-
-similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
-
-normalized_distance._RF_ScorerPy = {
-    "get_scorer_flags": _GetScorerFlagsNormalizedDistance
-}
+    if processor is not None:
+        s1 = processor(s1)
+        s2 = processor(s2)
 
-normalized_similarity._RF_ScorerPy = {
-    "get_scorer_flags": _GetScorerFlagsNormalizedSimilarity
-}
+    norm_dist = normalized_distance(s1, s2)
+    norm_sim = 1.0 - norm_dist
+    return norm_sim if (score_cutoff is None or norm_sim >= score_cutoff) else 0
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/Hamming_py.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/Hamming_py.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/Indel.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/Indel.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/Indel_cpp.pyx` & `rapidfuzz-2.9.0/src/rapidfuzz/string_metric.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,378 +1,408 @@
-# distutils: language=c++
-# cython: language_level=3, binding=True, linetrace=True
+# SPDX-License-Identifier: MIT
+# Copyright (C) 2022 Max Bachmann
 
-from ._initialize_cpp import Editops
-from ._initialize_cpp cimport Editops, RfEditops
+from rapidfuzz.distance import Levenshtein, Hamming, Jaro, JaroWinkler
+import warnings
 
-from rapidfuzz_capi cimport (
-    RF_String, RF_Scorer, RF_Kwargs, RF_ScorerFunc, RF_Preprocess, RF_ScorerFlags,
-    RF_SCORER_FLAG_RESULT_F64, RF_SCORER_FLAG_RESULT_I64, RF_SCORER_FLAG_SYMMETRIC
-)
-# required for preprocess_strings
-from array import array
-from cpp_common cimport RF_StringWrapper, preprocess_strings, NoKwargsInit, CreateScorerContext
-
-from libcpp cimport bool
-from libc.stdlib cimport malloc, free
-from libc.stdint cimport INT64_MAX, uint32_t, int64_t
-from cpython.list cimport PyList_New, PyList_SET_ITEM
-from cpython.ref cimport Py_INCREF
-from cpython.pycapsule cimport PyCapsule_New, PyCapsule_IsValid, PyCapsule_GetPointer
-from cython.operator cimport dereference
-
-cdef extern from "edit_based.hpp":
-    double indel_normalized_distance_func(  const RF_String&, const RF_String&, double) nogil except +
-    int64_t indel_distance_func(            const RF_String&, const RF_String&, int64_t) nogil except +
-    double indel_normalized_similarity_func(const RF_String&, const RF_String&, double) nogil except +
-    int64_t indel_similarity_func(          const RF_String&, const RF_String&, int64_t) nogil except +
-
-    RfEditops indel_editops_func(const RF_String&, const RF_String&) nogil except +
-
-    bool IndelDistanceInit(            RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
-    bool IndelNormalizedDistanceInit(  RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
-    bool IndelSimilarityInit(          RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
-    bool IndelNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
-
-def distance(s1, s2, *, processor=None, score_cutoff=None):
-    """
-    Calculates the minimum number of insertions and deletions
-    required to change one sequence into the other. This is equivalent to the
-    Levenshtein distance with a substitution weight of 2.
+
+def levenshtein(
+    s1, s2, *, weights=(1, 1, 1), processor=None, max=None, score_cutoff=None
+):
+    """
+    Calculates the minimum number of insertions, deletions, and substitutions
+    required to change one sequence into the other according to Levenshtein with custom
+    costs for insertion, deletion and substitution
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
+    weights : Tuple[int, int, int] or None, optional
+        The weights for the three operations in the form
+        (insertion, deletion, substitution). Default is (1, 1, 1),
+        which gives all three operations a weight of 1.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
-    score_cutoff : int, optional
+    max : int or None, optional
         Maximum distance between s1 and s2, that is
-        considered as a result. If the distance is bigger than score_cutoff,
-        score_cutoff + 1 is returned instead. Default is None, which deactivates
+        considered as a result. If the distance is bigger than max,
+        max + 1 is returned instead. Default is None, which deactivates
         this behaviour.
 
     Returns
     -------
     distance : int
         distance between s1 and s2
 
+    Raises
+    ------
+    ValueError
+        If unsupported weights are provided a ValueError is thrown
+
+    .. deprecated:: 2.0.0
+        Use :func:`rapidfuzz.distance.Levenshtein.distance` instead.
+        This function will be removed in v3.0.0.
+
     Examples
     --------
-    Find the Indel distance between two strings:
+    Find the Levenshtein distance between two strings:
 
-    >>> from rapidfuzz.distance import Indel
-    >>> Indel.distance("lewenstein", "levenshtein")
-    3
+    >>> from rapidfuzz.string_metric import levenshtein
+    >>> levenshtein("lewenstein", "levenshtein")
+    2
 
     Setting a maximum distance allows the implementation to select
     a more efficient implementation:
 
-    >>> Indel.distance("lewenstein", "levenshtein", score_cutoff=1)
+    >>> levenshtein("lewenstein", "levenshtein", max=1)
     2
 
-    """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    cdef int64_t c_score_cutoff = INT64_MAX if score_cutoff is None else score_cutoff
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
+    It is possible to select different weights by passing a `weight`
+    tuple.
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return indel_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
-
-
-
-def similarity(s1, s2, *, processor=None, score_cutoff=None):
+    >>> levenshtein("lewenstein", "levenshtein", weights=(1,1,2))
+    3
     """
-    Calculates the Indel similarity in the range [max, 0].
-
-    This is calculated as ``(len1 + len2) - distance``.
+    warnings.warn(
+        "This function will be remove in v3.0.0. Use rapidfuzz.distance.Levenshtein.distance instead.",
+        DeprecationWarning,
+        stacklevel=2,
+    )
+    score_cutoff = score_cutoff or max
+    return Levenshtein.distance(
+        s1, s2, weights=weights, processor=processor, score_cutoff=score_cutoff
+    )
+
+
+def levenshtein_editops(s1, s2, *, processor=None):
+    """
+    Return list of 3-tuples describing how to turn s1 into s2.
+    Each tuple is of the form (tag, src_pos, dest_pos).
+
+    The tags are strings, with these meanings:
+    'replace':  s1[src_pos] should be replaced by s2[dest_pos]
+    'delete':   s1[src_pos] should be deleted.
+    'insert':   s2[dest_pos] should be inserted at s1[src_pos].
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
-    score_cutoff : int, optional
-        Maximum distance between s1 and s2, that is
-        considered as a result. If the similarity is smaller than score_cutoff,
-        0 is returned instead. Default is None, which deactivates
-        this behaviour.
 
     Returns
     -------
-    similarity : int
-        similarity between s1 and s2
-    """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    cdef int64_t c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+    editops : list[]
+        edit operations required to turn s1 into s2
 
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
+    .. deprecated:: 2.0.0
+        Use :func:`rapidfuzz.distance.Levenshtein.editops` instead.
+        This function will be removed in v3.0.0.
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return indel_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+    Examples
+    --------
+    >>> from rapidfuzz.string_metric import levenshtein_editops
+    >>> for tag, src_pos, dest_pos in levenshtein_editops("qabxcd", "abycdf"):
+    ...    print(("%7s s1[%d] s2[%d]" % (tag, src_pos, dest_pos)))
+     delete s1[1] s2[0]
+    replace s1[3] s2[2]
+     insert s1[6] s2[5]
+    """
+    warnings.warn(
+        "This function will be remove in v3.0.0. Use rapidfuzz.distance.Levenshtein.editops instead.",
+        DeprecationWarning,
+        stacklevel=2,
+    )
+    return Levenshtein.editops(s1, s2, processor=processor).as_list()
 
 
-def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+def normalized_levenshtein(
+    s1, s2, *, weights=(1, 1, 1), processor=None, score_cutoff=None
+):
     """
-    Calculates a normalized levenshtein similarity in the range [1, 0].
-
-    This is calculated as ``distance / (len1 + len2)``.
+    Calculates a normalized levenshtein distance using custom
+    costs for insertion, deletion and substitution.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
+    weights : Tuple[int, int, int] or None, optional
+        The weights for the three operations in the form
+        (insertion, deletion, substitution). Default is (1, 1, 1),
+        which gives all three operations a weight of 1.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
     score_cutoff : float, optional
-        Optional argument for a score threshold as a float between 0 and 1.0.
-        For norm_dist > score_cutoff 1.0 is returned instead. Default is 1.0,
+        Optional argument for a score threshold as a float between 0 and 100.
+        For ratio < score_cutoff 0 is returned instead. Default is 0,
         which deactivates this behaviour.
 
     Returns
     -------
-    norm_dist : float
-        normalized distance between s1 and s2 as a float between 0 and 1.0
-    """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    if s1 is None or s2 is None:
-        return 0
+    similarity : float
+        similarity between s1 and s2 as a float between 0 and 100
 
-    cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff
+    Raises
+    ------
+    ValueError
+        If unsupported weights are provided a ValueError is thrown
+
+    .. deprecated:: 2.0.0
+        Use :func:`rapidfuzz.distance.Levenshtein.normalized_similarity` instead.
+        This function will be removed in v3.0.0.
 
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
+    See Also
+    --------
+    levenshtein : Levenshtein distance
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return indel_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+    Examples
+    --------
+    Find the normalized Levenshtein distance between two strings:
 
+    >>> from rapidfuzz.string_metric import normalized_levenshtein
+    >>> normalized_levenshtein("lewenstein", "levenshtein")
+    81.81818181818181
 
-def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
-    """
-    Calculates a normalized indel similarity in the range [0, 1].
+    Setting a score_cutoff allows the implementation to select
+    a more efficient implementation:
+
+    >>> normalized_levenshtein("lewenstein", "levenshtein", score_cutoff=85)
+    0.0
+
+    It is possible to select different weights by passing a `weight`
+    tuple.
+
+    >>> normalized_levenshtein("lewenstein", "levenshtein", weights=(1,1,2))
+    85.71428571428571
 
-    This is calculated as ``1 - normalized_distance``
+     When a different processor is used s1 and s2 do not have to be strings
+
+    >>> normalized_levenshtein(["lewenstein"], ["levenshtein"], processor=lambda s: s[0])
+    81.81818181818181
+    """
+    warnings.warn(
+        "This function will be remove in v3.0.0. Use rapidfuzz.distance.Levenshtein.normalized_similarity instead.",
+        DeprecationWarning,
+        stacklevel=2,
+    )
+    return (
+        Levenshtein.normalized_similarity(
+            s1, s2, weights=weights, processor=processor, score_cutoff=score_cutoff
+        )
+        * 100
+    )
+
+
+def hamming(s1, s2, *, processor=None, max=None, score_cutoff=None):
+    """
+    Calculates the Hamming distance between two strings.
+    The hamming distance is defined as the number of positions
+    where the two strings differ. It describes the minimum
+    amount of substitutions required to transform s1 into s2.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
-    score_cutoff : float, optional
-        Optional argument for a score threshold as a float between 0 and 1.0.
-        For norm_sim < score_cutoff 0 is returned instead. Default is 0,
-        which deactivates this behaviour.
+    max : int or None, optional
+        Maximum distance between s1 and s2, that is
+        considered as a result. If the distance is bigger than max,
+        max + 1 is returned instead. Default is None, which deactivates
+        this behaviour.
 
     Returns
     -------
-    norm_sim : float
-        normalized similarity between s1 and s2 as a float between 0 and 1.0
-
-    Examples
-    --------
-    Find the normalized Indel similarity between two strings:
-
-    >>> from rapidfuzz.distance import Indel
-    >>> Indel.normalized_similarity("lewenstein", "levenshtein")
-    0.85714285714285
-
-    Setting a score_cutoff allows the implementation to select
-    a more efficient implementation:
-
-    >>> Indel.normalized_similarity("lewenstein", "levenshtein", score_cutoff=0.9)
-    0.0
-
-    When a different processor is used s1 and s2 do not have to be strings
-
-    >>> Indel.normalized_similarity(["lewenstein"], ["levenshtein"], processor=lambda s: s[0])
-    0.8571428571428572
-    """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    if s1 is None or s2 is None:
-        return 0
-
-    cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+    distance : int
+        distance between s1 and s2
 
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
+    Raises
+    ------
+    ValueError
+        If s1 and s2 have a different length
+
+    .. deprecated:: 2.0.0
+        Use :func:`rapidfuzz.distance.Hamming.distance` instead.
+        This function will be removed in v3.0.0.
+    """
+    warnings.warn(
+        "This function will be remove in v3.0.0. Use rapidfuzz.distance.Hamming.distance instead.",
+        DeprecationWarning,
+        stacklevel=2,
+    )
+    score_cutoff = score_cutoff or max
+    return Hamming.distance(s1, s2, processor=processor, score_cutoff=score_cutoff)
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return indel_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
 
-def editops(s1, s2, *, processor=None):
+def normalized_hamming(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Return Editops describing how to turn s1 into s2.
+    Calculates a normalized hamming distance
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
+    score_cutoff : float, optional
+        Optional argument for a score threshold as a float between 0 and 100.
+        For ratio < score_cutoff 0 is returned instead. Default is 0,
+        which deactivates this behaviour.
 
     Returns
     -------
-    editops : Editops
-        edit operations required to turn s1 into s2
+    similarity : float
+        similarity between s1 and s2 as a float between 0 and 100
 
-    Notes
-    -----
-    The alignment is calculated using an algorithm of Heikki Hyyr, which is
-    described [6]_. It has a time complexity and memory usage of ``O([N/64] * M)``.
+    Raises
+    ------
+    ValueError
+        If s1 and s2 have a different length
 
-    References
-    ----------
-    .. [6] Hyyr, Heikki. "A Note on Bit-Parallel Alignment Computation."
-           Stringology (2004).
-
-    Examples
+    See Also
     --------
-    >>> from rapidfuzz.distance import Indel
-    >>> for tag, src_pos, dest_pos in Indel.editops("qabxcd", "abycdf"):
-    ...    print(("%7s s1[%d] s2[%d]" % (tag, src_pos, dest_pos)))
-     delete s1[0] s2[0]
-     delete s1[3] s2[2]
-     insert s1[4] s2[2]
-     insert s1[6] s2[5]
-    """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    cdef Editops ops = Editops.__new__(Editops)
+    hamming : Hamming distance
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    ops.editops = indel_editops_func(s1_proc.string, s2_proc.string)
-    return ops
+    .. deprecated:: 2.0.0
+        Use :func:`rapidfuzz.distance.Hamming.normalized_similarity` instead.
+        This function will be removed in v3.0.0.
+    """
+    warnings.warn(
+        "This function will be remove in v3.0.0. Use rapidfuzz.distance.Hamming.normalized_similarity instead.",
+        DeprecationWarning,
+        stacklevel=2,
+    )
+    return (
+        Hamming.normalized_similarity(
+            s1, s2, processor=processor, score_cutoff=score_cutoff
+        )
+        * 100
+    )
 
-def opcodes(s1, s2, *, processor=None):
+
+def jaro_similarity(s1, s2, *, processor=None, score_cutoff=None):
     """
-    Return Opcodes describing how to turn s1 into s2.
+    Calculates the jaro similarity
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
+    score_cutoff : float, optional
+        Optional argument for a score threshold as a float between 0 and 100.
+        For ratio < score_cutoff 0 is returned instead. Default is 0,
+        which deactivates this behaviour.
 
     Returns
     -------
-    opcodes : Opcodes
-        edit operations required to turn s1 into s2
+    similarity : float
+        similarity between s1 and s2 as a float between 0 and 100
 
-    Notes
-    -----
-    The alignment is calculated using an algorithm of Heikki Hyyr, which is
-    described [7]_. It has a time complexity and memory usage of ``O([N/64] * M)``.
+    .. deprecated:: 2.0.0
+        Use :func:`rapidfuzz.distance.Jaro.similarity` instead.
+        This function will be removed in v3.0.0.
+    """
+    warnings.warn(
+        "This function will be remove in v3.0.0. Use rapidfuzz.distance.Jaro.similarity instead.",
+        DeprecationWarning,
+        stacklevel=2,
+    )
+    return Jaro.similarity(s1, s2, processor=processor, score_cutoff=score_cutoff) * 100
+
+
+def jaro_winkler_similarity(
+    s1, s2, *, prefix_weight=0.1, processor=None, score_cutoff=None
+):
+    """
+    Calculates the jaro winkler similarity
 
-    References
+    Parameters
     ----------
-    .. [7] Hyyr, Heikki. "A Note on Bit-Parallel Alignment Computation."
-           Stringology (2004).
-
-    Examples
-    --------
-    >>> from rapidfuzz.distance import Indel
-
-    >>> a = "qabxcd"
-    >>> b = "abycdf"
-    >>> for tag, i1, i2, j1, j2 in Indel.opcodes(a, b):
-    ...    print(("%7s a[%d:%d] (%s) b[%d:%d] (%s)" %
-    ...           (tag, i1, i2, a[i1:i2], j1, j2, b[j1:j2])))
-     delete a[0:1] (q) b[0:0] ()
-      equal a[1:3] (ab) b[0:2] (ab)
-     delete a[3:4] (x) b[2:2] ()
-     insert a[4:4] () b[2:3] (y)
-      equal a[4:6] (cd) b[3:5] (cd)
-     insert a[6:6] () b[5:6] (f)
-    """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    cdef Editops ops = Editops.__new__(Editops)
-
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    ops.editops = indel_editops_func(s1_proc.string, s2_proc.string)
-    return ops.as_opcodes()
-
-
-cdef bool GetScorerFlagsIndelDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.i64 = 0
-    dereference(scorer_flags).worst_score.i64 = INT64_MAX
-    return True
-
-cdef bool GetScorerFlagsIndelNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.f64 = 0.0
-    dereference(scorer_flags).worst_score.f64 = 1
-    return True
-
-cdef bool GetScorerFlagsIndelSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.i64 = INT64_MAX
-    dereference(scorer_flags).worst_score.i64 = 0
-    return True
-
-cdef bool GetScorerFlagsIndelNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.f64 = 1.0
-    dereference(scorer_flags).worst_score.f64 = 0
-    return True
-
-cdef RF_Scorer IndelDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelDistance, IndelDistanceInit)
-distance._RF_Scorer = PyCapsule_New(&IndelDistanceContext, NULL, NULL)
+    s1 : Sequence[Hashable]
+        First string to compare.
+    s2 : Sequence[Hashable]
+        Second string to compare.
+    prefix_weight : float, optional
+        Weight used for the common prefix of the two strings.
+        Has to be between 0 and 0.25. Default is 0.1.
+    processor: callable, optional
+        Optional callable that is used to preprocess the strings before
+        comparing them. Default is None, which deactivates this behaviour.
+    score_cutoff : float, optional
+        Optional argument for a score threshold as a float between 0 and 100.
+        For ratio < score_cutoff 0 is returned instead. Default is 0,
+        which deactivates this behaviour.
 
-cdef RF_Scorer IndelNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelNormalizedDistance, IndelNormalizedDistanceInit)
-normalized_distance._RF_Scorer = PyCapsule_New(&IndelNormalizedDistanceContext, NULL, NULL)
+    Returns
+    -------
+    similarity : float
+        similarity between s1 and s2 as a float between 0 and 100
 
-cdef RF_Scorer IndelSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelSimilarity, IndelSimilarityInit)
-similarity._RF_Scorer = PyCapsule_New(&IndelSimilarityContext, NULL, NULL)
+    Raises
+    ------
+    ValueError
+        If prefix_weight is invalid
+
+    .. deprecated:: 2.0.0
+        Use :func:`rapidfuzz.distance.JaroWinkler.similarity` instead.
+        This function will be removed in v3.0.0.
+    """
+    warnings.warn(
+        "This function will be remove in v3.0.0. Use rapidfuzz.distance.JaroWinkler.similarity instead.",
+        DeprecationWarning,
+        stacklevel=2,
+    )
+    return (
+        JaroWinkler.similarity(
+            s1,
+            s2,
+            prefix_weight=prefix_weight,
+            processor=processor,
+            score_cutoff=score_cutoff,
+        )
+        * 100
+    )
 
-cdef RF_Scorer IndelNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelNormalizedSimilarity, IndelNormalizedSimilarityInit)
-normalized_similarity._RF_Scorer = PyCapsule_New(&IndelNormalizedSimilarityContext, NULL, NULL)
 
 def _GetScorerFlagsDistance(**kwargs):
     return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
 
 
 def _GetScorerFlagsSimilarity(**kwargs):
-    return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
-
-
-def _GetScorerFlagsNormalizedDistance(**kwargs):
-    return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
+    return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
 
 
-def _GetScorerFlagsNormalizedSimilarity(**kwargs):
-    return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
+levenshtein._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}
 
+normalized_levenshtein._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
 
-distance._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}
+hamming._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}
 
-similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
+normalized_hamming._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
 
-normalized_distance._RF_ScorerPy = {
-    "get_scorer_flags": _GetScorerFlagsNormalizedDistance
-}
+jaro_similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
 
-normalized_similarity._RF_ScorerPy = {
-    "get_scorer_flags": _GetScorerFlagsNormalizedSimilarity
-}
+jaro_winkler_similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
```

#### encoding

```diff
@@ -1 +1 @@
-utf-8
+us-ascii
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/Indel_py.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/Indel_py.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/LCSseq.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/LCSseq.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/LCSseq_cpp.pyx` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/Levenshtein_py.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,375 +1,404 @@
-# distutils: language=c++
-# cython: language_level=3, binding=True, linetrace=True
+# SPDX-License-Identifier: MIT
+# Copyright (C) 2022 Max Bachmann
 
-from ._initialize_cpp import Editops
-from ._initialize_cpp cimport Editops, RfEditops
+from .Indel_py import distance as indel_distance
 
-from rapidfuzz_capi cimport (
-    RF_String, RF_Scorer, RF_Kwargs, RF_ScorerFunc, RF_Preprocess, RF_ScorerFlags,
-    RF_SCORER_FLAG_RESULT_F64, RF_SCORER_FLAG_RESULT_I64, RF_SCORER_FLAG_SYMMETRIC
-)
-# required for preprocess_strings
-from array import array
-from cpp_common cimport RF_StringWrapper, preprocess_strings, NoKwargsInit, CreateScorerContext
-
-from libcpp cimport bool
-from libc.stdlib cimport malloc, free
-from libc.stdint cimport INT64_MAX, uint32_t, int64_t
-from cpython.list cimport PyList_New, PyList_SET_ITEM
-from cpython.ref cimport Py_INCREF
-from cpython.pycapsule cimport PyCapsule_New, PyCapsule_IsValid, PyCapsule_GetPointer
-from cython.operator cimport dereference
-
-cdef extern from "edit_based.hpp":
-    double lcs_seq_normalized_distance_func(  const RF_String&, const RF_String&, double) nogil except +
-    int64_t lcs_seq_distance_func(            const RF_String&, const RF_String&, int64_t) nogil except +
-    double lcs_seq_normalized_similarity_func(const RF_String&, const RF_String&, double) nogil except +
-    int64_t lcs_seq_similarity_func(          const RF_String&, const RF_String&, int64_t) nogil except +
-
-    RfEditops lcs_seq_editops_func(const RF_String&, const RF_String&) nogil except +
-
-    bool LCSseqDistanceInit(            RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
-    bool LCSseqNormalizedDistanceInit(  RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
-    bool LCSseqSimilarityInit(          RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
-    bool LCSseqNormalizedSimilarityInit(RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
 
-def distance(s1, s2, *, processor=None, score_cutoff=None):
-    """
-    Calculates the LCS distance in the range [0, max].
-
-    This is calculated as ``max(len1, len2) - similarity``.
+def _levenshtein_maximum(s1, s2, weights):
+    len1 = len(s1)
+    len2 = len(s2)
+    insert, delete, replace = weights
+
+    max_dist = len1 * delete + len2 * insert
+
+    if len1 >= len2:
+        max_dist = min(max_dist, len2 * replace + (len1 - len2) * delete)
+    else:
+        max_dist = min(max_dist, len1 * replace + (len2 - len1) * insert)
+
+    return max_dist
+
+
+def _uniform_generic(s1, s2, weights):
+    len1 = len(s1)
+    insert, delete, replace = weights
+    cache = list(range(0, (len1 + 1) * delete, delete))
+
+    for ch2 in s2:
+        temp = cache[0]
+        cache[0] += insert
+        for i in range(len1):
+            x = temp
+            if s1[i] != ch2:
+                x = min(cache[i] + delete, cache[i + 1] + insert, temp + replace)
+            temp = cache[i + 1]
+            cache[i + 1] = x
+
+    return cache[-1]
+
+
+def _uniform_distance(s1, s2):
+    if not s1:
+        return len(s2)
+
+    VP = (1 << len(s1)) - 1
+    VN = 0
+    currDist = len(s1)
+    mask = 1 << (len(s1) - 1)
+
+    block = {}
+    block_get = block.get
+    x = 1
+    for ch1 in s1:
+        block[ch1] = block_get(ch1, 0) | x
+        x <<= 1
+
+    for ch2 in s2:
+        # Step 1: Computing D0
+        PM_j = block_get(ch2, 0)
+        X = PM_j
+        D0 = (((X & VP) + VP) ^ VP) | X | VN
+        # Step 2: Computing HP and HN
+        HP = VN | ~(D0 | VP)
+        HN = D0 & VP
+        # Step 3: Computing the value D[m,j]
+        currDist += (HP & mask) != 0
+        currDist -= (HN & mask) != 0
+        # Step 4: Computing Vp and VN
+        HP = (HP << 1) | 1
+        HN = HN << 1
+        VP = HN | ~(D0 | HP)
+        VN = HP & D0
+
+    return currDist
+
+
+def distance(s1, s2, *, weights=(1, 1, 1), processor=None, score_cutoff=None):
+    """
+    Calculates the minimum number of insertions, deletions, and substitutions
+    required to change one sequence into the other according to Levenshtein with custom
+    costs for insertion, deletion and substitution
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
+    weights : Tuple[int, int, int] or None, optional
+        The weights for the three operations in the form
+        (insertion, deletion, substitution). Default is (1, 1, 1),
+        which gives all three operations a weight of 1.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
     score_cutoff : int, optional
         Maximum distance between s1 and s2, that is
         considered as a result. If the distance is bigger than score_cutoff,
         score_cutoff + 1 is returned instead. Default is None, which deactivates
         this behaviour.
 
     Returns
     -------
     distance : int
         distance between s1 and s2
 
+    Raises
+    ------
+    ValueError
+        If unsupported weights are provided a ValueError is thrown
+
     Examples
     --------
-    Find the LCS distance between two strings:
+    Find the Levenshtein distance between two strings:
 
-    >>> from rapidfuzz.distance import LCSseq
-    >>> LCSseq.distance("lewenstein", "levenshtein")
+    >>> from rapidfuzz.distance import Levenshtein
+    >>> Levenshtein.distance("lewenstein", "levenshtein")
     2
 
     Setting a maximum distance allows the implementation to select
     a more efficient implementation:
 
-    >>> LCSseq.distance("lewenstein", "levenshtein", score_cutoff=1)
+    >>> Levenshtein.distance("lewenstein", "levenshtein", score_cutoff=1)
     2
 
+    It is possible to select different weights by passing a `weight`
+    tuple.
+
+    >>> Levenshtein.distance("lewenstein", "levenshtein", weights=(1,1,2))
+    3
     """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    cdef int64_t c_score_cutoff = INT64_MAX if score_cutoff is None else score_cutoff
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
+    if processor is not None:
+        s1 = processor(s1)
+        s2 = processor(s2)
+
+    if weights == (1, 1, 1):
+        dist = _uniform_distance(s1, s2)
+    elif weights == (1, 1, 2):
+        dist = indel_distance(s1, s2)
+    else:
+        dist = _uniform_generic(s1, s2, weights)
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return lcs_seq_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+    return dist if (score_cutoff is None or dist <= score_cutoff) else score_cutoff + 1
 
 
-def similarity(s1, s2, *, processor=None, score_cutoff=None):
+def similarity(s1, s2, *, weights=(1, 1, 1), processor=None, score_cutoff=None):
     """
-    Calculates the length of the longest common subsequence
+    Calculates the levenshtein similarity in the range [max, 0] using custom
+    costs for insertion, deletion and substitution.
+
+    This is calculated as ``max - distance``, where max is the maximal possible
+    Levenshtein distance given the lengths of the sequences s1/s2 and the weights.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
+    weights : Tuple[int, int, int] or None, optional
+        The weights for the three operations in the form
+        (insertion, deletion, substitution). Default is (1, 1, 1),
+        which gives all three operations a weight of 1.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
     score_cutoff : int, optional
         Maximum distance between s1 and s2, that is
         considered as a result. If the similarity is smaller than score_cutoff,
         0 is returned instead. Default is None, which deactivates
         this behaviour.
 
     Returns
     -------
     similarity : int
         similarity between s1 and s2
-    """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    cdef int64_t c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
-
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
-
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return lcs_seq_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
-
 
-def normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+    Raises
+    ------
+    ValueError
+        If unsupported weights are provided a ValueError is thrown
+    """
+    if processor is not None:
+        s1 = processor(s1)
+        s2 = processor(s2)
+
+    maximum = _levenshtein_maximum(s1, s2, weights)
+    dist = distance(s1, s2, weights=weights)
+    sim = maximum - dist
+    return sim if (score_cutoff is None or sim >= score_cutoff) else 0
+
+
+def normalized_distance(
+    s1, s2, *, weights=(1, 1, 1), processor=None, score_cutoff=None
+):
     """
-    Calculates a normalized LCS similarity in the range [1, 0].
+    Calculates a normalized levenshtein distance in the range [1, 0] using custom
+    costs for insertion, deletion and substitution.
 
-    This is calculated as ``distance / max(len1, len2)``.
+    This is calculated as ``distance / max``, where max is the maximal possible
+    Levenshtein distance given the lengths of the sequences s1/s2 and the weights.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
+    weights : Tuple[int, int, int] or None, optional
+        The weights for the three operations in the form
+        (insertion, deletion, substitution). Default is (1, 1, 1),
+        which gives all three operations a weight of 1.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
     score_cutoff : float, optional
         Optional argument for a score threshold as a float between 0 and 1.0.
         For norm_dist > score_cutoff 1.0 is returned instead. Default is 1.0,
         which deactivates this behaviour.
 
     Returns
     -------
     norm_dist : float
-        normalized distance between s1 and s2 as a float between 0 and 1.0
-    """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    if s1 is None or s2 is None:
-        return 0
-
-    cdef double c_score_cutoff = 1.0 if score_cutoff is None else score_cutoff
+        normalized distance between s1 and s2 as a float between 1.0 and 0.0
 
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
+    Raises
+    ------
+    ValueError
+        If unsupported weights are provided a ValueError is thrown
+    """
+    if processor is not None:
+        s1 = processor(s1)
+        s2 = processor(s2)
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return lcs_seq_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+    maximum = _levenshtein_maximum(s1, s2, weights)
+    dist = distance(s1, s2, weights=weights)
+    norm_dist = dist / maximum if maximum else 0
+    return norm_dist if (score_cutoff is None or norm_dist <= score_cutoff) else 1
 
 
-def normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
+def normalized_similarity(
+    s1, s2, *, weights=(1, 1, 1), processor=None, score_cutoff=None
+):
     """
-    Calculates a normalized LCS similarity in the range [0, 1].
+    Calculates a normalized levenshtein similarity in the range [0, 1] using custom
+    costs for insertion, deletion and substitution.
 
     This is calculated as ``1 - normalized_distance``
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
+    weights : Tuple[int, int, int] or None, optional
+        The weights for the three operations in the form
+        (insertion, deletion, substitution). Default is (1, 1, 1),
+        which gives all three operations a weight of 1.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
     score_cutoff : float, optional
         Optional argument for a score threshold as a float between 0 and 1.0.
         For norm_sim < score_cutoff 0 is returned instead. Default is 0,
         which deactivates this behaviour.
 
     Returns
     -------
     norm_sim : float
         normalized similarity between s1 and s2 as a float between 0 and 1.0
 
+    Raises
+    ------
+    ValueError
+        If unsupported weights are provided a ValueError is thrown
+
     Examples
     --------
-    Find the normalized LCS similarity between two strings:
+    Find the normalized Levenshtein similarity between two strings:
 
-    >>> from rapidfuzz.distance import LCSseq
-    >>> LCSseq.normalized_similarity("lewenstein", "levenshtein")
-    0.8181818181818181
+    >>> from rapidfuzz.distance import Levenshtein
+    >>> Levenshtein.normalized_similarity("lewenstein", "levenshtein")
+    0.81818181818181
 
     Setting a score_cutoff allows the implementation to select
     a more efficient implementation:
 
-    >>> LCSseq.normalized_similarity("lewenstein", "levenshtein", score_cutoff=0.9)
+    >>> Levenshtein.normalized_similarity("lewenstein", "levenshtein", score_cutoff=0.85)
     0.0
 
+    It is possible to select different weights by passing a `weight`
+    tuple.
+
+    >>> Levenshtein.normalized_similarity("lewenstein", "levenshtein", weights=(1,1,2))
+    0.85714285714285
+
     When a different processor is used s1 and s2 do not have to be strings
 
-    >>> LCSseq.normalized_similarity(["lewenstein"], ["levenshtein"], processor=lambda s: s[0])
+    >>> Levenshtein.normalized_similarity(["lewenstein"], ["levenshtein"], processor=lambda s: s[0])
     0.81818181818181
     """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    if s1 is None or s2 is None:
-        return 0
-
-    cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff
+    if processor is not None:
+        s1 = processor(s1)
+        s2 = processor(s2)
 
-    if c_score_cutoff < 0:
-        raise ValueError("score_cutoff has to be >= 0")
+    norm_dist = normalized_distance(s1, s2, weights=weights)
+    norm_sim = 1.0 - norm_dist
+    return norm_sim if (score_cutoff is None or norm_sim >= score_cutoff) else 0
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    return lcs_seq_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
 
-def editops(s1, s2, *, processor=None):
+def editops(s1, s2, *, processor=None, score_hint=None):
     """
     Return Editops describing how to turn s1 into s2.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
+    score_hint : int, optional
+        Expected edit distance between s1 and s2. This is used to select a
+        faster implementation. If the edit distance is bigger than `score_hint`,
+        it is doubled until the distance is smaller than `score_hint`.
 
     Returns
     -------
     editops : Editops
         edit operations required to turn s1 into s2
 
     Notes
     -----
     The alignment is calculated using an algorithm of Heikki Hyyr, which is
-    described [6]_. It has a time complexity and memory usage of ``O([N/64] * M)``.
+    described [8]_. It has a time complexity and memory usage of ``O([N/64] * M)``.
 
     References
     ----------
-    .. [6] Hyyr, Heikki. "A Note on Bit-Parallel Alignment Computation."
+    .. [8] Hyyr, Heikki. "A Note on Bit-Parallel Alignment Computation."
            Stringology (2004).
 
     Examples
     --------
-    >>> from rapidfuzz.distance import LCSseq
-    >>> for tag, src_pos, dest_pos in LCSseq.editops("qabxcd", "abycdf"):
+    >>> from rapidfuzz.distance import Levenshtein
+    >>> for tag, src_pos, dest_pos in Levenshtein.editops("qabxcd", "abycdf"):
     ...    print(("%7s s1[%d] s2[%d]" % (tag, src_pos, dest_pos)))
-     delete s1[0] s2[0]
-     delete s1[3] s2[2]
-     insert s1[4] s2[2]
+     delete s1[1] s2[0]
+    replace s1[3] s2[2]
      insert s1[6] s2[5]
     """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    cdef Editops ops = Editops.__new__(Editops)
+    raise NotImplementedError
 
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    ops.editops = lcs_seq_editops_func(s1_proc.string, s2_proc.string)
-    return ops
 
-def opcodes(s1, s2, *, processor=None):
+def opcodes(s1, s2, *, processor=None, score_hint=None):
     """
     Return Opcodes describing how to turn s1 into s2.
 
     Parameters
     ----------
     s1 : Sequence[Hashable]
         First string to compare.
     s2 : Sequence[Hashable]
         Second string to compare.
     processor: callable, optional
         Optional callable that is used to preprocess the strings before
         comparing them. Default is None, which deactivates this behaviour.
+    score_hint : int, optional
+        Expected edit distance between s1 and s2. This is used to select a
+        faster implementation. If the edit distance is bigger than `score_hint`,
+        it is doubled until the distance is smaller than `score_hint`.
 
     Returns
     -------
     opcodes : Opcodes
         edit operations required to turn s1 into s2
 
     Notes
     -----
     The alignment is calculated using an algorithm of Heikki Hyyr, which is
-    described [7]_. It has a time complexity and memory usage of ``O([N/64] * M)``.
+    described [9]_. It has a time complexity and memory usage of ``O([N/64] * M)``.
 
     References
     ----------
-    .. [7] Hyyr, Heikki. "A Note on Bit-Parallel Alignment Computation."
+    .. [9] Hyyr, Heikki. "A Note on Bit-Parallel Alignment Computation."
            Stringology (2004).
 
     Examples
     --------
-    >>> from rapidfuzz.distance import LCSseq
+    >>> from rapidfuzz.distance import Levenshtein
 
     >>> a = "qabxcd"
     >>> b = "abycdf"
-    >>> for tag, i1, i2, j1, j2 in LCSseq.opcodes(a, b):
+    >>> for tag, i1, i2, j1, j2 in Levenshtein.opcodes("qabxcd", "abycdf"):
     ...    print(("%7s a[%d:%d] (%s) b[%d:%d] (%s)" %
     ...           (tag, i1, i2, a[i1:i2], j1, j2, b[j1:j2])))
      delete a[0:1] (q) b[0:0] ()
       equal a[1:3] (ab) b[0:2] (ab)
-     delete a[3:4] (x) b[2:2] ()
-     insert a[4:4] () b[2:3] (y)
+    replace a[3:4] (x) b[2:3] (y)
       equal a[4:6] (cd) b[3:5] (cd)
      insert a[6:6] () b[5:6] (f)
     """
-    cdef RF_StringWrapper s1_proc, s2_proc
-    cdef Editops ops = Editops.__new__(Editops)
-
-    preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
-    ops.editops = lcs_seq_editops_func(s1_proc.string, s2_proc.string)
-    return ops.as_opcodes()
-
-
-cdef bool GetScorerFlagsLCSseqDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.i64 = 0
-    dereference(scorer_flags).worst_score.i64 = INT64_MAX
-    return True
-
-cdef bool GetScorerFlagsLCSseqNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.f64 = 0.0
-    dereference(scorer_flags).worst_score.f64 = 1
-    return True
-
-cdef bool GetScorerFlagsLCSseqSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.i64 = INT64_MAX
-    dereference(scorer_flags).worst_score.i64 = 0
-    return True
-
-cdef bool GetScorerFlagsLCSseqNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
-    dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
-    dereference(scorer_flags).optimal_score.f64 = 1.0
-    dereference(scorer_flags).worst_score.f64 = 0
-    return True
-
-cdef RF_Scorer LCSseqDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqDistance, LCSseqDistanceInit)
-distance._RF_Scorer = PyCapsule_New(&LCSseqDistanceContext, NULL, NULL)
-
-cdef RF_Scorer LCSseqNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqNormalizedDistance, LCSseqNormalizedDistanceInit)
-normalized_distance._RF_Scorer = PyCapsule_New(&LCSseqNormalizedDistanceContext, NULL, NULL)
-
-cdef RF_Scorer LCSseqSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqSimilarity, LCSseqSimilarityInit)
-similarity._RF_Scorer = PyCapsule_New(&LCSseqSimilarityContext, NULL, NULL)
-
-cdef RF_Scorer LCSseqNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqNormalizedSimilarity, LCSseqNormalizedSimilarityInit)
-normalized_similarity._RF_Scorer = PyCapsule_New(&LCSseqNormalizedSimilarityContext, NULL, NULL)
-
-def _GetScorerFlagsDistance(**kwargs):
-    return {"optimal_score": 0, "worst_score": 2**63 - 1, "flags": (1 << 6)}
-
-
-def _GetScorerFlagsSimilarity(**kwargs):
-    return {"optimal_score": 2**63 - 1, "worst_score": 0, "flags": (1 << 6)}
-
-
-def _GetScorerFlagsNormalizedDistance(**kwargs):
-    return {"optimal_score": 0, "worst_score": 1, "flags": (1 << 5)}
-
-
-def _GetScorerFlagsNormalizedSimilarity(**kwargs):
-    return {"optimal_score": 1, "worst_score": 0, "flags": (1 << 5)}
-
-
-distance._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsDistance}
-
-similarity._RF_ScorerPy = {"get_scorer_flags": _GetScorerFlagsSimilarity}
-
-normalized_distance._RF_ScorerPy = {
-    "get_scorer_flags": _GetScorerFlagsNormalizedDistance
-}
-
-normalized_similarity._RF_ScorerPy = {
-    "get_scorer_flags": _GetScorerFlagsNormalizedSimilarity
-}
+    raise NotImplementedError
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/LCSseq_py.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/LCSseq_py.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/Levenshtein.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/Levenshtein.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/Levenshtein_py.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/Levenshtein_py.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/__init__.py` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/__init__.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 # SPDX-License-Identifier: MIT
 # Copyright (C) 2022 Max Bachmann
 
-from rapidfuzz.utils import _fallback_import
+from rapidfuzz._utils import fallback_import as _fallback_import
 
 _mod = "rapidfuzz.distance._initialize"
-Editop = _fallback_import(_mod, "Editop")
-Editops = _fallback_import(_mod, "Editops")
-Opcode = _fallback_import(_mod, "Opcode")
-Opcodes = _fallback_import(_mod, "Opcodes")
-ScoreAlignment = _fallback_import(_mod, "ScoreAlignment")
-MatchingBlock = _fallback_import(_mod, "MatchingBlock")
+Editop = _fallback_import(_mod, "Editop", False)
+Editops = _fallback_import(_mod, "Editops", False)
+Opcode = _fallback_import(_mod, "Opcode", False)
+Opcodes = _fallback_import(_mod, "Opcodes", False)
+ScoreAlignment = _fallback_import(_mod, "ScoreAlignment", False)
+MatchingBlock = _fallback_import(_mod, "MatchingBlock", False)
 
 from . import Hamming, Indel, Jaro, JaroWinkler, Levenshtein, LCSseq, DamerauLevenshtein
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/__init__.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/__init__.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/_initialize_cpp.cxx` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/_initialize_cpp.cxx`

 * *Files 0% similar despite different names*

```diff
@@ -2754,16 +2754,16 @@
 static PyTypeObject *__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp___pyx_scope_struct____repr__ = 0;
 static PyTypeObject *__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp___pyx_scope_struct_1_genexpr = 0;
 static PyTypeObject *__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp___pyx_scope_struct_2___repr__ = 0;
 static PyTypeObject *__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp___pyx_scope_struct_3_genexpr = 0;
 #endif
 static PyObject *__pyx_f_9rapidfuzz_8distance_15_initialize_cpp_edit_type_to_str(__PYX_ENUM_CLASS_DECL rapidfuzz::EditType); /*proto*/
 static __PYX_ENUM_CLASS_DECL rapidfuzz::EditType __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_str_to_edit_type(PyObject *); /*proto*/
-static rapidfuzz::Editops __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_editops(PyObject *, Py_ssize_t, Py_ssize_t); /*proto*/
-static rapidfuzz::Opcodes __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_opcodes(PyObject *, Py_ssize_t, Py_ssize_t); /*proto*/
+static rapidfuzz::Editops __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_editops(PyObject *, size_t, size_t); /*proto*/
+static rapidfuzz::Opcodes __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_opcodes(PyObject *, size_t, size_t); /*proto*/
 static PyObject *__pyx_f_9rapidfuzz_8distance_15_initialize_cpp_editops_to_list(rapidfuzz::Editops const &); /*proto*/
 static PyObject *__pyx_f_9rapidfuzz_8distance_15_initialize_cpp_opcodes_to_list(rapidfuzz::Opcodes const &); /*proto*/
 static PyObject *__pyx_f_9rapidfuzz_8distance_15_initialize_cpp_editops_to_matching_blocks(rapidfuzz::Editops const &); /*proto*/
 static PyObject *__pyx_f_9rapidfuzz_8distance_15_initialize_cpp_opcodes_to_matching_blocks(rapidfuzz::Opcodes const &); /*proto*/
 static PyObject *__pyx_f_9rapidfuzz_8distance_15_initialize_cpp___pyx_unpickle_Editop__set_state(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editop *, PyObject *); /*proto*/
 static PyObject *__pyx_f_9rapidfuzz_8distance_15_initialize_cpp___pyx_unpickle_Opcode__set_state(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Opcode *, PyObject *); /*proto*/
 static PyObject *__pyx_f_9rapidfuzz_8distance_15_initialize_cpp___pyx_unpickle_ScoreAlignment__set_state(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment *, PyObject *); /*proto*/
@@ -4785,15 +4785,15 @@
   }
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":48
  *         return EditType.None
  *     else:
  *         raise ValueError("Invalid Edit Type")             # <<<<<<<<<<<<<<
  * 
- * cdef RfEditops list_to_editops(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:
+ * cdef RfEditops list_to_editops(ops, size_t src_len, size_t dest_len) except *:
  */
   __Pyx_TraceLine(48,0,__PYX_ERR(0, 48, __pyx_L1_error))
   /*else*/ {
     __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 48, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
@@ -4818,26 +4818,26 @@
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "rapidfuzz/distance/_initialize_cpp.pyx":50
  *         raise ValueError("Invalid Edit Type")
  * 
- * cdef RfEditops list_to_editops(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:             # <<<<<<<<<<<<<<
+ * cdef RfEditops list_to_editops(ops, size_t src_len, size_t dest_len) except *:             # <<<<<<<<<<<<<<
  *     cdef RfEditops result
- *     cdef Py_ssize_t i
+ *     cdef size_t i
  */
 
-static rapidfuzz::Editops __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_editops(PyObject *__pyx_v_ops, Py_ssize_t __pyx_v_src_len, Py_ssize_t __pyx_v_dest_len) {
+static rapidfuzz::Editops __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_editops(PyObject *__pyx_v_ops, size_t __pyx_v_src_len, size_t __pyx_v_dest_len) {
   rapidfuzz::Editops __pyx_v_result;
-  Py_ssize_t __pyx_v_i;
+  size_t __pyx_v_i;
   __PYX_ENUM_CLASS_DECL rapidfuzz::EditType __pyx_v_edit_type;
   size_t __pyx_v_src_pos;
   size_t __pyx_v_dest_pos;
-  Py_ssize_t __pyx_v_ops_len;
+  size_t __pyx_v_ops_len;
   PyObject *__pyx_v_op = NULL;
   rapidfuzz::Editops __pyx_r;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   Py_ssize_t __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
@@ -4845,46 +4845,47 @@
   rapidfuzz::Editops __pyx_t_5;
   PyObject *(*__pyx_t_6)(PyObject *);
   PyObject *__pyx_t_7 = NULL;
   Py_ssize_t __pyx_t_8;
   __PYX_ENUM_CLASS_DECL rapidfuzz::EditType __pyx_t_9;
   size_t __pyx_t_10;
   int __pyx_t_11;
-  Py_ssize_t __pyx_t_12;
-  rapidfuzz::EditOp __pyx_t_13;
+  size_t __pyx_t_12;
+  size_t __pyx_t_13;
   rapidfuzz::EditOp __pyx_t_14;
+  rapidfuzz::EditOp __pyx_t_15;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("list_to_editops", 0);
   __Pyx_TraceCall("list_to_editops", __pyx_f[0], 50, 0, __PYX_ERR(0, 50, __pyx_L1_error));
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":55
  *     cdef EditType edit_type
  *     cdef size_t src_pos, dest_pos
- *     cdef Py_ssize_t ops_len = len(ops)             # <<<<<<<<<<<<<<
+ *     cdef size_t ops_len = len(ops)             # <<<<<<<<<<<<<<
  *     result.set_src_len(src_len)
  *     result.set_dest_len(dest_len)
  */
   __Pyx_TraceLine(55,0,__PYX_ERR(0, 55, __pyx_L1_error))
   __pyx_t_1 = PyObject_Length(__pyx_v_ops); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 55, __pyx_L1_error)
   __pyx_v_ops_len = __pyx_t_1;
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":56
  *     cdef size_t src_pos, dest_pos
- *     cdef Py_ssize_t ops_len = len(ops)
+ *     cdef size_t ops_len = len(ops)
  *     result.set_src_len(src_len)             # <<<<<<<<<<<<<<
  *     result.set_dest_len(dest_len)
  * 
  */
   __Pyx_TraceLine(56,0,__PYX_ERR(0, 56, __pyx_L1_error))
   __pyx_v_result.set_src_len(__pyx_v_src_len);
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":57
- *     cdef Py_ssize_t ops_len = len(ops)
+ *     cdef size_t ops_len = len(ops)
  *     result.set_src_len(src_len)
  *     result.set_dest_len(dest_len)             # <<<<<<<<<<<<<<
  * 
  *     if not ops_len:
  */
   __Pyx_TraceLine(57,0,__PYX_ERR(0, 57, __pyx_L1_error))
   __pyx_v_result.set_dest_len(__pyx_v_dest_len);
@@ -5286,58 +5287,58 @@
  * 
  *     # validate order of editops
  *     for i in range(0, ops_len - 1):             # <<<<<<<<<<<<<<
  *         if result[i + 1].src_pos < result[i].src_pos or result[i + 1].dest_pos < result[i].dest_pos:
  *             raise ValueError("List of edit operations out of order")
  */
   __Pyx_TraceLine(89,0,__PYX_ERR(0, 89, __pyx_L1_error))
-  __pyx_t_1 = (__pyx_v_ops_len - 1);
-  __pyx_t_8 = __pyx_t_1;
-  for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_8; __pyx_t_12+=1) {
-    __pyx_v_i = __pyx_t_12;
+  __pyx_t_10 = (__pyx_v_ops_len - 1);
+  __pyx_t_12 = __pyx_t_10;
+  for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
+    __pyx_v_i = __pyx_t_13;
 
     /* "rapidfuzz/distance/_initialize_cpp.pyx":90
  *     # validate order of editops
  *     for i in range(0, ops_len - 1):
  *         if result[i + 1].src_pos < result[i].src_pos or result[i + 1].dest_pos < result[i].dest_pos:             # <<<<<<<<<<<<<<
  *             raise ValueError("List of edit operations out of order")
  *         if result[i + 1].src_pos == result[i].src_pos and result[i + 1].dest_pos == result[i].dest_pos:
  */
     __Pyx_TraceLine(90,0,__PYX_ERR(0, 90, __pyx_L1_error))
     try {
-      __pyx_t_13 = __pyx_v_result[(__pyx_v_i + 1)];
+      __pyx_t_14 = __pyx_v_result[(__pyx_v_i + 1)];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 90, __pyx_L1_error)
     }
     try {
-      __pyx_t_14 = __pyx_v_result[__pyx_v_i];
+      __pyx_t_15 = __pyx_v_result[__pyx_v_i];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 90, __pyx_L1_error)
     }
-    __pyx_t_11 = (__pyx_t_13.src_pos < __pyx_t_14.src_pos);
+    __pyx_t_11 = (__pyx_t_14.src_pos < __pyx_t_15.src_pos);
     if (!__pyx_t_11) {
     } else {
       __pyx_t_2 = __pyx_t_11;
       goto __pyx_L20_bool_binop_done;
     }
     try {
-      __pyx_t_14 = __pyx_v_result[(__pyx_v_i + 1)];
+      __pyx_t_15 = __pyx_v_result[(__pyx_v_i + 1)];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 90, __pyx_L1_error)
     }
     try {
-      __pyx_t_13 = __pyx_v_result[__pyx_v_i];
+      __pyx_t_14 = __pyx_v_result[__pyx_v_i];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 90, __pyx_L1_error)
     }
-    __pyx_t_11 = (__pyx_t_14.dest_pos < __pyx_t_13.dest_pos);
+    __pyx_t_11 = (__pyx_t_15.dest_pos < __pyx_t_14.dest_pos);
     __pyx_t_2 = __pyx_t_11;
     __pyx_L20_bool_binop_done:;
     if (unlikely(__pyx_t_2)) {
 
       /* "rapidfuzz/distance/_initialize_cpp.pyx":91
  *     for i in range(0, ops_len - 1):
  *         if result[i + 1].src_pos < result[i].src_pos or result[i + 1].dest_pos < result[i].dest_pos:
@@ -5366,44 +5367,44 @@
  *             raise ValueError("List of edit operations out of order")
  *         if result[i + 1].src_pos == result[i].src_pos and result[i + 1].dest_pos == result[i].dest_pos:             # <<<<<<<<<<<<<<
  *             raise ValueError("Duplicated edit operation")
  * 
  */
     __Pyx_TraceLine(92,0,__PYX_ERR(0, 92, __pyx_L1_error))
     try {
-      __pyx_t_13 = __pyx_v_result[(__pyx_v_i + 1)];
+      __pyx_t_14 = __pyx_v_result[(__pyx_v_i + 1)];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 92, __pyx_L1_error)
     }
     try {
-      __pyx_t_14 = __pyx_v_result[__pyx_v_i];
+      __pyx_t_15 = __pyx_v_result[__pyx_v_i];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 92, __pyx_L1_error)
     }
-    __pyx_t_11 = (__pyx_t_13.src_pos == __pyx_t_14.src_pos);
+    __pyx_t_11 = (__pyx_t_14.src_pos == __pyx_t_15.src_pos);
     if (__pyx_t_11) {
     } else {
       __pyx_t_2 = __pyx_t_11;
       goto __pyx_L23_bool_binop_done;
     }
     try {
-      __pyx_t_14 = __pyx_v_result[(__pyx_v_i + 1)];
+      __pyx_t_15 = __pyx_v_result[(__pyx_v_i + 1)];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 92, __pyx_L1_error)
     }
     try {
-      __pyx_t_13 = __pyx_v_result[__pyx_v_i];
+      __pyx_t_14 = __pyx_v_result[__pyx_v_i];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 92, __pyx_L1_error)
     }
-    __pyx_t_11 = (__pyx_t_14.dest_pos == __pyx_t_13.dest_pos);
+    __pyx_t_11 = (__pyx_t_15.dest_pos == __pyx_t_14.dest_pos);
     __pyx_t_2 = __pyx_t_11;
     __pyx_L23_bool_binop_done:;
     if (unlikely(__pyx_t_2)) {
 
       /* "rapidfuzz/distance/_initialize_cpp.pyx":93
  *             raise ValueError("List of edit operations out of order")
  *         if result[i + 1].src_pos == result[i].src_pos and result[i + 1].dest_pos == result[i].dest_pos:
@@ -5444,26 +5445,26 @@
   }
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":96
  * 
  *     result.shrink_to_fit()
  *     return result             # <<<<<<<<<<<<<<
  * 
- * cdef RfOpcodes list_to_opcodes(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:
+ * cdef RfOpcodes list_to_opcodes(ops, size_t src_len, size_t dest_len) except *:
  */
   __Pyx_TraceLine(96,0,__PYX_ERR(0, 96, __pyx_L1_error))
   __pyx_r = __pyx_v_result;
   goto __pyx_L0;
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":50
  *         raise ValueError("Invalid Edit Type")
  * 
- * cdef RfEditops list_to_editops(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:             # <<<<<<<<<<<<<<
+ * cdef RfEditops list_to_editops(ops, size_t src_len, size_t dest_len) except *:             # <<<<<<<<<<<<<<
  *     cdef RfEditops result
- *     cdef Py_ssize_t i
+ *     cdef size_t i
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_AddTraceback("rapidfuzz.distance._initialize_cpp.list_to_editops", __pyx_clineno, __pyx_lineno, __pyx_filename);
@@ -5474,28 +5475,28 @@
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "rapidfuzz/distance/_initialize_cpp.pyx":98
  *     return result
  * 
- * cdef RfOpcodes list_to_opcodes(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:             # <<<<<<<<<<<<<<
+ * cdef RfOpcodes list_to_opcodes(ops, size_t src_len, size_t dest_len) except *:             # <<<<<<<<<<<<<<
  *     cdef RfOpcodes result
- *     cdef Py_ssize_t i
+ *     cdef size_t i
  */
 
-static rapidfuzz::Opcodes __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_opcodes(PyObject *__pyx_v_ops, Py_ssize_t __pyx_v_src_len, Py_ssize_t __pyx_v_dest_len) {
+static rapidfuzz::Opcodes __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_opcodes(PyObject *__pyx_v_ops, size_t __pyx_v_src_len, size_t __pyx_v_dest_len) {
   rapidfuzz::Opcodes __pyx_v_result;
-  Py_ssize_t __pyx_v_i;
+  size_t __pyx_v_i;
   __PYX_ENUM_CLASS_DECL rapidfuzz::EditType __pyx_v_edit_type;
   size_t __pyx_v_src_start;
   size_t __pyx_v_src_end;
   size_t __pyx_v_dest_start;
   size_t __pyx_v_dest_end;
-  Py_ssize_t __pyx_v_ops_len;
+  size_t __pyx_v_ops_len;
   PyObject *__pyx_v_op = NULL;
   rapidfuzz::Opcodes __pyx_r;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   Py_ssize_t __pyx_t_1;
   int __pyx_t_2;
   int __pyx_t_3;
@@ -5512,35 +5513,36 @@
   __Pyx_FakeReference<rapidfuzz::Opcode> __pyx_t_14;
   __Pyx_FakeReference<rapidfuzz::Opcode> __pyx_t_15;
   __Pyx_FakeReference<rapidfuzz::Opcode> __pyx_t_16;
   rapidfuzz::Opcode __pyx_t_17;
   __Pyx_FakeReference<rapidfuzz::Opcode> __pyx_t_18;
   __Pyx_FakeReference<rapidfuzz::Opcode> __pyx_t_19;
   size_t __pyx_t_20;
-  rapidfuzz::Opcode __pyx_t_21;
+  size_t __pyx_t_21;
+  rapidfuzz::Opcode __pyx_t_22;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("list_to_opcodes", 0);
   __Pyx_TraceCall("list_to_opcodes", __pyx_f[0], 98, 0, __PYX_ERR(0, 98, __pyx_L1_error));
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":103
  *     cdef EditType edit_type
  *     cdef size_t src_start, src_end, dest_start, dest_end
- *     cdef Py_ssize_t ops_len = len(ops)             # <<<<<<<<<<<<<<
+ *     cdef size_t ops_len = len(ops)             # <<<<<<<<<<<<<<
  *     if not ops_len or len(ops[0]) == 3:
  *         return RfOpcodes(list_to_editops(ops, src_len, dest_len))
  */
   __Pyx_TraceLine(103,0,__PYX_ERR(0, 103, __pyx_L1_error))
   __pyx_t_1 = PyObject_Length(__pyx_v_ops); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 103, __pyx_L1_error)
   __pyx_v_ops_len = __pyx_t_1;
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":104
  *     cdef size_t src_start, src_end, dest_start, dest_end
- *     cdef Py_ssize_t ops_len = len(ops)
+ *     cdef size_t ops_len = len(ops)
  *     if not ops_len or len(ops[0]) == 3:             # <<<<<<<<<<<<<<
  *         return RfOpcodes(list_to_editops(ops, src_len, dest_len))
  * 
  */
   __Pyx_TraceLine(104,0,__PYX_ERR(0, 104, __pyx_L1_error))
   __pyx_t_3 = (!(__pyx_v_ops_len != 0));
   if (!__pyx_t_3) {
@@ -5554,15 +5556,15 @@
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_t_3 = (__pyx_t_1 == 3);
   __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
 
     /* "rapidfuzz/distance/_initialize_cpp.pyx":105
- *     cdef Py_ssize_t ops_len = len(ops)
+ *     cdef size_t ops_len = len(ops)
  *     if not ops_len or len(ops[0]) == 3:
  *         return RfOpcodes(list_to_editops(ops, src_len, dest_len))             # <<<<<<<<<<<<<<
  * 
  *     result.set_src_len(src_len)
  */
     __Pyx_TraceLine(105,0,__PYX_ERR(0, 105, __pyx_L1_error))
     __pyx_t_5 = __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_editops(__pyx_v_ops, __pyx_v_src_len, __pyx_v_dest_len); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 105, __pyx_L1_error)
@@ -5573,15 +5575,15 @@
       __PYX_ERR(0, 105, __pyx_L1_error)
     }
     __pyx_r = __pyx_t_6;
     goto __pyx_L0;
 
     /* "rapidfuzz/distance/_initialize_cpp.pyx":104
  *     cdef size_t src_start, src_end, dest_start, dest_end
- *     cdef Py_ssize_t ops_len = len(ops)
+ *     cdef size_t ops_len = len(ops)
  *     if not ops_len or len(ops[0]) == 3:             # <<<<<<<<<<<<<<
  *         return RfOpcodes(list_to_editops(ops, src_len, dest_len))
  * 
  */
   }
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":107
@@ -6304,16 +6306,16 @@
  *     for i in range(0, result.size() - 1):             # <<<<<<<<<<<<<<
  *         if result[i + 1].src_begin != result[i].src_end or result[i + 1].dest_begin != result[i].dest_end:
  *             raise ValueError("List of edit operations is not continuous")
  */
   __Pyx_TraceLine(149,0,__PYX_ERR(0, 149, __pyx_L1_error))
   __pyx_t_11 = (__pyx_v_result.size() - 1);
   __pyx_t_20 = __pyx_t_11;
-  for (__pyx_t_1 = 0; __pyx_t_1 < __pyx_t_20; __pyx_t_1+=1) {
-    __pyx_v_i = __pyx_t_1;
+  for (__pyx_t_21 = 0; __pyx_t_21 < __pyx_t_20; __pyx_t_21+=1) {
+    __pyx_v_i = __pyx_t_21;
 
     /* "rapidfuzz/distance/_initialize_cpp.pyx":150
  *         raise ValueError("List of edit operations does not end at the string ends")
  *     for i in range(0, result.size() - 1):
  *         if result[i + 1].src_begin != result[i].src_end or result[i + 1].dest_begin != result[i].dest_end:             # <<<<<<<<<<<<<<
  *             raise ValueError("List of edit operations is not continuous")
  * 
@@ -6322,38 +6324,38 @@
     try {
       __pyx_t_17 = __pyx_v_result[(__pyx_v_i + 1)];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 150, __pyx_L1_error)
     }
     try {
-      __pyx_t_21 = __pyx_v_result[__pyx_v_i];
+      __pyx_t_22 = __pyx_v_result[__pyx_v_i];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 150, __pyx_L1_error)
     }
-    __pyx_t_3 = (__pyx_t_17.src_begin != __pyx_t_21.src_end);
+    __pyx_t_3 = (__pyx_t_17.src_begin != __pyx_t_22.src_end);
     if (!__pyx_t_3) {
     } else {
       __pyx_t_2 = __pyx_t_3;
       goto __pyx_L41_bool_binop_done;
     }
     try {
-      __pyx_t_21 = __pyx_v_result[(__pyx_v_i + 1)];
+      __pyx_t_22 = __pyx_v_result[(__pyx_v_i + 1)];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 150, __pyx_L1_error)
     }
     try {
       __pyx_t_17 = __pyx_v_result[__pyx_v_i];
     } catch(...) {
       __Pyx_CppExn2PyErr();
       __PYX_ERR(0, 150, __pyx_L1_error)
     }
-    __pyx_t_3 = (__pyx_t_21.dest_begin != __pyx_t_17.dest_end);
+    __pyx_t_3 = (__pyx_t_22.dest_begin != __pyx_t_17.dest_end);
     __pyx_t_2 = __pyx_t_3;
     __pyx_L41_bool_binop_done:;
     if (unlikely(__pyx_t_2)) {
 
       /* "rapidfuzz/distance/_initialize_cpp.pyx":151
  *     for i in range(0, result.size() - 1):
  *         if result[i + 1].src_begin != result[i].src_end or result[i + 1].dest_begin != result[i].dest_end:
@@ -6403,17 +6405,17 @@
   __Pyx_TraceLine(154,0,__PYX_ERR(0, 154, __pyx_L1_error))
   __pyx_r = __pyx_v_result;
   goto __pyx_L0;
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":98
  *     return result
  * 
- * cdef RfOpcodes list_to_opcodes(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:             # <<<<<<<<<<<<<<
+ * cdef RfOpcodes list_to_opcodes(ops, size_t src_len, size_t dest_len) except *:             # <<<<<<<<<<<<<<
  *     cdef RfOpcodes result
- *     cdef Py_ssize_t i
+ *     cdef size_t i
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_8);
   __Pyx_AddTraceback("rapidfuzz.distance._initialize_cpp.list_to_opcodes", __pyx_clineno, __pyx_lineno, __pyx_filename);
@@ -10843,16 +10845,16 @@
 }
 
 static int __pyx_pf_9rapidfuzz_8distance_15_initialize_cpp_7Editops___init__(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *__pyx_v_self, PyObject *__pyx_v_editops, PyObject *__pyx_v_src_len, PyObject *__pyx_v_dest_len) {
   int __pyx_r;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
-  Py_ssize_t __pyx_t_2;
-  Py_ssize_t __pyx_t_3;
+  size_t __pyx_t_2;
+  size_t __pyx_t_3;
   rapidfuzz::Editops __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
   __Pyx_TraceCall("__init__", __pyx_f[0], 348, 0, __PYX_ERR(0, 348, __pyx_L1_error));
 
@@ -10871,16 +10873,16 @@
  *     def __init__(self, editops=None, src_len=0, dest_len=0):
  *         if editops is not None:
  *             self.editops = list_to_editops(editops, src_len, dest_len)             # <<<<<<<<<<<<<<
  * 
  *     @classmethod
  */
     __Pyx_TraceLine(350,0,__PYX_ERR(0, 350, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_PyIndex_AsSsize_t(__pyx_v_src_len); if (unlikely((__pyx_t_2 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 350, __pyx_L1_error)
-    __pyx_t_3 = __Pyx_PyIndex_AsSsize_t(__pyx_v_dest_len); if (unlikely((__pyx_t_3 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 350, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_As_size_t(__pyx_v_src_len); if (unlikely((__pyx_t_2 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 350, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_As_size_t(__pyx_v_dest_len); if (unlikely((__pyx_t_3 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 350, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_editops(__pyx_v_editops, __pyx_t_2, __pyx_t_3); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 350, __pyx_L1_error)
     __pyx_v_self->editops = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_4);
 
     /* "rapidfuzz/distance/_initialize_cpp.pyx":349
  * 
  *     def __init__(self, editops=None, src_len=0, dest_len=0):
  *         if editops is not None:             # <<<<<<<<<<<<<<
@@ -15569,16 +15571,16 @@
 }
 
 static int __pyx_pf_9rapidfuzz_8distance_15_initialize_cpp_7Opcodes___init__(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Opcodes *__pyx_v_self, PyObject *__pyx_v_opcodes, PyObject *__pyx_v_src_len, PyObject *__pyx_v_dest_len) {
   int __pyx_r;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
-  Py_ssize_t __pyx_t_2;
-  Py_ssize_t __pyx_t_3;
+  size_t __pyx_t_2;
+  size_t __pyx_t_3;
   rapidfuzz::Opcodes __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
   __Pyx_TraceCall("__init__", __pyx_f[0], 629, 0, __PYX_ERR(0, 629, __pyx_L1_error));
 
@@ -15597,16 +15599,16 @@
  *     def __init__(self, opcodes=None, src_len=0, dest_len=0):
  *         if opcodes is not None:
  *             self.opcodes = list_to_opcodes(opcodes, src_len, dest_len)             # <<<<<<<<<<<<<<
  * 
  *     @classmethod
  */
     __Pyx_TraceLine(631,0,__PYX_ERR(0, 631, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_PyIndex_AsSsize_t(__pyx_v_src_len); if (unlikely((__pyx_t_2 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 631, __pyx_L1_error)
-    __pyx_t_3 = __Pyx_PyIndex_AsSsize_t(__pyx_v_dest_len); if (unlikely((__pyx_t_3 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 631, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyInt_As_size_t(__pyx_v_src_len); if (unlikely((__pyx_t_2 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 631, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyInt_As_size_t(__pyx_v_dest_len); if (unlikely((__pyx_t_3 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 631, __pyx_L1_error)
     __pyx_t_4 = __pyx_f_9rapidfuzz_8distance_15_initialize_cpp_list_to_opcodes(__pyx_v_opcodes, __pyx_t_2, __pyx_t_3); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 631, __pyx_L1_error)
     __pyx_v_self->opcodes = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_4);
 
     /* "rapidfuzz/distance/_initialize_cpp.pyx":630
  * 
  *     def __init__(self, opcodes=None, src_len=0, dest_len=0):
  *         if opcodes is not None:             # <<<<<<<<<<<<<<
@@ -25915,15 +25917,15 @@
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":48
  *         return EditType.None
  *     else:
  *         raise ValueError("Invalid Edit Type")             # <<<<<<<<<<<<<<
  * 
- * cdef RfEditops list_to_editops(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:
+ * cdef RfEditops list_to_editops(ops, size_t src_len, size_t dest_len) except *:
  */
   __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_Invalid_Edit_Type); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 48, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple_);
   __Pyx_GIVEREF(__pyx_tuple_);
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":68
  *     for op in ops:
@@ -27200,27 +27202,27 @@
  */
   __Pyx_TraceLine(37,0,__PYX_ERR(0, 37, __pyx_L1_error))
 
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":50
  *         raise ValueError("Invalid Edit Type")
  * 
- * cdef RfEditops list_to_editops(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:             # <<<<<<<<<<<<<<
+ * cdef RfEditops list_to_editops(ops, size_t src_len, size_t dest_len) except *:             # <<<<<<<<<<<<<<
  *     cdef RfEditops result
- *     cdef Py_ssize_t i
+ *     cdef size_t i
  */
   __Pyx_TraceLine(50,0,__PYX_ERR(0, 50, __pyx_L1_error))
 
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":98
  *     return result
  * 
- * cdef RfOpcodes list_to_opcodes(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:             # <<<<<<<<<<<<<<
+ * cdef RfOpcodes list_to_opcodes(ops, size_t src_len, size_t dest_len) except *:             # <<<<<<<<<<<<<<
  *     cdef RfOpcodes result
- *     cdef Py_ssize_t i
+ *     cdef size_t i
  */
   __Pyx_TraceLine(98,0,__PYX_ERR(0, 98, __pyx_L1_error))
 
 
   /* "rapidfuzz/distance/_initialize_cpp.pyx":156
  *     return result
  *
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/_initialize_cpp.pyx` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/_initialize_cpp.pyx`

 * *Files 1% similar despite different names*

```diff
@@ -43,20 +43,20 @@
     elif edit_type == "replace":
         return EditType.Replace
     elif edit_type == "equal":
         return EditType.None
     else:
         raise ValueError("Invalid Edit Type")
 
-cdef RfEditops list_to_editops(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:
+cdef RfEditops list_to_editops(ops, size_t src_len, size_t dest_len) except *:
     cdef RfEditops result
-    cdef Py_ssize_t i
+    cdef size_t i
     cdef EditType edit_type
     cdef size_t src_pos, dest_pos
-    cdef Py_ssize_t ops_len = len(ops)
+    cdef size_t ops_len = len(ops)
     result.set_src_len(src_len)
     result.set_dest_len(dest_len)
 
     if not ops_len:
         return result
 
     if len(ops[0]) == 5:
@@ -91,20 +91,20 @@
             raise ValueError("List of edit operations out of order")
         if result[i + 1].src_pos == result[i].src_pos and result[i + 1].dest_pos == result[i].dest_pos:
             raise ValueError("Duplicated edit operation")
 
     result.shrink_to_fit()
     return result
 
-cdef RfOpcodes list_to_opcodes(ops, Py_ssize_t src_len, Py_ssize_t dest_len) except *:
+cdef RfOpcodes list_to_opcodes(ops, size_t src_len, size_t dest_len) except *:
     cdef RfOpcodes result
-    cdef Py_ssize_t i
+    cdef size_t i
     cdef EditType edit_type
     cdef size_t src_start, src_end, dest_start, dest_end
-    cdef Py_ssize_t ops_len = len(ops)
+    cdef size_t ops_len = len(ops)
     if not ops_len or len(ops[0]) == 3:
         return RfOpcodes(list_to_editops(ops, src_len, dest_len))
 
     result.set_src_len(src_len)
     result.set_dest_len(dest_len)
     result.reserve(ops_len)
     for op in ops:
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/_initialize_py.py` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/_initialize_py.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/distance/edit_based.hpp` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/metrics.hpp`

 * *Files 7% similar despite different names*

```diff
@@ -294,7 +294,65 @@
 
 static inline rapidfuzz::Editops lcs_seq_editops_func(const RF_String& s1, const RF_String& s2)
 {
     return visitor(s1, s2, [](auto first1, auto last1, auto first2, auto last2) {
         return rapidfuzz::lcs_seq_editops(first1, last1, first2, last2);
     });
 }
+
+/* Damerau Levenshtein */
+static inline int64_t osa_distance_func(const RF_String& s1, const RF_String& s2, int64_t max)
+{
+    return visitor(s1, s2, [&](auto first1, auto last1, auto first2, auto last2) {
+        return rapidfuzz::osa_distance(
+            first1, last1, first2, last2, max);
+    });
+}
+
+static inline bool OSADistanceInit(RF_ScorerFunc* self, const RF_Kwargs*, int64_t str_count,
+                                                  const RF_String* str)
+{
+    return distance_init<rapidfuzz::CachedOSA, int64_t>(self, str_count, str);
+}
+
+static inline double osa_normalized_distance_func(const RF_String& s1, const RF_String& s2,
+                                                                  double score_cutoff)
+{
+    return visitor(s1, s2, [&](auto first1, auto last1, auto first2, auto last2) {
+        return rapidfuzz::osa_normalized_distance(
+            first1, last1, first2, last2, score_cutoff);
+    });
+}
+static inline bool OSANormalizedDistanceInit(RF_ScorerFunc* self, const RF_Kwargs*,
+                                                            int64_t str_count, const RF_String* str)
+{
+    return normalized_distance_init<rapidfuzz::CachedOSA, double>(self, str_count, str);
+}
+
+static inline int64_t osa_similarity_func(const RF_String& s1, const RF_String& s2,
+                                                          int64_t max)
+{
+    return visitor(s1, s2, [&](auto first1, auto last1, auto first2, auto last2) {
+        return rapidfuzz::osa_similarity(
+            first1, last1, first2, last2, max);
+    });
+}
+
+static inline bool OSASimilarityInit(RF_ScorerFunc* self, const RF_Kwargs*, int64_t str_count,
+                                             const RF_String* str)
+{
+    return similarity_init<rapidfuzz::CachedOSA, int64_t>(self, str_count, str);
+}
+
+static inline double osa_normalized_similarity_func(const RF_String& s1, const RF_String& s2,
+                                                                    double score_cutoff)
+{
+    return visitor(s1, s2, [&](auto first1, auto last1, auto first2, auto last2) {
+        return rapidfuzz::osa_normalized_similarity(first1, last1, first2,
+                                                                                  last2, score_cutoff);
+    });
+}
+static inline bool OSANormalizedSimilarityInit(RF_ScorerFunc* self, const RF_Kwargs*,
+                                                              int64_t str_count, const RF_String* str)
+{
+    return normalized_similarity_init<rapidfuzz::CachedOSA, double>(self, str_count, str);
+}
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/fuzz.py` & `rapidfuzz-2.9.0/src/rapidfuzz/fuzz.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 # SPDX-License-Identifier: MIT
 # Copyright (C) 2021 Max Bachmann
 
-from rapidfuzz.utils import _fallback_import
+from rapidfuzz._utils import fallback_import as _fallback_import
 
 _mod = "rapidfuzz.fuzz"
 ratio = _fallback_import(_mod, "ratio")
 partial_ratio = _fallback_import(_mod, "partial_ratio")
 partial_ratio_alignment = _fallback_import(_mod, "partial_ratio_alignment")
 token_sort_ratio = _fallback_import(_mod, "token_sort_ratio")
 token_set_ratio = _fallback_import(_mod, "token_set_ratio")
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/fuzz.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/fuzz.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/fuzz_cpp.cxx` & `rapidfuzz-2.9.0/src/rapidfuzz/distance/metrics_cpp.cxx`

 * *Files 23% similar despite different names*

```diff
@@ -1034,44 +1034,44 @@
   #ifdef __cplusplus
     #define __PYX_EXTERN_C extern "C"
   #else
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
-#define __PYX_HAVE__rapidfuzz__fuzz_cpp
-#define __PYX_HAVE_API__rapidfuzz__fuzz_cpp
+#define __PYX_HAVE__rapidfuzz__distance__metrics_cpp
+#define __PYX_HAVE_API__rapidfuzz__distance__metrics_cpp
 /* Early includes */
-#include <stdint.h>
-#include "rapidfuzz_capi.h"
-#include <string.h>
-#include <stdlib.h>
-#include <stddef.h>
 #include "ios"
 #include "new"
 #include "stdexcept"
 #include "typeinfo"
+#include <vector>
+#include <stdint.h>
+#include <string.h>
+#include <stdlib.h>
+#include <stddef.h>
 #include <utility>
 
     #if __cplusplus >= 201103L || (defined(_MSC_VER) && _MSC_VER >= 1600)
     // move should be defined for these versions of MSVC, but __cplusplus isn't set usefully
     #include <type_traits>
 
     namespace cython_std {
     template <typename T> typename std::remove_reference<T>::type&& move(T& t) noexcept { return std::move(t); }
     template <typename T> typename std::remove_reference<T>::type&& move(T&& t) noexcept { return std::move(t); }
     }
 
     #endif
     
 #include <stdio.h>
-#include <vector>
+#include "rapidfuzz_capi.h"
 #include "rapidfuzz/details/types.hpp"
 #include "cpp_common.hpp"
-#include "fuzz_cpp.hpp"
+#include "metrics.hpp"
 #ifdef _OPENMP
 #include <omp.h>
 #endif /* _OPENMP */
 
 #if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
 #define CYTHON_WITHOUT_ASSERTIONS
 #endif
@@ -1285,17 +1285,18 @@
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm = __FILE__;
 static const char *__pyx_filename;
 
 /* #### Code section: filename_table ### */
 
 static const char *__pyx_f[] = {
-  "src/rapidfuzz/fuzz_cpp.pyx",
+  "src/rapidfuzz/distance/metrics_cpp.pyx",
   "./src/rapidfuzz/cpp_common.pxd",
   "type.pxd",
+  "src/rapidfuzz/distance/_initialize_cpp.pxd",
 };
 /* #### Code section: utility_code_proto_before_types ### */
 /* NoFastGil.proto */
 #define __Pyx_PyGILState_Ensure PyGILState_Ensure
 #define __Pyx_PyGILState_Release PyGILState_Release
 #define __Pyx_FastGIL_Remember()
 #define __Pyx_FastGIL_Forget()
@@ -1307,54 +1308,60 @@
 #endif
 
 /* #### Code section: numeric_typedefs ### */
 /* #### Code section: complex_type_declarations ### */
 /* #### Code section: type_declarations ### */
 
 /*--- Type declarations ---*/
-struct __pyx_defaults;
-typedef struct __pyx_defaults __pyx_defaults;
-struct __pyx_defaults1;
-typedef struct __pyx_defaults1 __pyx_defaults1;
-struct __pyx_defaults2;
-typedef struct __pyx_defaults2 __pyx_defaults2;
-struct __pyx_defaults3;
-typedef struct __pyx_defaults3 __pyx_defaults3;
-struct __pyx_defaults4;
-typedef struct __pyx_defaults4 __pyx_defaults4;
-struct __pyx_defaults5;
-typedef struct __pyx_defaults5 __pyx_defaults5;
-struct __pyx_defaults6;
-typedef struct __pyx_defaults6 __pyx_defaults6;
-struct __pyx_defaults7;
-typedef struct __pyx_defaults7 __pyx_defaults7;
-struct __pyx_defaults {
-  PyObject *__pyx_arg_processor;
-};
-struct __pyx_defaults1 {
-  PyObject *__pyx_arg_processor;
-};
-struct __pyx_defaults2 {
-  PyObject *__pyx_arg_processor;
-};
-struct __pyx_defaults3 {
-  PyObject *__pyx_arg_processor;
-};
-struct __pyx_defaults4 {
-  PyObject *__pyx_arg_processor;
-};
-struct __pyx_defaults5 {
-  PyObject *__pyx_arg_processor;
+struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops;
+struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Opcodes;
+struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment;
+
+/* "_initialize_cpp.pxd":8
+ * from cpp_common cimport RfEditops, RfOpcodes
+ * 
+ * cdef class Editops:             # <<<<<<<<<<<<<<
+ *     cdef RfEditops editops
+ * 
+ */
+struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops {
+  PyObject_HEAD
+  rapidfuzz::Editops editops;
 };
-struct __pyx_defaults6 {
-  PyObject *__pyx_arg_processor;
+
+
+/* "_initialize_cpp.pxd":11
+ *     cdef RfEditops editops
+ * 
+ * cdef class Opcodes:             # <<<<<<<<<<<<<<
+ *     cdef RfOpcodes opcodes
+ * 
+ */
+struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Opcodes {
+  PyObject_HEAD
+  rapidfuzz::Opcodes opcodes;
 };
-struct __pyx_defaults7 {
-  PyObject *__pyx_arg_processor;
+
+
+/* "_initialize_cpp.pxd":14
+ *     cdef RfOpcodes opcodes
+ * 
+ * cdef class ScoreAlignment:             # <<<<<<<<<<<<<<
+ *     cdef public object score
+ *     cdef public Py_ssize_t src_start
+ */
+struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment {
+  PyObject_HEAD
+  PyObject *score;
+  Py_ssize_t src_start;
+  Py_ssize_t src_end;
+  Py_ssize_t dest_start;
+  Py_ssize_t dest_end;
 };
+
 /* #### Code section: utility_code_proto ### */
 
 /* --- Runtime support code (head) --- */
 /* Refnanny.proto */
 #ifndef CYTHON_REFNANNY
   #define CYTHON_REFNANNY 0
 #endif
@@ -1429,69 +1436,22 @@
 #define __Pyx_DECREF_SET(r, v) do {\
         PyObject *tmp = (PyObject *) r;\
         r = v; __Pyx_DECREF(tmp);\
     } while (0)
 #define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
 #define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)
 
-/* TupleAndListFromArray.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n);
-static CYTHON_INLINE PyObject* __Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n);
-#endif
-
-/* IncludeStringH.proto */
-#include <string.h>
-
-/* BytesEquals.proto */
-static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);
-
-/* UnicodeEquals.proto */
-static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);
-
-/* fastcall.proto */
-#define __Pyx_Arg_VARARGS(args, i) PyTuple_GET_ITEM(args, i)
-#define __Pyx_NumKwargs_VARARGS(kwds) PyDict_Size(kwds)
-#define __Pyx_KwValues_VARARGS(args, nargs) NULL
-#define __Pyx_GetKwValue_VARARGS(kw, kwvalues, s) __Pyx_PyDict_GetItemStrWithError(kw, s)
-#define __Pyx_KwargsAsDict_VARARGS(kw, kwvalues) PyDict_Copy(kw)
-#if CYTHON_METH_FASTCALL
-    #define __Pyx_Arg_FASTCALL(args, i) args[i]
-    #define __Pyx_NumKwargs_FASTCALL(kwds) PyTuple_GET_SIZE(kwds)
-    #define __Pyx_KwValues_FASTCALL(args, nargs) ((args) + (nargs))
-    static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s);
-    #define __Pyx_KwargsAsDict_FASTCALL(kw, kwvalues) _PyStack_AsDict(kwvalues, kw)
-#else
-    #define __Pyx_Arg_FASTCALL __Pyx_Arg_VARARGS
-    #define __Pyx_NumKwargs_FASTCALL __Pyx_NumKwargs_VARARGS
-    #define __Pyx_KwValues_FASTCALL __Pyx_KwValues_VARARGS
-    #define __Pyx_GetKwValue_FASTCALL __Pyx_GetKwValue_VARARGS
-    #define __Pyx_KwargsAsDict_FASTCALL __Pyx_KwargsAsDict_VARARGS
-#endif
-#if CYTHON_COMPILING_IN_CPYTHON
-#define __Pyx_ArgsSlice_VARARGS(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_VARARGS(args, start), stop - start)
-#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_FASTCALL(args, start), stop - start)
+/* PyErrExceptionMatches.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
 #else
-#define __Pyx_ArgsSlice_VARARGS(args, start, stop) PyTuple_GetSlice(args, start, stop)
-#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) PyTuple_GetSlice(args, start, stop)
+#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
 #endif
 
-/* RaiseArgTupleInvalid.proto */
-static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
-    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
-
-/* RaiseDoubleKeywords.proto */
-static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
-
-/* ParseKeywords.proto */
-static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject *const *kwvalues,
-    PyObject **argnames[],
-    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,
-    const char* function_name);
-
 /* PyThreadStateGet.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
 #define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
 #define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
 #else
 #define __Pyx_PyThreadState_declare
@@ -1520,14 +1480,27 @@
 #define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
 #define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
 #define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
 #endif
 
+/* PyObjectGetAttrStr.proto */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
+#else
+#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
+#endif
+
+/* PyObjectGetAttrStrNoError.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
+
+/* GetBuiltinName.proto */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name);
+
 /* Profile.proto */
 #ifndef CYTHON_PROFILE
 #if CYTHON_COMPILING_IN_LIMITED_API || CYTHON_COMPILING_IN_PYPY
   #define CYTHON_PROFILE 0
 #else
   #define CYTHON_PROFILE 1
 #endif
@@ -1752,82 +1725,100 @@
       }\
   }
   #endif
 #else
   #define __Pyx_TraceLine(lineno, nogil, goto_error)   if ((1)); else goto_error;
 #endif
 
-/* PyErrExceptionMatches.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
+/* PyObjectCall.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
 #else
-#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
+#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
 #endif
 
-/* PyObjectGetAttrStr.proto */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
-#else
-#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
+/* RaiseException.proto */
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+
+/* TupleAndListFromArray.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n);
+static CYTHON_INLINE PyObject* __Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n);
 #endif
 
-/* PyObjectGetAttrStrNoError.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
+/* IncludeStringH.proto */
+#include <string.h>
 
-/* GetBuiltinName.proto */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name);
+/* BytesEquals.proto */
+static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);
 
-/* PyDictVersioning.proto */
-#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
-#define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
-#define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
-#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
-    (version_var) = __PYX_GET_DICT_VERSION(dict);\
-    (cache_var) = (value);
-#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP) {\
-    static PY_UINT64_T __pyx_dict_version = 0;\
-    static PyObject *__pyx_dict_cached_value = NULL;\
-    if (likely(__PYX_GET_DICT_VERSION(DICT) == __pyx_dict_version)) {\
-        (VAR) = __pyx_dict_cached_value;\
-    } else {\
-        (VAR) = __pyx_dict_cached_value = (LOOKUP);\
-        __pyx_dict_version = __PYX_GET_DICT_VERSION(DICT);\
-    }\
-}
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj);
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj);
-static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version);
+/* UnicodeEquals.proto */
+static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);
+
+/* fastcall.proto */
+#define __Pyx_Arg_VARARGS(args, i) PyTuple_GET_ITEM(args, i)
+#define __Pyx_NumKwargs_VARARGS(kwds) PyDict_Size(kwds)
+#define __Pyx_KwValues_VARARGS(args, nargs) NULL
+#define __Pyx_GetKwValue_VARARGS(kw, kwvalues, s) __Pyx_PyDict_GetItemStrWithError(kw, s)
+#define __Pyx_KwargsAsDict_VARARGS(kw, kwvalues) PyDict_Copy(kw)
+#if CYTHON_METH_FASTCALL
+    #define __Pyx_Arg_FASTCALL(args, i) args[i]
+    #define __Pyx_NumKwargs_FASTCALL(kwds) PyTuple_GET_SIZE(kwds)
+    #define __Pyx_KwValues_FASTCALL(args, nargs) ((args) + (nargs))
+    static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s);
+    #define __Pyx_KwargsAsDict_FASTCALL(kw, kwvalues) _PyStack_AsDict(kwvalues, kw)
 #else
-#define __PYX_GET_DICT_VERSION(dict)  (0)
-#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
-#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
+    #define __Pyx_Arg_FASTCALL __Pyx_Arg_VARARGS
+    #define __Pyx_NumKwargs_FASTCALL __Pyx_NumKwargs_VARARGS
+    #define __Pyx_KwValues_FASTCALL __Pyx_KwValues_VARARGS
+    #define __Pyx_GetKwValue_FASTCALL __Pyx_GetKwValue_VARARGS
+    #define __Pyx_KwargsAsDict_FASTCALL __Pyx_KwargsAsDict_VARARGS
 #endif
-
-/* GetModuleGlobalName.proto */
-#if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
-    static PY_UINT64_T __pyx_dict_version = 0;\
-    static PyObject *__pyx_dict_cached_value = NULL;\
-    (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
-        (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
-        __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
-    PY_UINT64_T __pyx_dict_version;\
-    PyObject *__pyx_dict_cached_value;\
-    (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
+#if CYTHON_COMPILING_IN_CPYTHON
+#define __Pyx_ArgsSlice_VARARGS(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_VARARGS(args, start), stop - start)
+#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_FASTCALL(args, start), stop - start)
 #else
-#define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
-static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
+#define __Pyx_ArgsSlice_VARARGS(args, start, stop) PyTuple_GetSlice(args, start, stop)
+#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) PyTuple_GetSlice(args, start, stop)
 #endif
 
+/* RaiseArgTupleInvalid.proto */
+static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
+    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
+
+/* RaiseDoubleKeywords.proto */
+static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
+
+/* ParseKeywords.proto */
+static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject *const *kwvalues,
+    PyObject **argnames[],
+    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,
+    const char* function_name);
+
+/* RaiseTooManyValuesToUnpack.proto */
+static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);
+
+/* RaiseNeedMoreValuesToUnpack.proto */
+static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);
+
+/* IterFinish.proto */
+static CYTHON_INLINE int __Pyx_IterFinish(void);
+
+/* UnpackItemEndCheck.proto */
+static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected);
+
+/* tp_new.proto */
+#define __Pyx_tp_new(type_obj, args) __Pyx_tp_new_kwargs(type_obj, args, NULL)
+static CYTHON_INLINE PyObject* __Pyx_tp_new_kwargs(PyObject* type_obj, PyObject* args, PyObject* kwargs) {
+    return (PyObject*) (((PyTypeObject*)type_obj)->tp_new((PyTypeObject*)type_obj, args, kwargs));
+}
+
+/* ExtTypeTest.proto */
+static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type);
+
 /* MoveIfSupported.proto */
 #if __cplusplus >= 201103L || (defined(_MSC_VER) && _MSC_VER >= 1600)
   #include <utility>
   #define __PYX_STD_MOVE_IF_SUPPORTED(x) std::move(x)
 #else
   #define __PYX_STD_MOVE_IF_SUPPORTED(x) x
 #endif
@@ -1863,32 +1854,55 @@
      (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
   #define __Pyx_PyFrame_GetLocalsplus(frame)\
     (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
 #endif
 #endif
 #endif
 
-/* PyObjectCall.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
-#else
-#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
-#endif
-
 /* PyObjectCallMethO.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
 #endif
 
 /* PyObjectFastCall.proto */
 #define __Pyx_PyObject_FastCall(func, args, nargs)  __Pyx_PyObject_FastCallDict(func, args, (size_t)(nargs), NULL)
 static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs);
 
-/* KeywordStringCheck.proto */
-static int __Pyx_CheckKeywordStrings(PyObject *kw, const char* function_name, int kw_allowed);
+/* WriteUnraisableException.proto */
+static void __Pyx_WriteUnraisable(const char *name, int clineno,
+                                  int lineno, const char *filename,
+                                  int full_traceback, int nogil);
+
+/* dict_getitem_default.proto */
+static PyObject* __Pyx_PyDict_GetItemDefault(PyObject* d, PyObject* key, PyObject* default_value);
+
+/* UnpackUnboundCMethod.proto */
+typedef struct {
+    PyObject *type;
+    PyObject **method_name;
+    PyCFunction func;
+    PyObject *method;
+    int flag;
+} __Pyx_CachedCFunction;
+
+/* CallUnboundCMethod1.proto */
+static PyObject* __Pyx__CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg);
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg);
+#else
+#define __Pyx_CallUnboundCMethod1(cfunc, self, arg)  __Pyx__CallUnboundCMethod1(cfunc, self, arg)
+#endif
+
+/* CallUnboundCMethod2.proto */
+static PyObject* __Pyx__CallUnboundCMethod2(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg1, PyObject* arg2);
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030600B1
+static CYTHON_INLINE PyObject *__Pyx_CallUnboundCMethod2(__Pyx_CachedCFunction *cfunc, PyObject *self, PyObject *arg1, PyObject *arg2);
+#else
+#define __Pyx_CallUnboundCMethod2(cfunc, self, arg1, arg2)  __Pyx__CallUnboundCMethod2(cfunc, self, arg1, arg2)
+#endif
 
 /* GetItemInt.proto */
 #define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
     (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
     __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
     (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
                __Pyx_GetItemInt_Generic(o, to_py_func(i))))
@@ -1939,14 +1953,61 @@
 #else
 static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
 #endif
 
 /* PyIntCompare.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);
 
+/* PyDictVersioning.proto */
+#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
+#define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
+#define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
+#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
+    (version_var) = __PYX_GET_DICT_VERSION(dict);\
+    (cache_var) = (value);
+#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP) {\
+    static PY_UINT64_T __pyx_dict_version = 0;\
+    static PyObject *__pyx_dict_cached_value = NULL;\
+    if (likely(__PYX_GET_DICT_VERSION(DICT) == __pyx_dict_version)) {\
+        (VAR) = __pyx_dict_cached_value;\
+    } else {\
+        (VAR) = __pyx_dict_cached_value = (LOOKUP);\
+        __pyx_dict_version = __PYX_GET_DICT_VERSION(DICT);\
+    }\
+}
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj);
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj);
+static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version);
+#else
+#define __PYX_GET_DICT_VERSION(dict)  (0)
+#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
+#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
+#endif
+
+/* GetModuleGlobalName.proto */
+#if CYTHON_USE_DICT_VERSIONS
+#define __Pyx_GetModuleGlobalName(var, name)  {\
+    static PY_UINT64_T __pyx_dict_version = 0;\
+    static PyObject *__pyx_dict_cached_value = NULL;\
+    (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
+        (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
+        __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
+}
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
+    PY_UINT64_T __pyx_dict_version;\
+    PyObject *__pyx_dict_cached_value;\
+    (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
+}
+static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
+#else
+#define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
+static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
+#endif
+
 /* PyObjectFormatSimple.proto */
 #if CYTHON_COMPILING_IN_PYPY
     #define __Pyx_PyObject_FormatSimple(s, f) (\
         likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
         PyObject_Format(s, f))
 #elif PY_MAJOR_VERSION < 3
     #define __Pyx_PyObject_FormatSimple(s, f) (\
@@ -1968,32 +2029,20 @@
 /* JoinPyUnicode.proto */
 static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
                                       Py_UCS4 max_char);
 
 /* PyObjectCallOneArg.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
 
-/* RaiseException.proto */
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
-
 /* GetAttr3.proto */
 static CYTHON_INLINE PyObject *__Pyx_GetAttr3(PyObject *, PyObject *, PyObject *);
 
 /* py_dict_keys.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyDict_Keys(PyObject* d);
 
-/* UnpackUnboundCMethod.proto */
-typedef struct {
-    PyObject *type;
-    PyObject **method_name;
-    PyCFunction func;
-    PyObject *method;
-    int flag;
-} __Pyx_CachedCFunction;
-
 /* CallUnboundCMethod0.proto */
 static PyObject* __Pyx__CallUnboundCMethod0(__Pyx_CachedCFunction* cfunc, PyObject* self);
 #if CYTHON_COMPILING_IN_CPYTHON
 #define __Pyx_CallUnboundCMethod0(cfunc, self)\
     (likely((cfunc)->func) ?\
         (likely((cfunc)->flag == METH_NOARGS) ?  (*((cfunc)->func))(self, NULL) :\
          (PY_VERSION_HEX >= 0x030600B1 && likely((cfunc)->flag == METH_FASTCALL) ?\
@@ -2006,19 +2055,14 @@
                ((cfunc)->flag == METH_VARARGS ?  (*((cfunc)->func))(self, __pyx_empty_tuple) :\
                __Pyx__CallUnboundCMethod0(cfunc, self)))))) :\
         __Pyx__CallUnboundCMethod0(cfunc, self))
 #else
 #define __Pyx_CallUnboundCMethod0(cfunc, self)  __Pyx__CallUnboundCMethod0(cfunc, self)
 #endif
 
-/* WriteUnraisableException.proto */
-static void __Pyx_WriteUnraisable(const char *name, int clineno,
-                                  int lineno, const char *filename,
-                                  int full_traceback, int nogil);
-
 /* PyObjectSetAttrStr.proto */
 #if CYTHON_USE_TYPE_SLOTS
 #define __Pyx_PyObject_DelAttrStr(o,n) __Pyx_PyObject_SetAttrStr(o, n, NULL)
 static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value);
 #else
 #define __Pyx_PyObject_DelAttrStr(o,n)   PyObject_DelAttr(o,n)
 #define __Pyx_PyObject_SetAttrStr(o,n,v) PyObject_SetAttr(o,n,v)
@@ -2202,14 +2246,19 @@
 static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);
 #endif
 
 /* AddTraceback.proto */
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename);
 
+/* GCCDiagnostics.proto */
+#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
+#define __Pyx_HAS_GCC_DIAGNOSTIC
+#endif
+
 /* CppExceptionConversion.proto */
 #ifndef __Pyx_CppExn2PyErr
 #include <new>
 #include <typeinfo>
 #include <stdexcept>
 #include <ios>
 static void __Pyx_CppExn2PyErr() {
@@ -2258,33 +2307,31 @@
 #else
   #define __PYX_ENUM_CLASS_DECL enum
 #endif
 
 /* UnicodeAsUCS4.proto */
 static CYTHON_INLINE Py_UCS4 __Pyx_PyUnicode_AsPy_UCS4(PyObject*);
 
-/* GCCDiagnostics.proto */
-#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
-#define __Pyx_HAS_GCC_DIAGNOSTIC
-#endif
+/* None.proto */
+#include <new>
 
-/* ObjectAsUCS4.proto */
-#define __Pyx_PyObject_AsPy_UCS4(x)\
-    (likely(PyUnicode_Check(x)) ? __Pyx_PyUnicode_AsPy_UCS4(x) : __Pyx__PyObject_AsPy_UCS4(x))
-static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject*);
+/* CIntFromPy.proto */
+static CYTHON_INLINE int64_t __Pyx_PyInt_As_int64_t(PyObject *);
 
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int64_t(int64_t value);
 
 /* CIntFromPy.proto */
-static CYTHON_INLINE int64_t __Pyx_PyInt_As_int64_t(PyObject *);
-
-/* CIntFromPy.proto */
 static CYTHON_INLINE uint64_t __Pyx_PyInt_As_uint64_t(PyObject *);
 
+/* ObjectAsUCS4.proto */
+#define __Pyx_PyObject_AsPy_UCS4(x)\
+    (likely(PyUnicode_Check(x)) ? __Pyx_PyUnicode_AsPy_UCS4(x) : __Pyx__PyObject_AsPy_UCS4(x))
+static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject*);
+
 /* FormatTypeName.proto */
 #if CYTHON_COMPILING_IN_LIMITED_API
 typedef PyObject *__Pyx_TypeName;
 #define __Pyx_FMT_TYPENAME "%U"
 static __Pyx_TypeName __Pyx_PyType_GetName(PyTypeObject* tp);
 #define __Pyx_DECREF_TypeName(obj) Py_XDECREF(obj)
 #else
@@ -2328,23 +2375,23 @@
 static int __Pyx_InitString(__Pyx_StringTabEntry t, PyObject **str);
 #else
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);
 #endif
 
 /* #### Code section: module_declarations ### */
 
-/* Module declarations from "libcpp" */
+/* Module declarations from "libcpp.vector" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
-/* Module declarations from "libc.stdint" */
+/* Module declarations from "libcpp" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
-/* Module declarations from "rapidfuzz_capi" */
+/* Module declarations from "libc.stdint" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
 /* Module declarations from "libc.string" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
@@ -2377,238 +2424,340 @@
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
 /* Module declarations from "cpython.object" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
-/* Module declarations from "libcpp.vector" */
+/* Module declarations from "cpython.pycapsule" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
-/* Module declarations from "cpython.pycapsule" */
+/* Module declarations from "rapidfuzz_capi" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
 /* Module declarations from "cpp_common" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_hash_array(PyObject *); /*proto*/
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_hash_sequence(PyObject *); /*proto*/
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_conv_sequence(PyObject *); /*proto*/
 static CYTHON_INLINE void __pyx_f_10cpp_common_preprocess_strings(PyObject *, PyObject *, PyObject *, RF_StringWrapper *, RF_StringWrapper *, PyObject *); /*proto*/
 static CYTHON_INLINE bool __pyx_f_10cpp_common_NoKwargsInit(RF_Kwargs *, PyObject *); /*proto*/
 static CYTHON_INLINE RF_Scorer __pyx_f_10cpp_common_CreateScorerContext(RF_KwargsInit, RF_GetScorerFlags, RF_ScorerFuncInit); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_10cpp_common_CreateScorerContextPy(PyObject *); /*proto*/
-static CYTHON_INLINE bool __pyx_f_10cpp_common_AddScorerContext(PyObject *, PyObject *, RF_Scorer *); /*proto*/
 
-/* Module declarations from "rapidfuzz.fuzz_cpp" */
+/* Module declarations from "rapidfuzz.distance._initialize_cpp" */
 #if !CYTHON_USE_MODULE_STATE
+static PyTypeObject *__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops = 0;
+static PyTypeObject *__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Opcodes = 0;
+static PyTypeObject *__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment = 0;
 #endif
-static PyObject *__pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy = 0;
-static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_RatioContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_PartialRatioContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_TokenSortRatioContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_TokenSetRatioContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_TokenRatioContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSortRatioContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSetRatioContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenRatioContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_WRatioContext;
-static RF_Scorer __pyx_v_9rapidfuzz_8fuzz_cpp_QRatioContext;
-static bool __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
-static bool __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+
+/* Module declarations from "rapidfuzz.distance.metrics_cpp" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinSimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinNormalizedDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinNormalizedSimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinNormalizedDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinSimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinNormalizedSimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqNormalizedDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqSimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqNormalizedSimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelNormalizedDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelSimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelNormalizedSimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingNormalizedDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingSimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingNormalizedSimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSADistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSANormalizedDistanceContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSASimilarityContext;
+static RF_Scorer __pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSANormalizedSimilarityContext;
+static int64_t __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(PyObject *, int64_t); /*proto*/
+static double __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(PyObject *, double); /*proto*/
+static int64_t __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_hint_i64(PyObject *, int64_t); /*proto*/
+static void __pyx_f_9rapidfuzz_8distance_11metrics_cpp_KwargsDeinit(RF_Kwargs *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_LevenshteinKwargsInit(RF_Kwargs *, PyObject *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinNormalizedDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinNormalizedSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinNormalizedDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqNormalizedDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqNormalizedSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelNormalizedDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelNormalizedSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingNormalizedDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingNormalizedSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSADistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSANormalizedDistance(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSASimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSANormalizedSimilarity(RF_Kwargs const *, RF_ScorerFlags *); /*proto*/
 /* #### Code section: typeinfo ### */
 /* #### Code section: before_global_var ### */
-#define __Pyx_MODULE_NAME "rapidfuzz.fuzz_cpp"
-extern int __pyx_module_is_main_rapidfuzz__fuzz_cpp;
-int __pyx_module_is_main_rapidfuzz__fuzz_cpp = 0;
+#define __Pyx_MODULE_NAME "rapidfuzz.distance.metrics_cpp"
+extern int __pyx_module_is_main_rapidfuzz__distance__metrics_cpp;
+int __pyx_module_is_main_rapidfuzz__distance__metrics_cpp = 0;
 
-/* Implementation of "rapidfuzz.fuzz_cpp" */
+/* Implementation of "rapidfuzz.distance.metrics_cpp" */
 /* #### Code section: global_var ### */
+static PyObject *__pyx_builtin_ValueError;
 static PyObject *__pyx_builtin_MemoryError;
 static PyObject *__pyx_builtin_range;
 static PyObject *__pyx_builtin_TypeError;
 /* #### Code section: string_decls ### */
 static const char __pyx_k_s1[] = "s1";
 static const char __pyx_k_s2[] = "s2";
-static const char __pyx_k__13[] = " - ";
-static const char __pyx_k__14[] = ", ";
-static const char __pyx_k__15[] = ".";
-static const char __pyx_k__19[] = "?";
-static const char __pyx_k_res[] = "res";
+static const char __pyx_k__34[] = " - ";
+static const char __pyx_k__35[] = ", ";
+static const char __pyx_k__36[] = ".";
+static const char __pyx_k__42[] = "?";
+static const char __pyx_k_get[] = "get";
+static const char __pyx_k_ops[] = "ops";
 static const char __pyx_k_keys[] = "keys";
 static const char __pyx_k_main[] = "__main__";
 static const char __pyx_k_name[] = "__name__";
 static const char __pyx_k_test[] = "__test__";
 static const char __pyx_k_array[] = "array";
-static const char __pyx_k_flags[] = "flags";
 static const char __pyx_k_range[] = "range";
-static const char __pyx_k_ratio[] = "ratio";
-static const char __pyx_k_QRatio[] = "QRatio";
-static const char __pyx_k_WRatio[] = "WRatio";
 static const char __pyx_k_import[] = "__import__";
-static const char __pyx_k_kwargs[] = "kwargs";
+static const char __pyx_k_Editops[] = "Editops";
 static const char __pyx_k_s1_proc[] = "s1_proc";
 static const char __pyx_k_s2_proc[] = "s2_proc";
+static const char __pyx_k_weights[] = "weights";
+static const char __pyx_k_deletion[] = "deletion";
 static const char __pyx_k_typecode[] = "typecode";
 static const char __pyx_k_RF_Scorer[] = "_RF_Scorer";
 static const char __pyx_k_TypeError[] = "TypeError";
+static const char __pyx_k_insertion[] = "insertion";
 static const char __pyx_k_processor[] = "processor";
+static const char __pyx_k_ValueError[] = "ValueError";
+static const char __pyx_k_as_opcodes[] = "as_opcodes";
+static const char __pyx_k_score_hint[] = "score_hint";
 static const char __pyx_k_MemoryError[] = "MemoryError";
 static const char __pyx_k_RF_ScorerPy[] = "_RF_ScorerPy";
-static const char __pyx_k_token_ratio[] = "token_ratio";
-static const char __pyx_k_worst_score[] = "worst_score";
+static const char __pyx_k_c_score_hint[] = "c_score_hint";
 static const char __pyx_k_is_coroutine[] = "_is_coroutine";
+static const char __pyx_k_osa_distance[] = "osa_distance";
 static const char __pyx_k_score_cutoff[] = "score_cutoff";
+static const char __pyx_k_substitution[] = "substitution";
 static const char __pyx_k_RF_Preprocess[] = "_RF_Preprocess";
-static const char __pyx_k_optimal_score[] = "optimal_score";
-static const char __pyx_k_partial_ratio[] = "partial_ratio";
-static const char __pyx_k_ratio_line_50[] = "ratio (line 50)";
-static const char __pyx_k_ScoreAlignment[] = "ScoreAlignment";
+static const char __pyx_k_indel_editops[] = "indel_editops";
+static const char __pyx_k_indel_opcodes[] = "indel_opcodes";
 static const char __pyx_k_c_score_cutoff[] = "c_score_cutoff";
-static const char __pyx_k_QRatio_line_504[] = "QRatio (line 504)";
-static const char __pyx_k_default_process[] = "default_process";
-static const char __pyx_k_rapidfuzz_utils[] = "rapidfuzz.utils";
-static const char __pyx_k_token_set_ratio[] = "token_set_ratio";
+static const char __pyx_k_indel_distance[] = "indel_distance";
+static const char __pyx_k_initialize_cpp[] = "_initialize_cpp";
+static const char __pyx_k_osa_similarity[] = "osa_similarity";
+static const char __pyx_k_lcs_seq_editops[] = "lcs_seq_editops";
+static const char __pyx_k_lcs_seq_opcodes[] = "lcs_seq_opcodes";
 static const char __pyx_k_get_scorer_flags[] = "get_scorer_flags";
-static const char __pyx_k_token_sort_ratio[] = "token_sort_ratio";
+static const char __pyx_k_hamming_distance[] = "hamming_distance";
+static const char __pyx_k_indel_similarity[] = "indel_similarity";
+static const char __pyx_k_lcs_seq_distance[] = "lcs_seq_distance";
 static const char __pyx_k_asyncio_coroutines[] = "asyncio.coroutines";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
-static const char __pyx_k_rapidfuzz_fuzz_cpp[] = "rapidfuzz.fuzz_cpp";
-static const char __pyx_k_partial_token_ratio[] = "partial_token_ratio";
-static const char __pyx_k_partial_ratio_line_96[] = "partial_ratio (line 96)";
-static const char __pyx_k_partial_ratio_alignment[] = "partial_ratio_alignment";
-static const char __pyx_k_partial_token_set_ratio[] = "partial_token_set_ratio";
-static const char __pyx_k_GetScorerFlagsSimilarity[] = "_GetScorerFlagsSimilarity";
-static const char __pyx_k_distance__initialize_cpp[] = "distance._initialize_cpp";
-static const char __pyx_k_partial_token_sort_ratio[] = "partial_token_sort_ratio";
-static const char __pyx_k_token_set_ratio_line_266[] = "token_set_ratio (line 266)";
-static const char __pyx_k_token_sort_ratio_line_224[] = "token_sort_ratio (line 224)";
-static const char __pyx_k_src_rapidfuzz_fuzz_cpp_pyx[] = "src/rapidfuzz/fuzz_cpp.pyx";
-static const char __pyx_k_Sorts_the_words_in_the_strings[] = "\n    Sorts the words in the strings and calculates the fuzz.ratio between them\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    .. image:: img/token_sort_ratio.svg\n\n    Examples\n    --------\n    >>> fuzz.token_sort_ratio(\"fuzzy wuzzy was a bear\", \"wuzzy fuzzy was a bear\")\n    100.0\n    ";
-static const char __pyx_k_Calculates_a_quick_ratio_betwee[] = "\n    Calculates a quick ratio between two strings using fuzz.ratio.\n    The only difference to fuzz.ratio is, that this preprocesses\n    the strings by default.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Examples\n    --------\n    >>> fuzz.QRatio(\"this is a test\", \"THIS is a test!\")\n    100.0\n    ";
-static const char __pyx_k_Calculates_the_normalized_Indel[] = "\n    Calculates the normalized Indel distance.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    See Also\n    --------\n    rapidfuzz.string_metric.normalized_levenshtein : Normalized levenshtein distance\n\n    Notes\n    -----\n    .. image:: img/ratio.svg\n\n    Examples\n    --------\n    >>> fuzz.ratio(\"this is a test\", \"this is a test!\")\n    96.55171966552734\n    ";
-static const char __pyx_k_Compares_the_words_in_the_strin[] = "\n    Compares the words in the strings based on unique and common words between them\n    using fuzz.ratio\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    .. image:: img/token_set_ratio.svg\n\n    Examples\n    --------\n    >>> fuzz.token_sort_ratio(\"fuzzy was a bear\", \"fuzzy fuzzy was a bear\")\n    83.8709716796875\n    >>> fuzz.token_set_ratio(\"fuzzy was a bear\", \"fuzzy fuzzy was a bear\")\n    100.0\n    ";
-static const char __pyx_k_Searches_for_the_optimal_alignm[] = "\n    Searches for the optimal alignment of the shorter string in the\n    longer string and returns the fuzz.ratio for this alignment.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    Depending on the length of the needle (shorter string) different\n    implementations are used to improve the performance.\n\n    short needle (length \342\211\244 64):\n        When using a short needle length the fuzz.ratio is calculated for all\n        alignments that could result in an optimal alignment. It is\n        guaranteed to find the optimal alignment. For short needles this is very\n        fast, since for them fuzz.ratio runs in ``O(N)`` time. This results in a worst\n        case performance of ``O(NM)``.\n\n    .. image:: img/partial_ratio_short_needle.svg\n\n    long needle (length > 64):\n        For long needles a similar implementation to FuzzyWuzzy is used.\n        This implementation only considers alignments which start at one\n        of the longest common substrings. This results in a worst case performance\n        of ``O(N[N/64]M)``. However usually most of the alignments can be skipped.\n        The following Python code shows the concept:\n\n        .. code-block:: python\n\n            blocks = SequenceMatcher(None, needle, longer, False).get_matching_blocks()\n            score = 0\n         ""   for block in blocks:\n                long_start = block[1] - block[0] if (block[1] - block[0]) > 0 else 0\n                long_end = long_start + len(shorter)\n                long_substr = longer[long_start:long_end]\n                score = max(score, fuzz.ratio(needle, long_substr))\n\n        This is a lot faster than checking all possible alignments. However it\n        only finds one of the best alignments and not necessarily the optimal one.\n\n    .. image:: img/partial_ratio_long_needle.svg\n\n    Examples\n    --------\n    >>> fuzz.partial_ratio(\"this is a test\", \"this is a test!\")\n    100.0\n    ";
+static const char __pyx_k_hamming_similarity[] = "hamming_similarity";
+static const char __pyx_k_lcs_seq_similarity[] = "lcs_seq_similarity";
+static const char __pyx_k_levenshtein_editops[] = "levenshtein_editops";
+static const char __pyx_k_levenshtein_opcodes[] = "levenshtein_opcodes";
+static const char __pyx_k_levenshtein_distance[] = "levenshtein_distance";
+static const char __pyx_k_levenshtein_similarity[] = "levenshtein_similarity";
+static const char __pyx_k_score_hint_has_to_be_0[] = "score_hint has to be >= 0";
+static const char __pyx_k_osa_normalized_distance[] = "osa_normalized_distance";
+static const char __pyx_k_score_cutoff_has_to_be_0[] = "score_cutoff has to be >= 0";
+static const char __pyx_k_indel_normalized_distance[] = "indel_normalized_distance";
+static const char __pyx_k_osa_normalized_similarity[] = "osa_normalized_similarity";
+static const char __pyx_k_hamming_normalized_distance[] = "hamming_normalized_distance";
+static const char __pyx_k_indel_normalized_similarity[] = "indel_normalized_similarity";
+static const char __pyx_k_lcs_seq_normalized_distance[] = "lcs_seq_normalized_distance";
+static const char __pyx_k_damerau_levenshtein_distance[] = "damerau_levenshtein_distance";
+static const char __pyx_k_hamming_normalized_similarity[] = "hamming_normalized_similarity";
+static const char __pyx_k_lcs_seq_normalized_similarity[] = "lcs_seq_normalized_similarity";
+static const char __pyx_k_damerau_levenshtein_similarity[] = "damerau_levenshtein_similarity";
+static const char __pyx_k_rapidfuzz_distance_metrics_cpp[] = "rapidfuzz.distance.metrics_cpp";
+static const char __pyx_k_levenshtein_normalized_distance[] = "levenshtein_normalized_distance";
 static const char __pyx_k_Got_unexpected_keyword_arguments[] = "Got unexpected keyword arguments: ";
-static const char __pyx_k_partial_ratio_alignment_line_171[] = "partial_ratio_alignment (line 171)";
+static const char __pyx_k_damerau_levenshtein_normalized_d[] = "damerau_levenshtein_normalized_distance";
+static const char __pyx_k_damerau_levenshtein_normalized_s[] = "damerau_levenshtein_normalized_similarity";
+static const char __pyx_k_levenshtein_normalized_similarit[] = "levenshtein_normalized_similarity";
 static const char __pyx_k_score_cutoff_has_to_be_in_the_ra[] = "score_cutoff has to be in the range of ";
-static const char __pyx_k_Searches_for_the_optimal_alignm_2[] = "\n    Searches for the optimal alignment of the shorter string in the\n    longer string and returns the fuzz.ratio and the corresponding\n    alignment.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff None is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    alignment : ScoreAlignment, optional\n        alignment between s1 and s2 with the score as a float between 0 and 100\n\n    Examples\n    --------\n    >>> s1 = \"a certain string\"\n    >>> s2 = \"cetain\"\n    >>> res = fuzz.partial_ratio_alignment(s1, s2)\n    >>> res\n    ScoreAlignment(score=83.33333333333334, src_start=2, src_end=8, dest_start=0, dest_end=6)\n    \n    Using the alignment information it is possible to calculate the same fuzz.ratio\n\n    >>> fuzz.ratio(s1[res.src_start:res.src_end], s2[res.dest_start:res.dest_end])\n    83.33333333333334\n    ";
+static const char __pyx_k_src_rapidfuzz_distance_metrics_c[] = "src/rapidfuzz/distance/metrics_cpp.pyx";
 #if !CYTHON_USE_MODULE_STATE
-static PyObject *__pyx_kp_u_Calculates_a_quick_ratio_betwee;
-static PyObject *__pyx_kp_u_Calculates_the_normalized_Indel;
-static PyObject *__pyx_kp_u_Compares_the_words_in_the_strin;
-static PyObject *__pyx_n_s_GetScorerFlagsSimilarity;
+static PyObject *__pyx_n_s_Editops;
 static PyObject *__pyx_kp_u_Got_unexpected_keyword_arguments;
 static PyObject *__pyx_n_s_MemoryError;
-static PyObject *__pyx_n_s_QRatio;
-static PyObject *__pyx_kp_u_QRatio_line_504;
 static PyObject *__pyx_n_u_RF_Preprocess;
 static PyObject *__pyx_n_s_RF_Scorer;
 static PyObject *__pyx_n_s_RF_ScorerPy;
-static PyObject *__pyx_n_s_ScoreAlignment;
-static PyObject *__pyx_kp_u_Searches_for_the_optimal_alignm;
-static PyObject *__pyx_kp_u_Searches_for_the_optimal_alignm_2;
-static PyObject *__pyx_kp_u_Sorts_the_words_in_the_strings;
 static PyObject *__pyx_n_s_TypeError;
-static PyObject *__pyx_n_s_WRatio;
-static PyObject *__pyx_kp_u__13;
-static PyObject *__pyx_kp_u__14;
-static PyObject *__pyx_kp_u__15;
-static PyObject *__pyx_n_s__19;
+static PyObject *__pyx_n_s_ValueError;
+static PyObject *__pyx_kp_u__34;
+static PyObject *__pyx_kp_u__35;
+static PyObject *__pyx_kp_u__36;
+static PyObject *__pyx_n_s__42;
 static PyObject *__pyx_n_s_array;
+static PyObject *__pyx_n_s_as_opcodes;
 static PyObject *__pyx_n_s_asyncio_coroutines;
 static PyObject *__pyx_n_s_c_score_cutoff;
+static PyObject *__pyx_n_s_c_score_hint;
 static PyObject *__pyx_n_s_cline_in_traceback;
-static PyObject *__pyx_n_s_default_process;
-static PyObject *__pyx_n_s_distance__initialize_cpp;
-static PyObject *__pyx_n_u_flags;
+static PyObject *__pyx_n_s_damerau_levenshtein_distance;
+static PyObject *__pyx_n_s_damerau_levenshtein_normalized_d;
+static PyObject *__pyx_n_s_damerau_levenshtein_normalized_s;
+static PyObject *__pyx_n_s_damerau_levenshtein_similarity;
+static PyObject *__pyx_n_s_deletion;
+static PyObject *__pyx_n_s_get;
 static PyObject *__pyx_n_u_get_scorer_flags;
+static PyObject *__pyx_n_s_hamming_distance;
+static PyObject *__pyx_n_s_hamming_normalized_distance;
+static PyObject *__pyx_n_s_hamming_normalized_similarity;
+static PyObject *__pyx_n_s_hamming_similarity;
 static PyObject *__pyx_n_s_import;
+static PyObject *__pyx_n_s_indel_distance;
+static PyObject *__pyx_n_s_indel_editops;
+static PyObject *__pyx_n_s_indel_normalized_distance;
+static PyObject *__pyx_n_s_indel_normalized_similarity;
+static PyObject *__pyx_n_s_indel_opcodes;
+static PyObject *__pyx_n_s_indel_similarity;
+static PyObject *__pyx_n_s_initialize_cpp;
+static PyObject *__pyx_n_s_insertion;
 static PyObject *__pyx_n_s_is_coroutine;
 static PyObject *__pyx_n_s_keys;
-static PyObject *__pyx_n_s_kwargs;
+static PyObject *__pyx_n_s_lcs_seq_distance;
+static PyObject *__pyx_n_s_lcs_seq_editops;
+static PyObject *__pyx_n_s_lcs_seq_normalized_distance;
+static PyObject *__pyx_n_s_lcs_seq_normalized_similarity;
+static PyObject *__pyx_n_s_lcs_seq_opcodes;
+static PyObject *__pyx_n_s_lcs_seq_similarity;
+static PyObject *__pyx_n_s_levenshtein_distance;
+static PyObject *__pyx_n_s_levenshtein_editops;
+static PyObject *__pyx_n_s_levenshtein_normalized_distance;
+static PyObject *__pyx_n_s_levenshtein_normalized_similarit;
+static PyObject *__pyx_n_s_levenshtein_opcodes;
+static PyObject *__pyx_n_s_levenshtein_similarity;
 static PyObject *__pyx_n_s_main;
 static PyObject *__pyx_n_s_name;
-static PyObject *__pyx_n_u_optimal_score;
-static PyObject *__pyx_n_s_partial_ratio;
-static PyObject *__pyx_n_s_partial_ratio_alignment;
-static PyObject *__pyx_kp_u_partial_ratio_alignment_line_171;
-static PyObject *__pyx_kp_u_partial_ratio_line_96;
-static PyObject *__pyx_n_s_partial_token_ratio;
-static PyObject *__pyx_n_s_partial_token_set_ratio;
-static PyObject *__pyx_n_s_partial_token_sort_ratio;
+static PyObject *__pyx_n_s_ops;
+static PyObject *__pyx_n_s_osa_distance;
+static PyObject *__pyx_n_s_osa_normalized_distance;
+static PyObject *__pyx_n_s_osa_normalized_similarity;
+static PyObject *__pyx_n_s_osa_similarity;
 static PyObject *__pyx_n_s_processor;
 static PyObject *__pyx_n_s_range;
-static PyObject *__pyx_n_s_rapidfuzz_fuzz_cpp;
-static PyObject *__pyx_n_s_rapidfuzz_utils;
-static PyObject *__pyx_n_s_ratio;
-static PyObject *__pyx_kp_u_ratio_line_50;
-static PyObject *__pyx_n_s_res;
+static PyObject *__pyx_n_s_rapidfuzz_distance_metrics_cpp;
 static PyObject *__pyx_n_s_s1;
 static PyObject *__pyx_n_s_s1_proc;
 static PyObject *__pyx_n_s_s2;
 static PyObject *__pyx_n_s_s2_proc;
 static PyObject *__pyx_n_s_score_cutoff;
+static PyObject *__pyx_kp_u_score_cutoff_has_to_be_0;
 static PyObject *__pyx_kp_u_score_cutoff_has_to_be_in_the_ra;
-static PyObject *__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx;
+static PyObject *__pyx_n_s_score_hint;
+static PyObject *__pyx_kp_u_score_hint_has_to_be_0;
+static PyObject *__pyx_kp_s_src_rapidfuzz_distance_metrics_c;
+static PyObject *__pyx_n_s_substitution;
 static PyObject *__pyx_n_s_test;
-static PyObject *__pyx_n_s_token_ratio;
-static PyObject *__pyx_n_s_token_set_ratio;
-static PyObject *__pyx_kp_u_token_set_ratio_line_266;
-static PyObject *__pyx_n_s_token_sort_ratio;
-static PyObject *__pyx_kp_u_token_sort_ratio_line_224;
 static PyObject *__pyx_n_s_typecode;
-static PyObject *__pyx_n_u_worst_score;
+static PyObject *__pyx_n_s_weights;
+static PyObject *__pyx_n_u_weights;
 #endif
 /* #### Code section: decls ### */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_2partial_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_4partial_ratio_alignment(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_24__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_6token_sort_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_26__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_8token_set_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_28__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_10token_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_30__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_12partial_token_sort_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_32__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_14partial_token_set_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_34__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_16partial_token_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_36__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_18WRatio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_38__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_20QRatio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_22_GetScorerFlagsSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_levenshtein_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_weights, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_2levenshtein_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_weights, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_4levenshtein_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_weights, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_6levenshtein_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_weights, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_8levenshtein_editops(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_hint); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_10levenshtein_opcodes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_hint); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_12damerau_levenshtein_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_14damerau_levenshtein_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_16damerau_levenshtein_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_18damerau_levenshtein_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_20lcs_seq_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_22lcs_seq_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_24lcs_seq_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_26lcs_seq_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_28lcs_seq_editops(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_30lcs_seq_opcodes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_32indel_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_34indel_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_36indel_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_38indel_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_40indel_editops(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_42indel_opcodes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_44hamming_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_46hamming_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_48hamming_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_50hamming_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_52osa_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_54osa_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_56osa_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_58osa_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff); /* proto */
+static __Pyx_CachedCFunction __pyx_umethod_PyDict_Type_get = {0, 0, 0, 0, 0};
 static __Pyx_CachedCFunction __pyx_umethod_PyDict_Type_keys = {0, 0, 0, 0, 0};
 #if !CYTHON_USE_MODULE_STATE
 static PyObject *__pyx_int_0;
-static PyObject *__pyx_int_32;
-static PyObject *__pyx_int_100;
+static PyObject *__pyx_int_1;
 static PyObject *__pyx_int_neg_1;
 #endif
 #if !CYTHON_USE_MODULE_STATE
-static PyObject *__pyx_codeobj_;
-static PyObject *__pyx_tuple__16;
-static PyObject *__pyx_tuple__17;
-static PyObject *__pyx_tuple__18;
-static PyObject *__pyx_codeobj__2;
-static PyObject *__pyx_codeobj__3;
+static PyObject *__pyx_tuple_;
+static PyObject *__pyx_tuple__2;
+static PyObject *__pyx_tuple__3;
+static PyObject *__pyx_tuple__37;
+static PyObject *__pyx_tuple__38;
+static PyObject *__pyx_tuple__39;
+static PyObject *__pyx_tuple__40;
+static PyObject *__pyx_tuple__41;
 static PyObject *__pyx_codeobj__4;
 static PyObject *__pyx_codeobj__5;
 static PyObject *__pyx_codeobj__6;
 static PyObject *__pyx_codeobj__7;
 static PyObject *__pyx_codeobj__8;
 static PyObject *__pyx_codeobj__9;
 static PyObject *__pyx_codeobj__10;
 static PyObject *__pyx_codeobj__11;
 static PyObject *__pyx_codeobj__12;
+static PyObject *__pyx_codeobj__13;
+static PyObject *__pyx_codeobj__14;
+static PyObject *__pyx_codeobj__15;
+static PyObject *__pyx_codeobj__16;
+static PyObject *__pyx_codeobj__17;
+static PyObject *__pyx_codeobj__18;
+static PyObject *__pyx_codeobj__19;
+static PyObject *__pyx_codeobj__20;
+static PyObject *__pyx_codeobj__21;
+static PyObject *__pyx_codeobj__22;
+static PyObject *__pyx_codeobj__23;
+static PyObject *__pyx_codeobj__24;
+static PyObject *__pyx_codeobj__25;
+static PyObject *__pyx_codeobj__26;
+static PyObject *__pyx_codeobj__27;
+static PyObject *__pyx_codeobj__28;
+static PyObject *__pyx_codeobj__29;
+static PyObject *__pyx_codeobj__30;
+static PyObject *__pyx_codeobj__31;
+static PyObject *__pyx_codeobj__32;
+static PyObject *__pyx_codeobj__33;
 #endif
 /* #### Code section: late_includes ### */
 /* #### Code section: module_state ### */
 #if CYTHON_USE_MODULE_STATE
 typedef struct {
   PyObject *__pyx_d;
   PyObject *__pyx_b;
@@ -2619,98 +2768,135 @@
   #ifdef __Pyx_CyFunction_USED
   PyTypeObject *__pyx_CyFunctionType;
   #endif
   #ifdef __Pyx_FusedFunction_USED
   PyTypeObject *__pyx_FusedFunctionType;
   #endif
   PyTypeObject *__pyx_ptype_7cpython_4type_type;
-  PyObject *__pyx_kp_u_Calculates_a_quick_ratio_betwee;
-  PyObject *__pyx_kp_u_Calculates_the_normalized_Indel;
-  PyObject *__pyx_kp_u_Compares_the_words_in_the_strin;
-  PyObject *__pyx_n_s_GetScorerFlagsSimilarity;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Opcodes;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment;
+  PyObject *__pyx_n_s_Editops;
   PyObject *__pyx_kp_u_Got_unexpected_keyword_arguments;
   PyObject *__pyx_n_s_MemoryError;
-  PyObject *__pyx_n_s_QRatio;
-  PyObject *__pyx_kp_u_QRatio_line_504;
   PyObject *__pyx_n_u_RF_Preprocess;
   PyObject *__pyx_n_s_RF_Scorer;
   PyObject *__pyx_n_s_RF_ScorerPy;
-  PyObject *__pyx_n_s_ScoreAlignment;
-  PyObject *__pyx_kp_u_Searches_for_the_optimal_alignm;
-  PyObject *__pyx_kp_u_Searches_for_the_optimal_alignm_2;
-  PyObject *__pyx_kp_u_Sorts_the_words_in_the_strings;
   PyObject *__pyx_n_s_TypeError;
-  PyObject *__pyx_n_s_WRatio;
-  PyObject *__pyx_kp_u__13;
-  PyObject *__pyx_kp_u__14;
-  PyObject *__pyx_kp_u__15;
-  PyObject *__pyx_n_s__19;
+  PyObject *__pyx_n_s_ValueError;
+  PyObject *__pyx_kp_u__34;
+  PyObject *__pyx_kp_u__35;
+  PyObject *__pyx_kp_u__36;
+  PyObject *__pyx_n_s__42;
   PyObject *__pyx_n_s_array;
+  PyObject *__pyx_n_s_as_opcodes;
   PyObject *__pyx_n_s_asyncio_coroutines;
   PyObject *__pyx_n_s_c_score_cutoff;
+  PyObject *__pyx_n_s_c_score_hint;
   PyObject *__pyx_n_s_cline_in_traceback;
-  PyObject *__pyx_n_s_default_process;
-  PyObject *__pyx_n_s_distance__initialize_cpp;
-  PyObject *__pyx_n_u_flags;
+  PyObject *__pyx_n_s_damerau_levenshtein_distance;
+  PyObject *__pyx_n_s_damerau_levenshtein_normalized_d;
+  PyObject *__pyx_n_s_damerau_levenshtein_normalized_s;
+  PyObject *__pyx_n_s_damerau_levenshtein_similarity;
+  PyObject *__pyx_n_s_deletion;
+  PyObject *__pyx_n_s_get;
   PyObject *__pyx_n_u_get_scorer_flags;
+  PyObject *__pyx_n_s_hamming_distance;
+  PyObject *__pyx_n_s_hamming_normalized_distance;
+  PyObject *__pyx_n_s_hamming_normalized_similarity;
+  PyObject *__pyx_n_s_hamming_similarity;
   PyObject *__pyx_n_s_import;
+  PyObject *__pyx_n_s_indel_distance;
+  PyObject *__pyx_n_s_indel_editops;
+  PyObject *__pyx_n_s_indel_normalized_distance;
+  PyObject *__pyx_n_s_indel_normalized_similarity;
+  PyObject *__pyx_n_s_indel_opcodes;
+  PyObject *__pyx_n_s_indel_similarity;
+  PyObject *__pyx_n_s_initialize_cpp;
+  PyObject *__pyx_n_s_insertion;
   PyObject *__pyx_n_s_is_coroutine;
   PyObject *__pyx_n_s_keys;
-  PyObject *__pyx_n_s_kwargs;
+  PyObject *__pyx_n_s_lcs_seq_distance;
+  PyObject *__pyx_n_s_lcs_seq_editops;
+  PyObject *__pyx_n_s_lcs_seq_normalized_distance;
+  PyObject *__pyx_n_s_lcs_seq_normalized_similarity;
+  PyObject *__pyx_n_s_lcs_seq_opcodes;
+  PyObject *__pyx_n_s_lcs_seq_similarity;
+  PyObject *__pyx_n_s_levenshtein_distance;
+  PyObject *__pyx_n_s_levenshtein_editops;
+  PyObject *__pyx_n_s_levenshtein_normalized_distance;
+  PyObject *__pyx_n_s_levenshtein_normalized_similarit;
+  PyObject *__pyx_n_s_levenshtein_opcodes;
+  PyObject *__pyx_n_s_levenshtein_similarity;
   PyObject *__pyx_n_s_main;
   PyObject *__pyx_n_s_name;
-  PyObject *__pyx_n_u_optimal_score;
-  PyObject *__pyx_n_s_partial_ratio;
-  PyObject *__pyx_n_s_partial_ratio_alignment;
-  PyObject *__pyx_kp_u_partial_ratio_alignment_line_171;
-  PyObject *__pyx_kp_u_partial_ratio_line_96;
-  PyObject *__pyx_n_s_partial_token_ratio;
-  PyObject *__pyx_n_s_partial_token_set_ratio;
-  PyObject *__pyx_n_s_partial_token_sort_ratio;
+  PyObject *__pyx_n_s_ops;
+  PyObject *__pyx_n_s_osa_distance;
+  PyObject *__pyx_n_s_osa_normalized_distance;
+  PyObject *__pyx_n_s_osa_normalized_similarity;
+  PyObject *__pyx_n_s_osa_similarity;
   PyObject *__pyx_n_s_processor;
   PyObject *__pyx_n_s_range;
-  PyObject *__pyx_n_s_rapidfuzz_fuzz_cpp;
-  PyObject *__pyx_n_s_rapidfuzz_utils;
-  PyObject *__pyx_n_s_ratio;
-  PyObject *__pyx_kp_u_ratio_line_50;
-  PyObject *__pyx_n_s_res;
+  PyObject *__pyx_n_s_rapidfuzz_distance_metrics_cpp;
   PyObject *__pyx_n_s_s1;
   PyObject *__pyx_n_s_s1_proc;
   PyObject *__pyx_n_s_s2;
   PyObject *__pyx_n_s_s2_proc;
   PyObject *__pyx_n_s_score_cutoff;
+  PyObject *__pyx_kp_u_score_cutoff_has_to_be_0;
   PyObject *__pyx_kp_u_score_cutoff_has_to_be_in_the_ra;
-  PyObject *__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx;
+  PyObject *__pyx_n_s_score_hint;
+  PyObject *__pyx_kp_u_score_hint_has_to_be_0;
+  PyObject *__pyx_kp_s_src_rapidfuzz_distance_metrics_c;
+  PyObject *__pyx_n_s_substitution;
   PyObject *__pyx_n_s_test;
-  PyObject *__pyx_n_s_token_ratio;
-  PyObject *__pyx_n_s_token_set_ratio;
-  PyObject *__pyx_kp_u_token_set_ratio_line_266;
-  PyObject *__pyx_n_s_token_sort_ratio;
-  PyObject *__pyx_kp_u_token_sort_ratio_line_224;
   PyObject *__pyx_n_s_typecode;
-  PyObject *__pyx_n_u_worst_score;
+  PyObject *__pyx_n_s_weights;
+  PyObject *__pyx_n_u_weights;
   PyObject *__pyx_int_0;
-  PyObject *__pyx_int_32;
-  PyObject *__pyx_int_100;
+  PyObject *__pyx_int_1;
   PyObject *__pyx_int_neg_1;
-  PyObject *__pyx_codeobj_;
-  PyObject *__pyx_tuple__16;
-  PyObject *__pyx_tuple__17;
-  PyObject *__pyx_tuple__18;
-  PyObject *__pyx_codeobj__2;
-  PyObject *__pyx_codeobj__3;
+  PyObject *__pyx_tuple_;
+  PyObject *__pyx_tuple__2;
+  PyObject *__pyx_tuple__3;
+  PyObject *__pyx_tuple__37;
+  PyObject *__pyx_tuple__38;
+  PyObject *__pyx_tuple__39;
+  PyObject *__pyx_tuple__40;
+  PyObject *__pyx_tuple__41;
   PyObject *__pyx_codeobj__4;
   PyObject *__pyx_codeobj__5;
   PyObject *__pyx_codeobj__6;
   PyObject *__pyx_codeobj__7;
   PyObject *__pyx_codeobj__8;
   PyObject *__pyx_codeobj__9;
   PyObject *__pyx_codeobj__10;
   PyObject *__pyx_codeobj__11;
   PyObject *__pyx_codeobj__12;
+  PyObject *__pyx_codeobj__13;
+  PyObject *__pyx_codeobj__14;
+  PyObject *__pyx_codeobj__15;
+  PyObject *__pyx_codeobj__16;
+  PyObject *__pyx_codeobj__17;
+  PyObject *__pyx_codeobj__18;
+  PyObject *__pyx_codeobj__19;
+  PyObject *__pyx_codeobj__20;
+  PyObject *__pyx_codeobj__21;
+  PyObject *__pyx_codeobj__22;
+  PyObject *__pyx_codeobj__23;
+  PyObject *__pyx_codeobj__24;
+  PyObject *__pyx_codeobj__25;
+  PyObject *__pyx_codeobj__26;
+  PyObject *__pyx_codeobj__27;
+  PyObject *__pyx_codeobj__28;
+  PyObject *__pyx_codeobj__29;
+  PyObject *__pyx_codeobj__30;
+  PyObject *__pyx_codeobj__31;
+  PyObject *__pyx_codeobj__32;
+  PyObject *__pyx_codeobj__33;
 } __pyx_mstate;
 
 #ifdef __cplusplus
 namespace {
   extern struct PyModuleDef __pyx_moduledef;
 } /* anonymous namespace */
 #else
@@ -2737,98 +2923,135 @@
   #ifdef __Pyx_CyFunction_USED
   Py_CLEAR(clear_module_state->__pyx_CyFunctionType);
   #endif
   #ifdef __Pyx_FusedFunction_USED
   Py_CLEAR(clear_module_state->__pyx_FusedFunctionType);
   #endif
   Py_CLEAR(clear_module_state->__pyx_ptype_7cpython_4type_type);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculates_a_quick_ratio_betwee);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculates_the_normalized_Indel);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_Compares_the_words_in_the_strin);
-  Py_CLEAR(clear_module_state->__pyx_n_s_GetScorerFlagsSimilarity);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Opcodes);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment);
+  Py_CLEAR(clear_module_state->__pyx_n_s_Editops);
   Py_CLEAR(clear_module_state->__pyx_kp_u_Got_unexpected_keyword_arguments);
   Py_CLEAR(clear_module_state->__pyx_n_s_MemoryError);
-  Py_CLEAR(clear_module_state->__pyx_n_s_QRatio);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_QRatio_line_504);
   Py_CLEAR(clear_module_state->__pyx_n_u_RF_Preprocess);
   Py_CLEAR(clear_module_state->__pyx_n_s_RF_Scorer);
   Py_CLEAR(clear_module_state->__pyx_n_s_RF_ScorerPy);
-  Py_CLEAR(clear_module_state->__pyx_n_s_ScoreAlignment);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_Searches_for_the_optimal_alignm);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_Searches_for_the_optimal_alignm_2);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_Sorts_the_words_in_the_strings);
   Py_CLEAR(clear_module_state->__pyx_n_s_TypeError);
-  Py_CLEAR(clear_module_state->__pyx_n_s_WRatio);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__13);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__14);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__15);
-  Py_CLEAR(clear_module_state->__pyx_n_s__19);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ValueError);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__34);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__35);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__36);
+  Py_CLEAR(clear_module_state->__pyx_n_s__42);
   Py_CLEAR(clear_module_state->__pyx_n_s_array);
+  Py_CLEAR(clear_module_state->__pyx_n_s_as_opcodes);
   Py_CLEAR(clear_module_state->__pyx_n_s_asyncio_coroutines);
   Py_CLEAR(clear_module_state->__pyx_n_s_c_score_cutoff);
+  Py_CLEAR(clear_module_state->__pyx_n_s_c_score_hint);
   Py_CLEAR(clear_module_state->__pyx_n_s_cline_in_traceback);
-  Py_CLEAR(clear_module_state->__pyx_n_s_default_process);
-  Py_CLEAR(clear_module_state->__pyx_n_s_distance__initialize_cpp);
-  Py_CLEAR(clear_module_state->__pyx_n_u_flags);
+  Py_CLEAR(clear_module_state->__pyx_n_s_damerau_levenshtein_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_damerau_levenshtein_normalized_d);
+  Py_CLEAR(clear_module_state->__pyx_n_s_damerau_levenshtein_normalized_s);
+  Py_CLEAR(clear_module_state->__pyx_n_s_damerau_levenshtein_similarity);
+  Py_CLEAR(clear_module_state->__pyx_n_s_deletion);
+  Py_CLEAR(clear_module_state->__pyx_n_s_get);
   Py_CLEAR(clear_module_state->__pyx_n_u_get_scorer_flags);
+  Py_CLEAR(clear_module_state->__pyx_n_s_hamming_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_hamming_normalized_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_hamming_normalized_similarity);
+  Py_CLEAR(clear_module_state->__pyx_n_s_hamming_similarity);
   Py_CLEAR(clear_module_state->__pyx_n_s_import);
+  Py_CLEAR(clear_module_state->__pyx_n_s_indel_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_indel_editops);
+  Py_CLEAR(clear_module_state->__pyx_n_s_indel_normalized_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_indel_normalized_similarity);
+  Py_CLEAR(clear_module_state->__pyx_n_s_indel_opcodes);
+  Py_CLEAR(clear_module_state->__pyx_n_s_indel_similarity);
+  Py_CLEAR(clear_module_state->__pyx_n_s_initialize_cpp);
+  Py_CLEAR(clear_module_state->__pyx_n_s_insertion);
   Py_CLEAR(clear_module_state->__pyx_n_s_is_coroutine);
   Py_CLEAR(clear_module_state->__pyx_n_s_keys);
-  Py_CLEAR(clear_module_state->__pyx_n_s_kwargs);
+  Py_CLEAR(clear_module_state->__pyx_n_s_lcs_seq_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_lcs_seq_editops);
+  Py_CLEAR(clear_module_state->__pyx_n_s_lcs_seq_normalized_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_lcs_seq_normalized_similarity);
+  Py_CLEAR(clear_module_state->__pyx_n_s_lcs_seq_opcodes);
+  Py_CLEAR(clear_module_state->__pyx_n_s_lcs_seq_similarity);
+  Py_CLEAR(clear_module_state->__pyx_n_s_levenshtein_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_levenshtein_editops);
+  Py_CLEAR(clear_module_state->__pyx_n_s_levenshtein_normalized_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_levenshtein_normalized_similarit);
+  Py_CLEAR(clear_module_state->__pyx_n_s_levenshtein_opcodes);
+  Py_CLEAR(clear_module_state->__pyx_n_s_levenshtein_similarity);
   Py_CLEAR(clear_module_state->__pyx_n_s_main);
   Py_CLEAR(clear_module_state->__pyx_n_s_name);
-  Py_CLEAR(clear_module_state->__pyx_n_u_optimal_score);
-  Py_CLEAR(clear_module_state->__pyx_n_s_partial_ratio);
-  Py_CLEAR(clear_module_state->__pyx_n_s_partial_ratio_alignment);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_partial_ratio_alignment_line_171);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_partial_ratio_line_96);
-  Py_CLEAR(clear_module_state->__pyx_n_s_partial_token_ratio);
-  Py_CLEAR(clear_module_state->__pyx_n_s_partial_token_set_ratio);
-  Py_CLEAR(clear_module_state->__pyx_n_s_partial_token_sort_ratio);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ops);
+  Py_CLEAR(clear_module_state->__pyx_n_s_osa_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_osa_normalized_distance);
+  Py_CLEAR(clear_module_state->__pyx_n_s_osa_normalized_similarity);
+  Py_CLEAR(clear_module_state->__pyx_n_s_osa_similarity);
   Py_CLEAR(clear_module_state->__pyx_n_s_processor);
   Py_CLEAR(clear_module_state->__pyx_n_s_range);
-  Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_fuzz_cpp);
-  Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_utils);
-  Py_CLEAR(clear_module_state->__pyx_n_s_ratio);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_ratio_line_50);
-  Py_CLEAR(clear_module_state->__pyx_n_s_res);
+  Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_distance_metrics_cpp);
   Py_CLEAR(clear_module_state->__pyx_n_s_s1);
   Py_CLEAR(clear_module_state->__pyx_n_s_s1_proc);
   Py_CLEAR(clear_module_state->__pyx_n_s_s2);
   Py_CLEAR(clear_module_state->__pyx_n_s_s2_proc);
   Py_CLEAR(clear_module_state->__pyx_n_s_score_cutoff);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_score_cutoff_has_to_be_0);
   Py_CLEAR(clear_module_state->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
-  Py_CLEAR(clear_module_state->__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx);
+  Py_CLEAR(clear_module_state->__pyx_n_s_score_hint);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_score_hint_has_to_be_0);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_src_rapidfuzz_distance_metrics_c);
+  Py_CLEAR(clear_module_state->__pyx_n_s_substitution);
   Py_CLEAR(clear_module_state->__pyx_n_s_test);
-  Py_CLEAR(clear_module_state->__pyx_n_s_token_ratio);
-  Py_CLEAR(clear_module_state->__pyx_n_s_token_set_ratio);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_token_set_ratio_line_266);
-  Py_CLEAR(clear_module_state->__pyx_n_s_token_sort_ratio);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_token_sort_ratio_line_224);
   Py_CLEAR(clear_module_state->__pyx_n_s_typecode);
-  Py_CLEAR(clear_module_state->__pyx_n_u_worst_score);
+  Py_CLEAR(clear_module_state->__pyx_n_s_weights);
+  Py_CLEAR(clear_module_state->__pyx_n_u_weights);
   Py_CLEAR(clear_module_state->__pyx_int_0);
-  Py_CLEAR(clear_module_state->__pyx_int_32);
-  Py_CLEAR(clear_module_state->__pyx_int_100);
+  Py_CLEAR(clear_module_state->__pyx_int_1);
   Py_CLEAR(clear_module_state->__pyx_int_neg_1);
-  Py_CLEAR(clear_module_state->__pyx_codeobj_);
-  Py_CLEAR(clear_module_state->__pyx_tuple__16);
-  Py_CLEAR(clear_module_state->__pyx_tuple__17);
-  Py_CLEAR(clear_module_state->__pyx_tuple__18);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__2);
-  Py_CLEAR(clear_module_state->__pyx_codeobj__3);
+  Py_CLEAR(clear_module_state->__pyx_tuple_);
+  Py_CLEAR(clear_module_state->__pyx_tuple__2);
+  Py_CLEAR(clear_module_state->__pyx_tuple__3);
+  Py_CLEAR(clear_module_state->__pyx_tuple__37);
+  Py_CLEAR(clear_module_state->__pyx_tuple__38);
+  Py_CLEAR(clear_module_state->__pyx_tuple__39);
+  Py_CLEAR(clear_module_state->__pyx_tuple__40);
+  Py_CLEAR(clear_module_state->__pyx_tuple__41);
   Py_CLEAR(clear_module_state->__pyx_codeobj__4);
   Py_CLEAR(clear_module_state->__pyx_codeobj__5);
   Py_CLEAR(clear_module_state->__pyx_codeobj__6);
   Py_CLEAR(clear_module_state->__pyx_codeobj__7);
   Py_CLEAR(clear_module_state->__pyx_codeobj__8);
   Py_CLEAR(clear_module_state->__pyx_codeobj__9);
   Py_CLEAR(clear_module_state->__pyx_codeobj__10);
   Py_CLEAR(clear_module_state->__pyx_codeobj__11);
   Py_CLEAR(clear_module_state->__pyx_codeobj__12);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__13);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__14);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__15);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__16);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__17);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__18);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__19);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__20);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__21);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__22);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__23);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__24);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__25);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__26);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__27);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__28);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__29);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__30);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__31);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__32);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__33);
   return 0;
 }
 #endif
 /* #### Code section: module_state_traverse ### */
 #if CYTHON_USE_MODULE_STATE
 static int __pyx_m_traverse(PyObject *m, visitproc visit, void *arg) {
   __pyx_mstate *traverse_module_state = __pyx_mstate(m);
@@ -2842,98 +3065,135 @@
   #ifdef __Pyx_CyFunction_USED
   Py_VISIT(traverse_module_state->__pyx_CyFunctionType);
   #endif
   #ifdef __Pyx_FusedFunction_USED
   Py_VISIT(traverse_module_state->__pyx_FusedFunctionType);
   #endif
   Py_VISIT(traverse_module_state->__pyx_ptype_7cpython_4type_type);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculates_a_quick_ratio_betwee);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculates_the_normalized_Indel);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_Compares_the_words_in_the_strin);
-  Py_VISIT(traverse_module_state->__pyx_n_s_GetScorerFlagsSimilarity);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Opcodes);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment);
+  Py_VISIT(traverse_module_state->__pyx_n_s_Editops);
   Py_VISIT(traverse_module_state->__pyx_kp_u_Got_unexpected_keyword_arguments);
   Py_VISIT(traverse_module_state->__pyx_n_s_MemoryError);
-  Py_VISIT(traverse_module_state->__pyx_n_s_QRatio);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_QRatio_line_504);
   Py_VISIT(traverse_module_state->__pyx_n_u_RF_Preprocess);
   Py_VISIT(traverse_module_state->__pyx_n_s_RF_Scorer);
   Py_VISIT(traverse_module_state->__pyx_n_s_RF_ScorerPy);
-  Py_VISIT(traverse_module_state->__pyx_n_s_ScoreAlignment);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_Searches_for_the_optimal_alignm);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_Searches_for_the_optimal_alignm_2);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_Sorts_the_words_in_the_strings);
   Py_VISIT(traverse_module_state->__pyx_n_s_TypeError);
-  Py_VISIT(traverse_module_state->__pyx_n_s_WRatio);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__13);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__14);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__15);
-  Py_VISIT(traverse_module_state->__pyx_n_s__19);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ValueError);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__34);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__35);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__36);
+  Py_VISIT(traverse_module_state->__pyx_n_s__42);
   Py_VISIT(traverse_module_state->__pyx_n_s_array);
+  Py_VISIT(traverse_module_state->__pyx_n_s_as_opcodes);
   Py_VISIT(traverse_module_state->__pyx_n_s_asyncio_coroutines);
   Py_VISIT(traverse_module_state->__pyx_n_s_c_score_cutoff);
+  Py_VISIT(traverse_module_state->__pyx_n_s_c_score_hint);
   Py_VISIT(traverse_module_state->__pyx_n_s_cline_in_traceback);
-  Py_VISIT(traverse_module_state->__pyx_n_s_default_process);
-  Py_VISIT(traverse_module_state->__pyx_n_s_distance__initialize_cpp);
-  Py_VISIT(traverse_module_state->__pyx_n_u_flags);
+  Py_VISIT(traverse_module_state->__pyx_n_s_damerau_levenshtein_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_damerau_levenshtein_normalized_d);
+  Py_VISIT(traverse_module_state->__pyx_n_s_damerau_levenshtein_normalized_s);
+  Py_VISIT(traverse_module_state->__pyx_n_s_damerau_levenshtein_similarity);
+  Py_VISIT(traverse_module_state->__pyx_n_s_deletion);
+  Py_VISIT(traverse_module_state->__pyx_n_s_get);
   Py_VISIT(traverse_module_state->__pyx_n_u_get_scorer_flags);
+  Py_VISIT(traverse_module_state->__pyx_n_s_hamming_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_hamming_normalized_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_hamming_normalized_similarity);
+  Py_VISIT(traverse_module_state->__pyx_n_s_hamming_similarity);
   Py_VISIT(traverse_module_state->__pyx_n_s_import);
+  Py_VISIT(traverse_module_state->__pyx_n_s_indel_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_indel_editops);
+  Py_VISIT(traverse_module_state->__pyx_n_s_indel_normalized_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_indel_normalized_similarity);
+  Py_VISIT(traverse_module_state->__pyx_n_s_indel_opcodes);
+  Py_VISIT(traverse_module_state->__pyx_n_s_indel_similarity);
+  Py_VISIT(traverse_module_state->__pyx_n_s_initialize_cpp);
+  Py_VISIT(traverse_module_state->__pyx_n_s_insertion);
   Py_VISIT(traverse_module_state->__pyx_n_s_is_coroutine);
   Py_VISIT(traverse_module_state->__pyx_n_s_keys);
-  Py_VISIT(traverse_module_state->__pyx_n_s_kwargs);
+  Py_VISIT(traverse_module_state->__pyx_n_s_lcs_seq_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_lcs_seq_editops);
+  Py_VISIT(traverse_module_state->__pyx_n_s_lcs_seq_normalized_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_lcs_seq_normalized_similarity);
+  Py_VISIT(traverse_module_state->__pyx_n_s_lcs_seq_opcodes);
+  Py_VISIT(traverse_module_state->__pyx_n_s_lcs_seq_similarity);
+  Py_VISIT(traverse_module_state->__pyx_n_s_levenshtein_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_levenshtein_editops);
+  Py_VISIT(traverse_module_state->__pyx_n_s_levenshtein_normalized_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_levenshtein_normalized_similarit);
+  Py_VISIT(traverse_module_state->__pyx_n_s_levenshtein_opcodes);
+  Py_VISIT(traverse_module_state->__pyx_n_s_levenshtein_similarity);
   Py_VISIT(traverse_module_state->__pyx_n_s_main);
   Py_VISIT(traverse_module_state->__pyx_n_s_name);
-  Py_VISIT(traverse_module_state->__pyx_n_u_optimal_score);
-  Py_VISIT(traverse_module_state->__pyx_n_s_partial_ratio);
-  Py_VISIT(traverse_module_state->__pyx_n_s_partial_ratio_alignment);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_partial_ratio_alignment_line_171);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_partial_ratio_line_96);
-  Py_VISIT(traverse_module_state->__pyx_n_s_partial_token_ratio);
-  Py_VISIT(traverse_module_state->__pyx_n_s_partial_token_set_ratio);
-  Py_VISIT(traverse_module_state->__pyx_n_s_partial_token_sort_ratio);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ops);
+  Py_VISIT(traverse_module_state->__pyx_n_s_osa_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_osa_normalized_distance);
+  Py_VISIT(traverse_module_state->__pyx_n_s_osa_normalized_similarity);
+  Py_VISIT(traverse_module_state->__pyx_n_s_osa_similarity);
   Py_VISIT(traverse_module_state->__pyx_n_s_processor);
   Py_VISIT(traverse_module_state->__pyx_n_s_range);
-  Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_fuzz_cpp);
-  Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_utils);
-  Py_VISIT(traverse_module_state->__pyx_n_s_ratio);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_ratio_line_50);
-  Py_VISIT(traverse_module_state->__pyx_n_s_res);
+  Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_distance_metrics_cpp);
   Py_VISIT(traverse_module_state->__pyx_n_s_s1);
   Py_VISIT(traverse_module_state->__pyx_n_s_s1_proc);
   Py_VISIT(traverse_module_state->__pyx_n_s_s2);
   Py_VISIT(traverse_module_state->__pyx_n_s_s2_proc);
   Py_VISIT(traverse_module_state->__pyx_n_s_score_cutoff);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_score_cutoff_has_to_be_0);
   Py_VISIT(traverse_module_state->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
-  Py_VISIT(traverse_module_state->__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx);
+  Py_VISIT(traverse_module_state->__pyx_n_s_score_hint);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_score_hint_has_to_be_0);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_src_rapidfuzz_distance_metrics_c);
+  Py_VISIT(traverse_module_state->__pyx_n_s_substitution);
   Py_VISIT(traverse_module_state->__pyx_n_s_test);
-  Py_VISIT(traverse_module_state->__pyx_n_s_token_ratio);
-  Py_VISIT(traverse_module_state->__pyx_n_s_token_set_ratio);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_token_set_ratio_line_266);
-  Py_VISIT(traverse_module_state->__pyx_n_s_token_sort_ratio);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_token_sort_ratio_line_224);
   Py_VISIT(traverse_module_state->__pyx_n_s_typecode);
-  Py_VISIT(traverse_module_state->__pyx_n_u_worst_score);
+  Py_VISIT(traverse_module_state->__pyx_n_s_weights);
+  Py_VISIT(traverse_module_state->__pyx_n_u_weights);
   Py_VISIT(traverse_module_state->__pyx_int_0);
-  Py_VISIT(traverse_module_state->__pyx_int_32);
-  Py_VISIT(traverse_module_state->__pyx_int_100);
+  Py_VISIT(traverse_module_state->__pyx_int_1);
   Py_VISIT(traverse_module_state->__pyx_int_neg_1);
-  Py_VISIT(traverse_module_state->__pyx_codeobj_);
-  Py_VISIT(traverse_module_state->__pyx_tuple__16);
-  Py_VISIT(traverse_module_state->__pyx_tuple__17);
-  Py_VISIT(traverse_module_state->__pyx_tuple__18);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__2);
-  Py_VISIT(traverse_module_state->__pyx_codeobj__3);
+  Py_VISIT(traverse_module_state->__pyx_tuple_);
+  Py_VISIT(traverse_module_state->__pyx_tuple__2);
+  Py_VISIT(traverse_module_state->__pyx_tuple__3);
+  Py_VISIT(traverse_module_state->__pyx_tuple__37);
+  Py_VISIT(traverse_module_state->__pyx_tuple__38);
+  Py_VISIT(traverse_module_state->__pyx_tuple__39);
+  Py_VISIT(traverse_module_state->__pyx_tuple__40);
+  Py_VISIT(traverse_module_state->__pyx_tuple__41);
   Py_VISIT(traverse_module_state->__pyx_codeobj__4);
   Py_VISIT(traverse_module_state->__pyx_codeobj__5);
   Py_VISIT(traverse_module_state->__pyx_codeobj__6);
   Py_VISIT(traverse_module_state->__pyx_codeobj__7);
   Py_VISIT(traverse_module_state->__pyx_codeobj__8);
   Py_VISIT(traverse_module_state->__pyx_codeobj__9);
   Py_VISIT(traverse_module_state->__pyx_codeobj__10);
   Py_VISIT(traverse_module_state->__pyx_codeobj__11);
   Py_VISIT(traverse_module_state->__pyx_codeobj__12);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__13);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__14);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__15);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__16);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__17);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__18);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__19);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__20);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__21);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__22);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__23);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__24);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__25);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__26);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__27);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__28);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__29);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__30);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__31);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__32);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__33);
   return 0;
 }
 #endif
 /* #### Code section: module_state_defines ### */
 #if CYTHON_USE_MODULE_STATE
 #define __pyx_d __pyx_mstate_global->__pyx_d
 #define __pyx_b __pyx_mstate_global->__pyx_b
@@ -2944,627 +3204,1897 @@
 #ifdef __Pyx_CyFunction_USED
 #define __pyx_CyFunctionType __pyx_mstate_global->__pyx_CyFunctionType
 #endif
 #ifdef __Pyx_FusedFunction_USED
 #define __pyx_FusedFunctionType __pyx_mstate_global->__pyx_FusedFunctionType
 #endif
 #define __pyx_ptype_7cpython_4type_type __pyx_mstate_global->__pyx_ptype_7cpython_4type_type
-#define __pyx_kp_u_Calculates_a_quick_ratio_betwee __pyx_mstate_global->__pyx_kp_u_Calculates_a_quick_ratio_betwee
-#define __pyx_kp_u_Calculates_the_normalized_Indel __pyx_mstate_global->__pyx_kp_u_Calculates_the_normalized_Indel
-#define __pyx_kp_u_Compares_the_words_in_the_strin __pyx_mstate_global->__pyx_kp_u_Compares_the_words_in_the_strin
-#define __pyx_n_s_GetScorerFlagsSimilarity __pyx_mstate_global->__pyx_n_s_GetScorerFlagsSimilarity
+#define __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops __pyx_mstate_global->__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops
+#define __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Opcodes __pyx_mstate_global->__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Opcodes
+#define __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment __pyx_mstate_global->__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment
+#define __pyx_n_s_Editops __pyx_mstate_global->__pyx_n_s_Editops
 #define __pyx_kp_u_Got_unexpected_keyword_arguments __pyx_mstate_global->__pyx_kp_u_Got_unexpected_keyword_arguments
 #define __pyx_n_s_MemoryError __pyx_mstate_global->__pyx_n_s_MemoryError
-#define __pyx_n_s_QRatio __pyx_mstate_global->__pyx_n_s_QRatio
-#define __pyx_kp_u_QRatio_line_504 __pyx_mstate_global->__pyx_kp_u_QRatio_line_504
 #define __pyx_n_u_RF_Preprocess __pyx_mstate_global->__pyx_n_u_RF_Preprocess
 #define __pyx_n_s_RF_Scorer __pyx_mstate_global->__pyx_n_s_RF_Scorer
 #define __pyx_n_s_RF_ScorerPy __pyx_mstate_global->__pyx_n_s_RF_ScorerPy
-#define __pyx_n_s_ScoreAlignment __pyx_mstate_global->__pyx_n_s_ScoreAlignment
-#define __pyx_kp_u_Searches_for_the_optimal_alignm __pyx_mstate_global->__pyx_kp_u_Searches_for_the_optimal_alignm
-#define __pyx_kp_u_Searches_for_the_optimal_alignm_2 __pyx_mstate_global->__pyx_kp_u_Searches_for_the_optimal_alignm_2
-#define __pyx_kp_u_Sorts_the_words_in_the_strings __pyx_mstate_global->__pyx_kp_u_Sorts_the_words_in_the_strings
 #define __pyx_n_s_TypeError __pyx_mstate_global->__pyx_n_s_TypeError
-#define __pyx_n_s_WRatio __pyx_mstate_global->__pyx_n_s_WRatio
-#define __pyx_kp_u__13 __pyx_mstate_global->__pyx_kp_u__13
-#define __pyx_kp_u__14 __pyx_mstate_global->__pyx_kp_u__14
-#define __pyx_kp_u__15 __pyx_mstate_global->__pyx_kp_u__15
-#define __pyx_n_s__19 __pyx_mstate_global->__pyx_n_s__19
+#define __pyx_n_s_ValueError __pyx_mstate_global->__pyx_n_s_ValueError
+#define __pyx_kp_u__34 __pyx_mstate_global->__pyx_kp_u__34
+#define __pyx_kp_u__35 __pyx_mstate_global->__pyx_kp_u__35
+#define __pyx_kp_u__36 __pyx_mstate_global->__pyx_kp_u__36
+#define __pyx_n_s__42 __pyx_mstate_global->__pyx_n_s__42
 #define __pyx_n_s_array __pyx_mstate_global->__pyx_n_s_array
+#define __pyx_n_s_as_opcodes __pyx_mstate_global->__pyx_n_s_as_opcodes
 #define __pyx_n_s_asyncio_coroutines __pyx_mstate_global->__pyx_n_s_asyncio_coroutines
 #define __pyx_n_s_c_score_cutoff __pyx_mstate_global->__pyx_n_s_c_score_cutoff
+#define __pyx_n_s_c_score_hint __pyx_mstate_global->__pyx_n_s_c_score_hint
 #define __pyx_n_s_cline_in_traceback __pyx_mstate_global->__pyx_n_s_cline_in_traceback
-#define __pyx_n_s_default_process __pyx_mstate_global->__pyx_n_s_default_process
-#define __pyx_n_s_distance__initialize_cpp __pyx_mstate_global->__pyx_n_s_distance__initialize_cpp
-#define __pyx_n_u_flags __pyx_mstate_global->__pyx_n_u_flags
+#define __pyx_n_s_damerau_levenshtein_distance __pyx_mstate_global->__pyx_n_s_damerau_levenshtein_distance
+#define __pyx_n_s_damerau_levenshtein_normalized_d __pyx_mstate_global->__pyx_n_s_damerau_levenshtein_normalized_d
+#define __pyx_n_s_damerau_levenshtein_normalized_s __pyx_mstate_global->__pyx_n_s_damerau_levenshtein_normalized_s
+#define __pyx_n_s_damerau_levenshtein_similarity __pyx_mstate_global->__pyx_n_s_damerau_levenshtein_similarity
+#define __pyx_n_s_deletion __pyx_mstate_global->__pyx_n_s_deletion
+#define __pyx_n_s_get __pyx_mstate_global->__pyx_n_s_get
 #define __pyx_n_u_get_scorer_flags __pyx_mstate_global->__pyx_n_u_get_scorer_flags
+#define __pyx_n_s_hamming_distance __pyx_mstate_global->__pyx_n_s_hamming_distance
+#define __pyx_n_s_hamming_normalized_distance __pyx_mstate_global->__pyx_n_s_hamming_normalized_distance
+#define __pyx_n_s_hamming_normalized_similarity __pyx_mstate_global->__pyx_n_s_hamming_normalized_similarity
+#define __pyx_n_s_hamming_similarity __pyx_mstate_global->__pyx_n_s_hamming_similarity
 #define __pyx_n_s_import __pyx_mstate_global->__pyx_n_s_import
+#define __pyx_n_s_indel_distance __pyx_mstate_global->__pyx_n_s_indel_distance
+#define __pyx_n_s_indel_editops __pyx_mstate_global->__pyx_n_s_indel_editops
+#define __pyx_n_s_indel_normalized_distance __pyx_mstate_global->__pyx_n_s_indel_normalized_distance
+#define __pyx_n_s_indel_normalized_similarity __pyx_mstate_global->__pyx_n_s_indel_normalized_similarity
+#define __pyx_n_s_indel_opcodes __pyx_mstate_global->__pyx_n_s_indel_opcodes
+#define __pyx_n_s_indel_similarity __pyx_mstate_global->__pyx_n_s_indel_similarity
+#define __pyx_n_s_initialize_cpp __pyx_mstate_global->__pyx_n_s_initialize_cpp
+#define __pyx_n_s_insertion __pyx_mstate_global->__pyx_n_s_insertion
 #define __pyx_n_s_is_coroutine __pyx_mstate_global->__pyx_n_s_is_coroutine
 #define __pyx_n_s_keys __pyx_mstate_global->__pyx_n_s_keys
-#define __pyx_n_s_kwargs __pyx_mstate_global->__pyx_n_s_kwargs
+#define __pyx_n_s_lcs_seq_distance __pyx_mstate_global->__pyx_n_s_lcs_seq_distance
+#define __pyx_n_s_lcs_seq_editops __pyx_mstate_global->__pyx_n_s_lcs_seq_editops
+#define __pyx_n_s_lcs_seq_normalized_distance __pyx_mstate_global->__pyx_n_s_lcs_seq_normalized_distance
+#define __pyx_n_s_lcs_seq_normalized_similarity __pyx_mstate_global->__pyx_n_s_lcs_seq_normalized_similarity
+#define __pyx_n_s_lcs_seq_opcodes __pyx_mstate_global->__pyx_n_s_lcs_seq_opcodes
+#define __pyx_n_s_lcs_seq_similarity __pyx_mstate_global->__pyx_n_s_lcs_seq_similarity
+#define __pyx_n_s_levenshtein_distance __pyx_mstate_global->__pyx_n_s_levenshtein_distance
+#define __pyx_n_s_levenshtein_editops __pyx_mstate_global->__pyx_n_s_levenshtein_editops
+#define __pyx_n_s_levenshtein_normalized_distance __pyx_mstate_global->__pyx_n_s_levenshtein_normalized_distance
+#define __pyx_n_s_levenshtein_normalized_similarit __pyx_mstate_global->__pyx_n_s_levenshtein_normalized_similarit
+#define __pyx_n_s_levenshtein_opcodes __pyx_mstate_global->__pyx_n_s_levenshtein_opcodes
+#define __pyx_n_s_levenshtein_similarity __pyx_mstate_global->__pyx_n_s_levenshtein_similarity
 #define __pyx_n_s_main __pyx_mstate_global->__pyx_n_s_main
 #define __pyx_n_s_name __pyx_mstate_global->__pyx_n_s_name
-#define __pyx_n_u_optimal_score __pyx_mstate_global->__pyx_n_u_optimal_score
-#define __pyx_n_s_partial_ratio __pyx_mstate_global->__pyx_n_s_partial_ratio
-#define __pyx_n_s_partial_ratio_alignment __pyx_mstate_global->__pyx_n_s_partial_ratio_alignment
-#define __pyx_kp_u_partial_ratio_alignment_line_171 __pyx_mstate_global->__pyx_kp_u_partial_ratio_alignment_line_171
-#define __pyx_kp_u_partial_ratio_line_96 __pyx_mstate_global->__pyx_kp_u_partial_ratio_line_96
-#define __pyx_n_s_partial_token_ratio __pyx_mstate_global->__pyx_n_s_partial_token_ratio
-#define __pyx_n_s_partial_token_set_ratio __pyx_mstate_global->__pyx_n_s_partial_token_set_ratio
-#define __pyx_n_s_partial_token_sort_ratio __pyx_mstate_global->__pyx_n_s_partial_token_sort_ratio
+#define __pyx_n_s_ops __pyx_mstate_global->__pyx_n_s_ops
+#define __pyx_n_s_osa_distance __pyx_mstate_global->__pyx_n_s_osa_distance
+#define __pyx_n_s_osa_normalized_distance __pyx_mstate_global->__pyx_n_s_osa_normalized_distance
+#define __pyx_n_s_osa_normalized_similarity __pyx_mstate_global->__pyx_n_s_osa_normalized_similarity
+#define __pyx_n_s_osa_similarity __pyx_mstate_global->__pyx_n_s_osa_similarity
 #define __pyx_n_s_processor __pyx_mstate_global->__pyx_n_s_processor
 #define __pyx_n_s_range __pyx_mstate_global->__pyx_n_s_range
-#define __pyx_n_s_rapidfuzz_fuzz_cpp __pyx_mstate_global->__pyx_n_s_rapidfuzz_fuzz_cpp
-#define __pyx_n_s_rapidfuzz_utils __pyx_mstate_global->__pyx_n_s_rapidfuzz_utils
-#define __pyx_n_s_ratio __pyx_mstate_global->__pyx_n_s_ratio
-#define __pyx_kp_u_ratio_line_50 __pyx_mstate_global->__pyx_kp_u_ratio_line_50
-#define __pyx_n_s_res __pyx_mstate_global->__pyx_n_s_res
+#define __pyx_n_s_rapidfuzz_distance_metrics_cpp __pyx_mstate_global->__pyx_n_s_rapidfuzz_distance_metrics_cpp
 #define __pyx_n_s_s1 __pyx_mstate_global->__pyx_n_s_s1
 #define __pyx_n_s_s1_proc __pyx_mstate_global->__pyx_n_s_s1_proc
 #define __pyx_n_s_s2 __pyx_mstate_global->__pyx_n_s_s2
 #define __pyx_n_s_s2_proc __pyx_mstate_global->__pyx_n_s_s2_proc
 #define __pyx_n_s_score_cutoff __pyx_mstate_global->__pyx_n_s_score_cutoff
+#define __pyx_kp_u_score_cutoff_has_to_be_0 __pyx_mstate_global->__pyx_kp_u_score_cutoff_has_to_be_0
 #define __pyx_kp_u_score_cutoff_has_to_be_in_the_ra __pyx_mstate_global->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra
-#define __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx __pyx_mstate_global->__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx
+#define __pyx_n_s_score_hint __pyx_mstate_global->__pyx_n_s_score_hint
+#define __pyx_kp_u_score_hint_has_to_be_0 __pyx_mstate_global->__pyx_kp_u_score_hint_has_to_be_0
+#define __pyx_kp_s_src_rapidfuzz_distance_metrics_c __pyx_mstate_global->__pyx_kp_s_src_rapidfuzz_distance_metrics_c
+#define __pyx_n_s_substitution __pyx_mstate_global->__pyx_n_s_substitution
 #define __pyx_n_s_test __pyx_mstate_global->__pyx_n_s_test
-#define __pyx_n_s_token_ratio __pyx_mstate_global->__pyx_n_s_token_ratio
-#define __pyx_n_s_token_set_ratio __pyx_mstate_global->__pyx_n_s_token_set_ratio
-#define __pyx_kp_u_token_set_ratio_line_266 __pyx_mstate_global->__pyx_kp_u_token_set_ratio_line_266
-#define __pyx_n_s_token_sort_ratio __pyx_mstate_global->__pyx_n_s_token_sort_ratio
-#define __pyx_kp_u_token_sort_ratio_line_224 __pyx_mstate_global->__pyx_kp_u_token_sort_ratio_line_224
 #define __pyx_n_s_typecode __pyx_mstate_global->__pyx_n_s_typecode
-#define __pyx_n_u_worst_score __pyx_mstate_global->__pyx_n_u_worst_score
+#define __pyx_n_s_weights __pyx_mstate_global->__pyx_n_s_weights
+#define __pyx_n_u_weights __pyx_mstate_global->__pyx_n_u_weights
 #define __pyx_int_0 __pyx_mstate_global->__pyx_int_0
-#define __pyx_int_32 __pyx_mstate_global->__pyx_int_32
-#define __pyx_int_100 __pyx_mstate_global->__pyx_int_100
+#define __pyx_int_1 __pyx_mstate_global->__pyx_int_1
 #define __pyx_int_neg_1 __pyx_mstate_global->__pyx_int_neg_1
-#define __pyx_codeobj_ __pyx_mstate_global->__pyx_codeobj_
-#define __pyx_tuple__16 __pyx_mstate_global->__pyx_tuple__16
-#define __pyx_tuple__17 __pyx_mstate_global->__pyx_tuple__17
-#define __pyx_tuple__18 __pyx_mstate_global->__pyx_tuple__18
-#define __pyx_codeobj__2 __pyx_mstate_global->__pyx_codeobj__2
-#define __pyx_codeobj__3 __pyx_mstate_global->__pyx_codeobj__3
+#define __pyx_tuple_ __pyx_mstate_global->__pyx_tuple_
+#define __pyx_tuple__2 __pyx_mstate_global->__pyx_tuple__2
+#define __pyx_tuple__3 __pyx_mstate_global->__pyx_tuple__3
+#define __pyx_tuple__37 __pyx_mstate_global->__pyx_tuple__37
+#define __pyx_tuple__38 __pyx_mstate_global->__pyx_tuple__38
+#define __pyx_tuple__39 __pyx_mstate_global->__pyx_tuple__39
+#define __pyx_tuple__40 __pyx_mstate_global->__pyx_tuple__40
+#define __pyx_tuple__41 __pyx_mstate_global->__pyx_tuple__41
 #define __pyx_codeobj__4 __pyx_mstate_global->__pyx_codeobj__4
 #define __pyx_codeobj__5 __pyx_mstate_global->__pyx_codeobj__5
 #define __pyx_codeobj__6 __pyx_mstate_global->__pyx_codeobj__6
 #define __pyx_codeobj__7 __pyx_mstate_global->__pyx_codeobj__7
 #define __pyx_codeobj__8 __pyx_mstate_global->__pyx_codeobj__8
 #define __pyx_codeobj__9 __pyx_mstate_global->__pyx_codeobj__9
 #define __pyx_codeobj__10 __pyx_mstate_global->__pyx_codeobj__10
 #define __pyx_codeobj__11 __pyx_mstate_global->__pyx_codeobj__11
 #define __pyx_codeobj__12 __pyx_mstate_global->__pyx_codeobj__12
+#define __pyx_codeobj__13 __pyx_mstate_global->__pyx_codeobj__13
+#define __pyx_codeobj__14 __pyx_mstate_global->__pyx_codeobj__14
+#define __pyx_codeobj__15 __pyx_mstate_global->__pyx_codeobj__15
+#define __pyx_codeobj__16 __pyx_mstate_global->__pyx_codeobj__16
+#define __pyx_codeobj__17 __pyx_mstate_global->__pyx_codeobj__17
+#define __pyx_codeobj__18 __pyx_mstate_global->__pyx_codeobj__18
+#define __pyx_codeobj__19 __pyx_mstate_global->__pyx_codeobj__19
+#define __pyx_codeobj__20 __pyx_mstate_global->__pyx_codeobj__20
+#define __pyx_codeobj__21 __pyx_mstate_global->__pyx_codeobj__21
+#define __pyx_codeobj__22 __pyx_mstate_global->__pyx_codeobj__22
+#define __pyx_codeobj__23 __pyx_mstate_global->__pyx_codeobj__23
+#define __pyx_codeobj__24 __pyx_mstate_global->__pyx_codeobj__24
+#define __pyx_codeobj__25 __pyx_mstate_global->__pyx_codeobj__25
+#define __pyx_codeobj__26 __pyx_mstate_global->__pyx_codeobj__26
+#define __pyx_codeobj__27 __pyx_mstate_global->__pyx_codeobj__27
+#define __pyx_codeobj__28 __pyx_mstate_global->__pyx_codeobj__28
+#define __pyx_codeobj__29 __pyx_mstate_global->__pyx_codeobj__29
+#define __pyx_codeobj__30 __pyx_mstate_global->__pyx_codeobj__30
+#define __pyx_codeobj__31 __pyx_mstate_global->__pyx_codeobj__31
+#define __pyx_codeobj__32 __pyx_mstate_global->__pyx_codeobj__32
+#define __pyx_codeobj__33 __pyx_mstate_global->__pyx_codeobj__33
 #endif
 /* #### Code section: module_code ### */
 
-/* "rapidfuzz/fuzz_cpp.pyx":50
- *     bool QRatioInit(                RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
+/* "rapidfuzz/distance/metrics_cpp.pyx":101
+ * 
+ * 
+ * cdef int64_t get_score_cutoff_i64(score_cutoff, int64_t default) except -1:             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = default
+ *     if score_cutoff is None:
+ */
+
+static int64_t __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(PyObject *__pyx_v_score_cutoff, int64_t __pyx_v_default) {
+  int64_t __pyx_v_c_score_cutoff;
+  int64_t __pyx_r;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  int64_t __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("get_score_cutoff_i64", 0);
+  __Pyx_TraceCall("get_score_cutoff_i64", __pyx_f[0], 101, 0, __PYX_ERR(0, 101, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":102
+ * 
+ * cdef int64_t get_score_cutoff_i64(score_cutoff, int64_t default) except -1:
+ *     cdef int64_t c_score_cutoff = default             # <<<<<<<<<<<<<<
+ *     if score_cutoff is None:
+ *         return c_score_cutoff
+ */
+  __Pyx_TraceLine(102,0,__PYX_ERR(0, 102, __pyx_L1_error))
+  __pyx_v_c_score_cutoff = __pyx_v_default;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":103
+ * cdef int64_t get_score_cutoff_i64(score_cutoff, int64_t default) except -1:
+ *     cdef int64_t c_score_cutoff = default
+ *     if score_cutoff is None:             # <<<<<<<<<<<<<<
+ *         return c_score_cutoff
+ * 
+ */
+  __Pyx_TraceLine(103,0,__PYX_ERR(0, 103, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":104
+ *     cdef int64_t c_score_cutoff = default
+ *     if score_cutoff is None:
+ *         return c_score_cutoff             # <<<<<<<<<<<<<<
+ * 
+ *     c_score_cutoff = score_cutoff
+ */
+    __Pyx_TraceLine(104,0,__PYX_ERR(0, 104, __pyx_L1_error))
+    __pyx_r = __pyx_v_c_score_cutoff;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":103
+ * cdef int64_t get_score_cutoff_i64(score_cutoff, int64_t default) except -1:
+ *     cdef int64_t c_score_cutoff = default
+ *     if score_cutoff is None:             # <<<<<<<<<<<<<<
+ *         return c_score_cutoff
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":106
+ *         return c_score_cutoff
+ * 
+ *     c_score_cutoff = score_cutoff             # <<<<<<<<<<<<<<
+ *     if c_score_cutoff < 0:
+ *         raise ValueError("score_cutoff has to be >= 0")
+ */
+  __Pyx_TraceLine(106,0,__PYX_ERR(0, 106, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyInt_As_int64_t(__pyx_v_score_cutoff); if (unlikely((__pyx_t_2 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 106, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_2;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":107
+ * 
+ *     c_score_cutoff = score_cutoff
+ *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
+ *         raise ValueError("score_cutoff has to be >= 0")
+ * 
+ */
+  __Pyx_TraceLine(107,0,__PYX_ERR(0, 107, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_c_score_cutoff < 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":108
+ *     c_score_cutoff = score_cutoff
+ *     if c_score_cutoff < 0:
+ *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
+ * 
+ *     return c_score_cutoff
+ */
+    __Pyx_TraceLine(108,0,__PYX_ERR(0, 108, __pyx_L1_error))
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 108, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __PYX_ERR(0, 108, __pyx_L1_error)
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":107
+ * 
+ *     c_score_cutoff = score_cutoff
+ *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
+ *         raise ValueError("score_cutoff has to be >= 0")
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":110
+ *         raise ValueError("score_cutoff has to be >= 0")
+ * 
+ *     return c_score_cutoff             # <<<<<<<<<<<<<<
+ * 
+ * cdef double get_score_cutoff_f64(score_cutoff, double default) except -1:
+ */
+  __Pyx_TraceLine(110,0,__PYX_ERR(0, 110, __pyx_L1_error))
+  __pyx_r = __pyx_v_c_score_cutoff;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":101
+ * 
+ * 
+ * cdef int64_t get_score_cutoff_i64(score_cutoff, int64_t default) except -1:             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = default
+ *     if score_cutoff is None:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.get_score_cutoff_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1L;
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":112
+ *     return c_score_cutoff
+ * 
+ * cdef double get_score_cutoff_f64(score_cutoff, double default) except -1:             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = default
+ *     if score_cutoff is None:
+ */
+
+static double __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(PyObject *__pyx_v_score_cutoff, double __pyx_v_default) {
+  double __pyx_v_c_score_cutoff;
+  double __pyx_r;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  double __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("get_score_cutoff_f64", 0);
+  __Pyx_TraceCall("get_score_cutoff_f64", __pyx_f[0], 112, 0, __PYX_ERR(0, 112, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":113
+ * 
+ * cdef double get_score_cutoff_f64(score_cutoff, double default) except -1:
+ *     cdef double c_score_cutoff = default             # <<<<<<<<<<<<<<
+ *     if score_cutoff is None:
+ *         return c_score_cutoff
+ */
+  __Pyx_TraceLine(113,0,__PYX_ERR(0, 113, __pyx_L1_error))
+  __pyx_v_c_score_cutoff = __pyx_v_default;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":114
+ * cdef double get_score_cutoff_f64(score_cutoff, double default) except -1:
+ *     cdef double c_score_cutoff = default
+ *     if score_cutoff is None:             # <<<<<<<<<<<<<<
+ *         return c_score_cutoff
+ * 
+ */
+  __Pyx_TraceLine(114,0,__PYX_ERR(0, 114, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_score_cutoff == Py_None);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":115
+ *     cdef double c_score_cutoff = default
+ *     if score_cutoff is None:
+ *         return c_score_cutoff             # <<<<<<<<<<<<<<
+ * 
+ *     c_score_cutoff = score_cutoff
+ */
+    __Pyx_TraceLine(115,0,__PYX_ERR(0, 115, __pyx_L1_error))
+    __pyx_r = __pyx_v_c_score_cutoff;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":114
+ * cdef double get_score_cutoff_f64(score_cutoff, double default) except -1:
+ *     cdef double c_score_cutoff = default
+ *     if score_cutoff is None:             # <<<<<<<<<<<<<<
+ *         return c_score_cutoff
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":117
+ *         return c_score_cutoff
  * 
- * def ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the normalized Indel distance.
+ *     c_score_cutoff = score_cutoff             # <<<<<<<<<<<<<<
+ *     if c_score_cutoff < 0:
+ *         raise ValueError("score_cutoff has to be >= 0")
+ */
+  __Pyx_TraceLine(117,0,__PYX_ERR(0, 117, __pyx_L1_error))
+  __pyx_t_2 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_2 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 117, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_2;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":118
+ * 
+ *     c_score_cutoff = score_cutoff
+ *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
+ *         raise ValueError("score_cutoff has to be >= 0")
+ * 
+ */
+  __Pyx_TraceLine(118,0,__PYX_ERR(0, 118, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_c_score_cutoff < 0.0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":119
+ *     c_score_cutoff = score_cutoff
+ *     if c_score_cutoff < 0:
+ *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
+ * 
+ *     return c_score_cutoff
+ */
+    __Pyx_TraceLine(119,0,__PYX_ERR(0, 119, __pyx_L1_error))
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 119, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __PYX_ERR(0, 119, __pyx_L1_error)
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":118
+ * 
+ *     c_score_cutoff = score_cutoff
+ *     if c_score_cutoff < 0:             # <<<<<<<<<<<<<<
+ *         raise ValueError("score_cutoff has to be >= 0")
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":121
+ *         raise ValueError("score_cutoff has to be >= 0")
+ * 
+ *     return c_score_cutoff             # <<<<<<<<<<<<<<
+ * 
+ * cdef int64_t get_score_hint_i64(score_hint, int64_t default) except -1:
+ */
+  __Pyx_TraceLine(121,0,__PYX_ERR(0, 121, __pyx_L1_error))
+  __pyx_r = __pyx_v_c_score_cutoff;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":112
+ *     return c_score_cutoff
+ * 
+ * cdef double get_score_cutoff_f64(score_cutoff, double default) except -1:             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = default
+ *     if score_cutoff is None:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.get_score_cutoff_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1.0;
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":123
+ *     return c_score_cutoff
+ * 
+ * cdef int64_t get_score_hint_i64(score_hint, int64_t default) except -1:             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_hint = default
+ *     if score_hint is None:
+ */
+
+static int64_t __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_hint_i64(PyObject *__pyx_v_score_hint, int64_t __pyx_v_default) {
+  int64_t __pyx_v_c_score_hint;
+  int64_t __pyx_r;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  int64_t __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("get_score_hint_i64", 0);
+  __Pyx_TraceCall("get_score_hint_i64", __pyx_f[0], 123, 0, __PYX_ERR(0, 123, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":124
+ * 
+ * cdef int64_t get_score_hint_i64(score_hint, int64_t default) except -1:
+ *     cdef int64_t c_score_hint = default             # <<<<<<<<<<<<<<
+ *     if score_hint is None:
+ *         return c_score_hint
+ */
+  __Pyx_TraceLine(124,0,__PYX_ERR(0, 124, __pyx_L1_error))
+  __pyx_v_c_score_hint = __pyx_v_default;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":125
+ * cdef int64_t get_score_hint_i64(score_hint, int64_t default) except -1:
+ *     cdef int64_t c_score_hint = default
+ *     if score_hint is None:             # <<<<<<<<<<<<<<
+ *         return c_score_hint
+ * 
+ */
+  __Pyx_TraceLine(125,0,__PYX_ERR(0, 125, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_score_hint == Py_None);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":126
+ *     cdef int64_t c_score_hint = default
+ *     if score_hint is None:
+ *         return c_score_hint             # <<<<<<<<<<<<<<
+ * 
+ *     c_score_hint = score_hint
+ */
+    __Pyx_TraceLine(126,0,__PYX_ERR(0, 126, __pyx_L1_error))
+    __pyx_r = __pyx_v_c_score_hint;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":125
+ * cdef int64_t get_score_hint_i64(score_hint, int64_t default) except -1:
+ *     cdef int64_t c_score_hint = default
+ *     if score_hint is None:             # <<<<<<<<<<<<<<
+ *         return c_score_hint
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":128
+ *         return c_score_hint
+ * 
+ *     c_score_hint = score_hint             # <<<<<<<<<<<<<<
+ *     if c_score_hint < 0:
+ *         raise ValueError("score_hint has to be >= 0")
+ */
+  __Pyx_TraceLine(128,0,__PYX_ERR(0, 128, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyInt_As_int64_t(__pyx_v_score_hint); if (unlikely((__pyx_t_2 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 128, __pyx_L1_error)
+  __pyx_v_c_score_hint = __pyx_t_2;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":129
+ * 
+ *     c_score_hint = score_hint
+ *     if c_score_hint < 0:             # <<<<<<<<<<<<<<
+ *         raise ValueError("score_hint has to be >= 0")
+ * 
+ */
+  __Pyx_TraceLine(129,0,__PYX_ERR(0, 129, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_c_score_hint < 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":130
+ *     c_score_hint = score_hint
+ *     if c_score_hint < 0:
+ *         raise ValueError("score_hint has to be >= 0")             # <<<<<<<<<<<<<<
+ * 
+ *     return c_score_hint
+ */
+    __Pyx_TraceLine(130,0,__PYX_ERR(0, 130, __pyx_L1_error))
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 130, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __PYX_ERR(0, 130, __pyx_L1_error)
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":129
+ * 
+ *     c_score_hint = score_hint
+ *     if c_score_hint < 0:             # <<<<<<<<<<<<<<
+ *         raise ValueError("score_hint has to be >= 0")
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":132
+ *         raise ValueError("score_hint has to be >= 0")
+ * 
+ *     return c_score_hint             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(132,0,__PYX_ERR(0, 132, __pyx_L1_error))
+  __pyx_r = __pyx_v_c_score_hint;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":123
+ *     return c_score_cutoff
+ * 
+ * cdef int64_t get_score_hint_i64(score_hint, int64_t default) except -1:             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_hint = default
+ *     if score_hint is None:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.get_score_hint_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1L;
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":135
+ * 
+ * 
+ * def levenshtein_distance(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef int64_t insertion, deletion, substitution
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_1ratio(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_1levenshtein_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_ratio, "\n    Calculates the normalized Indel distance.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    See Also\n    --------\n    rapidfuzz.string_metric.normalized_levenshtein : Normalized levenshtein distance\n\n    Notes\n    -----\n    .. image:: img/ratio.svg\n\n    Examples\n    --------\n    >>> fuzz.ratio(\"this is a test\", \"this is a test!\")\n    96.55171966552734\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_1ratio = {"ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_1ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_ratio};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_1ratio(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_1levenshtein_distance = {"levenshtein_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_1levenshtein_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_1levenshtein_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
   PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_weights = 0;
   PyObject *__pyx_v_processor = 0;
   PyObject *__pyx_v_score_cutoff = 0;
   #if !CYTHON_METH_FASTCALL
   CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("ratio (wrapper)", 0);
+  __Pyx_RefNannySetupContext("levenshtein_distance (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
-    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_weights,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_weights,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
-    PyObject* values[4] = {0,0,0,0};
-    values[2] = ((PyObject *)((PyObject *)Py_None));
+    PyObject* values[5] = {0,0,0,0,0};
+    values[2] = ((PyObject *)((PyObject*)__pyx_tuple__3));
     values[3] = ((PyObject *)((PyObject *)Py_None));
+    values[4] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 50, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 135, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 50, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 135, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("ratio", 1, 2, 2, 1); __PYX_ERR(0, 50, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("levenshtein_distance", 1, 2, 2, 1); __PYX_ERR(0, 135, __pyx_L3_error)
         }
       }
-      if (kw_args > 0 && likely(kw_args <= 2)) {
+      if (kw_args > 0 && likely(kw_args <= 3)) {
         Py_ssize_t index;
-        for (index = 2; index < 4 && kw_args > 0; index++) {
+        for (index = 2; index < 5 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 50, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 135, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "ratio") < 0)) __PYX_ERR(0, 50, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "levenshtein_distance") < 0)) __PYX_ERR(0, 135, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
-    __pyx_v_processor = values[2];
-    __pyx_v_score_cutoff = values[3];
+    __pyx_v_weights = values[2];
+    __pyx_v_processor = values[3];
+    __pyx_v_score_cutoff = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 50, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("levenshtein_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 135, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_levenshtein_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_weights, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_levenshtein_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_weights, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
+  int64_t __pyx_v_insertion;
+  int64_t __pyx_v_deletion;
+  int64_t __pyx_v_substitution;
+  int64_t __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
-  int __pyx_t_2;
-  double __pyx_t_3;
-  int __pyx_t_4;
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
+  PyObject *(*__pyx_t_6)(PyObject *);
+  int64_t __pyx_t_7;
+  int64_t __pyx_t_8;
+  int64_t __pyx_t_9;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj_)
-  __Pyx_RefNannySetupContext("ratio", 0);
-  __Pyx_TraceCall("ratio", __pyx_f[0], 50, 0, __PYX_ERR(0, 50, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__4)
+  __Pyx_RefNannySetupContext("levenshtein_distance", 0);
+  __Pyx_TraceCall("levenshtein_distance", __pyx_f[0], 135, 0, __PYX_ERR(0, 135, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":86
- *     96.55171966552734
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":138
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1             # <<<<<<<<<<<<<<
+ *     if weights is not None:
+ *         insertion, deletion, substitution = weights
+ */
+  __Pyx_TraceLine(138,0,__PYX_ERR(0, 138, __pyx_L1_error))
+  __pyx_v_insertion = 1;
+  __pyx_v_deletion = 1;
+  __pyx_v_substitution = 1;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":139
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:             # <<<<<<<<<<<<<<
+ *         insertion, deletion, substitution = weights
+ * 
+ */
+  __Pyx_TraceLine(139,0,__PYX_ERR(0, 139, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_weights != Py_None);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":140
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:
+ *         insertion, deletion, substitution = weights             # <<<<<<<<<<<<<<
+ * 
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ */
+    __Pyx_TraceLine(140,0,__PYX_ERR(0, 140, __pyx_L1_error))
+    if ((likely(PyTuple_CheckExact(__pyx_v_weights))) || (PyList_CheckExact(__pyx_v_weights))) {
+      PyObject* sequence = __pyx_v_weights;
+      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
+      if (unlikely(size != 3)) {
+        if (size > 3) __Pyx_RaiseTooManyValuesError(3);
+        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
+        __PYX_ERR(0, 140, __pyx_L1_error)
+      }
+      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+      if (likely(PyTuple_CheckExact(sequence))) {
+        __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
+        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
+        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 2); 
+      } else {
+        __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
+        __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
+        __pyx_t_4 = PyList_GET_ITEM(sequence, 2); 
+      }
+      __Pyx_INCREF(__pyx_t_2);
+      __Pyx_INCREF(__pyx_t_3);
+      __Pyx_INCREF(__pyx_t_4);
+      #else
+      __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 140, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 140, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 140, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      #endif
+    } else {
+      Py_ssize_t index = -1;
+      __pyx_t_5 = PyObject_GetIter(__pyx_v_weights); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 140, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5);
+      index = 0; __pyx_t_2 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L4_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_2);
+      index = 1; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L4_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_3);
+      index = 2; __pyx_t_4 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_4)) goto __pyx_L4_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_4);
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 3) < 0) __PYX_ERR(0, 140, __pyx_L1_error)
+      __pyx_t_6 = NULL;
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      goto __pyx_L5_unpacking_done;
+      __pyx_L4_unpacking_failed:;
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_6 = NULL;
+      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
+      __PYX_ERR(0, 140, __pyx_L1_error)
+      __pyx_L5_unpacking_done:;
+    }
+    __pyx_t_7 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_7 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 140, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_8 = __Pyx_PyInt_As_int64_t(__pyx_t_3); if (unlikely((__pyx_t_8 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 140, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_9 = __Pyx_PyInt_As_int64_t(__pyx_t_4); if (unlikely((__pyx_t_9 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 140, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_v_insertion = __pyx_t_7;
+    __pyx_v_deletion = __pyx_t_8;
+    __pyx_v_substitution = __pyx_t_9;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":139
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:             # <<<<<<<<<<<<<<
+ *         insertion, deletion, substitution = weights
  * 
  */
-  __Pyx_TraceLine(86,0,__PYX_ERR(0, 86, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
-  } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 86, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
   }
-  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":89
+  /* "rapidfuzz/distance/metrics_cpp.pyx":142
+ *         insertion, deletion, substitution = weights
+ * 
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return levenshtein_distance_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)
+ */
+  __Pyx_TraceLine(142,0,__PYX_ERR(0, 142, __pyx_L1_error))
+  __pyx_t_9 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, INT64_MAX); if (unlikely(__pyx_t_9 == ((int64_t)-1L))) __PYX_ERR(0, 142, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_9;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":143
+ * 
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return levenshtein_distance_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(143,0,__PYX_ERR(0, 143, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 143, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":144
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return levenshtein_distance_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(144,0,__PYX_ERR(0, 144, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_9 = levenshtein_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_insertion, __pyx_v_deletion, __pyx_v_substitution, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 144, __pyx_L1_error)
+  }
+  __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":135
+ * 
+ * 
+ * def levenshtein_distance(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef int64_t insertion, deletion, substitution
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":147
+ * 
+ * 
+ * def levenshtein_similarity(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef int64_t insertion, deletion, substitution
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_3levenshtein_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_3levenshtein_similarity = {"levenshtein_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_3levenshtein_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_3levenshtein_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_weights = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("levenshtein_similarity (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_weights,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_weights,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[5] = {0,0,0,0,0};
+    values[2] = ((PyObject *)((PyObject*)__pyx_tuple__3));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    values[4] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 147, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 147, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("levenshtein_similarity", 1, 2, 2, 1); __PYX_ERR(0, 147, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 3)) {
+        Py_ssize_t index;
+        for (index = 2; index < 5 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 147, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "levenshtein_similarity") < 0)) __PYX_ERR(0, 147, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_weights = values[2];
+    __pyx_v_processor = values[3];
+    __pyx_v_score_cutoff = values[4];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("levenshtein_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 147, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_2levenshtein_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_weights, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_2levenshtein_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_weights, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  int64_t __pyx_v_insertion;
+  int64_t __pyx_v_deletion;
+  int64_t __pyx_v_substitution;
+  int64_t __pyx_v_c_score_cutoff;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *(*__pyx_t_6)(PyObject *);
+  int64_t __pyx_t_7;
+  int64_t __pyx_t_8;
+  int64_t __pyx_t_9;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__5)
+  __Pyx_RefNannySetupContext("levenshtein_similarity", 0);
+  __Pyx_TraceCall("levenshtein_similarity", __pyx_f[0], 147, 0, __PYX_ERR(0, 147, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":150
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1             # <<<<<<<<<<<<<<
+ *     if weights is not None:
+ *         insertion, deletion, substitution = weights
+ */
+  __Pyx_TraceLine(150,0,__PYX_ERR(0, 150, __pyx_L1_error))
+  __pyx_v_insertion = 1;
+  __pyx_v_deletion = 1;
+  __pyx_v_substitution = 1;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":151
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:             # <<<<<<<<<<<<<<
+ *         insertion, deletion, substitution = weights
+ * 
+ */
+  __Pyx_TraceLine(151,0,__PYX_ERR(0, 151, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_weights != Py_None);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":152
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:
+ *         insertion, deletion, substitution = weights             # <<<<<<<<<<<<<<
+ * 
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ */
+    __Pyx_TraceLine(152,0,__PYX_ERR(0, 152, __pyx_L1_error))
+    if ((likely(PyTuple_CheckExact(__pyx_v_weights))) || (PyList_CheckExact(__pyx_v_weights))) {
+      PyObject* sequence = __pyx_v_weights;
+      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
+      if (unlikely(size != 3)) {
+        if (size > 3) __Pyx_RaiseTooManyValuesError(3);
+        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
+        __PYX_ERR(0, 152, __pyx_L1_error)
+      }
+      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+      if (likely(PyTuple_CheckExact(sequence))) {
+        __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
+        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
+        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 2); 
+      } else {
+        __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
+        __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
+        __pyx_t_4 = PyList_GET_ITEM(sequence, 2); 
+      }
+      __Pyx_INCREF(__pyx_t_2);
+      __Pyx_INCREF(__pyx_t_3);
+      __Pyx_INCREF(__pyx_t_4);
+      #else
+      __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 152, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_2);
+      __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 152, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 152, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      #endif
+    } else {
+      Py_ssize_t index = -1;
+      __pyx_t_5 = PyObject_GetIter(__pyx_v_weights); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 152, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5);
+      index = 0; __pyx_t_2 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L4_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_2);
+      index = 1; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L4_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_3);
+      index = 2; __pyx_t_4 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_4)) goto __pyx_L4_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_4);
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 3) < 0) __PYX_ERR(0, 152, __pyx_L1_error)
+      __pyx_t_6 = NULL;
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      goto __pyx_L5_unpacking_done;
+      __pyx_L4_unpacking_failed:;
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      __pyx_t_6 = NULL;
+      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
+      __PYX_ERR(0, 152, __pyx_L1_error)
+      __pyx_L5_unpacking_done:;
+    }
+    __pyx_t_7 = __Pyx_PyInt_As_int64_t(__pyx_t_2); if (unlikely((__pyx_t_7 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 152, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_8 = __Pyx_PyInt_As_int64_t(__pyx_t_3); if (unlikely((__pyx_t_8 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 152, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_9 = __Pyx_PyInt_As_int64_t(__pyx_t_4); if (unlikely((__pyx_t_9 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 152, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_v_insertion = __pyx_t_7;
+    __pyx_v_deletion = __pyx_t_8;
+    __pyx_v_substitution = __pyx_t_9;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":151
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:             # <<<<<<<<<<<<<<
+ *         insertion, deletion, substitution = weights
  * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":154
+ *         insertion, deletion, substitution = weights
+ * 
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return levenshtein_similarity_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)
+ */
+  __Pyx_TraceLine(154,0,__PYX_ERR(0, 154, __pyx_L1_error))
+  __pyx_t_9 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, 0); if (unlikely(__pyx_t_9 == ((int64_t)-1L))) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_9;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":155
+ * 
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return levenshtein_similarity_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(155,0,__PYX_ERR(0, 155, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 155, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":156
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return levenshtein_similarity_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(156,0,__PYX_ERR(0, 156, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_9 = levenshtein_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_insertion, __pyx_v_deletion, __pyx_v_substitution, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 156, __pyx_L1_error)
+  }
+  __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 156, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":147
+ * 
+ * 
+ * def levenshtein_similarity(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef int64_t insertion, deletion, substitution
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":159
+ * 
+ * 
+ * def levenshtein_normalized_distance(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_5levenshtein_normalized_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_5levenshtein_normalized_distance = {"levenshtein_normalized_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_5levenshtein_normalized_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_5levenshtein_normalized_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_weights = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("levenshtein_normalized_distance (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_weights,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_weights,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[5] = {0,0,0,0,0};
+    values[2] = ((PyObject *)((PyObject*)__pyx_tuple__3));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    values[4] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 159, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 159, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("levenshtein_normalized_distance", 1, 2, 2, 1); __PYX_ERR(0, 159, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 3)) {
+        Py_ssize_t index;
+        for (index = 2; index < 5 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 159, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "levenshtein_normalized_distance") < 0)) __PYX_ERR(0, 159, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_weights = values[2];
+    __pyx_v_processor = values[3];
+    __pyx_v_score_cutoff = values[4];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("levenshtein_normalized_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 159, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_4levenshtein_normalized_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_weights, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_4levenshtein_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_weights, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  int64_t __pyx_v_insertion;
+  int64_t __pyx_v_deletion;
+  int64_t __pyx_v_substitution;
+  double __pyx_v_c_score_cutoff;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *(*__pyx_t_7)(PyObject *);
+  int64_t __pyx_t_8;
+  int64_t __pyx_t_9;
+  int64_t __pyx_t_10;
+  double __pyx_t_11;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__6)
+  __Pyx_RefNannySetupContext("levenshtein_normalized_distance", 0);
+  __Pyx_TraceCall("levenshtein_normalized_distance", __pyx_f[0], 159, 0, __PYX_ERR(0, 159, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":161
+ * def levenshtein_normalized_distance(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
-  __Pyx_TraceLine(89,0,__PYX_ERR(0, 89, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
+  __Pyx_TraceLine(161,0,__PYX_ERR(0, 161, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
   } else {
-    __pyx_t_2 = __pyx_t_4;
+    __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_2) {
+  if (__pyx_t_1) {
 
-    /* "rapidfuzz/fuzz_cpp.pyx":90
- * 
+    /* "rapidfuzz/distance/metrics_cpp.pyx":162
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  *     if s1 is None or s2 is None:
  *         return 0             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     cdef int64_t insertion, deletion, substitution
  */
-    __Pyx_TraceLine(90,0,__PYX_ERR(0, 90, __pyx_L1_error))
+    __Pyx_TraceLine(162,0,__PYX_ERR(0, 162, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_int_0);
     __pyx_r = __pyx_int_0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":89
+    /* "rapidfuzz/distance/metrics_cpp.pyx":161
+ * def levenshtein_normalized_distance(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":92
- *         return 0
+  /* "rapidfuzz/distance/metrics_cpp.pyx":165
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     return ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1             # <<<<<<<<<<<<<<
+ *     if weights is not None:
+ *         insertion, deletion, substitution = weights
+ */
+  __Pyx_TraceLine(165,0,__PYX_ERR(0, 165, __pyx_L1_error))
+  __pyx_v_insertion = 1;
+  __pyx_v_deletion = 1;
+  __pyx_v_substitution = 1;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":166
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:             # <<<<<<<<<<<<<<
+ *         insertion, deletion, substitution = weights
  * 
  */
-  __Pyx_TraceLine(92,0,__PYX_ERR(0, 92, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 92, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 92, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(166,0,__PYX_ERR(0, 166, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_weights != Py_None);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":167
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:
+ *         insertion, deletion, substitution = weights             # <<<<<<<<<<<<<<
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ */
+    __Pyx_TraceLine(167,0,__PYX_ERR(0, 167, __pyx_L1_error))
+    if ((likely(PyTuple_CheckExact(__pyx_v_weights))) || (PyList_CheckExact(__pyx_v_weights))) {
+      PyObject* sequence = __pyx_v_weights;
+      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
+      if (unlikely(size != 3)) {
+        if (size > 3) __Pyx_RaiseTooManyValuesError(3);
+        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
+        __PYX_ERR(0, 167, __pyx_L1_error)
+      }
+      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+      if (likely(PyTuple_CheckExact(sequence))) {
+        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
+        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
+        __pyx_t_5 = PyTuple_GET_ITEM(sequence, 2); 
+      } else {
+        __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
+        __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
+        __pyx_t_5 = PyList_GET_ITEM(sequence, 2); 
+      }
+      __Pyx_INCREF(__pyx_t_3);
+      __Pyx_INCREF(__pyx_t_4);
+      __Pyx_INCREF(__pyx_t_5);
+      #else
+      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 167, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 167, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __pyx_t_5 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 167, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      #endif
+    } else {
+      Py_ssize_t index = -1;
+      __pyx_t_6 = PyObject_GetIter(__pyx_v_weights); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 167, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_6);
+      index = 0; __pyx_t_3 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_3)) goto __pyx_L7_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_3);
+      index = 1; __pyx_t_4 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_4)) goto __pyx_L7_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_4);
+      index = 2; __pyx_t_5 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_5)) goto __pyx_L7_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_5);
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 3) < 0) __PYX_ERR(0, 167, __pyx_L1_error)
+      __pyx_t_7 = NULL;
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      goto __pyx_L8_unpacking_done;
+      __pyx_L7_unpacking_failed:;
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __pyx_t_7 = NULL;
+      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
+      __PYX_ERR(0, 167, __pyx_L1_error)
+      __pyx_L8_unpacking_done:;
+    }
+    __pyx_t_8 = __Pyx_PyInt_As_int64_t(__pyx_t_3); if (unlikely((__pyx_t_8 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 167, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_9 = __Pyx_PyInt_As_int64_t(__pyx_t_4); if (unlikely((__pyx_t_9 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 167, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_5); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 167, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_v_insertion = __pyx_t_8;
+    __pyx_v_deletion = __pyx_t_9;
+    __pyx_v_substitution = __pyx_t_10;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":166
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:             # <<<<<<<<<<<<<<
+ *         insertion, deletion, substitution = weights
+ * 
+ */
+  }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":93
+  /* "rapidfuzz/distance/metrics_cpp.pyx":169
+ *         insertion, deletion, substitution = weights
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     return ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return levenshtein_normalized_distance_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)
+ */
+  __Pyx_TraceLine(169,0,__PYX_ERR(0, 169, __pyx_L1_error))
+  __pyx_t_11 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 1.0); if (unlikely(__pyx_t_11 == ((double)-1.0))) __PYX_ERR(0, 169, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_11;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":170
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return levenshtein_normalized_distance_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(170,0,__PYX_ERR(0, 170, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 170, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":171
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return levenshtein_normalized_distance_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(93,0,__PYX_ERR(0, 93, __pyx_L1_error))
+  __Pyx_TraceLine(171,0,__PYX_ERR(0, 171, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_11 = levenshtein_normalized_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_insertion, __pyx_v_deletion, __pyx_v_substitution, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 93, __pyx_L1_error)
+    __PYX_ERR(0, 171, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 93, __pyx_L1_error)
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 171, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":50
- *     bool QRatioInit(                RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
+  /* "rapidfuzz/distance/metrics_cpp.pyx":159
  * 
- * def ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the normalized Indel distance.
+ * 
+ * def levenshtein_normalized_distance(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
 
   /* function exit code */
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":96
+/* "rapidfuzz/distance/metrics_cpp.pyx":174
  * 
  * 
- * def partial_ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Searches for the optimal alignment of the shorter string in the
+ * def levenshtein_normalized_similarity(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_3partial_ratio(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_7levenshtein_normalized_similarity(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_2partial_ratio, "\n    Searches for the optimal alignment of the shorter string in the\n    longer string and returns the fuzz.ratio for this alignment.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    Depending on the length of the needle (shorter string) different\n    implementations are used to improve the performance.\n\n    short needle (length \342\211\244 64):\n        When using a short needle length the fuzz.ratio is calculated for all\n        alignments that could result in an optimal alignment. It is\n        guaranteed to find the optimal alignment. For short needles this is very\n        fast, since for them fuzz.ratio runs in ``O(N)`` time. This results in a worst\n        case performance of ``O(NM)``.\n\n    .. image:: img/partial_ratio_short_needle.svg\n\n    long needle (length > 64):\n        For long needles a similar implementation to FuzzyWuzzy is used.\n        This implementation only considers alignments which start at one\n        of the longest common substrings. This results in a worst case performance\n        of ``O(N[N/64]M)``. However usually most of the alignments can be skipped.\n        The following Python code shows the concept:\n\n        .. code-block:: python\n\n            blocks = SequenceMatcher(None, needle, longer, False).get_matching_blocks()\n            score = 0\n         ""   for block in blocks:\n                long_start = block[1] - block[0] if (block[1] - block[0]) > 0 else 0\n                long_end = long_start + len(shorter)\n                long_substr = longer[long_start:long_end]\n                score = max(score, fuzz.ratio(needle, long_substr))\n\n        This is a lot faster than checking all possible alignments. However it\n        only finds one of the best alignments and not necessarily the optimal one.\n\n    .. image:: img/partial_ratio_long_needle.svg\n\n    Examples\n    --------\n    >>> fuzz.partial_ratio(\"this is a test\", \"this is a test!\")\n    100.0\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_3partial_ratio = {"partial_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_3partial_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_2partial_ratio};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_3partial_ratio(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_7levenshtein_normalized_similarity = {"levenshtein_normalized_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_7levenshtein_normalized_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_7levenshtein_normalized_similarity(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
   PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_weights = 0;
   PyObject *__pyx_v_processor = 0;
   PyObject *__pyx_v_score_cutoff = 0;
   #if !CYTHON_METH_FASTCALL
   CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("partial_ratio (wrapper)", 0);
+  __Pyx_RefNannySetupContext("levenshtein_normalized_similarity (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
-    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_weights,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_weights,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
-    PyObject* values[4] = {0,0,0,0};
-    values[2] = ((PyObject *)((PyObject *)Py_None));
+    PyObject* values[5] = {0,0,0,0,0};
+    values[2] = ((PyObject *)((PyObject*)__pyx_tuple__3));
     values[3] = ((PyObject *)((PyObject *)Py_None));
+    values[4] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 96, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 174, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 96, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 174, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("partial_ratio", 1, 2, 2, 1); __PYX_ERR(0, 96, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("levenshtein_normalized_similarity", 1, 2, 2, 1); __PYX_ERR(0, 174, __pyx_L3_error)
         }
       }
-      if (kw_args > 0 && likely(kw_args <= 2)) {
+      if (kw_args > 0 && likely(kw_args <= 3)) {
         Py_ssize_t index;
-        for (index = 2; index < 4 && kw_args > 0; index++) {
+        for (index = 2; index < 5 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 96, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 174, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "partial_ratio") < 0)) __PYX_ERR(0, 96, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "levenshtein_normalized_similarity") < 0)) __PYX_ERR(0, 174, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
-    __pyx_v_processor = values[2];
-    __pyx_v_score_cutoff = values[3];
+    __pyx_v_weights = values[2];
+    __pyx_v_processor = values[3];
+    __pyx_v_score_cutoff = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("partial_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 96, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("levenshtein_normalized_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 174, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_2partial_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_6levenshtein_normalized_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_weights, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_2partial_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_6levenshtein_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_weights, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
+  int64_t __pyx_v_insertion;
+  int64_t __pyx_v_deletion;
+  int64_t __pyx_v_substitution;
+  double __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
+  int __pyx_t_1;
   int __pyx_t_2;
-  double __pyx_t_3;
-  int __pyx_t_4;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *(*__pyx_t_7)(PyObject *);
+  int64_t __pyx_t_8;
+  int64_t __pyx_t_9;
+  int64_t __pyx_t_10;
+  double __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__2)
-  __Pyx_RefNannySetupContext("partial_ratio", 0);
-  __Pyx_TraceCall("partial_ratio", __pyx_f[0], 96, 0, __PYX_ERR(0, 96, __pyx_L1_error));
-
-  /* "rapidfuzz/fuzz_cpp.pyx":161
- *     100.0
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
- *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
- */
-  __Pyx_TraceLine(161,0,__PYX_ERR(0, 161, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
-  } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 161, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
-  }
-  __pyx_v_c_score_cutoff = __pyx_t_1;
+  __Pyx_TraceFrameInit(__pyx_codeobj__7)
+  __Pyx_RefNannySetupContext("levenshtein_normalized_similarity", 0);
+  __Pyx_TraceCall("levenshtein_normalized_similarity", __pyx_f[0], 174, 0, __PYX_ERR(0, 174, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":164
+  /* "rapidfuzz/distance/metrics_cpp.pyx":176
+ * def levenshtein_normalized_similarity(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
-  __Pyx_TraceLine(164,0,__PYX_ERR(0, 164, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
+  __Pyx_TraceLine(176,0,__PYX_ERR(0, 176, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
   } else {
-    __pyx_t_2 = __pyx_t_4;
+    __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_2) {
+  if (__pyx_t_1) {
 
-    /* "rapidfuzz/fuzz_cpp.pyx":165
- * 
+    /* "rapidfuzz/distance/metrics_cpp.pyx":177
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  *     if s1 is None or s2 is None:
  *         return 0             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     cdef int64_t insertion, deletion, substitution
  */
-    __Pyx_TraceLine(165,0,__PYX_ERR(0, 165, __pyx_L1_error))
+    __Pyx_TraceLine(177,0,__PYX_ERR(0, 177, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_int_0);
     __pyx_r = __pyx_int_0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":164
+    /* "rapidfuzz/distance/metrics_cpp.pyx":176
+ * def levenshtein_normalized_similarity(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":167
- *         return 0
+  /* "rapidfuzz/distance/metrics_cpp.pyx":180
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     return partial_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1             # <<<<<<<<<<<<<<
+ *     if weights is not None:
+ *         insertion, deletion, substitution = weights
+ */
+  __Pyx_TraceLine(180,0,__PYX_ERR(0, 180, __pyx_L1_error))
+  __pyx_v_insertion = 1;
+  __pyx_v_deletion = 1;
+  __pyx_v_substitution = 1;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":181
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:             # <<<<<<<<<<<<<<
+ *         insertion, deletion, substitution = weights
  * 
  */
-  __Pyx_TraceLine(167,0,__PYX_ERR(0, 167, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 167, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 167, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(181,0,__PYX_ERR(0, 181, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_weights != Py_None);
+  if (__pyx_t_1) {
 
-  /* "rapidfuzz/fuzz_cpp.pyx":168
+    /* "rapidfuzz/distance/metrics_cpp.pyx":182
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:
+ *         insertion, deletion, substitution = weights             # <<<<<<<<<<<<<<
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ */
+    __Pyx_TraceLine(182,0,__PYX_ERR(0, 182, __pyx_L1_error))
+    if ((likely(PyTuple_CheckExact(__pyx_v_weights))) || (PyList_CheckExact(__pyx_v_weights))) {
+      PyObject* sequence = __pyx_v_weights;
+      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
+      if (unlikely(size != 3)) {
+        if (size > 3) __Pyx_RaiseTooManyValuesError(3);
+        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
+        __PYX_ERR(0, 182, __pyx_L1_error)
+      }
+      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+      if (likely(PyTuple_CheckExact(sequence))) {
+        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
+        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
+        __pyx_t_5 = PyTuple_GET_ITEM(sequence, 2); 
+      } else {
+        __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
+        __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
+        __pyx_t_5 = PyList_GET_ITEM(sequence, 2); 
+      }
+      __Pyx_INCREF(__pyx_t_3);
+      __Pyx_INCREF(__pyx_t_4);
+      __Pyx_INCREF(__pyx_t_5);
+      #else
+      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 182, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 182, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __pyx_t_5 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 182, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      #endif
+    } else {
+      Py_ssize_t index = -1;
+      __pyx_t_6 = PyObject_GetIter(__pyx_v_weights); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 182, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_6);
+      index = 0; __pyx_t_3 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_3)) goto __pyx_L7_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_3);
+      index = 1; __pyx_t_4 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_4)) goto __pyx_L7_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_4);
+      index = 2; __pyx_t_5 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_5)) goto __pyx_L7_unpacking_failed;
+      __Pyx_GOTREF(__pyx_t_5);
+      if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 3) < 0) __PYX_ERR(0, 182, __pyx_L1_error)
+      __pyx_t_7 = NULL;
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      goto __pyx_L8_unpacking_done;
+      __pyx_L7_unpacking_failed:;
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+      __pyx_t_7 = NULL;
+      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
+      __PYX_ERR(0, 182, __pyx_L1_error)
+      __pyx_L8_unpacking_done:;
+    }
+    __pyx_t_8 = __Pyx_PyInt_As_int64_t(__pyx_t_3); if (unlikely((__pyx_t_8 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 182, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_9 = __Pyx_PyInt_As_int64_t(__pyx_t_4); if (unlikely((__pyx_t_9 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 182, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_5); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 182, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_v_insertion = __pyx_t_8;
+    __pyx_v_deletion = __pyx_t_9;
+    __pyx_v_substitution = __pyx_t_10;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":181
+ *     cdef int64_t insertion, deletion, substitution
+ *     insertion = deletion = substitution = 1
+ *     if weights is not None:             # <<<<<<<<<<<<<<
+ *         insertion, deletion, substitution = weights
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     return partial_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":184
+ *         insertion, deletion, substitution = weights
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)
+ */
+  __Pyx_TraceLine(184,0,__PYX_ERR(0, 184, __pyx_L1_error))
+  __pyx_t_11 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 0.0); if (unlikely(__pyx_t_11 == ((double)-1.0))) __PYX_ERR(0, 184, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_11;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":185
  * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(168,0,__PYX_ERR(0, 168, __pyx_L1_error))
+  __Pyx_TraceLine(185,0,__PYX_ERR(0, 185, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 185, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":186
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, insertion, deletion, substitution, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(186,0,__PYX_ERR(0, 186, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = partial_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_11 = levenshtein_normalized_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_insertion, __pyx_v_deletion, __pyx_v_substitution, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 168, __pyx_L1_error)
+    __PYX_ERR(0, 186, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 168, __pyx_L1_error)
+  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_11); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 186, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":96
+  /* "rapidfuzz/distance/metrics_cpp.pyx":174
  * 
  * 
- * def partial_ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Searches for the optimal alignment of the shorter string in the
+ * def levenshtein_normalized_similarity(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
 
   /* function exit code */
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":171
+/* "rapidfuzz/distance/metrics_cpp.pyx":189
  * 
  * 
- * def partial_ratio_alignment(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Searches for the optimal alignment of the shorter string in the
+ * def levenshtein_editops(s1, s2, *, processor=None, score_hint=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_5partial_ratio_alignment(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_9levenshtein_editops(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_4partial_ratio_alignment, "\n    Searches for the optimal alignment of the shorter string in the\n    longer string and returns the fuzz.ratio and the corresponding\n    alignment.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is None, which deactivates this behaviour.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff None is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    alignment : ScoreAlignment, optional\n        alignment between s1 and s2 with the score as a float between 0 and 100\n\n    Examples\n    --------\n    >>> s1 = \"a certain string\"\n    >>> s2 = \"cetain\"\n    >>> res = fuzz.partial_ratio_alignment(s1, s2)\n    >>> res\n    ScoreAlignment(score=83.33333333333334, src_start=2, src_end=8, dest_start=0, dest_end=6)\n    \n    Using the alignment information it is possible to calculate the same fuzz.ratio\n\n    >>> fuzz.ratio(s1[res.src_start:res.src_end], s2[res.dest_start:res.dest_end])\n    83.33333333333334\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_5partial_ratio_alignment = {"partial_ratio_alignment", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_5partial_ratio_alignment, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_4partial_ratio_alignment};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_5partial_ratio_alignment(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_9levenshtein_editops = {"levenshtein_editops", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_9levenshtein_editops, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_9levenshtein_editops(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
   PyObject *__pyx_v_s2 = 0;
   PyObject *__pyx_v_processor = 0;
-  PyObject *__pyx_v_score_cutoff = 0;
+  PyObject *__pyx_v_score_hint = 0;
   #if !CYTHON_METH_FASTCALL
   CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("partial_ratio_alignment (wrapper)", 0);
+  __Pyx_RefNannySetupContext("levenshtein_editops (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
-    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_hint,0};
     #else
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_hint,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
     values[2] = ((PyObject *)((PyObject *)Py_None));
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
@@ -3575,348 +5105,1581 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 171, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 171, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("partial_ratio_alignment", 1, 2, 2, 1); __PYX_ERR(0, 171, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("levenshtein_editops", 1, 2, 2, 1); __PYX_ERR(0, 189, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 171, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 189, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "partial_ratio_alignment") < 0)) __PYX_ERR(0, 171, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "levenshtein_editops") < 0)) __PYX_ERR(0, 189, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
-    __pyx_v_score_cutoff = values[3];
+    __pyx_v_score_hint = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("partial_ratio_alignment", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 171, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("levenshtein_editops", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 189, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_ratio_alignment", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_editops", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_4partial_ratio_alignment(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_8levenshtein_editops(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_hint);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_4partial_ratio_alignment(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_8levenshtein_editops(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_hint) {
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
-  rapidfuzz::ScoreAlignment<double>  __pyx_v_res;
+  struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *__pyx_v_ops = 0;
+  int64_t __pyx_v_c_score_hint;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
-  int __pyx_t_2;
-  double __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  rapidfuzz::ScoreAlignment<double>  __pyx_t_6;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  PyObject *__pyx_t_11 = NULL;
-  PyObject *__pyx_t_12 = NULL;
-  PyObject *__pyx_t_13 = NULL;
-  int __pyx_t_14;
+  PyObject *__pyx_t_1 = NULL;
+  int64_t __pyx_t_2;
+  rapidfuzz::Editops __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__3)
-  __Pyx_RefNannySetupContext("partial_ratio_alignment", 0);
-  __Pyx_TraceCall("partial_ratio_alignment", __pyx_f[0], 171, 0, __PYX_ERR(0, 171, __pyx_L1_error));
-
-  /* "rapidfuzz/fuzz_cpp.pyx":209
- *     83.33333333333334
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+  __Pyx_TraceFrameInit(__pyx_codeobj__8)
+  __Pyx_RefNannySetupContext("levenshtein_editops", 0);
+  __Pyx_TraceCall("levenshtein_editops", __pyx_f[0], 189, 0, __PYX_ERR(0, 189, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":191
+ * def levenshtein_editops(s1, s2, *, processor=None, score_hint=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_hint = get_score_hint_i64(score_hint, INT64_MAX)
  * 
  */
-  __Pyx_TraceLine(209,0,__PYX_ERR(0, 209, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
-  } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 209, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
-  }
-  __pyx_v_c_score_cutoff = __pyx_t_1;
+  __Pyx_TraceLine(191,0,__PYX_ERR(0, 191, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_tp_new(((PyObject *)__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops), __pyx_empty_tuple); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 191, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (!(likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops)))) __PYX_ERR(0, 191, __pyx_L1_error)
+  __pyx_v_ops = ((struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *)__pyx_t_1);
+  __pyx_t_1 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":212
+  /* "rapidfuzz/distance/metrics_cpp.pyx":192
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ *     cdef int64_t c_score_hint = get_score_hint_i64(score_hint, INT64_MAX)             # <<<<<<<<<<<<<<
  * 
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return None
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ */
+  __Pyx_TraceLine(192,0,__PYX_ERR(0, 192, __pyx_L1_error))
+  __pyx_t_2 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_hint_i64(__pyx_v_score_hint, INT64_MAX); if (unlikely(__pyx_t_2 == ((int64_t)-1L))) __PYX_ERR(0, 192, __pyx_L1_error)
+  __pyx_v_c_score_hint = __pyx_t_2;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":194
+ *     cdef int64_t c_score_hint = get_score_hint_i64(score_hint, INT64_MAX)
  * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     ops.editops = levenshtein_editops_func(s1_proc.string, s2_proc.string, c_score_hint)
+ *     return ops
  */
-  __Pyx_TraceLine(212,0,__PYX_ERR(0, 212, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
-  } else {
-    __pyx_t_2 = __pyx_t_4;
-    goto __pyx_L4_bool_binop_done;
+  __Pyx_TraceLine(194,0,__PYX_ERR(0, 194, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 194, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":195
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = levenshtein_editops_func(s1_proc.string, s2_proc.string, c_score_hint)             # <<<<<<<<<<<<<<
+ *     return ops
+ * 
+ */
+  __Pyx_TraceLine(195,0,__PYX_ERR(0, 195, __pyx_L1_error))
+  try {
+    __pyx_t_3 = levenshtein_editops_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_hint);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 195, __pyx_L1_error)
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
-  __pyx_L4_bool_binop_done:;
-  if (__pyx_t_2) {
+  __pyx_v_ops->editops = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_3);
 
-    /* "rapidfuzz/fuzz_cpp.pyx":213
+  /* "rapidfuzz/distance/metrics_cpp.pyx":196
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = levenshtein_editops_func(s1_proc.string, s2_proc.string, c_score_hint)
+ *     return ops             # <<<<<<<<<<<<<<
  * 
- *     if s1 is None or s2 is None:
- *         return None             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
  */
-    __Pyx_TraceLine(213,0,__PYX_ERR(0, 213, __pyx_L1_error))
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-    goto __pyx_L0;
+  __Pyx_TraceLine(196,0,__PYX_ERR(0, 196, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF((PyObject *)__pyx_v_ops);
+  __pyx_r = ((PyObject *)__pyx_v_ops);
+  goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":212
+  /* "rapidfuzz/distance/metrics_cpp.pyx":189
+ * 
+ * 
+ * def levenshtein_editops(s1, s2, *, processor=None, score_hint=None):             # <<<<<<<<<<<<<<
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_editops", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_ops);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":199
  * 
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return None
  * 
+ * def levenshtein_opcodes(s1, s2, *, processor=None, score_hint=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
  */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_11levenshtein_opcodes(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_11levenshtein_opcodes = {"levenshtein_opcodes", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_11levenshtein_opcodes, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_11levenshtein_opcodes(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_hint = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("levenshtein_opcodes (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_hint,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_hint,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 199, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 199, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("levenshtein_opcodes", 1, 2, 2, 1); __PYX_ERR(0, 199, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 199, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "levenshtein_opcodes") < 0)) __PYX_ERR(0, 199, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_hint = values[3];
   }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("levenshtein_opcodes", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 199, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_opcodes", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_10levenshtein_opcodes(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_hint);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_10levenshtein_opcodes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_hint) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *__pyx_v_ops = 0;
+  int64_t __pyx_v_c_score_hint;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int64_t __pyx_t_2;
+  rapidfuzz::Editops __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_t_6;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__9)
+  __Pyx_RefNannySetupContext("levenshtein_opcodes", 0);
+  __Pyx_TraceCall("levenshtein_opcodes", __pyx_f[0], 199, 0, __PYX_ERR(0, 199, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":215
- *         return None
+  /* "rapidfuzz/distance/metrics_cpp.pyx":201
+ * def levenshtein_opcodes(s1, s2, *, processor=None, score_hint=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_hint = get_score_hint_i64(score_hint, INT64_MAX)
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     res = partial_ratio_alignment_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ */
+  __Pyx_TraceLine(201,0,__PYX_ERR(0, 201, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_tp_new(((PyObject *)__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops), __pyx_empty_tuple); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 201, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (!(likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops)))) __PYX_ERR(0, 201, __pyx_L1_error)
+  __pyx_v_ops = ((struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *)__pyx_t_1);
+  __pyx_t_1 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":202
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ *     cdef int64_t c_score_hint = get_score_hint_i64(score_hint, INT64_MAX)             # <<<<<<<<<<<<<<
  * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
  */
-  __Pyx_TraceLine(215,0,__PYX_ERR(0, 215, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 215, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 215, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(202,0,__PYX_ERR(0, 202, __pyx_L1_error))
+  __pyx_t_2 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_hint_i64(__pyx_v_score_hint, INT64_MAX); if (unlikely(__pyx_t_2 == ((int64_t)-1L))) __PYX_ERR(0, 202, __pyx_L1_error)
+  __pyx_v_c_score_hint = __pyx_t_2;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":216
+  /* "rapidfuzz/distance/metrics_cpp.pyx":204
+ *     cdef int64_t c_score_hint = get_score_hint_i64(score_hint, INT64_MAX)
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     res = partial_ratio_alignment_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     ops.editops = levenshtein_editops_func(s1_proc.string, s2_proc.string, c_score_hint)
+ *     return ops.as_opcodes()
+ */
+  __Pyx_TraceLine(204,0,__PYX_ERR(0, 204, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 204, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":205
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = levenshtein_editops_func(s1_proc.string, s2_proc.string, c_score_hint)             # <<<<<<<<<<<<<<
+ *     return ops.as_opcodes()
  * 
- *     if res.score >= c_score_cutoff:
  */
-  __Pyx_TraceLine(216,0,__PYX_ERR(0, 216, __pyx_L1_error))
+  __Pyx_TraceLine(205,0,__PYX_ERR(0, 205, __pyx_L1_error))
   try {
-    __pyx_t_6 = partial_ratio_alignment_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_3 = levenshtein_editops_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_hint);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 216, __pyx_L1_error)
+    __PYX_ERR(0, 205, __pyx_L1_error)
   }
-  __pyx_v_res = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_6);
+  __pyx_v_ops->editops = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_3);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":218
- *     res = partial_ratio_alignment_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":206
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = levenshtein_editops_func(s1_proc.string, s2_proc.string, c_score_hint)
+ *     return ops.as_opcodes()             # <<<<<<<<<<<<<<
  * 
- *     if res.score >= c_score_cutoff:             # <<<<<<<<<<<<<<
- *         return ScoreAlignment(res.score, res.src_start, res.src_end, res.dest_start, res.dest_end)
- *     else:
+ * cdef void KwargsDeinit(RF_Kwargs* self):
+ */
+  __Pyx_TraceLine(206,0,__PYX_ERR(0, 206, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_ops), __pyx_n_s_as_opcodes); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 206, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_5 = NULL;
+  __pyx_t_6 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
+    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
+    if (likely(__pyx_t_5)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
+      __Pyx_INCREF(__pyx_t_5);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_4, function);
+      __pyx_t_6 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[1] = {__pyx_t_5, };
+    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
+    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 206, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  }
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":199
+ * 
+ * 
+ * def levenshtein_opcodes(s1, s2, *, processor=None, score_hint=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.levenshtein_opcodes", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_ops);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":208
+ *     return ops.as_opcodes()
+ * 
+ * cdef void KwargsDeinit(RF_Kwargs* self):             # <<<<<<<<<<<<<<
+ *     free(<void*>dereference(self).context)
+ * 
+ */
+
+static void __pyx_f_9rapidfuzz_8distance_11metrics_cpp_KwargsDeinit(RF_Kwargs *__pyx_v_self) {
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("KwargsDeinit", 0);
+  __Pyx_TraceCall("KwargsDeinit", __pyx_f[0], 208, 0, __PYX_ERR(0, 208, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":209
+ * 
+ * cdef void KwargsDeinit(RF_Kwargs* self):
+ *     free(<void*>dereference(self).context)             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool LevenshteinKwargsInit(RF_Kwargs* self, dict kwargs) except False:
+ */
+  __Pyx_TraceLine(209,0,__PYX_ERR(0, 209, __pyx_L1_error))
+  free(((void *)(*__pyx_v_self).context));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":208
+ *     return ops.as_opcodes()
+ * 
+ * cdef void KwargsDeinit(RF_Kwargs* self):             # <<<<<<<<<<<<<<
+ *     free(<void*>dereference(self).context)
+ * 
+ */
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_WriteUnraisable("rapidfuzz.distance.metrics_cpp.KwargsDeinit", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":211
+ *     free(<void*>dereference(self).context)
+ * 
+ * cdef bool LevenshteinKwargsInit(RF_Kwargs* self, dict kwargs) except False:             # <<<<<<<<<<<<<<
+ *     cdef int64_t insertion, deletion, substitution
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>malloc(sizeof(LevenshteinWeightTable))
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_LevenshteinKwargsInit(RF_Kwargs *__pyx_v_self, PyObject *__pyx_v_kwargs) {
+  int64_t __pyx_v_insertion;
+  int64_t __pyx_v_deletion;
+  int64_t __pyx_v_substitution;
+  struct rapidfuzz::LevenshteinWeightTable *__pyx_v_weights;
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *(*__pyx_t_7)(PyObject *);
+  int64_t __pyx_t_8;
+  int64_t __pyx_t_9;
+  int64_t __pyx_t_10;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("LevenshteinKwargsInit", 0);
+  __Pyx_TraceCall("LevenshteinKwargsInit", __pyx_f[0], 211, 0, __PYX_ERR(0, 211, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":213
+ * cdef bool LevenshteinKwargsInit(RF_Kwargs* self, dict kwargs) except False:
+ *     cdef int64_t insertion, deletion, substitution
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>malloc(sizeof(LevenshteinWeightTable))             # <<<<<<<<<<<<<<
+ * 
+ *     if not weights:
+ */
+  __Pyx_TraceLine(213,0,__PYX_ERR(0, 213, __pyx_L1_error))
+  __pyx_v_weights = ((struct rapidfuzz::LevenshteinWeightTable *)malloc((sizeof(struct rapidfuzz::LevenshteinWeightTable))));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":215
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>malloc(sizeof(LevenshteinWeightTable))
+ * 
+ *     if not weights:             # <<<<<<<<<<<<<<
+ *         raise MemoryError
+ * 
+ */
+  __Pyx_TraceLine(215,0,__PYX_ERR(0, 215, __pyx_L1_error))
+  __pyx_t_1 = (!(__pyx_v_weights != 0));
+  if (unlikely(__pyx_t_1)) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":216
+ * 
+ *     if not weights:
+ *         raise MemoryError             # <<<<<<<<<<<<<<
+ * 
+ *     insertion, deletion, substitution = kwargs.get("weights", (1, 1, 1))
+ */
+    __Pyx_TraceLine(216,0,__PYX_ERR(0, 216, __pyx_L1_error))
+    PyErr_NoMemory(); __PYX_ERR(0, 216, __pyx_L1_error)
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":215
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>malloc(sizeof(LevenshteinWeightTable))
+ * 
+ *     if not weights:             # <<<<<<<<<<<<<<
+ *         raise MemoryError
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":218
+ *         raise MemoryError
+ * 
+ *     insertion, deletion, substitution = kwargs.get("weights", (1, 1, 1))             # <<<<<<<<<<<<<<
+ *     dereference(weights).insert_cost = insertion
+ *     dereference(weights).delete_cost = deletion
  */
   __Pyx_TraceLine(218,0,__PYX_ERR(0, 218, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_res.score >= __pyx_v_c_score_cutoff);
-  if (__pyx_t_2) {
+  if (unlikely(__pyx_v_kwargs == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "get");
+    __PYX_ERR(0, 218, __pyx_L1_error)
+  }
+  __pyx_t_2 = __Pyx_PyDict_GetItemDefault(__pyx_v_kwargs, __pyx_n_u_weights, __pyx_tuple__3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 218, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
+    PyObject* sequence = __pyx_t_2;
+    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
+    if (unlikely(size != 3)) {
+      if (size > 3) __Pyx_RaiseTooManyValuesError(3);
+      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
+      __PYX_ERR(0, 218, __pyx_L1_error)
+    }
+    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    if (likely(PyTuple_CheckExact(sequence))) {
+      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
+      __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
+      __pyx_t_5 = PyTuple_GET_ITEM(sequence, 2); 
+    } else {
+      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
+      __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
+      __pyx_t_5 = PyList_GET_ITEM(sequence, 2); 
+    }
+    __Pyx_INCREF(__pyx_t_3);
+    __Pyx_INCREF(__pyx_t_4);
+    __Pyx_INCREF(__pyx_t_5);
+    #else
+    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 218, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 218, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_5 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 218, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    #endif
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  } else {
+    Py_ssize_t index = -1;
+    __pyx_t_6 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 218, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_6);
+    index = 0; __pyx_t_3 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_3)) goto __pyx_L4_unpacking_failed;
+    __Pyx_GOTREF(__pyx_t_3);
+    index = 1; __pyx_t_4 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_4)) goto __pyx_L4_unpacking_failed;
+    __Pyx_GOTREF(__pyx_t_4);
+    index = 2; __pyx_t_5 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_5)) goto __pyx_L4_unpacking_failed;
+    __Pyx_GOTREF(__pyx_t_5);
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 3) < 0) __PYX_ERR(0, 218, __pyx_L1_error)
+    __pyx_t_7 = NULL;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    goto __pyx_L5_unpacking_done;
+    __pyx_L4_unpacking_failed:;
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_t_7 = NULL;
+    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
+    __PYX_ERR(0, 218, __pyx_L1_error)
+    __pyx_L5_unpacking_done:;
+  }
+  __pyx_t_8 = __Pyx_PyInt_As_int64_t(__pyx_t_3); if (unlikely((__pyx_t_8 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 218, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_9 = __Pyx_PyInt_As_int64_t(__pyx_t_4); if (unlikely((__pyx_t_9 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 218, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_t_5); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 218, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __pyx_v_insertion = __pyx_t_8;
+  __pyx_v_deletion = __pyx_t_9;
+  __pyx_v_substitution = __pyx_t_10;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":219
+ * 
+ *     insertion, deletion, substitution = kwargs.get("weights", (1, 1, 1))
+ *     dereference(weights).insert_cost = insertion             # <<<<<<<<<<<<<<
+ *     dereference(weights).delete_cost = deletion
+ *     dereference(weights).replace_cost = substitution
+ */
+  __Pyx_TraceLine(219,0,__PYX_ERR(0, 219, __pyx_L1_error))
+  (*__pyx_v_weights).insert_cost = __pyx_v_insertion;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":220
+ *     insertion, deletion, substitution = kwargs.get("weights", (1, 1, 1))
+ *     dereference(weights).insert_cost = insertion
+ *     dereference(weights).delete_cost = deletion             # <<<<<<<<<<<<<<
+ *     dereference(weights).replace_cost = substitution
+ *     dereference(self).context = weights
+ */
+  __Pyx_TraceLine(220,0,__PYX_ERR(0, 220, __pyx_L1_error))
+  (*__pyx_v_weights).delete_cost = __pyx_v_deletion;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":221
+ *     dereference(weights).insert_cost = insertion
+ *     dereference(weights).delete_cost = deletion
+ *     dereference(weights).replace_cost = substitution             # <<<<<<<<<<<<<<
+ *     dereference(self).context = weights
+ *     dereference(self).dtor = KwargsDeinit
+ */
+  __Pyx_TraceLine(221,0,__PYX_ERR(0, 221, __pyx_L1_error))
+  (*__pyx_v_weights).replace_cost = __pyx_v_substitution;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":222
+ *     dereference(weights).delete_cost = deletion
+ *     dereference(weights).replace_cost = substitution
+ *     dereference(self).context = weights             # <<<<<<<<<<<<<<
+ *     dereference(self).dtor = KwargsDeinit
+ *     return True
+ */
+  __Pyx_TraceLine(222,0,__PYX_ERR(0, 222, __pyx_L1_error))
+  (*__pyx_v_self).context = __pyx_v_weights;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":219
+  /* "rapidfuzz/distance/metrics_cpp.pyx":223
+ *     dereference(weights).replace_cost = substitution
+ *     dereference(self).context = weights
+ *     dereference(self).dtor = KwargsDeinit             # <<<<<<<<<<<<<<
+ *     return True
  * 
- *     if res.score >= c_score_cutoff:
- *         return ScoreAlignment(res.score, res.src_start, res.src_end, res.dest_start, res.dest_end)             # <<<<<<<<<<<<<<
- *     else:
- *         return None
  */
-    __Pyx_TraceLine(219,0,__PYX_ERR(0, 219, __pyx_L1_error))
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_ScoreAlignment); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 219, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = PyFloat_FromDouble(__pyx_v_res.score); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 219, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_res.src_start); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 219, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_10 = __Pyx_PyInt_FromSize_t(__pyx_v_res.src_end); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 219, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = __Pyx_PyInt_FromSize_t(__pyx_v_res.dest_start); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 219, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = __Pyx_PyInt_FromSize_t(__pyx_v_res.dest_end); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 219, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_12);
-    __pyx_t_13 = NULL;
-    __pyx_t_14 = 0;
-    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
-      __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_7);
-      if (likely(__pyx_t_13)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
-        __Pyx_INCREF(__pyx_t_13);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_7, function);
-        __pyx_t_14 = 1;
+  __Pyx_TraceLine(223,0,__PYX_ERR(0, 223, __pyx_L1_error))
+  (*__pyx_v_self).dtor = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_KwargsDeinit;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":224
+ *     dereference(self).context = weights
+ *     dereference(self).dtor = KwargsDeinit
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(224,0,__PYX_ERR(0, 224, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":211
+ *     free(<void*>dereference(self).context)
+ * 
+ * cdef bool LevenshteinKwargsInit(RF_Kwargs* self, dict kwargs) except False:             # <<<<<<<<<<<<<<
+ *     cdef int64_t insertion, deletion, substitution
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>malloc(sizeof(LevenshteinWeightTable))
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.LevenshteinKwargsInit", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":226
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinDistance(RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  struct rapidfuzz::LevenshteinWeightTable *__pyx_v_weights;
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_t_1;
+  RF_ScorerFlags __pyx_t_2;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsLevenshteinDistance", __pyx_f[0], 226, 1, __PYX_ERR(0, 226, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":227
+ * 
+ * cdef bool GetScorerFlagsLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ */
+  __Pyx_TraceLine(227,1,__PYX_ERR(0, 227, __pyx_L1_error))
+  __pyx_v_weights = ((struct rapidfuzz::LevenshteinWeightTable *)(*__pyx_v_self).context);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":228
+ * cdef bool GetScorerFlagsLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64             # <<<<<<<<<<<<<<
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ */
+  __Pyx_TraceLine(228,1,__PYX_ERR(0, 228, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":229
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:             # <<<<<<<<<<<<<<
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+  __Pyx_TraceLine(229,1,__PYX_ERR(0, 229, __pyx_L1_error))
+  __pyx_t_1 = ((*__pyx_v_weights).insert_cost == (*__pyx_v_weights).delete_cost);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":230
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ */
+    __Pyx_TraceLine(230,1,__PYX_ERR(0, 230, __pyx_L1_error))
+    __pyx_t_2 = (*__pyx_v_scorer_flags);
+    __pyx_t_2.flags = (__pyx_t_2.flags | RF_SCORER_FLAG_SYMMETRIC);
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":229
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:             # <<<<<<<<<<<<<<
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":231
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ *     return True
+ */
+  __Pyx_TraceLine(231,1,__PYX_ERR(0, 231, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":232
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(232,1,__PYX_ERR(0, 232, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":233
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(233,1,__PYX_ERR(0, 233, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":226
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsLevenshteinDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":235
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinSimilarity(RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  struct rapidfuzz::LevenshteinWeightTable *__pyx_v_weights;
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_t_1;
+  RF_ScorerFlags __pyx_t_2;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsLevenshteinSimilarity", __pyx_f[0], 235, 1, __PYX_ERR(0, 235, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":236
+ * 
+ * cdef bool GetScorerFlagsLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ */
+  __Pyx_TraceLine(236,1,__PYX_ERR(0, 236, __pyx_L1_error))
+  __pyx_v_weights = ((struct rapidfuzz::LevenshteinWeightTable *)(*__pyx_v_self).context);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":237
+ * cdef bool GetScorerFlagsLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64             # <<<<<<<<<<<<<<
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ */
+  __Pyx_TraceLine(237,1,__PYX_ERR(0, 237, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":238
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:             # <<<<<<<<<<<<<<
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+  __Pyx_TraceLine(238,1,__PYX_ERR(0, 238, __pyx_L1_error))
+  __pyx_t_1 = ((*__pyx_v_weights).insert_cost == (*__pyx_v_weights).delete_cost);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":239
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ */
+    __Pyx_TraceLine(239,1,__PYX_ERR(0, 239, __pyx_L1_error))
+    __pyx_t_2 = (*__pyx_v_scorer_flags);
+    __pyx_t_2.flags = (__pyx_t_2.flags | RF_SCORER_FLAG_SYMMETRIC);
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":238
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:             # <<<<<<<<<<<<<<
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":240
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(240,1,__PYX_ERR(0, 240, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":241
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(241,1,__PYX_ERR(0, 241, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":242
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(242,1,__PYX_ERR(0, 242, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":235
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsLevenshteinSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":244
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinNormalizedDistance(RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  struct rapidfuzz::LevenshteinWeightTable *__pyx_v_weights;
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_t_1;
+  RF_ScorerFlags __pyx_t_2;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsLevenshteinNormalizedDistance", __pyx_f[0], 244, 1, __PYX_ERR(0, 244, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":245
+ * 
+ * cdef bool GetScorerFlagsLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ */
+  __Pyx_TraceLine(245,1,__PYX_ERR(0, 245, __pyx_L1_error))
+  __pyx_v_weights = ((struct rapidfuzz::LevenshteinWeightTable *)(*__pyx_v_self).context);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":246
+ * cdef bool GetScorerFlagsLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64             # <<<<<<<<<<<<<<
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ */
+  __Pyx_TraceLine(246,1,__PYX_ERR(0, 246, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":247
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:             # <<<<<<<<<<<<<<
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0
+ */
+  __Pyx_TraceLine(247,1,__PYX_ERR(0, 247, __pyx_L1_error))
+  __pyx_t_1 = ((*__pyx_v_weights).insert_cost == (*__pyx_v_weights).delete_cost);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":248
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 0
+ *     dereference(scorer_flags).worst_score.f64 = 1.0
+ */
+    __Pyx_TraceLine(248,1,__PYX_ERR(0, 248, __pyx_L1_error))
+    __pyx_t_2 = (*__pyx_v_scorer_flags);
+    __pyx_t_2.flags = (__pyx_t_2.flags | RF_SCORER_FLAG_SYMMETRIC);
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":247
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:             # <<<<<<<<<<<<<<
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":249
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 1.0
+ *     return True
+ */
+  __Pyx_TraceLine(249,1,__PYX_ERR(0, 249, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":250
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0
+ *     dereference(scorer_flags).worst_score.f64 = 1.0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(250,1,__PYX_ERR(0, 250, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 1.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":251
+ *     dereference(scorer_flags).optimal_score.f64 = 0
+ *     dereference(scorer_flags).worst_score.f64 = 1.0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(251,1,__PYX_ERR(0, 251, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":244
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsLevenshteinNormalizedDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":253
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinNormalizedSimilarity(RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  struct rapidfuzz::LevenshteinWeightTable *__pyx_v_weights;
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_t_1;
+  RF_ScorerFlags __pyx_t_2;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsLevenshteinNormalizedSimilarity", __pyx_f[0], 253, 1, __PYX_ERR(0, 253, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":254
+ * 
+ * cdef bool GetScorerFlagsLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ */
+  __Pyx_TraceLine(254,1,__PYX_ERR(0, 254, __pyx_L1_error))
+  __pyx_v_weights = ((struct rapidfuzz::LevenshteinWeightTable *)(*__pyx_v_self).context);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":255
+ * cdef bool GetScorerFlagsLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64             # <<<<<<<<<<<<<<
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ */
+  __Pyx_TraceLine(255,1,__PYX_ERR(0, 255, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":256
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:             # <<<<<<<<<<<<<<
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+  __Pyx_TraceLine(256,1,__PYX_ERR(0, 256, __pyx_L1_error))
+  __pyx_t_1 = ((*__pyx_v_weights).insert_cost == (*__pyx_v_weights).delete_cost);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":257
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ */
+    __Pyx_TraceLine(257,1,__PYX_ERR(0, 257, __pyx_L1_error))
+    __pyx_t_2 = (*__pyx_v_scorer_flags);
+    __pyx_t_2.flags = (__pyx_t_2.flags | RF_SCORER_FLAG_SYMMETRIC);
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":256
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:             # <<<<<<<<<<<<<<
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":258
+ *     if dereference(weights).insert_cost == dereference(weights).delete_cost:
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(258,1,__PYX_ERR(0, 258, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 1.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":259
+ *         dereference(scorer_flags).flags |= RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(259,1,__PYX_ERR(0, 259, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":260
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer LevenshteinDistanceContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinDistance, LevenshteinDistanceInit)
+ */
+  __Pyx_TraceLine(260,1,__PYX_ERR(0, 260, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":253
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsLevenshteinNormalizedSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":275
+ * 
+ * 
+ * def damerau_levenshtein_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_13damerau_levenshtein_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_13damerau_levenshtein_distance = {"damerau_levenshtein_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_13damerau_levenshtein_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_13damerau_levenshtein_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("damerau_levenshtein_distance (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
       }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 275, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 275, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("damerau_levenshtein_distance", 1, 2, 2, 1); __PYX_ERR(0, 275, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 275, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "damerau_levenshtein_distance") < 0)) __PYX_ERR(0, 275, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
-    {
-      PyObject *__pyx_callargs[6] = {__pyx_t_13, __pyx_t_8, __pyx_t_9, __pyx_t_10, __pyx_t_11, __pyx_t_12};
-      __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_14, 5+__pyx_t_14);
-      __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
-      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
-      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 219, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    }
-    __pyx_r = __pyx_t_5;
-    __pyx_t_5 = 0;
-    goto __pyx_L0;
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("damerau_levenshtein_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 275, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.damerau_levenshtein_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_12damerau_levenshtein_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
-    /* "rapidfuzz/fuzz_cpp.pyx":218
- *     res = partial_ratio_alignment_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_12damerau_levenshtein_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  int64_t __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int64_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__10)
+  __Pyx_RefNannySetupContext("damerau_levenshtein_distance", 0);
+  __Pyx_TraceCall("damerau_levenshtein_distance", __pyx_f[0], 275, 0, __PYX_ERR(0, 275, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":276
  * 
- *     if res.score >= c_score_cutoff:             # <<<<<<<<<<<<<<
- *         return ScoreAlignment(res.score, res.src_start, res.src_end, res.dest_start, res.dest_end)
- *     else:
+ * def damerau_levenshtein_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
  */
-  }
+  __Pyx_TraceLine(276,0,__PYX_ERR(0, 276, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, INT64_MAX); if (unlikely(__pyx_t_1 == ((int64_t)-1L))) __PYX_ERR(0, 276, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":221
- *         return ScoreAlignment(res.score, res.src_start, res.src_end, res.dest_start, res.dest_end)
- *     else:
- *         return None             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":278
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return damerau_levenshtein_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(278,0,__PYX_ERR(0, 278, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 278, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":279
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return damerau_levenshtein_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(221,0,__PYX_ERR(0, 221, __pyx_L1_error))
-  /*else*/ {
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-    goto __pyx_L0;
+  __Pyx_TraceLine(279,0,__PYX_ERR(0, 279, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_1 = damerau_levenshtein_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 279, __pyx_L1_error)
   }
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 279, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":171
+  /* "rapidfuzz/distance/metrics_cpp.pyx":275
  * 
  * 
- * def partial_ratio_alignment(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Searches for the optimal alignment of the shorter string in the
+ * def damerau_levenshtein_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_XDECREF(__pyx_t_10);
-  __Pyx_XDECREF(__pyx_t_11);
-  __Pyx_XDECREF(__pyx_t_12);
-  __Pyx_XDECREF(__pyx_t_13);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_ratio_alignment", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.damerau_levenshtein_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":224
+/* "rapidfuzz/distance/metrics_cpp.pyx":282
  * 
  * 
- * def token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Sorts the words in the strings and calculates the fuzz.ratio between them
+ * def damerau_levenshtein_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_24__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_15damerau_levenshtein_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_15damerau_levenshtein_similarity = {"damerau_levenshtein_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_15damerau_levenshtein_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_15damerau_levenshtein_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("damerau_levenshtein_similarity (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 282, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 282, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("damerau_levenshtein_similarity", 1, 2, 2, 1); __PYX_ERR(0, 282, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 282, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "damerau_levenshtein_similarity") < 0)) __PYX_ERR(0, 282, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("damerau_levenshtein_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 282, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.damerau_levenshtein_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_14damerau_levenshtein_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_14damerau_levenshtein_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  int64_t __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  int64_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 224, 0, __PYX_ERR(0, 224, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__11)
+  __Pyx_RefNannySetupContext("damerau_levenshtein_similarity", 0);
+  __Pyx_TraceCall("damerau_levenshtein_similarity", __pyx_f[0], 282, 0, __PYX_ERR(0, 282, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":283
+ * 
+ * def damerau_levenshtein_similarity(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ */
+  __Pyx_TraceLine(283,0,__PYX_ERR(0, 283, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, 0); if (unlikely(__pyx_t_1 == ((int64_t)-1L))) __PYX_ERR(0, 283, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_1;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":285
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return damerau_levenshtein_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(285,0,__PYX_ERR(0, 285, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 285, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":286
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return damerau_levenshtein_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(286,0,__PYX_ERR(0, 286, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 224, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 224, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 224, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 224, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(Py_None);
-  __Pyx_GIVEREF(Py_None);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
-  __pyx_t_1 = 0;
+  try {
+    __pyx_t_1 = damerau_levenshtein_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 286, __pyx_L1_error)
+  }
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 286, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
+  /* "rapidfuzz/distance/metrics_cpp.pyx":282
+ * 
+ * 
+ * def damerau_levenshtein_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.damerau_levenshtein_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "rapidfuzz/distance/metrics_cpp.pyx":289
+ * 
+ * 
+ * def damerau_levenshtein_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_7token_sort_ratio(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_17damerau_levenshtein_normalized_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_6token_sort_ratio, "\n    Sorts the words in the strings and calculates the fuzz.ratio between them\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    .. image:: img/token_sort_ratio.svg\n\n    Examples\n    --------\n    >>> fuzz.token_sort_ratio(\"fuzzy wuzzy was a bear\", \"wuzzy fuzzy was a bear\")\n    100.0\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_7token_sort_ratio = {"token_sort_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_7token_sort_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_6token_sort_ratio};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_7token_sort_ratio(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_17damerau_levenshtein_normalized_distance = {"damerau_levenshtein_normalized_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_17damerau_levenshtein_normalized_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_17damerau_levenshtein_normalized_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -3928,24 +6691,23 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("token_sort_ratio (wrapper)", 0);
+  __Pyx_RefNannySetupContext("damerau_levenshtein_normalized_distance (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
-    __pyx_defaults *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self);
-    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[2] = ((PyObject *)((PyObject *)Py_None));
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
@@ -3953,253 +6715,1137 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 289, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 289, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("token_sort_ratio", 1, 2, 2, 1); __PYX_ERR(0, 224, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("damerau_levenshtein_normalized_distance", 1, 2, 2, 1); __PYX_ERR(0, 289, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 224, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 289, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "token_sort_ratio") < 0)) __PYX_ERR(0, 224, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "damerau_levenshtein_normalized_distance") < 0)) __PYX_ERR(0, 289, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("token_sort_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 224, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("damerau_levenshtein_normalized_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 289, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_sort_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.damerau_levenshtein_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_6token_sort_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_16damerau_levenshtein_normalized_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_6token_sort_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_16damerau_levenshtein_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
+  double __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
+  int __pyx_t_1;
   int __pyx_t_2;
   double __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__4)
-  __Pyx_RefNannySetupContext("token_sort_ratio", 0);
-  __Pyx_TraceCall("token_sort_ratio", __pyx_f[0], 224, 0, __PYX_ERR(0, 224, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__12)
+  __Pyx_RefNannySetupContext("damerau_levenshtein_normalized_distance", 0);
+  __Pyx_TraceCall("damerau_levenshtein_normalized_distance", __pyx_f[0], 289, 0, __PYX_ERR(0, 289, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":256
- *     100.0
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":291
+ * def damerau_levenshtein_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
-  __Pyx_TraceLine(256,0,__PYX_ERR(0, 256, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
+  __Pyx_TraceLine(291,0,__PYX_ERR(0, 291, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
   } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 256, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
+    __pyx_t_1 = __pyx_t_2;
+    goto __pyx_L4_bool_binop_done;
   }
-  __pyx_v_c_score_cutoff = __pyx_t_1;
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_1) {
 
-  /* "rapidfuzz/fuzz_cpp.pyx":259
+    /* "rapidfuzz/distance/metrics_cpp.pyx":292
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
  * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ */
+    __Pyx_TraceLine(292,0,__PYX_ERR(0, 292, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":291
+ * def damerau_levenshtein_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":294
+ *         return 0
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return damerau_levenshtein_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ */
+  __Pyx_TraceLine(294,0,__PYX_ERR(0, 294, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 1.0); if (unlikely(__pyx_t_3 == ((double)-1.0))) __PYX_ERR(0, 294, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_3;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":295
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return damerau_levenshtein_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(295,0,__PYX_ERR(0, 295, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 295, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":296
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return damerau_levenshtein_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(296,0,__PYX_ERR(0, 296, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_3 = damerau_levenshtein_normalized_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 296, __pyx_L1_error)
+  }
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 296, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":289
+ * 
+ * 
+ * def damerau_levenshtein_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.damerau_levenshtein_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":299
+ * 
+ * 
+ * def damerau_levenshtein_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_19damerau_levenshtein_normalized_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_19damerau_levenshtein_normalized_similarity = {"damerau_levenshtein_normalized_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_19damerau_levenshtein_normalized_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_19damerau_levenshtein_normalized_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("damerau_levenshtein_normalized_similarity (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 299, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 299, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("damerau_levenshtein_normalized_similarity", 1, 2, 2, 1); __PYX_ERR(0, 299, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 299, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "damerau_levenshtein_normalized_similarity") < 0)) __PYX_ERR(0, 299, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("damerau_levenshtein_normalized_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 299, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.damerau_levenshtein_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_18damerau_levenshtein_normalized_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_18damerau_levenshtein_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  double __pyx_v_c_score_cutoff;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__13)
+  __Pyx_RefNannySetupContext("damerau_levenshtein_normalized_similarity", 0);
+  __Pyx_TraceCall("damerau_levenshtein_normalized_similarity", __pyx_f[0], 299, 0, __PYX_ERR(0, 299, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":301
+ * def damerau_levenshtein_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
-  __Pyx_TraceLine(259,0,__PYX_ERR(0, 259, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
+  __Pyx_TraceLine(301,0,__PYX_ERR(0, 301, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
   } else {
-    __pyx_t_2 = __pyx_t_4;
+    __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_2) {
+  if (__pyx_t_1) {
 
-    /* "rapidfuzz/fuzz_cpp.pyx":260
- * 
+    /* "rapidfuzz/distance/metrics_cpp.pyx":302
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  *     if s1 is None or s2 is None:
  *         return 0             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
  */
-    __Pyx_TraceLine(260,0,__PYX_ERR(0, 260, __pyx_L1_error))
+    __Pyx_TraceLine(302,0,__PYX_ERR(0, 302, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_int_0);
     __pyx_r = __pyx_int_0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":259
+    /* "rapidfuzz/distance/metrics_cpp.pyx":301
+ * def damerau_levenshtein_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":262
+  /* "rapidfuzz/distance/metrics_cpp.pyx":304
  *         return 0
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     return token_sort_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ */
+  __Pyx_TraceLine(304,0,__PYX_ERR(0, 304, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 0.0); if (unlikely(__pyx_t_3 == ((double)-1.0))) __PYX_ERR(0, 304, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_3;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":305
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(262,0,__PYX_ERR(0, 262, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 262, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 262, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(305,0,__PYX_ERR(0, 305, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 305, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":306
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(306,0,__PYX_ERR(0, 306, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_3 = damerau_levenshtein_normalized_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 306, __pyx_L1_error)
+  }
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 306, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
+  goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":263
+  /* "rapidfuzz/distance/metrics_cpp.pyx":299
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     return token_sort_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
+ * def damerau_levenshtein_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.damerau_levenshtein_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":308
+ *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
  */
-  __Pyx_TraceLine(263,0,__PYX_ERR(0, 263, __pyx_L1_error))
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsDamerauLevenshteinDistance", __pyx_f[0], 308, 1, __PYX_ERR(0, 308, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":309
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ */
+  __Pyx_TraceLine(309,1,__PYX_ERR(0, 309, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":310
+ * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ *     return True
+ */
+  __Pyx_TraceLine(310,1,__PYX_ERR(0, 310, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":311
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(311,1,__PYX_ERR(0, 311, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":312
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(312,1,__PYX_ERR(0, 312, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":308
+ *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsDamerauLevenshteinDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":314
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinNormalizedDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsDamerauLevenshteinNormalizedDistance", __pyx_f[0], 314, 1, __PYX_ERR(0, 314, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":315
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1
+ */
+  __Pyx_TraceLine(315,1,__PYX_ERR(0, 315, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":316
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 1
+ *     return True
+ */
+  __Pyx_TraceLine(316,1,__PYX_ERR(0, 316, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":317
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(317,1,__PYX_ERR(0, 317, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 1.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":318
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(318,1,__PYX_ERR(0, 318, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":314
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsDamerauLevenshteinNormalizedDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":320
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsDamerauLevenshteinSimilarity", __pyx_f[0], 320, 1, __PYX_ERR(0, 320, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":321
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ */
+  __Pyx_TraceLine(321,1,__PYX_ERR(0, 321, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":322
+ * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(322,1,__PYX_ERR(0, 322, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":323
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(323,1,__PYX_ERR(0, 323, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":324
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(324,1,__PYX_ERR(0, 324, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":320
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsDamerauLevenshteinSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":326
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsDamerauLevenshteinNormalizedSimilarity", __pyx_f[0], 326, 1, __PYX_ERR(0, 326, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":327
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ */
+  __Pyx_TraceLine(327,1,__PYX_ERR(0, 327, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":328
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(328,1,__PYX_ERR(0, 328, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 1.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":329
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(329,1,__PYX_ERR(0, 329, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":330
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer DamerauLevenshteinDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinDistance, DamerauLevenshteinDistanceInit)
+ */
+  __Pyx_TraceLine(330,1,__PYX_ERR(0, 330, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":326
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsDamerauLevenshteinNormalizedSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":345
+ * 
+ * 
+ * def lcs_seq_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_21lcs_seq_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_21lcs_seq_distance = {"lcs_seq_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_21lcs_seq_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_21lcs_seq_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("lcs_seq_distance (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 345, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 345, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("lcs_seq_distance", 1, 2, 2, 1); __PYX_ERR(0, 345, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 345, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lcs_seq_distance") < 0)) __PYX_ERR(0, 345, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("lcs_seq_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 345, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_20lcs_seq_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_20lcs_seq_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  int64_t __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int64_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__14)
+  __Pyx_RefNannySetupContext("lcs_seq_distance", 0);
+  __Pyx_TraceCall("lcs_seq_distance", __pyx_f[0], 345, 0, __PYX_ERR(0, 345, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":346
+ * 
+ * def lcs_seq_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ */
+  __Pyx_TraceLine(346,0,__PYX_ERR(0, 346, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, INT64_MAX); if (unlikely(__pyx_t_1 == ((int64_t)-1L))) __PYX_ERR(0, 346, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_1;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":348
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return lcs_seq_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(348,0,__PYX_ERR(0, 348, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 348, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":349
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return lcs_seq_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(349,0,__PYX_ERR(0, 349, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = token_sort_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_1 = lcs_seq_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 263, __pyx_L1_error)
+    __PYX_ERR(0, 349, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 263, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 349, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":224
+  /* "rapidfuzz/distance/metrics_cpp.pyx":345
  * 
  * 
- * def token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Sorts the words in the strings and calculates the fuzz.ratio between them
+ * def lcs_seq_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_sort_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":266
+/* "rapidfuzz/distance/metrics_cpp.pyx":352
  * 
  * 
- * def token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Compares the words in the strings based on unique and common words between them
+ * def lcs_seq_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_26__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_23lcs_seq_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_23lcs_seq_similarity = {"lcs_seq_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_23lcs_seq_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_23lcs_seq_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("lcs_seq_similarity (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 352, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 352, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("lcs_seq_similarity", 1, 2, 2, 1); __PYX_ERR(0, 352, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 352, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lcs_seq_similarity") < 0)) __PYX_ERR(0, 352, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("lcs_seq_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 352, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_22lcs_seq_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_22lcs_seq_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  int64_t __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  int64_t __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 266, 0, __PYX_ERR(0, 266, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__15)
+  __Pyx_RefNannySetupContext("lcs_seq_similarity", 0);
+  __Pyx_TraceCall("lcs_seq_similarity", __pyx_f[0], 352, 0, __PYX_ERR(0, 352, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":353
+ * 
+ * def lcs_seq_similarity(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ */
+  __Pyx_TraceLine(353,0,__PYX_ERR(0, 353, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, 0); if (unlikely(__pyx_t_1 == ((int64_t)-1L))) __PYX_ERR(0, 353, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_1;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":355
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return lcs_seq_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(355,0,__PYX_ERR(0, 355, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 355, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":356
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return lcs_seq_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(356,0,__PYX_ERR(0, 356, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 266, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 266, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(Py_None);
-  __Pyx_GIVEREF(Py_None);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
-  __pyx_t_1 = 0;
+  try {
+    __pyx_t_1 = lcs_seq_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 356, __pyx_L1_error)
+  }
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 356, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
+  /* "rapidfuzz/distance/metrics_cpp.pyx":352
+ * 
+ * 
+ * def lcs_seq_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "rapidfuzz/distance/metrics_cpp.pyx":359
+ * 
+ * 
+ * def lcs_seq_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_9token_set_ratio(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_25lcs_seq_normalized_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_8token_set_ratio, "\n    Compares the words in the strings based on unique and common words between them\n    using fuzz.ratio\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    .. image:: img/token_set_ratio.svg\n\n    Examples\n    --------\n    >>> fuzz.token_sort_ratio(\"fuzzy was a bear\", \"fuzzy fuzzy was a bear\")\n    83.8709716796875\n    >>> fuzz.token_set_ratio(\"fuzzy was a bear\", \"fuzzy fuzzy was a bear\")\n    100.0\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_9token_set_ratio = {"token_set_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_9token_set_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_8token_set_ratio};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_9token_set_ratio(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_25lcs_seq_normalized_distance = {"lcs_seq_normalized_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_25lcs_seq_normalized_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_25lcs_seq_normalized_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -4211,24 +7857,23 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("token_set_ratio (wrapper)", 0);
+  __Pyx_RefNannySetupContext("lcs_seq_normalized_distance (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
-    __pyx_defaults1 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self);
-    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[2] = ((PyObject *)((PyObject *)Py_None));
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
@@ -4236,253 +7881,1178 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 266, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 359, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 266, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 359, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("token_set_ratio", 1, 2, 2, 1); __PYX_ERR(0, 266, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("lcs_seq_normalized_distance", 1, 2, 2, 1); __PYX_ERR(0, 359, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 266, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 359, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "token_set_ratio") < 0)) __PYX_ERR(0, 266, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lcs_seq_normalized_distance") < 0)) __PYX_ERR(0, 359, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("token_set_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 266, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("lcs_seq_normalized_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 359, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_set_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_8token_set_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_24lcs_seq_normalized_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_8token_set_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_24lcs_seq_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
+  double __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
+  int __pyx_t_1;
   int __pyx_t_2;
   double __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__5)
-  __Pyx_RefNannySetupContext("token_set_ratio", 0);
-  __Pyx_TraceCall("token_set_ratio", __pyx_f[0], 266, 0, __PYX_ERR(0, 266, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__16)
+  __Pyx_RefNannySetupContext("lcs_seq_normalized_distance", 0);
+  __Pyx_TraceCall("lcs_seq_normalized_distance", __pyx_f[0], 359, 0, __PYX_ERR(0, 359, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":301
- *     100.0
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":361
+ * def lcs_seq_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
-  __Pyx_TraceLine(301,0,__PYX_ERR(0, 301, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
+  __Pyx_TraceLine(361,0,__PYX_ERR(0, 361, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
   } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 301, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
+    __pyx_t_1 = __pyx_t_2;
+    goto __pyx_L4_bool_binop_done;
   }
-  __pyx_v_c_score_cutoff = __pyx_t_1;
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_1) {
 
-  /* "rapidfuzz/fuzz_cpp.pyx":304
+    /* "rapidfuzz/distance/metrics_cpp.pyx":362
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
  * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ */
+    __Pyx_TraceLine(362,0,__PYX_ERR(0, 362, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":361
+ * def lcs_seq_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
-  __Pyx_TraceLine(304,0,__PYX_ERR(0, 304, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":364
+ *         return 0
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return lcs_seq_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ */
+  __Pyx_TraceLine(364,0,__PYX_ERR(0, 364, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 1.0); if (unlikely(__pyx_t_3 == ((double)-1.0))) __PYX_ERR(0, 364, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_3;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":365
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return lcs_seq_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(365,0,__PYX_ERR(0, 365, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 365, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":366
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return lcs_seq_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(366,0,__PYX_ERR(0, 366, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_3 = lcs_seq_normalized_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 366, __pyx_L1_error)
+  }
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 366, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":359
+ * 
+ * 
+ * def lcs_seq_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":369
+ * 
+ * 
+ * def lcs_seq_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_27lcs_seq_normalized_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_27lcs_seq_normalized_similarity = {"lcs_seq_normalized_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_27lcs_seq_normalized_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_27lcs_seq_normalized_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("lcs_seq_normalized_similarity (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 369, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 369, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("lcs_seq_normalized_similarity", 1, 2, 2, 1); __PYX_ERR(0, 369, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 369, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lcs_seq_normalized_similarity") < 0)) __PYX_ERR(0, 369, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("lcs_seq_normalized_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 369, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_26lcs_seq_normalized_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_26lcs_seq_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  double __pyx_v_c_score_cutoff;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__17)
+  __Pyx_RefNannySetupContext("lcs_seq_normalized_similarity", 0);
+  __Pyx_TraceCall("lcs_seq_normalized_similarity", __pyx_f[0], 369, 0, __PYX_ERR(0, 369, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":371
+ * def lcs_seq_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  __Pyx_TraceLine(371,0,__PYX_ERR(0, 371, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
   } else {
-    __pyx_t_2 = __pyx_t_4;
+    __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_2) {
+  if (__pyx_t_1) {
 
-    /* "rapidfuzz/fuzz_cpp.pyx":305
- * 
+    /* "rapidfuzz/distance/metrics_cpp.pyx":372
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  *     if s1 is None or s2 is None:
  *         return 0             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
  */
-    __Pyx_TraceLine(305,0,__PYX_ERR(0, 305, __pyx_L1_error))
+    __Pyx_TraceLine(372,0,__PYX_ERR(0, 372, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_int_0);
     __pyx_r = __pyx_int_0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":304
+    /* "rapidfuzz/distance/metrics_cpp.pyx":371
+ * def lcs_seq_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":307
+  /* "rapidfuzz/distance/metrics_cpp.pyx":374
  *         return 0
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     return token_set_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return lcs_seq_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  */
-  __Pyx_TraceLine(307,0,__PYX_ERR(0, 307, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 307, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 307, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(374,0,__PYX_ERR(0, 374, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 0.0); if (unlikely(__pyx_t_3 == ((double)-1.0))) __PYX_ERR(0, 374, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_3;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":308
+  /* "rapidfuzz/distance/metrics_cpp.pyx":375
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return lcs_seq_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     return token_set_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ */
+  __Pyx_TraceLine(375,0,__PYX_ERR(0, 375, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 375, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":376
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return lcs_seq_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(308,0,__PYX_ERR(0, 308, __pyx_L1_error))
+  __Pyx_TraceLine(376,0,__PYX_ERR(0, 376, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = token_set_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_3 = lcs_seq_normalized_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 308, __pyx_L1_error)
+    __PYX_ERR(0, 376, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 308, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 376, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":266
+  /* "rapidfuzz/distance/metrics_cpp.pyx":369
  * 
  * 
- * def token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Compares the words in the strings based on unique and common words between them
+ * def lcs_seq_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_set_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":311
+/* "rapidfuzz/distance/metrics_cpp.pyx":379
  * 
  * 
- * def token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Helper method that returns the maximum of fuzz.token_set_ratio and fuzz.token_sort_ratio
+ * def lcs_seq_editops(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_28__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_29lcs_seq_editops(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_29lcs_seq_editops = {"lcs_seq_editops", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_29lcs_seq_editops, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_29lcs_seq_editops(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("lcs_seq_editops (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,0};
+    #endif
+    PyObject* values[3] = {0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 379, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 379, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("lcs_seq_editops", 1, 2, 2, 1); __PYX_ERR(0, 379, __pyx_L3_error)
+        }
+      }
+      if (kw_args == 1) {
+        const Py_ssize_t index = 2;
+        PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+        if (value) { values[index] = value; kw_args--; }
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 379, __pyx_L3_error)
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lcs_seq_editops") < 0)) __PYX_ERR(0, 379, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("lcs_seq_editops", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 379, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_editops", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_28lcs_seq_editops(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_28lcs_seq_editops(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *__pyx_v_ops = 0;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
+  rapidfuzz::Editops __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 311, 0, __PYX_ERR(0, 311, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__18)
+  __Pyx_RefNannySetupContext("lcs_seq_editops", 0);
+  __Pyx_TraceCall("lcs_seq_editops", __pyx_f[0], 379, 0, __PYX_ERR(0, 379, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":381
+ * def lcs_seq_editops(s1, s2, *, processor=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ */
+  __Pyx_TraceLine(381,0,__PYX_ERR(0, 381, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_tp_new(((PyObject *)__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops), __pyx_empty_tuple); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 381, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (!(likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops)))) __PYX_ERR(0, 381, __pyx_L1_error)
+  __pyx_v_ops = ((struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *)__pyx_t_1);
+  __pyx_t_1 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":383
+ *     cdef Editops ops = Editops.__new__(Editops)
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     ops.editops = lcs_seq_editops_func(s1_proc.string, s2_proc.string)
+ *     return ops
+ */
+  __Pyx_TraceLine(383,0,__PYX_ERR(0, 383, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 383, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":384
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = lcs_seq_editops_func(s1_proc.string, s2_proc.string)             # <<<<<<<<<<<<<<
+ *     return ops
+ * 
+ */
+  __Pyx_TraceLine(384,0,__PYX_ERR(0, 384, __pyx_L1_error))
+  try {
+    __pyx_t_2 = lcs_seq_editops_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 384, __pyx_L1_error)
+  }
+  __pyx_v_ops->editops = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_2);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":385
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = lcs_seq_editops_func(s1_proc.string, s2_proc.string)
+ *     return ops             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(385,0,__PYX_ERR(0, 385, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 311, __pyx_L1_error)
+  __Pyx_INCREF((PyObject *)__pyx_v_ops);
+  __pyx_r = ((PyObject *)__pyx_v_ops);
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":379
+ * 
+ * 
+ * def lcs_seq_editops(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_editops", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_ops);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":388
+ * 
+ * 
+ * def lcs_seq_opcodes(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_31lcs_seq_opcodes(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_31lcs_seq_opcodes = {"lcs_seq_opcodes", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_31lcs_seq_opcodes, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_31lcs_seq_opcodes(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("lcs_seq_opcodes (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,0};
+    #endif
+    PyObject* values[3] = {0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 388, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 388, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("lcs_seq_opcodes", 1, 2, 2, 1); __PYX_ERR(0, 388, __pyx_L3_error)
+        }
+      }
+      if (kw_args == 1) {
+        const Py_ssize_t index = 2;
+        PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+        if (value) { values[index] = value; kw_args--; }
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 388, __pyx_L3_error)
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lcs_seq_opcodes") < 0)) __PYX_ERR(0, 388, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("lcs_seq_opcodes", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 388, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_opcodes", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_30lcs_seq_opcodes(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_30lcs_seq_opcodes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *__pyx_v_ops = 0;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  rapidfuzz::Editops __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_t_5;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__19)
+  __Pyx_RefNannySetupContext("lcs_seq_opcodes", 0);
+  __Pyx_TraceCall("lcs_seq_opcodes", __pyx_f[0], 388, 0, __PYX_ERR(0, 388, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":390
+ * def lcs_seq_opcodes(s1, s2, *, processor=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ */
+  __Pyx_TraceLine(390,0,__PYX_ERR(0, 390, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_tp_new(((PyObject *)__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops), __pyx_empty_tuple); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 390, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 311, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 311, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 311, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(Py_None);
-  __Pyx_GIVEREF(Py_None);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  if (!(likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops)))) __PYX_ERR(0, 390, __pyx_L1_error)
+  __pyx_v_ops = ((struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *)__pyx_t_1);
+  __pyx_t_1 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":392
+ *     cdef Editops ops = Editops.__new__(Editops)
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     ops.editops = lcs_seq_editops_func(s1_proc.string, s2_proc.string)
+ *     return ops.as_opcodes()
+ */
+  __Pyx_TraceLine(392,0,__PYX_ERR(0, 392, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 392, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":393
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = lcs_seq_editops_func(s1_proc.string, s2_proc.string)             # <<<<<<<<<<<<<<
+ *     return ops.as_opcodes()
+ * 
+ */
+  __Pyx_TraceLine(393,0,__PYX_ERR(0, 393, __pyx_L1_error))
+  try {
+    __pyx_t_2 = lcs_seq_editops_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 393, __pyx_L1_error)
+  }
+  __pyx_v_ops->editops = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_2);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":394
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = lcs_seq_editops_func(s1_proc.string, s2_proc.string)
+ *     return ops.as_opcodes()             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(394,0,__PYX_ERR(0, 394, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_ops), __pyx_n_s_as_opcodes); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 394, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = NULL;
+  __pyx_t_5 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
+    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+    if (likely(__pyx_t_4)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+      __Pyx_INCREF(__pyx_t_4);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_3, function);
+      __pyx_t_5 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[1] = {__pyx_t_4, };
+    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 394, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  }
+  __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
-  __pyx_r = __pyx_t_2;
-  __pyx_t_2 = 0;
   goto __pyx_L0;
 
+  /* "rapidfuzz/distance/metrics_cpp.pyx":388
+ * 
+ * 
+ * def lcs_seq_opcodes(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.lcs_seq_opcodes", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_ops);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "rapidfuzz/distance/metrics_cpp.pyx":397
+ * 
+ * 
+ * cdef bool GetScorerFlagsLCSseqDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsLCSseqDistance", __pyx_f[0], 397, 1, __PYX_ERR(0, 397, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":398
+ * 
+ * cdef bool GetScorerFlagsLCSseqDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ */
+  __Pyx_TraceLine(398,1,__PYX_ERR(0, 398, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":399
+ * cdef bool GetScorerFlagsLCSseqDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ *     return True
+ */
+  __Pyx_TraceLine(399,1,__PYX_ERR(0, 399, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":400
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(400,1,__PYX_ERR(0, 400, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":401
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsLCSseqNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(401,1,__PYX_ERR(0, 401, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":397
+ * 
+ * 
+ * cdef bool GetScorerFlagsLCSseqDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsLCSseqDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":403
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLCSseqNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqNormalizedDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsLCSseqNormalizedDistance", __pyx_f[0], 403, 1, __PYX_ERR(0, 403, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":404
+ * 
+ * cdef bool GetScorerFlagsLCSseqNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1
+ */
+  __Pyx_TraceLine(404,1,__PYX_ERR(0, 404, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":405
+ * cdef bool GetScorerFlagsLCSseqNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 1
+ *     return True
+ */
+  __Pyx_TraceLine(405,1,__PYX_ERR(0, 405, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":406
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(406,1,__PYX_ERR(0, 406, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 1.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":407
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsLCSseqSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(407,1,__PYX_ERR(0, 407, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":403
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLCSseqNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsLCSseqNormalizedDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":409
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLCSseqSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsLCSseqSimilarity", __pyx_f[0], 409, 1, __PYX_ERR(0, 409, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":410
+ * 
+ * cdef bool GetScorerFlagsLCSseqSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ */
+  __Pyx_TraceLine(410,1,__PYX_ERR(0, 410, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":411
+ * cdef bool GetScorerFlagsLCSseqSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(411,1,__PYX_ERR(0, 411, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":412
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(412,1,__PYX_ERR(0, 412, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":413
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsLCSseqNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(413,1,__PYX_ERR(0, 413, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":409
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLCSseqSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsLCSseqSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":415
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLCSseqNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqNormalizedSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsLCSseqNormalizedSimilarity", __pyx_f[0], 415, 1, __PYX_ERR(0, 415, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":416
+ * 
+ * cdef bool GetScorerFlagsLCSseqNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ */
+  __Pyx_TraceLine(416,1,__PYX_ERR(0, 416, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":417
+ * cdef bool GetScorerFlagsLCSseqNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(417,1,__PYX_ERR(0, 417, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 1.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":418
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(418,1,__PYX_ERR(0, 418, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":419
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer LCSseqDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqDistance, LCSseqDistanceInit)
+ */
+  __Pyx_TraceLine(419,1,__PYX_ERR(0, 419, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":415
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLCSseqNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsLCSseqNormalizedSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":434
+ * 
+ * 
+ * def indel_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_11token_ratio(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_33indel_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_10token_ratio, "\n    Helper method that returns the maximum of fuzz.token_set_ratio and fuzz.token_sort_ratio\n    (faster than manually executing the two functions)\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    .. image:: img/token_ratio.svg\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_11token_ratio = {"token_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_11token_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_10token_ratio};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_11token_ratio(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_33indel_distance = {"indel_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_33indel_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_33indel_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -4494,24 +9064,23 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("token_ratio (wrapper)", 0);
+  __Pyx_RefNannySetupContext("indel_distance (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
-    __pyx_defaults2 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self);
-    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[2] = ((PyObject *)((PyObject *)Py_None));
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
@@ -4519,253 +9088,575 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 311, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 434, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 311, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 434, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("token_ratio", 1, 2, 2, 1); __PYX_ERR(0, 311, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("indel_distance", 1, 2, 2, 1); __PYX_ERR(0, 434, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 311, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 434, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "token_ratio") < 0)) __PYX_ERR(0, 311, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "indel_distance") < 0)) __PYX_ERR(0, 434, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("token_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 311, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("indel_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 434, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_10token_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_32indel_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_10token_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_32indel_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  int64_t __pyx_v_c_score_cutoff;
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
-  int __pyx_t_2;
-  double __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
+  int64_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__6)
-  __Pyx_RefNannySetupContext("token_ratio", 0);
-  __Pyx_TraceCall("token_ratio", __pyx_f[0], 311, 0, __PYX_ERR(0, 311, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__20)
+  __Pyx_RefNannySetupContext("indel_distance", 0);
+  __Pyx_TraceCall("indel_distance", __pyx_f[0], 434, 0, __PYX_ERR(0, 434, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":339
- *     .. image:: img/token_ratio.svg
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
- *     cdef RF_StringWrapper s1_proc, s2_proc
+  /* "rapidfuzz/distance/metrics_cpp.pyx":435
  * 
+ * def indel_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
  */
-  __Pyx_TraceLine(339,0,__PYX_ERR(0, 339, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
-  } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 339, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
-  }
+  __Pyx_TraceLine(435,0,__PYX_ERR(0, 435, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, INT64_MAX); if (unlikely(__pyx_t_1 == ((int64_t)-1L))) __PYX_ERR(0, 435, __pyx_L1_error)
   __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":342
+  /* "rapidfuzz/distance/metrics_cpp.pyx":437
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
  *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return indel_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(437,0,__PYX_ERR(0, 437, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 437, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":438
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return indel_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
  * 
  */
-  __Pyx_TraceLine(342,0,__PYX_ERR(0, 342, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
-  } else {
-    __pyx_t_2 = __pyx_t_4;
-    goto __pyx_L4_bool_binop_done;
+  __Pyx_TraceLine(438,0,__PYX_ERR(0, 438, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_1 = indel_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 438, __pyx_L1_error)
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
-  __pyx_L4_bool_binop_done:;
-  if (__pyx_t_2) {
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 438, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":343
+  /* "rapidfuzz/distance/metrics_cpp.pyx":434
  * 
- *     if s1 is None or s2 is None:
- *         return 0             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ * def indel_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-    __Pyx_TraceLine(343,0,__PYX_ERR(0, 343, __pyx_L1_error))
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_int_0);
-    __pyx_r = __pyx_int_0;
-    goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":342
- *     cdef RF_StringWrapper s1_proc, s2_proc
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":441
  * 
- *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
- *         return 0
  * 
+ * def indel_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_35indel_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_35indel_similarity = {"indel_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_35indel_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_35indel_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("indel_similarity (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 441, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 441, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("indel_similarity", 1, 2, 2, 1); __PYX_ERR(0, 441, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 441, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "indel_similarity") < 0)) __PYX_ERR(0, 441, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
   }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("indel_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 441, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_34indel_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":345
- *         return 0
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     return token_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_34indel_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  int64_t __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int64_t __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__21)
+  __Pyx_RefNannySetupContext("indel_similarity", 0);
+  __Pyx_TraceCall("indel_similarity", __pyx_f[0], 441, 0, __PYX_ERR(0, 441, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":442
  * 
+ * def indel_similarity(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
  */
-  __Pyx_TraceLine(345,0,__PYX_ERR(0, 345, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 345, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 345, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(442,0,__PYX_ERR(0, 442, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, 0); if (unlikely(__pyx_t_1 == ((int64_t)-1L))) __PYX_ERR(0, 442, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":346
+  /* "rapidfuzz/distance/metrics_cpp.pyx":444
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return indel_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     return token_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ */
+  __Pyx_TraceLine(444,0,__PYX_ERR(0, 444, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 444, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":445
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return indel_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(346,0,__PYX_ERR(0, 346, __pyx_L1_error))
+  __Pyx_TraceLine(445,0,__PYX_ERR(0, 445, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = token_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_1 = indel_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 346, __pyx_L1_error)
+    __PYX_ERR(0, 445, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 346, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 445, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":311
+  /* "rapidfuzz/distance/metrics_cpp.pyx":441
  * 
  * 
- * def token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Helper method that returns the maximum of fuzz.token_set_ratio and fuzz.token_sort_ratio
+ * def indel_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.token_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":349
+/* "rapidfuzz/distance/metrics_cpp.pyx":448
  * 
  * 
- * def partial_token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     sorts the words in the strings and calculates the fuzz.partial_ratio between them
+ * def indel_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_30__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_37indel_normalized_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_37indel_normalized_distance = {"indel_normalized_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_37indel_normalized_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_37indel_normalized_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("indel_normalized_distance (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 448, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 448, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("indel_normalized_distance", 1, 2, 2, 1); __PYX_ERR(0, 448, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 448, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "indel_normalized_distance") < 0)) __PYX_ERR(0, 448, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("indel_normalized_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 448, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_36indel_normalized_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_36indel_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  double __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
+  int __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 349, 0, __PYX_ERR(0, 349, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__22)
+  __Pyx_RefNannySetupContext("indel_normalized_distance", 0);
+  __Pyx_TraceCall("indel_normalized_distance", __pyx_f[0], 448, 0, __PYX_ERR(0, 448, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":450
+ * def indel_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  __Pyx_TraceLine(450,0,__PYX_ERR(0, 450, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
+  } else {
+    __pyx_t_1 = __pyx_t_2;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":451
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ */
+    __Pyx_TraceLine(451,0,__PYX_ERR(0, 451, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":450
+ * def indel_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":453
+ *         return 0
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return indel_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ */
+  __Pyx_TraceLine(453,0,__PYX_ERR(0, 453, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 1.0); if (unlikely(__pyx_t_3 == ((double)-1.0))) __PYX_ERR(0, 453, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_3;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":454
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return indel_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(454,0,__PYX_ERR(0, 454, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 454, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":455
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return indel_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(455,0,__PYX_ERR(0, 455, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 349, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 349, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 349, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(Py_None);
-  __Pyx_GIVEREF(Py_None);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
-  __pyx_t_1 = 0;
-  __pyx_r = __pyx_t_2;
-  __pyx_t_2 = 0;
+  try {
+    __pyx_t_3 = indel_normalized_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 455, __pyx_L1_error)
+  }
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 455, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
   goto __pyx_L0;
 
+  /* "rapidfuzz/distance/metrics_cpp.pyx":448
+ * 
+ * 
+ * def indel_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "rapidfuzz/distance/metrics_cpp.pyx":458
+ * 
+ * 
+ * def indel_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_13partial_token_sort_ratio(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_39indel_normalized_similarity(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_12partial_token_sort_ratio, "\n    sorts the words in the strings and calculates the fuzz.partial_ratio between them\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    .. image:: img/partial_token_sort_ratio.svg\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_13partial_token_sort_ratio = {"partial_token_sort_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_13partial_token_sort_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_12partial_token_sort_ratio};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_13partial_token_sort_ratio(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_39indel_normalized_similarity = {"indel_normalized_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_39indel_normalized_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_39indel_normalized_similarity(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -4777,24 +9668,23 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("partial_token_sort_ratio (wrapper)", 0);
+  __Pyx_RefNannySetupContext("indel_normalized_similarity (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
-    __pyx_defaults3 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self);
-    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[2] = ((PyObject *)((PyObject *)Py_None));
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
@@ -4802,253 +9692,948 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 349, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 458, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 349, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 458, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("partial_token_sort_ratio", 1, 2, 2, 1); __PYX_ERR(0, 349, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("indel_normalized_similarity", 1, 2, 2, 1); __PYX_ERR(0, 458, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 349, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 458, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "partial_token_sort_ratio") < 0)) __PYX_ERR(0, 349, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "indel_normalized_similarity") < 0)) __PYX_ERR(0, 458, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("partial_token_sort_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 349, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("indel_normalized_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 458, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_sort_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_12partial_token_sort_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_38indel_normalized_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_12partial_token_sort_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_38indel_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
+  double __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
+  int __pyx_t_1;
   int __pyx_t_2;
   double __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__7)
-  __Pyx_RefNannySetupContext("partial_token_sort_ratio", 0);
-  __Pyx_TraceCall("partial_token_sort_ratio", __pyx_f[0], 349, 0, __PYX_ERR(0, 349, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__23)
+  __Pyx_RefNannySetupContext("indel_normalized_similarity", 0);
+  __Pyx_TraceCall("indel_normalized_similarity", __pyx_f[0], 458, 0, __PYX_ERR(0, 458, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":376
- *     .. image:: img/partial_token_sort_ratio.svg
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":460
+ * def indel_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
- */
-  __Pyx_TraceLine(376,0,__PYX_ERR(0, 376, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
-  } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 376, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
-  }
-  __pyx_v_c_score_cutoff = __pyx_t_1;
-
-  /* "rapidfuzz/fuzz_cpp.pyx":379
- *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
-  __Pyx_TraceLine(379,0,__PYX_ERR(0, 379, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
+  __Pyx_TraceLine(460,0,__PYX_ERR(0, 460, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
   } else {
-    __pyx_t_2 = __pyx_t_4;
+    __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_2) {
+  if (__pyx_t_1) {
 
-    /* "rapidfuzz/fuzz_cpp.pyx":380
- * 
+    /* "rapidfuzz/distance/metrics_cpp.pyx":461
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  *     if s1 is None or s2 is None:
  *         return 0             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
  */
-    __Pyx_TraceLine(380,0,__PYX_ERR(0, 380, __pyx_L1_error))
+    __Pyx_TraceLine(461,0,__PYX_ERR(0, 461, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_int_0);
     __pyx_r = __pyx_int_0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":379
+    /* "rapidfuzz/distance/metrics_cpp.pyx":460
+ * def indel_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":382
+  /* "rapidfuzz/distance/metrics_cpp.pyx":463
  *         return 0
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     return partial_token_sort_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
- * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return indel_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  */
-  __Pyx_TraceLine(382,0,__PYX_ERR(0, 382, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 382, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 382, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(463,0,__PYX_ERR(0, 463, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 0.0); if (unlikely(__pyx_t_3 == ((double)-1.0))) __PYX_ERR(0, 463, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_3;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":383
+  /* "rapidfuzz/distance/metrics_cpp.pyx":464
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     return partial_token_sort_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return indel_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(464,0,__PYX_ERR(0, 464, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 464, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":465
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return indel_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(383,0,__PYX_ERR(0, 383, __pyx_L1_error))
+  __Pyx_TraceLine(465,0,__PYX_ERR(0, 465, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = partial_token_sort_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_3 = indel_normalized_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 383, __pyx_L1_error)
+    __PYX_ERR(0, 465, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 383, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 465, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":349
+  /* "rapidfuzz/distance/metrics_cpp.pyx":458
  * 
  * 
- * def partial_token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     sorts the words in the strings and calculates the fuzz.partial_ratio between them
+ * def indel_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_sort_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":386
+/* "rapidfuzz/distance/metrics_cpp.pyx":468
  * 
  * 
- * def partial_token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Compares the words in the strings based on unique and common words between them
+ * def indel_editops(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_32__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_41indel_editops(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_41indel_editops = {"indel_editops", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_41indel_editops, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_41indel_editops(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("indel_editops (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,0};
+    #endif
+    PyObject* values[3] = {0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 468, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 468, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("indel_editops", 1, 2, 2, 1); __PYX_ERR(0, 468, __pyx_L3_error)
+        }
+      }
+      if (kw_args == 1) {
+        const Py_ssize_t index = 2;
+        PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+        if (value) { values[index] = value; kw_args--; }
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 468, __pyx_L3_error)
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "indel_editops") < 0)) __PYX_ERR(0, 468, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("indel_editops", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 468, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_editops", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_40indel_editops(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_40indel_editops(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *__pyx_v_ops = 0;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
+  rapidfuzz::Editops __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 386, 0, __PYX_ERR(0, 386, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__24)
+  __Pyx_RefNannySetupContext("indel_editops", 0);
+  __Pyx_TraceCall("indel_editops", __pyx_f[0], 468, 0, __PYX_ERR(0, 468, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":470
+ * def indel_editops(s1, s2, *, processor=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ */
+  __Pyx_TraceLine(470,0,__PYX_ERR(0, 470, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_tp_new(((PyObject *)__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops), __pyx_empty_tuple); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 470, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (!(likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops)))) __PYX_ERR(0, 470, __pyx_L1_error)
+  __pyx_v_ops = ((struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *)__pyx_t_1);
+  __pyx_t_1 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":472
+ *     cdef Editops ops = Editops.__new__(Editops)
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     ops.editops = indel_editops_func(s1_proc.string, s2_proc.string)
+ *     return ops
+ */
+  __Pyx_TraceLine(472,0,__PYX_ERR(0, 472, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 472, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":473
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = indel_editops_func(s1_proc.string, s2_proc.string)             # <<<<<<<<<<<<<<
+ *     return ops
+ * 
+ */
+  __Pyx_TraceLine(473,0,__PYX_ERR(0, 473, __pyx_L1_error))
+  try {
+    __pyx_t_2 = indel_editops_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 473, __pyx_L1_error)
+  }
+  __pyx_v_ops->editops = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_2);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":474
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = indel_editops_func(s1_proc.string, s2_proc.string)
+ *     return ops             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(474,0,__PYX_ERR(0, 474, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 386, __pyx_L1_error)
+  __Pyx_INCREF((PyObject *)__pyx_v_ops);
+  __pyx_r = ((PyObject *)__pyx_v_ops);
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":468
+ * 
+ * 
+ * def indel_editops(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_editops", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_ops);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":477
+ * 
+ * 
+ * def indel_opcodes(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_43indel_opcodes(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_43indel_opcodes = {"indel_opcodes", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_43indel_opcodes, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_43indel_opcodes(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("indel_opcodes (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,0};
+    #endif
+    PyObject* values[3] = {0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 477, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 477, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("indel_opcodes", 1, 2, 2, 1); __PYX_ERR(0, 477, __pyx_L3_error)
+        }
+      }
+      if (kw_args == 1) {
+        const Py_ssize_t index = 2;
+        PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+        if (value) { values[index] = value; kw_args--; }
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 477, __pyx_L3_error)
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "indel_opcodes") < 0)) __PYX_ERR(0, 477, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("indel_opcodes", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 477, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_opcodes", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_42indel_opcodes(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_42indel_opcodes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *__pyx_v_ops = 0;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  rapidfuzz::Editops __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_t_5;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__25)
+  __Pyx_RefNannySetupContext("indel_opcodes", 0);
+  __Pyx_TraceCall("indel_opcodes", __pyx_f[0], 477, 0, __PYX_ERR(0, 477, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":479
+ * def indel_opcodes(s1, s2, *, processor=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ */
+  __Pyx_TraceLine(479,0,__PYX_ERR(0, 479, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_tp_new(((PyObject *)__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops), __pyx_empty_tuple); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 479, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults4, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 386, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 386, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 386, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(Py_None);
-  __Pyx_GIVEREF(Py_None);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  if (!(likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops)))) __PYX_ERR(0, 479, __pyx_L1_error)
+  __pyx_v_ops = ((struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops *)__pyx_t_1);
+  __pyx_t_1 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":481
+ *     cdef Editops ops = Editops.__new__(Editops)
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     ops.editops = indel_editops_func(s1_proc.string, s2_proc.string)
+ *     return ops.as_opcodes()
+ */
+  __Pyx_TraceLine(481,0,__PYX_ERR(0, 481, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 481, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":482
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = indel_editops_func(s1_proc.string, s2_proc.string)             # <<<<<<<<<<<<<<
+ *     return ops.as_opcodes()
+ * 
+ */
+  __Pyx_TraceLine(482,0,__PYX_ERR(0, 482, __pyx_L1_error))
+  try {
+    __pyx_t_2 = indel_editops_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 482, __pyx_L1_error)
+  }
+  __pyx_v_ops->editops = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_2);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":483
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     ops.editops = indel_editops_func(s1_proc.string, s2_proc.string)
+ *     return ops.as_opcodes()             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(483,0,__PYX_ERR(0, 483, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_ops), __pyx_n_s_as_opcodes); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 483, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = NULL;
+  __pyx_t_5 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
+    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+    if (likely(__pyx_t_4)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+      __Pyx_INCREF(__pyx_t_4);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_3, function);
+      __pyx_t_5 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[1] = {__pyx_t_4, };
+    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 483, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  }
+  __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
-  __pyx_r = __pyx_t_2;
-  __pyx_t_2 = 0;
   goto __pyx_L0;
 
+  /* "rapidfuzz/distance/metrics_cpp.pyx":477
+ * 
+ * 
+ * def indel_opcodes(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.indel_opcodes", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_ops);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "rapidfuzz/distance/metrics_cpp.pyx":486
+ * 
+ * 
+ * cdef bool GetScorerFlagsIndelDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsIndelDistance", __pyx_f[0], 486, 1, __PYX_ERR(0, 486, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":487
+ * 
+ * cdef bool GetScorerFlagsIndelDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ */
+  __Pyx_TraceLine(487,1,__PYX_ERR(0, 487, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":488
+ * cdef bool GetScorerFlagsIndelDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ *     return True
+ */
+  __Pyx_TraceLine(488,1,__PYX_ERR(0, 488, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":489
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(489,1,__PYX_ERR(0, 489, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":490
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(490,1,__PYX_ERR(0, 490, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":486
+ * 
+ * 
+ * cdef bool GetScorerFlagsIndelDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsIndelDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":493
+ * 
+ * 
+ * cdef bool GetScorerFlagsIndelNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelNormalizedDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsIndelNormalizedDistance", __pyx_f[0], 493, 1, __PYX_ERR(0, 493, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":494
+ * 
+ * cdef bool GetScorerFlagsIndelNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1
+ */
+  __Pyx_TraceLine(494,1,__PYX_ERR(0, 494, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":495
+ * cdef bool GetScorerFlagsIndelNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 1
+ *     return True
+ */
+  __Pyx_TraceLine(495,1,__PYX_ERR(0, 495, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":496
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(496,1,__PYX_ERR(0, 496, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 1.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":497
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsIndelSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(497,1,__PYX_ERR(0, 497, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":493
+ * 
+ * 
+ * cdef bool GetScorerFlagsIndelNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsIndelNormalizedDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":499
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsIndelSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsIndelSimilarity", __pyx_f[0], 499, 1, __PYX_ERR(0, 499, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":500
+ * 
+ * cdef bool GetScorerFlagsIndelSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ */
+  __Pyx_TraceLine(500,1,__PYX_ERR(0, 500, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":501
+ * cdef bool GetScorerFlagsIndelSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(501,1,__PYX_ERR(0, 501, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":502
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(502,1,__PYX_ERR(0, 502, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":503
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(503,1,__PYX_ERR(0, 503, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":499
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsIndelSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsIndelSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":506
+ * 
+ * 
+ * cdef bool GetScorerFlagsIndelNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelNormalizedSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsIndelNormalizedSimilarity", __pyx_f[0], 506, 1, __PYX_ERR(0, 506, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":507
+ * 
+ * cdef bool GetScorerFlagsIndelNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ */
+  __Pyx_TraceLine(507,1,__PYX_ERR(0, 507, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":508
+ * cdef bool GetScorerFlagsIndelNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(508,1,__PYX_ERR(0, 508, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 1.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":509
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(509,1,__PYX_ERR(0, 509, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":510
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(510,1,__PYX_ERR(0, 510, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":506
+ * 
+ * 
+ * cdef bool GetScorerFlagsIndelNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsIndelNormalizedSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":526
+ * 
+ * 
+ * def hamming_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_15partial_token_set_ratio(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_45hamming_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_14partial_token_set_ratio, "\n    Compares the words in the strings based on unique and common words between them\n    using fuzz.partial_ratio\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    .. image:: img/partial_token_set_ratio.svg\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_15partial_token_set_ratio = {"partial_token_set_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_15partial_token_set_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_14partial_token_set_ratio};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_15partial_token_set_ratio(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_45hamming_distance = {"hamming_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_45hamming_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_45hamming_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -5060,24 +10645,23 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("partial_token_set_ratio (wrapper)", 0);
+  __Pyx_RefNannySetupContext("hamming_distance (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
-    __pyx_defaults4 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults4, __pyx_self);
-    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[2] = ((PyObject *)((PyObject *)Py_None));
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
@@ -5085,288 +10669,661 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 386, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 386, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("partial_token_set_ratio", 1, 2, 2, 1); __PYX_ERR(0, 386, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("hamming_distance", 1, 2, 2, 1); __PYX_ERR(0, 526, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 386, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "partial_token_set_ratio") < 0)) __PYX_ERR(0, 386, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "hamming_distance") < 0)) __PYX_ERR(0, 526, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("partial_token_set_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 386, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("hamming_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 526, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_set_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.hamming_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_14partial_token_set_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_44hamming_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_14partial_token_set_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_44hamming_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  int64_t __pyx_v_c_score_cutoff;
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
+  int64_t __pyx_t_1;
   int __pyx_t_2;
-  double __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
+  int __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__8)
-  __Pyx_RefNannySetupContext("partial_token_set_ratio", 0);
-  __Pyx_TraceCall("partial_token_set_ratio", __pyx_f[0], 386, 0, __PYX_ERR(0, 386, __pyx_L1_error));
-  __Pyx_INCREF(__pyx_v_processor);
+  __Pyx_TraceFrameInit(__pyx_codeobj__26)
+  __Pyx_RefNannySetupContext("hamming_distance", 0);
+  __Pyx_TraceCall("hamming_distance", __pyx_f[0], 526, 0, __PYX_ERR(0, 526, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":414
- *     .. image:: img/partial_token_set_ratio.svg
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":527
+ * 
+ * def hamming_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)             # <<<<<<<<<<<<<<
  *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
  */
-  __Pyx_TraceLine(414,0,__PYX_ERR(0, 414, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
-  } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 414, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
-  }
+  __Pyx_TraceLine(527,0,__PYX_ERR(0, 527, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, INT64_MAX); if (unlikely(__pyx_t_1 == ((int64_t)-1L))) __PYX_ERR(0, 527, __pyx_L1_error)
   __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":417
+  /* "rapidfuzz/distance/metrics_cpp.pyx":530
  *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
-  __Pyx_TraceLine(417,0,__PYX_ERR(0, 417, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
+  __Pyx_TraceLine(530,0,__PYX_ERR(0, 530, __pyx_L1_error))
+  __pyx_t_3 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_3) {
   } else {
-    __pyx_t_2 = __pyx_t_4;
+    __pyx_t_2 = __pyx_t_3;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
+  __pyx_t_3 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/fuzz_cpp.pyx":418
+    /* "rapidfuzz/distance/metrics_cpp.pyx":531
  * 
  *     if s1 is None or s2 is None:
  *         return 0             # <<<<<<<<<<<<<<
  * 
- *     if processor is True:
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
  */
-    __Pyx_TraceLine(418,0,__PYX_ERR(0, 418, __pyx_L1_error))
+    __Pyx_TraceLine(531,0,__PYX_ERR(0, 531, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_int_0);
     __pyx_r = __pyx_int_0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":417
+    /* "rapidfuzz/distance/metrics_cpp.pyx":530
  *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":420
+  /* "rapidfuzz/distance/metrics_cpp.pyx":533
  *         return 0
  * 
- *     if processor is True:             # <<<<<<<<<<<<<<
- *         processor = default_process
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(420,0,__PYX_ERR(0, 420, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_processor == Py_True);
-  if (__pyx_t_2) {
+  __Pyx_TraceLine(533,0,__PYX_ERR(0, 533, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 533, __pyx_L1_error)
 
-    /* "rapidfuzz/fuzz_cpp.pyx":421
+  /* "rapidfuzz/distance/metrics_cpp.pyx":534
  * 
- *     if processor is True:
- *         processor = default_process             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ * def hamming_similarity(s1, s2, *, processor=None, score_cutoff=None):
  */
-    __Pyx_TraceLine(421,0,__PYX_ERR(0, 421, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 421, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF_SET(__pyx_v_processor, __pyx_t_5);
-    __pyx_t_5 = 0;
+  __Pyx_TraceLine(534,0,__PYX_ERR(0, 534, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_1 = hamming_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 534, __pyx_L1_error)
+  }
+  __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 534, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
+  goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":420
- *         return 0
+  /* "rapidfuzz/distance/metrics_cpp.pyx":526
  * 
- *     if processor is True:             # <<<<<<<<<<<<<<
- *         processor = default_process
  * 
+ * def hamming_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.hamming_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":536
+ *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def hamming_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_47hamming_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_47hamming_similarity = {"hamming_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_47hamming_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_47hamming_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("hamming_similarity (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 536, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 536, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("hamming_similarity", 1, 2, 2, 1); __PYX_ERR(0, 536, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 536, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "hamming_similarity") < 0)) __PYX_ERR(0, 536, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
   }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("hamming_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 536, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.hamming_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_46hamming_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":423
- *         processor = default_process
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_46hamming_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  int64_t __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int64_t __pyx_t_1;
+  int __pyx_t_2;
+  int __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__27)
+  __Pyx_RefNannySetupContext("hamming_similarity", 0);
+  __Pyx_TraceCall("hamming_similarity", __pyx_f[0], 536, 0, __PYX_ERR(0, 536, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":537
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     return partial_token_set_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * def hamming_similarity(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
  */
-  __Pyx_TraceLine(423,0,__PYX_ERR(0, 423, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 423, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 423, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(537,0,__PYX_ERR(0, 537, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, 0); if (unlikely(__pyx_t_1 == ((int64_t)-1L))) __PYX_ERR(0, 537, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":424
+  /* "rapidfuzz/distance/metrics_cpp.pyx":540
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     return partial_token_set_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ */
+  __Pyx_TraceLine(540,0,__PYX_ERR(0, 540, __pyx_L1_error))
+  __pyx_t_3 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_3) {
+  } else {
+    __pyx_t_2 = __pyx_t_3;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_3 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_3;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":541
  * 
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
  * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
  */
-  __Pyx_TraceLine(424,0,__PYX_ERR(0, 424, __pyx_L1_error))
+    __Pyx_TraceLine(541,0,__PYX_ERR(0, 541, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":540
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":543
+ *         return 0
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(543,0,__PYX_ERR(0, 543, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":544
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * def hamming_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+ */
+  __Pyx_TraceLine(544,0,__PYX_ERR(0, 544, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = partial_token_set_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_1 = hamming_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 424, __pyx_L1_error)
+    __PYX_ERR(0, 544, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 424, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
+  __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 544, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":386
+  /* "rapidfuzz/distance/metrics_cpp.pyx":536
+ *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
- * 
- * def partial_token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Compares the words in the strings based on unique and common words between them
+ * def hamming_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_set_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.hamming_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_processor);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":427
- * 
+/* "rapidfuzz/distance/metrics_cpp.pyx":546
+ *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
- * def partial_token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Helper method that returns the maximum of fuzz.partial_token_set_ratio and
+ * def hamming_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_34__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_49hamming_normalized_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_49hamming_normalized_distance = {"hamming_normalized_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_49hamming_normalized_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_49hamming_normalized_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("hamming_normalized_distance (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 546, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 546, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("hamming_normalized_distance", 1, 2, 2, 1); __PYX_ERR(0, 546, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 546, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "hamming_normalized_distance") < 0)) __PYX_ERR(0, 546, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("hamming_normalized_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 546, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.hamming_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_48hamming_normalized_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_48hamming_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  double __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
+  int __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 427, 0, __PYX_ERR(0, 427, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__28)
+  __Pyx_RefNannySetupContext("hamming_normalized_distance", 0);
+  __Pyx_TraceCall("hamming_normalized_distance", __pyx_f[0], 546, 0, __PYX_ERR(0, 546, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":548
+ * def hamming_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  __Pyx_TraceLine(548,0,__PYX_ERR(0, 548, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
+  } else {
+    __pyx_t_1 = __pyx_t_2;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":549
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ */
+    __Pyx_TraceLine(549,0,__PYX_ERR(0, 549, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":548
+ * def hamming_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":551
+ *         return 0
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return hamming_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ */
+  __Pyx_TraceLine(551,0,__PYX_ERR(0, 551, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 1.0); if (unlikely(__pyx_t_3 == ((double)-1.0))) __PYX_ERR(0, 551, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_3;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":552
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return hamming_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(552,0,__PYX_ERR(0, 552, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 552, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":553
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return hamming_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(553,0,__PYX_ERR(0, 553, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 427, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 427, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 427, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 427, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(Py_None);
-  __Pyx_GIVEREF(Py_None);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
-  __pyx_t_1 = 0;
-  __pyx_r = __pyx_t_2;
-  __pyx_t_2 = 0;
+  try {
+    __pyx_t_3 = hamming_normalized_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 553, __pyx_L1_error)
+  }
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 553, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
   goto __pyx_L0;
 
+  /* "rapidfuzz/distance/metrics_cpp.pyx":546
+ *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def hamming_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.hamming_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "rapidfuzz/distance/metrics_cpp.pyx":556
+ * 
+ * 
+ * def hamming_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_17partial_token_ratio(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_51hamming_normalized_similarity(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_16partial_token_ratio, "\n    Helper method that returns the maximum of fuzz.partial_token_set_ratio and\n    fuzz.partial_token_sort_ratio (faster than manually executing the two functions)\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    .. image:: img/partial_token_ratio.svg\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_17partial_token_ratio = {"partial_token_ratio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_17partial_token_ratio, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_16partial_token_ratio};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_17partial_token_ratio(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_51hamming_normalized_similarity = {"hamming_normalized_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_51hamming_normalized_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_51hamming_normalized_similarity(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -5378,24 +11335,23 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("partial_token_ratio (wrapper)", 0);
+  __Pyx_RefNannySetupContext("hamming_normalized_similarity (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
-    __pyx_defaults5 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_self);
-    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[2] = ((PyObject *)((PyObject *)Py_None));
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
@@ -5403,253 +11359,533 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 427, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 556, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 427, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 556, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("partial_token_ratio", 1, 2, 2, 1); __PYX_ERR(0, 427, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("hamming_normalized_similarity", 1, 2, 2, 1); __PYX_ERR(0, 556, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 427, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 556, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "partial_token_ratio") < 0)) __PYX_ERR(0, 427, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "hamming_normalized_similarity") < 0)) __PYX_ERR(0, 556, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("partial_token_ratio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 427, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("hamming_normalized_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 556, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.hamming_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_16partial_token_ratio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_50hamming_normalized_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_16partial_token_ratio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_50hamming_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
+  double __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
+  int __pyx_t_1;
   int __pyx_t_2;
   double __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__9)
-  __Pyx_RefNannySetupContext("partial_token_ratio", 0);
-  __Pyx_TraceCall("partial_token_ratio", __pyx_f[0], 427, 0, __PYX_ERR(0, 427, __pyx_L1_error));
-
-  /* "rapidfuzz/fuzz_cpp.pyx":455
- *     .. image:: img/partial_token_ratio.svg
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
- *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
- */
-  __Pyx_TraceLine(455,0,__PYX_ERR(0, 455, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
-  } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 455, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
-  }
-  __pyx_v_c_score_cutoff = __pyx_t_1;
+  __Pyx_TraceFrameInit(__pyx_codeobj__29)
+  __Pyx_RefNannySetupContext("hamming_normalized_similarity", 0);
+  __Pyx_TraceCall("hamming_normalized_similarity", __pyx_f[0], 556, 0, __PYX_ERR(0, 556, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":458
+  /* "rapidfuzz/distance/metrics_cpp.pyx":558
+ * def hamming_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
-  __Pyx_TraceLine(458,0,__PYX_ERR(0, 458, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
+  __Pyx_TraceLine(558,0,__PYX_ERR(0, 558, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
   } else {
-    __pyx_t_2 = __pyx_t_4;
+    __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_2) {
+  if (__pyx_t_1) {
 
-    /* "rapidfuzz/fuzz_cpp.pyx":459
- * 
+    /* "rapidfuzz/distance/metrics_cpp.pyx":559
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  *     if s1 is None or s2 is None:
  *         return 0             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
  */
-    __Pyx_TraceLine(459,0,__PYX_ERR(0, 459, __pyx_L1_error))
+    __Pyx_TraceLine(559,0,__PYX_ERR(0, 559, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_int_0);
     __pyx_r = __pyx_int_0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":458
+    /* "rapidfuzz/distance/metrics_cpp.pyx":558
+ * def hamming_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":461
+  /* "rapidfuzz/distance/metrics_cpp.pyx":561
  *         return 0
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     return partial_token_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return hamming_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ */
+  __Pyx_TraceLine(561,0,__PYX_ERR(0, 561, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 0.0); if (unlikely(__pyx_t_3 == ((double)-1.0))) __PYX_ERR(0, 561, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_3;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":562
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return hamming_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(461,0,__PYX_ERR(0, 461, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 461, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 461, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(562,0,__PYX_ERR(0, 562, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 562, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":462
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     return partial_token_ratio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":563
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return hamming_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(462,0,__PYX_ERR(0, 462, __pyx_L1_error))
+  __Pyx_TraceLine(563,0,__PYX_ERR(0, 563, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = partial_token_ratio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_3 = hamming_normalized_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 462, __pyx_L1_error)
+    __PYX_ERR(0, 563, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 462, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 563, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":427
+  /* "rapidfuzz/distance/metrics_cpp.pyx":556
  * 
  * 
- * def partial_token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Helper method that returns the maximum of fuzz.partial_token_set_ratio and
+ * def hamming_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.partial_token_ratio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.hamming_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":465
+/* "rapidfuzz/distance/metrics_cpp.pyx":566
  * 
  * 
- * def WRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a weighted ratio based on the other ratio algorithms
+ * cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_36__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
-  PyObject *__pyx_r = NULL;
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
   __Pyx_TraceDeclarations
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 465, 0, __PYX_ERR(0, 465, __pyx_L1_error));
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 465, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults6, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 465, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 465, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 465, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(Py_None);
-  __Pyx_GIVEREF(Py_None);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
-  __pyx_t_1 = 0;
-  __pyx_r = __pyx_t_2;
-  __pyx_t_2 = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsHammingDistance", __pyx_f[0], 566, 1, __PYX_ERR(0, 566, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":567
+ * 
+ * cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ */
+  __Pyx_TraceLine(567,1,__PYX_ERR(0, 567, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":568
+ * cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ *     return True
+ */
+  __Pyx_TraceLine(568,1,__PYX_ERR(0, 568, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":569
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(569,1,__PYX_ERR(0, 569, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":570
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(570,1,__PYX_ERR(0, 570, __pyx_L1_error))
+  __pyx_r = 1;
   goto __pyx_L0;
 
+  /* "rapidfuzz/distance/metrics_cpp.pyx":566
+ * 
+ * 
+ * cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsHammingDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
   __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_TraceReturn(__pyx_r, 0);
-  __Pyx_RefNannyFinishContext();
+  __Pyx_TraceReturn(Py_None, 1);
   return __pyx_r;
 }
 
+/* "rapidfuzz/distance/metrics_cpp.pyx":572
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingNormalizedDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsHammingNormalizedDistance", __pyx_f[0], 572, 1, __PYX_ERR(0, 572, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":573
+ * 
+ * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1.0
+ */
+  __Pyx_TraceLine(573,1,__PYX_ERR(0, 573, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":574
+ * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 1.0
+ *     return True
+ */
+  __Pyx_TraceLine(574,1,__PYX_ERR(0, 574, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":575
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1.0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(575,1,__PYX_ERR(0, 575, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 1.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":576
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1.0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(576,1,__PYX_ERR(0, 576, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":572
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsHammingNormalizedDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":578
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsHammingSimilarity", __pyx_f[0], 578, 1, __PYX_ERR(0, 578, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":579
+ * 
+ * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ */
+  __Pyx_TraceLine(579,1,__PYX_ERR(0, 579, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":580
+ * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(580,1,__PYX_ERR(0, 580, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":581
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(581,1,__PYX_ERR(0, 581, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":582
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(582,1,__PYX_ERR(0, 582, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":578
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsHammingSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":584
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingNormalizedSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsHammingNormalizedSimilarity", __pyx_f[0], 584, 1, __PYX_ERR(0, 584, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":585
+ * 
+ * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ */
+  __Pyx_TraceLine(585,1,__PYX_ERR(0, 585, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":586
+ * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(586,1,__PYX_ERR(0, 586, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 1.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":587
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(587,1,__PYX_ERR(0, 587, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":588
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer HammingDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingDistance, HammingDistanceInit)
+ */
+  __Pyx_TraceLine(588,1,__PYX_ERR(0, 588, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":584
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsHammingNormalizedSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":602
+ * hamming_normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
+ * 
+ * def osa_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_19WRatio(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_53osa_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_18WRatio, "\n    Calculates a weighted ratio based on the other ratio algorithms\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Notes\n    -----\n    .. image:: img/WRatio.svg\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_19WRatio = {"WRatio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_19WRatio, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_18WRatio};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_19WRatio(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_53osa_distance = {"osa_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_53osa_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_53osa_distance(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -5661,24 +11897,23 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("WRatio (wrapper)", 0);
+  __Pyx_RefNannySetupContext("osa_distance (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
-    __pyx_defaults6 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults6, __pyx_self);
-    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[2] = ((PyObject *)((PyObject *)Py_None));
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
@@ -5686,288 +11921,661 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 465, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 602, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 465, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 602, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("WRatio", 1, 2, 2, 1); __PYX_ERR(0, 465, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("osa_distance", 1, 2, 2, 1); __PYX_ERR(0, 602, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 465, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 602, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "WRatio") < 0)) __PYX_ERR(0, 465, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "osa_distance") < 0)) __PYX_ERR(0, 602, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("WRatio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 465, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("osa_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 602, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.WRatio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.osa_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_18WRatio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_52osa_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_18WRatio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_52osa_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  int64_t __pyx_v_c_score_cutoff;
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
+  int64_t __pyx_t_1;
   int __pyx_t_2;
-  double __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
+  int __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__10)
-  __Pyx_RefNannySetupContext("WRatio", 0);
-  __Pyx_TraceCall("WRatio", __pyx_f[0], 465, 0, __PYX_ERR(0, 465, __pyx_L1_error));
-  __Pyx_INCREF(__pyx_v_processor);
+  __Pyx_TraceFrameInit(__pyx_codeobj__30)
+  __Pyx_RefNannySetupContext("osa_distance", 0);
+  __Pyx_TraceCall("osa_distance", __pyx_f[0], 602, 0, __PYX_ERR(0, 602, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":492
- *     .. image:: img/WRatio.svg
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":603
+ * 
+ * def osa_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)             # <<<<<<<<<<<<<<
  *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
  */
-  __Pyx_TraceLine(492,0,__PYX_ERR(0, 492, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
-  } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 492, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
-  }
+  __Pyx_TraceLine(603,0,__PYX_ERR(0, 603, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, INT64_MAX); if (unlikely(__pyx_t_1 == ((int64_t)-1L))) __PYX_ERR(0, 603, __pyx_L1_error)
   __pyx_v_c_score_cutoff = __pyx_t_1;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":495
+  /* "rapidfuzz/distance/metrics_cpp.pyx":606
  *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
-  __Pyx_TraceLine(495,0,__PYX_ERR(0, 495, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
+  __Pyx_TraceLine(606,0,__PYX_ERR(0, 606, __pyx_L1_error))
+  __pyx_t_3 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_3) {
   } else {
-    __pyx_t_2 = __pyx_t_4;
+    __pyx_t_2 = __pyx_t_3;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
+  __pyx_t_3 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/fuzz_cpp.pyx":496
+    /* "rapidfuzz/distance/metrics_cpp.pyx":607
  * 
  *     if s1 is None or s2 is None:
  *         return 0             # <<<<<<<<<<<<<<
  * 
- *     if processor is True:
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
  */
-    __Pyx_TraceLine(496,0,__PYX_ERR(0, 496, __pyx_L1_error))
+    __Pyx_TraceLine(607,0,__PYX_ERR(0, 607, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_int_0);
     __pyx_r = __pyx_int_0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":495
+    /* "rapidfuzz/distance/metrics_cpp.pyx":606
  *     cdef RF_StringWrapper s1_proc, s2_proc
  * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":498
+  /* "rapidfuzz/distance/metrics_cpp.pyx":609
  *         return 0
  * 
- *     if processor is True:             # <<<<<<<<<<<<<<
- *         processor = default_process
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return osa_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(498,0,__PYX_ERR(0, 498, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_processor == Py_True);
-  if (__pyx_t_2) {
+  __Pyx_TraceLine(609,0,__PYX_ERR(0, 609, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 609, __pyx_L1_error)
 
-    /* "rapidfuzz/fuzz_cpp.pyx":499
+  /* "rapidfuzz/distance/metrics_cpp.pyx":610
  * 
- *     if processor is True:
- *         processor = default_process             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return osa_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
+ * def osa_similarity(s1, s2, *, processor=None, score_cutoff=None):
  */
-    __Pyx_TraceLine(499,0,__PYX_ERR(0, 499, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 499, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF_SET(__pyx_v_processor, __pyx_t_5);
-    __pyx_t_5 = 0;
+  __Pyx_TraceLine(610,0,__PYX_ERR(0, 610, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  try {
+    __pyx_t_1 = osa_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 610, __pyx_L1_error)
+  }
+  __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 610, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":602
+ * hamming_normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
+ * 
+ * def osa_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.osa_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/distance/metrics_cpp.pyx":612
+ *     return osa_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def osa_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_55osa_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_55osa_similarity = {"osa_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_55osa_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_55osa_similarity(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("osa_similarity (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 612, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 612, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("osa_similarity", 1, 2, 2, 1); __PYX_ERR(0, 612, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 612, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "osa_similarity") < 0)) __PYX_ERR(0, 612, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("osa_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 612, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.osa_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_54osa_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_54osa_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  int64_t __pyx_v_c_score_cutoff;
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int64_t __pyx_t_1;
+  int __pyx_t_2;
+  int __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__31)
+  __Pyx_RefNannySetupContext("osa_similarity", 0);
+  __Pyx_TraceCall("osa_similarity", __pyx_f[0], 612, 0, __PYX_ERR(0, 612, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":613
+ * 
+ * def osa_similarity(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ */
+  __Pyx_TraceLine(613,0,__PYX_ERR(0, 613, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_i64(__pyx_v_score_cutoff, 0); if (unlikely(__pyx_t_1 == ((int64_t)-1L))) __PYX_ERR(0, 613, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_1;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":498
+  /* "rapidfuzz/distance/metrics_cpp.pyx":616
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
- *     if processor is True:             # <<<<<<<<<<<<<<
- *         processor = default_process
+ */
+  __Pyx_TraceLine(616,0,__PYX_ERR(0, 616, __pyx_L1_error))
+  __pyx_t_3 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_3) {
+  } else {
+    __pyx_t_2 = __pyx_t_3;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_3 = (__pyx_v_s2 == Py_None);
+  __pyx_t_2 = __pyx_t_3;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_2) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":617
+ * 
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
+ * 
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ */
+    __Pyx_TraceLine(617,0,__PYX_ERR(0, 617, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":616
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ * 
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":501
- *         processor = default_process
+  /* "rapidfuzz/distance/metrics_cpp.pyx":619
+ *         return 0
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return osa_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(501,0,__PYX_ERR(0, 501, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 501, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 501, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(619,0,__PYX_ERR(0, 619, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 619, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":502
+  /* "rapidfuzz/distance/metrics_cpp.pyx":620
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return osa_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
- * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):
+ * def osa_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
  */
-  __Pyx_TraceLine(502,0,__PYX_ERR(0, 502, __pyx_L1_error))
+  __Pyx_TraceLine(620,0,__PYX_ERR(0, 620, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = WRatio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_1 = osa_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 502, __pyx_L1_error)
+    __PYX_ERR(0, 620, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 502, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
+  __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 620, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":465
- * 
+  /* "rapidfuzz/distance/metrics_cpp.pyx":612
+ *     return osa_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
- * def WRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a weighted ratio based on the other ratio algorithms
+ * def osa_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.WRatio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.osa_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_processor);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":504
- *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+/* "rapidfuzz/distance/metrics_cpp.pyx":622
+ *     return osa_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
- * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a quick ratio between two strings using fuzz.ratio.
+ * def osa_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_38__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_57osa_normalized_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_57osa_normalized_distance = {"osa_normalized_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_57osa_normalized_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_57osa_normalized_distance(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_s1 = 0;
+  PyObject *__pyx_v_s2 = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("osa_normalized_distance (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
+    #endif
+    PyObject* values[4] = {0,0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 622, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 622, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("osa_normalized_distance", 1, 2, 2, 1); __PYX_ERR(0, 622, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && likely(kw_args <= 2)) {
+        Py_ssize_t index;
+        for (index = 2; index < 4 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 622, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "osa_normalized_distance") < 0)) __PYX_ERR(0, 622, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_s1 = values[0];
+    __pyx_v_s2 = values[1];
+    __pyx_v_processor = values[2];
+    __pyx_v_score_cutoff = values[3];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("osa_normalized_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 622, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.osa_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_56osa_normalized_distance(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_56osa_normalized_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
+  RF_StringWrapper __pyx_v_s1_proc;
+  RF_StringWrapper __pyx_v_s2_proc;
+  double __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
+  int __pyx_t_1;
+  int __pyx_t_2;
+  double __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 504, 0, __PYX_ERR(0, 504, __pyx_L1_error));
+  __Pyx_TraceFrameInit(__pyx_codeobj__32)
+  __Pyx_RefNannySetupContext("osa_normalized_distance", 0);
+  __Pyx_TraceCall("osa_normalized_distance", __pyx_f[0], 622, 0, __PYX_ERR(0, 622, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":624
+ * def osa_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  __Pyx_TraceLine(624,0,__PYX_ERR(0, 624, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
+  } else {
+    __pyx_t_1 = __pyx_t_2;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":625
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ *         return 0             # <<<<<<<<<<<<<<
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ */
+    __Pyx_TraceLine(625,0,__PYX_ERR(0, 625, __pyx_L1_error))
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_int_0);
+    __pyx_r = __pyx_int_0;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/distance/metrics_cpp.pyx":624
+ * def osa_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
+ *         return 0
+ * 
+ */
+  }
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":627
+ *         return 0
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return osa_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ */
+  __Pyx_TraceLine(627,0,__PYX_ERR(0, 627, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 1.0); if (unlikely(__pyx_t_3 == ((double)-1.0))) __PYX_ERR(0, 627, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_3;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":628
+ * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return osa_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ */
+  __Pyx_TraceLine(628,0,__PYX_ERR(0, 628, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 628, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":629
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 1.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return osa_normalized_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(629,0,__PYX_ERR(0, 629, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 504, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults7, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 504, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 504, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 504, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(Py_None);
-  __Pyx_GIVEREF(Py_None);
-  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
-  __pyx_t_1 = 0;
-  __pyx_r = __pyx_t_2;
-  __pyx_t_2 = 0;
+  try {
+    __pyx_t_3 = osa_normalized_distance_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 629, __pyx_L1_error)
+  }
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 629, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
   goto __pyx_L0;
 
+  /* "rapidfuzz/distance/metrics_cpp.pyx":622
+ *     return osa_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def osa_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.osa_normalized_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "rapidfuzz/distance/metrics_cpp.pyx":632
+ * 
+ * 
+ * def osa_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_21QRatio(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_59osa_normalized_similarity(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_8fuzz_cpp_20QRatio, "\n    Calculates a quick ratio between two strings using fuzz.ratio.\n    The only difference to fuzz.ratio is, that this preprocesses\n    the strings by default.\n\n    Parameters\n    ----------\n    s1 : Sequence[Hashable]\n        First string to compare.\n    s2 : Sequence[Hashable]\n        Second string to compare.\n    processor: callable, optional\n        Optional callable that is used to preprocess the strings before\n        comparing them. Default is ``utils.default_process``.\n    score_cutoff : float, optional\n        Optional argument for a score threshold as a float between 0 and 100.\n        For ratio < score_cutoff 0 is returned instead. Default is 0,\n        which deactivates this behaviour.\n\n    Returns\n    -------\n    similarity : float\n        similarity between s1 and s2 as a float between 0 and 100\n\n    Examples\n    --------\n    >>> fuzz.QRatio(\"this is a test\", \"THIS is a test!\")\n    100.0\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_21QRatio = {"QRatio", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_21QRatio, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_8fuzz_cpp_20QRatio};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_21QRatio(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_59osa_normalized_similarity = {"osa_normalized_similarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_59osa_normalized_similarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_8distance_11metrics_cpp_59osa_normalized_similarity(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_s1 = 0;
@@ -5979,24 +12587,23 @@
   #endif
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("QRatio (wrapper)", 0);
+  __Pyx_RefNannySetupContext("osa_normalized_similarity (wrapper)", 0);
   {
     #if CYTHON_USE_MODULE_STATE
     PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #else
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s1,&__pyx_n_s_s2,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,0};
     #endif
     PyObject* values[4] = {0,0,0,0};
-    __pyx_defaults7 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults7, __pyx_self);
-    values[2] = __pyx_dynamic_args->__pyx_arg_processor;
+    values[2] = ((PyObject *)((PyObject *)Py_None));
     values[3] = ((PyObject *)((PyObject *)Py_None));
     if (__pyx_kwds) {
       Py_ssize_t kw_args;
       switch (__pyx_nargs) {
         case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
@@ -6004,484 +12611,512 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s1)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 632, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s2)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 632, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("QRatio", 1, 2, 2, 1); __PYX_ERR(0, 504, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("osa_normalized_similarity", 1, 2, 2, 1); __PYX_ERR(0, 632, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && likely(kw_args <= 2)) {
         Py_ssize_t index;
         for (index = 2; index < 4 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 632, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "QRatio") < 0)) __PYX_ERR(0, 504, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "osa_normalized_similarity") < 0)) __PYX_ERR(0, 632, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_s1 = values[0];
     __pyx_v_s2 = values[1];
     __pyx_v_processor = values[2];
     __pyx_v_score_cutoff = values[3];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("QRatio", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 504, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("osa_normalized_similarity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 632, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.QRatio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.osa_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_20QRatio(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
+  __pyx_r = __pyx_pf_9rapidfuzz_8distance_11metrics_cpp_58osa_normalized_similarity(__pyx_self, __pyx_v_s1, __pyx_v_s2, __pyx_v_processor, __pyx_v_score_cutoff);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_20QRatio(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
-  double __pyx_v_c_score_cutoff;
+static PyObject *__pyx_pf_9rapidfuzz_8distance_11metrics_cpp_58osa_normalized_similarity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s1, PyObject *__pyx_v_s2, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff) {
   RF_StringWrapper __pyx_v_s1_proc;
   RF_StringWrapper __pyx_v_s2_proc;
+  double __pyx_v_c_score_cutoff;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
-  double __pyx_t_1;
+  int __pyx_t_1;
   int __pyx_t_2;
   double __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__11)
-  __Pyx_RefNannySetupContext("QRatio", 0);
-  __Pyx_TraceCall("QRatio", __pyx_f[0], 504, 0, __PYX_ERR(0, 504, __pyx_L1_error));
-  __Pyx_INCREF(__pyx_v_processor);
+  __Pyx_TraceFrameInit(__pyx_codeobj__33)
+  __Pyx_RefNannySetupContext("osa_normalized_similarity", 0);
+  __Pyx_TraceCall("osa_normalized_similarity", __pyx_f[0], 632, 0, __PYX_ERR(0, 632, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":534
- *     100.0
- *     """
- *     cdef double c_score_cutoff = 0.0 if score_cutoff is None else score_cutoff             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":634
+ * def osa_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
- */
-  __Pyx_TraceLine(534,0,__PYX_ERR(0, 534, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_score_cutoff == Py_None);
-  if (__pyx_t_2) {
-    __pyx_t_1 = 0.0;
-  } else {
-    __pyx_t_3 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_3 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 534, __pyx_L1_error)
-    __pyx_t_1 = __pyx_t_3;
-  }
-  __pyx_v_c_score_cutoff = __pyx_t_1;
-
-  /* "rapidfuzz/fuzz_cpp.pyx":537
- *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
-  __Pyx_TraceLine(537,0,__PYX_ERR(0, 537, __pyx_L1_error))
-  __pyx_t_4 = (__pyx_v_s1 == Py_None);
-  if (!__pyx_t_4) {
+  __Pyx_TraceLine(634,0,__PYX_ERR(0, 634, __pyx_L1_error))
+  __pyx_t_2 = (__pyx_v_s1 == Py_None);
+  if (!__pyx_t_2) {
   } else {
-    __pyx_t_2 = __pyx_t_4;
+    __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_4 = (__pyx_v_s2 == Py_None);
-  __pyx_t_2 = __pyx_t_4;
+  __pyx_t_2 = (__pyx_v_s2 == Py_None);
+  __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
-  if (__pyx_t_2) {
+  if (__pyx_t_1) {
 
-    /* "rapidfuzz/fuzz_cpp.pyx":538
- * 
+    /* "rapidfuzz/distance/metrics_cpp.pyx":635
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  *     if s1 is None or s2 is None:
  *         return 0             # <<<<<<<<<<<<<<
  * 
- *     if processor is True:
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
  */
-    __Pyx_TraceLine(538,0,__PYX_ERR(0, 538, __pyx_L1_error))
+    __Pyx_TraceLine(635,0,__PYX_ERR(0, 635, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_int_0);
     __pyx_r = __pyx_int_0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/fuzz_cpp.pyx":537
+    /* "rapidfuzz/distance/metrics_cpp.pyx":634
+ * def osa_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):
  *     cdef RF_StringWrapper s1_proc, s2_proc
- * 
  *     if s1 is None or s2 is None:             # <<<<<<<<<<<<<<
  *         return 0
  * 
  */
   }
 
-  /* "rapidfuzz/fuzz_cpp.pyx":540
- *         return 0
- * 
- *     if processor is True:             # <<<<<<<<<<<<<<
- *         processor = default_process
- * 
- */
-  __Pyx_TraceLine(540,0,__PYX_ERR(0, 540, __pyx_L1_error))
-  __pyx_t_2 = (__pyx_v_processor == Py_True);
-  if (__pyx_t_2) {
-
-    /* "rapidfuzz/fuzz_cpp.pyx":541
- * 
- *     if processor is True:
- *         processor = default_process             # <<<<<<<<<<<<<<
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- */
-    __Pyx_TraceLine(541,0,__PYX_ERR(0, 541, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 541, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF_SET(__pyx_v_processor, __pyx_t_5);
-    __pyx_t_5 = 0;
-
-    /* "rapidfuzz/fuzz_cpp.pyx":540
+  /* "rapidfuzz/distance/metrics_cpp.pyx":637
  *         return 0
  * 
- *     if processor is True:             # <<<<<<<<<<<<<<
- *         processor = default_process
- * 
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)             # <<<<<<<<<<<<<<
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return osa_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  */
-  }
+  __Pyx_TraceLine(637,0,__PYX_ERR(0, 637, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_8distance_11metrics_cpp_get_score_cutoff_f64(__pyx_v_score_cutoff, 0.0); if (unlikely(__pyx_t_3 == ((double)-1.0))) __PYX_ERR(0, 637, __pyx_L1_error)
+  __pyx_v_c_score_cutoff = __pyx_t_3;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":543
- *         processor = default_process
+  /* "rapidfuzz/distance/metrics_cpp.pyx":638
  * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)             # <<<<<<<<<<<<<<
- *     return QRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)             # <<<<<<<<<<<<<<
+ *     return osa_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
  */
-  __Pyx_TraceLine(543,0,__PYX_ERR(0, 543, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_default_process); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 543, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), __pyx_t_5); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_TraceLine(638,0,__PYX_ERR(0, 638, __pyx_L1_error))
+  __pyx_f_10cpp_common_preprocess_strings(__pyx_v_s1, __pyx_v_s2, __pyx_v_processor, (&__pyx_v_s1_proc), (&__pyx_v_s2_proc), Py_None); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 638, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":544
- * 
- *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, default_process)
- *     return QRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":639
+ *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, 0.0)
+ *     preprocess_strings(s1, s2, processor, &s1_proc, &s2_proc, None)
+ *     return osa_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(544,0,__PYX_ERR(0, 544, __pyx_L1_error))
+  __Pyx_TraceLine(639,0,__PYX_ERR(0, 639, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   try {
-    __pyx_t_1 = QRatio_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
+    __pyx_t_3 = osa_normalized_similarity_func(__pyx_v_s1_proc.string, __pyx_v_s2_proc.string, __pyx_v_c_score_cutoff);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 544, __pyx_L1_error)
+    __PYX_ERR(0, 639, __pyx_L1_error)
   }
-  __pyx_t_5 = PyFloat_FromDouble(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 544, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_r = __pyx_t_5;
-  __pyx_t_5 = 0;
+  __pyx_t_4 = PyFloat_FromDouble(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 639, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":504
- *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":632
+ * 
  * 
- * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a quick ratio between two strings using fuzz.ratio.
+ * def osa_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.QRatio", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.osa_normalized_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_processor);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":547
+/* "rapidfuzz/distance/metrics_cpp.pyx":642
  * 
  * 
- * cdef bool GetScorerFlagsFuzzSymmetric(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 100
+ * cdef bool GetScorerFlagsOSADistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
  */
 
-static bool __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSADistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
   bool __pyx_r;
   __Pyx_TraceDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   #ifdef WITH_THREAD
   PyGILState_STATE __pyx_gilstate_save;
   #endif
-  __Pyx_TraceCall("GetScorerFlagsFuzzSymmetric", __pyx_f[0], 547, 1, __PYX_ERR(0, 547, __pyx_L1_error));
+  __Pyx_TraceCall("GetScorerFlagsOSADistance", __pyx_f[0], 642, 1, __PYX_ERR(0, 642, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":548
+  /* "rapidfuzz/distance/metrics_cpp.pyx":643
  * 
- * cdef bool GetScorerFlagsFuzzSymmetric(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).optimal_score.f64 = 100
- *     dereference(scorer_flags).worst_score.f64 = 0
- */
-  __Pyx_TraceLine(548,1,__PYX_ERR(0, 548, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
-
-  /* "rapidfuzz/fuzz_cpp.pyx":549
- * cdef bool GetScorerFlagsFuzzSymmetric(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 100             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).worst_score.f64 = 0
+ * cdef bool GetScorerFlagsOSADistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
+ */
+  __Pyx_TraceLine(643,1,__PYX_ERR(0, 643, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":644
+ * cdef bool GetScorerFlagsOSADistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
  *     return True
  */
-  __Pyx_TraceLine(549,1,__PYX_ERR(0, 549, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).optimal_score.f64 = 100.0;
+  __Pyx_TraceLine(644,1,__PYX_ERR(0, 644, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":550
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 100
- *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":645
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
  *     return True
  * 
  */
-  __Pyx_TraceLine(550,1,__PYX_ERR(0, 550, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+  __Pyx_TraceLine(645,1,__PYX_ERR(0, 645, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = INT64_MAX;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":551
- *     dereference(scorer_flags).optimal_score.f64 = 100
- *     dereference(scorer_flags).worst_score.f64 = 0
+  /* "rapidfuzz/distance/metrics_cpp.pyx":646
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ *     dereference(scorer_flags).worst_score.i64 = INT64_MAX
  *     return True             # <<<<<<<<<<<<<<
  * 
- * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ * cdef bool GetScorerFlagsOSANormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
  */
-  __Pyx_TraceLine(551,1,__PYX_ERR(0, 551, __pyx_L1_error))
+  __Pyx_TraceLine(646,1,__PYX_ERR(0, 646, __pyx_L1_error))
   __pyx_r = 1;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":547
+  /* "rapidfuzz/distance/metrics_cpp.pyx":642
  * 
  * 
- * cdef bool GetScorerFlagsFuzzSymmetric(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 100
+ * cdef bool GetScorerFlagsOSADistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
  */
 
   /* function exit code */
   __pyx_L1_error:;
   #ifdef WITH_THREAD
   __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
   #endif
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.GetScorerFlagsFuzzSymmetric", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsOSADistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   #ifdef WITH_THREAD
   __Pyx_PyGILState_Release(__pyx_gilstate_save);
   #endif
   __pyx_L0:;
   __Pyx_TraceReturn(Py_None, 1);
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":553
+/* "rapidfuzz/distance/metrics_cpp.pyx":648
  *     return True
  * 
- * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
- *     dereference(scorer_flags).optimal_score.f64 = 100
+ * cdef bool GetScorerFlagsOSANormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
  */
 
-static bool __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSANormalizedDistance(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
   bool __pyx_r;
   __Pyx_TraceDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   #ifdef WITH_THREAD
   PyGILState_STATE __pyx_gilstate_save;
   #endif
-  __Pyx_TraceCall("GetScorerFlagsFuzz", __pyx_f[0], 553, 1, __PYX_ERR(0, 553, __pyx_L1_error));
+  __Pyx_TraceCall("GetScorerFlagsOSANormalizedDistance", __pyx_f[0], 648, 1, __PYX_ERR(0, 648, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":554
+  /* "rapidfuzz/distance/metrics_cpp.pyx":649
  * 
- * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).optimal_score.f64 = 100
- *     dereference(scorer_flags).worst_score.f64 = 0
+ * cdef bool GetScorerFlagsOSANormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1.0
  */
-  __Pyx_TraceLine(554,1,__PYX_ERR(0, 554, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64;
+  __Pyx_TraceLine(649,1,__PYX_ERR(0, 649, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":555
- * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
- *     dereference(scorer_flags).optimal_score.f64 = 100             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).worst_score.f64 = 0
+  /* "rapidfuzz/distance/metrics_cpp.pyx":650
+ * cdef bool GetScorerFlagsOSANormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 1.0
  *     return True
  */
-  __Pyx_TraceLine(555,1,__PYX_ERR(0, 555, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).optimal_score.f64 = 100.0;
+  __Pyx_TraceLine(650,1,__PYX_ERR(0, 650, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 0.0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":556
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
- *     dereference(scorer_flags).optimal_score.f64 = 100
- *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
+  /* "rapidfuzz/distance/metrics_cpp.pyx":651
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1.0             # <<<<<<<<<<<<<<
  *     return True
  * 
  */
-  __Pyx_TraceLine(556,1,__PYX_ERR(0, 556, __pyx_L1_error))
-  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+  __Pyx_TraceLine(651,1,__PYX_ERR(0, 651, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 1.0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":557
- *     dereference(scorer_flags).optimal_score.f64 = 100
- *     dereference(scorer_flags).worst_score.f64 = 0
+  /* "rapidfuzz/distance/metrics_cpp.pyx":652
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ *     dereference(scorer_flags).worst_score.f64 = 1.0
  *     return True             # <<<<<<<<<<<<<<
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):
+ * cdef bool GetScorerFlagsOSASimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
  */
-  __Pyx_TraceLine(557,1,__PYX_ERR(0, 557, __pyx_L1_error))
+  __Pyx_TraceLine(652,1,__PYX_ERR(0, 652, __pyx_L1_error))
   __pyx_r = 1;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":553
+  /* "rapidfuzz/distance/metrics_cpp.pyx":648
  *     return True
  * 
- * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
- *     dereference(scorer_flags).optimal_score.f64 = 100
+ * cdef bool GetScorerFlagsOSANormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
  */
 
   /* function exit code */
   __pyx_L1_error:;
   #ifdef WITH_THREAD
   __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
   #endif
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp.GetScorerFlagsFuzz", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsOSANormalizedDistance", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   #ifdef WITH_THREAD
   __Pyx_PyGILState_Release(__pyx_gilstate_save);
   #endif
   __pyx_L0:;
   __Pyx_TraceReturn(Py_None, 1);
   return __pyx_r;
 }
 
-/* "rapidfuzz/fuzz_cpp.pyx":559
+/* "rapidfuzz/distance/metrics_cpp.pyx":654
  *     return True
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
- * 
+ * cdef bool GetScorerFlagsOSASimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
  */
 
-/* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_23_GetScorerFlagsSimilarity(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_8fuzz_cpp_23_GetScorerFlagsSimilarity = {"_GetScorerFlagsSimilarity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_8fuzz_cpp_23_GetScorerFlagsSimilarity, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_8fuzz_cpp_23_GetScorerFlagsSimilarity(PyObject *__pyx_self, 
-#if CYTHON_METH_FASTCALL
-PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
-#else
-PyObject *__pyx_args, PyObject *__pyx_kwds
-#endif
-) {
-  CYTHON_UNUSED PyObject *__pyx_v_kwargs = 0;
-  #if !CYTHON_METH_FASTCALL
-  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSASimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
+  __Pyx_TraceDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
   #endif
-  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("_GetScorerFlagsSimilarity (wrapper)", 0);
-  if (unlikely(__pyx_nargs > 0)) {
-    __Pyx_RaiseArgtupleInvalid("_GetScorerFlagsSimilarity", 1, 0, 0, __pyx_nargs); return NULL;}
-  if (unlikely(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "_GetScorerFlagsSimilarity", 1))) return NULL;
-  __pyx_r = __pyx_pf_9rapidfuzz_8fuzz_cpp_22_GetScorerFlagsSimilarity(__pyx_self, __pyx_v_kwargs);
+  __Pyx_TraceCall("GetScorerFlagsOSASimilarity", __pyx_f[0], 654, 1, __PYX_ERR(0, 654, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":655
+ * 
+ * cdef bool GetScorerFlagsOSASimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ */
+  __Pyx_TraceLine(655,1,__PYX_ERR(0, 655, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":656
+ * cdef bool GetScorerFlagsOSASimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(656,1,__PYX_ERR(0, 656, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.i64 = INT64_MAX;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":657
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __Pyx_TraceLine(657,1,__PYX_ERR(0, 657, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.i64 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":658
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ *     dereference(scorer_flags).worst_score.i64 = 0
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * cdef bool GetScorerFlagsOSANormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ */
+  __Pyx_TraceLine(658,1,__PYX_ERR(0, 658, __pyx_L1_error))
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":654
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsOSASimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
 
   /* function exit code */
-  __Pyx_XDECREF(__pyx_v_kwargs);
-  __Pyx_RefNannyFinishContext();
+  __pyx_L1_error:;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsOSASimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 1);
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_8fuzz_cpp_22_GetScorerFlagsSimilarity(CYTHON_UNUSED PyObject *__pyx_self, CYTHON_UNUSED PyObject *__pyx_v_kwargs) {
-  PyObject *__pyx_r = NULL;
+/* "rapidfuzz/distance/metrics_cpp.pyx":660
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsOSANormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+
+static bool __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSANormalizedSimilarity(CYTHON_UNUSED RF_Kwargs const *__pyx_v_self, RF_ScorerFlags *__pyx_v_scorer_flags) {
+  bool __pyx_r;
   __Pyx_TraceDeclarations
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_TraceFrameInit(__pyx_codeobj__12)
-  __Pyx_RefNannySetupContext("_GetScorerFlagsSimilarity", 0);
-  __Pyx_TraceCall("_GetScorerFlagsSimilarity", __pyx_f[0], 559, 0, __PYX_ERR(0, 559, __pyx_L1_error));
+  #ifdef WITH_THREAD
+  PyGILState_STATE __pyx_gilstate_save;
+  #endif
+  __Pyx_TraceCall("GetScorerFlagsOSANormalizedSimilarity", __pyx_f[0], 660, 1, __PYX_ERR(0, 660, __pyx_L1_error));
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":661
+ * 
+ * cdef bool GetScorerFlagsOSANormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ */
+  __Pyx_TraceLine(661,1,__PYX_ERR(0, 661, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).flags = (RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":662
+ * cdef bool GetScorerFlagsOSANormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True
+ */
+  __Pyx_TraceLine(662,1,__PYX_ERR(0, 662, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).optimal_score.f64 = 1.0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":560
+  /* "rapidfuzz/distance/metrics_cpp.pyx":663
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0             # <<<<<<<<<<<<<<
+ *     return True
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):
- *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}             # <<<<<<<<<<<<<<
+ */
+  __Pyx_TraceLine(663,1,__PYX_ERR(0, 663, __pyx_L1_error))
+  (*__pyx_v_scorer_flags).worst_score.f64 = 0.0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":664
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ *     dereference(scorer_flags).worst_score.f64 = 0
+ *     return True             # <<<<<<<<<<<<<<
  * 
- * cdef dict FuzzContextPy = CreateScorerContextPy(_GetScorerFlagsSimilarity)
+ * cdef RF_Scorer OSADistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSADistance, OSADistanceInit)
  */
-  __Pyx_TraceLine(560,0,__PYX_ERR(0, 560, __pyx_L1_error))
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 560, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_optimal_score, __pyx_int_100) < 0) __PYX_ERR(0, 560, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_worst_score, __pyx_int_0) < 0) __PYX_ERR(0, 560, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_flags, __pyx_int_32) < 0) __PYX_ERR(0, 560, __pyx_L1_error)
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
+  __Pyx_TraceLine(664,1,__PYX_ERR(0, 664, __pyx_L1_error))
+  __pyx_r = 1;
   goto __pyx_L0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":559
+  /* "rapidfuzz/distance/metrics_cpp.pyx":660
  *     return True
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
- * 
+ * cdef bool GetScorerFlagsOSANormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.fuzz_cpp._GetScorerFlagsSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
+  #ifdef WITH_THREAD
+  __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+  #endif
+  __Pyx_AddTraceback("rapidfuzz.distance.metrics_cpp.GetScorerFlagsOSANormalizedSimilarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  #ifdef WITH_THREAD
+  __Pyx_PyGILState_Release(__pyx_gilstate_save);
+  #endif
   __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_TraceReturn(__pyx_r, 0);
-  __Pyx_RefNannyFinishContext();
+  __Pyx_TraceReturn(Py_None, 1);
   return __pyx_r;
 }
 
 /* "cpp_common.pxd":242
  *     void validate_string(object py_str, const char* err) except +
  * 
  * cdef inline RF_String hash_array(arr) except *:             # <<<<<<<<<<<<<<
@@ -7862,18 +14497,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__13);
+        __Pyx_INCREF(__pyx_kp_u__34);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__13);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__13);
+        __Pyx_GIVEREF(__pyx_kp_u__34);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__34);
         __pyx_t_8 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -7961,18 +14596,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__13);
+        __Pyx_INCREF(__pyx_kp_u__34);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__13);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__13);
+        __Pyx_GIVEREF(__pyx_kp_u__34);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__34);
         __pyx_t_8 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -8191,18 +14826,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__13);
+        __Pyx_INCREF(__pyx_kp_u__34);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__13);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__13);
+        __Pyx_GIVEREF(__pyx_kp_u__34);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__34);
         __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -8290,18 +14925,18 @@
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__13);
+        __Pyx_INCREF(__pyx_kp_u__34);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__13);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__13);
+        __Pyx_GIVEREF(__pyx_kp_u__34);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__34);
         __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
@@ -8745,15 +15380,15 @@
     __Pyx_TraceLine(390,0,__PYX_ERR(1, 390, __pyx_L1_error))
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "keys");
       __PYX_ERR(1, 390, __pyx_L1_error)
     }
     __pyx_t_3 = __Pyx_PyDict_Keys(__pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__14, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 390, __pyx_L1_error)
+    __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__35, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_kp_u_Got_unexpected_keyword_arguments);
     __Pyx_GIVEREF(__pyx_kp_u_Got_unexpected_keyword_arguments);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_Got_unexpected_keyword_arguments);
@@ -9051,363 +15686,594 @@
     #define CYTHON_SMALL_CODE
 #endif
 #endif
 /* #### Code section: pystring_table ### */
 
 static __Pyx_StringTabEntry __pyx_string_tab[] = {
   #if CYTHON_USE_MODULE_STATE
-  {0, __pyx_k_Calculates_a_quick_ratio_betwee, sizeof(__pyx_k_Calculates_a_quick_ratio_betwee), 0, 1, 0, 0},
-  {0, __pyx_k_Calculates_the_normalized_Indel, sizeof(__pyx_k_Calculates_the_normalized_Indel), 0, 1, 0, 0},
-  {0, __pyx_k_Compares_the_words_in_the_strin, sizeof(__pyx_k_Compares_the_words_in_the_strin), 0, 1, 0, 0},
-  {0, __pyx_k_GetScorerFlagsSimilarity, sizeof(__pyx_k_GetScorerFlagsSimilarity), 0, 0, 1, 1},
+  {0, __pyx_k_Editops, sizeof(__pyx_k_Editops), 0, 0, 1, 1},
   {0, __pyx_k_Got_unexpected_keyword_arguments, sizeof(__pyx_k_Got_unexpected_keyword_arguments), 0, 1, 0, 0},
   {0, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
-  {0, __pyx_k_QRatio, sizeof(__pyx_k_QRatio), 0, 0, 1, 1},
-  {0, __pyx_k_QRatio_line_504, sizeof(__pyx_k_QRatio_line_504), 0, 1, 0, 0},
   {0, __pyx_k_RF_Preprocess, sizeof(__pyx_k_RF_Preprocess), 0, 1, 0, 1},
   {0, __pyx_k_RF_Scorer, sizeof(__pyx_k_RF_Scorer), 0, 0, 1, 1},
   {0, __pyx_k_RF_ScorerPy, sizeof(__pyx_k_RF_ScorerPy), 0, 0, 1, 1},
-  {0, __pyx_k_ScoreAlignment, sizeof(__pyx_k_ScoreAlignment), 0, 0, 1, 1},
-  {0, __pyx_k_Searches_for_the_optimal_alignm, sizeof(__pyx_k_Searches_for_the_optimal_alignm), 0, 1, 0, 0},
-  {0, __pyx_k_Searches_for_the_optimal_alignm_2, sizeof(__pyx_k_Searches_for_the_optimal_alignm_2), 0, 1, 0, 0},
-  {0, __pyx_k_Sorts_the_words_in_the_strings, sizeof(__pyx_k_Sorts_the_words_in_the_strings), 0, 1, 0, 0},
   {0, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
-  {0, __pyx_k_WRatio, sizeof(__pyx_k_WRatio), 0, 0, 1, 1},
-  {0, __pyx_k__13, sizeof(__pyx_k__13), 0, 1, 0, 0},
-  {0, __pyx_k__14, sizeof(__pyx_k__14), 0, 1, 0, 0},
-  {0, __pyx_k__15, sizeof(__pyx_k__15), 0, 1, 0, 0},
-  {0, __pyx_k__19, sizeof(__pyx_k__19), 0, 0, 1, 1},
+  {0, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
+  {0, __pyx_k__34, sizeof(__pyx_k__34), 0, 1, 0, 0},
+  {0, __pyx_k__35, sizeof(__pyx_k__35), 0, 1, 0, 0},
+  {0, __pyx_k__36, sizeof(__pyx_k__36), 0, 1, 0, 0},
+  {0, __pyx_k__42, sizeof(__pyx_k__42), 0, 0, 1, 1},
   {0, __pyx_k_array, sizeof(__pyx_k_array), 0, 0, 1, 1},
+  {0, __pyx_k_as_opcodes, sizeof(__pyx_k_as_opcodes), 0, 0, 1, 1},
   {0, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
   {0, __pyx_k_c_score_cutoff, sizeof(__pyx_k_c_score_cutoff), 0, 0, 1, 1},
+  {0, __pyx_k_c_score_hint, sizeof(__pyx_k_c_score_hint), 0, 0, 1, 1},
   {0, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
-  {0, __pyx_k_default_process, sizeof(__pyx_k_default_process), 0, 0, 1, 1},
-  {0, __pyx_k_distance__initialize_cpp, sizeof(__pyx_k_distance__initialize_cpp), 0, 0, 1, 1},
-  {0, __pyx_k_flags, sizeof(__pyx_k_flags), 0, 1, 0, 1},
+  {0, __pyx_k_damerau_levenshtein_distance, sizeof(__pyx_k_damerau_levenshtein_distance), 0, 0, 1, 1},
+  {0, __pyx_k_damerau_levenshtein_normalized_d, sizeof(__pyx_k_damerau_levenshtein_normalized_d), 0, 0, 1, 1},
+  {0, __pyx_k_damerau_levenshtein_normalized_s, sizeof(__pyx_k_damerau_levenshtein_normalized_s), 0, 0, 1, 1},
+  {0, __pyx_k_damerau_levenshtein_similarity, sizeof(__pyx_k_damerau_levenshtein_similarity), 0, 0, 1, 1},
+  {0, __pyx_k_deletion, sizeof(__pyx_k_deletion), 0, 0, 1, 1},
+  {0, __pyx_k_get, sizeof(__pyx_k_get), 0, 0, 1, 1},
   {0, __pyx_k_get_scorer_flags, sizeof(__pyx_k_get_scorer_flags), 0, 1, 0, 1},
+  {0, __pyx_k_hamming_distance, sizeof(__pyx_k_hamming_distance), 0, 0, 1, 1},
+  {0, __pyx_k_hamming_normalized_distance, sizeof(__pyx_k_hamming_normalized_distance), 0, 0, 1, 1},
+  {0, __pyx_k_hamming_normalized_similarity, sizeof(__pyx_k_hamming_normalized_similarity), 0, 0, 1, 1},
+  {0, __pyx_k_hamming_similarity, sizeof(__pyx_k_hamming_similarity), 0, 0, 1, 1},
   {0, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
+  {0, __pyx_k_indel_distance, sizeof(__pyx_k_indel_distance), 0, 0, 1, 1},
+  {0, __pyx_k_indel_editops, sizeof(__pyx_k_indel_editops), 0, 0, 1, 1},
+  {0, __pyx_k_indel_normalized_distance, sizeof(__pyx_k_indel_normalized_distance), 0, 0, 1, 1},
+  {0, __pyx_k_indel_normalized_similarity, sizeof(__pyx_k_indel_normalized_similarity), 0, 0, 1, 1},
+  {0, __pyx_k_indel_opcodes, sizeof(__pyx_k_indel_opcodes), 0, 0, 1, 1},
+  {0, __pyx_k_indel_similarity, sizeof(__pyx_k_indel_similarity), 0, 0, 1, 1},
+  {0, __pyx_k_initialize_cpp, sizeof(__pyx_k_initialize_cpp), 0, 0, 1, 1},
+  {0, __pyx_k_insertion, sizeof(__pyx_k_insertion), 0, 0, 1, 1},
   {0, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
   {0, __pyx_k_keys, sizeof(__pyx_k_keys), 0, 0, 1, 1},
-  {0, __pyx_k_kwargs, sizeof(__pyx_k_kwargs), 0, 0, 1, 1},
+  {0, __pyx_k_lcs_seq_distance, sizeof(__pyx_k_lcs_seq_distance), 0, 0, 1, 1},
+  {0, __pyx_k_lcs_seq_editops, sizeof(__pyx_k_lcs_seq_editops), 0, 0, 1, 1},
+  {0, __pyx_k_lcs_seq_normalized_distance, sizeof(__pyx_k_lcs_seq_normalized_distance), 0, 0, 1, 1},
+  {0, __pyx_k_lcs_seq_normalized_similarity, sizeof(__pyx_k_lcs_seq_normalized_similarity), 0, 0, 1, 1},
+  {0, __pyx_k_lcs_seq_opcodes, sizeof(__pyx_k_lcs_seq_opcodes), 0, 0, 1, 1},
+  {0, __pyx_k_lcs_seq_similarity, sizeof(__pyx_k_lcs_seq_similarity), 0, 0, 1, 1},
+  {0, __pyx_k_levenshtein_distance, sizeof(__pyx_k_levenshtein_distance), 0, 0, 1, 1},
+  {0, __pyx_k_levenshtein_editops, sizeof(__pyx_k_levenshtein_editops), 0, 0, 1, 1},
+  {0, __pyx_k_levenshtein_normalized_distance, sizeof(__pyx_k_levenshtein_normalized_distance), 0, 0, 1, 1},
+  {0, __pyx_k_levenshtein_normalized_similarit, sizeof(__pyx_k_levenshtein_normalized_similarit), 0, 0, 1, 1},
+  {0, __pyx_k_levenshtein_opcodes, sizeof(__pyx_k_levenshtein_opcodes), 0, 0, 1, 1},
+  {0, __pyx_k_levenshtein_similarity, sizeof(__pyx_k_levenshtein_similarity), 0, 0, 1, 1},
   {0, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {0, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
-  {0, __pyx_k_optimal_score, sizeof(__pyx_k_optimal_score), 0, 1, 0, 1},
-  {0, __pyx_k_partial_ratio, sizeof(__pyx_k_partial_ratio), 0, 0, 1, 1},
-  {0, __pyx_k_partial_ratio_alignment, sizeof(__pyx_k_partial_ratio_alignment), 0, 0, 1, 1},
-  {0, __pyx_k_partial_ratio_alignment_line_171, sizeof(__pyx_k_partial_ratio_alignment_line_171), 0, 1, 0, 0},
-  {0, __pyx_k_partial_ratio_line_96, sizeof(__pyx_k_partial_ratio_line_96), 0, 1, 0, 0},
-  {0, __pyx_k_partial_token_ratio, sizeof(__pyx_k_partial_token_ratio), 0, 0, 1, 1},
-  {0, __pyx_k_partial_token_set_ratio, sizeof(__pyx_k_partial_token_set_ratio), 0, 0, 1, 1},
-  {0, __pyx_k_partial_token_sort_ratio, sizeof(__pyx_k_partial_token_sort_ratio), 0, 0, 1, 1},
+  {0, __pyx_k_ops, sizeof(__pyx_k_ops), 0, 0, 1, 1},
+  {0, __pyx_k_osa_distance, sizeof(__pyx_k_osa_distance), 0, 0, 1, 1},
+  {0, __pyx_k_osa_normalized_distance, sizeof(__pyx_k_osa_normalized_distance), 0, 0, 1, 1},
+  {0, __pyx_k_osa_normalized_similarity, sizeof(__pyx_k_osa_normalized_similarity), 0, 0, 1, 1},
+  {0, __pyx_k_osa_similarity, sizeof(__pyx_k_osa_similarity), 0, 0, 1, 1},
   {0, __pyx_k_processor, sizeof(__pyx_k_processor), 0, 0, 1, 1},
   {0, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
-  {0, __pyx_k_rapidfuzz_fuzz_cpp, sizeof(__pyx_k_rapidfuzz_fuzz_cpp), 0, 0, 1, 1},
-  {0, __pyx_k_rapidfuzz_utils, sizeof(__pyx_k_rapidfuzz_utils), 0, 0, 1, 1},
-  {0, __pyx_k_ratio, sizeof(__pyx_k_ratio), 0, 0, 1, 1},
-  {0, __pyx_k_ratio_line_50, sizeof(__pyx_k_ratio_line_50), 0, 1, 0, 0},
-  {0, __pyx_k_res, sizeof(__pyx_k_res), 0, 0, 1, 1},
+  {0, __pyx_k_rapidfuzz_distance_metrics_cpp, sizeof(__pyx_k_rapidfuzz_distance_metrics_cpp), 0, 0, 1, 1},
   {0, __pyx_k_s1, sizeof(__pyx_k_s1), 0, 0, 1, 1},
   {0, __pyx_k_s1_proc, sizeof(__pyx_k_s1_proc), 0, 0, 1, 1},
   {0, __pyx_k_s2, sizeof(__pyx_k_s2), 0, 0, 1, 1},
   {0, __pyx_k_s2_proc, sizeof(__pyx_k_s2_proc), 0, 0, 1, 1},
   {0, __pyx_k_score_cutoff, sizeof(__pyx_k_score_cutoff), 0, 0, 1, 1},
+  {0, __pyx_k_score_cutoff_has_to_be_0, sizeof(__pyx_k_score_cutoff_has_to_be_0), 0, 1, 0, 0},
   {0, __pyx_k_score_cutoff_has_to_be_in_the_ra, sizeof(__pyx_k_score_cutoff_has_to_be_in_the_ra), 0, 1, 0, 0},
-  {0, __pyx_k_src_rapidfuzz_fuzz_cpp_pyx, sizeof(__pyx_k_src_rapidfuzz_fuzz_cpp_pyx), 0, 0, 1, 0},
+  {0, __pyx_k_score_hint, sizeof(__pyx_k_score_hint), 0, 0, 1, 1},
+  {0, __pyx_k_score_hint_has_to_be_0, sizeof(__pyx_k_score_hint_has_to_be_0), 0, 1, 0, 0},
+  {0, __pyx_k_src_rapidfuzz_distance_metrics_c, sizeof(__pyx_k_src_rapidfuzz_distance_metrics_c), 0, 0, 1, 0},
+  {0, __pyx_k_substitution, sizeof(__pyx_k_substitution), 0, 0, 1, 1},
   {0, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
-  {0, __pyx_k_token_ratio, sizeof(__pyx_k_token_ratio), 0, 0, 1, 1},
-  {0, __pyx_k_token_set_ratio, sizeof(__pyx_k_token_set_ratio), 0, 0, 1, 1},
-  {0, __pyx_k_token_set_ratio_line_266, sizeof(__pyx_k_token_set_ratio_line_266), 0, 1, 0, 0},
-  {0, __pyx_k_token_sort_ratio, sizeof(__pyx_k_token_sort_ratio), 0, 0, 1, 1},
-  {0, __pyx_k_token_sort_ratio_line_224, sizeof(__pyx_k_token_sort_ratio_line_224), 0, 1, 0, 0},
   {0, __pyx_k_typecode, sizeof(__pyx_k_typecode), 0, 0, 1, 1},
-  {0, __pyx_k_worst_score, sizeof(__pyx_k_worst_score), 0, 1, 0, 1},
+  {0, __pyx_k_weights, sizeof(__pyx_k_weights), 0, 0, 1, 1},
+  {0, __pyx_k_weights, sizeof(__pyx_k_weights), 0, 1, 0, 1},
   #else
-  {&__pyx_kp_u_Calculates_a_quick_ratio_betwee, __pyx_k_Calculates_a_quick_ratio_betwee, sizeof(__pyx_k_Calculates_a_quick_ratio_betwee), 0, 1, 0, 0},
-  {&__pyx_kp_u_Calculates_the_normalized_Indel, __pyx_k_Calculates_the_normalized_Indel, sizeof(__pyx_k_Calculates_the_normalized_Indel), 0, 1, 0, 0},
-  {&__pyx_kp_u_Compares_the_words_in_the_strin, __pyx_k_Compares_the_words_in_the_strin, sizeof(__pyx_k_Compares_the_words_in_the_strin), 0, 1, 0, 0},
-  {&__pyx_n_s_GetScorerFlagsSimilarity, __pyx_k_GetScorerFlagsSimilarity, sizeof(__pyx_k_GetScorerFlagsSimilarity), 0, 0, 1, 1},
+  {&__pyx_n_s_Editops, __pyx_k_Editops, sizeof(__pyx_k_Editops), 0, 0, 1, 1},
   {&__pyx_kp_u_Got_unexpected_keyword_arguments, __pyx_k_Got_unexpected_keyword_arguments, sizeof(__pyx_k_Got_unexpected_keyword_arguments), 0, 1, 0, 0},
   {&__pyx_n_s_MemoryError, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
-  {&__pyx_n_s_QRatio, __pyx_k_QRatio, sizeof(__pyx_k_QRatio), 0, 0, 1, 1},
-  {&__pyx_kp_u_QRatio_line_504, __pyx_k_QRatio_line_504, sizeof(__pyx_k_QRatio_line_504), 0, 1, 0, 0},
   {&__pyx_n_u_RF_Preprocess, __pyx_k_RF_Preprocess, sizeof(__pyx_k_RF_Preprocess), 0, 1, 0, 1},
   {&__pyx_n_s_RF_Scorer, __pyx_k_RF_Scorer, sizeof(__pyx_k_RF_Scorer), 0, 0, 1, 1},
   {&__pyx_n_s_RF_ScorerPy, __pyx_k_RF_ScorerPy, sizeof(__pyx_k_RF_ScorerPy), 0, 0, 1, 1},
-  {&__pyx_n_s_ScoreAlignment, __pyx_k_ScoreAlignment, sizeof(__pyx_k_ScoreAlignment), 0, 0, 1, 1},
-  {&__pyx_kp_u_Searches_for_the_optimal_alignm, __pyx_k_Searches_for_the_optimal_alignm, sizeof(__pyx_k_Searches_for_the_optimal_alignm), 0, 1, 0, 0},
-  {&__pyx_kp_u_Searches_for_the_optimal_alignm_2, __pyx_k_Searches_for_the_optimal_alignm_2, sizeof(__pyx_k_Searches_for_the_optimal_alignm_2), 0, 1, 0, 0},
-  {&__pyx_kp_u_Sorts_the_words_in_the_strings, __pyx_k_Sorts_the_words_in_the_strings, sizeof(__pyx_k_Sorts_the_words_in_the_strings), 0, 1, 0, 0},
   {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
-  {&__pyx_n_s_WRatio, __pyx_k_WRatio, sizeof(__pyx_k_WRatio), 0, 0, 1, 1},
-  {&__pyx_kp_u__13, __pyx_k__13, sizeof(__pyx_k__13), 0, 1, 0, 0},
-  {&__pyx_kp_u__14, __pyx_k__14, sizeof(__pyx_k__14), 0, 1, 0, 0},
-  {&__pyx_kp_u__15, __pyx_k__15, sizeof(__pyx_k__15), 0, 1, 0, 0},
-  {&__pyx_n_s__19, __pyx_k__19, sizeof(__pyx_k__19), 0, 0, 1, 1},
+  {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
+  {&__pyx_kp_u__34, __pyx_k__34, sizeof(__pyx_k__34), 0, 1, 0, 0},
+  {&__pyx_kp_u__35, __pyx_k__35, sizeof(__pyx_k__35), 0, 1, 0, 0},
+  {&__pyx_kp_u__36, __pyx_k__36, sizeof(__pyx_k__36), 0, 1, 0, 0},
+  {&__pyx_n_s__42, __pyx_k__42, sizeof(__pyx_k__42), 0, 0, 1, 1},
   {&__pyx_n_s_array, __pyx_k_array, sizeof(__pyx_k_array), 0, 0, 1, 1},
+  {&__pyx_n_s_as_opcodes, __pyx_k_as_opcodes, sizeof(__pyx_k_as_opcodes), 0, 0, 1, 1},
   {&__pyx_n_s_asyncio_coroutines, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
   {&__pyx_n_s_c_score_cutoff, __pyx_k_c_score_cutoff, sizeof(__pyx_k_c_score_cutoff), 0, 0, 1, 1},
+  {&__pyx_n_s_c_score_hint, __pyx_k_c_score_hint, sizeof(__pyx_k_c_score_hint), 0, 0, 1, 1},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
-  {&__pyx_n_s_default_process, __pyx_k_default_process, sizeof(__pyx_k_default_process), 0, 0, 1, 1},
-  {&__pyx_n_s_distance__initialize_cpp, __pyx_k_distance__initialize_cpp, sizeof(__pyx_k_distance__initialize_cpp), 0, 0, 1, 1},
-  {&__pyx_n_u_flags, __pyx_k_flags, sizeof(__pyx_k_flags), 0, 1, 0, 1},
+  {&__pyx_n_s_damerau_levenshtein_distance, __pyx_k_damerau_levenshtein_distance, sizeof(__pyx_k_damerau_levenshtein_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_damerau_levenshtein_normalized_d, __pyx_k_damerau_levenshtein_normalized_d, sizeof(__pyx_k_damerau_levenshtein_normalized_d), 0, 0, 1, 1},
+  {&__pyx_n_s_damerau_levenshtein_normalized_s, __pyx_k_damerau_levenshtein_normalized_s, sizeof(__pyx_k_damerau_levenshtein_normalized_s), 0, 0, 1, 1},
+  {&__pyx_n_s_damerau_levenshtein_similarity, __pyx_k_damerau_levenshtein_similarity, sizeof(__pyx_k_damerau_levenshtein_similarity), 0, 0, 1, 1},
+  {&__pyx_n_s_deletion, __pyx_k_deletion, sizeof(__pyx_k_deletion), 0, 0, 1, 1},
+  {&__pyx_n_s_get, __pyx_k_get, sizeof(__pyx_k_get), 0, 0, 1, 1},
   {&__pyx_n_u_get_scorer_flags, __pyx_k_get_scorer_flags, sizeof(__pyx_k_get_scorer_flags), 0, 1, 0, 1},
+  {&__pyx_n_s_hamming_distance, __pyx_k_hamming_distance, sizeof(__pyx_k_hamming_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_hamming_normalized_distance, __pyx_k_hamming_normalized_distance, sizeof(__pyx_k_hamming_normalized_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_hamming_normalized_similarity, __pyx_k_hamming_normalized_similarity, sizeof(__pyx_k_hamming_normalized_similarity), 0, 0, 1, 1},
+  {&__pyx_n_s_hamming_similarity, __pyx_k_hamming_similarity, sizeof(__pyx_k_hamming_similarity), 0, 0, 1, 1},
   {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
+  {&__pyx_n_s_indel_distance, __pyx_k_indel_distance, sizeof(__pyx_k_indel_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_indel_editops, __pyx_k_indel_editops, sizeof(__pyx_k_indel_editops), 0, 0, 1, 1},
+  {&__pyx_n_s_indel_normalized_distance, __pyx_k_indel_normalized_distance, sizeof(__pyx_k_indel_normalized_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_indel_normalized_similarity, __pyx_k_indel_normalized_similarity, sizeof(__pyx_k_indel_normalized_similarity), 0, 0, 1, 1},
+  {&__pyx_n_s_indel_opcodes, __pyx_k_indel_opcodes, sizeof(__pyx_k_indel_opcodes), 0, 0, 1, 1},
+  {&__pyx_n_s_indel_similarity, __pyx_k_indel_similarity, sizeof(__pyx_k_indel_similarity), 0, 0, 1, 1},
+  {&__pyx_n_s_initialize_cpp, __pyx_k_initialize_cpp, sizeof(__pyx_k_initialize_cpp), 0, 0, 1, 1},
+  {&__pyx_n_s_insertion, __pyx_k_insertion, sizeof(__pyx_k_insertion), 0, 0, 1, 1},
   {&__pyx_n_s_is_coroutine, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
   {&__pyx_n_s_keys, __pyx_k_keys, sizeof(__pyx_k_keys), 0, 0, 1, 1},
-  {&__pyx_n_s_kwargs, __pyx_k_kwargs, sizeof(__pyx_k_kwargs), 0, 0, 1, 1},
+  {&__pyx_n_s_lcs_seq_distance, __pyx_k_lcs_seq_distance, sizeof(__pyx_k_lcs_seq_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_lcs_seq_editops, __pyx_k_lcs_seq_editops, sizeof(__pyx_k_lcs_seq_editops), 0, 0, 1, 1},
+  {&__pyx_n_s_lcs_seq_normalized_distance, __pyx_k_lcs_seq_normalized_distance, sizeof(__pyx_k_lcs_seq_normalized_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_lcs_seq_normalized_similarity, __pyx_k_lcs_seq_normalized_similarity, sizeof(__pyx_k_lcs_seq_normalized_similarity), 0, 0, 1, 1},
+  {&__pyx_n_s_lcs_seq_opcodes, __pyx_k_lcs_seq_opcodes, sizeof(__pyx_k_lcs_seq_opcodes), 0, 0, 1, 1},
+  {&__pyx_n_s_lcs_seq_similarity, __pyx_k_lcs_seq_similarity, sizeof(__pyx_k_lcs_seq_similarity), 0, 0, 1, 1},
+  {&__pyx_n_s_levenshtein_distance, __pyx_k_levenshtein_distance, sizeof(__pyx_k_levenshtein_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_levenshtein_editops, __pyx_k_levenshtein_editops, sizeof(__pyx_k_levenshtein_editops), 0, 0, 1, 1},
+  {&__pyx_n_s_levenshtein_normalized_distance, __pyx_k_levenshtein_normalized_distance, sizeof(__pyx_k_levenshtein_normalized_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_levenshtein_normalized_similarit, __pyx_k_levenshtein_normalized_similarit, sizeof(__pyx_k_levenshtein_normalized_similarit), 0, 0, 1, 1},
+  {&__pyx_n_s_levenshtein_opcodes, __pyx_k_levenshtein_opcodes, sizeof(__pyx_k_levenshtein_opcodes), 0, 0, 1, 1},
+  {&__pyx_n_s_levenshtein_similarity, __pyx_k_levenshtein_similarity, sizeof(__pyx_k_levenshtein_similarity), 0, 0, 1, 1},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
-  {&__pyx_n_u_optimal_score, __pyx_k_optimal_score, sizeof(__pyx_k_optimal_score), 0, 1, 0, 1},
-  {&__pyx_n_s_partial_ratio, __pyx_k_partial_ratio, sizeof(__pyx_k_partial_ratio), 0, 0, 1, 1},
-  {&__pyx_n_s_partial_ratio_alignment, __pyx_k_partial_ratio_alignment, sizeof(__pyx_k_partial_ratio_alignment), 0, 0, 1, 1},
-  {&__pyx_kp_u_partial_ratio_alignment_line_171, __pyx_k_partial_ratio_alignment_line_171, sizeof(__pyx_k_partial_ratio_alignment_line_171), 0, 1, 0, 0},
-  {&__pyx_kp_u_partial_ratio_line_96, __pyx_k_partial_ratio_line_96, sizeof(__pyx_k_partial_ratio_line_96), 0, 1, 0, 0},
-  {&__pyx_n_s_partial_token_ratio, __pyx_k_partial_token_ratio, sizeof(__pyx_k_partial_token_ratio), 0, 0, 1, 1},
-  {&__pyx_n_s_partial_token_set_ratio, __pyx_k_partial_token_set_ratio, sizeof(__pyx_k_partial_token_set_ratio), 0, 0, 1, 1},
-  {&__pyx_n_s_partial_token_sort_ratio, __pyx_k_partial_token_sort_ratio, sizeof(__pyx_k_partial_token_sort_ratio), 0, 0, 1, 1},
+  {&__pyx_n_s_ops, __pyx_k_ops, sizeof(__pyx_k_ops), 0, 0, 1, 1},
+  {&__pyx_n_s_osa_distance, __pyx_k_osa_distance, sizeof(__pyx_k_osa_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_osa_normalized_distance, __pyx_k_osa_normalized_distance, sizeof(__pyx_k_osa_normalized_distance), 0, 0, 1, 1},
+  {&__pyx_n_s_osa_normalized_similarity, __pyx_k_osa_normalized_similarity, sizeof(__pyx_k_osa_normalized_similarity), 0, 0, 1, 1},
+  {&__pyx_n_s_osa_similarity, __pyx_k_osa_similarity, sizeof(__pyx_k_osa_similarity), 0, 0, 1, 1},
   {&__pyx_n_s_processor, __pyx_k_processor, sizeof(__pyx_k_processor), 0, 0, 1, 1},
   {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
-  {&__pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_k_rapidfuzz_fuzz_cpp, sizeof(__pyx_k_rapidfuzz_fuzz_cpp), 0, 0, 1, 1},
-  {&__pyx_n_s_rapidfuzz_utils, __pyx_k_rapidfuzz_utils, sizeof(__pyx_k_rapidfuzz_utils), 0, 0, 1, 1},
-  {&__pyx_n_s_ratio, __pyx_k_ratio, sizeof(__pyx_k_ratio), 0, 0, 1, 1},
-  {&__pyx_kp_u_ratio_line_50, __pyx_k_ratio_line_50, sizeof(__pyx_k_ratio_line_50), 0, 1, 0, 0},
-  {&__pyx_n_s_res, __pyx_k_res, sizeof(__pyx_k_res), 0, 0, 1, 1},
+  {&__pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_k_rapidfuzz_distance_metrics_cpp, sizeof(__pyx_k_rapidfuzz_distance_metrics_cpp), 0, 0, 1, 1},
   {&__pyx_n_s_s1, __pyx_k_s1, sizeof(__pyx_k_s1), 0, 0, 1, 1},
   {&__pyx_n_s_s1_proc, __pyx_k_s1_proc, sizeof(__pyx_k_s1_proc), 0, 0, 1, 1},
   {&__pyx_n_s_s2, __pyx_k_s2, sizeof(__pyx_k_s2), 0, 0, 1, 1},
   {&__pyx_n_s_s2_proc, __pyx_k_s2_proc, sizeof(__pyx_k_s2_proc), 0, 0, 1, 1},
   {&__pyx_n_s_score_cutoff, __pyx_k_score_cutoff, sizeof(__pyx_k_score_cutoff), 0, 0, 1, 1},
+  {&__pyx_kp_u_score_cutoff_has_to_be_0, __pyx_k_score_cutoff_has_to_be_0, sizeof(__pyx_k_score_cutoff_has_to_be_0), 0, 1, 0, 0},
   {&__pyx_kp_u_score_cutoff_has_to_be_in_the_ra, __pyx_k_score_cutoff_has_to_be_in_the_ra, sizeof(__pyx_k_score_cutoff_has_to_be_in_the_ra), 0, 1, 0, 0},
-  {&__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_k_src_rapidfuzz_fuzz_cpp_pyx, sizeof(__pyx_k_src_rapidfuzz_fuzz_cpp_pyx), 0, 0, 1, 0},
+  {&__pyx_n_s_score_hint, __pyx_k_score_hint, sizeof(__pyx_k_score_hint), 0, 0, 1, 1},
+  {&__pyx_kp_u_score_hint_has_to_be_0, __pyx_k_score_hint_has_to_be_0, sizeof(__pyx_k_score_hint_has_to_be_0), 0, 1, 0, 0},
+  {&__pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_k_src_rapidfuzz_distance_metrics_c, sizeof(__pyx_k_src_rapidfuzz_distance_metrics_c), 0, 0, 1, 0},
+  {&__pyx_n_s_substitution, __pyx_k_substitution, sizeof(__pyx_k_substitution), 0, 0, 1, 1},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
-  {&__pyx_n_s_token_ratio, __pyx_k_token_ratio, sizeof(__pyx_k_token_ratio), 0, 0, 1, 1},
-  {&__pyx_n_s_token_set_ratio, __pyx_k_token_set_ratio, sizeof(__pyx_k_token_set_ratio), 0, 0, 1, 1},
-  {&__pyx_kp_u_token_set_ratio_line_266, __pyx_k_token_set_ratio_line_266, sizeof(__pyx_k_token_set_ratio_line_266), 0, 1, 0, 0},
-  {&__pyx_n_s_token_sort_ratio, __pyx_k_token_sort_ratio, sizeof(__pyx_k_token_sort_ratio), 0, 0, 1, 1},
-  {&__pyx_kp_u_token_sort_ratio_line_224, __pyx_k_token_sort_ratio_line_224, sizeof(__pyx_k_token_sort_ratio_line_224), 0, 1, 0, 0},
   {&__pyx_n_s_typecode, __pyx_k_typecode, sizeof(__pyx_k_typecode), 0, 0, 1, 1},
-  {&__pyx_n_u_worst_score, __pyx_k_worst_score, sizeof(__pyx_k_worst_score), 0, 1, 0, 1},
+  {&__pyx_n_s_weights, __pyx_k_weights, sizeof(__pyx_k_weights), 0, 0, 1, 1},
+  {&__pyx_n_u_weights, __pyx_k_weights, sizeof(__pyx_k_weights), 0, 1, 0, 1},
   #endif
   {0, 0, 0, 0, 0, 0, 0}
 };
 /* #### Code section: cached_builtins ### */
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 251, __pyx_L1_error)
+  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(0, 216, __pyx_L1_error)
   __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(1, 257, __pyx_L1_error)
   __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 338, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 /* #### Code section: cached_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":50
- *     bool QRatioInit(                RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
+  /* "rapidfuzz/distance/metrics_cpp.pyx":108
+ *     c_score_cutoff = score_cutoff
+ *     if c_score_cutoff < 0:
+ *         raise ValueError("score_cutoff has to be >= 0")             # <<<<<<<<<<<<<<
  * 
- * def ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the normalized Indel distance.
+ *     return c_score_cutoff
  */
-  __pyx_tuple__16 = PyTuple_Pack(7, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_c_score_cutoff, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 50, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__16);
-  __Pyx_GIVEREF(__pyx_tuple__16);
-  __pyx_codeobj_ = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_ratio, 50, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj_)) __PYX_ERR(0, 50, __pyx_L1_error)
+  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_score_cutoff_has_to_be_0); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 108, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple_);
+  __Pyx_GIVEREF(__pyx_tuple_);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":96
+  /* "rapidfuzz/distance/metrics_cpp.pyx":130
+ *     c_score_hint = score_hint
+ *     if c_score_hint < 0:
+ *         raise ValueError("score_hint has to be >= 0")             # <<<<<<<<<<<<<<
  * 
+ *     return c_score_hint
+ */
+  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_score_hint_has_to_be_0); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 130, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__2);
+  __Pyx_GIVEREF(__pyx_tuple__2);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":135
  * 
- * def partial_ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Searches for the optimal alignment of the shorter string in the
+ * 
+ * def levenshtein_distance(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef int64_t insertion, deletion, substitution
  */
-  __pyx_codeobj__2 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_partial_ratio, 96, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__2)) __PYX_ERR(0, 96, __pyx_L1_error)
+  __pyx_tuple__3 = PyTuple_Pack(3, __pyx_int_1, __pyx_int_1, __pyx_int_1); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 135, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__3);
+  __Pyx_GIVEREF(__pyx_tuple__3);
+  __pyx_tuple__37 = PyTuple_Pack(11, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_weights, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc, __pyx_n_s_insertion, __pyx_n_s_deletion, __pyx_n_s_substitution, __pyx_n_s_c_score_cutoff); if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 135, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__37);
+  __Pyx_GIVEREF(__pyx_tuple__37);
+  __pyx_codeobj__4 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__37, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_levenshtein_distance, 135, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 135, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":171
+  /* "rapidfuzz/distance/metrics_cpp.pyx":147
  * 
  * 
- * def partial_ratio_alignment(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Searches for the optimal alignment of the shorter string in the
+ * def levenshtein_similarity(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef int64_t insertion, deletion, substitution
  */
-  __pyx_tuple__17 = PyTuple_Pack(8, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_c_score_cutoff, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc, __pyx_n_s_res); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 171, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__17);
-  __Pyx_GIVEREF(__pyx_tuple__17);
-  __pyx_codeobj__3 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__17, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_partial_ratio_alignment, 171, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__3)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __pyx_codeobj__5 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__37, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_levenshtein_similarity, 147, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 147, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":224
+  /* "rapidfuzz/distance/metrics_cpp.pyx":159
  * 
  * 
- * def token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Sorts the words in the strings and calculates the fuzz.ratio between them
+ * def levenshtein_normalized_distance(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __pyx_codeobj__4 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_token_sort_ratio, 224, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 224, __pyx_L1_error)
+  __pyx_codeobj__6 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__37, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_levenshtein_normalized_distance, 159, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__6)) __PYX_ERR(0, 159, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":266
+  /* "rapidfuzz/distance/metrics_cpp.pyx":174
  * 
  * 
- * def token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Compares the words in the strings based on unique and common words between them
+ * def levenshtein_normalized_similarity(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __pyx_codeobj__5 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_token_set_ratio, 266, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 266, __pyx_L1_error)
+  __pyx_codeobj__7 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__37, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_levenshtein_normalized_similarit, 174, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 174, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":311
+  /* "rapidfuzz/distance/metrics_cpp.pyx":189
  * 
  * 
- * def token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Helper method that returns the maximum of fuzz.token_set_ratio and fuzz.token_sort_ratio
+ * def levenshtein_editops(s1, s2, *, processor=None, score_hint=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
  */
-  __pyx_codeobj__6 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_token_ratio, 311, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__6)) __PYX_ERR(0, 311, __pyx_L1_error)
+  __pyx_tuple__38 = PyTuple_Pack(8, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_score_hint, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc, __pyx_n_s_ops, __pyx_n_s_c_score_hint); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 189, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__38);
+  __Pyx_GIVEREF(__pyx_tuple__38);
+  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_levenshtein_editops, 189, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 189, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":349
+  /* "rapidfuzz/distance/metrics_cpp.pyx":199
  * 
  * 
- * def partial_token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     sorts the words in the strings and calculates the fuzz.partial_ratio between them
+ * def levenshtein_opcodes(s1, s2, *, processor=None, score_hint=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
  */
-  __pyx_codeobj__7 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_partial_token_sort_ratio, 349, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 349, __pyx_L1_error)
+  __pyx_codeobj__9 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_levenshtein_opcodes, 199, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__9)) __PYX_ERR(0, 199, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":386
+  /* "rapidfuzz/distance/metrics_cpp.pyx":275
  * 
  * 
- * def partial_token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Compares the words in the strings based on unique and common words between them
+ * def damerau_levenshtein_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_partial_token_set_ratio, 386, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 386, __pyx_L1_error)
+  __pyx_tuple__39 = PyTuple_Pack(7, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_c_score_cutoff, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc); if (unlikely(!__pyx_tuple__39)) __PYX_ERR(0, 275, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__39);
+  __Pyx_GIVEREF(__pyx_tuple__39);
+  __pyx_codeobj__10 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_damerau_levenshtein_distance, 275, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__10)) __PYX_ERR(0, 275, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":427
+  /* "rapidfuzz/distance/metrics_cpp.pyx":282
  * 
  * 
- * def partial_token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Helper method that returns the maximum of fuzz.partial_token_set_ratio and
+ * def damerau_levenshtein_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __pyx_codeobj__9 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_partial_token_ratio, 427, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__9)) __PYX_ERR(0, 427, __pyx_L1_error)
+  __pyx_codeobj__11 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_damerau_levenshtein_similarity, 282, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 282, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":465
+  /* "rapidfuzz/distance/metrics_cpp.pyx":289
  * 
  * 
- * def WRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a weighted ratio based on the other ratio algorithms
+ * def damerau_levenshtein_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __pyx_codeobj__10 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_WRatio, 465, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__10)) __PYX_ERR(0, 465, __pyx_L1_error)
+  __pyx_tuple__40 = PyTuple_Pack(7, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc, __pyx_n_s_c_score_cutoff); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 289, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__40);
+  __Pyx_GIVEREF(__pyx_tuple__40);
+  __pyx_codeobj__12 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_damerau_levenshtein_normalized_d, 289, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__12)) __PYX_ERR(0, 289, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":504
- *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":299
+ * 
  * 
- * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a quick ratio between two strings using fuzz.ratio.
+ * def damerau_levenshtein_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __pyx_codeobj__11 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_QRatio, 504, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 504, __pyx_L1_error)
+  __pyx_codeobj__13 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_damerau_levenshtein_normalized_s, 299, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__13)) __PYX_ERR(0, 299, __pyx_L1_error)
 
-  /* "rapidfuzz/fuzz_cpp.pyx":559
- *     return True
+  /* "rapidfuzz/distance/metrics_cpp.pyx":345
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
  * 
+ * def lcs_seq_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__14 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_lcs_seq_distance, 345, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__14)) __PYX_ERR(0, 345, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":352
+ * 
+ * 
+ * def lcs_seq_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__15 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_lcs_seq_similarity, 352, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__15)) __PYX_ERR(0, 352, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":359
+ * 
+ * 
+ * def lcs_seq_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __pyx_tuple__18 = PyTuple_Pack(1, __pyx_n_s_kwargs); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 559, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__18);
-  __Pyx_GIVEREF(__pyx_tuple__18);
-  __pyx_codeobj__12 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__18, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx, __pyx_n_s_GetScorerFlagsSimilarity, 559, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__12)) __PYX_ERR(0, 559, __pyx_L1_error)
+  __pyx_codeobj__16 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_lcs_seq_normalized_distance, 359, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__16)) __PYX_ERR(0, 359, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":369
+ * 
+ * 
+ * def lcs_seq_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __pyx_codeobj__17 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_lcs_seq_normalized_similarity, 369, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__17)) __PYX_ERR(0, 369, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":379
+ * 
+ * 
+ * def lcs_seq_editops(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+  __pyx_tuple__41 = PyTuple_Pack(6, __pyx_n_s_s1, __pyx_n_s_s2, __pyx_n_s_processor, __pyx_n_s_s1_proc, __pyx_n_s_s2_proc, __pyx_n_s_ops); if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 379, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__41);
+  __Pyx_GIVEREF(__pyx_tuple__41);
+  __pyx_codeobj__18 = (PyObject*)__Pyx_PyCode_New(2, 0, 1, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__41, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_lcs_seq_editops, 379, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__18)) __PYX_ERR(0, 379, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":388
+ * 
+ * 
+ * def lcs_seq_opcodes(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+  __pyx_codeobj__19 = (PyObject*)__Pyx_PyCode_New(2, 0, 1, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__41, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_lcs_seq_opcodes, 388, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__19)) __PYX_ERR(0, 388, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":434
+ * 
+ * 
+ * def indel_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__20 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_indel_distance, 434, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__20)) __PYX_ERR(0, 434, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":441
+ * 
+ * 
+ * def indel_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__21 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_indel_similarity, 441, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__21)) __PYX_ERR(0, 441, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":448
+ * 
+ * 
+ * def indel_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __pyx_codeobj__22 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_indel_normalized_distance, 448, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__22)) __PYX_ERR(0, 448, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":458
+ * 
+ * 
+ * def indel_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __pyx_codeobj__23 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_indel_normalized_similarity, 458, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__23)) __PYX_ERR(0, 458, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":468
+ * 
+ * 
+ * def indel_editops(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+  __pyx_codeobj__24 = (PyObject*)__Pyx_PyCode_New(2, 0, 1, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__41, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_indel_editops, 468, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__24)) __PYX_ERR(0, 468, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":477
+ * 
+ * 
+ * def indel_opcodes(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+  __pyx_codeobj__25 = (PyObject*)__Pyx_PyCode_New(2, 0, 1, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__41, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_indel_opcodes, 477, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__25)) __PYX_ERR(0, 477, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":526
+ * 
+ * 
+ * def hamming_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__26 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_hamming_distance, 526, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__26)) __PYX_ERR(0, 526, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":536
+ *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def hamming_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__27 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_hamming_similarity, 536, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__27)) __PYX_ERR(0, 536, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":546
+ *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def hamming_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __pyx_codeobj__28 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_hamming_normalized_distance, 546, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 546, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":556
+ * 
+ * 
+ * def hamming_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __pyx_codeobj__29 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_hamming_normalized_similarity, 556, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__29)) __PYX_ERR(0, 556, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":602
+ * hamming_normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
+ * 
+ * def osa_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__30 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_osa_distance, 602, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 602, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":612
+ *     return osa_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def osa_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __pyx_codeobj__31 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_osa_similarity, 612, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__31)) __PYX_ERR(0, 612, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":622
+ *     return osa_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def osa_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_osa_normalized_distance, 622, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 622, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":632
+ * 
+ * 
+ * def osa_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __pyx_codeobj__33 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_distance_metrics_c, __pyx_n_s_osa_normalized_similarity, 632, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__33)) __PYX_ERR(0, 632, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 /* #### Code section: init_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitConstants(void) {
+  __pyx_umethod_PyDict_Type_get.type = (PyObject*)&PyDict_Type;
+  __pyx_umethod_PyDict_Type_get.method_name = &__pyx_n_s_get;
   __pyx_umethod_PyDict_Type_keys.type = (PyObject*)&PyDict_Type;
   __pyx_umethod_PyDict_Type_keys.method_name = &__pyx_n_s_keys;
   #if CYTHON_USE_MODULE_STATE
-  if (__Pyx_InitString(__pyx_string_tab[0], &__pyx_kp_u_Calculates_a_quick_ratio_betwee) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[1], &__pyx_kp_u_Calculates_the_normalized_Indel) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[2], &__pyx_kp_u_Compares_the_words_in_the_strin) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[3], &__pyx_n_s_GetScorerFlagsSimilarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[4], &__pyx_kp_u_Got_unexpected_keyword_arguments) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[5], &__pyx_n_s_MemoryError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[6], &__pyx_n_s_QRatio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[7], &__pyx_kp_u_QRatio_line_504) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[8], &__pyx_n_u_RF_Preprocess) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[9], &__pyx_n_s_RF_Scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[10], &__pyx_n_s_RF_ScorerPy) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[11], &__pyx_n_s_ScoreAlignment) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[12], &__pyx_kp_u_Searches_for_the_optimal_alignm) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[13], &__pyx_kp_u_Searches_for_the_optimal_alignm_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[14], &__pyx_kp_u_Sorts_the_words_in_the_strings) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[15], &__pyx_n_s_TypeError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[16], &__pyx_n_s_WRatio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[17], &__pyx_kp_u__13) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[18], &__pyx_kp_u__14) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[19], &__pyx_kp_u__15) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[20], &__pyx_n_s__19) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[21], &__pyx_n_s_array) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[22], &__pyx_n_s_asyncio_coroutines) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[23], &__pyx_n_s_c_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[24], &__pyx_n_s_cline_in_traceback) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[25], &__pyx_n_s_default_process) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[26], &__pyx_n_s_distance__initialize_cpp) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[27], &__pyx_n_u_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[28], &__pyx_n_u_get_scorer_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[0], &__pyx_n_s_Editops) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[1], &__pyx_kp_u_Got_unexpected_keyword_arguments) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[2], &__pyx_n_s_MemoryError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[3], &__pyx_n_u_RF_Preprocess) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[4], &__pyx_n_s_RF_Scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[5], &__pyx_n_s_RF_ScorerPy) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[6], &__pyx_n_s_TypeError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[7], &__pyx_n_s_ValueError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[8], &__pyx_kp_u__34) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[9], &__pyx_kp_u__35) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[10], &__pyx_kp_u__36) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[11], &__pyx_n_s__42) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[12], &__pyx_n_s_array) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[13], &__pyx_n_s_as_opcodes) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[14], &__pyx_n_s_asyncio_coroutines) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[15], &__pyx_n_s_c_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[16], &__pyx_n_s_c_score_hint) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[17], &__pyx_n_s_cline_in_traceback) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[18], &__pyx_n_s_damerau_levenshtein_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[19], &__pyx_n_s_damerau_levenshtein_normalized_d) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[20], &__pyx_n_s_damerau_levenshtein_normalized_s) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[21], &__pyx_n_s_damerau_levenshtein_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[22], &__pyx_n_s_deletion) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[23], &__pyx_n_s_get) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[24], &__pyx_n_u_get_scorer_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[25], &__pyx_n_s_hamming_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[26], &__pyx_n_s_hamming_normalized_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[27], &__pyx_n_s_hamming_normalized_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[28], &__pyx_n_s_hamming_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   if (__Pyx_InitString(__pyx_string_tab[29], &__pyx_n_s_import) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[30], &__pyx_n_s_is_coroutine) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[31], &__pyx_n_s_keys) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[32], &__pyx_n_s_kwargs) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[33], &__pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[34], &__pyx_n_s_name) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[35], &__pyx_n_u_optimal_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[36], &__pyx_n_s_partial_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[37], &__pyx_n_s_partial_ratio_alignment) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[38], &__pyx_kp_u_partial_ratio_alignment_line_171) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[39], &__pyx_kp_u_partial_ratio_line_96) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[40], &__pyx_n_s_partial_token_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[41], &__pyx_n_s_partial_token_set_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[42], &__pyx_n_s_partial_token_sort_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[43], &__pyx_n_s_processor) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[44], &__pyx_n_s_range) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[45], &__pyx_n_s_rapidfuzz_fuzz_cpp) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[46], &__pyx_n_s_rapidfuzz_utils) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[47], &__pyx_n_s_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[48], &__pyx_kp_u_ratio_line_50) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[49], &__pyx_n_s_res) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[50], &__pyx_n_s_s1) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[51], &__pyx_n_s_s1_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[52], &__pyx_n_s_s2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[53], &__pyx_n_s_s2_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[54], &__pyx_n_s_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[55], &__pyx_kp_u_score_cutoff_has_to_be_in_the_ra) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[56], &__pyx_kp_s_src_rapidfuzz_fuzz_cpp_pyx) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[57], &__pyx_n_s_test) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[58], &__pyx_n_s_token_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[59], &__pyx_n_s_token_set_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[60], &__pyx_kp_u_token_set_ratio_line_266) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[61], &__pyx_n_s_token_sort_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[62], &__pyx_kp_u_token_sort_ratio_line_224) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[63], &__pyx_n_s_typecode) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[64], &__pyx_n_u_worst_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[30], &__pyx_n_s_indel_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[31], &__pyx_n_s_indel_editops) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[32], &__pyx_n_s_indel_normalized_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[33], &__pyx_n_s_indel_normalized_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[34], &__pyx_n_s_indel_opcodes) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[35], &__pyx_n_s_indel_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[36], &__pyx_n_s_initialize_cpp) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[37], &__pyx_n_s_insertion) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[38], &__pyx_n_s_is_coroutine) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[39], &__pyx_n_s_keys) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[40], &__pyx_n_s_lcs_seq_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[41], &__pyx_n_s_lcs_seq_editops) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[42], &__pyx_n_s_lcs_seq_normalized_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[43], &__pyx_n_s_lcs_seq_normalized_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[44], &__pyx_n_s_lcs_seq_opcodes) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[45], &__pyx_n_s_lcs_seq_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[46], &__pyx_n_s_levenshtein_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[47], &__pyx_n_s_levenshtein_editops) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[48], &__pyx_n_s_levenshtein_normalized_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[49], &__pyx_n_s_levenshtein_normalized_similarit) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[50], &__pyx_n_s_levenshtein_opcodes) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[51], &__pyx_n_s_levenshtein_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[52], &__pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[53], &__pyx_n_s_name) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[54], &__pyx_n_s_ops) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[55], &__pyx_n_s_osa_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[56], &__pyx_n_s_osa_normalized_distance) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[57], &__pyx_n_s_osa_normalized_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[58], &__pyx_n_s_osa_similarity) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[59], &__pyx_n_s_processor) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[60], &__pyx_n_s_range) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[61], &__pyx_n_s_rapidfuzz_distance_metrics_cpp) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[62], &__pyx_n_s_s1) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[63], &__pyx_n_s_s1_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[64], &__pyx_n_s_s2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[65], &__pyx_n_s_s2_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[66], &__pyx_n_s_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[67], &__pyx_kp_u_score_cutoff_has_to_be_0) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[68], &__pyx_kp_u_score_cutoff_has_to_be_in_the_ra) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[69], &__pyx_n_s_score_hint) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[70], &__pyx_kp_u_score_hint_has_to_be_0) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[71], &__pyx_kp_s_src_rapidfuzz_distance_metrics_c) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[72], &__pyx_n_s_substitution) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[73], &__pyx_n_s_test) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[74], &__pyx_n_s_typecode) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[75], &__pyx_n_s_weights) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[76], &__pyx_n_u_weights) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   #endif
   #if !CYTHON_USE_MODULE_STATE
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   #endif
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_32 = PyInt_FromLong(32); if (unlikely(!__pyx_int_32)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_100 = PyInt_FromLong(100); if (unlikely(!__pyx_int_100)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 /* #### Code section: init_globals ### */
 
@@ -9424,15 +16290,14 @@
 static CYTHON_SMALL_CODE int __Pyx_modinit_variable_import_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_function_import_code(void); /*proto*/
 
 static int __Pyx_modinit_global_init_code(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_modinit_global_init_code", 0);
   /*--- Global init code ---*/
-  __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy = ((PyObject*)Py_None); Py_INCREF(Py_None);
   __Pyx_RefNannyFinishContext();
   return 0;
 }
 
 static int __Pyx_modinit_variable_export_code(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_modinit_variable_export_code", 0);
@@ -9474,14 +16339,26 @@
   sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyTypeObject),
   #else
   sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyHeapTypeObject),
   #endif
   __Pyx_ImportType_CheckSize_Warn);
    if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(2, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyImport_ImportModule("rapidfuzz.distance._initialize_cpp"); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 8, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops = __Pyx_ImportType(__pyx_t_1, "rapidfuzz.distance._initialize_cpp", "Editops", sizeof(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Editops),
+  __Pyx_ImportType_CheckSize_Warn);
+   if (!__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Editops) __PYX_ERR(3, 8, __pyx_L1_error)
+  __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Opcodes = __Pyx_ImportType(__pyx_t_1, "rapidfuzz.distance._initialize_cpp", "Opcodes", sizeof(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Opcodes), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_Opcodes),
+  __Pyx_ImportType_CheckSize_Warn);
+   if (!__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_Opcodes) __PYX_ERR(3, 11, __pyx_L1_error)
+  __pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment = __Pyx_ImportType(__pyx_t_1, "rapidfuzz.distance._initialize_cpp", "ScoreAlignment", sizeof(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment), __PYX_GET_STRUCT_ALIGNMENT(struct __pyx_obj_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment),
+  __Pyx_ImportType_CheckSize_Warn);
+   if (!__pyx_ptype_9rapidfuzz_8distance_15_initialize_cpp_ScoreAlignment) __PYX_ERR(3, 14, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
 }
@@ -9502,31 +16379,31 @@
   return 0;
 }
 
 
 #if PY_MAJOR_VERSION >= 3
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
-static int __pyx_pymod_exec_fuzz_cpp(PyObject* module); /*proto*/
+static int __pyx_pymod_exec_metrics_cpp(PyObject* module); /*proto*/
 static PyModuleDef_Slot __pyx_moduledef_slots[] = {
   {Py_mod_create, (void*)__pyx_pymod_create},
-  {Py_mod_exec, (void*)__pyx_pymod_exec_fuzz_cpp},
+  {Py_mod_exec, (void*)__pyx_pymod_exec_metrics_cpp},
   {0, NULL}
 };
 #endif
 
 #ifdef __cplusplus
 namespace {
   struct PyModuleDef __pyx_moduledef =
   #else
   static struct PyModuleDef __pyx_moduledef =
   #endif
   {
       PyModuleDef_HEAD_INIT,
-      "fuzz_cpp",
+      "metrics_cpp",
       0, /* m_doc */
     #if CYTHON_PEP489_MULTI_PHASE_INIT
       0, /* m_size */
     #elif CYTHON_USE_MODULE_STATE
       sizeof(__pyx_mstate), /* m_size */
     #else
       -1, /* m_size */
@@ -9566,19 +16443,19 @@
 #else
 #define __Pyx_PyMODINIT_FUNC PyObject *
 #endif
 #endif
 
 
 #if PY_MAJOR_VERSION < 3
-__Pyx_PyMODINIT_FUNC initfuzz_cpp(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC initfuzz_cpp(void)
+__Pyx_PyMODINIT_FUNC initmetrics_cpp(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC initmetrics_cpp(void)
 #else
-__Pyx_PyMODINIT_FUNC PyInit_fuzz_cpp(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC PyInit_fuzz_cpp(void)
+__Pyx_PyMODINIT_FUNC PyInit_metrics_cpp(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC PyInit_metrics_cpp(void)
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 {
   return PyModuleDef_Init(&__pyx_moduledef);
 }
 static CYTHON_SMALL_CODE int __Pyx_check_single_interpreter(void) {
     #if PY_VERSION_HEX >= 0x030700A1
     static PY_INT64_T main_interpreter_id = -1;
@@ -9651,44 +16528,43 @@
     return module;
 bad:
     Py_XDECREF(module);
     return NULL;
 }
 
 
-static CYTHON_SMALL_CODE int __pyx_pymod_exec_fuzz_cpp(PyObject *__pyx_pyinit_module)
+static CYTHON_SMALL_CODE int __pyx_pymod_exec_metrics_cpp(PyObject *__pyx_pyinit_module)
 #endif
 #endif
 {
   int stringtab_initialized = 0;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
-  bool __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   if (__pyx_m) {
     if (__pyx_m == __pyx_pyinit_module) return 0;
-    PyErr_SetString(PyExc_RuntimeError, "Module 'fuzz_cpp' has already been imported. Re-initialisation is not supported.");
+    PyErr_SetString(PyExc_RuntimeError, "Module 'metrics_cpp' has already been imported. Re-initialisation is not supported.");
     return -1;
   }
   #elif PY_MAJOR_VERSION >= 3
   if (__pyx_m) return __Pyx_NewRef(__pyx_m);
   #endif
   /*--- Module creation code ---*/
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   __pyx_m = __pyx_pyinit_module;
   Py_INCREF(__pyx_m);
   #else
   #if PY_MAJOR_VERSION < 3
-  __pyx_m = Py_InitModule4("fuzz_cpp", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
+  __pyx_m = Py_InitModule4("metrics_cpp", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
   if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
   #elif CYTHON_COMPILING_IN_LIMITED_API
   __pyx_t_1 = PyModule_Create(&__pyx_moduledef); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   {
     int add_module_result = PyState_AddModule(__pyx_t_1, &__pyx_moduledef);
     Py_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (unlikely((add_module_result < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -9711,15 +16587,15 @@
 if (!__Pyx_RefNanny) {
   PyErr_Clear();
   __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
   if (!__Pyx_RefNanny)
       Py_FatalError("failed to import 'refnanny' module");
 }
 #endif
-  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_fuzz_cpp(void)", 0);
+  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_metrics_cpp(void)", 0);
   if (__Pyx_check_binary_version() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #ifdef __Pxy_PyFrame_Initialize_Offsets
   __Pxy_PyFrame_Initialize_Offsets();
   #endif
   __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -9749,22 +16625,22 @@
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   stringtab_initialized = 1;
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  if (__pyx_module_is_main_rapidfuzz__fuzz_cpp) {
+  if (__pyx_module_is_main_rapidfuzz__distance__metrics_cpp) {
     if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   }
   #if PY_MAJOR_VERSION >= 3
   {
     PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
-    if (!PyDict_GetItemString(modules, "rapidfuzz.fuzz_cpp")) {
-      if (unlikely((PyDict_SetItemString(modules, "rapidfuzz.fuzz_cpp", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
+    if (!PyDict_GetItemString(modules, "rapidfuzz.distance.metrics_cpp")) {
+      if (unlikely((PyDict_SetItemString(modules, "rapidfuzz.distance.metrics_cpp", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
     }
   }
   #endif
   /*--- Builtin init code ---*/
   if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Constants init code ---*/
   if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -9776,643 +16652,1545 @@
   if (unlikely((__Pyx_modinit_type_import_code() < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  __Pyx_TraceCall("__Pyx_PyMODINIT_FUNC PyInit_fuzz_cpp(void)", __pyx_f[0], 1, 0, __PYX_ERR(0, 1, __pyx_L1_error));
+  __Pyx_TraceCall("__Pyx_PyMODINIT_FUNC PyInit_metrics_cpp(void)", __pyx_f[0], 1, 0, __PYX_ERR(0, 1, __pyx_L1_error));
 
-  /* "rapidfuzz/fuzz_cpp.pyx":4
+  /* "rapidfuzz/distance/metrics_cpp.pyx":4
  * # cython: language_level=3, binding=True, linetrace=True
  * 
- * from .distance._initialize_cpp import ScoreAlignment             # <<<<<<<<<<<<<<
+ * from ._initialize_cpp import Editops             # <<<<<<<<<<<<<<
+ * from ._initialize_cpp cimport Editops, RfEditops
  * 
- * from rapidfuzz_capi cimport (
  */
   __Pyx_TraceLine(4,0,__PYX_ERR(0, 4, __pyx_L1_error))
   __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(__pyx_n_s_ScoreAlignment);
-  __Pyx_GIVEREF(__pyx_n_s_ScoreAlignment);
-  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_ScoreAlignment);
-  __pyx_t_3 = __Pyx_Import(__pyx_n_s_distance__initialize_cpp, __pyx_t_2, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4, __pyx_L1_error)
+  __Pyx_INCREF(__pyx_n_s_Editops);
+  __Pyx_GIVEREF(__pyx_n_s_Editops);
+  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_Editops);
+  __pyx_t_3 = __Pyx_Import(__pyx_n_s_initialize_cpp, __pyx_t_2, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_ScoreAlignment); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ScoreAlignment, __pyx_t_2) < 0) __PYX_ERR(0, 4, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":12
- * 
+  /* "rapidfuzz/distance/metrics_cpp.pyx":12
+ * )
  * # required for preprocess_strings
- * from rapidfuzz.utils import default_process             # <<<<<<<<<<<<<<
- * from array import array
- * from cpp_common cimport (
+ * from array import array             # <<<<<<<<<<<<<<
+ * from cpp_common cimport RF_StringWrapper, preprocess_strings, NoKwargsInit, CreateScorerContext
+ * 
  */
   __Pyx_TraceLine(12,0,__PYX_ERR(0, 12, __pyx_L1_error))
   __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(__pyx_n_s_default_process);
-  __Pyx_GIVEREF(__pyx_n_s_default_process);
-  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_default_process);
-  __pyx_t_2 = __Pyx_Import(__pyx_n_s_rapidfuzz_utils, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 12, __pyx_L1_error)
+  __Pyx_INCREF(__pyx_n_s_array);
+  __Pyx_GIVEREF(__pyx_n_s_array);
+  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_array);
+  __pyx_t_2 = __Pyx_Import(__pyx_n_s_array, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 12, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 12, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_default_process, __pyx_t_3) < 0) __PYX_ERR(0, 12, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_3) < 0) __PYX_ERR(0, 12, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":13
- * # required for preprocess_strings
- * from rapidfuzz.utils import default_process
- * from array import array             # <<<<<<<<<<<<<<
- * from cpp_common cimport (
- *     RF_StringWrapper, preprocess_strings, RfScoreAlignment, NoKwargsInit,
+  /* "rapidfuzz/distance/metrics_cpp.pyx":101
+ * 
+ * 
+ * cdef int64_t get_score_cutoff_i64(score_cutoff, int64_t default) except -1:             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = default
+ *     if score_cutoff is None:
+ */
+  __Pyx_TraceLine(101,0,__PYX_ERR(0, 101, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":112
+ *     return c_score_cutoff
+ * 
+ * cdef double get_score_cutoff_f64(score_cutoff, double default) except -1:             # <<<<<<<<<<<<<<
+ *     cdef double c_score_cutoff = default
+ *     if score_cutoff is None:
  */
-  __Pyx_TraceLine(13,0,__PYX_ERR(0, 13, __pyx_L1_error))
-  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 13, __pyx_L1_error)
+  __Pyx_TraceLine(112,0,__PYX_ERR(0, 112, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":123
+ *     return c_score_cutoff
+ * 
+ * cdef int64_t get_score_hint_i64(score_hint, int64_t default) except -1:             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_hint = default
+ *     if score_hint is None:
+ */
+  __Pyx_TraceLine(123,0,__PYX_ERR(0, 123, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":135
+ * 
+ * 
+ * def levenshtein_distance(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef int64_t insertion, deletion, substitution
+ */
+  __Pyx_TraceLine(135,0,__PYX_ERR(0, 135, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_INCREF(__pyx_n_s_array);
-  __Pyx_GIVEREF(__pyx_n_s_array);
-  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_array);
-  __pyx_t_3 = __Pyx_Import(__pyx_n_s_array, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 13, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_weights, ((PyObject*)__pyx_tuple__3)) < 0) __PYX_ERR(0, 135, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 135, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 135, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_1levenshtein_distance, 0, __pyx_n_s_levenshtein_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__4)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 135, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 13, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_levenshtein_distance, __pyx_t_3) < 0) __PYX_ERR(0, 135, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":147
+ * 
+ * 
+ * def levenshtein_similarity(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef int64_t insertion, deletion, substitution
+ */
+  __Pyx_TraceLine(147,0,__PYX_ERR(0, 147, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 147, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_weights, ((PyObject*)__pyx_tuple__3)) < 0) __PYX_ERR(0, 147, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 147, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 147, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_3levenshtein_similarity, 0, __pyx_n_s_levenshtein_similarity, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__5)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 147, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_levenshtein_similarity, __pyx_t_2) < 0) __PYX_ERR(0, 147, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":159
+ * 
+ * 
+ * def levenshtein_normalized_distance(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __Pyx_TraceLine(159,0,__PYX_ERR(0, 159, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 159, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_2) < 0) __PYX_ERR(0, 13, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_weights, ((PyObject*)__pyx_tuple__3)) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_5levenshtein_normalized_distance, 0, __pyx_n_s_levenshtein_normalized_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__6)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 159, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_levenshtein_normalized_distance, __pyx_t_3) < 0) __PYX_ERR(0, 159, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":23
- * from cython.operator cimport dereference
+  /* "rapidfuzz/distance/metrics_cpp.pyx":174
  * 
- * from array import array             # <<<<<<<<<<<<<<
  * 
- * cdef extern from "fuzz_cpp.hpp":
+ * def levenshtein_normalized_similarity(s1, s2, *, weights=(1,1,1), processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __Pyx_TraceLine(23,0,__PYX_ERR(0, 23, __pyx_L1_error))
-  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __Pyx_TraceLine(174,0,__PYX_ERR(0, 174, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 174, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_INCREF(__pyx_n_s_array);
-  __Pyx_GIVEREF(__pyx_n_s_array);
-  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_array);
-  __pyx_t_2 = __Pyx_Import(__pyx_n_s_array, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 23, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_weights, ((PyObject*)__pyx_tuple__3)) < 0) __PYX_ERR(0, 174, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 174, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 174, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_7levenshtein_normalized_similarity, 0, __pyx_n_s_levenshtein_normalized_similarit, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__7)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 174, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_levenshtein_normalized_similarit, __pyx_t_2) < 0) __PYX_ERR(0, 174, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":189
+ * 
+ * 
+ * def levenshtein_editops(s1, s2, *, processor=None, score_hint=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+  __Pyx_TraceLine(189,0,__PYX_ERR(0, 189, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_hint, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_9levenshtein_editops, 0, __pyx_n_s_levenshtein_editops, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 189, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_levenshtein_editops, __pyx_t_3) < 0) __PYX_ERR(0, 189, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":199
+ * 
+ * 
+ * def levenshtein_opcodes(s1, s2, *, processor=None, score_hint=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+  __Pyx_TraceLine(199,0,__PYX_ERR(0, 199, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_3) < 0) __PYX_ERR(0, 23, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 199, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_hint, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 199, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_11levenshtein_opcodes, 0, __pyx_n_s_levenshtein_opcodes, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__9)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 199, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_levenshtein_opcodes, __pyx_t_2) < 0) __PYX_ERR(0, 199, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":50
- *     bool QRatioInit(                RF_ScorerFunc*, const RF_Kwargs*, int64_t, const RF_String*) nogil except False
+  /* "rapidfuzz/distance/metrics_cpp.pyx":208
+ *     return ops.as_opcodes()
  * 
- * def ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates the normalized Indel distance.
+ * cdef void KwargsDeinit(RF_Kwargs* self):             # <<<<<<<<<<<<<<
+ *     free(<void*>dereference(self).context)
+ * 
+ */
+  __Pyx_TraceLine(208,0,__PYX_ERR(0, 208, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":211
+ *     free(<void*>dereference(self).context)
+ * 
+ * cdef bool LevenshteinKwargsInit(RF_Kwargs* self, dict kwargs) except False:             # <<<<<<<<<<<<<<
+ *     cdef int64_t insertion, deletion, substitution
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>malloc(sizeof(LevenshteinWeightTable))
+ */
+  __Pyx_TraceLine(211,0,__PYX_ERR(0, 211, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":226
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
  */
-  __Pyx_TraceLine(50,0,__PYX_ERR(0, 50, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 50, __pyx_L1_error)
+  __Pyx_TraceLine(226,0,__PYX_ERR(0, 226, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":235
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64
+ */
+  __Pyx_TraceLine(235,0,__PYX_ERR(0, 235, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":244
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ */
+  __Pyx_TraceLine(244,0,__PYX_ERR(0, 244, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":253
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     cdef LevenshteinWeightTable* weights = <LevenshteinWeightTable*>dereference(self).context
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
+ */
+  __Pyx_TraceLine(253,0,__PYX_ERR(0, 253, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":262
+ *     return True
+ * 
+ * cdef RF_Scorer LevenshteinDistanceContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinDistance, LevenshteinDistanceInit)             # <<<<<<<<<<<<<<
+ * levenshtein_distance._RF_Scorer = PyCapsule_New(&LevenshteinDistanceContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(262,0,__PYX_ERR(0, 262, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_9rapidfuzz_8distance_11metrics_cpp_LevenshteinKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinDistance, LevenshteinDistanceInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":263
+ * 
+ * cdef RF_Scorer LevenshteinDistanceContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinDistance, LevenshteinDistanceInit)
+ * levenshtein_distance._RF_Scorer = PyCapsule_New(&LevenshteinDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer LevenshteinSimilarityContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinSimilarity, LevenshteinSimilarityInit)
+ */
+  __Pyx_TraceLine(263,0,__PYX_ERR(0, 263, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 263, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_1ratio, 0, __pyx_n_s_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj_)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 50, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_levenshtein_distance); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 263, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 263, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":265
+ * levenshtein_distance._RF_Scorer = PyCapsule_New(&LevenshteinDistanceContext, NULL, NULL)
+ * 
+ * cdef RF_Scorer LevenshteinSimilarityContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinSimilarity, LevenshteinSimilarityInit)             # <<<<<<<<<<<<<<
+ * levenshtein_similarity._RF_Scorer = PyCapsule_New(&LevenshteinSimilarityContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(265,0,__PYX_ERR(0, 265, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_9rapidfuzz_8distance_11metrics_cpp_LevenshteinKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinSimilarity, LevenshteinSimilarityInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":266
+ * 
+ * cdef RF_Scorer LevenshteinSimilarityContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinSimilarity, LevenshteinSimilarityInit)
+ * levenshtein_similarity._RF_Scorer = PyCapsule_New(&LevenshteinSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer LevenshteinNormalizedDistanceContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinNormalizedDistance, LevenshteinNormalizedDistanceInit)
+ */
+  __Pyx_TraceLine(266,0,__PYX_ERR(0, 266, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 266, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_levenshtein_similarity); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 266, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 266, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":268
+ * levenshtein_similarity._RF_Scorer = PyCapsule_New(&LevenshteinSimilarityContext, NULL, NULL)
+ * 
+ * cdef RF_Scorer LevenshteinNormalizedDistanceContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinNormalizedDistance, LevenshteinNormalizedDistanceInit)             # <<<<<<<<<<<<<<
+ * levenshtein_normalized_distance._RF_Scorer = PyCapsule_New(&LevenshteinNormalizedDistanceContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(268,0,__PYX_ERR(0, 268, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinNormalizedDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_9rapidfuzz_8distance_11metrics_cpp_LevenshteinKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinNormalizedDistance, LevenshteinNormalizedDistanceInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":269
+ * 
+ * cdef RF_Scorer LevenshteinNormalizedDistanceContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinNormalizedDistance, LevenshteinNormalizedDistanceInit)
+ * levenshtein_normalized_distance._RF_Scorer = PyCapsule_New(&LevenshteinNormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer LevenshteinNormalizedSimilarityContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinNormalizedSimilarity, LevenshteinNormalizedSimilarityInit)
+ */
+  __Pyx_TraceLine(269,0,__PYX_ERR(0, 269, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinNormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 269, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_levenshtein_normalized_distance); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 269, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 269, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":271
+ * levenshtein_normalized_distance._RF_Scorer = PyCapsule_New(&LevenshteinNormalizedDistanceContext, NULL, NULL)
+ * 
+ * cdef RF_Scorer LevenshteinNormalizedSimilarityContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinNormalizedSimilarity, LevenshteinNormalizedSimilarityInit)             # <<<<<<<<<<<<<<
+ * levenshtein_normalized_distance._RF_Scorer = PyCapsule_New(&LevenshteinNormalizedSimilarityContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(271,0,__PYX_ERR(0, 271, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinNormalizedSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_9rapidfuzz_8distance_11metrics_cpp_LevenshteinKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLevenshteinNormalizedSimilarity, LevenshteinNormalizedSimilarityInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":272
+ * 
+ * cdef RF_Scorer LevenshteinNormalizedSimilarityContext = CreateScorerContext(LevenshteinKwargsInit, GetScorerFlagsLevenshteinNormalizedSimilarity, LevenshteinNormalizedSimilarityInit)
+ * levenshtein_normalized_distance._RF_Scorer = PyCapsule_New(&LevenshteinNormalizedSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(272,0,__PYX_ERR(0, 272, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_LevenshteinNormalizedSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_levenshtein_normalized_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 272, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 272, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":275
+ * 
+ * 
+ * def damerau_levenshtein_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(275,0,__PYX_ERR(0, 275, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 275, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 275, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 275, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_13damerau_levenshtein_distance, 0, __pyx_n_s_damerau_levenshtein_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__10)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 275, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_damerau_levenshtein_distance, __pyx_t_3) < 0) __PYX_ERR(0, 275, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":96
+  /* "rapidfuzz/distance/metrics_cpp.pyx":282
  * 
  * 
- * def partial_ratio(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Searches for the optimal alignment of the shorter string in the
+ * def damerau_levenshtein_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __Pyx_TraceLine(96,0,__PYX_ERR(0, 96, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 96, __pyx_L1_error)
+  __Pyx_TraceLine(282,0,__PYX_ERR(0, 282, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 282, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 96, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 96, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_3partial_ratio, 0, __pyx_n_s_partial_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__2)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 96, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_15damerau_levenshtein_similarity, 0, __pyx_n_s_damerau_levenshtein_similarity, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__11)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 282, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_partial_ratio, __pyx_t_2) < 0) __PYX_ERR(0, 96, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_damerau_levenshtein_similarity, __pyx_t_2) < 0) __PYX_ERR(0, 282, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":171
+  /* "rapidfuzz/distance/metrics_cpp.pyx":289
  * 
  * 
- * def partial_ratio_alignment(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Searches for the optimal alignment of the shorter string in the
+ * def damerau_levenshtein_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __Pyx_TraceLine(171,0,__PYX_ERR(0, 171, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 171, __pyx_L1_error)
+  __Pyx_TraceLine(289,0,__PYX_ERR(0, 289, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 289, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 171, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 171, __pyx_L1_error)
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_5partial_ratio_alignment, 0, __pyx_n_s_partial_ratio_alignment, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__3)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 171, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 289, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 289, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_17damerau_levenshtein_normalized_distance, 0, __pyx_n_s_damerau_levenshtein_normalized_d, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__12)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 289, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_partial_ratio_alignment, __pyx_t_3) < 0) __PYX_ERR(0, 171, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_damerau_levenshtein_normalized_d, __pyx_t_3) < 0) __PYX_ERR(0, 289, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":224
+  /* "rapidfuzz/distance/metrics_cpp.pyx":299
  * 
  * 
- * def token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Sorts the words in the strings and calculates the fuzz.ratio between them
+ * def damerau_levenshtein_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __Pyx_TraceLine(224,0,__PYX_ERR(0, 224, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_7token_sort_ratio, 0, __pyx_n_s_token_sort_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__4)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 224, __pyx_L1_error)
+  __Pyx_TraceLine(299,0,__PYX_ERR(0, 299, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 299, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults), 1)) __PYX_ERR(0, 224, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 224, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 299, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 299, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_19damerau_levenshtein_normalized_similarity, 0, __pyx_n_s_damerau_levenshtein_normalized_s, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__13)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 299, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_24__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_token_sort_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 224, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_damerau_levenshtein_normalized_s, __pyx_t_2) < 0) __PYX_ERR(0, 299, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":266
+  /* "rapidfuzz/distance/metrics_cpp.pyx":308
+ *     return damerau_levenshtein_normalized_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+  __Pyx_TraceLine(308,0,__PYX_ERR(0, 308, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":314
+ *     return True
  * 
- * def token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Compares the words in the strings based on unique and common words between them
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
  */
-  __Pyx_TraceLine(266,0,__PYX_ERR(0, 266, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_9token_set_ratio, 0, __pyx_n_s_token_set_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__5)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 266, __pyx_L1_error)
+  __Pyx_TraceLine(314,0,__PYX_ERR(0, 314, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":320
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+  __Pyx_TraceLine(320,0,__PYX_ERR(0, 320, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":326
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsDamerauLevenshteinNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+  __Pyx_TraceLine(326,0,__PYX_ERR(0, 326, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":332
+ *     return True
+ * 
+ * cdef RF_Scorer DamerauLevenshteinDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinDistance, DamerauLevenshteinDistanceInit)             # <<<<<<<<<<<<<<
+ * damerau_levenshtein_distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinDistanceContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(332,0,__PYX_ERR(0, 332, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinDistance, DamerauLevenshteinDistanceInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":333
+ * 
+ * cdef RF_Scorer DamerauLevenshteinDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinDistance, DamerauLevenshteinDistanceInit)
+ * damerau_levenshtein_distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer DamerauLevenshteinNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedDistance, DamerauLevenshteinNormalizedDistanceInit)
+ */
+  __Pyx_TraceLine(333,0,__PYX_ERR(0, 333, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_damerau_levenshtein_distance); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 333, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":335
+ * damerau_levenshtein_distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinDistanceContext, NULL, NULL)
+ * 
+ * cdef RF_Scorer DamerauLevenshteinNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedDistance, DamerauLevenshteinNormalizedDistanceInit)             # <<<<<<<<<<<<<<
+ * damerau_levenshtein_normalized_distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedDistanceContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(335,0,__PYX_ERR(0, 335, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinNormalizedDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinNormalizedDistance, DamerauLevenshteinNormalizedDistanceInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":336
+ * 
+ * cdef RF_Scorer DamerauLevenshteinNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedDistance, DamerauLevenshteinNormalizedDistanceInit)
+ * damerau_levenshtein_normalized_distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer DamerauLevenshteinSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinSimilarity, DamerauLevenshteinSimilarityInit)
+ */
+  __Pyx_TraceLine(336,0,__PYX_ERR(0, 336, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinNormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 336, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults1), 1)) __PYX_ERR(0, 266, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 266, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_damerau_levenshtein_normalized_d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 336, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_26__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_token_set_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 266, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 336, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":311
+  /* "rapidfuzz/distance/metrics_cpp.pyx":338
+ * damerau_levenshtein_normalized_distance._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedDistanceContext, NULL, NULL)
  * 
+ * cdef RF_Scorer DamerauLevenshteinSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinSimilarity, DamerauLevenshteinSimilarityInit)             # <<<<<<<<<<<<<<
+ * damerau_levenshtein_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinSimilarityContext, NULL, NULL)
  * 
- * def token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Helper method that returns the maximum of fuzz.token_set_ratio and fuzz.token_sort_ratio
  */
-  __Pyx_TraceLine(311,0,__PYX_ERR(0, 311, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_11token_ratio, 0, __pyx_n_s_token_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__6)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 311, __pyx_L1_error)
+  __Pyx_TraceLine(338,0,__PYX_ERR(0, 338, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinSimilarity, DamerauLevenshteinSimilarityInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":339
+ * 
+ * cdef RF_Scorer DamerauLevenshteinSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinSimilarity, DamerauLevenshteinSimilarityInit)
+ * damerau_levenshtein_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer DamerauLevenshteinNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedSimilarity, DamerauLevenshteinNormalizedSimilarityInit)
+ */
+  __Pyx_TraceLine(339,0,__PYX_ERR(0, 339, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 339, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_damerau_levenshtein_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 339, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults2), 1)) __PYX_ERR(0, 311, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 311, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 339, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":341
+ * damerau_levenshtein_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinSimilarityContext, NULL, NULL)
+ * 
+ * cdef RF_Scorer DamerauLevenshteinNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedSimilarity, DamerauLevenshteinNormalizedSimilarityInit)             # <<<<<<<<<<<<<<
+ * damerau_levenshtein_normalized_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedSimilarityContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(341,0,__PYX_ERR(0, 341, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinNormalizedSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsDamerauLevenshteinNormalizedSimilarity, DamerauLevenshteinNormalizedSimilarityInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":342
+ * 
+ * cdef RF_Scorer DamerauLevenshteinNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsDamerauLevenshteinNormalizedSimilarity, DamerauLevenshteinNormalizedSimilarityInit)
+ * damerau_levenshtein_normalized_similarity._RF_Scorer = PyCapsule_New(&DamerauLevenshteinNormalizedSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(342,0,__PYX_ERR(0, 342, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_DamerauLevenshteinNormalizedSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 342, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_damerau_levenshtein_normalized_s); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 342, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_28__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_token_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 311, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 342, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":349
+  /* "rapidfuzz/distance/metrics_cpp.pyx":345
  * 
  * 
- * def partial_token_sort_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     sorts the words in the strings and calculates the fuzz.partial_ratio between them
+ * def lcs_seq_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __Pyx_TraceLine(349,0,__PYX_ERR(0, 349, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_13partial_token_sort_ratio, 0, __pyx_n_s_partial_token_sort_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__7)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 349, __pyx_L1_error)
+  __Pyx_TraceLine(345,0,__PYX_ERR(0, 345, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 345, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 345, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 345, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_21lcs_seq_distance, 0, __pyx_n_s_lcs_seq_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__14)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 345, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults3), 1)) __PYX_ERR(0, 349, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 349, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_lcs_seq_distance, __pyx_t_3) < 0) __PYX_ERR(0, 345, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":352
+ * 
+ * 
+ * def lcs_seq_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(352,0,__PYX_ERR(0, 352, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 352, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 352, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 352, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_23lcs_seq_similarity, 0, __pyx_n_s_lcs_seq_similarity, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__15)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 352, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_30__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_partial_token_sort_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 349, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_lcs_seq_similarity, __pyx_t_2) < 0) __PYX_ERR(0, 352, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":359
+ * 
+ * 
+ * def lcs_seq_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __Pyx_TraceLine(359,0,__PYX_ERR(0, 359, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 359, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 359, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 359, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_25lcs_seq_normalized_distance, 0, __pyx_n_s_lcs_seq_normalized_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__16)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 359, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_lcs_seq_normalized_distance, __pyx_t_3) < 0) __PYX_ERR(0, 359, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":386
+  /* "rapidfuzz/distance/metrics_cpp.pyx":369
  * 
  * 
- * def partial_token_set_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Compares the words in the strings based on unique and common words between them
+ * def lcs_seq_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __Pyx_TraceLine(386,0,__PYX_ERR(0, 386, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_15partial_token_set_ratio, 0, __pyx_n_s_partial_token_set_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 386, __pyx_L1_error)
+  __Pyx_TraceLine(369,0,__PYX_ERR(0, 369, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults4), 1)) __PYX_ERR(0, 386, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 386, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 369, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 369, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_27lcs_seq_normalized_similarity, 0, __pyx_n_s_lcs_seq_normalized_similarity, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__17)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 369, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_Defaults(__pyx_defaults4, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_32__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_partial_token_set_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 386, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_lcs_seq_normalized_similarity, __pyx_t_2) < 0) __PYX_ERR(0, 369, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":379
+ * 
+ * 
+ * def lcs_seq_editops(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+  __Pyx_TraceLine(379,0,__PYX_ERR(0, 379, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 379, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 379, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_29lcs_seq_editops, 0, __pyx_n_s_lcs_seq_editops, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__18)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 379, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_lcs_seq_editops, __pyx_t_3) < 0) __PYX_ERR(0, 379, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":388
+ * 
+ * 
+ * def lcs_seq_opcodes(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+  __Pyx_TraceLine(388,0,__PYX_ERR(0, 388, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 388, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 388, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_31lcs_seq_opcodes, 0, __pyx_n_s_lcs_seq_opcodes, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__19)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 388, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_lcs_seq_opcodes, __pyx_t_2) < 0) __PYX_ERR(0, 388, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":397
+ * 
+ * 
+ * cdef bool GetScorerFlagsLCSseqDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+  __Pyx_TraceLine(397,0,__PYX_ERR(0, 397, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":403
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLCSseqNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+  __Pyx_TraceLine(403,0,__PYX_ERR(0, 403, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":409
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLCSseqSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+  __Pyx_TraceLine(409,0,__PYX_ERR(0, 409, __pyx_L1_error))
+
 
-  /* "rapidfuzz/fuzz_cpp.pyx":427
+  /* "rapidfuzz/distance/metrics_cpp.pyx":415
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsLCSseqNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+  __Pyx_TraceLine(415,0,__PYX_ERR(0, 415, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":421
+ *     return True
  * 
+ * cdef RF_Scorer LCSseqDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqDistance, LCSseqDistanceInit)             # <<<<<<<<<<<<<<
+ * lcs_seq_distance._RF_Scorer = PyCapsule_New(&LCSseqDistanceContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(421,0,__PYX_ERR(0, 421, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqDistance, LCSseqDistanceInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":422
+ * 
+ * cdef RF_Scorer LCSseqDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqDistance, LCSseqDistanceInit)
+ * lcs_seq_distance._RF_Scorer = PyCapsule_New(&LCSseqDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer LCSseqNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqNormalizedDistance, LCSseqNormalizedDistanceInit)
+ */
+  __Pyx_TraceLine(422,0,__PYX_ERR(0, 422, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 422, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_lcs_seq_distance); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 422, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 422, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":424
+ * lcs_seq_distance._RF_Scorer = PyCapsule_New(&LCSseqDistanceContext, NULL, NULL)
+ * 
+ * cdef RF_Scorer LCSseqNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqNormalizedDistance, LCSseqNormalizedDistanceInit)             # <<<<<<<<<<<<<<
+ * lcs_seq_normalized_distance._RF_Scorer = PyCapsule_New(&LCSseqNormalizedDistanceContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(424,0,__PYX_ERR(0, 424, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqNormalizedDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqNormalizedDistance, LCSseqNormalizedDistanceInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":425
+ * 
+ * cdef RF_Scorer LCSseqNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqNormalizedDistance, LCSseqNormalizedDistanceInit)
+ * lcs_seq_normalized_distance._RF_Scorer = PyCapsule_New(&LCSseqNormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer LCSseqSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqSimilarity, LCSseqSimilarityInit)
+ */
+  __Pyx_TraceLine(425,0,__PYX_ERR(0, 425, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqNormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 425, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_lcs_seq_normalized_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 425, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 425, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":427
+ * lcs_seq_normalized_distance._RF_Scorer = PyCapsule_New(&LCSseqNormalizedDistanceContext, NULL, NULL)
+ * 
+ * cdef RF_Scorer LCSseqSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqSimilarity, LCSseqSimilarityInit)             # <<<<<<<<<<<<<<
+ * lcs_seq_similarity._RF_Scorer = PyCapsule_New(&LCSseqSimilarityContext, NULL, NULL)
  * 
- * def partial_token_ratio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Helper method that returns the maximum of fuzz.partial_token_set_ratio and
  */
   __Pyx_TraceLine(427,0,__PYX_ERR(0, 427, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_17partial_token_ratio, 0, __pyx_n_s_partial_token_ratio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__9)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 427, __pyx_L1_error)
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqSimilarity, LCSseqSimilarityInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":428
+ * 
+ * cdef RF_Scorer LCSseqSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqSimilarity, LCSseqSimilarityInit)
+ * lcs_seq_similarity._RF_Scorer = PyCapsule_New(&LCSseqSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer LCSseqNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqNormalizedSimilarity, LCSseqNormalizedSimilarityInit)
+ */
+  __Pyx_TraceLine(428,0,__PYX_ERR(0, 428, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_lcs_seq_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 428, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 428, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":430
+ * lcs_seq_similarity._RF_Scorer = PyCapsule_New(&LCSseqSimilarityContext, NULL, NULL)
+ * 
+ * cdef RF_Scorer LCSseqNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqNormalizedSimilarity, LCSseqNormalizedSimilarityInit)             # <<<<<<<<<<<<<<
+ * lcs_seq_normalized_similarity._RF_Scorer = PyCapsule_New(&LCSseqNormalizedSimilarityContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(430,0,__PYX_ERR(0, 430, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqNormalizedSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsLCSseqNormalizedSimilarity, LCSseqNormalizedSimilarityInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":431
+ * 
+ * cdef RF_Scorer LCSseqNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsLCSseqNormalizedSimilarity, LCSseqNormalizedSimilarityInit)
+ * lcs_seq_normalized_similarity._RF_Scorer = PyCapsule_New(&LCSseqNormalizedSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(431,0,__PYX_ERR(0, 431, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_LCSseqNormalizedSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 431, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults5), 1)) __PYX_ERR(0, 427, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 427, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_lcs_seq_normalized_similarity); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 431, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_Defaults(__pyx_defaults5, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_34__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_partial_token_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 427, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 431, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":465
+  /* "rapidfuzz/distance/metrics_cpp.pyx":434
  * 
  * 
- * def WRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a weighted ratio based on the other ratio algorithms
+ * def indel_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
  */
-  __Pyx_TraceLine(465,0,__PYX_ERR(0, 465, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_19WRatio, 0, __pyx_n_s_WRatio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__10)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 465, __pyx_L1_error)
+  __Pyx_TraceLine(434,0,__PYX_ERR(0, 434, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 434, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 434, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 434, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_33indel_distance, 0, __pyx_n_s_indel_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__20)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 434, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults6), 1)) __PYX_ERR(0, 465, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 465, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_indel_distance, __pyx_t_3) < 0) __PYX_ERR(0, 434, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":441
+ * 
+ * 
+ * def indel_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(441,0,__PYX_ERR(0, 441, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 441, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 441, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 441, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_35indel_similarity, 0, __pyx_n_s_indel_similarity, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__21)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 441, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_Defaults(__pyx_defaults6, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_36__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_WRatio, __pyx_t_3) < 0) __PYX_ERR(0, 465, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_indel_similarity, __pyx_t_2) < 0) __PYX_ERR(0, 441, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":448
+ * 
+ * 
+ * def indel_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __Pyx_TraceLine(448,0,__PYX_ERR(0, 448, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 448, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 448, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 448, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_37indel_normalized_distance, 0, __pyx_n_s_indel_normalized_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__22)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 448, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_indel_normalized_distance, __pyx_t_3) < 0) __PYX_ERR(0, 448, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":504
- *     return WRatio_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":458
+ * 
  * 
- * def QRatio(s1, s2, *, processor=default_process, score_cutoff=None):             # <<<<<<<<<<<<<<
- *     """
- *     Calculates a quick ratio between two strings using fuzz.ratio.
+ * def indel_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __Pyx_TraceLine(504,0,__PYX_ERR(0, 504, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_21QRatio, 0, __pyx_n_s_QRatio, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__11)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 504, __pyx_L1_error)
+  __Pyx_TraceLine(458,0,__PYX_ERR(0, 458, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 458, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults7), 1)) __PYX_ERR(0, 504, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 504, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 458, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 458, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_39indel_normalized_similarity, 0, __pyx_n_s_indel_normalized_similarity, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__23)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 458, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_CyFunction_Defaults(__pyx_defaults7, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_8fuzz_cpp_38__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_QRatio, __pyx_t_3) < 0) __PYX_ERR(0, 504, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_indel_normalized_similarity, __pyx_t_2) < 0) __PYX_ERR(0, 458, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":547
+  /* "rapidfuzz/distance/metrics_cpp.pyx":468
  * 
  * 
- * cdef bool GetScorerFlagsFuzzSymmetric(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ * def indel_editops(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+  __Pyx_TraceLine(468,0,__PYX_ERR(0, 468, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 468, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 468, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_41indel_editops, 0, __pyx_n_s_indel_editops, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__24)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 468, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_indel_editops, __pyx_t_3) < 0) __PYX_ERR(0, 468, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":477
+ * 
+ * 
+ * def indel_opcodes(s1, s2, *, processor=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     cdef Editops ops = Editops.__new__(Editops)
+ */
+  __Pyx_TraceLine(477,0,__PYX_ERR(0, 477, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 477, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 477, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_43indel_opcodes, 0, __pyx_n_s_indel_opcodes, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__25)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 477, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_indel_opcodes, __pyx_t_2) < 0) __PYX_ERR(0, 477, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":486
+ * 
+ * 
+ * cdef bool GetScorerFlagsIndelDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+  __Pyx_TraceLine(486,0,__PYX_ERR(0, 486, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":493
+ * 
+ * 
+ * cdef bool GetScorerFlagsIndelNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
  *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
- *     dereference(scorer_flags).optimal_score.f64 = 100
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
  */
-  __Pyx_TraceLine(547,0,__PYX_ERR(0, 547, __pyx_L1_error))
+  __Pyx_TraceLine(493,0,__PYX_ERR(0, 493, __pyx_L1_error))
 
 
-  /* "rapidfuzz/fuzz_cpp.pyx":553
+  /* "rapidfuzz/distance/metrics_cpp.pyx":499
  *     return True
  * 
- * cdef bool GetScorerFlagsFuzz(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
- *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64
- *     dereference(scorer_flags).optimal_score.f64 = 100
+ * cdef bool GetScorerFlagsIndelSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
  */
-  __Pyx_TraceLine(553,0,__PYX_ERR(0, 553, __pyx_L1_error))
+  __Pyx_TraceLine(499,0,__PYX_ERR(0, 499, __pyx_L1_error))
 
 
-  /* "rapidfuzz/fuzz_cpp.pyx":559
- *     return True
+  /* "rapidfuzz/distance/metrics_cpp.pyx":506
+ * 
+ * 
+ * cdef bool GetScorerFlagsIndelNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+  __Pyx_TraceLine(506,0,__PYX_ERR(0, 506, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":513
+ * 
  * 
- * def _GetScorerFlagsSimilarity(**kwargs):             # <<<<<<<<<<<<<<
- *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
+ * cdef RF_Scorer IndelDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelDistance, IndelDistanceInit)             # <<<<<<<<<<<<<<
+ * indel_distance._RF_Scorer = PyCapsule_New(&IndelDistanceContext, NULL, NULL)
  * 
  */
-  __Pyx_TraceLine(559,0,__PYX_ERR(0, 559, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8fuzz_cpp_23_GetScorerFlagsSimilarity, 0, __pyx_n_s_GetScorerFlagsSimilarity, NULL, __pyx_n_s_rapidfuzz_fuzz_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__12)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 559, __pyx_L1_error)
+  __Pyx_TraceLine(513,0,__PYX_ERR(0, 513, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelDistance, IndelDistanceInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":514
+ * 
+ * cdef RF_Scorer IndelDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelDistance, IndelDistanceInit)
+ * indel_distance._RF_Scorer = PyCapsule_New(&IndelDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer IndelNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelNormalizedDistance, IndelNormalizedDistanceInit)
+ */
+  __Pyx_TraceLine(514,0,__PYX_ERR(0, 514, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 514, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_indel_distance); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 514, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_GetScorerFlagsSimilarity, __pyx_t_3) < 0) __PYX_ERR(0, 559, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 514, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":562
- *     return {"optimal_score": 100, "worst_score": 0, "flags": (1 << 5)}
+  /* "rapidfuzz/distance/metrics_cpp.pyx":516
+ * indel_distance._RF_Scorer = PyCapsule_New(&IndelDistanceContext, NULL, NULL)
  * 
- * cdef dict FuzzContextPy = CreateScorerContextPy(_GetScorerFlagsSimilarity)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer IndelNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelNormalizedDistance, IndelNormalizedDistanceInit)             # <<<<<<<<<<<<<<
+ * indel_normalized_distance._RF_Scorer = PyCapsule_New(&IndelNormalizedDistanceContext, NULL, NULL)
  * 
- * cdef RF_Scorer RatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, RatioInit)
  */
-  __Pyx_TraceLine(562,0,__PYX_ERR(0, 562, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_GetScorerFlagsSimilarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 562, __pyx_L1_error)
+  __Pyx_TraceLine(516,0,__PYX_ERR(0, 516, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelNormalizedDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelNormalizedDistance, IndelNormalizedDistanceInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":517
+ * 
+ * cdef RF_Scorer IndelNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelNormalizedDistance, IndelNormalizedDistanceInit)
+ * indel_normalized_distance._RF_Scorer = PyCapsule_New(&IndelNormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer IndelSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelSimilarity, IndelSimilarityInit)
+ */
+  __Pyx_TraceLine(517,0,__PYX_ERR(0, 517, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelNormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 517, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __pyx_f_10cpp_common_CreateScorerContextPy(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 562, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_indel_normalized_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 517, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 517, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_XGOTREF(__pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy);
-  __Pyx_DECREF_SET(__pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy, ((PyObject*)__pyx_t_2));
-  __Pyx_GIVEREF(__pyx_t_2);
-  __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":564
- * cdef dict FuzzContextPy = CreateScorerContextPy(_GetScorerFlagsSimilarity)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":519
+ * indel_normalized_distance._RF_Scorer = PyCapsule_New(&IndelNormalizedDistanceContext, NULL, NULL)
  * 
- * cdef RF_Scorer RatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, RatioInit)             # <<<<<<<<<<<<<<
- * AddScorerContext(ratio, FuzzContextPy, &RatioContext)
+ * cdef RF_Scorer IndelSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelSimilarity, IndelSimilarityInit)             # <<<<<<<<<<<<<<
+ * indel_similarity._RF_Scorer = PyCapsule_New(&IndelSimilarityContext, NULL, NULL)
  * 
  */
-  __Pyx_TraceLine(564,0,__PYX_ERR(0, 564, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8fuzz_cpp_RatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric, RatioInit);
+  __Pyx_TraceLine(519,0,__PYX_ERR(0, 519, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelSimilarity, IndelSimilarityInit);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":565
+  /* "rapidfuzz/distance/metrics_cpp.pyx":520
  * 
- * cdef RF_Scorer RatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, RatioInit)
- * AddScorerContext(ratio, FuzzContextPy, &RatioContext)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer IndelSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelSimilarity, IndelSimilarityInit)
+ * indel_similarity._RF_Scorer = PyCapsule_New(&IndelSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer PartialRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialRatioInit)
+ * cdef RF_Scorer IndelNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelNormalizedSimilarity, IndelNormalizedSimilarityInit)
  */
-  __Pyx_TraceLine(565,0,__PYX_ERR(0, 565, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_ratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 565, __pyx_L1_error)
+  __Pyx_TraceLine(520,0,__PYX_ERR(0, 520, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 520, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
-  __Pyx_INCREF(__pyx_t_3);
-  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_2, __pyx_t_3, (&__pyx_v_9rapidfuzz_8fuzz_cpp_RatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 565, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_indel_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 520, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 520, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":567
- * AddScorerContext(ratio, FuzzContextPy, &RatioContext)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":522
+ * indel_similarity._RF_Scorer = PyCapsule_New(&IndelSimilarityContext, NULL, NULL)
+ * 
+ * cdef RF_Scorer IndelNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelNormalizedSimilarity, IndelNormalizedSimilarityInit)             # <<<<<<<<<<<<<<
+ * indel_normalized_similarity._RF_Scorer = PyCapsule_New(&IndelNormalizedSimilarityContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(522,0,__PYX_ERR(0, 522, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelNormalizedSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsIndelNormalizedSimilarity, IndelNormalizedSimilarityInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":523
+ * 
+ * cdef RF_Scorer IndelNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsIndelNormalizedSimilarity, IndelNormalizedSimilarityInit)
+ * indel_normalized_similarity._RF_Scorer = PyCapsule_New(&IndelNormalizedSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer PartialRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialRatioInit)             # <<<<<<<<<<<<<<
- * AddScorerContext(partial_ratio, FuzzContextPy, &PartialRatioContext)
  * 
  */
-  __Pyx_TraceLine(567,0,__PYX_ERR(0, 567, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8fuzz_cpp_PartialRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz, PartialRatioInit);
+  __Pyx_TraceLine(523,0,__PYX_ERR(0, 523, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_IndelNormalizedSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 523, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_indel_normalized_similarity); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 523, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 523, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":568
+  /* "rapidfuzz/distance/metrics_cpp.pyx":526
  * 
- * cdef RF_Scorer PartialRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialRatioInit)
- * AddScorerContext(partial_ratio, FuzzContextPy, &PartialRatioContext)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer TokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSortRatioInit)
+ * def hamming_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(526,0,__PYX_ERR(0, 526, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 526, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 526, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 526, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_45hamming_distance, 0, __pyx_n_s_hamming_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__26)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 526, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_hamming_distance, __pyx_t_3) < 0) __PYX_ERR(0, 526, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":536
+ *     return hamming_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def hamming_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(536,0,__PYX_ERR(0, 536, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 536, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 536, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 536, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_47hamming_similarity, 0, __pyx_n_s_hamming_similarity, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__27)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_hamming_similarity, __pyx_t_2) < 0) __PYX_ERR(0, 536, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":546
+ *     return hamming_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
+ * 
+ * def hamming_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
+ */
+  __Pyx_TraceLine(546,0,__PYX_ERR(0, 546, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 546, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 546, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 546, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_49hamming_normalized_distance, 0, __pyx_n_s_hamming_normalized_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 546, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_hamming_normalized_distance, __pyx_t_3) < 0) __PYX_ERR(0, 546, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":556
+ * 
+ * 
+ * def hamming_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __Pyx_TraceLine(568,0,__PYX_ERR(0, 568, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_partial_ratio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 568, __pyx_L1_error)
+  __Pyx_TraceLine(556,0,__PYX_ERR(0, 556, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 556, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
-  __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_3, __pyx_t_2, (&__pyx_v_9rapidfuzz_8fuzz_cpp_PartialRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 568, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 556, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 556, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_51hamming_normalized_similarity, 0, __pyx_n_s_hamming_normalized_similarity, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 556, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_hamming_normalized_similarity, __pyx_t_2) < 0) __PYX_ERR(0, 556, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":570
- * AddScorerContext(partial_ratio, FuzzContextPy, &PartialRatioContext)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":566
+ * 
+ * 
+ * cdef bool GetScorerFlagsHammingDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+  __Pyx_TraceLine(566,0,__PYX_ERR(0, 566, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":572
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsHammingNormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+  __Pyx_TraceLine(572,0,__PYX_ERR(0, 572, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":578
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsHammingSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+  __Pyx_TraceLine(578,0,__PYX_ERR(0, 578, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":584
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsHammingNormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+  __Pyx_TraceLine(584,0,__PYX_ERR(0, 584, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":590
+ *     return True
  * 
- * cdef RF_Scorer TokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSortRatioInit)             # <<<<<<<<<<<<<<
- * AddScorerContext(token_sort_ratio, FuzzContextPy, &TokenSortRatioContext)
+ * cdef RF_Scorer HammingDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingDistance, HammingDistanceInit)             # <<<<<<<<<<<<<<
+ * hamming_distance._RF_Scorer = PyCapsule_New(&HammingDistanceContext, NULL, NULL)
  * 
  */
-  __Pyx_TraceLine(570,0,__PYX_ERR(0, 570, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8fuzz_cpp_TokenSortRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric, TokenSortRatioInit);
+  __Pyx_TraceLine(590,0,__PYX_ERR(0, 590, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingDistance, HammingDistanceInit);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":571
+  /* "rapidfuzz/distance/metrics_cpp.pyx":591
  * 
- * cdef RF_Scorer TokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSortRatioInit)
- * AddScorerContext(token_sort_ratio, FuzzContextPy, &TokenSortRatioContext)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer HammingDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingDistance, HammingDistanceInit)
+ * hamming_distance._RF_Scorer = PyCapsule_New(&HammingDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer TokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSetRatioInit)
+ * cdef RF_Scorer HammingNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedDistance, HammingNormalizedDistanceInit)
  */
-  __Pyx_TraceLine(571,0,__PYX_ERR(0, 571, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_token_sort_ratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 571, __pyx_L1_error)
+  __Pyx_TraceLine(591,0,__PYX_ERR(0, 591, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 591, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
-  __Pyx_INCREF(__pyx_t_3);
-  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_2, __pyx_t_3, (&__pyx_v_9rapidfuzz_8fuzz_cpp_TokenSortRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 571, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_hamming_distance); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 591, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":573
- * AddScorerContext(token_sort_ratio, FuzzContextPy, &TokenSortRatioContext)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":593
+ * hamming_distance._RF_Scorer = PyCapsule_New(&HammingDistanceContext, NULL, NULL)
  * 
- * cdef RF_Scorer TokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSetRatioInit)             # <<<<<<<<<<<<<<
- * AddScorerContext(token_set_ratio, FuzzContextPy, &TokenSetRatioContext)
+ * cdef RF_Scorer HammingNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedDistance, HammingNormalizedDistanceInit)             # <<<<<<<<<<<<<<
+ * hamming_normalized_distance._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
  * 
  */
-  __Pyx_TraceLine(573,0,__PYX_ERR(0, 573, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8fuzz_cpp_TokenSetRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric, TokenSetRatioInit);
+  __Pyx_TraceLine(593,0,__PYX_ERR(0, 593, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingNormalizedDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingNormalizedDistance, HammingNormalizedDistanceInit);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":574
+  /* "rapidfuzz/distance/metrics_cpp.pyx":594
  * 
- * cdef RF_Scorer TokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenSetRatioInit)
- * AddScorerContext(token_set_ratio, FuzzContextPy, &TokenSetRatioContext)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer HammingNormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedDistance, HammingNormalizedDistanceInit)
+ * hamming_normalized_distance._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer TokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenRatioInit)
+ * cdef RF_Scorer HammingSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingSimilarity, HammingSimilarityInit)
  */
-  __Pyx_TraceLine(574,0,__PYX_ERR(0, 574, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_token_set_ratio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 574, __pyx_L1_error)
+  __Pyx_TraceLine(594,0,__PYX_ERR(0, 594, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingNormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 594, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
-  __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_3, __pyx_t_2, (&__pyx_v_9rapidfuzz_8fuzz_cpp_TokenSetRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 574, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_hamming_normalized_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 594, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":576
- * AddScorerContext(token_set_ratio, FuzzContextPy, &TokenSetRatioContext)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":596
+ * hamming_normalized_distance._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
  * 
- * cdef RF_Scorer TokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenRatioInit)             # <<<<<<<<<<<<<<
- * AddScorerContext(token_ratio, FuzzContextPy, &TokenRatioContext)
+ * cdef RF_Scorer HammingSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingSimilarity, HammingSimilarityInit)             # <<<<<<<<<<<<<<
+ * hamming_similarity._RF_Scorer = PyCapsule_New(&HammingSimilarityContext, NULL, NULL)
  * 
  */
-  __Pyx_TraceLine(576,0,__PYX_ERR(0, 576, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8fuzz_cpp_TokenRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric, TokenRatioInit);
+  __Pyx_TraceLine(596,0,__PYX_ERR(0, 596, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingSimilarity, HammingSimilarityInit);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":577
+  /* "rapidfuzz/distance/metrics_cpp.pyx":597
  * 
- * cdef RF_Scorer TokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, TokenRatioInit)
- * AddScorerContext(token_ratio, FuzzContextPy, &TokenRatioContext)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer HammingSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingSimilarity, HammingSimilarityInit)
+ * hamming_similarity._RF_Scorer = PyCapsule_New(&HammingSimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer PartialTokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSortRatioInit)
+ * cdef RF_Scorer HammingNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedSimilarity, HammingNormalizedSimilarityInit)
  */
-  __Pyx_TraceLine(577,0,__PYX_ERR(0, 577, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_token_ratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 577, __pyx_L1_error)
+  __Pyx_TraceLine(597,0,__PYX_ERR(0, 597, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingSimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 597, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
-  __Pyx_INCREF(__pyx_t_3);
-  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_2, __pyx_t_3, (&__pyx_v_9rapidfuzz_8fuzz_cpp_TokenRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 577, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_hamming_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 597, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 597, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":579
- * AddScorerContext(token_ratio, FuzzContextPy, &TokenRatioContext)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":599
+ * hamming_similarity._RF_Scorer = PyCapsule_New(&HammingSimilarityContext, NULL, NULL)
  * 
- * cdef RF_Scorer PartialTokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSortRatioInit)             # <<<<<<<<<<<<<<
- * AddScorerContext(partial_token_sort_ratio, FuzzContextPy, &PartialTokenSortRatioContext)
+ * cdef RF_Scorer HammingNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedSimilarity, HammingNormalizedSimilarityInit)             # <<<<<<<<<<<<<<
+ * hamming_normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
  * 
  */
-  __Pyx_TraceLine(579,0,__PYX_ERR(0, 579, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSortRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz, PartialTokenSortRatioInit);
+  __Pyx_TraceLine(599,0,__PYX_ERR(0, 599, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingNormalizedSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsHammingNormalizedSimilarity, HammingNormalizedSimilarityInit);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":580
+  /* "rapidfuzz/distance/metrics_cpp.pyx":600
  * 
- * cdef RF_Scorer PartialTokenSortRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSortRatioInit)
- * AddScorerContext(partial_token_sort_ratio, FuzzContextPy, &PartialTokenSortRatioContext)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer HammingNormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsHammingNormalizedSimilarity, HammingNormalizedSimilarityInit)
+ * hamming_normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer PartialTokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSetRatioInit)
+ * def osa_distance(s1, s2, *, processor=None, score_cutoff=None):
  */
-  __Pyx_TraceLine(580,0,__PYX_ERR(0, 580, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_partial_token_sort_ratio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 580, __pyx_L1_error)
+  __Pyx_TraceLine(600,0,__PYX_ERR(0, 600, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_HammingNormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
-  __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_3, __pyx_t_2, (&__pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSortRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 580, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_hamming_normalized_similarity); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 600, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 600, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":582
- * AddScorerContext(partial_token_sort_ratio, FuzzContextPy, &PartialTokenSortRatioContext)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":602
+ * hamming_normalized_similarity._RF_Scorer = PyCapsule_New(&HammingNormalizedDistanceContext, NULL, NULL)
+ * 
+ * def osa_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, INT64_MAX)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(602,0,__PYX_ERR(0, 602, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 602, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 602, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 602, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_53osa_distance, 0, __pyx_n_s_osa_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 602, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_osa_distance, __pyx_t_3) < 0) __PYX_ERR(0, 602, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":612
+ *     return osa_distance_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
- * cdef RF_Scorer PartialTokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSetRatioInit)             # <<<<<<<<<<<<<<
- * AddScorerContext(partial_token_set_ratio, FuzzContextPy, &PartialTokenSetRatioContext)
+ * def osa_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, 0)
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ */
+  __Pyx_TraceLine(612,0,__PYX_ERR(0, 612, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 612, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 612, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 612, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_55osa_similarity, 0, __pyx_n_s_osa_similarity, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 612, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_osa_similarity, __pyx_t_2) < 0) __PYX_ERR(0, 612, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":622
+ *     return osa_similarity_func(s1_proc.string, s2_proc.string, c_score_cutoff)
  * 
+ * def osa_normalized_distance(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __Pyx_TraceLine(582,0,__PYX_ERR(0, 582, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSetRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz, PartialTokenSetRatioInit);
+  __Pyx_TraceLine(622,0,__PYX_ERR(0, 622, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 622, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 622, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 622, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_57osa_normalized_distance, 0, __pyx_n_s_osa_normalized_distance, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 622, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_osa_normalized_distance, __pyx_t_3) < 0) __PYX_ERR(0, 622, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":583
+  /* "rapidfuzz/distance/metrics_cpp.pyx":632
  * 
- * cdef RF_Scorer PartialTokenSetRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenSetRatioInit)
- * AddScorerContext(partial_token_set_ratio, FuzzContextPy, &PartialTokenSetRatioContext)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer PartialTokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenRatioInit)
+ * def osa_normalized_similarity(s1, s2, *, processor=None, score_cutoff=None):             # <<<<<<<<<<<<<<
+ *     cdef RF_StringWrapper s1_proc, s2_proc
+ *     if s1 is None or s2 is None:
  */
-  __Pyx_TraceLine(583,0,__PYX_ERR(0, 583, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_partial_token_set_ratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 583, __pyx_L1_error)
+  __Pyx_TraceLine(632,0,__PYX_ERR(0, 632, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 632, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 632, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 632, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_8distance_11metrics_cpp_59osa_normalized_similarity, 0, __pyx_n_s_osa_normalized_similarity, NULL, __pyx_n_s_rapidfuzz_distance_metrics_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 632, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
-  __Pyx_INCREF(__pyx_t_3);
-  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_2, __pyx_t_3, (&__pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenSetRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 583, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_osa_normalized_similarity, __pyx_t_2) < 0) __PYX_ERR(0, 632, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":642
+ * 
+ * 
+ * cdef bool GetScorerFlagsOSADistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = 0
+ */
+  __Pyx_TraceLine(642,0,__PYX_ERR(0, 642, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":648
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsOSANormalizedDistance(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 0.0
+ */
+  __Pyx_TraceLine(648,0,__PYX_ERR(0, 648, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":654
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsOSASimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_I64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.i64 = INT64_MAX
+ */
+  __Pyx_TraceLine(654,0,__PYX_ERR(0, 654, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":660
+ *     return True
+ * 
+ * cdef bool GetScorerFlagsOSANormalizedSimilarity(const RF_Kwargs* self, RF_ScorerFlags* scorer_flags) nogil except False:             # <<<<<<<<<<<<<<
+ *     dereference(scorer_flags).flags = RF_SCORER_FLAG_RESULT_F64 | RF_SCORER_FLAG_SYMMETRIC
+ *     dereference(scorer_flags).optimal_score.f64 = 1.0
+ */
+  __Pyx_TraceLine(660,0,__PYX_ERR(0, 660, __pyx_L1_error))
+
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":666
+ *     return True
+ * 
+ * cdef RF_Scorer OSADistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSADistance, OSADistanceInit)             # <<<<<<<<<<<<<<
+ * osa_distance._RF_Scorer = PyCapsule_New(&OSADistanceContext, NULL, NULL)
+ * 
+ */
+  __Pyx_TraceLine(666,0,__PYX_ERR(0, 666, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSADistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSADistance, OSADistanceInit);
+
+  /* "rapidfuzz/distance/metrics_cpp.pyx":667
+ * 
+ * cdef RF_Scorer OSADistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSADistance, OSADistanceInit)
+ * osa_distance._RF_Scorer = PyCapsule_New(&OSADistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
+ * 
+ * cdef RF_Scorer OSANormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSANormalizedDistance, OSANormalizedDistanceInit)
+ */
+  __Pyx_TraceLine(667,0,__PYX_ERR(0, 667, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSADistanceContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 667, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_osa_distance); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 667, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 667, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":585
- * AddScorerContext(partial_token_set_ratio, FuzzContextPy, &PartialTokenSetRatioContext)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":669
+ * osa_distance._RF_Scorer = PyCapsule_New(&OSADistanceContext, NULL, NULL)
  * 
- * cdef RF_Scorer PartialTokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenRatioInit)             # <<<<<<<<<<<<<<
- * AddScorerContext(partial_token_ratio, FuzzContextPy, &PartialTokenRatioContext)
+ * cdef RF_Scorer OSANormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSANormalizedDistance, OSANormalizedDistanceInit)             # <<<<<<<<<<<<<<
+ * osa_normalized_distance._RF_Scorer = PyCapsule_New(&OSANormalizedDistanceContext, NULL, NULL)
  * 
  */
-  __Pyx_TraceLine(585,0,__PYX_ERR(0, 585, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz, PartialTokenRatioInit);
+  __Pyx_TraceLine(669,0,__PYX_ERR(0, 669, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSANormalizedDistanceContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSANormalizedDistance, OSANormalizedDistanceInit);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":586
+  /* "rapidfuzz/distance/metrics_cpp.pyx":670
  * 
- * cdef RF_Scorer PartialTokenRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, PartialTokenRatioInit)
- * AddScorerContext(partial_token_ratio, FuzzContextPy, &PartialTokenRatioContext)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer OSANormalizedDistanceContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSANormalizedDistance, OSANormalizedDistanceInit)
+ * osa_normalized_distance._RF_Scorer = PyCapsule_New(&OSANormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer WRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, WRatioInit)
+ * cdef RF_Scorer OSASimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSASimilarity, OSASimilarityInit)
  */
-  __Pyx_TraceLine(586,0,__PYX_ERR(0, 586, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_partial_token_ratio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 586, __pyx_L1_error)
+  __Pyx_TraceLine(670,0,__PYX_ERR(0, 670, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSANormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 670, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
-  __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_3, __pyx_t_2, (&__pyx_v_9rapidfuzz_8fuzz_cpp_PartialTokenRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 586, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_osa_normalized_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 670, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 670, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":588
- * AddScorerContext(partial_token_ratio, FuzzContextPy, &PartialTokenRatioContext)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":672
+ * osa_normalized_distance._RF_Scorer = PyCapsule_New(&OSANormalizedDistanceContext, NULL, NULL)
  * 
- * cdef RF_Scorer WRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, WRatioInit)             # <<<<<<<<<<<<<<
- * AddScorerContext(WRatio, FuzzContextPy, &WRatioContext)
+ * cdef RF_Scorer OSASimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSASimilarity, OSASimilarityInit)             # <<<<<<<<<<<<<<
+ * osa_similarity._RF_Scorer = PyCapsule_New(&OSASimilarityContext, NULL, NULL)
  * 
  */
-  __Pyx_TraceLine(588,0,__PYX_ERR(0, 588, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8fuzz_cpp_WRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzz, WRatioInit);
+  __Pyx_TraceLine(672,0,__PYX_ERR(0, 672, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSASimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSASimilarity, OSASimilarityInit);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":589
+  /* "rapidfuzz/distance/metrics_cpp.pyx":673
  * 
- * cdef RF_Scorer WRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzz, WRatioInit)
- * AddScorerContext(WRatio, FuzzContextPy, &WRatioContext)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer OSASimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSASimilarity, OSASimilarityInit)
+ * osa_similarity._RF_Scorer = PyCapsule_New(&OSASimilarityContext, NULL, NULL)             # <<<<<<<<<<<<<<
  * 
- * cdef RF_Scorer QRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, QRatioInit)
+ * cdef RF_Scorer OSANormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSANormalizedSimilarity, OSANormalizedSimilarityInit)
  */
-  __Pyx_TraceLine(589,0,__PYX_ERR(0, 589, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_WRatio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 589, __pyx_L1_error)
+  __Pyx_TraceLine(673,0,__PYX_ERR(0, 673, __pyx_L1_error))
+  __pyx_t_2 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSASimilarityContext), NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 673, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
-  __Pyx_INCREF(__pyx_t_3);
-  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_2, __pyx_t_3, (&__pyx_v_9rapidfuzz_8fuzz_cpp_WRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 589, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_osa_similarity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 673, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_3, __pyx_n_s_RF_Scorer, __pyx_t_2) < 0) __PYX_ERR(0, 673, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":591
- * AddScorerContext(WRatio, FuzzContextPy, &WRatioContext)
+  /* "rapidfuzz/distance/metrics_cpp.pyx":675
+ * osa_similarity._RF_Scorer = PyCapsule_New(&OSASimilarityContext, NULL, NULL)
  * 
- * cdef RF_Scorer QRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, QRatioInit)             # <<<<<<<<<<<<<<
- * AddScorerContext(QRatio, FuzzContextPy, &QRatioContext)
+ * cdef RF_Scorer OSANormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSANormalizedSimilarity, OSANormalizedSimilarityInit)             # <<<<<<<<<<<<<<
+ * osa_normalized_similarity._RF_Scorer = PyCapsule_New(&OSANormalizedDistanceContext, NULL, NULL)
  */
-  __Pyx_TraceLine(591,0,__PYX_ERR(0, 591, __pyx_L1_error))
-  __pyx_v_9rapidfuzz_8fuzz_cpp_QRatioContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8fuzz_cpp_GetScorerFlagsFuzzSymmetric, QRatioInit);
+  __Pyx_TraceLine(675,0,__PYX_ERR(0, 675, __pyx_L1_error))
+  __pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSANormalizedSimilarityContext = __pyx_f_10cpp_common_CreateScorerContext(__pyx_f_10cpp_common_NoKwargsInit, __pyx_f_9rapidfuzz_8distance_11metrics_cpp_GetScorerFlagsOSANormalizedSimilarity, OSANormalizedSimilarityInit);
 
-  /* "rapidfuzz/fuzz_cpp.pyx":592
+  /* "rapidfuzz/distance/metrics_cpp.pyx":676
  * 
- * cdef RF_Scorer QRatioContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsFuzzSymmetric, QRatioInit)
- * AddScorerContext(QRatio, FuzzContextPy, &QRatioContext)             # <<<<<<<<<<<<<<
+ * cdef RF_Scorer OSANormalizedSimilarityContext = CreateScorerContext(NoKwargsInit, GetScorerFlagsOSANormalizedSimilarity, OSANormalizedSimilarityInit)
+ * osa_normalized_similarity._RF_Scorer = PyCapsule_New(&OSANormalizedDistanceContext, NULL, NULL)             # <<<<<<<<<<<<<<
  */
-  __Pyx_TraceLine(592,0,__PYX_ERR(0, 592, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_QRatio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 592, __pyx_L1_error)
+  __Pyx_TraceLine(676,0,__PYX_ERR(0, 676, __pyx_L1_error))
+  __pyx_t_3 = PyCapsule_New((&__pyx_v_9rapidfuzz_8distance_11metrics_cpp_OSANormalizedDistanceContext), NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 676, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __pyx_v_9rapidfuzz_8fuzz_cpp_FuzzContextPy;
-  __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_4 = __pyx_f_10cpp_common_AddScorerContext(__pyx_t_3, __pyx_t_2, (&__pyx_v_9rapidfuzz_8fuzz_cpp_QRatioContext)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 592, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_osa_normalized_similarity); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 676, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_t_2, __pyx_n_s_RF_Scorer, __pyx_t_3) < 0) __PYX_ERR(0, 676, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/fuzz_cpp.pyx":1
+  /* "rapidfuzz/distance/metrics_cpp.pyx":1
  * # distutils: language=c++             # <<<<<<<<<<<<<<
  * # cython: language_level=3, binding=True, linetrace=True
  * 
  */
   __Pyx_TraceLine(1,0,__PYX_ERR(0, 1, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyDict_NewPresized(6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_ratio_line_50, __pyx_kp_u_Calculates_the_normalized_Indel) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_partial_ratio_line_96, __pyx_kp_u_Searches_for_the_optimal_alignm) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_partial_ratio_alignment_line_171, __pyx_kp_u_Searches_for_the_optimal_alignm_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_token_sort_ratio_line_224, __pyx_kp_u_Sorts_the_words_in_the_strings) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_token_set_ratio_line_266, __pyx_kp_u_Compares_the_words_in_the_strin) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_QRatio_line_504, __pyx_kp_u_Calculates_a_quick_ratio_betwee) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /* "cpp_common.pxd":242
  *     void validate_string(object py_str, const char* err) except +
  * 
  * cdef inline RF_String hash_array(arr) except *:             # <<<<<<<<<<<<<<
@@ -10517,21 +18295,21 @@
 
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   if (__pyx_m) {
     if (__pyx_d && stringtab_initialized) {
-      __Pyx_AddTraceback("init rapidfuzz.fuzz_cpp", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      __Pyx_AddTraceback("init rapidfuzz.distance.metrics_cpp", __pyx_clineno, __pyx_lineno, __pyx_filename);
     }
     #if !CYTHON_USE_MODULE_STATE
     Py_CLEAR(__pyx_m);
     #endif
   } else if (!PyErr_Occurred()) {
-    PyErr_SetString(PyExc_ImportError, "init rapidfuzz.fuzz_cpp");
+    PyErr_SetString(PyExc_ImportError, "init rapidfuzz.distance.metrics_cpp");
   }
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   return (__pyx_m != NULL) ? 0 : -1;
   #elif PY_MAJOR_VERSION >= 3
   return __pyx_m;
@@ -10570,14 +18348,382 @@
 end:
     Py_XDECREF(p);
     Py_XDECREF(m);
     return (__Pyx_RefNannyAPIStruct *)r;
 }
 #endif
 
+/* PyErrExceptionMatches */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
+    Py_ssize_t i, n;
+    n = PyTuple_GET_SIZE(tuple);
+#if PY_MAJOR_VERSION >= 3
+    for (i=0; i<n; i++) {
+        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
+    }
+#endif
+    for (i=0; i<n; i++) {
+        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
+    }
+    return 0;
+}
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
+    PyObject *exc_type = tstate->curexc_type;
+    if (exc_type == err) return 1;
+    if (unlikely(!exc_type)) return 0;
+    if (unlikely(PyTuple_Check(err)))
+        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
+    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
+}
+#endif
+
+/* PyErrFetchRestore */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    tmp_type = tstate->curexc_type;
+    tmp_value = tstate->curexc_value;
+    tmp_tb = tstate->curexc_traceback;
+    tstate->curexc_type = type;
+    tstate->curexc_value = value;
+    tstate->curexc_traceback = tb;
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+}
+static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+    *type = tstate->curexc_type;
+    *value = tstate->curexc_value;
+    *tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+}
+#endif
+
+/* PyObjectGetAttrStr */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro))
+        return tp->tp_getattro(obj, attr_name);
+#if PY_MAJOR_VERSION < 3
+    if (likely(tp->tp_getattr))
+        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
+#endif
+    return PyObject_GetAttr(obj, attr_name);
+}
+#endif
+
+/* PyObjectGetAttrStrNoError */
+static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
+        __Pyx_PyErr_Clear();
+}
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
+    PyObject *result;
+#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
+        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
+    }
+#endif
+    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
+    if (unlikely(!result)) {
+        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
+    }
+    return result;
+}
+
+/* GetBuiltinName */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
+    PyObject* result = __Pyx_PyObject_GetAttrStrNoError(__pyx_b, name);
+    if (unlikely(!result) && !PyErr_Occurred()) {
+        PyErr_Format(PyExc_NameError,
+#if PY_MAJOR_VERSION >= 3
+            "name '%U' is not defined", name);
+#else
+            "name '%.200s' is not defined", PyString_AS_STRING(name));
+#endif
+    }
+    return result;
+}
+
+/* Profile */
+#if CYTHON_PROFILE
+static int __Pyx_TraceSetupAndCall(PyCodeObject** code,
+                                   PyFrameObject** frame,
+                                   PyThreadState* tstate,
+                                   const char *funcname,
+                                   const char *srcfile,
+                                   int firstlineno) {
+    PyObject *type, *value, *traceback;
+    int retval;
+    if (*frame == NULL || !CYTHON_PROFILE_REUSE_FRAME) {
+        if (*code == NULL) {
+            *code = __Pyx_createFrameCodeObject(funcname, srcfile, firstlineno);
+            if (*code == NULL) return 0;
+        }
+        *frame = PyFrame_New(
+            tstate,                          /*PyThreadState *tstate*/
+            *code,                           /*PyCodeObject *code*/
+            __pyx_d,                  /*PyObject *globals*/
+            0                                /*PyObject *locals*/
+        );
+        if (*frame == NULL) return 0;
+        if (CYTHON_TRACE && (*frame)->f_trace == NULL) {
+            Py_INCREF(Py_None);
+            (*frame)->f_trace = Py_None;
+        }
+#if PY_VERSION_HEX < 0x030400B1
+    } else {
+        (*frame)->f_tstate = tstate;
+#endif
+    }
+    __Pyx_PyFrame_SetLineNumber(*frame, firstlineno);
+    retval = 1;
+    __Pyx_EnterTracing(tstate);
+    __Pyx_ErrFetchInState(tstate, &type, &value, &traceback);
+    #if CYTHON_TRACE
+    if (tstate->c_tracefunc)
+        retval = tstate->c_tracefunc(tstate->c_traceobj, *frame, PyTrace_CALL, NULL) == 0;
+    if (retval && tstate->c_profilefunc)
+    #endif
+        retval = tstate->c_profilefunc(tstate->c_profileobj, *frame, PyTrace_CALL, NULL) == 0;
+    __Pyx_LeaveTracing(tstate);
+    if (retval) {
+        __Pyx_ErrRestoreInState(tstate, type, value, traceback);
+        return __Pyx_IsTracing(tstate, 0, 0) && retval;
+    } else {
+        Py_XDECREF(type);
+        Py_XDECREF(value);
+        Py_XDECREF(traceback);
+        return -1;
+    }
+}
+static PyCodeObject *__Pyx_createFrameCodeObject(const char *funcname, const char *srcfile, int firstlineno) {
+    PyCodeObject *py_code = 0;
+#if PY_MAJOR_VERSION >= 3
+    py_code = PyCode_NewEmpty(srcfile, funcname, firstlineno);
+    if (likely(py_code)) {
+        py_code->co_flags |= CO_OPTIMIZED | CO_NEWLOCALS;
+    }
+#else
+    PyObject *py_srcfile = 0;
+    PyObject *py_funcname = 0;
+    py_funcname = PyString_FromString(funcname);
+    if (unlikely(!py_funcname)) goto bad;
+    py_srcfile = PyString_FromString(srcfile);
+    if (unlikely(!py_srcfile)) goto bad;
+    py_code = PyCode_New(
+        0,
+        0,
+        0,
+        CO_OPTIMIZED | CO_NEWLOCALS,
+        __pyx_empty_bytes,     /*PyObject *code,*/
+        __pyx_empty_tuple,     /*PyObject *consts,*/
+        __pyx_empty_tuple,     /*PyObject *names,*/
+        __pyx_empty_tuple,     /*PyObject *varnames,*/
+        __pyx_empty_tuple,     /*PyObject *freevars,*/
+        __pyx_empty_tuple,     /*PyObject *cellvars,*/
+        py_srcfile,       /*PyObject *filename,*/
+        py_funcname,      /*PyObject *name,*/
+        firstlineno,
+        __pyx_empty_bytes      /*PyObject *lnotab*/
+    );
+bad:
+    Py_XDECREF(py_srcfile);
+    Py_XDECREF(py_funcname);
+#endif
+    return py_code;
+}
+#endif
+
+/* PyObjectCall */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
+    PyObject *result;
+    ternaryfunc call = Py_TYPE(func)->tp_call;
+    if (unlikely(!call))
+        return PyObject_Call(func, arg, kw);
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
+        return NULL;
+    result = (*call)(func, arg, kw);
+    Py_LeaveRecursiveCall();
+    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
+        PyErr_SetString(
+            PyExc_SystemError,
+            "NULL result without error in PyObject_Call");
+    }
+    return result;
+}
+#endif
+
+/* RaiseException */
+#if PY_MAJOR_VERSION < 3
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
+    __Pyx_PyThreadState_declare
+    CYTHON_UNUSED_VAR(cause);
+    Py_XINCREF(type);
+    if (!value || value == Py_None)
+        value = NULL;
+    else
+        Py_INCREF(value);
+    if (!tb || tb == Py_None)
+        tb = NULL;
+    else {
+        Py_INCREF(tb);
+        if (!PyTraceBack_Check(tb)) {
+            PyErr_SetString(PyExc_TypeError,
+                "raise: arg 3 must be a traceback or None");
+            goto raise_error;
+        }
+    }
+    if (PyType_Check(type)) {
+#if CYTHON_COMPILING_IN_PYPY
+        if (!value) {
+            Py_INCREF(Py_None);
+            value = Py_None;
+        }
+#endif
+        PyErr_NormalizeException(&type, &value, &tb);
+    } else {
+        if (value) {
+            PyErr_SetString(PyExc_TypeError,
+                "instance exception may not have a separate value");
+            goto raise_error;
+        }
+        value = type;
+        type = (PyObject*) Py_TYPE(type);
+        Py_INCREF(type);
+        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
+            PyErr_SetString(PyExc_TypeError,
+                "raise: exception class must be a subclass of BaseException");
+            goto raise_error;
+        }
+    }
+    __Pyx_PyThreadState_assign
+    __Pyx_ErrRestore(type, value, tb);
+    return;
+raise_error:
+    Py_XDECREF(value);
+    Py_XDECREF(type);
+    Py_XDECREF(tb);
+    return;
+}
+#else
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
+    PyObject* owned_instance = NULL;
+    if (tb == Py_None) {
+        tb = 0;
+    } else if (tb && !PyTraceBack_Check(tb)) {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: arg 3 must be a traceback or None");
+        goto bad;
+    }
+    if (value == Py_None)
+        value = 0;
+    if (PyExceptionInstance_Check(type)) {
+        if (value) {
+            PyErr_SetString(PyExc_TypeError,
+                "instance exception may not have a separate value");
+            goto bad;
+        }
+        value = type;
+        type = (PyObject*) Py_TYPE(value);
+    } else if (PyExceptionClass_Check(type)) {
+        PyObject *instance_class = NULL;
+        if (value && PyExceptionInstance_Check(value)) {
+            instance_class = (PyObject*) Py_TYPE(value);
+            if (instance_class != type) {
+                int is_subclass = PyObject_IsSubclass(instance_class, type);
+                if (!is_subclass) {
+                    instance_class = NULL;
+                } else if (unlikely(is_subclass == -1)) {
+                    goto bad;
+                } else {
+                    type = instance_class;
+                }
+            }
+        }
+        if (!instance_class) {
+            PyObject *args;
+            if (!value)
+                args = PyTuple_New(0);
+            else if (PyTuple_Check(value)) {
+                Py_INCREF(value);
+                args = value;
+            } else
+                args = PyTuple_Pack(1, value);
+            if (!args)
+                goto bad;
+            owned_instance = PyObject_Call(type, args, NULL);
+            Py_DECREF(args);
+            if (!owned_instance)
+                goto bad;
+            value = owned_instance;
+            if (!PyExceptionInstance_Check(value)) {
+                PyErr_Format(PyExc_TypeError,
+                             "calling %R should have returned an instance of "
+                             "BaseException, not %R",
+                             type, Py_TYPE(value));
+                goto bad;
+            }
+        }
+    } else {
+        PyErr_SetString(PyExc_TypeError,
+            "raise: exception class must be a subclass of BaseException");
+        goto bad;
+    }
+    if (cause) {
+        PyObject *fixed_cause;
+        if (cause == Py_None) {
+            fixed_cause = NULL;
+        } else if (PyExceptionClass_Check(cause)) {
+            fixed_cause = PyObject_CallObject(cause, NULL);
+            if (fixed_cause == NULL)
+                goto bad;
+        } else if (PyExceptionInstance_Check(cause)) {
+            fixed_cause = cause;
+            Py_INCREF(fixed_cause);
+        } else {
+            PyErr_SetString(PyExc_TypeError,
+                            "exception causes must derive from "
+                            "BaseException");
+            goto bad;
+        }
+        PyException_SetCause(value, fixed_cause);
+    }
+    PyErr_SetObject(type, value);
+    if (tb) {
+#if CYTHON_COMPILING_IN_PYPY ||  CYTHON_COMPILING_IN_LIMITED_API
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
+#else
+        PyThreadState *tstate = __Pyx_PyThreadState_Current;
+        PyObject* tmp_tb = tstate->curexc_traceback;
+        if (tb != tmp_tb) {
+            Py_INCREF(tb);
+            tstate->curexc_traceback = tb;
+            Py_XDECREF(tmp_tb);
+        }
+#endif
+    }
+bad:
+    Py_XDECREF(owned_instance);
+    return;
+}
+#endif
+
 /* TupleAndListFromArray */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE void __Pyx_copy_object_array(PyObject *const *CYTHON_RESTRICT src, PyObject** CYTHON_RESTRICT dest, Py_ssize_t length) {
     PyObject *v;
     Py_ssize_t i;
     for (i = 0; i < length; i++) {
         v = dest[i] = src[i];
@@ -10933,270 +19079,90 @@
         "%s() got an unexpected keyword argument '%U'",
         function_name, key);
     #endif
 bad:
     return -1;
 }
 
-/* PyErrFetchRestore */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    tmp_type = tstate->curexc_type;
-    tmp_value = tstate->curexc_value;
-    tmp_tb = tstate->curexc_traceback;
-    tstate->curexc_type = type;
-    tstate->curexc_value = value;
-    tstate->curexc_traceback = tb;
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    *type = tstate->curexc_type;
-    *value = tstate->curexc_value;
-    *tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
+/* RaiseTooManyValuesToUnpack */
+static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
+    PyErr_Format(PyExc_ValueError,
+                 "too many values to unpack (expected %" CYTHON_FORMAT_SSIZE_T "d)", expected);
 }
-#endif
 
-/* Profile */
-#if CYTHON_PROFILE
-static int __Pyx_TraceSetupAndCall(PyCodeObject** code,
-                                   PyFrameObject** frame,
-                                   PyThreadState* tstate,
-                                   const char *funcname,
-                                   const char *srcfile,
-                                   int firstlineno) {
-    PyObject *type, *value, *traceback;
-    int retval;
-    if (*frame == NULL || !CYTHON_PROFILE_REUSE_FRAME) {
-        if (*code == NULL) {
-            *code = __Pyx_createFrameCodeObject(funcname, srcfile, firstlineno);
-            if (*code == NULL) return 0;
-        }
-        *frame = PyFrame_New(
-            tstate,                          /*PyThreadState *tstate*/
-            *code,                           /*PyCodeObject *code*/
-            __pyx_d,                  /*PyObject *globals*/
-            0                                /*PyObject *locals*/
-        );
-        if (*frame == NULL) return 0;
-        if (CYTHON_TRACE && (*frame)->f_trace == NULL) {
-            Py_INCREF(Py_None);
-            (*frame)->f_trace = Py_None;
-        }
-#if PY_VERSION_HEX < 0x030400B1
-    } else {
-        (*frame)->f_tstate = tstate;
-#endif
-    }
-    __Pyx_PyFrame_SetLineNumber(*frame, firstlineno);
-    retval = 1;
-    __Pyx_EnterTracing(tstate);
-    __Pyx_ErrFetchInState(tstate, &type, &value, &traceback);
-    #if CYTHON_TRACE
-    if (tstate->c_tracefunc)
-        retval = tstate->c_tracefunc(tstate->c_traceobj, *frame, PyTrace_CALL, NULL) == 0;
-    if (retval && tstate->c_profilefunc)
-    #endif
-        retval = tstate->c_profilefunc(tstate->c_profileobj, *frame, PyTrace_CALL, NULL) == 0;
-    __Pyx_LeaveTracing(tstate);
-    if (retval) {
-        __Pyx_ErrRestoreInState(tstate, type, value, traceback);
-        return __Pyx_IsTracing(tstate, 0, 0) && retval;
-    } else {
-        Py_XDECREF(type);
-        Py_XDECREF(value);
-        Py_XDECREF(traceback);
-        return -1;
-    }
+/* RaiseNeedMoreValuesToUnpack */
+static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
+    PyErr_Format(PyExc_ValueError,
+                 "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
+                 index, (index == 1) ? "" : "s");
 }
-static PyCodeObject *__Pyx_createFrameCodeObject(const char *funcname, const char *srcfile, int firstlineno) {
-    PyCodeObject *py_code = 0;
-#if PY_MAJOR_VERSION >= 3
-    py_code = PyCode_NewEmpty(srcfile, funcname, firstlineno);
-    if (likely(py_code)) {
-        py_code->co_flags |= CO_OPTIMIZED | CO_NEWLOCALS;
-    }
-#else
-    PyObject *py_srcfile = 0;
-    PyObject *py_funcname = 0;
-    py_funcname = PyString_FromString(funcname);
-    if (unlikely(!py_funcname)) goto bad;
-    py_srcfile = PyString_FromString(srcfile);
-    if (unlikely(!py_srcfile)) goto bad;
-    py_code = PyCode_New(
-        0,
-        0,
-        0,
-        CO_OPTIMIZED | CO_NEWLOCALS,
-        __pyx_empty_bytes,     /*PyObject *code,*/
-        __pyx_empty_tuple,     /*PyObject *consts,*/
-        __pyx_empty_tuple,     /*PyObject *names,*/
-        __pyx_empty_tuple,     /*PyObject *varnames,*/
-        __pyx_empty_tuple,     /*PyObject *freevars,*/
-        __pyx_empty_tuple,     /*PyObject *cellvars,*/
-        py_srcfile,       /*PyObject *filename,*/
-        py_funcname,      /*PyObject *name,*/
-        firstlineno,
-        __pyx_empty_bytes      /*PyObject *lnotab*/
-    );
-bad:
-    Py_XDECREF(py_srcfile);
-    Py_XDECREF(py_funcname);
-#endif
-    return py_code;
-}
-#endif
 
-/* PyErrExceptionMatches */
+/* IterFinish */
+static CYTHON_INLINE int __Pyx_IterFinish(void) {
 #if CYTHON_FAST_THREAD_STATE
-static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
-    Py_ssize_t i, n;
-    n = PyTuple_GET_SIZE(tuple);
-#if PY_MAJOR_VERSION >= 3
-    for (i=0; i<n; i++) {
-        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
-    }
-#endif
-    for (i=0; i<n; i++) {
-        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
+    PyThreadState *tstate = __Pyx_PyThreadState_Current;
+    PyObject* exc_type = tstate->curexc_type;
+    if (unlikely(exc_type)) {
+        if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) {
+            PyObject *exc_value, *exc_tb;
+            exc_value = tstate->curexc_value;
+            exc_tb = tstate->curexc_traceback;
+            tstate->curexc_type = 0;
+            tstate->curexc_value = 0;
+            tstate->curexc_traceback = 0;
+            Py_DECREF(exc_type);
+            Py_XDECREF(exc_value);
+            Py_XDECREF(exc_tb);
+            return 0;
+        } else {
+            return -1;
+        }
     }
     return 0;
-}
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
-    PyObject *exc_type = tstate->curexc_type;
-    if (exc_type == err) return 1;
-    if (unlikely(!exc_type)) return 0;
-    if (unlikely(PyTuple_Check(err)))
-        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
-    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
-}
-#endif
-
-/* PyObjectGetAttrStr */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
-    PyTypeObject* tp = Py_TYPE(obj);
-    if (likely(tp->tp_getattro))
-        return tp->tp_getattro(obj, attr_name);
-#if PY_MAJOR_VERSION < 3
-    if (likely(tp->tp_getattr))
-        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
-#endif
-    return PyObject_GetAttr(obj, attr_name);
-}
-#endif
-
-/* PyObjectGetAttrStrNoError */
-static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
-        __Pyx_PyErr_Clear();
-}
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
-    PyObject *result;
-#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
-    PyTypeObject* tp = Py_TYPE(obj);
-    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
-        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
+#else
+    if (unlikely(PyErr_Occurred())) {
+        if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) {
+            PyErr_Clear();
+            return 0;
+        } else {
+            return -1;
+        }
     }
+    return 0;
 #endif
-    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
-    if (unlikely(!result)) {
-        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
-    }
-    return result;
 }
 
-/* GetBuiltinName */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
-    PyObject* result = __Pyx_PyObject_GetAttrStrNoError(__pyx_b, name);
-    if (unlikely(!result) && !PyErr_Occurred()) {
-        PyErr_Format(PyExc_NameError,
-#if PY_MAJOR_VERSION >= 3
-            "name '%U' is not defined", name);
-#else
-            "name '%.200s' is not defined", PyString_AS_STRING(name));
-#endif
+/* UnpackItemEndCheck */
+static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
+    if (unlikely(retval)) {
+        Py_DECREF(retval);
+        __Pyx_RaiseTooManyValuesError(expected);
+        return -1;
     }
-    return result;
+    return __Pyx_IterFinish();
 }
 
-/* PyDictVersioning */
-#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
-}
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
-    PyObject **dictptr = NULL;
-    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
-    if (offset) {
-#if CYTHON_COMPILING_IN_CPYTHON
-        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
-#else
-        dictptr = _PyObject_GetDictPtr(obj);
-#endif
-    }
-    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
-}
-static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
+/* ExtTypeTest */
+static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type) {
+    __Pyx_TypeName obj_type_name;
+    __Pyx_TypeName type_name;
+    if (unlikely(!type)) {
+        PyErr_SetString(PyExc_SystemError, "Missing type object");
         return 0;
-    return obj_dict_version == __Pyx_get_object_dict_version(obj);
-}
-#endif
-
-/* GetModuleGlobalName */
-#if CYTHON_USE_DICT_VERSIONS
-static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
-#else
-static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
-#endif
-{
-    PyObject *result;
-#if !CYTHON_AVOID_BORROWED_REFS
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
-    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    } else if (unlikely(PyErr_Occurred())) {
-        return NULL;
-    }
-#elif CYTHON_COMPILING_IN_LIMITED_API
-    if (unlikely(!__pyx_m)) {
-        return NULL;
-    }
-    result = PyObject_GetAttr(__pyx_m, name);
-    if (likely(result)) {
-        return result;
-    }
-#else
-    result = PyDict_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-#endif
-#else
-    result = PyObject_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
     }
-    PyErr_Clear();
-#endif
-    return __Pyx_GetBuiltinName(name);
+    if (likely(__Pyx_TypeCheck(obj, type)))
+        return 1;
+    obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
+    type_name = __Pyx_PyType_GetName(type);
+    PyErr_Format(PyExc_TypeError,
+                 "Cannot convert " __Pyx_FMT_TYPENAME " to " __Pyx_FMT_TYPENAME,
+                 obj_type_name, type_name);
+    __Pyx_DECREF_TypeName(obj_type_name);
+    __Pyx_DECREF_TypeName(type_name);
+    return 0;
 }
 
 /* PyFunctionFastCall */
 #if CYTHON_FAST_PYCALL && !CYTHON_VECTORCALL
 static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
                                                PyObject *globals) {
     PyFrameObject *f;
@@ -11308,34 +19274,14 @@
     Py_XDECREF(kwtuple);
 done:
     Py_LeaveRecursiveCall();
     return result;
 }
 #endif
 
-/* PyObjectCall */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
-    PyObject *result;
-    ternaryfunc call = Py_TYPE(func)->tp_call;
-    if (unlikely(!call))
-        return PyObject_Call(func, arg, kw);
-    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
-        return NULL;
-    result = (*call)(func, arg, kw);
-    Py_LeaveRecursiveCall();
-    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
-        PyErr_SetString(
-            PyExc_SystemError,
-            "NULL result without error in PyObject_Call");
-    }
-    return result;
-}
-#endif
-
 /* PyObjectCallMethO */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
     PyObject *self, *result;
     PyCFunction cfunc;
     cfunc = PyCFunction_GET_FUNCTION(func);
     self = PyCFunction_GET_SELF(func);
@@ -11425,71 +19371,216 @@
     #endif
     if (nargs == 0) {
         return __Pyx_PyObject_Call(func, __pyx_empty_tuple, kwargs);
     }
     return __Pyx_PyObject_FastCall_fallback(func, args, (size_t)nargs, kwargs);
 }
 
-/* KeywordStringCheck */
-static int __Pyx_CheckKeywordStrings(
-    PyObject *kw,
-    const char* function_name,
-    int kw_allowed)
-{
-    PyObject* key = 0;
-    Py_ssize_t pos = 0;
-#if CYTHON_COMPILING_IN_PYPY
-    if (!kw_allowed && PyDict_Next(kw, &pos, &key, 0))
-        goto invalid_keyword;
-    return 1;
-#else
-    if (CYTHON_METH_FASTCALL && likely(PyTuple_Check(kw))) {
-        if (unlikely(PyTuple_GET_SIZE(kw) == 0))
-            return 1;
-        if (!kw_allowed) {
-            key = PyTuple_GET_ITEM(kw, 0);
-            goto invalid_keyword;
-        }
-#if PY_VERSION_HEX < 0x03090000
-        for (pos = 0; pos < PyTuple_GET_SIZE(kw); pos++) {
-            key = PyTuple_GET_ITEM(kw, pos);
-            if (unlikely(!PyUnicode_Check(key)))
-                goto invalid_keyword_type;
-        }
+/* WriteUnraisableException */
+static void __Pyx_WriteUnraisable(const char *name, int clineno,
+                                  int lineno, const char *filename,
+                                  int full_traceback, int nogil) {
+    PyObject *old_exc, *old_val, *old_tb;
+    PyObject *ctx;
+    __Pyx_PyThreadState_declare
+#ifdef WITH_THREAD
+    PyGILState_STATE state;
+    if (nogil)
+        state = PyGILState_Ensure();
+    else state = (PyGILState_STATE)-1;
 #endif
-        return 1;
-    }
-    while (PyDict_Next(kw, &pos, &key, 0)) {
-        #if PY_MAJOR_VERSION < 3
-        if (unlikely(!PyString_Check(key)))
-        #endif
-            if (unlikely(!PyUnicode_Check(key)))
-                goto invalid_keyword_type;
+    CYTHON_UNUSED_VAR(clineno);
+    CYTHON_UNUSED_VAR(lineno);
+    CYTHON_UNUSED_VAR(filename);
+    CYTHON_MAYBE_UNUSED_VAR(nogil);
+    __Pyx_PyThreadState_assign
+    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
+    if (full_traceback) {
+        Py_XINCREF(old_exc);
+        Py_XINCREF(old_val);
+        Py_XINCREF(old_tb);
+        __Pyx_ErrRestore(old_exc, old_val, old_tb);
+        PyErr_PrintEx(1);
     }
-    if (!kw_allowed && unlikely(key))
-        goto invalid_keyword;
-    return 1;
-invalid_keyword_type:
-    PyErr_Format(PyExc_TypeError,
-        "%.200s() keywords must be strings", function_name);
-    return 0;
-#endif
-invalid_keyword:
     #if PY_MAJOR_VERSION < 3
-    PyErr_Format(PyExc_TypeError,
-        "%.200s() got an unexpected keyword argument '%.200s'",
-        function_name, PyString_AsString(key));
+    ctx = PyString_FromString(name);
     #else
-    PyErr_Format(PyExc_TypeError,
-        "%s() got an unexpected keyword argument '%U'",
-        function_name, key);
+    ctx = PyUnicode_FromString(name);
     #endif
+    __Pyx_ErrRestore(old_exc, old_val, old_tb);
+    if (!ctx) {
+        PyErr_WriteUnraisable(Py_None);
+    } else {
+        PyErr_WriteUnraisable(ctx);
+        Py_DECREF(ctx);
+    }
+#ifdef WITH_THREAD
+    if (nogil)
+        PyGILState_Release(state);
+#endif
+}
+
+/* UnpackUnboundCMethod */
+static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
+    PyObject *method;
+    method = __Pyx_PyObject_GetAttrStr(target->type, *target->method_name);
+    if (unlikely(!method))
+        return -1;
+    target->method = method;
+#if CYTHON_COMPILING_IN_CPYTHON
+    #if PY_MAJOR_VERSION >= 3
+    if (likely(__Pyx_TypeCheck(method, &PyMethodDescr_Type)))
+    #endif
+    {
+        PyMethodDescrObject *descr = (PyMethodDescrObject*) method;
+        target->func = descr->d_method->ml_meth;
+        target->flag = descr->d_method->ml_flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_STACKLESS);
+    }
+#endif
     return 0;
 }
 
+/* CallUnboundCMethod1 */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg) {
+    if (likely(cfunc->func)) {
+        int flag = cfunc->flag;
+        if (flag == METH_O) {
+            return (*(cfunc->func))(self, arg);
+        } else if ((PY_VERSION_HEX >= 0x030600B1) && flag == METH_FASTCALL) {
+            if ((PY_VERSION_HEX >= 0x030700A0)) {
+                return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, &arg, 1);
+            } else {
+                return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
+            }
+        } else if ((PY_VERSION_HEX >= 0x030700A0) && flag == (METH_FASTCALL | METH_KEYWORDS)) {
+            return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
+        }
+    }
+    return __Pyx__CallUnboundCMethod1(cfunc, self, arg);
+}
+#endif
+static PyObject* __Pyx__CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg){
+    PyObject *args, *result = NULL;
+    if (unlikely(!cfunc->func && !cfunc->method) && unlikely(__Pyx_TryUnpackUnboundCMethod(cfunc) < 0)) return NULL;
+#if CYTHON_COMPILING_IN_CPYTHON
+    if (cfunc->func && (cfunc->flag & METH_VARARGS)) {
+        args = PyTuple_New(1);
+        if (unlikely(!args)) goto bad;
+        Py_INCREF(arg);
+        PyTuple_SET_ITEM(args, 0, arg);
+        if (cfunc->flag & METH_KEYWORDS)
+            result = (*(PyCFunctionWithKeywords)(void*)(PyCFunction)cfunc->func)(self, args, NULL);
+        else
+            result = (*cfunc->func)(self, args);
+    } else {
+        args = PyTuple_New(2);
+        if (unlikely(!args)) goto bad;
+        Py_INCREF(self);
+        PyTuple_SET_ITEM(args, 0, self);
+        Py_INCREF(arg);
+        PyTuple_SET_ITEM(args, 1, arg);
+        result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
+    }
+#else
+    args = PyTuple_Pack(2, self, arg);
+    if (unlikely(!args)) goto bad;
+    result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
+#endif
+bad:
+    Py_XDECREF(args);
+    return result;
+}
+
+/* CallUnboundCMethod2 */
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030600B1
+static CYTHON_INLINE PyObject *__Pyx_CallUnboundCMethod2(__Pyx_CachedCFunction *cfunc, PyObject *self, PyObject *arg1, PyObject *arg2) {
+    if (likely(cfunc->func)) {
+        PyObject *args[2] = {arg1, arg2};
+        if (cfunc->flag == METH_FASTCALL) {
+            #if PY_VERSION_HEX >= 0x030700A0
+            return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, args, 2);
+            #else
+            return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, args, 2, NULL);
+            #endif
+        }
+        #if PY_VERSION_HEX >= 0x030700A0
+        if (cfunc->flag == (METH_FASTCALL | METH_KEYWORDS))
+            return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, args, 2, NULL);
+        #endif
+    }
+    return __Pyx__CallUnboundCMethod2(cfunc, self, arg1, arg2);
+}
+#endif
+static PyObject* __Pyx__CallUnboundCMethod2(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg1, PyObject* arg2){
+    PyObject *args, *result = NULL;
+    if (unlikely(!cfunc->func && !cfunc->method) && unlikely(__Pyx_TryUnpackUnboundCMethod(cfunc) < 0)) return NULL;
+#if CYTHON_COMPILING_IN_CPYTHON
+    if (cfunc->func && (cfunc->flag & METH_VARARGS)) {
+        args = PyTuple_New(2);
+        if (unlikely(!args)) goto bad;
+        Py_INCREF(arg1);
+        PyTuple_SET_ITEM(args, 0, arg1);
+        Py_INCREF(arg2);
+        PyTuple_SET_ITEM(args, 1, arg2);
+        if (cfunc->flag & METH_KEYWORDS)
+            result = (*(PyCFunctionWithKeywords)(void*)(PyCFunction)cfunc->func)(self, args, NULL);
+        else
+            result = (*cfunc->func)(self, args);
+    } else {
+        args = PyTuple_New(3);
+        if (unlikely(!args)) goto bad;
+        Py_INCREF(self);
+        PyTuple_SET_ITEM(args, 0, self);
+        Py_INCREF(arg1);
+        PyTuple_SET_ITEM(args, 1, arg1);
+        Py_INCREF(arg2);
+        PyTuple_SET_ITEM(args, 2, arg2);
+        result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
+    }
+#else
+    args = PyTuple_Pack(3, self, arg1, arg2);
+    if (unlikely(!args)) goto bad;
+    result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
+#endif
+bad:
+    Py_XDECREF(args);
+    return result;
+}
+
+/* dict_getitem_default */
+static PyObject* __Pyx_PyDict_GetItemDefault(PyObject* d, PyObject* key, PyObject* default_value) {
+    PyObject* value;
+#if PY_MAJOR_VERSION >= 3 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07020000)
+    value = PyDict_GetItemWithError(d, key);
+    if (unlikely(!value)) {
+        if (unlikely(PyErr_Occurred()))
+            return NULL;
+        value = default_value;
+    }
+    Py_INCREF(value);
+    if ((1));
+#else
+    if (PyString_CheckExact(key) || PyUnicode_CheckExact(key) || PyInt_CheckExact(key)) {
+        value = PyDict_GetItem(d, key);
+        if (unlikely(!value)) {
+            value = default_value;
+        }
+        Py_INCREF(value);
+    }
+#endif
+    else {
+        if (default_value == Py_None)
+            value = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyDict_Type_get, d, key);
+        else
+            value = __Pyx_CallUnboundCMethod2(&__pyx_umethod_PyDict_Type_get, d, key, default_value);
+    }
+    return value;
+}
+
 /* GetItemInt */
 static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
     PyObject *r;
     if (unlikely(!j)) return NULL;
     r = PyObject_GetItem(o, j);
     Py_DECREF(j);
     return r;
@@ -11864,14 +19955,83 @@
 #endif
         if ((double)a == (double)b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
     }
     return (
         PyObject_RichCompare(op1, op2, Py_EQ));
 }
 
+/* PyDictVersioning */
+#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
+}
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
+    PyObject **dictptr = NULL;
+    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
+    if (offset) {
+#if CYTHON_COMPILING_IN_CPYTHON
+        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
+#else
+        dictptr = _PyObject_GetDictPtr(obj);
+#endif
+    }
+    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
+}
+static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
+        return 0;
+    return obj_dict_version == __Pyx_get_object_dict_version(obj);
+}
+#endif
+
+/* GetModuleGlobalName */
+#if CYTHON_USE_DICT_VERSIONS
+static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
+#else
+static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
+#endif
+{
+    PyObject *result;
+#if !CYTHON_AVOID_BORROWED_REFS
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
+    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    } else if (unlikely(PyErr_Occurred())) {
+        return NULL;
+    }
+#elif CYTHON_COMPILING_IN_LIMITED_API
+    if (unlikely(!__pyx_m)) {
+        return NULL;
+    }
+    result = PyObject_GetAttr(__pyx_m, name);
+    if (likely(result)) {
+        return result;
+    }
+#else
+    result = PyDict_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
+#endif
+#else
+    result = PyObject_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
+    PyErr_Clear();
+#endif
+    return __Pyx_GetBuiltinName(name);
+}
+
 /* JoinPyUnicode */
 static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
                                       Py_UCS4 max_char) {
 #if CYTHON_USE_UNICODE_INTERNALS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     PyObject *result_uval;
     int result_ukind, kind_shift;
     Py_ssize_t i, char_pos;
@@ -11937,173 +20097,14 @@
 
 /* PyObjectCallOneArg */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
     PyObject *args[2] = {NULL, arg};
     return __Pyx_PyObject_FastCall(func, args+1, 1 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
 }
 
-/* RaiseException */
-#if PY_MAJOR_VERSION < 3
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
-    __Pyx_PyThreadState_declare
-    CYTHON_UNUSED_VAR(cause);
-    Py_XINCREF(type);
-    if (!value || value == Py_None)
-        value = NULL;
-    else
-        Py_INCREF(value);
-    if (!tb || tb == Py_None)
-        tb = NULL;
-    else {
-        Py_INCREF(tb);
-        if (!PyTraceBack_Check(tb)) {
-            PyErr_SetString(PyExc_TypeError,
-                "raise: arg 3 must be a traceback or None");
-            goto raise_error;
-        }
-    }
-    if (PyType_Check(type)) {
-#if CYTHON_COMPILING_IN_PYPY
-        if (!value) {
-            Py_INCREF(Py_None);
-            value = Py_None;
-        }
-#endif
-        PyErr_NormalizeException(&type, &value, &tb);
-    } else {
-        if (value) {
-            PyErr_SetString(PyExc_TypeError,
-                "instance exception may not have a separate value");
-            goto raise_error;
-        }
-        value = type;
-        type = (PyObject*) Py_TYPE(type);
-        Py_INCREF(type);
-        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
-            PyErr_SetString(PyExc_TypeError,
-                "raise: exception class must be a subclass of BaseException");
-            goto raise_error;
-        }
-    }
-    __Pyx_PyThreadState_assign
-    __Pyx_ErrRestore(type, value, tb);
-    return;
-raise_error:
-    Py_XDECREF(value);
-    Py_XDECREF(type);
-    Py_XDECREF(tb);
-    return;
-}
-#else
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
-    PyObject* owned_instance = NULL;
-    if (tb == Py_None) {
-        tb = 0;
-    } else if (tb && !PyTraceBack_Check(tb)) {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: arg 3 must be a traceback or None");
-        goto bad;
-    }
-    if (value == Py_None)
-        value = 0;
-    if (PyExceptionInstance_Check(type)) {
-        if (value) {
-            PyErr_SetString(PyExc_TypeError,
-                "instance exception may not have a separate value");
-            goto bad;
-        }
-        value = type;
-        type = (PyObject*) Py_TYPE(value);
-    } else if (PyExceptionClass_Check(type)) {
-        PyObject *instance_class = NULL;
-        if (value && PyExceptionInstance_Check(value)) {
-            instance_class = (PyObject*) Py_TYPE(value);
-            if (instance_class != type) {
-                int is_subclass = PyObject_IsSubclass(instance_class, type);
-                if (!is_subclass) {
-                    instance_class = NULL;
-                } else if (unlikely(is_subclass == -1)) {
-                    goto bad;
-                } else {
-                    type = instance_class;
-                }
-            }
-        }
-        if (!instance_class) {
-            PyObject *args;
-            if (!value)
-                args = PyTuple_New(0);
-            else if (PyTuple_Check(value)) {
-                Py_INCREF(value);
-                args = value;
-            } else
-                args = PyTuple_Pack(1, value);
-            if (!args)
-                goto bad;
-            owned_instance = PyObject_Call(type, args, NULL);
-            Py_DECREF(args);
-            if (!owned_instance)
-                goto bad;
-            value = owned_instance;
-            if (!PyExceptionInstance_Check(value)) {
-                PyErr_Format(PyExc_TypeError,
-                             "calling %R should have returned an instance of "
-                             "BaseException, not %R",
-                             type, Py_TYPE(value));
-                goto bad;
-            }
-        }
-    } else {
-        PyErr_SetString(PyExc_TypeError,
-            "raise: exception class must be a subclass of BaseException");
-        goto bad;
-    }
-    if (cause) {
-        PyObject *fixed_cause;
-        if (cause == Py_None) {
-            fixed_cause = NULL;
-        } else if (PyExceptionClass_Check(cause)) {
-            fixed_cause = PyObject_CallObject(cause, NULL);
-            if (fixed_cause == NULL)
-                goto bad;
-        } else if (PyExceptionInstance_Check(cause)) {
-            fixed_cause = cause;
-            Py_INCREF(fixed_cause);
-        } else {
-            PyErr_SetString(PyExc_TypeError,
-                            "exception causes must derive from "
-                            "BaseException");
-            goto bad;
-        }
-        PyException_SetCause(value, fixed_cause);
-    }
-    PyErr_SetObject(type, value);
-    if (tb) {
-#if CYTHON_COMPILING_IN_PYPY ||  CYTHON_COMPILING_IN_LIMITED_API
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
-        PyThreadState *tstate = __Pyx_PyThreadState_Current;
-        PyObject* tmp_tb = tstate->curexc_traceback;
-        if (tb != tmp_tb) {
-            Py_INCREF(tb);
-            tstate->curexc_traceback = tb;
-            Py_XDECREF(tmp_tb);
-        }
-#endif
-    }
-bad:
-    Py_XDECREF(owned_instance);
-    return;
-}
-#endif
-
 /* GetAttr3 */
 static PyObject *__Pyx_GetAttr3Default(PyObject *d) {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     if (unlikely(!__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
         return NULL;
     __Pyx_PyErr_Clear();
@@ -12121,34 +20122,14 @@
         return r;
     }
 #endif
     r = PyObject_GetAttr(o, n);
     return (likely(r)) ? r : __Pyx_GetAttr3Default(d);
 }
 
-/* UnpackUnboundCMethod */
-static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
-    PyObject *method;
-    method = __Pyx_PyObject_GetAttrStr(target->type, *target->method_name);
-    if (unlikely(!method))
-        return -1;
-    target->method = method;
-#if CYTHON_COMPILING_IN_CPYTHON
-    #if PY_MAJOR_VERSION >= 3
-    if (likely(__Pyx_TypeCheck(method, &PyMethodDescr_Type)))
-    #endif
-    {
-        PyMethodDescrObject *descr = (PyMethodDescrObject*) method;
-        target->func = descr->d_method->ml_meth;
-        target->flag = descr->d_method->ml_flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_STACKLESS);
-    }
-#endif
-    return 0;
-}
-
 /* CallUnboundCMethod0 */
 static PyObject* __Pyx__CallUnboundCMethod0(__Pyx_CachedCFunction* cfunc, PyObject* self) {
     PyObject *args, *result = NULL;
     if (unlikely(!cfunc->method) && unlikely(__Pyx_TryUnpackUnboundCMethod(cfunc) < 0)) return NULL;
 #if CYTHON_ASSUME_SAFE_MACROS
     args = PyTuple_New(1);
     if (unlikely(!args)) goto bad;
@@ -12168,58 +20149,14 @@
 static CYTHON_INLINE PyObject* __Pyx_PyDict_Keys(PyObject* d) {
     if (PY_MAJOR_VERSION >= 3)
         return __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyDict_Type_keys, d);
     else
         return PyDict_Keys(d);
 }
 
-/* WriteUnraisableException */
-static void __Pyx_WriteUnraisable(const char *name, int clineno,
-                                  int lineno, const char *filename,
-                                  int full_traceback, int nogil) {
-    PyObject *old_exc, *old_val, *old_tb;
-    PyObject *ctx;
-    __Pyx_PyThreadState_declare
-#ifdef WITH_THREAD
-    PyGILState_STATE state;
-    if (nogil)
-        state = PyGILState_Ensure();
-    else state = (PyGILState_STATE)-1;
-#endif
-    CYTHON_UNUSED_VAR(clineno);
-    CYTHON_UNUSED_VAR(lineno);
-    CYTHON_UNUSED_VAR(filename);
-    CYTHON_MAYBE_UNUSED_VAR(nogil);
-    __Pyx_PyThreadState_assign
-    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
-    if (full_traceback) {
-        Py_XINCREF(old_exc);
-        Py_XINCREF(old_val);
-        Py_XINCREF(old_tb);
-        __Pyx_ErrRestore(old_exc, old_val, old_tb);
-        PyErr_PrintEx(1);
-    }
-    #if PY_MAJOR_VERSION < 3
-    ctx = PyString_FromString(name);
-    #else
-    ctx = PyUnicode_FromString(name);
-    #endif
-    __Pyx_ErrRestore(old_exc, old_val, old_tb);
-    if (!ctx) {
-        PyErr_WriteUnraisable(Py_None);
-    } else {
-        PyErr_WriteUnraisable(ctx);
-        Py_DECREF(ctx);
-    }
-#ifdef WITH_THREAD
-    if (nogil)
-        PyGILState_Release(state);
-#endif
-}
-
 /* PyObjectSetAttrStr */
 #if CYTHON_USE_TYPE_SLOTS
 static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value) {
     PyTypeObject* tp = Py_TYPE(obj);
     if (likely(tp->tp_setattro))
         return tp->tp_setattro(obj, attr_name, value);
 #if PY_MAJOR_VERSION < 3
@@ -12387,15 +20324,15 @@
         PyObject* module_dot = 0;
         PyObject* full_name = 0;
         PyErr_Clear();
         module_name_str = PyModule_GetName(module);
         if (unlikely(!module_name_str)) { goto modbad; }
         module_name = PyUnicode_FromString(module_name_str);
         if (unlikely(!module_name)) { goto modbad; }
-        module_dot = PyUnicode_Concat(module_name, __pyx_kp_u__15);
+        module_dot = PyUnicode_Concat(module_name, __pyx_kp_u__36);
         if (unlikely(!module_dot)) { goto modbad; }
         full_name = PyUnicode_Concat(module_dot, name);
         if (unlikely(!full_name)) { goto modbad; }
         #if PY_VERSION_HEX < 0x030700A1 || (CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM  < 0x07030400)
         {
             PyObject *modules = PyImport_GetModuleDict();
             if (unlikely(!modules))
@@ -13774,14 +21711,36 @@
     PyTraceBack_Here(py_frame);
 bad:
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
 #endif
 
+/* CIntFromPyVerify */
+#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
+    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
+#define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
+    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
+#define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
+    {\
+        func_type value = func_value;\
+        if (sizeof(target_type) < sizeof(func_type)) {\
+            if (unlikely(value != (func_type) (target_type) value)) {\
+                func_type zero = 0;\
+                if (exc && unlikely(value == (func_type)-1 && PyErr_Occurred()))\
+                    return (target_type) -1;\
+                if (is_unsigned && unlikely(value < zero))\
+                    goto raise_neg_overflow;\
+                else\
+                    goto raise_overflow;\
+            }\
+        }\
+        return (target_type) value;\
+    }
+
 /* UnicodeAsUCS4 */
 static CYTHON_INLINE Py_UCS4 __Pyx_PyUnicode_AsPy_UCS4(PyObject* x) {
    Py_ssize_t length;
    #if CYTHON_PEP393_ENABLED
    length = PyUnicode_GET_LENGTH(x);
    if (likely(length == 1)) {
        return PyUnicode_READ_CHAR(x, 0);
@@ -13805,95 +21764,14 @@
    #endif
    PyErr_Format(PyExc_ValueError,
                 "only single character unicode strings can be converted to Py_UCS4, "
                 "got length %" CYTHON_FORMAT_SSIZE_T "d", length);
    return (Py_UCS4)-1;
 }
 
-/* CIntFromPyVerify */
-#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
-    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
-#define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
-    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
-#define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
-    {\
-        func_type value = func_value;\
-        if (sizeof(target_type) < sizeof(func_type)) {\
-            if (unlikely(value != (func_type) (target_type) value)) {\
-                func_type zero = 0;\
-                if (exc && unlikely(value == (func_type)-1 && PyErr_Occurred()))\
-                    return (target_type) -1;\
-                if (is_unsigned && unlikely(value < zero))\
-                    goto raise_neg_overflow;\
-                else\
-                    goto raise_overflow;\
-            }\
-        }\
-        return (target_type) value;\
-    }
-
-/* ObjectAsUCS4 */
-static Py_UCS4 __Pyx__PyObject_AsPy_UCS4_raise_error(long ival) {
-   if (ival < 0) {
-       if (!PyErr_Occurred())
-           PyErr_SetString(PyExc_OverflowError,
-                           "cannot convert negative value to Py_UCS4");
-   } else {
-       PyErr_SetString(PyExc_OverflowError,
-                       "value too large to convert to Py_UCS4");
-   }
-   return (Py_UCS4)-1;
-}
-static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject* x) {
-   long ival;
-   ival = __Pyx_PyInt_As_long(x);
-   if (unlikely(!__Pyx_is_valid_index(ival, 1114111 + 1))) {
-       return __Pyx__PyObject_AsPy_UCS4_raise_error(ival);
-   }
-   return (Py_UCS4)ival;
-}
-
-/* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int64_t(int64_t value) {
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic push
-#pragma GCC diagnostic ignored "-Wconversion"
-#endif
-    const int64_t neg_one = (int64_t) -1, const_zero = (int64_t) 0;
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic pop
-#endif
-    const int is_unsigned = neg_one > const_zero;
-    if (is_unsigned) {
-        if (sizeof(int64_t) < sizeof(long)) {
-            return PyInt_FromLong((long) value);
-        } else if (sizeof(int64_t) <= sizeof(unsigned long)) {
-            return PyLong_FromUnsignedLong((unsigned long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(int64_t) <= sizeof(unsigned PY_LONG_LONG)) {
-            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
-#endif
-        }
-    } else {
-        if (sizeof(int64_t) <= sizeof(long)) {
-            return PyInt_FromLong((long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(int64_t) <= sizeof(PY_LONG_LONG)) {
-            return PyLong_FromLongLong((PY_LONG_LONG) value);
-#endif
-        }
-    }
-    {
-        int one = 1; int little = (int)*(unsigned char *)&one;
-        unsigned char *bytes = (unsigned char *)&value;
-        return _PyLong_FromByteArray(bytes, sizeof(int64_t),
-                                     little, !is_unsigned);
-    }
-}
-
 /* CIntFromPy */
 static CYTHON_INLINE int64_t __Pyx_PyInt_As_int64_t(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int64_t neg_one = (int64_t) -1, const_zero = (int64_t) 0;
@@ -14082,14 +21960,52 @@
     return (int64_t) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to int64_t");
     return (int64_t) -1;
 }
 
+/* CIntToPy */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int64_t(int64_t value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const int64_t neg_one = (int64_t) -1, const_zero = (int64_t) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
+    const int is_unsigned = neg_one > const_zero;
+    if (is_unsigned) {
+        if (sizeof(int64_t) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(int64_t) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(int64_t) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
+#endif
+        }
+    } else {
+        if (sizeof(int64_t) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(int64_t) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
+#endif
+        }
+    }
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(int64_t),
+                                     little, !is_unsigned);
+    }
+}
+
 /* CIntFromPy */
 static CYTHON_INLINE uint64_t __Pyx_PyInt_As_uint64_t(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const uint64_t neg_one = (uint64_t) -1, const_zero = (uint64_t) 0;
@@ -14278,24 +22194,45 @@
     return (uint64_t) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to uint64_t");
     return (uint64_t) -1;
 }
 
+/* ObjectAsUCS4 */
+static Py_UCS4 __Pyx__PyObject_AsPy_UCS4_raise_error(long ival) {
+   if (ival < 0) {
+       if (!PyErr_Occurred())
+           PyErr_SetString(PyExc_OverflowError,
+                           "cannot convert negative value to Py_UCS4");
+   } else {
+       PyErr_SetString(PyExc_OverflowError,
+                       "value too large to convert to Py_UCS4");
+   }
+   return (Py_UCS4)-1;
+}
+static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject* x) {
+   long ival;
+   ival = __Pyx_PyInt_As_long(x);
+   if (unlikely(!__Pyx_is_valid_index(ival, 1114111 + 1))) {
+       return __Pyx__PyObject_AsPy_UCS4_raise_error(ival);
+   }
+   return (Py_UCS4)ival;
+}
+
 /* FormatTypeName */
 #if CYTHON_COMPILING_IN_LIMITED_API
 static __Pyx_TypeName
 __Pyx_PyType_GetName(PyTypeObject* tp)
 {
     PyObject *name = __Pyx_PyObject_GetAttrStr((PyObject *)tp,
                                                __pyx_n_s_name);
     if (unlikely(name == NULL) || unlikely(!PyUnicode_Check(name))) {
         PyErr_Clear();
-        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__19));
+        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__42));
     }
     return name;
 }
 #endif
 
 /* CIntToPy */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/fuzz_cpp.hpp` & `rapidfuzz-2.9.0/src/rapidfuzz/fuzz_cpp.hpp`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/fuzz_py.py` & `rapidfuzz-2.9.0/src/rapidfuzz/fuzz_py.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/fuzz_py.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/fuzz_py.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/process.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/process.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/process_cpp.cxx` & `rapidfuzz-2.9.0/src/rapidfuzz/process_cpp_impl.cxx`

 * *Files 12% similar despite different names*

```diff
@@ -10,14 +10,31 @@
     #else
       #define Py_LIMITED_API 0x03030000
     #endif
   #endif
 #endif
 
 #include "Python.h"
+
+    #if PY_MAJOR_VERSION >= 3
+      #define __Pyx_PyFloat_FromString(obj)  PyFloat_FromString(obj)
+    #else
+      #define __Pyx_PyFloat_FromString(obj)  PyFloat_FromString(obj, NULL)
+    #endif
+    
+
+    #if PY_MAJOR_VERSION <= 2
+    #define PyDict_GetItemWithError _PyDict_GetItemWithError
+    #endif
+    
+
+    #if (PY_VERSION_HEX < 0x030700b1 || (CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM < 0x07030600)) && !defined(PyContextVar_Get)
+    #define PyContextVar_Get(var, d, v)         ((d) ?             ((void)(var), Py_INCREF(d), (v)[0] = (d), 0) :             ((v)[0] = NULL, 0)         )
+    #endif
+    
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02070000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.7+ or Python 3.3+.
 #else
 #define CYTHON_ABI "3_0_0a11"
 #define __PYX_ABI_MODULE_NAME "_cython_" CYTHON_ABI
@@ -1034,16 +1051,16 @@
   #ifdef __cplusplus
     #define __PYX_EXTERN_C extern "C"
   #else
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
-#define __PYX_HAVE__rapidfuzz__process_cpp
-#define __PYX_HAVE_API__rapidfuzz__process_cpp
+#define __PYX_HAVE__rapidfuzz__process_cpp_impl
+#define __PYX_HAVE_API__rapidfuzz__process_cpp_impl
 /* Early includes */
 #include "ios"
 #include "new"
 #include "stdexcept"
 #include "typeinfo"
 #include <vector>
 #include <utility>
@@ -1060,14 +1077,15 @@
     #endif
     
 #include <algorithm>
 #include <stdint.h>
 #include <math.h>
 #include <string.h>
 #include <stdio.h>
+#include "pythread.h"
 #include <stdlib.h>
 #include <stddef.h>
 #include "rapidfuzz_capi.h"
 #include "rapidfuzz/details/types.hpp"
 #include "cpp_common.hpp"
 #include "process_cpp.hpp"
 #ifdef _OPENMP
@@ -1287,65 +1305,117 @@
 static int __pyx_clineno = 0;
 static const char * __pyx_cfilenm = __FILE__;
 static const char *__pyx_filename;
 
 /* #### Code section: filename_table ### */
 
 static const char *__pyx_f[] = {
-  "src/rapidfuzz/process_cpp.pyx",
+  "src/rapidfuzz/process_cpp_impl.pyx",
+  "<stringsource>",
+  "contextvars.pxd",
   "./src/rapidfuzz/cpp_common.pxd",
   "type.pxd",
+  "bool.pxd",
+  "complex.pxd",
 };
 /* #### Code section: utility_code_proto_before_types ### */
 /* NoFastGil.proto */
 #define __Pyx_PyGILState_Ensure PyGILState_Ensure
 #define __Pyx_PyGILState_Release PyGILState_Release
 #define __Pyx_FastGIL_Remember()
 #define __Pyx_FastGIL_Forget()
 #define __Pyx_FastGilFuncInit()
 
 /* #### Code section: numeric_typedefs ### */
 /* #### Code section: complex_type_declarations ### */
 /* #### Code section: type_declarations ### */
 
 /*--- Type declarations ---*/
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter;
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64;
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64;
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64;
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64;
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict;
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list;
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix;
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter;
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64;
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64;
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64;
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64;
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict;
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list;
+struct __pyx_obj___Pyx_EnumMeta;
+struct __pyx_opt_args_7cpython_11contextvars_get_value;
+struct __pyx_opt_args_7cpython_11contextvars_get_value_no_default;
+
+/* "cpython/contextvars.pxd":112
+ * 
+ * 
+ * cdef inline object get_value(var, default_value=None):             # <<<<<<<<<<<<<<
+ *     """Return a new reference to the value of the context variable,
+ *     or the default value of the context variable,
+ */
+struct __pyx_opt_args_7cpython_11contextvars_get_value {
+  int __pyx_n;
+  PyObject *default_value;
+};
+
+/* "cpython/contextvars.pxd":129
+ * 
+ * 
+ * cdef inline object get_value_no_default(var, default_value=None):             # <<<<<<<<<<<<<<
+ *     """Return a new reference to the value of the context variable,
+ *     or the provided default value if no such value was found.
+ */
+struct __pyx_opt_args_7cpython_11contextvars_get_value_no_default {
+  int __pyx_n;
+  PyObject *default_value;
+};
 struct __pyx_defaults;
 typedef struct __pyx_defaults __pyx_defaults;
 struct __pyx_defaults1;
 typedef struct __pyx_defaults1 __pyx_defaults1;
 struct __pyx_defaults2;
 typedef struct __pyx_defaults2 __pyx_defaults2;
+struct __pyx_defaults3;
+typedef struct __pyx_defaults3 __pyx_defaults3;
 struct __pyx_defaults {
   PyObject *__pyx_arg_scorer;
   PyObject *__pyx_arg_processor;
 };
 struct __pyx_defaults1 {
   PyObject *__pyx_arg_scorer;
   PyObject *__pyx_arg_processor;
 };
 struct __pyx_defaults2 {
   PyObject *__pyx_arg_scorer;
   PyObject *__pyx_arg_processor;
 };
+struct __pyx_defaults3 {
+  PyObject *__pyx_arg_scorer;
+};
+
+/* "rapidfuzz/process_cpp_impl.pyx":1229
+ * from libcpp.vector cimport vector
+ * 
+ * cdef class Matrix:             # <<<<<<<<<<<<<<
+ *     cdef Py_ssize_t shape[2]
+ *     cdef Py_ssize_t strides[2]
+ */
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix {
+  PyObject_HEAD
+  Py_ssize_t shape[2];
+  Py_ssize_t strides[2];
+  Matrix matrix;
+};
+
 
-/* "rapidfuzz/process_cpp.pyx":1018
+/* "rapidfuzz/process_cpp_impl.pyx":878
  * 
  * 
  * def extract_iter(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best match in a list of choices
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter {
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter {
   PyObject_HEAD
   PyObject *__pyx_v_choices;
   PyObject *__pyx_v_extract_iter_dict_f64;
   PyObject *__pyx_v_extract_iter_dict_i64;
   PyObject *__pyx_v_extract_iter_list_f64;
   PyObject *__pyx_v_extract_iter_list_i64;
   PyObject *__pyx_v_kwargs;
@@ -1362,24 +1432,24 @@
   PyObject *__pyx_v_scorer_capsule;
   RF_Scorer *__pyx_v_scorer_context;
   RF_ScorerFlags __pyx_v_scorer_flags;
   PyObject *__pyx_v_worst_score;
 };
 
 
-/* "rapidfuzz/process_cpp.pyx":1077
+/* "rapidfuzz/process_cpp_impl.pyx":884
  *     cdef RF_KwargsWrapper kwargs_context
  * 
  *     def extract_iter_dict_f64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type
  */
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 {
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 {
   PyObject_HEAD
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *__pyx_outer_scope;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *__pyx_outer_scope;
   RF_ScorerWrapper __pyx_v_ScorerFunc;
   double __pyx_v_c_score_cutoff;
   PyObject *__pyx_v_choice;
   PyObject *__pyx_v_choice_key;
   RF_StringWrapper __pyx_v_choice_proc;
   bool __pyx_v_lowest_score_worst;
   PyObject *__pyx_v_proc_choice;
@@ -1390,24 +1460,24 @@
   PyObject *__pyx_t_0;
   Py_ssize_t __pyx_t_1;
   Py_ssize_t __pyx_t_2;
   int __pyx_t_3;
 };
 
 
-/* "rapidfuzz/process_cpp.pyx":1119
+/* "rapidfuzz/process_cpp_impl.pyx":926
  *                     yield (choice, score, choice_key)
  * 
  *     def extract_iter_dict_i64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type
  */
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 {
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 {
   PyObject_HEAD
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *__pyx_outer_scope;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *__pyx_outer_scope;
   RF_ScorerWrapper __pyx_v_ScorerFunc;
   int64_t __pyx_v_c_score_cutoff;
   PyObject *__pyx_v_choice;
   PyObject *__pyx_v_choice_key;
   RF_StringWrapper __pyx_v_choice_proc;
   bool __pyx_v_lowest_score_worst;
   PyObject *__pyx_v_proc_choice;
@@ -1418,24 +1488,24 @@
   PyObject *__pyx_t_0;
   Py_ssize_t __pyx_t_1;
   Py_ssize_t __pyx_t_2;
   int __pyx_t_3;
 };
 
 
-/* "rapidfuzz/process_cpp.pyx":1161
+/* "rapidfuzz/process_cpp_impl.pyx":968
  *                     yield (choice, score, choice_key)
  * 
  *     def extract_iter_list_f64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type
  */
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 {
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 {
   PyObject_HEAD
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *__pyx_outer_scope;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *__pyx_outer_scope;
   RF_ScorerWrapper __pyx_v_ScorerFunc;
   double __pyx_v_c_score_cutoff;
   PyObject *__pyx_v_choice;
   RF_StringWrapper __pyx_v_choice_proc;
   PyObject *__pyx_v_i;
   bool __pyx_v_lowest_score_worst;
   PyObject *__pyx_v_proc_choice;
@@ -1446,24 +1516,24 @@
   PyObject *__pyx_t_0;
   PyObject *__pyx_t_1;
   Py_ssize_t __pyx_t_2;
   PyObject *(*__pyx_t_3)(PyObject *);
 };
 
 
-/* "rapidfuzz/process_cpp.pyx":1203
+/* "rapidfuzz/process_cpp_impl.pyx":1010
  *                     yield (choice, score, i)
  * 
  *     def extract_iter_list_i64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type
  */
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 {
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 {
   PyObject_HEAD
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *__pyx_outer_scope;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *__pyx_outer_scope;
   RF_ScorerWrapper __pyx_v_ScorerFunc;
   int64_t __pyx_v_c_score_cutoff;
   PyObject *__pyx_v_choice;
   RF_StringWrapper __pyx_v_choice_proc;
   PyObject *__pyx_v_i;
   bool __pyx_v_lowest_score_worst;
   PyObject *__pyx_v_proc_choice;
@@ -1474,59 +1544,71 @@
   PyObject *__pyx_t_0;
   PyObject *__pyx_t_1;
   Py_ssize_t __pyx_t_2;
   PyObject *(*__pyx_t_3)(PyObject *);
 };
 
 
-/* "rapidfuzz/process_cpp.pyx":1245
+/* "rapidfuzz/process_cpp_impl.pyx":1052
  *                     yield (choice, score, i)
  * 
  *     def py_extract_iter_dict(worst_score, optimal_score):             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for:
  */
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict {
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict {
   PyObject_HEAD
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *__pyx_outer_scope;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *__pyx_outer_scope;
   PyObject *__pyx_v_choice;
   PyObject *__pyx_v_choice_key;
   bool __pyx_v_lowest_score_worst;
   PyObject *__pyx_v_optimal_score;
   PyObject *__pyx_v_score;
   PyObject *__pyx_v_worst_score;
   PyObject *__pyx_t_0;
   Py_ssize_t __pyx_t_1;
   Py_ssize_t __pyx_t_2;
   int __pyx_t_3;
 };
 
 
-/* "rapidfuzz/process_cpp.pyx":1269
+/* "rapidfuzz/process_cpp_impl.pyx":1076
  *                     yield (choice, score, choice_key)
  * 
  *     def py_extract_iter_list(worst_score, optimal_score):             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for:
  */
-struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list {
+struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list {
   PyObject_HEAD
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *__pyx_outer_scope;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *__pyx_outer_scope;
   PyObject *__pyx_v_choice;
   int64_t __pyx_v_i;
   bool __pyx_v_lowest_score_worst;
   PyObject *__pyx_v_optimal_score;
   PyObject *__pyx_v_score;
   PyObject *__pyx_v_worst_score;
   PyObject *__pyx_t_0;
   int64_t __pyx_t_1;
   Py_ssize_t __pyx_t_2;
   PyObject *(*__pyx_t_3)(PyObject *);
 };
 
+
+/* "EnumBase":12
+ * 
+ * @cython.internal
+ * cdef class __Pyx_EnumMeta(type):             # <<<<<<<<<<<<<<
+ *     def __init__(cls, name, parents, dct):
+ *         type.__init__(cls, name, parents, dct)
+ */
+struct __pyx_obj___Pyx_EnumMeta {
+  PyHeapTypeObject __pyx_base;
+};
+
 /* #### Code section: utility_code_proto ### */
 
 /* --- Runtime support code (head) --- */
 /* Refnanny.proto */
 #ifndef CYTHON_REFNANNY
   #define CYTHON_REFNANNY 0
 #endif
@@ -2439,14 +2521,22 @@
     __Pyx__Coroutine_New(__pyx_GeneratorType, body, code, closure, name, qualname, module_name)
 static PyObject *__Pyx_Generator_Next(PyObject *self);
 static int __pyx_Generator_init(PyObject *module);
 
 /* GeneratorYieldFrom.proto */
 static CYTHON_INLINE PyObject* __Pyx_Generator_Yield_From(__pyx_CoroutineObject *gen, PyObject *source);
 
+/* WriteUnraisableException.proto */
+static void __Pyx_WriteUnraisable(const char *name, int clineno,
+                                  int lineno, const char *filename,
+                                  int full_traceback, int nogil);
+
+/* KeywordStringCheck.proto */
+static int __Pyx_CheckKeywordStrings(PyObject *kw, const char* function_name, int kw_allowed);
+
 /* PyIntCompare.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);
 
 /* PyObjectFormatSimple.proto */
 #if CYTHON_COMPILING_IN_PYPY
     #define __Pyx_PyObject_FormatSimple(s, f) (\
         likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
@@ -2500,36 +2590,65 @@
                ((cfunc)->flag == METH_VARARGS ?  (*((cfunc)->func))(self, __pyx_empty_tuple) :\
                __Pyx__CallUnboundCMethod0(cfunc, self)))))) :\
         __Pyx__CallUnboundCMethod0(cfunc, self))
 #else
 #define __Pyx_CallUnboundCMethod0(cfunc, self)  __Pyx__CallUnboundCMethod0(cfunc, self)
 #endif
 
-/* WriteUnraisableException.proto */
-static void __Pyx_WriteUnraisable(const char *name, int clineno,
-                                  int lineno, const char *filename,
-                                  int full_traceback, int nogil);
-
 /* PyObjectSetAttrStr.proto */
 #if CYTHON_USE_TYPE_SLOTS
 #define __Pyx_PyObject_DelAttrStr(o,n) __Pyx_PyObject_SetAttrStr(o, n, NULL)
 static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value);
 #else
 #define __Pyx_PyObject_DelAttrStr(o,n)   PyObject_DelAttr(o,n)
 #define __Pyx_PyObject_SetAttrStr(o,n,v) PyObject_SetAttr(o,n,v)
 #endif
 
+/* ObjectGetItem.proto */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject *key);
+#else
+#define __Pyx_PyObject_GetItem(obj, key)  PyObject_GetItem(obj, key)
+#endif
+
+/* RaiseUnexpectedTypeError.proto */
+static int __Pyx_RaiseUnexpectedTypeError(const char *expected, PyObject *obj);
+
+/* PySequenceContains.proto */
+static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
+    int result = PySequence_Contains(seq, item);
+    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
+}
+
+/* Import.proto */
+static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);
+
+/* ImportFrom.proto */
+static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name);
+
 /* ValidateBasesTuple.proto */
 #if CYTHON_COMPILING_IN_CPYTHON || CYTHON_COMPILING_IN_LIMITED_API || CYTHON_USE_TYPE_SPECS
 static int __Pyx_validate_bases_tuple(const char *type_name, Py_ssize_t dictoffset, PyObject *bases);
 #endif
 
 /* PyType_Ready.proto */
 static CYTHON_UNUSED int __Pyx_PyType_Ready(PyTypeObject *t);
 
+/* PyObject_GenericGetAttr.proto */
+#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
+static PyObject* __Pyx_PyObject_GenericGetAttr(PyObject* obj, PyObject* attr_name);
+#else
+#define __Pyx_PyObject_GenericGetAttr PyObject_GenericGetAttr
+#endif
+
+/* SetupReduce.proto */
+#if !CYTHON_COMPILING_IN_LIMITED_API
+static int __Pyx_setup_reduce(PyObject* type_obj);
+#endif
+
 /* TypeImport.proto */
 #ifndef __PYX_HAVE_RT_ImportType_proto
 #define __PYX_HAVE_RT_ImportType_proto
 #if __STDC_VERSION__ >= 201112L
 #include <stdalign.h>
 #endif
 #if __STDC_VERSION__ >= 201112L || __cplusplus >= 201103L
@@ -2541,23 +2660,56 @@
    __Pyx_ImportType_CheckSize_Error = 0,
    __Pyx_ImportType_CheckSize_Warn = 1,
    __Pyx_ImportType_CheckSize_Ignore = 2
 };
 static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size);
 #endif
 
-/* Import.proto */
-static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);
-
-/* ImportFrom.proto */
-static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name);
-
 /* ImportDottedModule.proto */
 static PyObject *__Pyx_ImportDottedModule(PyObject *name, PyObject *parts_tuple);
 
+/* Py3UpdateBases.proto */
+static PyObject* __Pyx_PEP560_update_bases(PyObject *bases);
+
+/* SetNameInClass.proto */
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
+#define __Pyx_SetNameInClass(ns, name, value)\
+    (likely(PyDict_CheckExact(ns)) ? _PyDict_SetItem_KnownHash(ns, name, value, ((PyASCIIObject *) name)->hash) : PyObject_SetItem(ns, name, value))
+#elif CYTHON_COMPILING_IN_CPYTHON
+#define __Pyx_SetNameInClass(ns, name, value)\
+    (likely(PyDict_CheckExact(ns)) ? PyDict_SetItem(ns, name, value) : PyObject_SetItem(ns, name, value))
+#else
+#define __Pyx_SetNameInClass(ns, name, value)  PyObject_SetItem(ns, name, value)
+#endif
+
+/* SetNewInClass.proto */
+static int __Pyx_SetNewInClass(PyObject *ns, PyObject *name, PyObject *value);
+
+/* CalculateMetaclass.proto */
+static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases);
+
+/* PyObjectLookupSpecial.proto */
+#if CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
+#define __Pyx_PyObject_LookupSpecialNoError(obj, attr_name)  __Pyx__PyObject_LookupSpecial(obj, attr_name, 0)
+#define __Pyx_PyObject_LookupSpecial(obj, attr_name)  __Pyx__PyObject_LookupSpecial(obj, attr_name, 1)
+static CYTHON_INLINE PyObject* __Pyx__PyObject_LookupSpecial(PyObject* obj, PyObject* attr_name, int with_error);
+#else
+#define __Pyx_PyObject_LookupSpecialNoError(o,n) __Pyx_PyObject_GetAttrStrNoError(o,n)
+#define __Pyx_PyObject_LookupSpecial(o,n) __Pyx_PyObject_GetAttrStr(o,n)
+#endif
+
+/* Py3ClassCreate.proto */
+static PyObject *__Pyx_Py3MetaclassPrepare(PyObject *metaclass, PyObject *bases, PyObject *name, PyObject *qualname,
+                                           PyObject *mkw, PyObject *modname, PyObject *doc);
+static PyObject *__Pyx_Py3ClassCreate(PyObject *metaclass, PyObject *name, PyObject *bases, PyObject *dict,
+                                      PyObject *mkw, int calculate_metaclass, int allow_py2_metaclass);
+
+/* Globals.proto */
+static PyObject* __Pyx_Globals(void);
+
 /* CLineInTraceback.proto */
 #ifdef CYTHON_CLINE_IN_TRACEBACK
 #define __Pyx_CLineForTraceback(tstate, c_line)  (((CYTHON_CLINE_IN_TRACEBACK)) ? c_line : 0)
 #else
 static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line);
 #endif
 
@@ -2578,14 +2730,33 @@
 static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);
 #endif
 
 /* AddTraceback.proto */
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename);
 
+/* EnumClassDecl.proto */
+#if defined (_MSC_VER)
+  #if _MSC_VER >= 1910
+    #define __PYX_ENUM_CLASS_DECL enum
+  #else
+    #define __PYX_ENUM_CLASS_DECL
+  #endif
+#else
+  #define __PYX_ENUM_CLASS_DECL enum
+#endif
+
+/* None.proto */
+#include <new>
+
+/* GCCDiagnostics.proto */
+#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
+#define __Pyx_HAS_GCC_DIAGNOSTIC
+#endif
+
 /* CppExceptionConversion.proto */
 #ifndef __Pyx_CppExn2PyErr
 #include <new>
 #include <typeinfo>
 #include <stdexcept>
 #include <ios>
 static void __Pyx_CppExn2PyErr() {
@@ -2620,72 +2791,62 @@
   catch (...)
   {
     PyErr_SetString(PyExc_RuntimeError, "Unknown exception");
   }
 }
 #endif
 
-/* GCCDiagnostics.proto */
-#if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
-#define __Pyx_HAS_GCC_DIAGNOSTIC
-#endif
-
-/* None.proto */
-#include <new>
-
-/* EnumClassDecl.proto */
-#if defined (_MSC_VER)
-  #if _MSC_VER >= 1910
-    #define __PYX_ENUM_CLASS_DECL enum
-  #else
-    #define __PYX_ENUM_CLASS_DECL
-  #endif
-#else
-  #define __PYX_ENUM_CLASS_DECL enum
-#endif
-
 /* UnicodeAsUCS4.proto */
 static CYTHON_INLINE Py_UCS4 __Pyx_PyUnicode_AsPy_UCS4(PyObject*);
 
+/* CIntToPy.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);
+
+/* CIntFromPy.proto */
+static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);
+
 /* CIntFromPy.proto */
 static CYTHON_INLINE int64_t __Pyx_PyInt_As_int64_t(PyObject *);
 
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int64_t(int64_t value);
 
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
 
 /* CIntFromPy.proto */
+static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *);
+
+/* CIntToPy.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_uint32_t(uint32_t value);
+
+/* CIntFromPy.proto */
 static CYTHON_INLINE uint64_t __Pyx_PyInt_As_uint64_t(PyObject *);
 
 /* ObjectAsUCS4.proto */
 #define __Pyx_PyObject_AsPy_UCS4(x)\
     (likely(PyUnicode_Check(x)) ? __Pyx_PyUnicode_AsPy_UCS4(x) : __Pyx__PyObject_AsPy_UCS4(x))
 static Py_UCS4 __Pyx__PyObject_AsPy_UCS4(PyObject*);
 
+/* CIntFromPy.proto */
+static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);
+
 /* FormatTypeName.proto */
 #if CYTHON_COMPILING_IN_LIMITED_API
 typedef PyObject *__Pyx_TypeName;
 #define __Pyx_FMT_TYPENAME "%U"
 static __Pyx_TypeName __Pyx_PyType_GetName(PyTypeObject* tp);
 #define __Pyx_DECREF_TypeName(obj) Py_XDECREF(obj)
 #else
 typedef const char *__Pyx_TypeName;
 #define __Pyx_FMT_TYPENAME "%.200s"
 #define __Pyx_PyType_GetName(tp) ((tp)->tp_name)
 #define __Pyx_DECREF_TypeName(obj)
 #endif
 
-/* CIntFromPy.proto */
-static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);
-
-/* CIntFromPy.proto */
-static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);
-
 /* FastTypeChecks.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 #define __Pyx_TypeCheck(obj, type) __Pyx_IsSubtype(Py_TYPE(obj), (PyTypeObject *)type)
 #define __Pyx_TypeCheck2(obj, type1, type2) __Pyx_IsAnySubtype2(Py_TYPE(obj), (PyTypeObject *)type1, (PyTypeObject *)type2)
 static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b);
 static CYTHON_INLINE int __Pyx_IsAnySubtype2(PyTypeObject *cls, PyTypeObject *a, PyTypeObject *b);
 static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject *type);
@@ -2706,14 +2867,16 @@
 #if CYTHON_COMPILING_IN_LIMITED_API
 static int __Pyx_InitString(__Pyx_StringTabEntry t, PyObject **str);
 #else
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);
 #endif
 
 /* #### Code section: module_declarations ### */
+static CYTHON_INLINE double __pyx_f_7cpython_7complex_7complex_4real_real(PyComplexObject *__pyx_v_self); /* proto*/
+static CYTHON_INLINE double __pyx_f_7cpython_7complex_7complex_4imag_imag(PyComplexObject *__pyx_v_self); /* proto*/
 
 /* Module declarations from "libcpp" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
 /* Module declarations from "libcpp.vector" */
 #if !CYTHON_USE_MODULE_STATE
@@ -2748,350 +2911,691 @@
 #endif
 
 /* Module declarations from "cpython.type" */
 #if !CYTHON_USE_MODULE_STATE
 static PyTypeObject *__pyx_ptype_7cpython_4type_type = 0;
 #endif
 
-/* Module declarations from "cpython" */
+/* Module declarations from "cpython.version" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
-/* Module declarations from "cpython.object" */
+/* Module declarations from "cpython.ref" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
-/* Module declarations from "cpython.list" */
+/* Module declarations from "cpython.exc" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
-/* Module declarations from "cpython.ref" */
+/* Module declarations from "cpython.module" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
-/* Module declarations from "cpython.exc" */
+/* Module declarations from "cpython.mem" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
-/* Module declarations from "libc.stdlib" */
+/* Module declarations from "cpython.tuple" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
-/* Module declarations from "libc.stddef" */
+/* Module declarations from "cpython.sequence" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.mapping" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.iterator" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.number" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.int" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "__builtin__" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.bool" */
+#if !CYTHON_USE_MODULE_STATE
+static PyTypeObject *__pyx_ptype_7cpython_4bool_bool = 0;
+#endif
+
+/* Module declarations from "cpython.long" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.float" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "__builtin__" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.complex" */
+#if !CYTHON_USE_MODULE_STATE
+static PyTypeObject *__pyx_ptype_7cpython_7complex_complex = 0;
+#endif
+
+/* Module declarations from "cpython.string" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.unicode" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.pyport" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.dict" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.instance" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.function" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.method" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.weakref" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.getargs" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.pythread" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.pystate" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.cobject" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.oldbuffer" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.set" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.buffer" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.bytes" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
 /* Module declarations from "cpython.pycapsule" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
+/* Module declarations from "cpython.contextvars" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.object" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cpython.list" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "cython" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "libc.stdlib" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
+/* Module declarations from "libc.stddef" */
+#if !CYTHON_USE_MODULE_STATE
+#endif
+
 /* Module declarations from "rapidfuzz_capi" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 
 /* Module declarations from "cpp_common" */
 #if !CYTHON_USE_MODULE_STATE
 #endif
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_hash_array(PyObject *); /*proto*/
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_hash_sequence(PyObject *); /*proto*/
 static CYTHON_INLINE RF_String __pyx_f_10cpp_common_conv_sequence(PyObject *); /*proto*/
 static CYTHON_INLINE double __pyx_f_10cpp_common_get_score_cutoff_f64(PyObject *, RF_ScorerFlags const *); /*proto*/
 static CYTHON_INLINE int64_t __pyx_f_10cpp_common_get_score_cutoff_i64(PyObject *, RF_ScorerFlags const *); /*proto*/
 
-/* Module declarations from "rapidfuzz.process_cpp" */
+/* Module declarations from "rapidfuzz.process_cpp_impl" */
 #if !CYTHON_USE_MODULE_STATE
-static PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter = 0;
-static PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 = 0;
-static PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 = 0;
-static PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 = 0;
-static PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 = 0;
-static PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict = 0;
-static PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list = 0;
-#endif
-static CYTHON_INLINE std::vector<DictStringElem>  __pyx_f_9rapidfuzz_11process_cpp_preprocess_dict(PyObject *, PyObject *); /*proto*/
-static CYTHON_INLINE std::vector<ListStringElem>  __pyx_f_9rapidfuzz_11process_cpp_preprocess_list(PyObject *, PyObject *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_dict_f64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_dict_i64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_dict(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_list_f64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_list_i64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_list(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_get_scorer_flags_py(PyObject *, PyObject *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_py_extractOne_dict(PyObject *, PyObject *, PyObject *, PyObject *, double, PyObject *, PyObject *, PyObject *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_py_extractOne_list(PyObject *, PyObject *, PyObject *, PyObject *, double, PyObject *, PyObject *, PyObject *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_dict_f64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_dict_i64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_dict(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_list_f64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_list_i64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_list(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_py_extract_dict(PyObject *, PyObject *, PyObject *, PyObject *, int64_t, double, PyObject *, PyObject *, PyObject *); /*proto*/
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_py_extract_list(PyObject *, PyObject *, PyObject *, PyObject *, int64_t, double, PyObject *, PyObject *, PyObject *); /*proto*/
+static PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix = 0;
+static PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter = 0;
+static PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 = 0;
+static PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 = 0;
+static PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 = 0;
+static PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 = 0;
+static PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict = 0;
+static PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list = 0;
+static PyTypeObject *__pyx_ptype___Pyx_EnumMeta = 0;
+#endif
+static PyObject *__Pyx_OrderedDict = 0;
+static PyObject *__Pyx_EnumBase = 0;
+static PyObject *__Pyx_globals = 0;
+static CYTHON_INLINE std::vector<DictStringElem>  __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_dict(PyObject *, PyObject *); /*proto*/
+static CYTHON_INLINE std::vector<ListStringElem>  __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_list(PyObject *, PyObject *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_dict_f64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_dict_i64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_dict(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_list_f64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_list_i64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_list(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_get_scorer_flags_py(PyObject *, PyObject *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_py_extractOne_dict(PyObject *, PyObject *, PyObject *, PyObject *, double, PyObject *, PyObject *, PyObject *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_py_extractOne_list(PyObject *, PyObject *, PyObject *, PyObject *, double, PyObject *, PyObject *, PyObject *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_dict_f64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_dict_i64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_dict(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_list_f64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_list_i64(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_list(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, int64_t, PyObject *, RF_Kwargs const *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_py_extract_dict(PyObject *, PyObject *, PyObject *, PyObject *, int64_t, double, PyObject *, PyObject *, PyObject *); /*proto*/
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_py_extract_list(PyObject *, PyObject *, PyObject *, PyObject *, int64_t, double, PyObject *, PyObject *, PyObject *); /*proto*/
+static CYTHON_INLINE std::vector<PyObjectWrapper>  __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_py(PyObject *, PyObject *); /*proto*/
+static CYTHON_INLINE std::vector<RF_StringWrapper>  __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess(PyObject *, PyObject *); /*proto*/
+static CYTHON_INLINE __PYX_ENUM_CLASS_DECL MatrixType __pyx_f_9rapidfuzz_16process_cpp_impl_dtype_to_type_num_f64(PyObject *); /*proto*/
+static CYTHON_INLINE __PYX_ENUM_CLASS_DECL MatrixType __pyx_f_9rapidfuzz_16process_cpp_impl_dtype_to_type_num_i64(PyObject *); /*proto*/
+static PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_cdist_two_lists(PyObject *, PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, PyObject *, int, RF_Kwargs const *); /*proto*/
+static struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_f_9rapidfuzz_16process_cpp_impl_cdist_single_list(PyObject *, RF_Scorer *, RF_ScorerFlags const *, PyObject *, PyObject *, PyObject *, int, RF_Kwargs const *); /*proto*/
+static PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_cdist_py(PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *, PyObject *); /*proto*/
+static PyObject *__pyx_unpickle___Pyx_EnumMeta__set_state(struct __pyx_obj___Pyx_EnumMeta *, PyObject *); /*proto*/
 /* #### Code section: typeinfo ### */
 /* #### Code section: before_global_var ### */
-#define __Pyx_MODULE_NAME "rapidfuzz.process_cpp"
-extern int __pyx_module_is_main_rapidfuzz__process_cpp;
-int __pyx_module_is_main_rapidfuzz__process_cpp = 0;
+#define __Pyx_MODULE_NAME "rapidfuzz.process_cpp_impl"
+extern int __pyx_module_is_main_rapidfuzz__process_cpp_impl;
+int __pyx_module_is_main_rapidfuzz__process_cpp_impl = 0;
 
-/* Implementation of "rapidfuzz.process_cpp" */
+/* Implementation of "rapidfuzz.process_cpp_impl" */
 /* #### Code section: global_var ### */
 static PyObject *__pyx_builtin_enumerate;
 static PyObject *__pyx_builtin_ValueError;
 static PyObject *__pyx_builtin_range;
-static PyObject *__pyx_builtin_MemoryError;
 static PyObject *__pyx_builtin_TypeError;
+static PyObject *__pyx_builtin_MemoryError;
 /* #### Code section: string_decls ### */
 static const char __pyx_k_i[] = "i";
+static const char __pyx_k_v[] = "v";
 static const char __pyx_k_gc[] = "gc";
-static const char __pyx_k__16[] = " - ";
-static const char __pyx_k__17[] = ", ";
-static const char __pyx_k__18[] = ".";
-static const char __pyx_k__19[] = "*";
-static const char __pyx_k__23[] = "?";
+static const char __pyx_k__19[] = " - ";
+static const char __pyx_k__20[] = ", ";
+static const char __pyx_k__22[] = ".";
+static const char __pyx_k__23[] = "*";
+static const char __pyx_k__40[] = "?";
+static const char __pyx_k_cls[] = "cls";
+static const char __pyx_k_dct[] = "dct";
+static const char __pyx_k_doc[] = "__doc__";
 static const char __pyx_k_key[] = "key";
+static const char __pyx_k_new[] = "__new__";
+static const char __pyx_k_res[] = "res";
+static const char __pyx_k_s_s[] = "%s.%s";
+static const char __pyx_k_str[] = "__str__";
+static const char __pyx_k_INT8[] = "INT8";
 static const char __pyx_k_args[] = "args";
+static const char __pyx_k_dict[] = "__dict__";
+static const char __pyx_k_enum[] = "enum";
+static const char __pyx_k_init[] = "__init__";
 static const char __pyx_k_keys[] = "keys";
 static const char __pyx_k_main[] = "__main__";
-static const char __pyx_k_name[] = "__name__";
+static const char __pyx_k_name[] = "name";
+static const char __pyx_k_repr[] = "__repr__";
+static const char __pyx_k_self[] = "self";
 static const char __pyx_k_send[] = "send";
 static const char __pyx_k_spec[] = "__spec__";
 static const char __pyx_k_test[] = "__test__";
+static const char __pyx_k_INT16[] = "INT16";
+static const char __pyx_k_INT32[] = "INT32";
+static const char __pyx_k_INT64[] = "INT64";
+static const char __pyx_k_UINT8[] = "UINT8";
 static const char __pyx_k_array[] = "array";
+static const char __pyx_k_cdist[] = "cdist";
+static const char __pyx_k_class[] = "__class__";
 static const char __pyx_k_close[] = "close";
+static const char __pyx_k_dtype[] = "dtype";
 static const char __pyx_k_heapq[] = "heapq";
 static const char __pyx_k_items[] = "items";
 static const char __pyx_k_limit[] = "limit";
 static const char __pyx_k_query[] = "query";
 static const char __pyx_k_range[] = "range";
+static const char __pyx_k_ratio[] = "ratio";
+static const char __pyx_k_s_s_d[] = "<%s.%s: %d>";
 static const char __pyx_k_score[] = "score";
+static const char __pyx_k_state[] = "state";
+static const char __pyx_k_super[] = "super";
 static const char __pyx_k_throw[] = "throw";
+static const char __pyx_k_value[] = "value";
+static const char __pyx_k_Matrix[] = "Matrix";
+static const char __pyx_k_UINT16[] = "UINT16";
+static const char __pyx_k_UINT32[] = "UINT32";
+static const char __pyx_k_UINT64[] = "UINT64";
 static const char __pyx_k_WRatio[] = "WRatio";
 static const char __pyx_k_choice[] = "choice";
+static const char __pyx_k_dict_2[] = "_dict";
 static const char __pyx_k_enable[] = "enable";
 static const char __pyx_k_import[] = "__import__";
 static const char __pyx_k_kwargs[] = "kwargs";
+static const char __pyx_k_module[] = "__module__";
+static const char __pyx_k_name_2[] = "__name__";
+static const char __pyx_k_pickle[] = "pickle";
+static const char __pyx_k_reduce[] = "__reduce__";
 static const char __pyx_k_scorer[] = "scorer";
+static const char __pyx_k_update[] = "update";
+static const char __pyx_k_values[] = "values";
+static const char __pyx_k_FLOAT32[] = "FLOAT32";
+static const char __pyx_k_FLOAT64[] = "FLOAT64";
+static const char __pyx_k_IntEnum[] = "IntEnum";
 static const char __pyx_k_choices[] = "choices";
 static const char __pyx_k_disable[] = "disable";
 static const char __pyx_k_extract[] = "extract";
+static const char __pyx_k_members[] = "__members__";
+static const char __pyx_k_parents[] = "parents";
+static const char __pyx_k_prepare[] = "__prepare__";
+static const char __pyx_k_queries[] = "queries";
+static const char __pyx_k_workers[] = "workers";
+static const char __pyx_k_EnumBase[] = "EnumBase";
+static const char __pyx_k_getstate[] = "__getstate__";
 static const char __pyx_k_nlargest[] = "nlargest";
 static const char __pyx_k_proc_str[] = "proc_str";
+static const char __pyx_k_pyx_type[] = "__pyx_type";
+static const char __pyx_k_qualname[] = "__qualname__";
+static const char __pyx_k_set_name[] = "__set_name__";
+static const char __pyx_k_setstate[] = "__setstate__";
 static const char __pyx_k_typecode[] = "typecode";
 static const char __pyx_k_RF_Scorer[] = "_RF_Scorer";
 static const char __pyx_k_TypeError[] = "TypeError";
+static const char __pyx_k_UNDEFINED[] = "UNDEFINED";
 static const char __pyx_k_enumerate[] = "enumerate";
 static const char __pyx_k_isenabled[] = "isenabled";
+static const char __pyx_k_metaclass[] = "__metaclass__";
 static const char __pyx_k_nsmallest[] = "nsmallest";
 static const char __pyx_k_processor[] = "processor";
+static const char __pyx_k_pyx_state[] = "__pyx_state";
+static const char __pyx_k_reduce_ex[] = "__reduce_ex__";
+static const char __pyx_k_MatrixType[] = "MatrixType";
 static const char __pyx_k_ScorerFunc[] = "ScorerFunc";
 static const char __pyx_k_ValueError[] = "ValueError";
 static const char __pyx_k_choice_key[] = "choice_key";
 static const char __pyx_k_extractOne[] = "extractOne";
+static const char __pyx_k_pyx_result[] = "__pyx_result";
 static const char __pyx_k_query_proc[] = "query_proc";
 static const char __pyx_k_MemoryError[] = "MemoryError";
+static const char __pyx_k_OrderedDict[] = "OrderedDict";
+static const char __pyx_k_PickleError[] = "PickleError";
 static const char __pyx_k_RF_ScorerPy[] = "_RF_ScorerPy";
 static const char __pyx_k_choice_proc[] = "choice_proc";
+static const char __pyx_k_collections[] = "collections";
+static const char __pyx_k_mro_entries[] = "__mro_entries__";
 static const char __pyx_k_proc_choice[] = "proc_choice";
 static const char __pyx_k_scorer_func[] = "scorer_func";
 static const char __pyx_k_worst_score[] = "worst_score";
+static const char __pyx_k_Pyx_EnumBase[] = "__Pyx_EnumBase";
 static const char __pyx_k_extract_iter[] = "extract_iter";
 static const char __pyx_k_initializing[] = "_initializing";
 static const char __pyx_k_is_coroutine[] = "_is_coroutine";
+static const char __pyx_k_pyx_checksum[] = "__pyx_checksum";
 static const char __pyx_k_score_cutoff[] = "score_cutoff";
 static const char __pyx_k_scorer_flags[] = "scorer_flags";
+static const char __pyx_k_stringsource[] = "<stringsource>";
+static const char __pyx_k_use_setstate[] = "use_setstate";
 static const char __pyx_k_RF_Preprocess[] = "_RF_Preprocess";
+static const char __pyx_k_class_getitem[] = "__class_getitem__";
+static const char __pyx_k_init_subclass[] = "__init_subclass__";
 static const char __pyx_k_optimal_score[] = "optimal_score";
+static const char __pyx_k_reduce_cython[] = "__reduce_cython__";
 static const char __pyx_k_c_score_cutoff[] = "c_score_cutoff";
 static const char __pyx_k_kwargs_context[] = "kwargs_context";
 static const char __pyx_k_rapidfuzz_fuzz[] = "rapidfuzz.fuzz";
 static const char __pyx_k_scorer_capsule[] = "scorer_capsule";
 static const char __pyx_k_scorer_context[] = "scorer_context";
 static const char __pyx_k_default_process[] = "default_process";
+static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
 static const char __pyx_k_rapidfuzz_utils[] = "rapidfuzz.utils";
+static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
 static const char __pyx_k_get_scorer_flags[] = "get_scorer_flags";
 static const char __pyx_k_processor_capsule[] = "processor_capsule";
 static const char __pyx_k_processor_context[] = "processor_context";
+static const char __pyx_k_Pyx_EnumBase___new[] = "__Pyx_EnumBase.__new__";
+static const char __pyx_k_Pyx_EnumBase___str[] = "__Pyx_EnumBase.__str__";
 static const char __pyx_k_asyncio_coroutines[] = "asyncio.coroutines";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_lowest_score_worst[] = "lowest_score_worst";
-static const char __pyx_k_extractOne_line_547[] = "extractOne (line 547)";
+static const char __pyx_k_Pyx_EnumBase___repr[] = "__Pyx_EnumBase.__repr__";
+static const char __pyx_k_Unknown_enum_value_s[] = "Unknown enum value: '%s'";
 static const char __pyx_k_py_extract_iter_dict[] = "py_extract_iter_dict";
 static const char __pyx_k_py_extract_iter_list[] = "py_extract_iter_list";
 static const char __pyx_k_extract_iter_dict_f64[] = "extract_iter_dict_f64";
 static const char __pyx_k_extract_iter_dict_i64[] = "extract_iter_dict_i64";
 static const char __pyx_k_extract_iter_list_f64[] = "extract_iter_list_f64";
 static const char __pyx_k_extract_iter_list_i64[] = "extract_iter_list_i64";
-static const char __pyx_k_rapidfuzz_process_cpp[] = "rapidfuzz.process_cpp";
+static const char __pyx_k_Matrix___reduce_cython[] = "Matrix.__reduce_cython__";
+static const char __pyx_k_Matrix___setstate_cython[] = "Matrix.__setstate_cython__";
+static const char __pyx_k_rapidfuzz_process_cpp_impl[] = "rapidfuzz.process_cpp_impl";
+static const char __pyx_k_pyx_unpickle___Pyx_EnumMeta[] = "__pyx_unpickle___Pyx_EnumMeta";
+static const char __pyx_k_Pyx_EnumMeta___reduce_cython[] = "__Pyx_EnumMeta.__reduce_cython__";
 static const char __pyx_k_py_extract_dict_locals_lambda[] = "py_extract_dict.<locals>.<lambda>";
 static const char __pyx_k_py_extract_list_locals_lambda[] = "py_extract_list.<locals>.<lambda>";
-static const char __pyx_k_src_rapidfuzz_process_cpp_pyx[] = "src/rapidfuzz/process_cpp.pyx";
-static const char __pyx_k_Find_the_best_match_in_a_list_o[] = "\n    Find the best match in a list of choices. When multiple elements have the same similarity,\n    the first element is returned.\n\n    Parameters\n    ----------\n    query : Sequence[Hashable]\n        string we want to find\n    choices : Iterable[Sequence[Hashable]] | Mapping[Sequence[Hashable]]\n        list of all strings the query should be compared with or dict with a mapping\n        {<result>: <string to compare>}\n    scorer : Callable, optional\n        Optional callable that is used to calculate the matching score between\n        the query and each choice. This can be any of the scorers included in RapidFuzz\n        (both scorers that calculate the edit distance or the normalized edit distance), or\n        a custom function, which returns a normalized edit distance.\n        fuzz.WRatio is used by default.\n    processor : Callable, optional\n        Optional callable that reformats the strings.\n        utils.default_process is used by default, which lowercases the strings and trims whitespace\n    score_cutoff : Any, optional\n        Optional argument for a score threshold. When an edit distance is used this represents the maximum\n        edit distance and matches with a `distance <= score_cutoff` are ignored. When a\n        normalized edit distance is used this represents the minimal similarity\n        and matches with a `similarity >= score_cutoff` are ignored. Default is None, which deactivates this behaviour.\n    **kwargs : Any, optional\n        any other named parameters are passed to the scorer. This can be used to pass\n        e.g. weights to string_metric.levenshtein\n\n    Returns\n    -------\n    Tuple[Sequence[Hashable], Any, Any]\n        Returns the best match in form of a Tuple with 3 elements. The values stored in the\n        tuple depend on the types of the input arguments.\n\n        * The first element is always the `choice`, which is the value thats compared to the query.\n\n        * The second value represents the ""similarity calculated by the scorer. This can be:\n\n          * An edit distance (distance is 0 for a perfect match and > 0 for non perfect matches).\n            In this case only choices which have a `distance <= score_cutoff` are returned.\n            An example of a scorer with this behavior is `string_metric.levenshtein`.\n          * A normalized edit distance (similarity is a score between 0 and 100, with 100 being a perfect match).\n            In this case only choices which have a `similarity >= score_cutoff` are returned.\n            An example of a scorer with this behavior is `string_metric.normalized_levenshtein`.\n\n          Note, that for all scorers, which are not provided by RapidFuzz, only normalized edit distances are supported.\n\n        * The third parameter depends on the type of the `choices` argument it is:\n\n          * The `index of choice` when choices is a simple iterable like a list\n          * The `key of choice` when choices is a mapping like a dict, or a pandas Series\n\n    None\n        When no choice has a `similarity >= score_cutoff`/`distance <= score_cutoff` None is returned\n\n    Examples\n    --------\n\n    >>> from rapidfuzz.process import extractOne\n    >>> from rapidfuzz.string_metric import levenshtein, normalized_levenshtein\n    >>> from rapidfuzz.fuzz import ratio\n\n    extractOne can be used with normalized edit distances.\n\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=ratio)\n    (\"abcd\", 75.0, 1)\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=normalized_levenshtein)\n    (\"abcd\", 75.0, 1)\n\n    extractOne can be used with edit distances as well.\n\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=levenshtein)\n    (\"abce\", 1, 0)\n\n    additional settings of the scorer can be passed as keyword arguments to extractOne\n\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=levenshtein, weights=(1,1,2))\n    (\"abcde\", 2, 1)\n\n    when a mapping is used for the choices the key of the choice is retu""rned instead of the List index\n\n    >>> extractOne(\"abcd\", {\"key\": \"abce\"}, scorer=ratio)\n    (\"abcd\", 75.0, \"key\")\n\n    By default each string is preprocessed using `utils.default_process`, which lowercases the strings,\n    replaces non alphanumeric characters with whitespaces and trims whitespaces from start and end of them.\n    This behavior can be changed by passing a custom function, or None to disable the behavior. Preprocessing\n    can take a significant part of the runtime, so it makes sense to disable it, when it is not required.\n\n\n    >>> extractOne(\"abcd\", [\"abdD\"], scorer=ratio)\n    (\"abcD\", 100.0, 0)\n    >>> extractOne(\"abcd\", [\"abdD\"], scorer=ratio, processor=None)\n    (\"abcD\", 75.0, 0)\n    >>> extractOne(\"abcd\", [\"abdD\"], scorer=ratio, processor=lambda s: s.upper())\n    (\"abcD\", 100.0, 0)\n\n    When only results with a similarity above a certain threshold are relevant, the parameter score_cutoff can be\n    used to filter out results with a lower similarity. This threshold is used by some of the scorers to exit early,\n    when they are sure, that the similarity is below the threshold.\n    For normalized edit distances all results with a similarity below score_cutoff are filtered out\n\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=ratio)\n    (\"abce\", 75.0, 0)\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=ratio, score_cutoff=80)\n    None\n\n    For edit distances all results with an edit distance above the score_cutoff are filtered out\n\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=levenshtein, weights=(1,1,2))\n    (\"abce\", 2, 0)\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=levenshtein, weights=(1,1,2), score_cutoff=1)\n    None\n\n    ";
+static const char __pyx_k_Pyx_EnumMeta___setstate_cython[] = "__Pyx_EnumMeta.__setstate_cython__";
+static const char __pyx_k_self_matrix_cannot_be_converted[] = "self.matrix cannot be converted to a Python object for pickling";
 static const char __pyx_k_Got_unexpected_keyword_arguments[] = "Got unexpected keyword arguments: ";
+static const char __pyx_k_Incompatible_checksums_0x_x_vs_0[] = "Incompatible checksums (0x%x vs (0xe3b0c44, 0xda39a3e, 0xd41d8cd) = ())";
 static const char __pyx_k_extract_iter_locals_extract_iter[] = "extract_iter.<locals>.extract_iter_dict_f64";
 static const char __pyx_k_extract_iter_locals_py_extract_i[] = "extract_iter.<locals>.py_extract_iter_dict";
 static const char __pyx_k_score_cutoff_has_to_be_in_the_ra[] = "score_cutoff has to be in the range of ";
 static const char __pyx_k_scorer_does_not_properly_use_the[] = "scorer does not properly use the C-API";
+static const char __pyx_k_src_rapidfuzz_process_cpp_impl_p[] = "src/rapidfuzz/process_cpp_impl.pyx";
 static const char __pyx_k_extract_iter_locals_extract_iter_2[] = "extract_iter.<locals>.extract_iter_dict_i64";
 static const char __pyx_k_extract_iter_locals_extract_iter_3[] = "extract_iter.<locals>.extract_iter_list_f64";
 static const char __pyx_k_extract_iter_locals_extract_iter_4[] = "extract_iter.<locals>.extract_iter_list_i64";
 static const char __pyx_k_extract_iter_locals_py_extract_i_2[] = "extract_iter.<locals>.py_extract_iter_list";
 #if !CYTHON_USE_MODULE_STATE
-static PyObject *__pyx_kp_u_Find_the_best_match_in_a_list_o;
+static PyObject *__pyx_n_s_EnumBase;
+static PyObject *__pyx_n_s_FLOAT32;
+static PyObject *__pyx_n_s_FLOAT64;
 static PyObject *__pyx_kp_u_Got_unexpected_keyword_arguments;
+static PyObject *__pyx_n_s_INT16;
+static PyObject *__pyx_n_s_INT32;
+static PyObject *__pyx_n_s_INT64;
+static PyObject *__pyx_n_s_INT8;
+static PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0;
+static PyObject *__pyx_n_s_IntEnum;
+static PyObject *__pyx_n_s_Matrix;
+static PyObject *__pyx_n_s_MatrixType;
+static PyObject *__pyx_n_s_Matrix___reduce_cython;
+static PyObject *__pyx_n_s_Matrix___setstate_cython;
 static PyObject *__pyx_n_s_MemoryError;
+static PyObject *__pyx_n_s_OrderedDict;
+static PyObject *__pyx_n_s_PickleError;
+static PyObject *__pyx_n_s_Pyx_EnumBase;
+static PyObject *__pyx_n_s_Pyx_EnumBase___new;
+static PyObject *__pyx_n_s_Pyx_EnumBase___repr;
+static PyObject *__pyx_n_s_Pyx_EnumBase___str;
+static PyObject *__pyx_n_s_Pyx_EnumMeta___reduce_cython;
+static PyObject *__pyx_n_s_Pyx_EnumMeta___setstate_cython;
 static PyObject *__pyx_n_u_RF_Preprocess;
 static PyObject *__pyx_n_s_RF_Scorer;
 static PyObject *__pyx_n_u_RF_Scorer;
 static PyObject *__pyx_n_s_RF_ScorerPy;
 static PyObject *__pyx_n_u_RF_ScorerPy;
 static PyObject *__pyx_n_s_ScorerFunc;
 static PyObject *__pyx_n_s_TypeError;
+static PyObject *__pyx_n_s_UINT16;
+static PyObject *__pyx_n_s_UINT32;
+static PyObject *__pyx_n_s_UINT64;
+static PyObject *__pyx_n_s_UINT8;
+static PyObject *__pyx_n_s_UNDEFINED;
+static PyObject *__pyx_kp_s_Unknown_enum_value_s;
 static PyObject *__pyx_n_s_ValueError;
 static PyObject *__pyx_n_s_WRatio;
-static PyObject *__pyx_kp_u__16;
-static PyObject *__pyx_kp_u__17;
-static PyObject *__pyx_kp_u__18;
-static PyObject *__pyx_n_s__19;
+static PyObject *__pyx_kp_u__19;
+static PyObject *__pyx_kp_u__20;
+static PyObject *__pyx_kp_u__22;
 static PyObject *__pyx_n_s__23;
+static PyObject *__pyx_n_s__40;
 static PyObject *__pyx_n_s_args;
 static PyObject *__pyx_n_s_array;
 static PyObject *__pyx_n_s_asyncio_coroutines;
 static PyObject *__pyx_n_s_c_score_cutoff;
+static PyObject *__pyx_n_s_cdist;
 static PyObject *__pyx_n_s_choice;
 static PyObject *__pyx_n_s_choice_key;
 static PyObject *__pyx_n_s_choice_proc;
 static PyObject *__pyx_n_s_choices;
+static PyObject *__pyx_n_s_class;
+static PyObject *__pyx_n_s_class_getitem;
 static PyObject *__pyx_n_s_cline_in_traceback;
 static PyObject *__pyx_n_s_close;
+static PyObject *__pyx_n_s_cls;
+static PyObject *__pyx_n_s_collections;
+static PyObject *__pyx_n_s_dct;
 static PyObject *__pyx_n_s_default_process;
+static PyObject *__pyx_n_s_dict;
+static PyObject *__pyx_n_s_dict_2;
 static PyObject *__pyx_kp_u_disable;
+static PyObject *__pyx_n_s_doc;
+static PyObject *__pyx_n_s_dtype;
 static PyObject *__pyx_kp_u_enable;
+static PyObject *__pyx_n_s_enum;
 static PyObject *__pyx_n_s_enumerate;
 static PyObject *__pyx_n_s_extract;
 static PyObject *__pyx_n_s_extractOne;
-static PyObject *__pyx_kp_u_extractOne_line_547;
 static PyObject *__pyx_n_s_extract_iter;
 static PyObject *__pyx_n_s_extract_iter_dict_f64;
 static PyObject *__pyx_n_s_extract_iter_dict_i64;
 static PyObject *__pyx_n_s_extract_iter_list_f64;
 static PyObject *__pyx_n_s_extract_iter_list_i64;
 static PyObject *__pyx_n_s_extract_iter_locals_extract_iter;
 static PyObject *__pyx_n_s_extract_iter_locals_extract_iter_2;
 static PyObject *__pyx_n_s_extract_iter_locals_extract_iter_3;
 static PyObject *__pyx_n_s_extract_iter_locals_extract_iter_4;
 static PyObject *__pyx_n_s_extract_iter_locals_py_extract_i;
 static PyObject *__pyx_n_s_extract_iter_locals_py_extract_i_2;
 static PyObject *__pyx_kp_u_gc;
 static PyObject *__pyx_n_u_get_scorer_flags;
+static PyObject *__pyx_n_s_getstate;
 static PyObject *__pyx_n_s_heapq;
 static PyObject *__pyx_n_s_i;
 static PyObject *__pyx_n_s_import;
+static PyObject *__pyx_n_s_init;
+static PyObject *__pyx_n_s_init_subclass;
 static PyObject *__pyx_n_s_initializing;
 static PyObject *__pyx_n_s_is_coroutine;
 static PyObject *__pyx_kp_u_isenabled;
 static PyObject *__pyx_n_s_items;
 static PyObject *__pyx_n_u_items;
 static PyObject *__pyx_n_s_key;
 static PyObject *__pyx_n_s_keys;
 static PyObject *__pyx_n_s_kwargs;
 static PyObject *__pyx_n_s_kwargs_context;
 static PyObject *__pyx_n_s_limit;
 static PyObject *__pyx_n_s_lowest_score_worst;
 static PyObject *__pyx_n_s_main;
+static PyObject *__pyx_n_s_members;
+static PyObject *__pyx_n_s_metaclass;
+static PyObject *__pyx_n_s_module;
+static PyObject *__pyx_n_s_mro_entries;
 static PyObject *__pyx_n_s_name;
+static PyObject *__pyx_n_s_name_2;
+static PyObject *__pyx_n_s_new;
 static PyObject *__pyx_n_s_nlargest;
 static PyObject *__pyx_n_s_nsmallest;
 static PyObject *__pyx_n_s_optimal_score;
 static PyObject *__pyx_n_u_optimal_score;
+static PyObject *__pyx_n_s_parents;
+static PyObject *__pyx_n_s_pickle;
+static PyObject *__pyx_n_s_prepare;
 static PyObject *__pyx_n_s_proc_choice;
 static PyObject *__pyx_n_s_proc_str;
 static PyObject *__pyx_n_s_processor;
 static PyObject *__pyx_n_u_processor;
 static PyObject *__pyx_n_s_processor_capsule;
 static PyObject *__pyx_n_s_processor_context;
 static PyObject *__pyx_n_s_py_extract_dict_locals_lambda;
 static PyObject *__pyx_n_s_py_extract_iter_dict;
 static PyObject *__pyx_n_s_py_extract_iter_list;
 static PyObject *__pyx_n_s_py_extract_list_locals_lambda;
+static PyObject *__pyx_n_s_pyx_PickleError;
+static PyObject *__pyx_n_s_pyx_checksum;
+static PyObject *__pyx_n_s_pyx_result;
+static PyObject *__pyx_n_s_pyx_state;
+static PyObject *__pyx_n_s_pyx_type;
+static PyObject *__pyx_n_s_pyx_unpickle___Pyx_EnumMeta;
+static PyObject *__pyx_n_s_qualname;
+static PyObject *__pyx_n_s_queries;
 static PyObject *__pyx_n_s_query;
 static PyObject *__pyx_n_s_query_proc;
 static PyObject *__pyx_n_s_range;
 static PyObject *__pyx_n_s_rapidfuzz_fuzz;
-static PyObject *__pyx_n_s_rapidfuzz_process_cpp;
+static PyObject *__pyx_n_s_rapidfuzz_process_cpp_impl;
 static PyObject *__pyx_n_s_rapidfuzz_utils;
+static PyObject *__pyx_n_s_ratio;
+static PyObject *__pyx_n_s_reduce;
+static PyObject *__pyx_n_s_reduce_cython;
+static PyObject *__pyx_n_s_reduce_ex;
+static PyObject *__pyx_n_s_repr;
+static PyObject *__pyx_n_s_res;
+static PyObject *__pyx_kp_s_s_s;
+static PyObject *__pyx_kp_s_s_s_d;
 static PyObject *__pyx_n_s_score;
 static PyObject *__pyx_n_s_score_cutoff;
 static PyObject *__pyx_n_u_score_cutoff;
 static PyObject *__pyx_kp_u_score_cutoff_has_to_be_in_the_ra;
 static PyObject *__pyx_n_s_scorer;
 static PyObject *__pyx_n_s_scorer_capsule;
 static PyObject *__pyx_n_s_scorer_context;
 static PyObject *__pyx_kp_u_scorer_does_not_properly_use_the;
 static PyObject *__pyx_n_s_scorer_flags;
 static PyObject *__pyx_n_s_scorer_func;
+static PyObject *__pyx_n_s_self;
+static PyObject *__pyx_kp_s_self_matrix_cannot_be_converted;
 static PyObject *__pyx_n_s_send;
+static PyObject *__pyx_n_s_set_name;
+static PyObject *__pyx_n_s_setstate;
+static PyObject *__pyx_n_s_setstate_cython;
 static PyObject *__pyx_n_s_spec;
-static PyObject *__pyx_kp_s_src_rapidfuzz_process_cpp_pyx;
+static PyObject *__pyx_kp_s_src_rapidfuzz_process_cpp_impl_p;
+static PyObject *__pyx_n_s_state;
+static PyObject *__pyx_n_s_str;
+static PyObject *__pyx_kp_s_stringsource;
+static PyObject *__pyx_n_s_super;
 static PyObject *__pyx_n_s_test;
 static PyObject *__pyx_n_s_throw;
 static PyObject *__pyx_n_s_typecode;
+static PyObject *__pyx_n_s_update;
+static PyObject *__pyx_n_s_use_setstate;
+static PyObject *__pyx_n_s_v;
+static PyObject *__pyx_n_s_value;
+static PyObject *__pyx_n_s_values;
+static PyObject *__pyx_n_s_workers;
 static PyObject *__pyx_n_s_worst_score;
 static PyObject *__pyx_n_u_worst_score;
 #endif
 /* #### Code section: decls ### */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_7__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_extractOne(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_9__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_extractOne(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs); /* proto */
 static PyObject *__pyx_lambda_funcdef_lambda(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_i); /* proto */
 static PyObject *__pyx_lambda_funcdef_lambda1(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_i); /* proto */
 static PyObject *__pyx_lambda_funcdef_lambda2(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_i); /* proto */
 static PyObject *__pyx_lambda_funcdef_lambda3(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_i); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_9__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_2extract(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_limit, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_11__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_4extract_iter(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_extract_iter_dict_f64(PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_3extract_iter_dict_i64(PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_6extract_iter_list_f64(PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_9extract_iter_list_i64(PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_12py_extract_iter_dict(PyObject *__pyx_self, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score); /* proto */
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_15py_extract_iter_list(PyObject *__pyx_self, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score); /* proto */
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_11__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_2extract(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_limit, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_13__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_4extract_iter(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_extract_iter_dict_f64(PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_3extract_iter_dict_i64(PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_6extract_iter_list_f64(PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_9extract_iter_list_i64(PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_12py_extract_iter_dict(PyObject *__pyx_self, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_15py_extract_iter_list(PyObject *__pyx_self, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score); /* proto */
+static int __pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix___getbuffer__(struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_self, Py_buffer *__pyx_v_buffer, CYTHON_UNUSED int __pyx_v_flags); /* proto */
+static void __pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix_2__releasebuffer__(CYTHON_UNUSED struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_self, CYTHON_UNUSED Py_buffer *__pyx_v_buffer); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix_4__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix_6__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_15__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_7cdist(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_queries, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_dtype, PyObject *__pyx_v_workers, PyObject *__pyx_v_kwargs); /* proto */
+static int __pyx_pf_8EnumBase_14__Pyx_EnumMeta___init__(struct __pyx_obj___Pyx_EnumMeta *__pyx_v_cls, PyObject *__pyx_v_name, PyObject *__pyx_v_parents, PyObject *__pyx_v_dct); /* proto */
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumMeta_2__iter__(struct __pyx_obj___Pyx_EnumMeta *__pyx_v_cls); /* proto */
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumMeta_4__getitem__(struct __pyx_obj___Pyx_EnumMeta *__pyx_v_cls, PyObject *__pyx_v_name); /* proto */
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumMeta_6__reduce_cython__(struct __pyx_obj___Pyx_EnumMeta *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumMeta_8__setstate_cython__(struct __pyx_obj___Pyx_EnumMeta *__pyx_v_self, PyObject *__pyx_v___pyx_state); /* proto */
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumBase___new__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_cls, PyObject *__pyx_v_value, PyObject *__pyx_v_name); /* proto */
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumBase_2__repr__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumBase_4__str__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_8EnumBase___pyx_unpickle___Pyx_EnumMeta(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state); /* proto */
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl_Matrix(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static __Pyx_CachedCFunction __pyx_umethod_PyDict_Type_keys = {0, 0, 0, 0, 0};
 #if !CYTHON_USE_MODULE_STATE
 static PyObject *__pyx_int_0;
 static PyObject *__pyx_int_1;
 static PyObject *__pyx_int_5;
 static PyObject *__pyx_int_100;
+static PyObject *__pyx_int_222419149;
+static PyObject *__pyx_int_228825662;
+static PyObject *__pyx_int_238750788;
 static PyObject *__pyx_int_neg_1;
 #endif
 #if !CYTHON_USE_MODULE_STATE
 static PyObject *__pyx_tuple_;
 static PyObject *__pyx_tuple__2;
 static PyObject *__pyx_tuple__6;
 static PyObject *__pyx_tuple__9;
 static PyObject *__pyx_tuple__12;
 static PyObject *__pyx_tuple__14;
-static PyObject *__pyx_tuple__20;
 static PyObject *__pyx_tuple__21;
-static PyObject *__pyx_tuple__22;
+static PyObject *__pyx_tuple__24;
+static PyObject *__pyx_tuple__25;
+static PyObject *__pyx_tuple__26;
+static PyObject *__pyx_tuple__27;
+static PyObject *__pyx_tuple__28;
+static PyObject *__pyx_tuple__29;
+static PyObject *__pyx_tuple__30;
+static PyObject *__pyx_tuple__33;
+static PyObject *__pyx_tuple__35;
+static PyObject *__pyx_tuple__38;
 static PyObject *__pyx_codeobj__3;
 static PyObject *__pyx_codeobj__4;
 static PyObject *__pyx_codeobj__5;
 static PyObject *__pyx_codeobj__7;
 static PyObject *__pyx_codeobj__8;
 static PyObject *__pyx_codeobj__10;
 static PyObject *__pyx_codeobj__11;
 static PyObject *__pyx_codeobj__13;
 static PyObject *__pyx_codeobj__15;
+static PyObject *__pyx_codeobj__16;
+static PyObject *__pyx_codeobj__17;
+static PyObject *__pyx_codeobj__18;
+static PyObject *__pyx_codeobj__31;
+static PyObject *__pyx_codeobj__32;
+static PyObject *__pyx_codeobj__34;
+static PyObject *__pyx_codeobj__36;
+static PyObject *__pyx_codeobj__37;
+static PyObject *__pyx_codeobj__39;
 #endif
 /* #### Code section: late_includes ### */
 /* #### Code section: module_state ### */
 #if CYTHON_USE_MODULE_STATE
 typedef struct {
   PyObject *__pyx_d;
   PyObject *__pyx_b;
@@ -3102,152 +3606,257 @@
   #ifdef __Pyx_CyFunction_USED
   PyTypeObject *__pyx_CyFunctionType;
   #endif
   #ifdef __Pyx_FusedFunction_USED
   PyTypeObject *__pyx_FusedFunctionType;
   #endif
   PyTypeObject *__pyx_ptype_7cpython_4type_type;
-  PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter;
-  PyObject *__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter;
-  PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64;
-  PyObject *__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64;
-  PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64;
-  PyObject *__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64;
-  PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64;
-  PyObject *__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64;
-  PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64;
-  PyObject *__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64;
-  PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict;
-  PyObject *__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict;
-  PyTypeObject *__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list;
-  PyObject *__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list;
-  PyObject *__pyx_kp_u_Find_the_best_match_in_a_list_o;
+  PyTypeObject *__pyx_ptype_7cpython_4bool_bool;
+  PyTypeObject *__pyx_ptype_7cpython_7complex_complex;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix;
+  PyObject *__pyx_type_9rapidfuzz_16process_cpp_impl_Matrix;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter;
+  PyObject *__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64;
+  PyObject *__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64;
+  PyObject *__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64;
+  PyObject *__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64;
+  PyObject *__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict;
+  PyObject *__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict;
+  PyTypeObject *__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list;
+  PyObject *__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list;
+  PyTypeObject *__pyx_ptype___Pyx_EnumMeta;
+  PyObject *__Pyx_EnumMeta;
+  PyObject *__pyx_n_s_EnumBase;
+  PyObject *__pyx_n_s_FLOAT32;
+  PyObject *__pyx_n_s_FLOAT64;
   PyObject *__pyx_kp_u_Got_unexpected_keyword_arguments;
+  PyObject *__pyx_n_s_INT16;
+  PyObject *__pyx_n_s_INT32;
+  PyObject *__pyx_n_s_INT64;
+  PyObject *__pyx_n_s_INT8;
+  PyObject *__pyx_kp_s_Incompatible_checksums_0x_x_vs_0;
+  PyObject *__pyx_n_s_IntEnum;
+  PyObject *__pyx_n_s_Matrix;
+  PyObject *__pyx_n_s_MatrixType;
+  PyObject *__pyx_n_s_Matrix___reduce_cython;
+  PyObject *__pyx_n_s_Matrix___setstate_cython;
   PyObject *__pyx_n_s_MemoryError;
+  PyObject *__pyx_n_s_OrderedDict;
+  PyObject *__pyx_n_s_PickleError;
+  PyObject *__pyx_n_s_Pyx_EnumBase;
+  PyObject *__pyx_n_s_Pyx_EnumBase___new;
+  PyObject *__pyx_n_s_Pyx_EnumBase___repr;
+  PyObject *__pyx_n_s_Pyx_EnumBase___str;
+  PyObject *__pyx_n_s_Pyx_EnumMeta___reduce_cython;
+  PyObject *__pyx_n_s_Pyx_EnumMeta___setstate_cython;
   PyObject *__pyx_n_u_RF_Preprocess;
   PyObject *__pyx_n_s_RF_Scorer;
   PyObject *__pyx_n_u_RF_Scorer;
   PyObject *__pyx_n_s_RF_ScorerPy;
   PyObject *__pyx_n_u_RF_ScorerPy;
   PyObject *__pyx_n_s_ScorerFunc;
   PyObject *__pyx_n_s_TypeError;
+  PyObject *__pyx_n_s_UINT16;
+  PyObject *__pyx_n_s_UINT32;
+  PyObject *__pyx_n_s_UINT64;
+  PyObject *__pyx_n_s_UINT8;
+  PyObject *__pyx_n_s_UNDEFINED;
+  PyObject *__pyx_kp_s_Unknown_enum_value_s;
   PyObject *__pyx_n_s_ValueError;
   PyObject *__pyx_n_s_WRatio;
-  PyObject *__pyx_kp_u__16;
-  PyObject *__pyx_kp_u__17;
-  PyObject *__pyx_kp_u__18;
-  PyObject *__pyx_n_s__19;
+  PyObject *__pyx_kp_u__19;
+  PyObject *__pyx_kp_u__20;
+  PyObject *__pyx_kp_u__22;
   PyObject *__pyx_n_s__23;
+  PyObject *__pyx_n_s__40;
   PyObject *__pyx_n_s_args;
   PyObject *__pyx_n_s_array;
   PyObject *__pyx_n_s_asyncio_coroutines;
   PyObject *__pyx_n_s_c_score_cutoff;
+  PyObject *__pyx_n_s_cdist;
   PyObject *__pyx_n_s_choice;
   PyObject *__pyx_n_s_choice_key;
   PyObject *__pyx_n_s_choice_proc;
   PyObject *__pyx_n_s_choices;
+  PyObject *__pyx_n_s_class;
+  PyObject *__pyx_n_s_class_getitem;
   PyObject *__pyx_n_s_cline_in_traceback;
   PyObject *__pyx_n_s_close;
+  PyObject *__pyx_n_s_cls;
+  PyObject *__pyx_n_s_collections;
+  PyObject *__pyx_n_s_dct;
   PyObject *__pyx_n_s_default_process;
+  PyObject *__pyx_n_s_dict;
+  PyObject *__pyx_n_s_dict_2;
   PyObject *__pyx_kp_u_disable;
+  PyObject *__pyx_n_s_doc;
+  PyObject *__pyx_n_s_dtype;
   PyObject *__pyx_kp_u_enable;
+  PyObject *__pyx_n_s_enum;
   PyObject *__pyx_n_s_enumerate;
   PyObject *__pyx_n_s_extract;
   PyObject *__pyx_n_s_extractOne;
-  PyObject *__pyx_kp_u_extractOne_line_547;
   PyObject *__pyx_n_s_extract_iter;
   PyObject *__pyx_n_s_extract_iter_dict_f64;
   PyObject *__pyx_n_s_extract_iter_dict_i64;
   PyObject *__pyx_n_s_extract_iter_list_f64;
   PyObject *__pyx_n_s_extract_iter_list_i64;
   PyObject *__pyx_n_s_extract_iter_locals_extract_iter;
   PyObject *__pyx_n_s_extract_iter_locals_extract_iter_2;
   PyObject *__pyx_n_s_extract_iter_locals_extract_iter_3;
   PyObject *__pyx_n_s_extract_iter_locals_extract_iter_4;
   PyObject *__pyx_n_s_extract_iter_locals_py_extract_i;
   PyObject *__pyx_n_s_extract_iter_locals_py_extract_i_2;
   PyObject *__pyx_kp_u_gc;
   PyObject *__pyx_n_u_get_scorer_flags;
+  PyObject *__pyx_n_s_getstate;
   PyObject *__pyx_n_s_heapq;
   PyObject *__pyx_n_s_i;
   PyObject *__pyx_n_s_import;
+  PyObject *__pyx_n_s_init;
+  PyObject *__pyx_n_s_init_subclass;
   PyObject *__pyx_n_s_initializing;
   PyObject *__pyx_n_s_is_coroutine;
   PyObject *__pyx_kp_u_isenabled;
   PyObject *__pyx_n_s_items;
   PyObject *__pyx_n_u_items;
   PyObject *__pyx_n_s_key;
   PyObject *__pyx_n_s_keys;
   PyObject *__pyx_n_s_kwargs;
   PyObject *__pyx_n_s_kwargs_context;
   PyObject *__pyx_n_s_limit;
   PyObject *__pyx_n_s_lowest_score_worst;
   PyObject *__pyx_n_s_main;
+  PyObject *__pyx_n_s_members;
+  PyObject *__pyx_n_s_metaclass;
+  PyObject *__pyx_n_s_module;
+  PyObject *__pyx_n_s_mro_entries;
   PyObject *__pyx_n_s_name;
+  PyObject *__pyx_n_s_name_2;
+  PyObject *__pyx_n_s_new;
   PyObject *__pyx_n_s_nlargest;
   PyObject *__pyx_n_s_nsmallest;
   PyObject *__pyx_n_s_optimal_score;
   PyObject *__pyx_n_u_optimal_score;
+  PyObject *__pyx_n_s_parents;
+  PyObject *__pyx_n_s_pickle;
+  PyObject *__pyx_n_s_prepare;
   PyObject *__pyx_n_s_proc_choice;
   PyObject *__pyx_n_s_proc_str;
   PyObject *__pyx_n_s_processor;
   PyObject *__pyx_n_u_processor;
   PyObject *__pyx_n_s_processor_capsule;
   PyObject *__pyx_n_s_processor_context;
   PyObject *__pyx_n_s_py_extract_dict_locals_lambda;
   PyObject *__pyx_n_s_py_extract_iter_dict;
   PyObject *__pyx_n_s_py_extract_iter_list;
   PyObject *__pyx_n_s_py_extract_list_locals_lambda;
+  PyObject *__pyx_n_s_pyx_PickleError;
+  PyObject *__pyx_n_s_pyx_checksum;
+  PyObject *__pyx_n_s_pyx_result;
+  PyObject *__pyx_n_s_pyx_state;
+  PyObject *__pyx_n_s_pyx_type;
+  PyObject *__pyx_n_s_pyx_unpickle___Pyx_EnumMeta;
+  PyObject *__pyx_n_s_qualname;
+  PyObject *__pyx_n_s_queries;
   PyObject *__pyx_n_s_query;
   PyObject *__pyx_n_s_query_proc;
   PyObject *__pyx_n_s_range;
   PyObject *__pyx_n_s_rapidfuzz_fuzz;
-  PyObject *__pyx_n_s_rapidfuzz_process_cpp;
+  PyObject *__pyx_n_s_rapidfuzz_process_cpp_impl;
   PyObject *__pyx_n_s_rapidfuzz_utils;
+  PyObject *__pyx_n_s_ratio;
+  PyObject *__pyx_n_s_reduce;
+  PyObject *__pyx_n_s_reduce_cython;
+  PyObject *__pyx_n_s_reduce_ex;
+  PyObject *__pyx_n_s_repr;
+  PyObject *__pyx_n_s_res;
+  PyObject *__pyx_kp_s_s_s;
+  PyObject *__pyx_kp_s_s_s_d;
   PyObject *__pyx_n_s_score;
   PyObject *__pyx_n_s_score_cutoff;
   PyObject *__pyx_n_u_score_cutoff;
   PyObject *__pyx_kp_u_score_cutoff_has_to_be_in_the_ra;
   PyObject *__pyx_n_s_scorer;
   PyObject *__pyx_n_s_scorer_capsule;
   PyObject *__pyx_n_s_scorer_context;
   PyObject *__pyx_kp_u_scorer_does_not_properly_use_the;
   PyObject *__pyx_n_s_scorer_flags;
   PyObject *__pyx_n_s_scorer_func;
+  PyObject *__pyx_n_s_self;
+  PyObject *__pyx_kp_s_self_matrix_cannot_be_converted;
   PyObject *__pyx_n_s_send;
+  PyObject *__pyx_n_s_set_name;
+  PyObject *__pyx_n_s_setstate;
+  PyObject *__pyx_n_s_setstate_cython;
   PyObject *__pyx_n_s_spec;
-  PyObject *__pyx_kp_s_src_rapidfuzz_process_cpp_pyx;
+  PyObject *__pyx_kp_s_src_rapidfuzz_process_cpp_impl_p;
+  PyObject *__pyx_n_s_state;
+  PyObject *__pyx_n_s_str;
+  PyObject *__pyx_kp_s_stringsource;
+  PyObject *__pyx_n_s_super;
   PyObject *__pyx_n_s_test;
   PyObject *__pyx_n_s_throw;
   PyObject *__pyx_n_s_typecode;
+  PyObject *__pyx_n_s_update;
+  PyObject *__pyx_n_s_use_setstate;
+  PyObject *__pyx_n_s_v;
+  PyObject *__pyx_n_s_value;
+  PyObject *__pyx_n_s_values;
+  PyObject *__pyx_n_s_workers;
   PyObject *__pyx_n_s_worst_score;
   PyObject *__pyx_n_u_worst_score;
   PyObject *__pyx_int_0;
   PyObject *__pyx_int_1;
   PyObject *__pyx_int_5;
   PyObject *__pyx_int_100;
+  PyObject *__pyx_int_222419149;
+  PyObject *__pyx_int_228825662;
+  PyObject *__pyx_int_238750788;
   PyObject *__pyx_int_neg_1;
   PyObject *__pyx_tuple_;
   PyObject *__pyx_tuple__2;
   PyObject *__pyx_tuple__6;
   PyObject *__pyx_tuple__9;
   PyObject *__pyx_tuple__12;
   PyObject *__pyx_tuple__14;
-  PyObject *__pyx_tuple__20;
   PyObject *__pyx_tuple__21;
-  PyObject *__pyx_tuple__22;
+  PyObject *__pyx_tuple__24;
+  PyObject *__pyx_tuple__25;
+  PyObject *__pyx_tuple__26;
+  PyObject *__pyx_tuple__27;
+  PyObject *__pyx_tuple__28;
+  PyObject *__pyx_tuple__29;
+  PyObject *__pyx_tuple__30;
+  PyObject *__pyx_tuple__33;
+  PyObject *__pyx_tuple__35;
+  PyObject *__pyx_tuple__38;
   PyObject *__pyx_codeobj__3;
   PyObject *__pyx_codeobj__4;
   PyObject *__pyx_codeobj__5;
   PyObject *__pyx_codeobj__7;
   PyObject *__pyx_codeobj__8;
   PyObject *__pyx_codeobj__10;
   PyObject *__pyx_codeobj__11;
   PyObject *__pyx_codeobj__13;
   PyObject *__pyx_codeobj__15;
+  PyObject *__pyx_codeobj__16;
+  PyObject *__pyx_codeobj__17;
+  PyObject *__pyx_codeobj__18;
+  PyObject *__pyx_codeobj__31;
+  PyObject *__pyx_codeobj__32;
+  PyObject *__pyx_codeobj__34;
+  PyObject *__pyx_codeobj__36;
+  PyObject *__pyx_codeobj__37;
+  PyObject *__pyx_codeobj__39;
 } __pyx_mstate;
 
 #ifdef __cplusplus
 namespace {
   extern struct PyModuleDef __pyx_moduledef;
 } /* anonymous namespace */
 #else
@@ -3274,152 +3883,257 @@
   #ifdef __Pyx_CyFunction_USED
   Py_CLEAR(clear_module_state->__pyx_CyFunctionType);
   #endif
   #ifdef __Pyx_FusedFunction_USED
   Py_CLEAR(clear_module_state->__pyx_FusedFunctionType);
   #endif
   Py_CLEAR(clear_module_state->__pyx_ptype_7cpython_4type_type);
-  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter);
-  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter);
-  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64);
-  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64);
-  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64);
-  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64);
-  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64);
-  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64);
-  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64);
-  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64);
-  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict);
-  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict);
-  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list);
-  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_Find_the_best_match_in_a_list_o);
+  Py_CLEAR(clear_module_state->__pyx_ptype_7cpython_4bool_bool);
+  Py_CLEAR(clear_module_state->__pyx_ptype_7cpython_7complex_complex);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix);
+  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl_Matrix);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter);
+  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64);
+  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64);
+  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64);
+  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64);
+  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict);
+  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict);
+  Py_CLEAR(clear_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list);
+  Py_CLEAR(clear_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list);
+  Py_CLEAR(clear_module_state->__pyx_ptype___Pyx_EnumMeta);
+  Py_CLEAR(clear_module_state->__Pyx_EnumMeta);
+  Py_CLEAR(clear_module_state->__pyx_n_s_EnumBase);
+  Py_CLEAR(clear_module_state->__pyx_n_s_FLOAT32);
+  Py_CLEAR(clear_module_state->__pyx_n_s_FLOAT64);
   Py_CLEAR(clear_module_state->__pyx_kp_u_Got_unexpected_keyword_arguments);
+  Py_CLEAR(clear_module_state->__pyx_n_s_INT16);
+  Py_CLEAR(clear_module_state->__pyx_n_s_INT32);
+  Py_CLEAR(clear_module_state->__pyx_n_s_INT64);
+  Py_CLEAR(clear_module_state->__pyx_n_s_INT8);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_Incompatible_checksums_0x_x_vs_0);
+  Py_CLEAR(clear_module_state->__pyx_n_s_IntEnum);
+  Py_CLEAR(clear_module_state->__pyx_n_s_Matrix);
+  Py_CLEAR(clear_module_state->__pyx_n_s_MatrixType);
+  Py_CLEAR(clear_module_state->__pyx_n_s_Matrix___reduce_cython);
+  Py_CLEAR(clear_module_state->__pyx_n_s_Matrix___setstate_cython);
   Py_CLEAR(clear_module_state->__pyx_n_s_MemoryError);
+  Py_CLEAR(clear_module_state->__pyx_n_s_OrderedDict);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PickleError);
+  Py_CLEAR(clear_module_state->__pyx_n_s_Pyx_EnumBase);
+  Py_CLEAR(clear_module_state->__pyx_n_s_Pyx_EnumBase___new);
+  Py_CLEAR(clear_module_state->__pyx_n_s_Pyx_EnumBase___repr);
+  Py_CLEAR(clear_module_state->__pyx_n_s_Pyx_EnumBase___str);
+  Py_CLEAR(clear_module_state->__pyx_n_s_Pyx_EnumMeta___reduce_cython);
+  Py_CLEAR(clear_module_state->__pyx_n_s_Pyx_EnumMeta___setstate_cython);
   Py_CLEAR(clear_module_state->__pyx_n_u_RF_Preprocess);
   Py_CLEAR(clear_module_state->__pyx_n_s_RF_Scorer);
   Py_CLEAR(clear_module_state->__pyx_n_u_RF_Scorer);
   Py_CLEAR(clear_module_state->__pyx_n_s_RF_ScorerPy);
   Py_CLEAR(clear_module_state->__pyx_n_u_RF_ScorerPy);
   Py_CLEAR(clear_module_state->__pyx_n_s_ScorerFunc);
   Py_CLEAR(clear_module_state->__pyx_n_s_TypeError);
+  Py_CLEAR(clear_module_state->__pyx_n_s_UINT16);
+  Py_CLEAR(clear_module_state->__pyx_n_s_UINT32);
+  Py_CLEAR(clear_module_state->__pyx_n_s_UINT64);
+  Py_CLEAR(clear_module_state->__pyx_n_s_UINT8);
+  Py_CLEAR(clear_module_state->__pyx_n_s_UNDEFINED);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_Unknown_enum_value_s);
   Py_CLEAR(clear_module_state->__pyx_n_s_ValueError);
   Py_CLEAR(clear_module_state->__pyx_n_s_WRatio);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__16);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__17);
-  Py_CLEAR(clear_module_state->__pyx_kp_u__18);
-  Py_CLEAR(clear_module_state->__pyx_n_s__19);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__19);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__20);
+  Py_CLEAR(clear_module_state->__pyx_kp_u__22);
   Py_CLEAR(clear_module_state->__pyx_n_s__23);
+  Py_CLEAR(clear_module_state->__pyx_n_s__40);
   Py_CLEAR(clear_module_state->__pyx_n_s_args);
   Py_CLEAR(clear_module_state->__pyx_n_s_array);
   Py_CLEAR(clear_module_state->__pyx_n_s_asyncio_coroutines);
   Py_CLEAR(clear_module_state->__pyx_n_s_c_score_cutoff);
+  Py_CLEAR(clear_module_state->__pyx_n_s_cdist);
   Py_CLEAR(clear_module_state->__pyx_n_s_choice);
   Py_CLEAR(clear_module_state->__pyx_n_s_choice_key);
   Py_CLEAR(clear_module_state->__pyx_n_s_choice_proc);
   Py_CLEAR(clear_module_state->__pyx_n_s_choices);
+  Py_CLEAR(clear_module_state->__pyx_n_s_class);
+  Py_CLEAR(clear_module_state->__pyx_n_s_class_getitem);
   Py_CLEAR(clear_module_state->__pyx_n_s_cline_in_traceback);
   Py_CLEAR(clear_module_state->__pyx_n_s_close);
+  Py_CLEAR(clear_module_state->__pyx_n_s_cls);
+  Py_CLEAR(clear_module_state->__pyx_n_s_collections);
+  Py_CLEAR(clear_module_state->__pyx_n_s_dct);
   Py_CLEAR(clear_module_state->__pyx_n_s_default_process);
+  Py_CLEAR(clear_module_state->__pyx_n_s_dict);
+  Py_CLEAR(clear_module_state->__pyx_n_s_dict_2);
   Py_CLEAR(clear_module_state->__pyx_kp_u_disable);
+  Py_CLEAR(clear_module_state->__pyx_n_s_doc);
+  Py_CLEAR(clear_module_state->__pyx_n_s_dtype);
   Py_CLEAR(clear_module_state->__pyx_kp_u_enable);
+  Py_CLEAR(clear_module_state->__pyx_n_s_enum);
   Py_CLEAR(clear_module_state->__pyx_n_s_enumerate);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract);
   Py_CLEAR(clear_module_state->__pyx_n_s_extractOne);
-  Py_CLEAR(clear_module_state->__pyx_kp_u_extractOne_line_547);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter_dict_f64);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter_dict_i64);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter_list_f64);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter_list_i64);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter_locals_extract_iter);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter_locals_extract_iter_2);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter_locals_extract_iter_3);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter_locals_extract_iter_4);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter_locals_py_extract_i);
   Py_CLEAR(clear_module_state->__pyx_n_s_extract_iter_locals_py_extract_i_2);
   Py_CLEAR(clear_module_state->__pyx_kp_u_gc);
   Py_CLEAR(clear_module_state->__pyx_n_u_get_scorer_flags);
+  Py_CLEAR(clear_module_state->__pyx_n_s_getstate);
   Py_CLEAR(clear_module_state->__pyx_n_s_heapq);
   Py_CLEAR(clear_module_state->__pyx_n_s_i);
   Py_CLEAR(clear_module_state->__pyx_n_s_import);
+  Py_CLEAR(clear_module_state->__pyx_n_s_init);
+  Py_CLEAR(clear_module_state->__pyx_n_s_init_subclass);
   Py_CLEAR(clear_module_state->__pyx_n_s_initializing);
   Py_CLEAR(clear_module_state->__pyx_n_s_is_coroutine);
   Py_CLEAR(clear_module_state->__pyx_kp_u_isenabled);
   Py_CLEAR(clear_module_state->__pyx_n_s_items);
   Py_CLEAR(clear_module_state->__pyx_n_u_items);
   Py_CLEAR(clear_module_state->__pyx_n_s_key);
   Py_CLEAR(clear_module_state->__pyx_n_s_keys);
   Py_CLEAR(clear_module_state->__pyx_n_s_kwargs);
   Py_CLEAR(clear_module_state->__pyx_n_s_kwargs_context);
   Py_CLEAR(clear_module_state->__pyx_n_s_limit);
   Py_CLEAR(clear_module_state->__pyx_n_s_lowest_score_worst);
   Py_CLEAR(clear_module_state->__pyx_n_s_main);
+  Py_CLEAR(clear_module_state->__pyx_n_s_members);
+  Py_CLEAR(clear_module_state->__pyx_n_s_metaclass);
+  Py_CLEAR(clear_module_state->__pyx_n_s_module);
+  Py_CLEAR(clear_module_state->__pyx_n_s_mro_entries);
   Py_CLEAR(clear_module_state->__pyx_n_s_name);
+  Py_CLEAR(clear_module_state->__pyx_n_s_name_2);
+  Py_CLEAR(clear_module_state->__pyx_n_s_new);
   Py_CLEAR(clear_module_state->__pyx_n_s_nlargest);
   Py_CLEAR(clear_module_state->__pyx_n_s_nsmallest);
   Py_CLEAR(clear_module_state->__pyx_n_s_optimal_score);
   Py_CLEAR(clear_module_state->__pyx_n_u_optimal_score);
+  Py_CLEAR(clear_module_state->__pyx_n_s_parents);
+  Py_CLEAR(clear_module_state->__pyx_n_s_pickle);
+  Py_CLEAR(clear_module_state->__pyx_n_s_prepare);
   Py_CLEAR(clear_module_state->__pyx_n_s_proc_choice);
   Py_CLEAR(clear_module_state->__pyx_n_s_proc_str);
   Py_CLEAR(clear_module_state->__pyx_n_s_processor);
   Py_CLEAR(clear_module_state->__pyx_n_u_processor);
   Py_CLEAR(clear_module_state->__pyx_n_s_processor_capsule);
   Py_CLEAR(clear_module_state->__pyx_n_s_processor_context);
   Py_CLEAR(clear_module_state->__pyx_n_s_py_extract_dict_locals_lambda);
   Py_CLEAR(clear_module_state->__pyx_n_s_py_extract_iter_dict);
   Py_CLEAR(clear_module_state->__pyx_n_s_py_extract_iter_list);
   Py_CLEAR(clear_module_state->__pyx_n_s_py_extract_list_locals_lambda);
+  Py_CLEAR(clear_module_state->__pyx_n_s_pyx_PickleError);
+  Py_CLEAR(clear_module_state->__pyx_n_s_pyx_checksum);
+  Py_CLEAR(clear_module_state->__pyx_n_s_pyx_result);
+  Py_CLEAR(clear_module_state->__pyx_n_s_pyx_state);
+  Py_CLEAR(clear_module_state->__pyx_n_s_pyx_type);
+  Py_CLEAR(clear_module_state->__pyx_n_s_pyx_unpickle___Pyx_EnumMeta);
+  Py_CLEAR(clear_module_state->__pyx_n_s_qualname);
+  Py_CLEAR(clear_module_state->__pyx_n_s_queries);
   Py_CLEAR(clear_module_state->__pyx_n_s_query);
   Py_CLEAR(clear_module_state->__pyx_n_s_query_proc);
   Py_CLEAR(clear_module_state->__pyx_n_s_range);
   Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_fuzz);
-  Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_process_cpp);
+  Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_process_cpp_impl);
   Py_CLEAR(clear_module_state->__pyx_n_s_rapidfuzz_utils);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ratio);
+  Py_CLEAR(clear_module_state->__pyx_n_s_reduce);
+  Py_CLEAR(clear_module_state->__pyx_n_s_reduce_cython);
+  Py_CLEAR(clear_module_state->__pyx_n_s_reduce_ex);
+  Py_CLEAR(clear_module_state->__pyx_n_s_repr);
+  Py_CLEAR(clear_module_state->__pyx_n_s_res);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_s_s);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_s_s_d);
   Py_CLEAR(clear_module_state->__pyx_n_s_score);
   Py_CLEAR(clear_module_state->__pyx_n_s_score_cutoff);
   Py_CLEAR(clear_module_state->__pyx_n_u_score_cutoff);
   Py_CLEAR(clear_module_state->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
   Py_CLEAR(clear_module_state->__pyx_n_s_scorer);
   Py_CLEAR(clear_module_state->__pyx_n_s_scorer_capsule);
   Py_CLEAR(clear_module_state->__pyx_n_s_scorer_context);
   Py_CLEAR(clear_module_state->__pyx_kp_u_scorer_does_not_properly_use_the);
   Py_CLEAR(clear_module_state->__pyx_n_s_scorer_flags);
   Py_CLEAR(clear_module_state->__pyx_n_s_scorer_func);
+  Py_CLEAR(clear_module_state->__pyx_n_s_self);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_self_matrix_cannot_be_converted);
   Py_CLEAR(clear_module_state->__pyx_n_s_send);
+  Py_CLEAR(clear_module_state->__pyx_n_s_set_name);
+  Py_CLEAR(clear_module_state->__pyx_n_s_setstate);
+  Py_CLEAR(clear_module_state->__pyx_n_s_setstate_cython);
   Py_CLEAR(clear_module_state->__pyx_n_s_spec);
-  Py_CLEAR(clear_module_state->__pyx_kp_s_src_rapidfuzz_process_cpp_pyx);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_src_rapidfuzz_process_cpp_impl_p);
+  Py_CLEAR(clear_module_state->__pyx_n_s_state);
+  Py_CLEAR(clear_module_state->__pyx_n_s_str);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_stringsource);
+  Py_CLEAR(clear_module_state->__pyx_n_s_super);
   Py_CLEAR(clear_module_state->__pyx_n_s_test);
   Py_CLEAR(clear_module_state->__pyx_n_s_throw);
   Py_CLEAR(clear_module_state->__pyx_n_s_typecode);
+  Py_CLEAR(clear_module_state->__pyx_n_s_update);
+  Py_CLEAR(clear_module_state->__pyx_n_s_use_setstate);
+  Py_CLEAR(clear_module_state->__pyx_n_s_v);
+  Py_CLEAR(clear_module_state->__pyx_n_s_value);
+  Py_CLEAR(clear_module_state->__pyx_n_s_values);
+  Py_CLEAR(clear_module_state->__pyx_n_s_workers);
   Py_CLEAR(clear_module_state->__pyx_n_s_worst_score);
   Py_CLEAR(clear_module_state->__pyx_n_u_worst_score);
   Py_CLEAR(clear_module_state->__pyx_int_0);
   Py_CLEAR(clear_module_state->__pyx_int_1);
   Py_CLEAR(clear_module_state->__pyx_int_5);
   Py_CLEAR(clear_module_state->__pyx_int_100);
+  Py_CLEAR(clear_module_state->__pyx_int_222419149);
+  Py_CLEAR(clear_module_state->__pyx_int_228825662);
+  Py_CLEAR(clear_module_state->__pyx_int_238750788);
   Py_CLEAR(clear_module_state->__pyx_int_neg_1);
   Py_CLEAR(clear_module_state->__pyx_tuple_);
   Py_CLEAR(clear_module_state->__pyx_tuple__2);
   Py_CLEAR(clear_module_state->__pyx_tuple__6);
   Py_CLEAR(clear_module_state->__pyx_tuple__9);
   Py_CLEAR(clear_module_state->__pyx_tuple__12);
   Py_CLEAR(clear_module_state->__pyx_tuple__14);
-  Py_CLEAR(clear_module_state->__pyx_tuple__20);
   Py_CLEAR(clear_module_state->__pyx_tuple__21);
-  Py_CLEAR(clear_module_state->__pyx_tuple__22);
+  Py_CLEAR(clear_module_state->__pyx_tuple__24);
+  Py_CLEAR(clear_module_state->__pyx_tuple__25);
+  Py_CLEAR(clear_module_state->__pyx_tuple__26);
+  Py_CLEAR(clear_module_state->__pyx_tuple__27);
+  Py_CLEAR(clear_module_state->__pyx_tuple__28);
+  Py_CLEAR(clear_module_state->__pyx_tuple__29);
+  Py_CLEAR(clear_module_state->__pyx_tuple__30);
+  Py_CLEAR(clear_module_state->__pyx_tuple__33);
+  Py_CLEAR(clear_module_state->__pyx_tuple__35);
+  Py_CLEAR(clear_module_state->__pyx_tuple__38);
   Py_CLEAR(clear_module_state->__pyx_codeobj__3);
   Py_CLEAR(clear_module_state->__pyx_codeobj__4);
   Py_CLEAR(clear_module_state->__pyx_codeobj__5);
   Py_CLEAR(clear_module_state->__pyx_codeobj__7);
   Py_CLEAR(clear_module_state->__pyx_codeobj__8);
   Py_CLEAR(clear_module_state->__pyx_codeobj__10);
   Py_CLEAR(clear_module_state->__pyx_codeobj__11);
   Py_CLEAR(clear_module_state->__pyx_codeobj__13);
   Py_CLEAR(clear_module_state->__pyx_codeobj__15);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__16);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__17);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__18);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__31);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__32);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__34);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__36);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__37);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__39);
   return 0;
 }
 #endif
 /* #### Code section: module_state_traverse ### */
 #if CYTHON_USE_MODULE_STATE
 static int __pyx_m_traverse(PyObject *m, visitproc visit, void *arg) {
   __pyx_mstate *traverse_module_state = __pyx_mstate(m);
@@ -3433,152 +4147,257 @@
   #ifdef __Pyx_CyFunction_USED
   Py_VISIT(traverse_module_state->__pyx_CyFunctionType);
   #endif
   #ifdef __Pyx_FusedFunction_USED
   Py_VISIT(traverse_module_state->__pyx_FusedFunctionType);
   #endif
   Py_VISIT(traverse_module_state->__pyx_ptype_7cpython_4type_type);
-  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter);
-  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter);
-  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64);
-  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64);
-  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64);
-  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64);
-  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64);
-  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64);
-  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64);
-  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64);
-  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict);
-  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict);
-  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list);
-  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_Find_the_best_match_in_a_list_o);
+  Py_VISIT(traverse_module_state->__pyx_ptype_7cpython_4bool_bool);
+  Py_VISIT(traverse_module_state->__pyx_ptype_7cpython_7complex_complex);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix);
+  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl_Matrix);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter);
+  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64);
+  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64);
+  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64);
+  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64);
+  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict);
+  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict);
+  Py_VISIT(traverse_module_state->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list);
+  Py_VISIT(traverse_module_state->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list);
+  Py_VISIT(traverse_module_state->__pyx_ptype___Pyx_EnumMeta);
+  Py_VISIT(traverse_module_state->__Pyx_EnumMeta);
+  Py_VISIT(traverse_module_state->__pyx_n_s_EnumBase);
+  Py_VISIT(traverse_module_state->__pyx_n_s_FLOAT32);
+  Py_VISIT(traverse_module_state->__pyx_n_s_FLOAT64);
   Py_VISIT(traverse_module_state->__pyx_kp_u_Got_unexpected_keyword_arguments);
+  Py_VISIT(traverse_module_state->__pyx_n_s_INT16);
+  Py_VISIT(traverse_module_state->__pyx_n_s_INT32);
+  Py_VISIT(traverse_module_state->__pyx_n_s_INT64);
+  Py_VISIT(traverse_module_state->__pyx_n_s_INT8);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_Incompatible_checksums_0x_x_vs_0);
+  Py_VISIT(traverse_module_state->__pyx_n_s_IntEnum);
+  Py_VISIT(traverse_module_state->__pyx_n_s_Matrix);
+  Py_VISIT(traverse_module_state->__pyx_n_s_MatrixType);
+  Py_VISIT(traverse_module_state->__pyx_n_s_Matrix___reduce_cython);
+  Py_VISIT(traverse_module_state->__pyx_n_s_Matrix___setstate_cython);
   Py_VISIT(traverse_module_state->__pyx_n_s_MemoryError);
+  Py_VISIT(traverse_module_state->__pyx_n_s_OrderedDict);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PickleError);
+  Py_VISIT(traverse_module_state->__pyx_n_s_Pyx_EnumBase);
+  Py_VISIT(traverse_module_state->__pyx_n_s_Pyx_EnumBase___new);
+  Py_VISIT(traverse_module_state->__pyx_n_s_Pyx_EnumBase___repr);
+  Py_VISIT(traverse_module_state->__pyx_n_s_Pyx_EnumBase___str);
+  Py_VISIT(traverse_module_state->__pyx_n_s_Pyx_EnumMeta___reduce_cython);
+  Py_VISIT(traverse_module_state->__pyx_n_s_Pyx_EnumMeta___setstate_cython);
   Py_VISIT(traverse_module_state->__pyx_n_u_RF_Preprocess);
   Py_VISIT(traverse_module_state->__pyx_n_s_RF_Scorer);
   Py_VISIT(traverse_module_state->__pyx_n_u_RF_Scorer);
   Py_VISIT(traverse_module_state->__pyx_n_s_RF_ScorerPy);
   Py_VISIT(traverse_module_state->__pyx_n_u_RF_ScorerPy);
   Py_VISIT(traverse_module_state->__pyx_n_s_ScorerFunc);
   Py_VISIT(traverse_module_state->__pyx_n_s_TypeError);
+  Py_VISIT(traverse_module_state->__pyx_n_s_UINT16);
+  Py_VISIT(traverse_module_state->__pyx_n_s_UINT32);
+  Py_VISIT(traverse_module_state->__pyx_n_s_UINT64);
+  Py_VISIT(traverse_module_state->__pyx_n_s_UINT8);
+  Py_VISIT(traverse_module_state->__pyx_n_s_UNDEFINED);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_Unknown_enum_value_s);
   Py_VISIT(traverse_module_state->__pyx_n_s_ValueError);
   Py_VISIT(traverse_module_state->__pyx_n_s_WRatio);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__16);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__17);
-  Py_VISIT(traverse_module_state->__pyx_kp_u__18);
-  Py_VISIT(traverse_module_state->__pyx_n_s__19);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__19);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__20);
+  Py_VISIT(traverse_module_state->__pyx_kp_u__22);
   Py_VISIT(traverse_module_state->__pyx_n_s__23);
+  Py_VISIT(traverse_module_state->__pyx_n_s__40);
   Py_VISIT(traverse_module_state->__pyx_n_s_args);
   Py_VISIT(traverse_module_state->__pyx_n_s_array);
   Py_VISIT(traverse_module_state->__pyx_n_s_asyncio_coroutines);
   Py_VISIT(traverse_module_state->__pyx_n_s_c_score_cutoff);
+  Py_VISIT(traverse_module_state->__pyx_n_s_cdist);
   Py_VISIT(traverse_module_state->__pyx_n_s_choice);
   Py_VISIT(traverse_module_state->__pyx_n_s_choice_key);
   Py_VISIT(traverse_module_state->__pyx_n_s_choice_proc);
   Py_VISIT(traverse_module_state->__pyx_n_s_choices);
+  Py_VISIT(traverse_module_state->__pyx_n_s_class);
+  Py_VISIT(traverse_module_state->__pyx_n_s_class_getitem);
   Py_VISIT(traverse_module_state->__pyx_n_s_cline_in_traceback);
   Py_VISIT(traverse_module_state->__pyx_n_s_close);
+  Py_VISIT(traverse_module_state->__pyx_n_s_cls);
+  Py_VISIT(traverse_module_state->__pyx_n_s_collections);
+  Py_VISIT(traverse_module_state->__pyx_n_s_dct);
   Py_VISIT(traverse_module_state->__pyx_n_s_default_process);
+  Py_VISIT(traverse_module_state->__pyx_n_s_dict);
+  Py_VISIT(traverse_module_state->__pyx_n_s_dict_2);
   Py_VISIT(traverse_module_state->__pyx_kp_u_disable);
+  Py_VISIT(traverse_module_state->__pyx_n_s_doc);
+  Py_VISIT(traverse_module_state->__pyx_n_s_dtype);
   Py_VISIT(traverse_module_state->__pyx_kp_u_enable);
+  Py_VISIT(traverse_module_state->__pyx_n_s_enum);
   Py_VISIT(traverse_module_state->__pyx_n_s_enumerate);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract);
   Py_VISIT(traverse_module_state->__pyx_n_s_extractOne);
-  Py_VISIT(traverse_module_state->__pyx_kp_u_extractOne_line_547);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter_dict_f64);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter_dict_i64);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter_list_f64);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter_list_i64);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter_locals_extract_iter);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter_locals_extract_iter_2);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter_locals_extract_iter_3);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter_locals_extract_iter_4);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter_locals_py_extract_i);
   Py_VISIT(traverse_module_state->__pyx_n_s_extract_iter_locals_py_extract_i_2);
   Py_VISIT(traverse_module_state->__pyx_kp_u_gc);
   Py_VISIT(traverse_module_state->__pyx_n_u_get_scorer_flags);
+  Py_VISIT(traverse_module_state->__pyx_n_s_getstate);
   Py_VISIT(traverse_module_state->__pyx_n_s_heapq);
   Py_VISIT(traverse_module_state->__pyx_n_s_i);
   Py_VISIT(traverse_module_state->__pyx_n_s_import);
+  Py_VISIT(traverse_module_state->__pyx_n_s_init);
+  Py_VISIT(traverse_module_state->__pyx_n_s_init_subclass);
   Py_VISIT(traverse_module_state->__pyx_n_s_initializing);
   Py_VISIT(traverse_module_state->__pyx_n_s_is_coroutine);
   Py_VISIT(traverse_module_state->__pyx_kp_u_isenabled);
   Py_VISIT(traverse_module_state->__pyx_n_s_items);
   Py_VISIT(traverse_module_state->__pyx_n_u_items);
   Py_VISIT(traverse_module_state->__pyx_n_s_key);
   Py_VISIT(traverse_module_state->__pyx_n_s_keys);
   Py_VISIT(traverse_module_state->__pyx_n_s_kwargs);
   Py_VISIT(traverse_module_state->__pyx_n_s_kwargs_context);
   Py_VISIT(traverse_module_state->__pyx_n_s_limit);
   Py_VISIT(traverse_module_state->__pyx_n_s_lowest_score_worst);
   Py_VISIT(traverse_module_state->__pyx_n_s_main);
+  Py_VISIT(traverse_module_state->__pyx_n_s_members);
+  Py_VISIT(traverse_module_state->__pyx_n_s_metaclass);
+  Py_VISIT(traverse_module_state->__pyx_n_s_module);
+  Py_VISIT(traverse_module_state->__pyx_n_s_mro_entries);
   Py_VISIT(traverse_module_state->__pyx_n_s_name);
+  Py_VISIT(traverse_module_state->__pyx_n_s_name_2);
+  Py_VISIT(traverse_module_state->__pyx_n_s_new);
   Py_VISIT(traverse_module_state->__pyx_n_s_nlargest);
   Py_VISIT(traverse_module_state->__pyx_n_s_nsmallest);
   Py_VISIT(traverse_module_state->__pyx_n_s_optimal_score);
   Py_VISIT(traverse_module_state->__pyx_n_u_optimal_score);
+  Py_VISIT(traverse_module_state->__pyx_n_s_parents);
+  Py_VISIT(traverse_module_state->__pyx_n_s_pickle);
+  Py_VISIT(traverse_module_state->__pyx_n_s_prepare);
   Py_VISIT(traverse_module_state->__pyx_n_s_proc_choice);
   Py_VISIT(traverse_module_state->__pyx_n_s_proc_str);
   Py_VISIT(traverse_module_state->__pyx_n_s_processor);
   Py_VISIT(traverse_module_state->__pyx_n_u_processor);
   Py_VISIT(traverse_module_state->__pyx_n_s_processor_capsule);
   Py_VISIT(traverse_module_state->__pyx_n_s_processor_context);
   Py_VISIT(traverse_module_state->__pyx_n_s_py_extract_dict_locals_lambda);
   Py_VISIT(traverse_module_state->__pyx_n_s_py_extract_iter_dict);
   Py_VISIT(traverse_module_state->__pyx_n_s_py_extract_iter_list);
   Py_VISIT(traverse_module_state->__pyx_n_s_py_extract_list_locals_lambda);
+  Py_VISIT(traverse_module_state->__pyx_n_s_pyx_PickleError);
+  Py_VISIT(traverse_module_state->__pyx_n_s_pyx_checksum);
+  Py_VISIT(traverse_module_state->__pyx_n_s_pyx_result);
+  Py_VISIT(traverse_module_state->__pyx_n_s_pyx_state);
+  Py_VISIT(traverse_module_state->__pyx_n_s_pyx_type);
+  Py_VISIT(traverse_module_state->__pyx_n_s_pyx_unpickle___Pyx_EnumMeta);
+  Py_VISIT(traverse_module_state->__pyx_n_s_qualname);
+  Py_VISIT(traverse_module_state->__pyx_n_s_queries);
   Py_VISIT(traverse_module_state->__pyx_n_s_query);
   Py_VISIT(traverse_module_state->__pyx_n_s_query_proc);
   Py_VISIT(traverse_module_state->__pyx_n_s_range);
   Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_fuzz);
-  Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_process_cpp);
+  Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_process_cpp_impl);
   Py_VISIT(traverse_module_state->__pyx_n_s_rapidfuzz_utils);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ratio);
+  Py_VISIT(traverse_module_state->__pyx_n_s_reduce);
+  Py_VISIT(traverse_module_state->__pyx_n_s_reduce_cython);
+  Py_VISIT(traverse_module_state->__pyx_n_s_reduce_ex);
+  Py_VISIT(traverse_module_state->__pyx_n_s_repr);
+  Py_VISIT(traverse_module_state->__pyx_n_s_res);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_s_s);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_s_s_d);
   Py_VISIT(traverse_module_state->__pyx_n_s_score);
   Py_VISIT(traverse_module_state->__pyx_n_s_score_cutoff);
   Py_VISIT(traverse_module_state->__pyx_n_u_score_cutoff);
   Py_VISIT(traverse_module_state->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
   Py_VISIT(traverse_module_state->__pyx_n_s_scorer);
   Py_VISIT(traverse_module_state->__pyx_n_s_scorer_capsule);
   Py_VISIT(traverse_module_state->__pyx_n_s_scorer_context);
   Py_VISIT(traverse_module_state->__pyx_kp_u_scorer_does_not_properly_use_the);
   Py_VISIT(traverse_module_state->__pyx_n_s_scorer_flags);
   Py_VISIT(traverse_module_state->__pyx_n_s_scorer_func);
+  Py_VISIT(traverse_module_state->__pyx_n_s_self);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_self_matrix_cannot_be_converted);
   Py_VISIT(traverse_module_state->__pyx_n_s_send);
+  Py_VISIT(traverse_module_state->__pyx_n_s_set_name);
+  Py_VISIT(traverse_module_state->__pyx_n_s_setstate);
+  Py_VISIT(traverse_module_state->__pyx_n_s_setstate_cython);
   Py_VISIT(traverse_module_state->__pyx_n_s_spec);
-  Py_VISIT(traverse_module_state->__pyx_kp_s_src_rapidfuzz_process_cpp_pyx);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_src_rapidfuzz_process_cpp_impl_p);
+  Py_VISIT(traverse_module_state->__pyx_n_s_state);
+  Py_VISIT(traverse_module_state->__pyx_n_s_str);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_stringsource);
+  Py_VISIT(traverse_module_state->__pyx_n_s_super);
   Py_VISIT(traverse_module_state->__pyx_n_s_test);
   Py_VISIT(traverse_module_state->__pyx_n_s_throw);
   Py_VISIT(traverse_module_state->__pyx_n_s_typecode);
+  Py_VISIT(traverse_module_state->__pyx_n_s_update);
+  Py_VISIT(traverse_module_state->__pyx_n_s_use_setstate);
+  Py_VISIT(traverse_module_state->__pyx_n_s_v);
+  Py_VISIT(traverse_module_state->__pyx_n_s_value);
+  Py_VISIT(traverse_module_state->__pyx_n_s_values);
+  Py_VISIT(traverse_module_state->__pyx_n_s_workers);
   Py_VISIT(traverse_module_state->__pyx_n_s_worst_score);
   Py_VISIT(traverse_module_state->__pyx_n_u_worst_score);
   Py_VISIT(traverse_module_state->__pyx_int_0);
   Py_VISIT(traverse_module_state->__pyx_int_1);
   Py_VISIT(traverse_module_state->__pyx_int_5);
   Py_VISIT(traverse_module_state->__pyx_int_100);
+  Py_VISIT(traverse_module_state->__pyx_int_222419149);
+  Py_VISIT(traverse_module_state->__pyx_int_228825662);
+  Py_VISIT(traverse_module_state->__pyx_int_238750788);
   Py_VISIT(traverse_module_state->__pyx_int_neg_1);
   Py_VISIT(traverse_module_state->__pyx_tuple_);
   Py_VISIT(traverse_module_state->__pyx_tuple__2);
   Py_VISIT(traverse_module_state->__pyx_tuple__6);
   Py_VISIT(traverse_module_state->__pyx_tuple__9);
   Py_VISIT(traverse_module_state->__pyx_tuple__12);
   Py_VISIT(traverse_module_state->__pyx_tuple__14);
-  Py_VISIT(traverse_module_state->__pyx_tuple__20);
   Py_VISIT(traverse_module_state->__pyx_tuple__21);
-  Py_VISIT(traverse_module_state->__pyx_tuple__22);
+  Py_VISIT(traverse_module_state->__pyx_tuple__24);
+  Py_VISIT(traverse_module_state->__pyx_tuple__25);
+  Py_VISIT(traverse_module_state->__pyx_tuple__26);
+  Py_VISIT(traverse_module_state->__pyx_tuple__27);
+  Py_VISIT(traverse_module_state->__pyx_tuple__28);
+  Py_VISIT(traverse_module_state->__pyx_tuple__29);
+  Py_VISIT(traverse_module_state->__pyx_tuple__30);
+  Py_VISIT(traverse_module_state->__pyx_tuple__33);
+  Py_VISIT(traverse_module_state->__pyx_tuple__35);
+  Py_VISIT(traverse_module_state->__pyx_tuple__38);
   Py_VISIT(traverse_module_state->__pyx_codeobj__3);
   Py_VISIT(traverse_module_state->__pyx_codeobj__4);
   Py_VISIT(traverse_module_state->__pyx_codeobj__5);
   Py_VISIT(traverse_module_state->__pyx_codeobj__7);
   Py_VISIT(traverse_module_state->__pyx_codeobj__8);
   Py_VISIT(traverse_module_state->__pyx_codeobj__10);
   Py_VISIT(traverse_module_state->__pyx_codeobj__11);
   Py_VISIT(traverse_module_state->__pyx_codeobj__13);
   Py_VISIT(traverse_module_state->__pyx_codeobj__15);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__16);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__17);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__18);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__31);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__32);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__34);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__36);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__37);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__39);
   return 0;
 }
 #endif
 /* #### Code section: module_state_defines ### */
 #if CYTHON_USE_MODULE_STATE
 #define __pyx_d __pyx_mstate_global->__pyx_d
 #define __pyx_b __pyx_mstate_global->__pyx_b
@@ -3589,164 +4408,269 @@
 #ifdef __Pyx_CyFunction_USED
 #define __pyx_CyFunctionType __pyx_mstate_global->__pyx_CyFunctionType
 #endif
 #ifdef __Pyx_FusedFunction_USED
 #define __pyx_FusedFunctionType __pyx_mstate_global->__pyx_FusedFunctionType
 #endif
 #define __pyx_ptype_7cpython_4type_type __pyx_mstate_global->__pyx_ptype_7cpython_4type_type
-#define __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter __pyx_mstate_global->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter
-#define __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter __pyx_mstate_global->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter
-#define __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 __pyx_mstate_global->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64
-#define __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 __pyx_mstate_global->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64
-#define __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 __pyx_mstate_global->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64
-#define __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 __pyx_mstate_global->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64
-#define __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 __pyx_mstate_global->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64
-#define __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 __pyx_mstate_global->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64
-#define __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 __pyx_mstate_global->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64
-#define __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 __pyx_mstate_global->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64
-#define __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict __pyx_mstate_global->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict
-#define __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict __pyx_mstate_global->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict
-#define __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list __pyx_mstate_global->__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list
-#define __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list __pyx_mstate_global->__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list
-#define __pyx_kp_u_Find_the_best_match_in_a_list_o __pyx_mstate_global->__pyx_kp_u_Find_the_best_match_in_a_list_o
+#define __pyx_ptype_7cpython_4bool_bool __pyx_mstate_global->__pyx_ptype_7cpython_4bool_bool
+#define __pyx_ptype_7cpython_7complex_complex __pyx_mstate_global->__pyx_ptype_7cpython_7complex_complex
+#define __pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix __pyx_mstate_global->__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix
+#define __pyx_type_9rapidfuzz_16process_cpp_impl_Matrix __pyx_mstate_global->__pyx_type_9rapidfuzz_16process_cpp_impl_Matrix
+#define __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter __pyx_mstate_global->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter
+#define __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter __pyx_mstate_global->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter
+#define __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 __pyx_mstate_global->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64
+#define __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 __pyx_mstate_global->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64
+#define __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 __pyx_mstate_global->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64
+#define __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 __pyx_mstate_global->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64
+#define __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 __pyx_mstate_global->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64
+#define __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 __pyx_mstate_global->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64
+#define __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 __pyx_mstate_global->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64
+#define __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 __pyx_mstate_global->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64
+#define __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict __pyx_mstate_global->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict
+#define __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict __pyx_mstate_global->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict
+#define __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list __pyx_mstate_global->__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list
+#define __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list __pyx_mstate_global->__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list
+#define __pyx_ptype___Pyx_EnumMeta __pyx_mstate_global->__pyx_ptype___Pyx_EnumMeta
+#define __Pyx_EnumMeta __pyx_mstate_global->__Pyx_EnumMeta
+#define __pyx_n_s_EnumBase __pyx_mstate_global->__pyx_n_s_EnumBase
+#define __pyx_n_s_FLOAT32 __pyx_mstate_global->__pyx_n_s_FLOAT32
+#define __pyx_n_s_FLOAT64 __pyx_mstate_global->__pyx_n_s_FLOAT64
 #define __pyx_kp_u_Got_unexpected_keyword_arguments __pyx_mstate_global->__pyx_kp_u_Got_unexpected_keyword_arguments
+#define __pyx_n_s_INT16 __pyx_mstate_global->__pyx_n_s_INT16
+#define __pyx_n_s_INT32 __pyx_mstate_global->__pyx_n_s_INT32
+#define __pyx_n_s_INT64 __pyx_mstate_global->__pyx_n_s_INT64
+#define __pyx_n_s_INT8 __pyx_mstate_global->__pyx_n_s_INT8
+#define __pyx_kp_s_Incompatible_checksums_0x_x_vs_0 __pyx_mstate_global->__pyx_kp_s_Incompatible_checksums_0x_x_vs_0
+#define __pyx_n_s_IntEnum __pyx_mstate_global->__pyx_n_s_IntEnum
+#define __pyx_n_s_Matrix __pyx_mstate_global->__pyx_n_s_Matrix
+#define __pyx_n_s_MatrixType __pyx_mstate_global->__pyx_n_s_MatrixType
+#define __pyx_n_s_Matrix___reduce_cython __pyx_mstate_global->__pyx_n_s_Matrix___reduce_cython
+#define __pyx_n_s_Matrix___setstate_cython __pyx_mstate_global->__pyx_n_s_Matrix___setstate_cython
 #define __pyx_n_s_MemoryError __pyx_mstate_global->__pyx_n_s_MemoryError
+#define __pyx_n_s_OrderedDict __pyx_mstate_global->__pyx_n_s_OrderedDict
+#define __pyx_n_s_PickleError __pyx_mstate_global->__pyx_n_s_PickleError
+#define __pyx_n_s_Pyx_EnumBase __pyx_mstate_global->__pyx_n_s_Pyx_EnumBase
+#define __pyx_n_s_Pyx_EnumBase___new __pyx_mstate_global->__pyx_n_s_Pyx_EnumBase___new
+#define __pyx_n_s_Pyx_EnumBase___repr __pyx_mstate_global->__pyx_n_s_Pyx_EnumBase___repr
+#define __pyx_n_s_Pyx_EnumBase___str __pyx_mstate_global->__pyx_n_s_Pyx_EnumBase___str
+#define __pyx_n_s_Pyx_EnumMeta___reduce_cython __pyx_mstate_global->__pyx_n_s_Pyx_EnumMeta___reduce_cython
+#define __pyx_n_s_Pyx_EnumMeta___setstate_cython __pyx_mstate_global->__pyx_n_s_Pyx_EnumMeta___setstate_cython
 #define __pyx_n_u_RF_Preprocess __pyx_mstate_global->__pyx_n_u_RF_Preprocess
 #define __pyx_n_s_RF_Scorer __pyx_mstate_global->__pyx_n_s_RF_Scorer
 #define __pyx_n_u_RF_Scorer __pyx_mstate_global->__pyx_n_u_RF_Scorer
 #define __pyx_n_s_RF_ScorerPy __pyx_mstate_global->__pyx_n_s_RF_ScorerPy
 #define __pyx_n_u_RF_ScorerPy __pyx_mstate_global->__pyx_n_u_RF_ScorerPy
 #define __pyx_n_s_ScorerFunc __pyx_mstate_global->__pyx_n_s_ScorerFunc
 #define __pyx_n_s_TypeError __pyx_mstate_global->__pyx_n_s_TypeError
+#define __pyx_n_s_UINT16 __pyx_mstate_global->__pyx_n_s_UINT16
+#define __pyx_n_s_UINT32 __pyx_mstate_global->__pyx_n_s_UINT32
+#define __pyx_n_s_UINT64 __pyx_mstate_global->__pyx_n_s_UINT64
+#define __pyx_n_s_UINT8 __pyx_mstate_global->__pyx_n_s_UINT8
+#define __pyx_n_s_UNDEFINED __pyx_mstate_global->__pyx_n_s_UNDEFINED
+#define __pyx_kp_s_Unknown_enum_value_s __pyx_mstate_global->__pyx_kp_s_Unknown_enum_value_s
 #define __pyx_n_s_ValueError __pyx_mstate_global->__pyx_n_s_ValueError
 #define __pyx_n_s_WRatio __pyx_mstate_global->__pyx_n_s_WRatio
-#define __pyx_kp_u__16 __pyx_mstate_global->__pyx_kp_u__16
-#define __pyx_kp_u__17 __pyx_mstate_global->__pyx_kp_u__17
-#define __pyx_kp_u__18 __pyx_mstate_global->__pyx_kp_u__18
-#define __pyx_n_s__19 __pyx_mstate_global->__pyx_n_s__19
+#define __pyx_kp_u__19 __pyx_mstate_global->__pyx_kp_u__19
+#define __pyx_kp_u__20 __pyx_mstate_global->__pyx_kp_u__20
+#define __pyx_kp_u__22 __pyx_mstate_global->__pyx_kp_u__22
 #define __pyx_n_s__23 __pyx_mstate_global->__pyx_n_s__23
+#define __pyx_n_s__40 __pyx_mstate_global->__pyx_n_s__40
 #define __pyx_n_s_args __pyx_mstate_global->__pyx_n_s_args
 #define __pyx_n_s_array __pyx_mstate_global->__pyx_n_s_array
 #define __pyx_n_s_asyncio_coroutines __pyx_mstate_global->__pyx_n_s_asyncio_coroutines
 #define __pyx_n_s_c_score_cutoff __pyx_mstate_global->__pyx_n_s_c_score_cutoff
+#define __pyx_n_s_cdist __pyx_mstate_global->__pyx_n_s_cdist
 #define __pyx_n_s_choice __pyx_mstate_global->__pyx_n_s_choice
 #define __pyx_n_s_choice_key __pyx_mstate_global->__pyx_n_s_choice_key
 #define __pyx_n_s_choice_proc __pyx_mstate_global->__pyx_n_s_choice_proc
 #define __pyx_n_s_choices __pyx_mstate_global->__pyx_n_s_choices
+#define __pyx_n_s_class __pyx_mstate_global->__pyx_n_s_class
+#define __pyx_n_s_class_getitem __pyx_mstate_global->__pyx_n_s_class_getitem
 #define __pyx_n_s_cline_in_traceback __pyx_mstate_global->__pyx_n_s_cline_in_traceback
 #define __pyx_n_s_close __pyx_mstate_global->__pyx_n_s_close
+#define __pyx_n_s_cls __pyx_mstate_global->__pyx_n_s_cls
+#define __pyx_n_s_collections __pyx_mstate_global->__pyx_n_s_collections
+#define __pyx_n_s_dct __pyx_mstate_global->__pyx_n_s_dct
 #define __pyx_n_s_default_process __pyx_mstate_global->__pyx_n_s_default_process
+#define __pyx_n_s_dict __pyx_mstate_global->__pyx_n_s_dict
+#define __pyx_n_s_dict_2 __pyx_mstate_global->__pyx_n_s_dict_2
 #define __pyx_kp_u_disable __pyx_mstate_global->__pyx_kp_u_disable
+#define __pyx_n_s_doc __pyx_mstate_global->__pyx_n_s_doc
+#define __pyx_n_s_dtype __pyx_mstate_global->__pyx_n_s_dtype
 #define __pyx_kp_u_enable __pyx_mstate_global->__pyx_kp_u_enable
+#define __pyx_n_s_enum __pyx_mstate_global->__pyx_n_s_enum
 #define __pyx_n_s_enumerate __pyx_mstate_global->__pyx_n_s_enumerate
 #define __pyx_n_s_extract __pyx_mstate_global->__pyx_n_s_extract
 #define __pyx_n_s_extractOne __pyx_mstate_global->__pyx_n_s_extractOne
-#define __pyx_kp_u_extractOne_line_547 __pyx_mstate_global->__pyx_kp_u_extractOne_line_547
 #define __pyx_n_s_extract_iter __pyx_mstate_global->__pyx_n_s_extract_iter
 #define __pyx_n_s_extract_iter_dict_f64 __pyx_mstate_global->__pyx_n_s_extract_iter_dict_f64
 #define __pyx_n_s_extract_iter_dict_i64 __pyx_mstate_global->__pyx_n_s_extract_iter_dict_i64
 #define __pyx_n_s_extract_iter_list_f64 __pyx_mstate_global->__pyx_n_s_extract_iter_list_f64
 #define __pyx_n_s_extract_iter_list_i64 __pyx_mstate_global->__pyx_n_s_extract_iter_list_i64
 #define __pyx_n_s_extract_iter_locals_extract_iter __pyx_mstate_global->__pyx_n_s_extract_iter_locals_extract_iter
 #define __pyx_n_s_extract_iter_locals_extract_iter_2 __pyx_mstate_global->__pyx_n_s_extract_iter_locals_extract_iter_2
 #define __pyx_n_s_extract_iter_locals_extract_iter_3 __pyx_mstate_global->__pyx_n_s_extract_iter_locals_extract_iter_3
 #define __pyx_n_s_extract_iter_locals_extract_iter_4 __pyx_mstate_global->__pyx_n_s_extract_iter_locals_extract_iter_4
 #define __pyx_n_s_extract_iter_locals_py_extract_i __pyx_mstate_global->__pyx_n_s_extract_iter_locals_py_extract_i
 #define __pyx_n_s_extract_iter_locals_py_extract_i_2 __pyx_mstate_global->__pyx_n_s_extract_iter_locals_py_extract_i_2
 #define __pyx_kp_u_gc __pyx_mstate_global->__pyx_kp_u_gc
 #define __pyx_n_u_get_scorer_flags __pyx_mstate_global->__pyx_n_u_get_scorer_flags
+#define __pyx_n_s_getstate __pyx_mstate_global->__pyx_n_s_getstate
 #define __pyx_n_s_heapq __pyx_mstate_global->__pyx_n_s_heapq
 #define __pyx_n_s_i __pyx_mstate_global->__pyx_n_s_i
 #define __pyx_n_s_import __pyx_mstate_global->__pyx_n_s_import
+#define __pyx_n_s_init __pyx_mstate_global->__pyx_n_s_init
+#define __pyx_n_s_init_subclass __pyx_mstate_global->__pyx_n_s_init_subclass
 #define __pyx_n_s_initializing __pyx_mstate_global->__pyx_n_s_initializing
 #define __pyx_n_s_is_coroutine __pyx_mstate_global->__pyx_n_s_is_coroutine
 #define __pyx_kp_u_isenabled __pyx_mstate_global->__pyx_kp_u_isenabled
 #define __pyx_n_s_items __pyx_mstate_global->__pyx_n_s_items
 #define __pyx_n_u_items __pyx_mstate_global->__pyx_n_u_items
 #define __pyx_n_s_key __pyx_mstate_global->__pyx_n_s_key
 #define __pyx_n_s_keys __pyx_mstate_global->__pyx_n_s_keys
 #define __pyx_n_s_kwargs __pyx_mstate_global->__pyx_n_s_kwargs
 #define __pyx_n_s_kwargs_context __pyx_mstate_global->__pyx_n_s_kwargs_context
 #define __pyx_n_s_limit __pyx_mstate_global->__pyx_n_s_limit
 #define __pyx_n_s_lowest_score_worst __pyx_mstate_global->__pyx_n_s_lowest_score_worst
 #define __pyx_n_s_main __pyx_mstate_global->__pyx_n_s_main
+#define __pyx_n_s_members __pyx_mstate_global->__pyx_n_s_members
+#define __pyx_n_s_metaclass __pyx_mstate_global->__pyx_n_s_metaclass
+#define __pyx_n_s_module __pyx_mstate_global->__pyx_n_s_module
+#define __pyx_n_s_mro_entries __pyx_mstate_global->__pyx_n_s_mro_entries
 #define __pyx_n_s_name __pyx_mstate_global->__pyx_n_s_name
+#define __pyx_n_s_name_2 __pyx_mstate_global->__pyx_n_s_name_2
+#define __pyx_n_s_new __pyx_mstate_global->__pyx_n_s_new
 #define __pyx_n_s_nlargest __pyx_mstate_global->__pyx_n_s_nlargest
 #define __pyx_n_s_nsmallest __pyx_mstate_global->__pyx_n_s_nsmallest
 #define __pyx_n_s_optimal_score __pyx_mstate_global->__pyx_n_s_optimal_score
 #define __pyx_n_u_optimal_score __pyx_mstate_global->__pyx_n_u_optimal_score
+#define __pyx_n_s_parents __pyx_mstate_global->__pyx_n_s_parents
+#define __pyx_n_s_pickle __pyx_mstate_global->__pyx_n_s_pickle
+#define __pyx_n_s_prepare __pyx_mstate_global->__pyx_n_s_prepare
 #define __pyx_n_s_proc_choice __pyx_mstate_global->__pyx_n_s_proc_choice
 #define __pyx_n_s_proc_str __pyx_mstate_global->__pyx_n_s_proc_str
 #define __pyx_n_s_processor __pyx_mstate_global->__pyx_n_s_processor
 #define __pyx_n_u_processor __pyx_mstate_global->__pyx_n_u_processor
 #define __pyx_n_s_processor_capsule __pyx_mstate_global->__pyx_n_s_processor_capsule
 #define __pyx_n_s_processor_context __pyx_mstate_global->__pyx_n_s_processor_context
 #define __pyx_n_s_py_extract_dict_locals_lambda __pyx_mstate_global->__pyx_n_s_py_extract_dict_locals_lambda
 #define __pyx_n_s_py_extract_iter_dict __pyx_mstate_global->__pyx_n_s_py_extract_iter_dict
 #define __pyx_n_s_py_extract_iter_list __pyx_mstate_global->__pyx_n_s_py_extract_iter_list
 #define __pyx_n_s_py_extract_list_locals_lambda __pyx_mstate_global->__pyx_n_s_py_extract_list_locals_lambda
+#define __pyx_n_s_pyx_PickleError __pyx_mstate_global->__pyx_n_s_pyx_PickleError
+#define __pyx_n_s_pyx_checksum __pyx_mstate_global->__pyx_n_s_pyx_checksum
+#define __pyx_n_s_pyx_result __pyx_mstate_global->__pyx_n_s_pyx_result
+#define __pyx_n_s_pyx_state __pyx_mstate_global->__pyx_n_s_pyx_state
+#define __pyx_n_s_pyx_type __pyx_mstate_global->__pyx_n_s_pyx_type
+#define __pyx_n_s_pyx_unpickle___Pyx_EnumMeta __pyx_mstate_global->__pyx_n_s_pyx_unpickle___Pyx_EnumMeta
+#define __pyx_n_s_qualname __pyx_mstate_global->__pyx_n_s_qualname
+#define __pyx_n_s_queries __pyx_mstate_global->__pyx_n_s_queries
 #define __pyx_n_s_query __pyx_mstate_global->__pyx_n_s_query
 #define __pyx_n_s_query_proc __pyx_mstate_global->__pyx_n_s_query_proc
 #define __pyx_n_s_range __pyx_mstate_global->__pyx_n_s_range
 #define __pyx_n_s_rapidfuzz_fuzz __pyx_mstate_global->__pyx_n_s_rapidfuzz_fuzz
-#define __pyx_n_s_rapidfuzz_process_cpp __pyx_mstate_global->__pyx_n_s_rapidfuzz_process_cpp
+#define __pyx_n_s_rapidfuzz_process_cpp_impl __pyx_mstate_global->__pyx_n_s_rapidfuzz_process_cpp_impl
 #define __pyx_n_s_rapidfuzz_utils __pyx_mstate_global->__pyx_n_s_rapidfuzz_utils
+#define __pyx_n_s_ratio __pyx_mstate_global->__pyx_n_s_ratio
+#define __pyx_n_s_reduce __pyx_mstate_global->__pyx_n_s_reduce
+#define __pyx_n_s_reduce_cython __pyx_mstate_global->__pyx_n_s_reduce_cython
+#define __pyx_n_s_reduce_ex __pyx_mstate_global->__pyx_n_s_reduce_ex
+#define __pyx_n_s_repr __pyx_mstate_global->__pyx_n_s_repr
+#define __pyx_n_s_res __pyx_mstate_global->__pyx_n_s_res
+#define __pyx_kp_s_s_s __pyx_mstate_global->__pyx_kp_s_s_s
+#define __pyx_kp_s_s_s_d __pyx_mstate_global->__pyx_kp_s_s_s_d
 #define __pyx_n_s_score __pyx_mstate_global->__pyx_n_s_score
 #define __pyx_n_s_score_cutoff __pyx_mstate_global->__pyx_n_s_score_cutoff
 #define __pyx_n_u_score_cutoff __pyx_mstate_global->__pyx_n_u_score_cutoff
 #define __pyx_kp_u_score_cutoff_has_to_be_in_the_ra __pyx_mstate_global->__pyx_kp_u_score_cutoff_has_to_be_in_the_ra
 #define __pyx_n_s_scorer __pyx_mstate_global->__pyx_n_s_scorer
 #define __pyx_n_s_scorer_capsule __pyx_mstate_global->__pyx_n_s_scorer_capsule
 #define __pyx_n_s_scorer_context __pyx_mstate_global->__pyx_n_s_scorer_context
 #define __pyx_kp_u_scorer_does_not_properly_use_the __pyx_mstate_global->__pyx_kp_u_scorer_does_not_properly_use_the
 #define __pyx_n_s_scorer_flags __pyx_mstate_global->__pyx_n_s_scorer_flags
 #define __pyx_n_s_scorer_func __pyx_mstate_global->__pyx_n_s_scorer_func
+#define __pyx_n_s_self __pyx_mstate_global->__pyx_n_s_self
+#define __pyx_kp_s_self_matrix_cannot_be_converted __pyx_mstate_global->__pyx_kp_s_self_matrix_cannot_be_converted
 #define __pyx_n_s_send __pyx_mstate_global->__pyx_n_s_send
+#define __pyx_n_s_set_name __pyx_mstate_global->__pyx_n_s_set_name
+#define __pyx_n_s_setstate __pyx_mstate_global->__pyx_n_s_setstate
+#define __pyx_n_s_setstate_cython __pyx_mstate_global->__pyx_n_s_setstate_cython
 #define __pyx_n_s_spec __pyx_mstate_global->__pyx_n_s_spec
-#define __pyx_kp_s_src_rapidfuzz_process_cpp_pyx __pyx_mstate_global->__pyx_kp_s_src_rapidfuzz_process_cpp_pyx
+#define __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p __pyx_mstate_global->__pyx_kp_s_src_rapidfuzz_process_cpp_impl_p
+#define __pyx_n_s_state __pyx_mstate_global->__pyx_n_s_state
+#define __pyx_n_s_str __pyx_mstate_global->__pyx_n_s_str
+#define __pyx_kp_s_stringsource __pyx_mstate_global->__pyx_kp_s_stringsource
+#define __pyx_n_s_super __pyx_mstate_global->__pyx_n_s_super
 #define __pyx_n_s_test __pyx_mstate_global->__pyx_n_s_test
 #define __pyx_n_s_throw __pyx_mstate_global->__pyx_n_s_throw
 #define __pyx_n_s_typecode __pyx_mstate_global->__pyx_n_s_typecode
+#define __pyx_n_s_update __pyx_mstate_global->__pyx_n_s_update
+#define __pyx_n_s_use_setstate __pyx_mstate_global->__pyx_n_s_use_setstate
+#define __pyx_n_s_v __pyx_mstate_global->__pyx_n_s_v
+#define __pyx_n_s_value __pyx_mstate_global->__pyx_n_s_value
+#define __pyx_n_s_values __pyx_mstate_global->__pyx_n_s_values
+#define __pyx_n_s_workers __pyx_mstate_global->__pyx_n_s_workers
 #define __pyx_n_s_worst_score __pyx_mstate_global->__pyx_n_s_worst_score
 #define __pyx_n_u_worst_score __pyx_mstate_global->__pyx_n_u_worst_score
 #define __pyx_int_0 __pyx_mstate_global->__pyx_int_0
 #define __pyx_int_1 __pyx_mstate_global->__pyx_int_1
 #define __pyx_int_5 __pyx_mstate_global->__pyx_int_5
 #define __pyx_int_100 __pyx_mstate_global->__pyx_int_100
+#define __pyx_int_222419149 __pyx_mstate_global->__pyx_int_222419149
+#define __pyx_int_228825662 __pyx_mstate_global->__pyx_int_228825662
+#define __pyx_int_238750788 __pyx_mstate_global->__pyx_int_238750788
 #define __pyx_int_neg_1 __pyx_mstate_global->__pyx_int_neg_1
 #define __pyx_tuple_ __pyx_mstate_global->__pyx_tuple_
 #define __pyx_tuple__2 __pyx_mstate_global->__pyx_tuple__2
 #define __pyx_tuple__6 __pyx_mstate_global->__pyx_tuple__6
 #define __pyx_tuple__9 __pyx_mstate_global->__pyx_tuple__9
 #define __pyx_tuple__12 __pyx_mstate_global->__pyx_tuple__12
 #define __pyx_tuple__14 __pyx_mstate_global->__pyx_tuple__14
-#define __pyx_tuple__20 __pyx_mstate_global->__pyx_tuple__20
 #define __pyx_tuple__21 __pyx_mstate_global->__pyx_tuple__21
-#define __pyx_tuple__22 __pyx_mstate_global->__pyx_tuple__22
+#define __pyx_tuple__24 __pyx_mstate_global->__pyx_tuple__24
+#define __pyx_tuple__25 __pyx_mstate_global->__pyx_tuple__25
+#define __pyx_tuple__26 __pyx_mstate_global->__pyx_tuple__26
+#define __pyx_tuple__27 __pyx_mstate_global->__pyx_tuple__27
+#define __pyx_tuple__28 __pyx_mstate_global->__pyx_tuple__28
+#define __pyx_tuple__29 __pyx_mstate_global->__pyx_tuple__29
+#define __pyx_tuple__30 __pyx_mstate_global->__pyx_tuple__30
+#define __pyx_tuple__33 __pyx_mstate_global->__pyx_tuple__33
+#define __pyx_tuple__35 __pyx_mstate_global->__pyx_tuple__35
+#define __pyx_tuple__38 __pyx_mstate_global->__pyx_tuple__38
 #define __pyx_codeobj__3 __pyx_mstate_global->__pyx_codeobj__3
 #define __pyx_codeobj__4 __pyx_mstate_global->__pyx_codeobj__4
 #define __pyx_codeobj__5 __pyx_mstate_global->__pyx_codeobj__5
 #define __pyx_codeobj__7 __pyx_mstate_global->__pyx_codeobj__7
 #define __pyx_codeobj__8 __pyx_mstate_global->__pyx_codeobj__8
 #define __pyx_codeobj__10 __pyx_mstate_global->__pyx_codeobj__10
 #define __pyx_codeobj__11 __pyx_mstate_global->__pyx_codeobj__11
 #define __pyx_codeobj__13 __pyx_mstate_global->__pyx_codeobj__13
 #define __pyx_codeobj__15 __pyx_mstate_global->__pyx_codeobj__15
+#define __pyx_codeobj__16 __pyx_mstate_global->__pyx_codeobj__16
+#define __pyx_codeobj__17 __pyx_mstate_global->__pyx_codeobj__17
+#define __pyx_codeobj__18 __pyx_mstate_global->__pyx_codeobj__18
+#define __pyx_codeobj__31 __pyx_mstate_global->__pyx_codeobj__31
+#define __pyx_codeobj__32 __pyx_mstate_global->__pyx_codeobj__32
+#define __pyx_codeobj__34 __pyx_mstate_global->__pyx_codeobj__34
+#define __pyx_codeobj__36 __pyx_mstate_global->__pyx_codeobj__36
+#define __pyx_codeobj__37 __pyx_mstate_global->__pyx_codeobj__37
+#define __pyx_codeobj__39 __pyx_mstate_global->__pyx_codeobj__39
 #endif
 /* #### Code section: module_code ### */
 
-/* "rapidfuzz/process_cpp.pyx":87
- *     cdef T get_optimal_score[T](const RF_ScorerFlags* scorer_flags)
+/* "rapidfuzz/process_cpp_impl.pyx":122
+ *         const vector[RF_StringWrapper]&, const vector[RF_StringWrapper]&, MatrixType, int, T) except +
  * 
  * cdef inline vector[DictStringElem] preprocess_dict(queries, processor) except *:             # <<<<<<<<<<<<<<
  *     cdef vector[DictStringElem] proc_queries
  *     cdef int64_t queries_len = <int64_t>len(queries)
  */
 
-static CYTHON_INLINE std::vector<DictStringElem>  __pyx_f_9rapidfuzz_11process_cpp_preprocess_dict(PyObject *__pyx_v_queries, PyObject *__pyx_v_processor) {
+static CYTHON_INLINE std::vector<DictStringElem>  __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_dict(PyObject *__pyx_v_queries, PyObject *__pyx_v_processor) {
   std::vector<DictStringElem>  __pyx_v_proc_queries;
   int64_t __pyx_v_queries_len;
   RF_String __pyx_v_proc_str;
   RF_Preprocessor *__pyx_v_processor_context;
   int64_t __pyx_v_i;
   PyObject *__pyx_v_query_key = NULL;
   PyObject *__pyx_v_query = NULL;
@@ -3769,399 +4693,399 @@
   void *__pyx_t_12;
   bool __pyx_t_13;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("preprocess_dict", 0);
-  __Pyx_TraceCall("preprocess_dict", __pyx_f[0], 87, 0, __PYX_ERR(0, 87, __pyx_L1_error));
+  __Pyx_TraceCall("preprocess_dict", __pyx_f[0], 122, 0, __PYX_ERR(0, 122, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":89
+  /* "rapidfuzz/process_cpp_impl.pyx":124
  * cdef inline vector[DictStringElem] preprocess_dict(queries, processor) except *:
  *     cdef vector[DictStringElem] proc_queries
  *     cdef int64_t queries_len = <int64_t>len(queries)             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef RF_Preprocessor* processor_context = NULL
  */
-  __Pyx_TraceLine(89,0,__PYX_ERR(0, 89, __pyx_L1_error))
-  __pyx_t_1 = PyObject_Length(__pyx_v_queries); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 89, __pyx_L1_error)
+  __Pyx_TraceLine(124,0,__PYX_ERR(0, 124, __pyx_L1_error))
+  __pyx_t_1 = PyObject_Length(__pyx_v_queries); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 124, __pyx_L1_error)
   __pyx_v_queries_len = ((int64_t)__pyx_t_1);
 
-  /* "rapidfuzz/process_cpp.pyx":91
+  /* "rapidfuzz/process_cpp_impl.pyx":126
  *     cdef int64_t queries_len = <int64_t>len(queries)
  *     cdef RF_String proc_str
  *     cdef RF_Preprocessor* processor_context = NULL             # <<<<<<<<<<<<<<
  *     proc_queries.reserve(queries_len)
  *     cdef int64_t i
  */
-  __Pyx_TraceLine(91,0,__PYX_ERR(0, 91, __pyx_L1_error))
+  __Pyx_TraceLine(126,0,__PYX_ERR(0, 126, __pyx_L1_error))
   __pyx_v_processor_context = NULL;
 
-  /* "rapidfuzz/process_cpp.pyx":92
+  /* "rapidfuzz/process_cpp_impl.pyx":127
  *     cdef RF_String proc_str
  *     cdef RF_Preprocessor* processor_context = NULL
  *     proc_queries.reserve(queries_len)             # <<<<<<<<<<<<<<
  *     cdef int64_t i
  * 
  */
-  __Pyx_TraceLine(92,0,__PYX_ERR(0, 92, __pyx_L1_error))
+  __Pyx_TraceLine(127,0,__PYX_ERR(0, 127, __pyx_L1_error))
   try {
     __pyx_v_proc_queries.reserve(__pyx_v_queries_len);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 92, __pyx_L1_error)
+    __PYX_ERR(0, 127, __pyx_L1_error)
   }
 
-  /* "rapidfuzz/process_cpp.pyx":96
+  /* "rapidfuzz/process_cpp_impl.pyx":131
  * 
  *     # No processor
  *     if not processor:             # <<<<<<<<<<<<<<
  *         for i, (query_key, query) in enumerate(queries.items()):
  *             if query is None:
  */
-  __Pyx_TraceLine(96,0,__PYX_ERR(0, 96, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 96, __pyx_L1_error)
+  __Pyx_TraceLine(131,0,__PYX_ERR(0, 131, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 131, __pyx_L1_error)
   __pyx_t_3 = (!__pyx_t_2);
   if (__pyx_t_3) {
 
-    /* "rapidfuzz/process_cpp.pyx":97
+    /* "rapidfuzz/process_cpp_impl.pyx":132
  *     # No processor
  *     if not processor:
  *         for i, (query_key, query) in enumerate(queries.items()):             # <<<<<<<<<<<<<<
  *             if query is None:
  *                 continue
  */
-    __Pyx_TraceLine(97,0,__PYX_ERR(0, 97, __pyx_L1_error))
+    __Pyx_TraceLine(132,0,__PYX_ERR(0, 132, __pyx_L1_error))
     __pyx_t_4 = 0;
     __pyx_t_1 = 0;
     if (unlikely(__pyx_v_queries == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-      __PYX_ERR(0, 97, __pyx_L1_error)
+      __PYX_ERR(0, 132, __pyx_L1_error)
     }
-    __pyx_t_8 = __Pyx_dict_iterator(__pyx_v_queries, 0, __pyx_n_s_items, (&__pyx_t_6), (&__pyx_t_7)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 97, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_dict_iterator(__pyx_v_queries, 0, __pyx_n_s_items, (&__pyx_t_6), (&__pyx_t_7)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 132, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_XDECREF(__pyx_t_5);
     __pyx_t_5 = __pyx_t_8;
     __pyx_t_8 = 0;
     while (1) {
       __pyx_t_10 = __Pyx_dict_iter_next(__pyx_t_5, __pyx_t_6, &__pyx_t_1, &__pyx_t_8, &__pyx_t_9, NULL, __pyx_t_7);
       if (unlikely(__pyx_t_10 == 0)) break;
-      if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 97, __pyx_L1_error)
+      if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 132, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_XDECREF_SET(__pyx_v_query_key, __pyx_t_8);
       __pyx_t_8 = 0;
       __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_9);
       __pyx_t_9 = 0;
       __pyx_v_i = __pyx_t_4;
       __pyx_t_4 = (__pyx_t_4 + 1);
 
-      /* "rapidfuzz/process_cpp.pyx":98
+      /* "rapidfuzz/process_cpp_impl.pyx":133
  *     if not processor:
  *         for i, (query_key, query) in enumerate(queries.items()):
  *             if query is None:             # <<<<<<<<<<<<<<
  *                 continue
  *             proc_queries.emplace_back(
  */
-      __Pyx_TraceLine(98,0,__PYX_ERR(0, 98, __pyx_L1_error))
+      __Pyx_TraceLine(133,0,__PYX_ERR(0, 133, __pyx_L1_error))
       __pyx_t_3 = (__pyx_v_query == Py_None);
       if (__pyx_t_3) {
 
-        /* "rapidfuzz/process_cpp.pyx":99
+        /* "rapidfuzz/process_cpp_impl.pyx":134
  *         for i, (query_key, query) in enumerate(queries.items()):
  *             if query is None:
  *                 continue             # <<<<<<<<<<<<<<
  *             proc_queries.emplace_back(
  *                 i,
  */
-        __Pyx_TraceLine(99,0,__PYX_ERR(0, 99, __pyx_L1_error))
+        __Pyx_TraceLine(134,0,__PYX_ERR(0, 134, __pyx_L1_error))
         goto __pyx_L4_continue;
 
-        /* "rapidfuzz/process_cpp.pyx":98
+        /* "rapidfuzz/process_cpp_impl.pyx":133
  *     if not processor:
  *         for i, (query_key, query) in enumerate(queries.items()):
  *             if query is None:             # <<<<<<<<<<<<<<
  *                 continue
  *             proc_queries.emplace_back(
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":104
+      /* "rapidfuzz/process_cpp_impl.pyx":139
  *                 move(PyObjectWrapper(query_key)),
  *                 move(PyObjectWrapper(query)),
  *                 move(RF_StringWrapper(conv_sequence(query)))             # <<<<<<<<<<<<<<
  *             )
  *     else:
  */
-      __Pyx_TraceLine(104,0,__PYX_ERR(0, 104, __pyx_L1_error))
-      __pyx_t_11 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 104, __pyx_L1_error)
+      __Pyx_TraceLine(139,0,__PYX_ERR(0, 139, __pyx_L1_error))
+      __pyx_t_11 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 139, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":100
+      /* "rapidfuzz/process_cpp_impl.pyx":135
  *             if query is None:
  *                 continue
  *             proc_queries.emplace_back(             # <<<<<<<<<<<<<<
  *                 i,
  *                 move(PyObjectWrapper(query_key)),
  */
-      __Pyx_TraceLine(100,0,__PYX_ERR(0, 100, __pyx_L1_error))
+      __Pyx_TraceLine(135,0,__PYX_ERR(0, 135, __pyx_L1_error))
       try {
         __pyx_v_proc_queries.emplace_back(__pyx_v_i, cython_std::move<PyObjectWrapper>(PyObjectWrapper(__pyx_v_query_key)), cython_std::move<PyObjectWrapper>(PyObjectWrapper(__pyx_v_query)), cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_11)));
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 100, __pyx_L1_error)
+        __PYX_ERR(0, 135, __pyx_L1_error)
       }
       __pyx_L4_continue:;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":96
+    /* "rapidfuzz/process_cpp_impl.pyx":131
  * 
  *     # No processor
  *     if not processor:             # <<<<<<<<<<<<<<
  *         for i, (query_key, query) in enumerate(queries.items()):
  *             if query is None:
  */
     goto __pyx_L3;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":107
+  /* "rapidfuzz/process_cpp_impl.pyx":142
  *             )
  *     else:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)             # <<<<<<<<<<<<<<
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  */
-  __Pyx_TraceLine(107,0,__PYX_ERR(0, 107, __pyx_L1_error))
+  __Pyx_TraceLine(142,0,__PYX_ERR(0, 142, __pyx_L1_error))
   /*else*/ {
-    __pyx_t_5 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 107, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_v_processor_capsule = __pyx_t_5;
     __pyx_t_5 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":108
+    /* "rapidfuzz/process_cpp_impl.pyx":143
  *     else:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
-    __Pyx_TraceLine(108,0,__PYX_ERR(0, 108, __pyx_L1_error))
+    __Pyx_TraceLine(143,0,__PYX_ERR(0, 143, __pyx_L1_error))
     __pyx_t_3 = PyCapsule_IsValid(__pyx_v_processor_capsule, NULL);
     if (__pyx_t_3) {
 
-      /* "rapidfuzz/process_cpp.pyx":109
+      /* "rapidfuzz/process_cpp_impl.pyx":144
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *         # use RapidFuzz C-Api
  */
-      __Pyx_TraceLine(109,0,__PYX_ERR(0, 109, __pyx_L1_error))
-      __pyx_t_12 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_12 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 109, __pyx_L1_error)
+      __Pyx_TraceLine(144,0,__PYX_ERR(0, 144, __pyx_L1_error))
+      __pyx_t_12 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_12 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 144, __pyx_L1_error)
       __pyx_v_processor_context = ((RF_Preprocessor *)__pyx_t_12);
 
-      /* "rapidfuzz/process_cpp.pyx":108
+      /* "rapidfuzz/process_cpp_impl.pyx":143
  *     else:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":112
+    /* "rapidfuzz/process_cpp_impl.pyx":147
  * 
  *         # use RapidFuzz C-Api
  *         if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             for i, (query_key, query) in enumerate(queries.items()):
  *                 if query is None:
  */
-    __Pyx_TraceLine(112,0,__PYX_ERR(0, 112, __pyx_L1_error))
+    __Pyx_TraceLine(147,0,__PYX_ERR(0, 147, __pyx_L1_error))
     __pyx_t_2 = (__pyx_v_processor_context != NULL);
     if (__pyx_t_2) {
     } else {
       __pyx_t_3 = __pyx_t_2;
       goto __pyx_L9_bool_binop_done;
     }
     __pyx_t_2 = (__pyx_v_processor_context->version == 1);
     __pyx_t_3 = __pyx_t_2;
     __pyx_L9_bool_binop_done:;
     if (__pyx_t_3) {
 
-      /* "rapidfuzz/process_cpp.pyx":113
+      /* "rapidfuzz/process_cpp_impl.pyx":148
  *         # use RapidFuzz C-Api
  *         if processor_context != NULL and processor_context.version == 1:
  *             for i, (query_key, query) in enumerate(queries.items()):             # <<<<<<<<<<<<<<
  *                 if query is None:
  *                     continue
  */
-      __Pyx_TraceLine(113,0,__PYX_ERR(0, 113, __pyx_L1_error))
+      __Pyx_TraceLine(148,0,__PYX_ERR(0, 148, __pyx_L1_error))
       __pyx_t_4 = 0;
       __pyx_t_6 = 0;
       if (unlikely(__pyx_v_queries == Py_None)) {
         PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-        __PYX_ERR(0, 113, __pyx_L1_error)
+        __PYX_ERR(0, 148, __pyx_L1_error)
       }
-      __pyx_t_9 = __Pyx_dict_iterator(__pyx_v_queries, 0, __pyx_n_s_items, (&__pyx_t_1), (&__pyx_t_7)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 113, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_dict_iterator(__pyx_v_queries, 0, __pyx_n_s_items, (&__pyx_t_1), (&__pyx_t_7)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 148, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_XDECREF(__pyx_t_5);
       __pyx_t_5 = __pyx_t_9;
       __pyx_t_9 = 0;
       while (1) {
         __pyx_t_10 = __Pyx_dict_iter_next(__pyx_t_5, __pyx_t_1, &__pyx_t_6, &__pyx_t_9, &__pyx_t_8, NULL, __pyx_t_7);
         if (unlikely(__pyx_t_10 == 0)) break;
-        if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 113, __pyx_L1_error)
+        if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 148, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_XDECREF_SET(__pyx_v_query_key, __pyx_t_9);
         __pyx_t_9 = 0;
         __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_8);
         __pyx_t_8 = 0;
         __pyx_v_i = __pyx_t_4;
         __pyx_t_4 = (__pyx_t_4 + 1);
 
-        /* "rapidfuzz/process_cpp.pyx":114
+        /* "rapidfuzz/process_cpp_impl.pyx":149
  *         if processor_context != NULL and processor_context.version == 1:
  *             for i, (query_key, query) in enumerate(queries.items()):
  *                 if query is None:             # <<<<<<<<<<<<<<
  *                     continue
  *                 processor_context.preprocess(query, &proc_str)
  */
-        __Pyx_TraceLine(114,0,__PYX_ERR(0, 114, __pyx_L1_error))
+        __Pyx_TraceLine(149,0,__PYX_ERR(0, 149, __pyx_L1_error))
         __pyx_t_3 = (__pyx_v_query == Py_None);
         if (__pyx_t_3) {
 
-          /* "rapidfuzz/process_cpp.pyx":115
+          /* "rapidfuzz/process_cpp_impl.pyx":150
  *             for i, (query_key, query) in enumerate(queries.items()):
  *                 if query is None:
  *                     continue             # <<<<<<<<<<<<<<
  *                 processor_context.preprocess(query, &proc_str)
  *                 proc_queries.emplace_back(
  */
-          __Pyx_TraceLine(115,0,__PYX_ERR(0, 115, __pyx_L1_error))
+          __Pyx_TraceLine(150,0,__PYX_ERR(0, 150, __pyx_L1_error))
           goto __pyx_L11_continue;
 
-          /* "rapidfuzz/process_cpp.pyx":114
+          /* "rapidfuzz/process_cpp_impl.pyx":149
  *         if processor_context != NULL and processor_context.version == 1:
  *             for i, (query_key, query) in enumerate(queries.items()):
  *                 if query is None:             # <<<<<<<<<<<<<<
  *                     continue
  *                 processor_context.preprocess(query, &proc_str)
  */
         }
 
-        /* "rapidfuzz/process_cpp.pyx":116
+        /* "rapidfuzz/process_cpp_impl.pyx":151
  *                 if query is None:
  *                     continue
  *                 processor_context.preprocess(query, &proc_str)             # <<<<<<<<<<<<<<
  *                 proc_queries.emplace_back(
  *                     i,
  */
-        __Pyx_TraceLine(116,0,__PYX_ERR(0, 116, __pyx_L1_error))
-        __pyx_t_13 = __pyx_v_processor_context->preprocess(__pyx_v_query, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_13 == ((bool)0))) __PYX_ERR(0, 116, __pyx_L1_error)
+        __Pyx_TraceLine(151,0,__PYX_ERR(0, 151, __pyx_L1_error))
+        __pyx_t_13 = __pyx_v_processor_context->preprocess(__pyx_v_query, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_13 == ((bool)0))) __PYX_ERR(0, 151, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":117
+        /* "rapidfuzz/process_cpp_impl.pyx":152
  *                     continue
  *                 processor_context.preprocess(query, &proc_str)
  *                 proc_queries.emplace_back(             # <<<<<<<<<<<<<<
  *                     i,
  *                     move(PyObjectWrapper(query_key)),
  */
-        __Pyx_TraceLine(117,0,__PYX_ERR(0, 117, __pyx_L1_error))
+        __Pyx_TraceLine(152,0,__PYX_ERR(0, 152, __pyx_L1_error))
         try {
           __pyx_v_proc_queries.emplace_back(__pyx_v_i, cython_std::move<PyObjectWrapper>(PyObjectWrapper(__pyx_v_query_key)), cython_std::move<PyObjectWrapper>(PyObjectWrapper(__pyx_v_query)), cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_v_proc_str)));
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 117, __pyx_L1_error)
+          __PYX_ERR(0, 152, __pyx_L1_error)
         }
         __pyx_L11_continue:;
       }
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":112
+      /* "rapidfuzz/process_cpp_impl.pyx":147
  * 
  *         # use RapidFuzz C-Api
  *         if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             for i, (query_key, query) in enumerate(queries.items()):
  *                 if query is None:
  */
       goto __pyx_L8;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":126
+    /* "rapidfuzz/process_cpp_impl.pyx":161
  *         # Call Processor through Python
  *         else:
  *             for i, (query_key, query) in enumerate(queries.items()):             # <<<<<<<<<<<<<<
  *                 if query is None:
  *                     continue
  */
-    __Pyx_TraceLine(126,0,__PYX_ERR(0, 126, __pyx_L1_error))
+    __Pyx_TraceLine(161,0,__PYX_ERR(0, 161, __pyx_L1_error))
     /*else*/ {
       __pyx_t_4 = 0;
       __pyx_t_1 = 0;
       if (unlikely(__pyx_v_queries == Py_None)) {
         PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-        __PYX_ERR(0, 126, __pyx_L1_error)
+        __PYX_ERR(0, 161, __pyx_L1_error)
       }
-      __pyx_t_8 = __Pyx_dict_iterator(__pyx_v_queries, 0, __pyx_n_s_items, (&__pyx_t_6), (&__pyx_t_7)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 126, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_dict_iterator(__pyx_v_queries, 0, __pyx_n_s_items, (&__pyx_t_6), (&__pyx_t_7)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 161, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_XDECREF(__pyx_t_5);
       __pyx_t_5 = __pyx_t_8;
       __pyx_t_8 = 0;
       while (1) {
         __pyx_t_10 = __Pyx_dict_iter_next(__pyx_t_5, __pyx_t_6, &__pyx_t_1, &__pyx_t_8, &__pyx_t_9, NULL, __pyx_t_7);
         if (unlikely(__pyx_t_10 == 0)) break;
-        if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 126, __pyx_L1_error)
+        if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 161, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_XDECREF_SET(__pyx_v_query_key, __pyx_t_8);
         __pyx_t_8 = 0;
         __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_9);
         __pyx_t_9 = 0;
         __pyx_v_i = __pyx_t_4;
         __pyx_t_4 = (__pyx_t_4 + 1);
 
-        /* "rapidfuzz/process_cpp.pyx":127
+        /* "rapidfuzz/process_cpp_impl.pyx":162
  *         else:
  *             for i, (query_key, query) in enumerate(queries.items()):
  *                 if query is None:             # <<<<<<<<<<<<<<
  *                     continue
  *                 proc_query = processor(query)
  */
-        __Pyx_TraceLine(127,0,__PYX_ERR(0, 127, __pyx_L1_error))
+        __Pyx_TraceLine(162,0,__PYX_ERR(0, 162, __pyx_L1_error))
         __pyx_t_3 = (__pyx_v_query == Py_None);
         if (__pyx_t_3) {
 
-          /* "rapidfuzz/process_cpp.pyx":128
+          /* "rapidfuzz/process_cpp_impl.pyx":163
  *             for i, (query_key, query) in enumerate(queries.items()):
  *                 if query is None:
  *                     continue             # <<<<<<<<<<<<<<
  *                 proc_query = processor(query)
  *                 proc_queries.emplace_back(
  */
-          __Pyx_TraceLine(128,0,__PYX_ERR(0, 128, __pyx_L1_error))
+          __Pyx_TraceLine(163,0,__PYX_ERR(0, 163, __pyx_L1_error))
           goto __pyx_L14_continue;
 
-          /* "rapidfuzz/process_cpp.pyx":127
+          /* "rapidfuzz/process_cpp_impl.pyx":162
  *         else:
  *             for i, (query_key, query) in enumerate(queries.items()):
  *                 if query is None:             # <<<<<<<<<<<<<<
  *                     continue
  *                 proc_query = processor(query)
  */
         }
 
-        /* "rapidfuzz/process_cpp.pyx":129
+        /* "rapidfuzz/process_cpp_impl.pyx":164
  *                 if query is None:
  *                     continue
  *                 proc_query = processor(query)             # <<<<<<<<<<<<<<
  *                 proc_queries.emplace_back(
  *                     i,
  */
-        __Pyx_TraceLine(129,0,__PYX_ERR(0, 129, __pyx_L1_error))
+        __Pyx_TraceLine(164,0,__PYX_ERR(0, 164, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_processor);
         __pyx_t_8 = __pyx_v_processor; __pyx_t_14 = NULL;
         __pyx_t_10 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
           __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_8);
           if (likely(__pyx_t_14)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -4171,99 +5095,99 @@
             __pyx_t_10 = 1;
           }
         }
         {
           PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_query};
           __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
           __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 129, __pyx_L1_error)
+          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 164, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_9);
           __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         }
         __Pyx_XDECREF_SET(__pyx_v_proc_query, __pyx_t_9);
         __pyx_t_9 = 0;
 
-        /* "rapidfuzz/process_cpp.pyx":134
+        /* "rapidfuzz/process_cpp_impl.pyx":169
  *                     move(PyObjectWrapper(query_key)),
  *                     move(PyObjectWrapper(query)),
  *                     move(RF_StringWrapper(conv_sequence(proc_query), proc_query))             # <<<<<<<<<<<<<<
  *                 )
  * 
  */
-        __Pyx_TraceLine(134,0,__PYX_ERR(0, 134, __pyx_L1_error))
-        __pyx_t_11 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_proc_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 134, __pyx_L1_error)
+        __Pyx_TraceLine(169,0,__PYX_ERR(0, 169, __pyx_L1_error))
+        __pyx_t_11 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_proc_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 169, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":130
+        /* "rapidfuzz/process_cpp_impl.pyx":165
  *                     continue
  *                 proc_query = processor(query)
  *                 proc_queries.emplace_back(             # <<<<<<<<<<<<<<
  *                     i,
  *                     move(PyObjectWrapper(query_key)),
  */
-        __Pyx_TraceLine(130,0,__PYX_ERR(0, 130, __pyx_L1_error))
+        __Pyx_TraceLine(165,0,__PYX_ERR(0, 165, __pyx_L1_error))
         try {
           __pyx_v_proc_queries.emplace_back(__pyx_v_i, cython_std::move<PyObjectWrapper>(PyObjectWrapper(__pyx_v_query_key)), cython_std::move<PyObjectWrapper>(PyObjectWrapper(__pyx_v_query)), cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_11, __pyx_v_proc_query)));
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 130, __pyx_L1_error)
+          __PYX_ERR(0, 165, __pyx_L1_error)
         }
         __pyx_L14_continue:;
       }
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     }
     __pyx_L8:;
   }
   __pyx_L3:;
 
-  /* "rapidfuzz/process_cpp.pyx":137
+  /* "rapidfuzz/process_cpp_impl.pyx":172
  *                 )
  * 
  *     return move(proc_queries)             # <<<<<<<<<<<<<<
  * 
  * cdef inline vector[ListStringElem] preprocess_list(queries, processor) except *:
  */
-  __Pyx_TraceLine(137,0,__PYX_ERR(0, 137, __pyx_L1_error))
+  __Pyx_TraceLine(172,0,__PYX_ERR(0, 172, __pyx_L1_error))
   __pyx_r = cython_std::move<std::vector<DictStringElem> >(__pyx_v_proc_queries);
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":87
- *     cdef T get_optimal_score[T](const RF_ScorerFlags* scorer_flags)
+  /* "rapidfuzz/process_cpp_impl.pyx":122
+ *         const vector[RF_StringWrapper]&, const vector[RF_StringWrapper]&, MatrixType, int, T) except +
  * 
  * cdef inline vector[DictStringElem] preprocess_dict(queries, processor) except *:             # <<<<<<<<<<<<<<
  *     cdef vector[DictStringElem] proc_queries
  *     cdef int64_t queries_len = <int64_t>len(queries)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_8);
   __Pyx_XDECREF(__pyx_t_9);
   __Pyx_XDECREF(__pyx_t_14);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.preprocess_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.preprocess_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_query_key);
   __Pyx_XDECREF(__pyx_v_query);
   __Pyx_XDECREF(__pyx_v_processor_capsule);
   __Pyx_XDECREF(__pyx_v_proc_query);
   __Pyx_TraceReturn(Py_None, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":139
+/* "rapidfuzz/process_cpp_impl.pyx":174
  *     return move(proc_queries)
  * 
  * cdef inline vector[ListStringElem] preprocess_list(queries, processor) except *:             # <<<<<<<<<<<<<<
  *     cdef vector[ListStringElem] proc_queries
  *     cdef int64_t queries_len = <int64_t>len(queries)
  */
 
-static CYTHON_INLINE std::vector<ListStringElem>  __pyx_f_9rapidfuzz_11process_cpp_preprocess_list(PyObject *__pyx_v_queries, PyObject *__pyx_v_processor) {
+static CYTHON_INLINE std::vector<ListStringElem>  __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_list(PyObject *__pyx_v_queries, PyObject *__pyx_v_processor) {
   std::vector<ListStringElem>  __pyx_v_proc_queries;
   int64_t __pyx_v_queries_len;
   RF_String __pyx_v_proc_str;
   RF_Preprocessor *__pyx_v_processor_context;
   int64_t __pyx_v_i;
   PyObject *__pyx_v_query = NULL;
   PyObject *__pyx_v_processor_capsule = NULL;
@@ -4284,480 +5208,480 @@
   PyObject *__pyx_t_11 = NULL;
   PyObject *__pyx_t_12 = NULL;
   int __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("preprocess_list", 0);
-  __Pyx_TraceCall("preprocess_list", __pyx_f[0], 139, 0, __PYX_ERR(0, 139, __pyx_L1_error));
+  __Pyx_TraceCall("preprocess_list", __pyx_f[0], 174, 0, __PYX_ERR(0, 174, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":141
+  /* "rapidfuzz/process_cpp_impl.pyx":176
  * cdef inline vector[ListStringElem] preprocess_list(queries, processor) except *:
  *     cdef vector[ListStringElem] proc_queries
  *     cdef int64_t queries_len = <int64_t>len(queries)             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef RF_Preprocessor* processor_context = NULL
  */
-  __Pyx_TraceLine(141,0,__PYX_ERR(0, 141, __pyx_L1_error))
-  __pyx_t_1 = PyObject_Length(__pyx_v_queries); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 141, __pyx_L1_error)
+  __Pyx_TraceLine(176,0,__PYX_ERR(0, 176, __pyx_L1_error))
+  __pyx_t_1 = PyObject_Length(__pyx_v_queries); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 176, __pyx_L1_error)
   __pyx_v_queries_len = ((int64_t)__pyx_t_1);
 
-  /* "rapidfuzz/process_cpp.pyx":143
+  /* "rapidfuzz/process_cpp_impl.pyx":178
  *     cdef int64_t queries_len = <int64_t>len(queries)
  *     cdef RF_String proc_str
  *     cdef RF_Preprocessor* processor_context = NULL             # <<<<<<<<<<<<<<
  *     proc_queries.reserve(queries_len)
  *     cdef int64_t i
  */
-  __Pyx_TraceLine(143,0,__PYX_ERR(0, 143, __pyx_L1_error))
+  __Pyx_TraceLine(178,0,__PYX_ERR(0, 178, __pyx_L1_error))
   __pyx_v_processor_context = NULL;
 
-  /* "rapidfuzz/process_cpp.pyx":144
+  /* "rapidfuzz/process_cpp_impl.pyx":179
  *     cdef RF_String proc_str
  *     cdef RF_Preprocessor* processor_context = NULL
  *     proc_queries.reserve(queries_len)             # <<<<<<<<<<<<<<
  *     cdef int64_t i
  * 
  */
-  __Pyx_TraceLine(144,0,__PYX_ERR(0, 144, __pyx_L1_error))
+  __Pyx_TraceLine(179,0,__PYX_ERR(0, 179, __pyx_L1_error))
   try {
     __pyx_v_proc_queries.reserve(__pyx_v_queries_len);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 144, __pyx_L1_error)
+    __PYX_ERR(0, 179, __pyx_L1_error)
   }
 
-  /* "rapidfuzz/process_cpp.pyx":148
+  /* "rapidfuzz/process_cpp_impl.pyx":183
  * 
  *     # No processor
  *     if not processor:             # <<<<<<<<<<<<<<
  *         for i, query in enumerate(queries):
  *             if query is None:
  */
-  __Pyx_TraceLine(148,0,__PYX_ERR(0, 148, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 148, __pyx_L1_error)
+  __Pyx_TraceLine(183,0,__PYX_ERR(0, 183, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 183, __pyx_L1_error)
   __pyx_t_3 = (!__pyx_t_2);
   if (__pyx_t_3) {
 
-    /* "rapidfuzz/process_cpp.pyx":149
+    /* "rapidfuzz/process_cpp_impl.pyx":184
  *     # No processor
  *     if not processor:
  *         for i, query in enumerate(queries):             # <<<<<<<<<<<<<<
  *             if query is None:
  *                 continue
  */
-    __Pyx_TraceLine(149,0,__PYX_ERR(0, 149, __pyx_L1_error))
+    __Pyx_TraceLine(184,0,__PYX_ERR(0, 184, __pyx_L1_error))
     __pyx_t_4 = 0;
     if (likely(PyList_CheckExact(__pyx_v_queries)) || PyTuple_CheckExact(__pyx_v_queries)) {
       __pyx_t_5 = __pyx_v_queries; __Pyx_INCREF(__pyx_t_5); __pyx_t_1 = 0;
       __pyx_t_6 = NULL;
     } else {
-      __pyx_t_1 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 149, __pyx_L1_error)
+      __pyx_t_1 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 184, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 149, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 184, __pyx_L1_error)
     }
     for (;;) {
       if (likely(!__pyx_t_6)) {
         if (likely(PyList_CheckExact(__pyx_t_5))) {
           if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_5)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 184, __pyx_L1_error)
           #else
-          __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 184, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           #endif
         } else {
           if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 184, __pyx_L1_error)
           #else
-          __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 149, __pyx_L1_error)
+          __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 184, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           #endif
         }
       } else {
         __pyx_t_7 = __pyx_t_6(__pyx_t_5);
         if (unlikely(!__pyx_t_7)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 149, __pyx_L1_error)
+            else __PYX_ERR(0, 184, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_7);
       }
       __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_7);
       __pyx_t_7 = 0;
       __pyx_v_i = __pyx_t_4;
       __pyx_t_4 = (__pyx_t_4 + 1);
 
-      /* "rapidfuzz/process_cpp.pyx":150
+      /* "rapidfuzz/process_cpp_impl.pyx":185
  *     if not processor:
  *         for i, query in enumerate(queries):
  *             if query is None:             # <<<<<<<<<<<<<<
  *                 continue
  *             proc_queries.emplace_back(
  */
-      __Pyx_TraceLine(150,0,__PYX_ERR(0, 150, __pyx_L1_error))
+      __Pyx_TraceLine(185,0,__PYX_ERR(0, 185, __pyx_L1_error))
       __pyx_t_3 = (__pyx_v_query == Py_None);
       if (__pyx_t_3) {
 
-        /* "rapidfuzz/process_cpp.pyx":151
+        /* "rapidfuzz/process_cpp_impl.pyx":186
  *         for i, query in enumerate(queries):
  *             if query is None:
  *                 continue             # <<<<<<<<<<<<<<
  *             proc_queries.emplace_back(
  *                 i,
  */
-        __Pyx_TraceLine(151,0,__PYX_ERR(0, 151, __pyx_L1_error))
+        __Pyx_TraceLine(186,0,__PYX_ERR(0, 186, __pyx_L1_error))
         goto __pyx_L4_continue;
 
-        /* "rapidfuzz/process_cpp.pyx":150
+        /* "rapidfuzz/process_cpp_impl.pyx":185
  *     if not processor:
  *         for i, query in enumerate(queries):
  *             if query is None:             # <<<<<<<<<<<<<<
  *                 continue
  *             proc_queries.emplace_back(
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":155
+      /* "rapidfuzz/process_cpp_impl.pyx":190
  *                 i,
  *                 move(PyObjectWrapper(query)),
  *                 move(RF_StringWrapper(conv_sequence(query)))             # <<<<<<<<<<<<<<
  *             )
  *     else:
  */
-      __Pyx_TraceLine(155,0,__PYX_ERR(0, 155, __pyx_L1_error))
-      __pyx_t_8 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 155, __pyx_L1_error)
+      __Pyx_TraceLine(190,0,__PYX_ERR(0, 190, __pyx_L1_error))
+      __pyx_t_8 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 190, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":152
+      /* "rapidfuzz/process_cpp_impl.pyx":187
  *             if query is None:
  *                 continue
  *             proc_queries.emplace_back(             # <<<<<<<<<<<<<<
  *                 i,
  *                 move(PyObjectWrapper(query)),
  */
-      __Pyx_TraceLine(152,0,__PYX_ERR(0, 152, __pyx_L1_error))
+      __Pyx_TraceLine(187,0,__PYX_ERR(0, 187, __pyx_L1_error))
       try {
         __pyx_v_proc_queries.emplace_back(__pyx_v_i, cython_std::move<PyObjectWrapper>(PyObjectWrapper(__pyx_v_query)), cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_8)));
       } catch(...) {
         __Pyx_CppExn2PyErr();
-        __PYX_ERR(0, 152, __pyx_L1_error)
+        __PYX_ERR(0, 187, __pyx_L1_error)
       }
 
-      /* "rapidfuzz/process_cpp.pyx":149
+      /* "rapidfuzz/process_cpp_impl.pyx":184
  *     # No processor
  *     if not processor:
  *         for i, query in enumerate(queries):             # <<<<<<<<<<<<<<
  *             if query is None:
  *                 continue
  */
-      __Pyx_TraceLine(149,0,__PYX_ERR(0, 149, __pyx_L1_error))
+      __Pyx_TraceLine(184,0,__PYX_ERR(0, 184, __pyx_L1_error))
       __pyx_L4_continue:;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":148
+    /* "rapidfuzz/process_cpp_impl.pyx":183
  * 
  *     # No processor
  *     if not processor:             # <<<<<<<<<<<<<<
  *         for i, query in enumerate(queries):
  *             if query is None:
  */
     goto __pyx_L3;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":158
+  /* "rapidfuzz/process_cpp_impl.pyx":193
  *             )
  *     else:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)             # <<<<<<<<<<<<<<
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  */
-  __Pyx_TraceLine(158,0,__PYX_ERR(0, 158, __pyx_L1_error))
+  __Pyx_TraceLine(193,0,__PYX_ERR(0, 193, __pyx_L1_error))
   /*else*/ {
-    __pyx_t_5 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 158, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 193, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_v_processor_capsule = __pyx_t_5;
     __pyx_t_5 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":159
+    /* "rapidfuzz/process_cpp_impl.pyx":194
  *     else:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
-    __Pyx_TraceLine(159,0,__PYX_ERR(0, 159, __pyx_L1_error))
+    __Pyx_TraceLine(194,0,__PYX_ERR(0, 194, __pyx_L1_error))
     __pyx_t_3 = PyCapsule_IsValid(__pyx_v_processor_capsule, NULL);
     if (__pyx_t_3) {
 
-      /* "rapidfuzz/process_cpp.pyx":160
+      /* "rapidfuzz/process_cpp_impl.pyx":195
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *         # use RapidFuzz C-Api
  */
-      __Pyx_TraceLine(160,0,__PYX_ERR(0, 160, __pyx_L1_error))
-      __pyx_t_9 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_9 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 160, __pyx_L1_error)
+      __Pyx_TraceLine(195,0,__PYX_ERR(0, 195, __pyx_L1_error))
+      __pyx_t_9 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_9 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 195, __pyx_L1_error)
       __pyx_v_processor_context = ((RF_Preprocessor *)__pyx_t_9);
 
-      /* "rapidfuzz/process_cpp.pyx":159
+      /* "rapidfuzz/process_cpp_impl.pyx":194
  *     else:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":163
+    /* "rapidfuzz/process_cpp_impl.pyx":198
  * 
  *         # use RapidFuzz C-Api
  *         if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             for i, query in enumerate(queries):
  *                 if query is None:
  */
-    __Pyx_TraceLine(163,0,__PYX_ERR(0, 163, __pyx_L1_error))
+    __Pyx_TraceLine(198,0,__PYX_ERR(0, 198, __pyx_L1_error))
     __pyx_t_2 = (__pyx_v_processor_context != NULL);
     if (__pyx_t_2) {
     } else {
       __pyx_t_3 = __pyx_t_2;
       goto __pyx_L9_bool_binop_done;
     }
     __pyx_t_2 = (__pyx_v_processor_context->version == 1);
     __pyx_t_3 = __pyx_t_2;
     __pyx_L9_bool_binop_done:;
     if (__pyx_t_3) {
 
-      /* "rapidfuzz/process_cpp.pyx":164
+      /* "rapidfuzz/process_cpp_impl.pyx":199
  *         # use RapidFuzz C-Api
  *         if processor_context != NULL and processor_context.version == 1:
  *             for i, query in enumerate(queries):             # <<<<<<<<<<<<<<
  *                 if query is None:
  *                     continue
  */
-      __Pyx_TraceLine(164,0,__PYX_ERR(0, 164, __pyx_L1_error))
+      __Pyx_TraceLine(199,0,__PYX_ERR(0, 199, __pyx_L1_error))
       __pyx_t_4 = 0;
       if (likely(PyList_CheckExact(__pyx_v_queries)) || PyTuple_CheckExact(__pyx_v_queries)) {
         __pyx_t_5 = __pyx_v_queries; __Pyx_INCREF(__pyx_t_5); __pyx_t_1 = 0;
         __pyx_t_6 = NULL;
       } else {
-        __pyx_t_1 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 164, __pyx_L1_error)
+        __pyx_t_1 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 199, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 164, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 199, __pyx_L1_error)
       }
       for (;;) {
         if (likely(!__pyx_t_6)) {
           if (likely(PyList_CheckExact(__pyx_t_5))) {
             if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_5)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_7 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 164, __pyx_L1_error)
+            __pyx_t_7 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 199, __pyx_L1_error)
             #else
-            __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 164, __pyx_L1_error)
+            __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 199, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_7);
             #endif
           } else {
             if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 164, __pyx_L1_error)
+            __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 199, __pyx_L1_error)
             #else
-            __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 164, __pyx_L1_error)
+            __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 199, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_7);
             #endif
           }
         } else {
           __pyx_t_7 = __pyx_t_6(__pyx_t_5);
           if (unlikely(!__pyx_t_7)) {
             PyObject* exc_type = PyErr_Occurred();
             if (exc_type) {
               if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-              else __PYX_ERR(0, 164, __pyx_L1_error)
+              else __PYX_ERR(0, 199, __pyx_L1_error)
             }
             break;
           }
           __Pyx_GOTREF(__pyx_t_7);
         }
         __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_7);
         __pyx_t_7 = 0;
         __pyx_v_i = __pyx_t_4;
         __pyx_t_4 = (__pyx_t_4 + 1);
 
-        /* "rapidfuzz/process_cpp.pyx":165
+        /* "rapidfuzz/process_cpp_impl.pyx":200
  *         if processor_context != NULL and processor_context.version == 1:
  *             for i, query in enumerate(queries):
  *                 if query is None:             # <<<<<<<<<<<<<<
  *                     continue
  *                 processor_context.preprocess(query, &proc_str)
  */
-        __Pyx_TraceLine(165,0,__PYX_ERR(0, 165, __pyx_L1_error))
+        __Pyx_TraceLine(200,0,__PYX_ERR(0, 200, __pyx_L1_error))
         __pyx_t_3 = (__pyx_v_query == Py_None);
         if (__pyx_t_3) {
 
-          /* "rapidfuzz/process_cpp.pyx":166
+          /* "rapidfuzz/process_cpp_impl.pyx":201
  *             for i, query in enumerate(queries):
  *                 if query is None:
  *                     continue             # <<<<<<<<<<<<<<
  *                 processor_context.preprocess(query, &proc_str)
  *                 proc_queries.emplace_back(
  */
-          __Pyx_TraceLine(166,0,__PYX_ERR(0, 166, __pyx_L1_error))
+          __Pyx_TraceLine(201,0,__PYX_ERR(0, 201, __pyx_L1_error))
           goto __pyx_L11_continue;
 
-          /* "rapidfuzz/process_cpp.pyx":165
+          /* "rapidfuzz/process_cpp_impl.pyx":200
  *         if processor_context != NULL and processor_context.version == 1:
  *             for i, query in enumerate(queries):
  *                 if query is None:             # <<<<<<<<<<<<<<
  *                     continue
  *                 processor_context.preprocess(query, &proc_str)
  */
         }
 
-        /* "rapidfuzz/process_cpp.pyx":167
+        /* "rapidfuzz/process_cpp_impl.pyx":202
  *                 if query is None:
  *                     continue
  *                 processor_context.preprocess(query, &proc_str)             # <<<<<<<<<<<<<<
  *                 proc_queries.emplace_back(
  *                     i,
  */
-        __Pyx_TraceLine(167,0,__PYX_ERR(0, 167, __pyx_L1_error))
-        __pyx_t_10 = __pyx_v_processor_context->preprocess(__pyx_v_query, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_10 == ((bool)0))) __PYX_ERR(0, 167, __pyx_L1_error)
+        __Pyx_TraceLine(202,0,__PYX_ERR(0, 202, __pyx_L1_error))
+        __pyx_t_10 = __pyx_v_processor_context->preprocess(__pyx_v_query, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_10 == ((bool)0))) __PYX_ERR(0, 202, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":168
+        /* "rapidfuzz/process_cpp_impl.pyx":203
  *                     continue
  *                 processor_context.preprocess(query, &proc_str)
  *                 proc_queries.emplace_back(             # <<<<<<<<<<<<<<
  *                     i,
  *                     move(PyObjectWrapper(query)),
  */
-        __Pyx_TraceLine(168,0,__PYX_ERR(0, 168, __pyx_L1_error))
+        __Pyx_TraceLine(203,0,__PYX_ERR(0, 203, __pyx_L1_error))
         try {
           __pyx_v_proc_queries.emplace_back(__pyx_v_i, cython_std::move<PyObjectWrapper>(PyObjectWrapper(__pyx_v_query)), cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_v_proc_str)));
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 168, __pyx_L1_error)
+          __PYX_ERR(0, 203, __pyx_L1_error)
         }
 
-        /* "rapidfuzz/process_cpp.pyx":164
+        /* "rapidfuzz/process_cpp_impl.pyx":199
  *         # use RapidFuzz C-Api
  *         if processor_context != NULL and processor_context.version == 1:
  *             for i, query in enumerate(queries):             # <<<<<<<<<<<<<<
  *                 if query is None:
  *                     continue
  */
-        __Pyx_TraceLine(164,0,__PYX_ERR(0, 164, __pyx_L1_error))
+        __Pyx_TraceLine(199,0,__PYX_ERR(0, 199, __pyx_L1_error))
         __pyx_L11_continue:;
       }
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":163
+      /* "rapidfuzz/process_cpp_impl.pyx":198
  * 
  *         # use RapidFuzz C-Api
  *         if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             for i, query in enumerate(queries):
  *                 if query is None:
  */
       goto __pyx_L8;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":176
+    /* "rapidfuzz/process_cpp_impl.pyx":211
  *         # Call Processor through Python
  *         else:
  *             for i, query in enumerate(queries):             # <<<<<<<<<<<<<<
  *                 if query is None:
  *                     continue
  */
-    __Pyx_TraceLine(176,0,__PYX_ERR(0, 176, __pyx_L1_error))
+    __Pyx_TraceLine(211,0,__PYX_ERR(0, 211, __pyx_L1_error))
     /*else*/ {
       __pyx_t_4 = 0;
       if (likely(PyList_CheckExact(__pyx_v_queries)) || PyTuple_CheckExact(__pyx_v_queries)) {
         __pyx_t_5 = __pyx_v_queries; __Pyx_INCREF(__pyx_t_5); __pyx_t_1 = 0;
         __pyx_t_6 = NULL;
       } else {
-        __pyx_t_1 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 176, __pyx_L1_error)
+        __pyx_t_1 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 211, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
-        __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 176, __pyx_L1_error)
+        __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 211, __pyx_L1_error)
       }
       for (;;) {
         if (likely(!__pyx_t_6)) {
           if (likely(PyList_CheckExact(__pyx_t_5))) {
             if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_5)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_7 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 176, __pyx_L1_error)
+            __pyx_t_7 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 211, __pyx_L1_error)
             #else
-            __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 176, __pyx_L1_error)
+            __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 211, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_7);
             #endif
           } else {
             if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
             #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-            __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 176, __pyx_L1_error)
+            __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_1); __Pyx_INCREF(__pyx_t_7); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 211, __pyx_L1_error)
             #else
-            __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 176, __pyx_L1_error)
+            __pyx_t_7 = PySequence_ITEM(__pyx_t_5, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 211, __pyx_L1_error)
             __Pyx_GOTREF(__pyx_t_7);
             #endif
           }
         } else {
           __pyx_t_7 = __pyx_t_6(__pyx_t_5);
           if (unlikely(!__pyx_t_7)) {
             PyObject* exc_type = PyErr_Occurred();
             if (exc_type) {
               if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-              else __PYX_ERR(0, 176, __pyx_L1_error)
+              else __PYX_ERR(0, 211, __pyx_L1_error)
             }
             break;
           }
           __Pyx_GOTREF(__pyx_t_7);
         }
         __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_7);
         __pyx_t_7 = 0;
         __pyx_v_i = __pyx_t_4;
         __pyx_t_4 = (__pyx_t_4 + 1);
 
-        /* "rapidfuzz/process_cpp.pyx":177
+        /* "rapidfuzz/process_cpp_impl.pyx":212
  *         else:
  *             for i, query in enumerate(queries):
  *                 if query is None:             # <<<<<<<<<<<<<<
  *                     continue
  *                 proc_query = processor(query)
  */
-        __Pyx_TraceLine(177,0,__PYX_ERR(0, 177, __pyx_L1_error))
+        __Pyx_TraceLine(212,0,__PYX_ERR(0, 212, __pyx_L1_error))
         __pyx_t_3 = (__pyx_v_query == Py_None);
         if (__pyx_t_3) {
 
-          /* "rapidfuzz/process_cpp.pyx":178
+          /* "rapidfuzz/process_cpp_impl.pyx":213
  *             for i, query in enumerate(queries):
  *                 if query is None:
  *                     continue             # <<<<<<<<<<<<<<
  *                 proc_query = processor(query)
  *                 proc_queries.emplace_back(
  */
-          __Pyx_TraceLine(178,0,__PYX_ERR(0, 178, __pyx_L1_error))
+          __Pyx_TraceLine(213,0,__PYX_ERR(0, 213, __pyx_L1_error))
           goto __pyx_L14_continue;
 
-          /* "rapidfuzz/process_cpp.pyx":177
+          /* "rapidfuzz/process_cpp_impl.pyx":212
  *         else:
  *             for i, query in enumerate(queries):
  *                 if query is None:             # <<<<<<<<<<<<<<
  *                     continue
  *                 proc_query = processor(query)
  */
         }
 
-        /* "rapidfuzz/process_cpp.pyx":179
+        /* "rapidfuzz/process_cpp_impl.pyx":214
  *                 if query is None:
  *                     continue
  *                 proc_query = processor(query)             # <<<<<<<<<<<<<<
  *                 proc_queries.emplace_back(
  *                     i,
  */
-        __Pyx_TraceLine(179,0,__PYX_ERR(0, 179, __pyx_L1_error))
+        __Pyx_TraceLine(214,0,__PYX_ERR(0, 214, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_processor);
         __pyx_t_11 = __pyx_v_processor; __pyx_t_12 = NULL;
         __pyx_t_13 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
           __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_11);
           if (likely(__pyx_t_12)) {
             PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
@@ -4767,107 +5691,107 @@
             __pyx_t_13 = 1;
           }
         }
         {
           PyObject *__pyx_callargs[2] = {__pyx_t_12, __pyx_v_query};
           __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_13, 1+__pyx_t_13);
           __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-          if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 179, __pyx_L1_error)
+          if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 214, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
         }
         __Pyx_XDECREF_SET(__pyx_v_proc_query, __pyx_t_7);
         __pyx_t_7 = 0;
 
-        /* "rapidfuzz/process_cpp.pyx":183
+        /* "rapidfuzz/process_cpp_impl.pyx":218
  *                     i,
  *                     move(PyObjectWrapper(query)),
  *                     move(RF_StringWrapper(conv_sequence(proc_query), proc_query))             # <<<<<<<<<<<<<<
  *                 )
  * 
  */
-        __Pyx_TraceLine(183,0,__PYX_ERR(0, 183, __pyx_L1_error))
-        __pyx_t_8 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_proc_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 183, __pyx_L1_error)
+        __Pyx_TraceLine(218,0,__PYX_ERR(0, 218, __pyx_L1_error))
+        __pyx_t_8 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_proc_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 218, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":180
+        /* "rapidfuzz/process_cpp_impl.pyx":215
  *                     continue
  *                 proc_query = processor(query)
  *                 proc_queries.emplace_back(             # <<<<<<<<<<<<<<
  *                     i,
  *                     move(PyObjectWrapper(query)),
  */
-        __Pyx_TraceLine(180,0,__PYX_ERR(0, 180, __pyx_L1_error))
+        __Pyx_TraceLine(215,0,__PYX_ERR(0, 215, __pyx_L1_error))
         try {
           __pyx_v_proc_queries.emplace_back(__pyx_v_i, cython_std::move<PyObjectWrapper>(PyObjectWrapper(__pyx_v_query)), cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_8, __pyx_v_proc_query)));
         } catch(...) {
           __Pyx_CppExn2PyErr();
-          __PYX_ERR(0, 180, __pyx_L1_error)
+          __PYX_ERR(0, 215, __pyx_L1_error)
         }
 
-        /* "rapidfuzz/process_cpp.pyx":176
+        /* "rapidfuzz/process_cpp_impl.pyx":211
  *         # Call Processor through Python
  *         else:
  *             for i, query in enumerate(queries):             # <<<<<<<<<<<<<<
  *                 if query is None:
  *                     continue
  */
-        __Pyx_TraceLine(176,0,__PYX_ERR(0, 176, __pyx_L1_error))
+        __Pyx_TraceLine(211,0,__PYX_ERR(0, 211, __pyx_L1_error))
         __pyx_L14_continue:;
       }
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     }
     __pyx_L8:;
   }
   __pyx_L3:;
 
-  /* "rapidfuzz/process_cpp.pyx":186
+  /* "rapidfuzz/process_cpp_impl.pyx":221
  *                 )
  * 
  *     return move(proc_queries)             # <<<<<<<<<<<<<<
  * 
  * cdef inline extractOne_dict_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):
  */
-  __Pyx_TraceLine(186,0,__PYX_ERR(0, 186, __pyx_L1_error))
+  __Pyx_TraceLine(221,0,__PYX_ERR(0, 221, __pyx_L1_error))
   __pyx_r = cython_std::move<std::vector<ListStringElem> >(__pyx_v_proc_queries);
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":139
+  /* "rapidfuzz/process_cpp_impl.pyx":174
  *     return move(proc_queries)
  * 
  * cdef inline vector[ListStringElem] preprocess_list(queries, processor) except *:             # <<<<<<<<<<<<<<
  *     cdef vector[ListStringElem] proc_queries
  *     cdef int64_t queries_len = <int64_t>len(queries)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_11);
   __Pyx_XDECREF(__pyx_t_12);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.preprocess_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.preprocess_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_query);
   __Pyx_XDECREF(__pyx_v_processor_capsule);
   __Pyx_XDECREF(__pyx_v_proc_query);
   __Pyx_TraceReturn(Py_None, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":188
+/* "rapidfuzz/process_cpp_impl.pyx":223
  *     return move(proc_queries)
  * 
  * cdef inline extractOne_dict_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef double score
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_dict_f64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_dict_f64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   RF_String __pyx_v_proc_str;
   double __pyx_v_score;
   Py_ssize_t __pyx_v_i;
   RF_Preprocessor *__pyx_v_processor_context;
   PyObject *__pyx_v_processor_capsule = NULL;
   RF_StringWrapper __pyx_v_proc_query;
   double __pyx_v_c_score_cutoff;
@@ -4900,392 +5824,392 @@
   int __pyx_t_12;
   int __pyx_t_13;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extractOne_dict_f64", 0);
-  __Pyx_TraceCall("extractOne_dict_f64", __pyx_f[0], 188, 0, __PYX_ERR(0, 188, __pyx_L1_error));
+  __Pyx_TraceCall("extractOne_dict_f64", __pyx_f[0], 223, 0, __PYX_ERR(0, 223, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":191
+  /* "rapidfuzz/process_cpp_impl.pyx":226
  *     cdef RF_String proc_str
  *     cdef double score
  *     cdef Py_ssize_t i = 0             # <<<<<<<<<<<<<<
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:
  */
-  __Pyx_TraceLine(191,0,__PYX_ERR(0, 191, __pyx_L1_error))
+  __Pyx_TraceLine(226,0,__PYX_ERR(0, 226, __pyx_L1_error))
   __pyx_v_i = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":192
+  /* "rapidfuzz/process_cpp_impl.pyx":227
  *     cdef double score
  *     cdef Py_ssize_t i = 0
  *     cdef RF_Preprocessor* processor_context = NULL             # <<<<<<<<<<<<<<
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  */
-  __Pyx_TraceLine(192,0,__PYX_ERR(0, 192, __pyx_L1_error))
+  __Pyx_TraceLine(227,0,__PYX_ERR(0, 227, __pyx_L1_error))
   __pyx_v_processor_context = NULL;
 
-  /* "rapidfuzz/process_cpp.pyx":193
+  /* "rapidfuzz/process_cpp_impl.pyx":228
  *     cdef Py_ssize_t i = 0
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:             # <<<<<<<<<<<<<<
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  */
-  __Pyx_TraceLine(193,0,__PYX_ERR(0, 193, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 193, __pyx_L1_error)
+  __Pyx_TraceLine(228,0,__PYX_ERR(0, 228, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 228, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":194
+    /* "rapidfuzz/process_cpp_impl.pyx":229
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)             # <<<<<<<<<<<<<<
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  */
-    __Pyx_TraceLine(194,0,__PYX_ERR(0, 194, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 194, __pyx_L1_error)
+    __Pyx_TraceLine(229,0,__PYX_ERR(0, 229, __pyx_L1_error))
+    __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 229, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_v_processor_capsule = __pyx_t_2;
     __pyx_t_2 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":195
+    /* "rapidfuzz/process_cpp_impl.pyx":230
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
-    __Pyx_TraceLine(195,0,__PYX_ERR(0, 195, __pyx_L1_error))
+    __Pyx_TraceLine(230,0,__PYX_ERR(0, 230, __pyx_L1_error))
     __pyx_t_1 = PyCapsule_IsValid(__pyx_v_processor_capsule, NULL);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":196
+      /* "rapidfuzz/process_cpp_impl.pyx":231
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))
  */
-      __Pyx_TraceLine(196,0,__PYX_ERR(0, 196, __pyx_L1_error))
-      __pyx_t_3 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_3 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 196, __pyx_L1_error)
+      __Pyx_TraceLine(231,0,__PYX_ERR(0, 231, __pyx_L1_error))
+      __pyx_t_3 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_3 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 231, __pyx_L1_error)
       __pyx_v_processor_context = ((RF_Preprocessor *)__pyx_t_3);
 
-      /* "rapidfuzz/process_cpp.pyx":195
+      /* "rapidfuzz/process_cpp_impl.pyx":230
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":193
+    /* "rapidfuzz/process_cpp_impl.pyx":228
  *     cdef Py_ssize_t i = 0
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:             # <<<<<<<<<<<<<<
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":198
+  /* "rapidfuzz/process_cpp_impl.pyx":233
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))             # <<<<<<<<<<<<<<
  *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, scorer_flags)
  * 
  */
-  __Pyx_TraceLine(198,0,__PYX_ERR(0, 198, __pyx_L1_error))
-  __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 198, __pyx_L1_error)
+  __Pyx_TraceLine(233,0,__PYX_ERR(0, 233, __pyx_L1_error))
+  __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 233, __pyx_L1_error)
   __pyx_v_proc_query = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
 
-  /* "rapidfuzz/process_cpp.pyx":199
+  /* "rapidfuzz/process_cpp_impl.pyx":234
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *     cdef RF_ScorerFunc scorer_func
  */
-  __Pyx_TraceLine(199,0,__PYX_ERR(0, 199, __pyx_L1_error))
-  __pyx_t_5 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_5 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 199, __pyx_L1_error)
+  __Pyx_TraceLine(234,0,__PYX_ERR(0, 234, __pyx_L1_error))
+  __pyx_t_5 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_5 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 234, __pyx_L1_error)
   __pyx_v_c_score_cutoff = __pyx_t_5;
 
-  /* "rapidfuzz/process_cpp.pyx":202
+  /* "rapidfuzz/process_cpp_impl.pyx":237
  * 
  *     cdef RF_ScorerFunc scorer_func
  *     dereference(scorer).scorer_func_init(&scorer_func, kwargs, 1, &proc_query.string)             # <<<<<<<<<<<<<<
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  * 
  */
-  __Pyx_TraceLine(202,0,__PYX_ERR(0, 202, __pyx_L1_error))
-  __pyx_t_6 = (*__pyx_v_scorer).scorer_func_init((&__pyx_v_scorer_func), __pyx_v_kwargs, 1, (&__pyx_v_proc_query.string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 202, __pyx_L1_error)
+  __Pyx_TraceLine(237,0,__PYX_ERR(0, 237, __pyx_L1_error))
+  __pyx_t_6 = (*__pyx_v_scorer).scorer_func_init((&__pyx_v_scorer_func), __pyx_v_kwargs, 1, (&__pyx_v_proc_query.string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 237, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":203
+  /* "rapidfuzz/process_cpp_impl.pyx":238
  *     cdef RF_ScorerFunc scorer_func
  *     dereference(scorer).scorer_func_init(&scorer_func, kwargs, 1, &proc_query.string)
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)             # <<<<<<<<<<<<<<
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[double](scorer_flags)
  */
-  __Pyx_TraceLine(203,0,__PYX_ERR(0, 203, __pyx_L1_error))
+  __Pyx_TraceLine(238,0,__PYX_ERR(0, 238, __pyx_L1_error))
   __pyx_v_ScorerFunc = RF_ScorerWrapper(__pyx_v_scorer_func);
 
-  /* "rapidfuzz/process_cpp.pyx":205
+  /* "rapidfuzz/process_cpp_impl.pyx":240
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[double](scorer_flags)             # <<<<<<<<<<<<<<
  *     cdef double optimal_score = get_optimal_score[double](scorer_flags)
  * 
  */
-  __Pyx_TraceLine(205,0,__PYX_ERR(0, 205, __pyx_L1_error))
+  __Pyx_TraceLine(240,0,__PYX_ERR(0, 240, __pyx_L1_error))
   __pyx_v_lowest_score_worst = is_lowest_score_worst<double>(__pyx_v_scorer_flags);
 
-  /* "rapidfuzz/process_cpp.pyx":206
+  /* "rapidfuzz/process_cpp_impl.pyx":241
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[double](scorer_flags)
  *     cdef double optimal_score = get_optimal_score[double](scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *     cdef bool result_found = False
  */
-  __Pyx_TraceLine(206,0,__PYX_ERR(0, 206, __pyx_L1_error))
+  __Pyx_TraceLine(241,0,__PYX_ERR(0, 241, __pyx_L1_error))
   __pyx_v_optimal_score = get_optimal_score<double>(__pyx_v_scorer_flags);
 
-  /* "rapidfuzz/process_cpp.pyx":208
+  /* "rapidfuzz/process_cpp_impl.pyx":243
  *     cdef double optimal_score = get_optimal_score[double](scorer_flags)
  * 
  *     cdef bool result_found = False             # <<<<<<<<<<<<<<
  *     cdef double result_score = 0
  *     result_key = None
  */
-  __Pyx_TraceLine(208,0,__PYX_ERR(0, 208, __pyx_L1_error))
+  __Pyx_TraceLine(243,0,__PYX_ERR(0, 243, __pyx_L1_error))
   __pyx_v_result_found = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":209
+  /* "rapidfuzz/process_cpp_impl.pyx":244
  * 
  *     cdef bool result_found = False
  *     cdef double result_score = 0             # <<<<<<<<<<<<<<
  *     result_key = None
  *     result_choice = None
  */
-  __Pyx_TraceLine(209,0,__PYX_ERR(0, 209, __pyx_L1_error))
+  __Pyx_TraceLine(244,0,__PYX_ERR(0, 244, __pyx_L1_error))
   __pyx_v_result_score = 0.0;
 
-  /* "rapidfuzz/process_cpp.pyx":210
+  /* "rapidfuzz/process_cpp_impl.pyx":245
  *     cdef bool result_found = False
  *     cdef double result_score = 0
  *     result_key = None             # <<<<<<<<<<<<<<
  *     result_choice = None
  * 
  */
-  __Pyx_TraceLine(210,0,__PYX_ERR(0, 210, __pyx_L1_error))
+  __Pyx_TraceLine(245,0,__PYX_ERR(0, 245, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_result_key = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":211
+  /* "rapidfuzz/process_cpp_impl.pyx":246
  *     cdef double result_score = 0
  *     result_key = None
  *     result_choice = None             # <<<<<<<<<<<<<<
  * 
  *     for choice_key, choice in choices.items():
  */
-  __Pyx_TraceLine(211,0,__PYX_ERR(0, 211, __pyx_L1_error))
+  __Pyx_TraceLine(246,0,__PYX_ERR(0, 246, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_result_choice = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":213
+  /* "rapidfuzz/process_cpp_impl.pyx":248
  *     result_choice = None
  * 
  *     for choice_key, choice in choices.items():             # <<<<<<<<<<<<<<
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  */
-  __Pyx_TraceLine(213,0,__PYX_ERR(0, 213, __pyx_L1_error))
+  __Pyx_TraceLine(248,0,__PYX_ERR(0, 248, __pyx_L1_error))
   __pyx_t_7 = 0;
   if (unlikely(__pyx_v_choices == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-    __PYX_ERR(0, 213, __pyx_L1_error)
+    __PYX_ERR(0, 248, __pyx_L1_error)
   }
-  __pyx_t_10 = __Pyx_dict_iterator(__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_8), (&__pyx_t_9)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 213, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_dict_iterator(__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_8), (&__pyx_t_9)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 248, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_XDECREF(__pyx_t_2);
   __pyx_t_2 = __pyx_t_10;
   __pyx_t_10 = 0;
   while (1) {
     __pyx_t_12 = __Pyx_dict_iter_next(__pyx_t_2, __pyx_t_8, &__pyx_t_7, &__pyx_t_10, &__pyx_t_11, NULL, __pyx_t_9);
     if (unlikely(__pyx_t_12 == 0)) break;
-    if (unlikely(__pyx_t_12 == -1)) __PYX_ERR(0, 213, __pyx_L1_error)
+    if (unlikely(__pyx_t_12 == -1)) __PYX_ERR(0, 248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_XDECREF_SET(__pyx_v_choice_key, __pyx_t_10);
     __pyx_t_10 = 0;
     __Pyx_XDECREF_SET(__pyx_v_choice, __pyx_t_11);
     __pyx_t_11 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":214
+    /* "rapidfuzz/process_cpp_impl.pyx":249
  * 
  *     for choice_key, choice in choices.items():
  *         if i % 1000 == 0:             # <<<<<<<<<<<<<<
  *             PyErr_CheckSignals()
  *         i += 1
  */
-    __Pyx_TraceLine(214,0,__PYX_ERR(0, 214, __pyx_L1_error))
+    __Pyx_TraceLine(249,0,__PYX_ERR(0, 249, __pyx_L1_error))
     __pyx_t_1 = (__Pyx_mod_Py_ssize_t(__pyx_v_i, 0x3E8) == 0);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":215
+      /* "rapidfuzz/process_cpp_impl.pyx":250
  *     for choice_key, choice in choices.items():
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()             # <<<<<<<<<<<<<<
  *         i += 1
  *         if choice is None:
  */
-      __Pyx_TraceLine(215,0,__PYX_ERR(0, 215, __pyx_L1_error))
-      __pyx_t_12 = PyErr_CheckSignals(); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 215, __pyx_L1_error)
+      __Pyx_TraceLine(250,0,__PYX_ERR(0, 250, __pyx_L1_error))
+      __pyx_t_12 = PyErr_CheckSignals(); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 250, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":214
+      /* "rapidfuzz/process_cpp_impl.pyx":249
  * 
  *     for choice_key, choice in choices.items():
  *         if i % 1000 == 0:             # <<<<<<<<<<<<<<
  *             PyErr_CheckSignals()
  *         i += 1
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":216
+    /* "rapidfuzz/process_cpp_impl.pyx":251
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  *         i += 1             # <<<<<<<<<<<<<<
  *         if choice is None:
  *             continue
  */
-    __Pyx_TraceLine(216,0,__PYX_ERR(0, 216, __pyx_L1_error))
+    __Pyx_TraceLine(251,0,__PYX_ERR(0, 251, __pyx_L1_error))
     __pyx_v_i = (__pyx_v_i + 1);
 
-    /* "rapidfuzz/process_cpp.pyx":217
+    /* "rapidfuzz/process_cpp_impl.pyx":252
  *             PyErr_CheckSignals()
  *         i += 1
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
-    __Pyx_TraceLine(217,0,__PYX_ERR(0, 217, __pyx_L1_error))
+    __Pyx_TraceLine(252,0,__PYX_ERR(0, 252, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_choice == Py_None);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":218
+      /* "rapidfuzz/process_cpp_impl.pyx":253
  *         i += 1
  *         if choice is None:
  *             continue             # <<<<<<<<<<<<<<
  * 
  *         if processor is None:
  */
-      __Pyx_TraceLine(218,0,__PYX_ERR(0, 218, __pyx_L1_error))
+      __Pyx_TraceLine(253,0,__PYX_ERR(0, 253, __pyx_L1_error))
       goto __pyx_L5_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":217
+      /* "rapidfuzz/process_cpp_impl.pyx":252
  *             PyErr_CheckSignals()
  *         i += 1
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":220
+    /* "rapidfuzz/process_cpp_impl.pyx":255
  *             continue
  * 
  *         if processor is None:             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  */
-    __Pyx_TraceLine(220,0,__PYX_ERR(0, 220, __pyx_L1_error))
+    __Pyx_TraceLine(255,0,__PYX_ERR(0, 255, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_processor == Py_None);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":221
+      /* "rapidfuzz/process_cpp_impl.pyx":256
  * 
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))             # <<<<<<<<<<<<<<
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)
  */
-      __Pyx_TraceLine(221,0,__PYX_ERR(0, 221, __pyx_L1_error))
-      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 221, __pyx_L1_error)
+      __Pyx_TraceLine(256,0,__PYX_ERR(0, 256, __pyx_L1_error))
+      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 256, __pyx_L1_error)
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
 
-      /* "rapidfuzz/process_cpp.pyx":220
+      /* "rapidfuzz/process_cpp_impl.pyx":255
  *             continue
  * 
  *         if processor is None:             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  */
       goto __pyx_L9;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":222
+    /* "rapidfuzz/process_cpp_impl.pyx":257
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))
  */
-    __Pyx_TraceLine(222,0,__PYX_ERR(0, 222, __pyx_L1_error))
+    __Pyx_TraceLine(257,0,__PYX_ERR(0, 257, __pyx_L1_error))
     __pyx_t_13 = (__pyx_v_processor_context != NULL);
     if (__pyx_t_13) {
     } else {
       __pyx_t_1 = __pyx_t_13;
       goto __pyx_L10_bool_binop_done;
     }
     __pyx_t_13 = (__pyx_v_processor_context->version == 1);
     __pyx_t_1 = __pyx_t_13;
     __pyx_L10_bool_binop_done:;
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":223
+      /* "rapidfuzz/process_cpp_impl.pyx":258
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(proc_str))
  *         else:
  */
-      __Pyx_TraceLine(223,0,__PYX_ERR(0, 223, __pyx_L1_error))
-      __pyx_t_6 = __pyx_v_processor_context->preprocess(__pyx_v_choice, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 223, __pyx_L1_error)
+      __Pyx_TraceLine(258,0,__PYX_ERR(0, 258, __pyx_L1_error))
+      __pyx_t_6 = __pyx_v_processor_context->preprocess(__pyx_v_choice, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 258, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":224
+      /* "rapidfuzz/process_cpp_impl.pyx":259
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))             # <<<<<<<<<<<<<<
  *         else:
  *             py_proc_choice = processor(choice)
  */
-      __Pyx_TraceLine(224,0,__PYX_ERR(0, 224, __pyx_L1_error))
+      __Pyx_TraceLine(259,0,__PYX_ERR(0, 259, __pyx_L1_error))
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_v_proc_str));
 
-      /* "rapidfuzz/process_cpp.pyx":222
+      /* "rapidfuzz/process_cpp_impl.pyx":257
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))
  */
       goto __pyx_L9;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":226
+    /* "rapidfuzz/process_cpp_impl.pyx":261
  *             proc_choice = move(RF_StringWrapper(proc_str))
  *         else:
  *             py_proc_choice = processor(choice)             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))
  * 
  */
-    __Pyx_TraceLine(226,0,__PYX_ERR(0, 226, __pyx_L1_error))
+    __Pyx_TraceLine(261,0,__PYX_ERR(0, 261, __pyx_L1_error))
     /*else*/ {
       __Pyx_INCREF(__pyx_v_processor);
       __pyx_t_10 = __pyx_v_processor; __pyx_t_14 = NULL;
       __pyx_t_12 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
         __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_10);
         if (likely(__pyx_t_14)) {
@@ -5296,68 +6220,68 @@
           __pyx_t_12 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_choice};
         __pyx_t_11 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_12, 1+__pyx_t_12);
         __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-        if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 226, __pyx_L1_error)
+        if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 261, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       }
       __Pyx_XDECREF_SET(__pyx_v_py_proc_choice, __pyx_t_11);
       __pyx_t_11 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":227
+      /* "rapidfuzz/process_cpp_impl.pyx":262
  *         else:
  *             py_proc_choice = processor(choice)
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))             # <<<<<<<<<<<<<<
  * 
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  */
-      __Pyx_TraceLine(227,0,__PYX_ERR(0, 227, __pyx_L1_error))
-      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_py_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 227, __pyx_L1_error)
+      __Pyx_TraceLine(262,0,__PYX_ERR(0, 262, __pyx_L1_error))
+      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_py_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 262, __pyx_L1_error)
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
     }
     __pyx_L9:;
 
-    /* "rapidfuzz/process_cpp.pyx":229
+    /* "rapidfuzz/process_cpp_impl.pyx":264
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))
  * 
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)             # <<<<<<<<<<<<<<
  * 
  *         if lowest_score_worst:
  */
-    __Pyx_TraceLine(229,0,__PYX_ERR(0, 229, __pyx_L1_error))
+    __Pyx_TraceLine(264,0,__PYX_ERR(0, 264, __pyx_L1_error))
     try {
       __pyx_v_ScorerFunc.call((&__pyx_v_proc_choice.string), __pyx_v_c_score_cutoff, (&__pyx_v_score));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 229, __pyx_L1_error)
+      __PYX_ERR(0, 264, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":231
+    /* "rapidfuzz/process_cpp_impl.pyx":266
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  */
-    __Pyx_TraceLine(231,0,__PYX_ERR(0, 231, __pyx_L1_error))
+    __Pyx_TraceLine(266,0,__PYX_ERR(0, 266, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":232
+      /* "rapidfuzz/process_cpp_impl.pyx":267
  * 
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
-      __Pyx_TraceLine(232,0,__PYX_ERR(0, 232, __pyx_L1_error))
+      __Pyx_TraceLine(267,0,__PYX_ERR(0, 267, __pyx_L1_error))
       __pyx_t_13 = (__pyx_v_score >= __pyx_v_c_score_cutoff);
       if (__pyx_t_13) {
       } else {
         __pyx_t_1 = __pyx_t_13;
         goto __pyx_L14_bool_binop_done;
       }
       __pyx_t_13 = (!(__pyx_v_result_found != 0));
@@ -5367,84 +6291,84 @@
         goto __pyx_L14_bool_binop_done;
       }
       __pyx_t_13 = (__pyx_v_score > __pyx_v_result_score);
       __pyx_t_1 = __pyx_t_13;
       __pyx_L14_bool_binop_done:;
       if (__pyx_t_1) {
 
-        /* "rapidfuzz/process_cpp.pyx":233
+        /* "rapidfuzz/process_cpp_impl.pyx":268
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_key = choice_key
  */
-        __Pyx_TraceLine(233,0,__PYX_ERR(0, 233, __pyx_L1_error))
+        __Pyx_TraceLine(268,0,__PYX_ERR(0, 268, __pyx_L1_error))
         __pyx_v_result_score = __pyx_v_score;
         __pyx_v_c_score_cutoff = __pyx_v_score;
 
-        /* "rapidfuzz/process_cpp.pyx":234
+        /* "rapidfuzz/process_cpp_impl.pyx":269
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_key = choice_key
  *                 result_found = True
  */
-        __Pyx_TraceLine(234,0,__PYX_ERR(0, 234, __pyx_L1_error))
+        __Pyx_TraceLine(269,0,__PYX_ERR(0, 269, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":235
+        /* "rapidfuzz/process_cpp_impl.pyx":270
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  *                 result_key = choice_key             # <<<<<<<<<<<<<<
  *                 result_found = True
  *         else:
  */
-        __Pyx_TraceLine(235,0,__PYX_ERR(0, 235, __pyx_L1_error))
+        __Pyx_TraceLine(270,0,__PYX_ERR(0, 270, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice_key);
         __Pyx_DECREF_SET(__pyx_v_result_key, __pyx_v_choice_key);
 
-        /* "rapidfuzz/process_cpp.pyx":236
+        /* "rapidfuzz/process_cpp_impl.pyx":271
  *                 result_choice = choice
  *                 result_key = choice_key
  *                 result_found = True             # <<<<<<<<<<<<<<
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  */
-        __Pyx_TraceLine(236,0,__PYX_ERR(0, 236, __pyx_L1_error))
+        __Pyx_TraceLine(271,0,__PYX_ERR(0, 271, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":232
+        /* "rapidfuzz/process_cpp_impl.pyx":267
  * 
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":231
+      /* "rapidfuzz/process_cpp_impl.pyx":266
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  */
       goto __pyx_L12;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":238
+    /* "rapidfuzz/process_cpp_impl.pyx":273
  *                 result_found = True
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
-    __Pyx_TraceLine(238,0,__PYX_ERR(0, 238, __pyx_L1_error))
+    __Pyx_TraceLine(273,0,__PYX_ERR(0, 273, __pyx_L1_error))
     /*else*/ {
       __pyx_t_13 = (__pyx_v_score <= __pyx_v_c_score_cutoff);
       if (__pyx_t_13) {
       } else {
         __pyx_t_1 = __pyx_t_13;
         goto __pyx_L18_bool_binop_done;
       }
@@ -5455,115 +6379,115 @@
         goto __pyx_L18_bool_binop_done;
       }
       __pyx_t_13 = (__pyx_v_score < __pyx_v_result_score);
       __pyx_t_1 = __pyx_t_13;
       __pyx_L18_bool_binop_done:;
       if (__pyx_t_1) {
 
-        /* "rapidfuzz/process_cpp.pyx":239
+        /* "rapidfuzz/process_cpp_impl.pyx":274
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  *                 result_score = c_score_cutoff = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_key = choice_key
  */
-        __Pyx_TraceLine(239,0,__PYX_ERR(0, 239, __pyx_L1_error))
+        __Pyx_TraceLine(274,0,__PYX_ERR(0, 274, __pyx_L1_error))
         __pyx_v_result_score = __pyx_v_score;
         __pyx_v_c_score_cutoff = __pyx_v_score;
 
-        /* "rapidfuzz/process_cpp.pyx":240
+        /* "rapidfuzz/process_cpp_impl.pyx":275
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_key = choice_key
  *                 result_found = True
  */
-        __Pyx_TraceLine(240,0,__PYX_ERR(0, 240, __pyx_L1_error))
+        __Pyx_TraceLine(275,0,__PYX_ERR(0, 275, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":241
+        /* "rapidfuzz/process_cpp_impl.pyx":276
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  *                 result_key = choice_key             # <<<<<<<<<<<<<<
  *                 result_found = True
  * 
  */
-        __Pyx_TraceLine(241,0,__PYX_ERR(0, 241, __pyx_L1_error))
+        __Pyx_TraceLine(276,0,__PYX_ERR(0, 276, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice_key);
         __Pyx_DECREF_SET(__pyx_v_result_key, __pyx_v_choice_key);
 
-        /* "rapidfuzz/process_cpp.pyx":242
+        /* "rapidfuzz/process_cpp_impl.pyx":277
  *                 result_choice = choice
  *                 result_key = choice_key
  *                 result_found = True             # <<<<<<<<<<<<<<
  * 
  *         if score == optimal_score:
  */
-        __Pyx_TraceLine(242,0,__PYX_ERR(0, 242, __pyx_L1_error))
+        __Pyx_TraceLine(277,0,__PYX_ERR(0, 277, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":238
+        /* "rapidfuzz/process_cpp_impl.pyx":273
  *                 result_found = True
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
       }
     }
     __pyx_L12:;
 
-    /* "rapidfuzz/process_cpp.pyx":244
+    /* "rapidfuzz/process_cpp_impl.pyx":279
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
-    __Pyx_TraceLine(244,0,__PYX_ERR(0, 244, __pyx_L1_error))
+    __Pyx_TraceLine(279,0,__PYX_ERR(0, 279, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_score == __pyx_v_optimal_score);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":245
+      /* "rapidfuzz/process_cpp_impl.pyx":280
  * 
  *         if score == optimal_score:
  *             break             # <<<<<<<<<<<<<<
  * 
  *     return (result_choice, result_score, result_key) if result_found else None
  */
-      __Pyx_TraceLine(245,0,__PYX_ERR(0, 245, __pyx_L1_error))
+      __Pyx_TraceLine(280,0,__PYX_ERR(0, 280, __pyx_L1_error))
       goto __pyx_L6_break;
 
-      /* "rapidfuzz/process_cpp.pyx":244
+      /* "rapidfuzz/process_cpp_impl.pyx":279
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
     }
     __pyx_L5_continue:;
   }
   __pyx_L6_break:;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":247
+  /* "rapidfuzz/process_cpp_impl.pyx":282
  *             break
  * 
  *     return (result_choice, result_score, result_key) if result_found else None             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(247,0,__PYX_ERR(0, 247, __pyx_L1_error))
+  __Pyx_TraceLine(282,0,__PYX_ERR(0, 282, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   if ((__pyx_v_result_found != 0)) {
-    __pyx_t_11 = PyFloat_FromDouble(__pyx_v_result_score); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 247, __pyx_L1_error)
+    __pyx_t_11 = PyFloat_FromDouble(__pyx_v_result_score); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 282, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 247, __pyx_L1_error)
+    __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 282, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_INCREF(__pyx_v_result_choice);
     __Pyx_GIVEREF(__pyx_v_result_choice);
     PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_result_choice);
     __Pyx_GIVEREF(__pyx_t_11);
     PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_11);
     __Pyx_INCREF(__pyx_v_result_key);
@@ -5576,52 +6500,52 @@
     __Pyx_INCREF(Py_None);
     __pyx_t_2 = Py_None;
   }
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":188
+  /* "rapidfuzz/process_cpp_impl.pyx":223
  *     return move(proc_queries)
  * 
  * cdef inline extractOne_dict_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef double score
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_10);
   __Pyx_XDECREF(__pyx_t_11);
   __Pyx_XDECREF(__pyx_t_14);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extractOne_dict_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extractOne_dict_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_processor_capsule);
   __Pyx_XDECREF(__pyx_v_result_key);
   __Pyx_XDECREF(__pyx_v_result_choice);
   __Pyx_XDECREF(__pyx_v_choice_key);
   __Pyx_XDECREF(__pyx_v_choice);
   __Pyx_XDECREF(__pyx_v_py_proc_choice);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":250
+/* "rapidfuzz/process_cpp_impl.pyx":285
  * 
  * 
  * cdef inline extractOne_dict_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef int64_t score
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_dict_i64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_dict_i64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   RF_String __pyx_v_proc_str;
   int64_t __pyx_v_score;
   Py_ssize_t __pyx_v_i;
   RF_Preprocessor *__pyx_v_processor_context;
   PyObject *__pyx_v_processor_capsule = NULL;
   RF_StringWrapper __pyx_v_proc_query;
   int64_t __pyx_v_c_score_cutoff;
@@ -5654,392 +6578,392 @@
   int __pyx_t_12;
   int __pyx_t_13;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extractOne_dict_i64", 0);
-  __Pyx_TraceCall("extractOne_dict_i64", __pyx_f[0], 250, 0, __PYX_ERR(0, 250, __pyx_L1_error));
+  __Pyx_TraceCall("extractOne_dict_i64", __pyx_f[0], 285, 0, __PYX_ERR(0, 285, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":253
+  /* "rapidfuzz/process_cpp_impl.pyx":288
  *     cdef RF_String proc_str
  *     cdef int64_t score
  *     cdef Py_ssize_t i = 0             # <<<<<<<<<<<<<<
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:
  */
-  __Pyx_TraceLine(253,0,__PYX_ERR(0, 253, __pyx_L1_error))
+  __Pyx_TraceLine(288,0,__PYX_ERR(0, 288, __pyx_L1_error))
   __pyx_v_i = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":254
+  /* "rapidfuzz/process_cpp_impl.pyx":289
  *     cdef int64_t score
  *     cdef Py_ssize_t i = 0
  *     cdef RF_Preprocessor* processor_context = NULL             # <<<<<<<<<<<<<<
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  */
-  __Pyx_TraceLine(254,0,__PYX_ERR(0, 254, __pyx_L1_error))
+  __Pyx_TraceLine(289,0,__PYX_ERR(0, 289, __pyx_L1_error))
   __pyx_v_processor_context = NULL;
 
-  /* "rapidfuzz/process_cpp.pyx":255
+  /* "rapidfuzz/process_cpp_impl.pyx":290
  *     cdef Py_ssize_t i = 0
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:             # <<<<<<<<<<<<<<
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  */
-  __Pyx_TraceLine(255,0,__PYX_ERR(0, 255, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 255, __pyx_L1_error)
+  __Pyx_TraceLine(290,0,__PYX_ERR(0, 290, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 290, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":256
+    /* "rapidfuzz/process_cpp_impl.pyx":291
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)             # <<<<<<<<<<<<<<
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  */
-    __Pyx_TraceLine(256,0,__PYX_ERR(0, 256, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 256, __pyx_L1_error)
+    __Pyx_TraceLine(291,0,__PYX_ERR(0, 291, __pyx_L1_error))
+    __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 291, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_v_processor_capsule = __pyx_t_2;
     __pyx_t_2 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":257
+    /* "rapidfuzz/process_cpp_impl.pyx":292
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
-    __Pyx_TraceLine(257,0,__PYX_ERR(0, 257, __pyx_L1_error))
+    __Pyx_TraceLine(292,0,__PYX_ERR(0, 292, __pyx_L1_error))
     __pyx_t_1 = PyCapsule_IsValid(__pyx_v_processor_capsule, NULL);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":258
+      /* "rapidfuzz/process_cpp_impl.pyx":293
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))
  */
-      __Pyx_TraceLine(258,0,__PYX_ERR(0, 258, __pyx_L1_error))
-      __pyx_t_3 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_3 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 258, __pyx_L1_error)
+      __Pyx_TraceLine(293,0,__PYX_ERR(0, 293, __pyx_L1_error))
+      __pyx_t_3 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_3 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 293, __pyx_L1_error)
       __pyx_v_processor_context = ((RF_Preprocessor *)__pyx_t_3);
 
-      /* "rapidfuzz/process_cpp.pyx":257
+      /* "rapidfuzz/process_cpp_impl.pyx":292
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":255
+    /* "rapidfuzz/process_cpp_impl.pyx":290
  *     cdef Py_ssize_t i = 0
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:             # <<<<<<<<<<<<<<
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":260
+  /* "rapidfuzz/process_cpp_impl.pyx":295
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))             # <<<<<<<<<<<<<<
  *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, scorer_flags)
  * 
  */
-  __Pyx_TraceLine(260,0,__PYX_ERR(0, 260, __pyx_L1_error))
-  __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 260, __pyx_L1_error)
+  __Pyx_TraceLine(295,0,__PYX_ERR(0, 295, __pyx_L1_error))
+  __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 295, __pyx_L1_error)
   __pyx_v_proc_query = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
 
-  /* "rapidfuzz/process_cpp.pyx":261
+  /* "rapidfuzz/process_cpp_impl.pyx":296
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *     cdef RF_ScorerFunc scorer_func
  */
-  __Pyx_TraceLine(261,0,__PYX_ERR(0, 261, __pyx_L1_error))
-  __pyx_t_5 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_5 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 261, __pyx_L1_error)
+  __Pyx_TraceLine(296,0,__PYX_ERR(0, 296, __pyx_L1_error))
+  __pyx_t_5 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_5 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 296, __pyx_L1_error)
   __pyx_v_c_score_cutoff = __pyx_t_5;
 
-  /* "rapidfuzz/process_cpp.pyx":264
+  /* "rapidfuzz/process_cpp_impl.pyx":299
  * 
  *     cdef RF_ScorerFunc scorer_func
  *     dereference(scorer).scorer_func_init(&scorer_func, kwargs, 1, &proc_query.string)             # <<<<<<<<<<<<<<
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  * 
  */
-  __Pyx_TraceLine(264,0,__PYX_ERR(0, 264, __pyx_L1_error))
-  __pyx_t_6 = (*__pyx_v_scorer).scorer_func_init((&__pyx_v_scorer_func), __pyx_v_kwargs, 1, (&__pyx_v_proc_query.string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 264, __pyx_L1_error)
+  __Pyx_TraceLine(299,0,__PYX_ERR(0, 299, __pyx_L1_error))
+  __pyx_t_6 = (*__pyx_v_scorer).scorer_func_init((&__pyx_v_scorer_func), __pyx_v_kwargs, 1, (&__pyx_v_proc_query.string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 299, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":265
+  /* "rapidfuzz/process_cpp_impl.pyx":300
  *     cdef RF_ScorerFunc scorer_func
  *     dereference(scorer).scorer_func_init(&scorer_func, kwargs, 1, &proc_query.string)
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)             # <<<<<<<<<<<<<<
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[int64_t](scorer_flags)
  */
-  __Pyx_TraceLine(265,0,__PYX_ERR(0, 265, __pyx_L1_error))
+  __Pyx_TraceLine(300,0,__PYX_ERR(0, 300, __pyx_L1_error))
   __pyx_v_ScorerFunc = RF_ScorerWrapper(__pyx_v_scorer_func);
 
-  /* "rapidfuzz/process_cpp.pyx":267
+  /* "rapidfuzz/process_cpp_impl.pyx":302
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[int64_t](scorer_flags)             # <<<<<<<<<<<<<<
  *     cdef int64_t optimal_score = get_optimal_score[int64_t](scorer_flags)
  * 
  */
-  __Pyx_TraceLine(267,0,__PYX_ERR(0, 267, __pyx_L1_error))
+  __Pyx_TraceLine(302,0,__PYX_ERR(0, 302, __pyx_L1_error))
   __pyx_v_lowest_score_worst = is_lowest_score_worst<int64_t>(__pyx_v_scorer_flags);
 
-  /* "rapidfuzz/process_cpp.pyx":268
+  /* "rapidfuzz/process_cpp_impl.pyx":303
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[int64_t](scorer_flags)
  *     cdef int64_t optimal_score = get_optimal_score[int64_t](scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *     cdef bool result_found = False
  */
-  __Pyx_TraceLine(268,0,__PYX_ERR(0, 268, __pyx_L1_error))
+  __Pyx_TraceLine(303,0,__PYX_ERR(0, 303, __pyx_L1_error))
   __pyx_v_optimal_score = get_optimal_score<int64_t>(__pyx_v_scorer_flags);
 
-  /* "rapidfuzz/process_cpp.pyx":270
+  /* "rapidfuzz/process_cpp_impl.pyx":305
  *     cdef int64_t optimal_score = get_optimal_score[int64_t](scorer_flags)
  * 
  *     cdef bool result_found = False             # <<<<<<<<<<<<<<
  *     cdef int64_t result_score = 0
  *     result_key = None
  */
-  __Pyx_TraceLine(270,0,__PYX_ERR(0, 270, __pyx_L1_error))
+  __Pyx_TraceLine(305,0,__PYX_ERR(0, 305, __pyx_L1_error))
   __pyx_v_result_found = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":271
+  /* "rapidfuzz/process_cpp_impl.pyx":306
  * 
  *     cdef bool result_found = False
  *     cdef int64_t result_score = 0             # <<<<<<<<<<<<<<
  *     result_key = None
  *     result_choice = None
  */
-  __Pyx_TraceLine(271,0,__PYX_ERR(0, 271, __pyx_L1_error))
+  __Pyx_TraceLine(306,0,__PYX_ERR(0, 306, __pyx_L1_error))
   __pyx_v_result_score = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":272
+  /* "rapidfuzz/process_cpp_impl.pyx":307
  *     cdef bool result_found = False
  *     cdef int64_t result_score = 0
  *     result_key = None             # <<<<<<<<<<<<<<
  *     result_choice = None
  * 
  */
-  __Pyx_TraceLine(272,0,__PYX_ERR(0, 272, __pyx_L1_error))
+  __Pyx_TraceLine(307,0,__PYX_ERR(0, 307, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_result_key = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":273
+  /* "rapidfuzz/process_cpp_impl.pyx":308
  *     cdef int64_t result_score = 0
  *     result_key = None
  *     result_choice = None             # <<<<<<<<<<<<<<
  * 
  *     for choice_key, choice in choices.items():
  */
-  __Pyx_TraceLine(273,0,__PYX_ERR(0, 273, __pyx_L1_error))
+  __Pyx_TraceLine(308,0,__PYX_ERR(0, 308, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_result_choice = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":275
+  /* "rapidfuzz/process_cpp_impl.pyx":310
  *     result_choice = None
  * 
  *     for choice_key, choice in choices.items():             # <<<<<<<<<<<<<<
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  */
-  __Pyx_TraceLine(275,0,__PYX_ERR(0, 275, __pyx_L1_error))
+  __Pyx_TraceLine(310,0,__PYX_ERR(0, 310, __pyx_L1_error))
   __pyx_t_7 = 0;
   if (unlikely(__pyx_v_choices == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-    __PYX_ERR(0, 275, __pyx_L1_error)
+    __PYX_ERR(0, 310, __pyx_L1_error)
   }
-  __pyx_t_10 = __Pyx_dict_iterator(__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_8), (&__pyx_t_9)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 275, __pyx_L1_error)
+  __pyx_t_10 = __Pyx_dict_iterator(__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_8), (&__pyx_t_9)); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 310, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_10);
   __Pyx_XDECREF(__pyx_t_2);
   __pyx_t_2 = __pyx_t_10;
   __pyx_t_10 = 0;
   while (1) {
     __pyx_t_12 = __Pyx_dict_iter_next(__pyx_t_2, __pyx_t_8, &__pyx_t_7, &__pyx_t_10, &__pyx_t_11, NULL, __pyx_t_9);
     if (unlikely(__pyx_t_12 == 0)) break;
-    if (unlikely(__pyx_t_12 == -1)) __PYX_ERR(0, 275, __pyx_L1_error)
+    if (unlikely(__pyx_t_12 == -1)) __PYX_ERR(0, 310, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_XDECREF_SET(__pyx_v_choice_key, __pyx_t_10);
     __pyx_t_10 = 0;
     __Pyx_XDECREF_SET(__pyx_v_choice, __pyx_t_11);
     __pyx_t_11 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":276
+    /* "rapidfuzz/process_cpp_impl.pyx":311
  * 
  *     for choice_key, choice in choices.items():
  *         if i % 1000 == 0:             # <<<<<<<<<<<<<<
  *             PyErr_CheckSignals()
  *         i += 1
  */
-    __Pyx_TraceLine(276,0,__PYX_ERR(0, 276, __pyx_L1_error))
+    __Pyx_TraceLine(311,0,__PYX_ERR(0, 311, __pyx_L1_error))
     __pyx_t_1 = (__Pyx_mod_Py_ssize_t(__pyx_v_i, 0x3E8) == 0);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":277
+      /* "rapidfuzz/process_cpp_impl.pyx":312
  *     for choice_key, choice in choices.items():
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()             # <<<<<<<<<<<<<<
  *         i += 1
  *         if choice is None:
  */
-      __Pyx_TraceLine(277,0,__PYX_ERR(0, 277, __pyx_L1_error))
-      __pyx_t_12 = PyErr_CheckSignals(); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 277, __pyx_L1_error)
+      __Pyx_TraceLine(312,0,__PYX_ERR(0, 312, __pyx_L1_error))
+      __pyx_t_12 = PyErr_CheckSignals(); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 312, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":276
+      /* "rapidfuzz/process_cpp_impl.pyx":311
  * 
  *     for choice_key, choice in choices.items():
  *         if i % 1000 == 0:             # <<<<<<<<<<<<<<
  *             PyErr_CheckSignals()
  *         i += 1
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":278
+    /* "rapidfuzz/process_cpp_impl.pyx":313
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  *         i += 1             # <<<<<<<<<<<<<<
  *         if choice is None:
  *             continue
  */
-    __Pyx_TraceLine(278,0,__PYX_ERR(0, 278, __pyx_L1_error))
+    __Pyx_TraceLine(313,0,__PYX_ERR(0, 313, __pyx_L1_error))
     __pyx_v_i = (__pyx_v_i + 1);
 
-    /* "rapidfuzz/process_cpp.pyx":279
+    /* "rapidfuzz/process_cpp_impl.pyx":314
  *             PyErr_CheckSignals()
  *         i += 1
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
-    __Pyx_TraceLine(279,0,__PYX_ERR(0, 279, __pyx_L1_error))
+    __Pyx_TraceLine(314,0,__PYX_ERR(0, 314, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_choice == Py_None);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":280
+      /* "rapidfuzz/process_cpp_impl.pyx":315
  *         i += 1
  *         if choice is None:
  *             continue             # <<<<<<<<<<<<<<
  * 
  *         if processor is None:
  */
-      __Pyx_TraceLine(280,0,__PYX_ERR(0, 280, __pyx_L1_error))
+      __Pyx_TraceLine(315,0,__PYX_ERR(0, 315, __pyx_L1_error))
       goto __pyx_L5_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":279
+      /* "rapidfuzz/process_cpp_impl.pyx":314
  *             PyErr_CheckSignals()
  *         i += 1
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":282
+    /* "rapidfuzz/process_cpp_impl.pyx":317
  *             continue
  * 
  *         if processor is None:             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  */
-    __Pyx_TraceLine(282,0,__PYX_ERR(0, 282, __pyx_L1_error))
+    __Pyx_TraceLine(317,0,__PYX_ERR(0, 317, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_processor == Py_None);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":283
+      /* "rapidfuzz/process_cpp_impl.pyx":318
  * 
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))             # <<<<<<<<<<<<<<
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)
  */
-      __Pyx_TraceLine(283,0,__PYX_ERR(0, 283, __pyx_L1_error))
-      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 283, __pyx_L1_error)
+      __Pyx_TraceLine(318,0,__PYX_ERR(0, 318, __pyx_L1_error))
+      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 318, __pyx_L1_error)
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
 
-      /* "rapidfuzz/process_cpp.pyx":282
+      /* "rapidfuzz/process_cpp_impl.pyx":317
  *             continue
  * 
  *         if processor is None:             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  */
       goto __pyx_L9;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":284
+    /* "rapidfuzz/process_cpp_impl.pyx":319
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))
  */
-    __Pyx_TraceLine(284,0,__PYX_ERR(0, 284, __pyx_L1_error))
+    __Pyx_TraceLine(319,0,__PYX_ERR(0, 319, __pyx_L1_error))
     __pyx_t_13 = (__pyx_v_processor_context != NULL);
     if (__pyx_t_13) {
     } else {
       __pyx_t_1 = __pyx_t_13;
       goto __pyx_L10_bool_binop_done;
     }
     __pyx_t_13 = (__pyx_v_processor_context->version == 1);
     __pyx_t_1 = __pyx_t_13;
     __pyx_L10_bool_binop_done:;
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":285
+      /* "rapidfuzz/process_cpp_impl.pyx":320
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(proc_str))
  *         else:
  */
-      __Pyx_TraceLine(285,0,__PYX_ERR(0, 285, __pyx_L1_error))
-      __pyx_t_6 = __pyx_v_processor_context->preprocess(__pyx_v_choice, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 285, __pyx_L1_error)
+      __Pyx_TraceLine(320,0,__PYX_ERR(0, 320, __pyx_L1_error))
+      __pyx_t_6 = __pyx_v_processor_context->preprocess(__pyx_v_choice, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 320, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":286
+      /* "rapidfuzz/process_cpp_impl.pyx":321
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))             # <<<<<<<<<<<<<<
  *         else:
  *             py_proc_choice = processor(choice)
  */
-      __Pyx_TraceLine(286,0,__PYX_ERR(0, 286, __pyx_L1_error))
+      __Pyx_TraceLine(321,0,__PYX_ERR(0, 321, __pyx_L1_error))
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_v_proc_str));
 
-      /* "rapidfuzz/process_cpp.pyx":284
+      /* "rapidfuzz/process_cpp_impl.pyx":319
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))
  */
       goto __pyx_L9;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":288
+    /* "rapidfuzz/process_cpp_impl.pyx":323
  *             proc_choice = move(RF_StringWrapper(proc_str))
  *         else:
  *             py_proc_choice = processor(choice)             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))
  * 
  */
-    __Pyx_TraceLine(288,0,__PYX_ERR(0, 288, __pyx_L1_error))
+    __Pyx_TraceLine(323,0,__PYX_ERR(0, 323, __pyx_L1_error))
     /*else*/ {
       __Pyx_INCREF(__pyx_v_processor);
       __pyx_t_10 = __pyx_v_processor; __pyx_t_14 = NULL;
       __pyx_t_12 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
         __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_10);
         if (likely(__pyx_t_14)) {
@@ -6050,68 +6974,68 @@
           __pyx_t_12 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_choice};
         __pyx_t_11 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_12, 1+__pyx_t_12);
         __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-        if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 288, __pyx_L1_error)
+        if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 323, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       }
       __Pyx_XDECREF_SET(__pyx_v_py_proc_choice, __pyx_t_11);
       __pyx_t_11 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":289
+      /* "rapidfuzz/process_cpp_impl.pyx":324
  *         else:
  *             py_proc_choice = processor(choice)
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))             # <<<<<<<<<<<<<<
  * 
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  */
-      __Pyx_TraceLine(289,0,__PYX_ERR(0, 289, __pyx_L1_error))
-      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_py_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 289, __pyx_L1_error)
+      __Pyx_TraceLine(324,0,__PYX_ERR(0, 324, __pyx_L1_error))
+      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_py_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 324, __pyx_L1_error)
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
     }
     __pyx_L9:;
 
-    /* "rapidfuzz/process_cpp.pyx":291
+    /* "rapidfuzz/process_cpp_impl.pyx":326
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))
  * 
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)             # <<<<<<<<<<<<<<
  * 
  *         if lowest_score_worst:
  */
-    __Pyx_TraceLine(291,0,__PYX_ERR(0, 291, __pyx_L1_error))
+    __Pyx_TraceLine(326,0,__PYX_ERR(0, 326, __pyx_L1_error))
     try {
       __pyx_v_ScorerFunc.call((&__pyx_v_proc_choice.string), __pyx_v_c_score_cutoff, (&__pyx_v_score));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 291, __pyx_L1_error)
+      __PYX_ERR(0, 326, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":293
+    /* "rapidfuzz/process_cpp_impl.pyx":328
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  */
-    __Pyx_TraceLine(293,0,__PYX_ERR(0, 293, __pyx_L1_error))
+    __Pyx_TraceLine(328,0,__PYX_ERR(0, 328, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":294
+      /* "rapidfuzz/process_cpp_impl.pyx":329
  * 
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
-      __Pyx_TraceLine(294,0,__PYX_ERR(0, 294, __pyx_L1_error))
+      __Pyx_TraceLine(329,0,__PYX_ERR(0, 329, __pyx_L1_error))
       __pyx_t_13 = (__pyx_v_score >= __pyx_v_c_score_cutoff);
       if (__pyx_t_13) {
       } else {
         __pyx_t_1 = __pyx_t_13;
         goto __pyx_L14_bool_binop_done;
       }
       __pyx_t_13 = (!(__pyx_v_result_found != 0));
@@ -6121,84 +7045,84 @@
         goto __pyx_L14_bool_binop_done;
       }
       __pyx_t_13 = (__pyx_v_score > __pyx_v_result_score);
       __pyx_t_1 = __pyx_t_13;
       __pyx_L14_bool_binop_done:;
       if (__pyx_t_1) {
 
-        /* "rapidfuzz/process_cpp.pyx":295
+        /* "rapidfuzz/process_cpp_impl.pyx":330
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_key = choice_key
  */
-        __Pyx_TraceLine(295,0,__PYX_ERR(0, 295, __pyx_L1_error))
+        __Pyx_TraceLine(330,0,__PYX_ERR(0, 330, __pyx_L1_error))
         __pyx_v_result_score = __pyx_v_score;
         __pyx_v_c_score_cutoff = __pyx_v_score;
 
-        /* "rapidfuzz/process_cpp.pyx":296
+        /* "rapidfuzz/process_cpp_impl.pyx":331
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_key = choice_key
  *                 result_found = True
  */
-        __Pyx_TraceLine(296,0,__PYX_ERR(0, 296, __pyx_L1_error))
+        __Pyx_TraceLine(331,0,__PYX_ERR(0, 331, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":297
+        /* "rapidfuzz/process_cpp_impl.pyx":332
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  *                 result_key = choice_key             # <<<<<<<<<<<<<<
  *                 result_found = True
  *         else:
  */
-        __Pyx_TraceLine(297,0,__PYX_ERR(0, 297, __pyx_L1_error))
+        __Pyx_TraceLine(332,0,__PYX_ERR(0, 332, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice_key);
         __Pyx_DECREF_SET(__pyx_v_result_key, __pyx_v_choice_key);
 
-        /* "rapidfuzz/process_cpp.pyx":298
+        /* "rapidfuzz/process_cpp_impl.pyx":333
  *                 result_choice = choice
  *                 result_key = choice_key
  *                 result_found = True             # <<<<<<<<<<<<<<
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  */
-        __Pyx_TraceLine(298,0,__PYX_ERR(0, 298, __pyx_L1_error))
+        __Pyx_TraceLine(333,0,__PYX_ERR(0, 333, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":294
+        /* "rapidfuzz/process_cpp_impl.pyx":329
  * 
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":293
+      /* "rapidfuzz/process_cpp_impl.pyx":328
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  */
       goto __pyx_L12;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":300
+    /* "rapidfuzz/process_cpp_impl.pyx":335
  *                 result_found = True
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
-    __Pyx_TraceLine(300,0,__PYX_ERR(0, 300, __pyx_L1_error))
+    __Pyx_TraceLine(335,0,__PYX_ERR(0, 335, __pyx_L1_error))
     /*else*/ {
       __pyx_t_13 = (__pyx_v_score <= __pyx_v_c_score_cutoff);
       if (__pyx_t_13) {
       } else {
         __pyx_t_1 = __pyx_t_13;
         goto __pyx_L18_bool_binop_done;
       }
@@ -6209,115 +7133,115 @@
         goto __pyx_L18_bool_binop_done;
       }
       __pyx_t_13 = (__pyx_v_score < __pyx_v_result_score);
       __pyx_t_1 = __pyx_t_13;
       __pyx_L18_bool_binop_done:;
       if (__pyx_t_1) {
 
-        /* "rapidfuzz/process_cpp.pyx":301
+        /* "rapidfuzz/process_cpp_impl.pyx":336
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  *                 result_score = c_score_cutoff = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_key = choice_key
  */
-        __Pyx_TraceLine(301,0,__PYX_ERR(0, 301, __pyx_L1_error))
+        __Pyx_TraceLine(336,0,__PYX_ERR(0, 336, __pyx_L1_error))
         __pyx_v_result_score = __pyx_v_score;
         __pyx_v_c_score_cutoff = __pyx_v_score;
 
-        /* "rapidfuzz/process_cpp.pyx":302
+        /* "rapidfuzz/process_cpp_impl.pyx":337
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_key = choice_key
  *                 result_found = True
  */
-        __Pyx_TraceLine(302,0,__PYX_ERR(0, 302, __pyx_L1_error))
+        __Pyx_TraceLine(337,0,__PYX_ERR(0, 337, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":303
+        /* "rapidfuzz/process_cpp_impl.pyx":338
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  *                 result_key = choice_key             # <<<<<<<<<<<<<<
  *                 result_found = True
  * 
  */
-        __Pyx_TraceLine(303,0,__PYX_ERR(0, 303, __pyx_L1_error))
+        __Pyx_TraceLine(338,0,__PYX_ERR(0, 338, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice_key);
         __Pyx_DECREF_SET(__pyx_v_result_key, __pyx_v_choice_key);
 
-        /* "rapidfuzz/process_cpp.pyx":304
+        /* "rapidfuzz/process_cpp_impl.pyx":339
  *                 result_choice = choice
  *                 result_key = choice_key
  *                 result_found = True             # <<<<<<<<<<<<<<
  * 
  *         if score == optimal_score:
  */
-        __Pyx_TraceLine(304,0,__PYX_ERR(0, 304, __pyx_L1_error))
+        __Pyx_TraceLine(339,0,__PYX_ERR(0, 339, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":300
+        /* "rapidfuzz/process_cpp_impl.pyx":335
  *                 result_found = True
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
       }
     }
     __pyx_L12:;
 
-    /* "rapidfuzz/process_cpp.pyx":306
+    /* "rapidfuzz/process_cpp_impl.pyx":341
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
-    __Pyx_TraceLine(306,0,__PYX_ERR(0, 306, __pyx_L1_error))
+    __Pyx_TraceLine(341,0,__PYX_ERR(0, 341, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_score == __pyx_v_optimal_score);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":307
+      /* "rapidfuzz/process_cpp_impl.pyx":342
  * 
  *         if score == optimal_score:
  *             break             # <<<<<<<<<<<<<<
  * 
  *     return (result_choice, result_score, result_key) if result_found else None
  */
-      __Pyx_TraceLine(307,0,__PYX_ERR(0, 307, __pyx_L1_error))
+      __Pyx_TraceLine(342,0,__PYX_ERR(0, 342, __pyx_L1_error))
       goto __pyx_L6_break;
 
-      /* "rapidfuzz/process_cpp.pyx":306
+      /* "rapidfuzz/process_cpp_impl.pyx":341
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
     }
     __pyx_L5_continue:;
   }
   __pyx_L6_break:;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":309
+  /* "rapidfuzz/process_cpp_impl.pyx":344
  *             break
  * 
  *     return (result_choice, result_score, result_key) if result_found else None             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(309,0,__PYX_ERR(0, 309, __pyx_L1_error))
+  __Pyx_TraceLine(344,0,__PYX_ERR(0, 344, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   if ((__pyx_v_result_found != 0)) {
-    __pyx_t_11 = __Pyx_PyInt_From_int64_t(__pyx_v_result_score); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 309, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_From_int64_t(__pyx_v_result_score); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 344, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 309, __pyx_L1_error)
+    __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 344, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_INCREF(__pyx_v_result_choice);
     __Pyx_GIVEREF(__pyx_v_result_choice);
     PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_result_choice);
     __Pyx_GIVEREF(__pyx_t_11);
     PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_11);
     __Pyx_INCREF(__pyx_v_result_key);
@@ -6330,207 +7254,207 @@
     __Pyx_INCREF(Py_None);
     __pyx_t_2 = Py_None;
   }
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":250
+  /* "rapidfuzz/process_cpp_impl.pyx":285
  * 
  * 
  * cdef inline extractOne_dict_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef int64_t score
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_10);
   __Pyx_XDECREF(__pyx_t_11);
   __Pyx_XDECREF(__pyx_t_14);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extractOne_dict_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extractOne_dict_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_processor_capsule);
   __Pyx_XDECREF(__pyx_v_result_key);
   __Pyx_XDECREF(__pyx_v_result_choice);
   __Pyx_XDECREF(__pyx_v_choice_key);
   __Pyx_XDECREF(__pyx_v_choice);
   __Pyx_XDECREF(__pyx_v_py_proc_choice);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":312
+/* "rapidfuzz/process_cpp_impl.pyx":347
  * 
  * 
  * cdef inline extractOne_dict(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_dict(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_dict(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   uint32_t __pyx_v_flags;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   uint32_t __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extractOne_dict", 0);
-  __Pyx_TraceCall("extractOne_dict", __pyx_f[0], 312, 0, __PYX_ERR(0, 312, __pyx_L1_error));
+  __Pyx_TraceCall("extractOne_dict", __pyx_f[0], 347, 0, __PYX_ERR(0, 347, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":313
+  /* "rapidfuzz/process_cpp_impl.pyx":348
  * 
  * cdef inline extractOne_dict(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):
  *     flags = dereference(scorer_flags).flags             # <<<<<<<<<<<<<<
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  */
-  __Pyx_TraceLine(313,0,__PYX_ERR(0, 313, __pyx_L1_error))
+  __Pyx_TraceLine(348,0,__PYX_ERR(0, 348, __pyx_L1_error))
   __pyx_t_1 = (*__pyx_v_scorer_flags).flags;
   __pyx_v_flags = __pyx_t_1;
 
-  /* "rapidfuzz/process_cpp.pyx":315
+  /* "rapidfuzz/process_cpp_impl.pyx":350
  *     flags = dereference(scorer_flags).flags
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *         return extractOne_dict_f64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  */
-  __Pyx_TraceLine(315,0,__PYX_ERR(0, 315, __pyx_L1_error))
+  __Pyx_TraceLine(350,0,__PYX_ERR(0, 350, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_F64) != 0);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":316
+    /* "rapidfuzz/process_cpp_impl.pyx":351
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  *         return extractOne_dict_f64(             # <<<<<<<<<<<<<<
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  *         )
  */
-    __Pyx_TraceLine(316,0,__PYX_ERR(0, 316, __pyx_L1_error))
+    __Pyx_TraceLine(351,0,__PYX_ERR(0, 351, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
 
-    /* "rapidfuzz/process_cpp.pyx":317
+    /* "rapidfuzz/process_cpp_impl.pyx":352
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  *         return extractOne_dict_f64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs             # <<<<<<<<<<<<<<
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  */
-    __Pyx_TraceLine(317,0,__PYX_ERR(0, 317, __pyx_L1_error))
-    __pyx_t_3 = __pyx_f_9rapidfuzz_11process_cpp_extractOne_dict_f64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 316, __pyx_L1_error)
+    __Pyx_TraceLine(352,0,__PYX_ERR(0, 352, __pyx_L1_error))
+    __pyx_t_3 = __pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_dict_f64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 351, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":315
+    /* "rapidfuzz/process_cpp_impl.pyx":350
  *     flags = dereference(scorer_flags).flags
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *         return extractOne_dict_f64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":319
+  /* "rapidfuzz/process_cpp_impl.pyx":354
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *         return extractOne_dict_i64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  */
-  __Pyx_TraceLine(319,0,__PYX_ERR(0, 319, __pyx_L1_error))
+  __Pyx_TraceLine(354,0,__PYX_ERR(0, 354, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_I64) != 0);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":320
+    /* "rapidfuzz/process_cpp_impl.pyx":355
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  *         return extractOne_dict_i64(             # <<<<<<<<<<<<<<
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  *         )
  */
-    __Pyx_TraceLine(320,0,__PYX_ERR(0, 320, __pyx_L1_error))
+    __Pyx_TraceLine(355,0,__PYX_ERR(0, 355, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
 
-    /* "rapidfuzz/process_cpp.pyx":321
+    /* "rapidfuzz/process_cpp_impl.pyx":356
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  *         return extractOne_dict_i64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs             # <<<<<<<<<<<<<<
  *         )
  * 
  */
-    __Pyx_TraceLine(321,0,__PYX_ERR(0, 321, __pyx_L1_error))
-    __pyx_t_3 = __pyx_f_9rapidfuzz_11process_cpp_extractOne_dict_i64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 320, __pyx_L1_error)
+    __Pyx_TraceLine(356,0,__PYX_ERR(0, 356, __pyx_L1_error))
+    __pyx_t_3 = __pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_dict_i64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 355, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":319
+    /* "rapidfuzz/process_cpp_impl.pyx":354
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *         return extractOne_dict_i64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":324
+  /* "rapidfuzz/process_cpp_impl.pyx":359
  *         )
  * 
  *     raise ValueError("scorer does not properly use the C-API")             # <<<<<<<<<<<<<<
  * 
  * cdef inline extractOne_list_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):
  */
-  __Pyx_TraceLine(324,0,__PYX_ERR(0, 324, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 324, __pyx_L1_error)
+  __Pyx_TraceLine(359,0,__PYX_ERR(0, 359, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 359, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_Raise(__pyx_t_3, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __PYX_ERR(0, 324, __pyx_L1_error)
+  __PYX_ERR(0, 359, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":312
+  /* "rapidfuzz/process_cpp_impl.pyx":347
  * 
  * 
  * cdef inline extractOne_dict(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extractOne_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extractOne_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":326
+/* "rapidfuzz/process_cpp_impl.pyx":361
  *     raise ValueError("scorer does not properly use the C-API")
  * 
  * cdef inline extractOne_list_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef double score
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_list_f64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_list_f64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   RF_String __pyx_v_proc_str;
   double __pyx_v_score;
   Py_ssize_t __pyx_v_i;
   RF_Preprocessor *__pyx_v_processor_context;
   PyObject *__pyx_v_processor_capsule = NULL;
   RF_StringWrapper __pyx_v_proc_query;
   double __pyx_v_c_score_cutoff;
@@ -6562,395 +7486,395 @@
   int __pyx_t_12;
   PyObject *__pyx_t_13 = NULL;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extractOne_list_f64", 0);
-  __Pyx_TraceCall("extractOne_list_f64", __pyx_f[0], 326, 0, __PYX_ERR(0, 326, __pyx_L1_error));
+  __Pyx_TraceCall("extractOne_list_f64", __pyx_f[0], 361, 0, __PYX_ERR(0, 361, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":330
+  /* "rapidfuzz/process_cpp_impl.pyx":365
  *     cdef double score
  *     cdef Py_ssize_t i
  *     cdef RF_Preprocessor* processor_context = NULL             # <<<<<<<<<<<<<<
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  */
-  __Pyx_TraceLine(330,0,__PYX_ERR(0, 330, __pyx_L1_error))
+  __Pyx_TraceLine(365,0,__PYX_ERR(0, 365, __pyx_L1_error))
   __pyx_v_processor_context = NULL;
 
-  /* "rapidfuzz/process_cpp.pyx":331
+  /* "rapidfuzz/process_cpp_impl.pyx":366
  *     cdef Py_ssize_t i
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:             # <<<<<<<<<<<<<<
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  */
-  __Pyx_TraceLine(331,0,__PYX_ERR(0, 331, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 331, __pyx_L1_error)
+  __Pyx_TraceLine(366,0,__PYX_ERR(0, 366, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 366, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":332
+    /* "rapidfuzz/process_cpp_impl.pyx":367
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)             # <<<<<<<<<<<<<<
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  */
-    __Pyx_TraceLine(332,0,__PYX_ERR(0, 332, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 332, __pyx_L1_error)
+    __Pyx_TraceLine(367,0,__PYX_ERR(0, 367, __pyx_L1_error))
+    __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 367, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_v_processor_capsule = __pyx_t_2;
     __pyx_t_2 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":333
+    /* "rapidfuzz/process_cpp_impl.pyx":368
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
-    __Pyx_TraceLine(333,0,__PYX_ERR(0, 333, __pyx_L1_error))
+    __Pyx_TraceLine(368,0,__PYX_ERR(0, 368, __pyx_L1_error))
     __pyx_t_1 = PyCapsule_IsValid(__pyx_v_processor_capsule, NULL);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":334
+      /* "rapidfuzz/process_cpp_impl.pyx":369
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))
  */
-      __Pyx_TraceLine(334,0,__PYX_ERR(0, 334, __pyx_L1_error))
-      __pyx_t_3 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_3 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 334, __pyx_L1_error)
+      __Pyx_TraceLine(369,0,__PYX_ERR(0, 369, __pyx_L1_error))
+      __pyx_t_3 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_3 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 369, __pyx_L1_error)
       __pyx_v_processor_context = ((RF_Preprocessor *)__pyx_t_3);
 
-      /* "rapidfuzz/process_cpp.pyx":333
+      /* "rapidfuzz/process_cpp_impl.pyx":368
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":331
+    /* "rapidfuzz/process_cpp_impl.pyx":366
  *     cdef Py_ssize_t i
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:             # <<<<<<<<<<<<<<
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":336
+  /* "rapidfuzz/process_cpp_impl.pyx":371
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))             # <<<<<<<<<<<<<<
  *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, scorer_flags)
  * 
  */
-  __Pyx_TraceLine(336,0,__PYX_ERR(0, 336, __pyx_L1_error))
-  __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 336, __pyx_L1_error)
+  __Pyx_TraceLine(371,0,__PYX_ERR(0, 371, __pyx_L1_error))
+  __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 371, __pyx_L1_error)
   __pyx_v_proc_query = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
 
-  /* "rapidfuzz/process_cpp.pyx":337
+  /* "rapidfuzz/process_cpp_impl.pyx":372
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *     cdef RF_ScorerFunc scorer_func
  */
-  __Pyx_TraceLine(337,0,__PYX_ERR(0, 337, __pyx_L1_error))
-  __pyx_t_5 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_5 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 337, __pyx_L1_error)
+  __Pyx_TraceLine(372,0,__PYX_ERR(0, 372, __pyx_L1_error))
+  __pyx_t_5 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_5 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 372, __pyx_L1_error)
   __pyx_v_c_score_cutoff = __pyx_t_5;
 
-  /* "rapidfuzz/process_cpp.pyx":340
+  /* "rapidfuzz/process_cpp_impl.pyx":375
  * 
  *     cdef RF_ScorerFunc scorer_func
  *     dereference(scorer).scorer_func_init(&scorer_func, kwargs, 1, &proc_query.string)             # <<<<<<<<<<<<<<
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  * 
  */
-  __Pyx_TraceLine(340,0,__PYX_ERR(0, 340, __pyx_L1_error))
-  __pyx_t_6 = (*__pyx_v_scorer).scorer_func_init((&__pyx_v_scorer_func), __pyx_v_kwargs, 1, (&__pyx_v_proc_query.string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 340, __pyx_L1_error)
+  __Pyx_TraceLine(375,0,__PYX_ERR(0, 375, __pyx_L1_error))
+  __pyx_t_6 = (*__pyx_v_scorer).scorer_func_init((&__pyx_v_scorer_func), __pyx_v_kwargs, 1, (&__pyx_v_proc_query.string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 375, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":341
+  /* "rapidfuzz/process_cpp_impl.pyx":376
  *     cdef RF_ScorerFunc scorer_func
  *     dereference(scorer).scorer_func_init(&scorer_func, kwargs, 1, &proc_query.string)
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)             # <<<<<<<<<<<<<<
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[double](scorer_flags)
  */
-  __Pyx_TraceLine(341,0,__PYX_ERR(0, 341, __pyx_L1_error))
+  __Pyx_TraceLine(376,0,__PYX_ERR(0, 376, __pyx_L1_error))
   __pyx_v_ScorerFunc = RF_ScorerWrapper(__pyx_v_scorer_func);
 
-  /* "rapidfuzz/process_cpp.pyx":343
+  /* "rapidfuzz/process_cpp_impl.pyx":378
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[double](scorer_flags)             # <<<<<<<<<<<<<<
  *     cdef double optimal_score = get_optimal_score[double](scorer_flags)
  * 
  */
-  __Pyx_TraceLine(343,0,__PYX_ERR(0, 343, __pyx_L1_error))
+  __Pyx_TraceLine(378,0,__PYX_ERR(0, 378, __pyx_L1_error))
   __pyx_v_lowest_score_worst = is_lowest_score_worst<double>(__pyx_v_scorer_flags);
 
-  /* "rapidfuzz/process_cpp.pyx":344
+  /* "rapidfuzz/process_cpp_impl.pyx":379
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[double](scorer_flags)
  *     cdef double optimal_score = get_optimal_score[double](scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *     cdef bool result_found = False
  */
-  __Pyx_TraceLine(344,0,__PYX_ERR(0, 344, __pyx_L1_error))
+  __Pyx_TraceLine(379,0,__PYX_ERR(0, 379, __pyx_L1_error))
   __pyx_v_optimal_score = get_optimal_score<double>(__pyx_v_scorer_flags);
 
-  /* "rapidfuzz/process_cpp.pyx":346
+  /* "rapidfuzz/process_cpp_impl.pyx":381
  *     cdef double optimal_score = get_optimal_score[double](scorer_flags)
  * 
  *     cdef bool result_found = False             # <<<<<<<<<<<<<<
  *     cdef double result_score = 0
  *     cdef Py_ssize_t result_index = 0
  */
-  __Pyx_TraceLine(346,0,__PYX_ERR(0, 346, __pyx_L1_error))
+  __Pyx_TraceLine(381,0,__PYX_ERR(0, 381, __pyx_L1_error))
   __pyx_v_result_found = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":347
+  /* "rapidfuzz/process_cpp_impl.pyx":382
  * 
  *     cdef bool result_found = False
  *     cdef double result_score = 0             # <<<<<<<<<<<<<<
  *     cdef Py_ssize_t result_index = 0
  *     result_choice = None
  */
-  __Pyx_TraceLine(347,0,__PYX_ERR(0, 347, __pyx_L1_error))
+  __Pyx_TraceLine(382,0,__PYX_ERR(0, 382, __pyx_L1_error))
   __pyx_v_result_score = 0.0;
 
-  /* "rapidfuzz/process_cpp.pyx":348
+  /* "rapidfuzz/process_cpp_impl.pyx":383
  *     cdef bool result_found = False
  *     cdef double result_score = 0
  *     cdef Py_ssize_t result_index = 0             # <<<<<<<<<<<<<<
  *     result_choice = None
  * 
  */
-  __Pyx_TraceLine(348,0,__PYX_ERR(0, 348, __pyx_L1_error))
+  __Pyx_TraceLine(383,0,__PYX_ERR(0, 383, __pyx_L1_error))
   __pyx_v_result_index = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":349
+  /* "rapidfuzz/process_cpp_impl.pyx":384
  *     cdef double result_score = 0
  *     cdef Py_ssize_t result_index = 0
  *     result_choice = None             # <<<<<<<<<<<<<<
  * 
  *     for i, choice in enumerate(choices):
  */
-  __Pyx_TraceLine(349,0,__PYX_ERR(0, 349, __pyx_L1_error))
+  __Pyx_TraceLine(384,0,__PYX_ERR(0, 384, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_result_choice = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":351
+  /* "rapidfuzz/process_cpp_impl.pyx":386
  *     result_choice = None
  * 
  *     for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  */
-  __Pyx_TraceLine(351,0,__PYX_ERR(0, 351, __pyx_L1_error))
+  __Pyx_TraceLine(386,0,__PYX_ERR(0, 386, __pyx_L1_error))
   __pyx_t_7 = 0;
   if (likely(PyList_CheckExact(__pyx_v_choices)) || PyTuple_CheckExact(__pyx_v_choices)) {
     __pyx_t_2 = __pyx_v_choices; __Pyx_INCREF(__pyx_t_2); __pyx_t_8 = 0;
     __pyx_t_9 = NULL;
   } else {
-    __pyx_t_8 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_choices); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 351, __pyx_L1_error)
+    __pyx_t_8 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_choices); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 386, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 351, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 386, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_9)) {
       if (likely(PyList_CheckExact(__pyx_t_2))) {
         if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_10 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 351, __pyx_L1_error)
+        __pyx_t_10 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 386, __pyx_L1_error)
         #else
-        __pyx_t_10 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 351, __pyx_L1_error)
+        __pyx_t_10 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 386, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
         #endif
       } else {
         if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 351, __pyx_L1_error)
+        __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 386, __pyx_L1_error)
         #else
-        __pyx_t_10 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 351, __pyx_L1_error)
+        __pyx_t_10 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 386, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
         #endif
       }
     } else {
       __pyx_t_10 = __pyx_t_9(__pyx_t_2);
       if (unlikely(!__pyx_t_10)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 351, __pyx_L1_error)
+          else __PYX_ERR(0, 386, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_10);
     }
     __Pyx_XDECREF_SET(__pyx_v_choice, __pyx_t_10);
     __pyx_t_10 = 0;
     __pyx_v_i = __pyx_t_7;
     __pyx_t_7 = (__pyx_t_7 + 1);
 
-    /* "rapidfuzz/process_cpp.pyx":352
+    /* "rapidfuzz/process_cpp_impl.pyx":387
  * 
  *     for i, choice in enumerate(choices):
  *         if i % 1000 == 0:             # <<<<<<<<<<<<<<
  *             PyErr_CheckSignals()
  *         if choice is None:
  */
-    __Pyx_TraceLine(352,0,__PYX_ERR(0, 352, __pyx_L1_error))
+    __Pyx_TraceLine(387,0,__PYX_ERR(0, 387, __pyx_L1_error))
     __pyx_t_1 = (__Pyx_mod_Py_ssize_t(__pyx_v_i, 0x3E8) == 0);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":353
+      /* "rapidfuzz/process_cpp_impl.pyx":388
  *     for i, choice in enumerate(choices):
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()             # <<<<<<<<<<<<<<
  *         if choice is None:
  *             continue
  */
-      __Pyx_TraceLine(353,0,__PYX_ERR(0, 353, __pyx_L1_error))
-      __pyx_t_11 = PyErr_CheckSignals(); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 353, __pyx_L1_error)
+      __Pyx_TraceLine(388,0,__PYX_ERR(0, 388, __pyx_L1_error))
+      __pyx_t_11 = PyErr_CheckSignals(); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 388, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":352
+      /* "rapidfuzz/process_cpp_impl.pyx":387
  * 
  *     for i, choice in enumerate(choices):
  *         if i % 1000 == 0:             # <<<<<<<<<<<<<<
  *             PyErr_CheckSignals()
  *         if choice is None:
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":354
+    /* "rapidfuzz/process_cpp_impl.pyx":389
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
-    __Pyx_TraceLine(354,0,__PYX_ERR(0, 354, __pyx_L1_error))
+    __Pyx_TraceLine(389,0,__PYX_ERR(0, 389, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_choice == Py_None);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":355
+      /* "rapidfuzz/process_cpp_impl.pyx":390
  *             PyErr_CheckSignals()
  *         if choice is None:
  *             continue             # <<<<<<<<<<<<<<
  * 
  *         if processor is None:
  */
-      __Pyx_TraceLine(355,0,__PYX_ERR(0, 355, __pyx_L1_error))
+      __Pyx_TraceLine(390,0,__PYX_ERR(0, 390, __pyx_L1_error))
       goto __pyx_L5_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":354
+      /* "rapidfuzz/process_cpp_impl.pyx":389
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":357
+    /* "rapidfuzz/process_cpp_impl.pyx":392
  *             continue
  * 
  *         if processor is None:             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  */
-    __Pyx_TraceLine(357,0,__PYX_ERR(0, 357, __pyx_L1_error))
+    __Pyx_TraceLine(392,0,__PYX_ERR(0, 392, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_processor == Py_None);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":358
+      /* "rapidfuzz/process_cpp_impl.pyx":393
  * 
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))             # <<<<<<<<<<<<<<
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)
  */
-      __Pyx_TraceLine(358,0,__PYX_ERR(0, 358, __pyx_L1_error))
-      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 358, __pyx_L1_error)
+      __Pyx_TraceLine(393,0,__PYX_ERR(0, 393, __pyx_L1_error))
+      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 393, __pyx_L1_error)
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
 
-      /* "rapidfuzz/process_cpp.pyx":357
+      /* "rapidfuzz/process_cpp_impl.pyx":392
  *             continue
  * 
  *         if processor is None:             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  */
       goto __pyx_L9;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":359
+    /* "rapidfuzz/process_cpp_impl.pyx":394
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))
  */
-    __Pyx_TraceLine(359,0,__PYX_ERR(0, 359, __pyx_L1_error))
+    __Pyx_TraceLine(394,0,__PYX_ERR(0, 394, __pyx_L1_error))
     __pyx_t_12 = (__pyx_v_processor_context != NULL);
     if (__pyx_t_12) {
     } else {
       __pyx_t_1 = __pyx_t_12;
       goto __pyx_L10_bool_binop_done;
     }
     __pyx_t_12 = (__pyx_v_processor_context->version == 1);
     __pyx_t_1 = __pyx_t_12;
     __pyx_L10_bool_binop_done:;
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":360
+      /* "rapidfuzz/process_cpp_impl.pyx":395
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(proc_str))
  *         else:
  */
-      __Pyx_TraceLine(360,0,__PYX_ERR(0, 360, __pyx_L1_error))
-      __pyx_t_6 = __pyx_v_processor_context->preprocess(__pyx_v_choice, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 360, __pyx_L1_error)
+      __Pyx_TraceLine(395,0,__PYX_ERR(0, 395, __pyx_L1_error))
+      __pyx_t_6 = __pyx_v_processor_context->preprocess(__pyx_v_choice, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 395, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":361
+      /* "rapidfuzz/process_cpp_impl.pyx":396
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))             # <<<<<<<<<<<<<<
  *         else:
  *             py_proc_choice = processor(choice)
  */
-      __Pyx_TraceLine(361,0,__PYX_ERR(0, 361, __pyx_L1_error))
+      __Pyx_TraceLine(396,0,__PYX_ERR(0, 396, __pyx_L1_error))
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_v_proc_str));
 
-      /* "rapidfuzz/process_cpp.pyx":359
+      /* "rapidfuzz/process_cpp_impl.pyx":394
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))
  */
       goto __pyx_L9;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":363
+    /* "rapidfuzz/process_cpp_impl.pyx":398
  *             proc_choice = move(RF_StringWrapper(proc_str))
  *         else:
  *             py_proc_choice = processor(choice)             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))
  * 
  */
-    __Pyx_TraceLine(363,0,__PYX_ERR(0, 363, __pyx_L1_error))
+    __Pyx_TraceLine(398,0,__PYX_ERR(0, 398, __pyx_L1_error))
     /*else*/ {
       __Pyx_INCREF(__pyx_v_processor);
       __pyx_t_13 = __pyx_v_processor; __pyx_t_14 = NULL;
       __pyx_t_11 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
         __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
         if (likely(__pyx_t_14)) {
@@ -6961,68 +7885,68 @@
           __pyx_t_11 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_choice};
         __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_13, __pyx_callargs+1-__pyx_t_11, 1+__pyx_t_11);
         __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-        if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 363, __pyx_L1_error)
+        if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 398, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       }
       __Pyx_XDECREF_SET(__pyx_v_py_proc_choice, __pyx_t_10);
       __pyx_t_10 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":364
+      /* "rapidfuzz/process_cpp_impl.pyx":399
  *         else:
  *             py_proc_choice = processor(choice)
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))             # <<<<<<<<<<<<<<
  * 
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  */
-      __Pyx_TraceLine(364,0,__PYX_ERR(0, 364, __pyx_L1_error))
-      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_py_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 364, __pyx_L1_error)
+      __Pyx_TraceLine(399,0,__PYX_ERR(0, 399, __pyx_L1_error))
+      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_py_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 399, __pyx_L1_error)
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
     }
     __pyx_L9:;
 
-    /* "rapidfuzz/process_cpp.pyx":366
+    /* "rapidfuzz/process_cpp_impl.pyx":401
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))
  * 
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)             # <<<<<<<<<<<<<<
  * 
  *         if lowest_score_worst:
  */
-    __Pyx_TraceLine(366,0,__PYX_ERR(0, 366, __pyx_L1_error))
+    __Pyx_TraceLine(401,0,__PYX_ERR(0, 401, __pyx_L1_error))
     try {
       __pyx_v_ScorerFunc.call((&__pyx_v_proc_choice.string), __pyx_v_c_score_cutoff, (&__pyx_v_score));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 366, __pyx_L1_error)
+      __PYX_ERR(0, 401, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":368
+    /* "rapidfuzz/process_cpp_impl.pyx":403
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  */
-    __Pyx_TraceLine(368,0,__PYX_ERR(0, 368, __pyx_L1_error))
+    __Pyx_TraceLine(403,0,__PYX_ERR(0, 403, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":369
+      /* "rapidfuzz/process_cpp_impl.pyx":404
  * 
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
-      __Pyx_TraceLine(369,0,__PYX_ERR(0, 369, __pyx_L1_error))
+      __Pyx_TraceLine(404,0,__PYX_ERR(0, 404, __pyx_L1_error))
       __pyx_t_12 = (__pyx_v_score >= __pyx_v_c_score_cutoff);
       if (__pyx_t_12) {
       } else {
         __pyx_t_1 = __pyx_t_12;
         goto __pyx_L14_bool_binop_done;
       }
       __pyx_t_12 = (!(__pyx_v_result_found != 0));
@@ -7032,83 +7956,83 @@
         goto __pyx_L14_bool_binop_done;
       }
       __pyx_t_12 = (__pyx_v_score > __pyx_v_result_score);
       __pyx_t_1 = __pyx_t_12;
       __pyx_L14_bool_binop_done:;
       if (__pyx_t_1) {
 
-        /* "rapidfuzz/process_cpp.pyx":370
+        /* "rapidfuzz/process_cpp_impl.pyx":405
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_index = i
  */
-        __Pyx_TraceLine(370,0,__PYX_ERR(0, 370, __pyx_L1_error))
+        __Pyx_TraceLine(405,0,__PYX_ERR(0, 405, __pyx_L1_error))
         __pyx_v_result_score = __pyx_v_score;
         __pyx_v_c_score_cutoff = __pyx_v_score;
 
-        /* "rapidfuzz/process_cpp.pyx":371
+        /* "rapidfuzz/process_cpp_impl.pyx":406
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_index = i
  *                 result_found = True
  */
-        __Pyx_TraceLine(371,0,__PYX_ERR(0, 371, __pyx_L1_error))
+        __Pyx_TraceLine(406,0,__PYX_ERR(0, 406, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":372
+        /* "rapidfuzz/process_cpp_impl.pyx":407
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  *                 result_index = i             # <<<<<<<<<<<<<<
  *                 result_found = True
  *         else:
  */
-        __Pyx_TraceLine(372,0,__PYX_ERR(0, 372, __pyx_L1_error))
+        __Pyx_TraceLine(407,0,__PYX_ERR(0, 407, __pyx_L1_error))
         __pyx_v_result_index = __pyx_v_i;
 
-        /* "rapidfuzz/process_cpp.pyx":373
+        /* "rapidfuzz/process_cpp_impl.pyx":408
  *                 result_choice = choice
  *                 result_index = i
  *                 result_found = True             # <<<<<<<<<<<<<<
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  */
-        __Pyx_TraceLine(373,0,__PYX_ERR(0, 373, __pyx_L1_error))
+        __Pyx_TraceLine(408,0,__PYX_ERR(0, 408, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":369
+        /* "rapidfuzz/process_cpp_impl.pyx":404
  * 
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":368
+      /* "rapidfuzz/process_cpp_impl.pyx":403
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  */
       goto __pyx_L12;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":375
+    /* "rapidfuzz/process_cpp_impl.pyx":410
  *                 result_found = True
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
-    __Pyx_TraceLine(375,0,__PYX_ERR(0, 375, __pyx_L1_error))
+    __Pyx_TraceLine(410,0,__PYX_ERR(0, 410, __pyx_L1_error))
     /*else*/ {
       __pyx_t_12 = (__pyx_v_score <= __pyx_v_c_score_cutoff);
       if (__pyx_t_12) {
       } else {
         __pyx_t_1 = __pyx_t_12;
         goto __pyx_L18_bool_binop_done;
       }
@@ -7119,125 +8043,125 @@
         goto __pyx_L18_bool_binop_done;
       }
       __pyx_t_12 = (__pyx_v_score < __pyx_v_result_score);
       __pyx_t_1 = __pyx_t_12;
       __pyx_L18_bool_binop_done:;
       if (__pyx_t_1) {
 
-        /* "rapidfuzz/process_cpp.pyx":376
+        /* "rapidfuzz/process_cpp_impl.pyx":411
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  *                 result_score = c_score_cutoff = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_index = i
  */
-        __Pyx_TraceLine(376,0,__PYX_ERR(0, 376, __pyx_L1_error))
+        __Pyx_TraceLine(411,0,__PYX_ERR(0, 411, __pyx_L1_error))
         __pyx_v_result_score = __pyx_v_score;
         __pyx_v_c_score_cutoff = __pyx_v_score;
 
-        /* "rapidfuzz/process_cpp.pyx":377
+        /* "rapidfuzz/process_cpp_impl.pyx":412
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_index = i
  *                 result_found = True
  */
-        __Pyx_TraceLine(377,0,__PYX_ERR(0, 377, __pyx_L1_error))
+        __Pyx_TraceLine(412,0,__PYX_ERR(0, 412, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":378
+        /* "rapidfuzz/process_cpp_impl.pyx":413
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  *                 result_index = i             # <<<<<<<<<<<<<<
  *                 result_found = True
  * 
  */
-        __Pyx_TraceLine(378,0,__PYX_ERR(0, 378, __pyx_L1_error))
+        __Pyx_TraceLine(413,0,__PYX_ERR(0, 413, __pyx_L1_error))
         __pyx_v_result_index = __pyx_v_i;
 
-        /* "rapidfuzz/process_cpp.pyx":379
+        /* "rapidfuzz/process_cpp_impl.pyx":414
  *                 result_choice = choice
  *                 result_index = i
  *                 result_found = True             # <<<<<<<<<<<<<<
  * 
  *         if score == optimal_score:
  */
-        __Pyx_TraceLine(379,0,__PYX_ERR(0, 379, __pyx_L1_error))
+        __Pyx_TraceLine(414,0,__PYX_ERR(0, 414, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":375
+        /* "rapidfuzz/process_cpp_impl.pyx":410
  *                 result_found = True
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
       }
     }
     __pyx_L12:;
 
-    /* "rapidfuzz/process_cpp.pyx":381
+    /* "rapidfuzz/process_cpp_impl.pyx":416
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
-    __Pyx_TraceLine(381,0,__PYX_ERR(0, 381, __pyx_L1_error))
+    __Pyx_TraceLine(416,0,__PYX_ERR(0, 416, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_score == __pyx_v_optimal_score);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":382
+      /* "rapidfuzz/process_cpp_impl.pyx":417
  * 
  *         if score == optimal_score:
  *             break             # <<<<<<<<<<<<<<
  * 
  *     return (result_choice, result_score, result_index) if result_found else None
  */
-      __Pyx_TraceLine(382,0,__PYX_ERR(0, 382, __pyx_L1_error))
+      __Pyx_TraceLine(417,0,__PYX_ERR(0, 417, __pyx_L1_error))
       goto __pyx_L6_break;
 
-      /* "rapidfuzz/process_cpp.pyx":381
+      /* "rapidfuzz/process_cpp_impl.pyx":416
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":351
+    /* "rapidfuzz/process_cpp_impl.pyx":386
  *     result_choice = None
  * 
  *     for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  */
-    __Pyx_TraceLine(351,0,__PYX_ERR(0, 351, __pyx_L1_error))
+    __Pyx_TraceLine(386,0,__PYX_ERR(0, 386, __pyx_L1_error))
     __pyx_L5_continue:;
   }
   __pyx_L6_break:;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":384
+  /* "rapidfuzz/process_cpp_impl.pyx":419
  *             break
  * 
  *     return (result_choice, result_score, result_index) if result_found else None             # <<<<<<<<<<<<<<
  * 
  * cdef inline extractOne_list_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):
  */
-  __Pyx_TraceLine(384,0,__PYX_ERR(0, 384, __pyx_L1_error))
+  __Pyx_TraceLine(419,0,__PYX_ERR(0, 419, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   if ((__pyx_v_result_found != 0)) {
-    __pyx_t_10 = PyFloat_FromDouble(__pyx_v_result_score); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 384, __pyx_L1_error)
+    __pyx_t_10 = PyFloat_FromDouble(__pyx_v_result_score); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 419, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_13 = PyInt_FromSsize_t(__pyx_v_result_index); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 384, __pyx_L1_error)
+    __pyx_t_13 = PyInt_FromSsize_t(__pyx_v_result_index); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 419, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 384, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 419, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_INCREF(__pyx_v_result_choice);
     __Pyx_GIVEREF(__pyx_v_result_choice);
     PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_result_choice);
     __Pyx_GIVEREF(__pyx_t_10);
     PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_10);
     __Pyx_GIVEREF(__pyx_t_13);
@@ -7250,50 +8174,50 @@
     __Pyx_INCREF(Py_None);
     __pyx_t_2 = Py_None;
   }
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":326
+  /* "rapidfuzz/process_cpp_impl.pyx":361
  *     raise ValueError("scorer does not properly use the C-API")
  * 
  * cdef inline extractOne_list_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef double score
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_10);
   __Pyx_XDECREF(__pyx_t_13);
   __Pyx_XDECREF(__pyx_t_14);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extractOne_list_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extractOne_list_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_processor_capsule);
   __Pyx_XDECREF(__pyx_v_result_choice);
   __Pyx_XDECREF(__pyx_v_choice);
   __Pyx_XDECREF(__pyx_v_py_proc_choice);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":386
+/* "rapidfuzz/process_cpp_impl.pyx":421
  *     return (result_choice, result_score, result_index) if result_found else None
  * 
  * cdef inline extractOne_list_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef int64_t score
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_list_i64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_list_i64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   RF_String __pyx_v_proc_str;
   int64_t __pyx_v_score;
   Py_ssize_t __pyx_v_i;
   RF_Preprocessor *__pyx_v_processor_context;
   PyObject *__pyx_v_processor_capsule = NULL;
   RF_StringWrapper __pyx_v_proc_query;
   int64_t __pyx_v_c_score_cutoff;
@@ -7325,395 +8249,395 @@
   int __pyx_t_12;
   PyObject *__pyx_t_13 = NULL;
   PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extractOne_list_i64", 0);
-  __Pyx_TraceCall("extractOne_list_i64", __pyx_f[0], 386, 0, __PYX_ERR(0, 386, __pyx_L1_error));
+  __Pyx_TraceCall("extractOne_list_i64", __pyx_f[0], 421, 0, __PYX_ERR(0, 421, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":390
+  /* "rapidfuzz/process_cpp_impl.pyx":425
  *     cdef int64_t score
  *     cdef Py_ssize_t i
  *     cdef RF_Preprocessor* processor_context = NULL             # <<<<<<<<<<<<<<
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  */
-  __Pyx_TraceLine(390,0,__PYX_ERR(0, 390, __pyx_L1_error))
+  __Pyx_TraceLine(425,0,__PYX_ERR(0, 425, __pyx_L1_error))
   __pyx_v_processor_context = NULL;
 
-  /* "rapidfuzz/process_cpp.pyx":391
+  /* "rapidfuzz/process_cpp_impl.pyx":426
  *     cdef Py_ssize_t i
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:             # <<<<<<<<<<<<<<
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  */
-  __Pyx_TraceLine(391,0,__PYX_ERR(0, 391, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 391, __pyx_L1_error)
+  __Pyx_TraceLine(426,0,__PYX_ERR(0, 426, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 426, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":392
+    /* "rapidfuzz/process_cpp_impl.pyx":427
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)             # <<<<<<<<<<<<<<
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  */
-    __Pyx_TraceLine(392,0,__PYX_ERR(0, 392, __pyx_L1_error))
-    __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 392, __pyx_L1_error)
+    __Pyx_TraceLine(427,0,__PYX_ERR(0, 427, __pyx_L1_error))
+    __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 427, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_v_processor_capsule = __pyx_t_2;
     __pyx_t_2 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":393
+    /* "rapidfuzz/process_cpp_impl.pyx":428
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
-    __Pyx_TraceLine(393,0,__PYX_ERR(0, 393, __pyx_L1_error))
+    __Pyx_TraceLine(428,0,__PYX_ERR(0, 428, __pyx_L1_error))
     __pyx_t_1 = PyCapsule_IsValid(__pyx_v_processor_capsule, NULL);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":394
+      /* "rapidfuzz/process_cpp_impl.pyx":429
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))
  */
-      __Pyx_TraceLine(394,0,__PYX_ERR(0, 394, __pyx_L1_error))
-      __pyx_t_3 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_3 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 394, __pyx_L1_error)
+      __Pyx_TraceLine(429,0,__PYX_ERR(0, 429, __pyx_L1_error))
+      __pyx_t_3 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_3 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 429, __pyx_L1_error)
       __pyx_v_processor_context = ((RF_Preprocessor *)__pyx_t_3);
 
-      /* "rapidfuzz/process_cpp.pyx":393
+      /* "rapidfuzz/process_cpp_impl.pyx":428
  *     if processor:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":391
+    /* "rapidfuzz/process_cpp_impl.pyx":426
  *     cdef Py_ssize_t i
  *     cdef RF_Preprocessor* processor_context = NULL
  *     if processor:             # <<<<<<<<<<<<<<
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":396
+  /* "rapidfuzz/process_cpp_impl.pyx":431
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))             # <<<<<<<<<<<<<<
  *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, scorer_flags)
  * 
  */
-  __Pyx_TraceLine(396,0,__PYX_ERR(0, 396, __pyx_L1_error))
-  __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 396, __pyx_L1_error)
+  __Pyx_TraceLine(431,0,__PYX_ERR(0, 431, __pyx_L1_error))
+  __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 431, __pyx_L1_error)
   __pyx_v_proc_query = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
 
-  /* "rapidfuzz/process_cpp.pyx":397
+  /* "rapidfuzz/process_cpp_impl.pyx":432
  * 
  *     cdef RF_StringWrapper proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *     cdef RF_ScorerFunc scorer_func
  */
-  __Pyx_TraceLine(397,0,__PYX_ERR(0, 397, __pyx_L1_error))
-  __pyx_t_5 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_5 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 397, __pyx_L1_error)
+  __Pyx_TraceLine(432,0,__PYX_ERR(0, 432, __pyx_L1_error))
+  __pyx_t_5 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_5 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 432, __pyx_L1_error)
   __pyx_v_c_score_cutoff = __pyx_t_5;
 
-  /* "rapidfuzz/process_cpp.pyx":400
+  /* "rapidfuzz/process_cpp_impl.pyx":435
  * 
  *     cdef RF_ScorerFunc scorer_func
  *     dereference(scorer).scorer_func_init(&scorer_func, kwargs, 1, &proc_query.string)             # <<<<<<<<<<<<<<
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  * 
  */
-  __Pyx_TraceLine(400,0,__PYX_ERR(0, 400, __pyx_L1_error))
-  __pyx_t_6 = (*__pyx_v_scorer).scorer_func_init((&__pyx_v_scorer_func), __pyx_v_kwargs, 1, (&__pyx_v_proc_query.string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 400, __pyx_L1_error)
+  __Pyx_TraceLine(435,0,__PYX_ERR(0, 435, __pyx_L1_error))
+  __pyx_t_6 = (*__pyx_v_scorer).scorer_func_init((&__pyx_v_scorer_func), __pyx_v_kwargs, 1, (&__pyx_v_proc_query.string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 435, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":401
+  /* "rapidfuzz/process_cpp_impl.pyx":436
  *     cdef RF_ScorerFunc scorer_func
  *     dereference(scorer).scorer_func_init(&scorer_func, kwargs, 1, &proc_query.string)
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)             # <<<<<<<<<<<<<<
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[int64_t](scorer_flags)
  */
-  __Pyx_TraceLine(401,0,__PYX_ERR(0, 401, __pyx_L1_error))
+  __Pyx_TraceLine(436,0,__PYX_ERR(0, 436, __pyx_L1_error))
   __pyx_v_ScorerFunc = RF_ScorerWrapper(__pyx_v_scorer_func);
 
-  /* "rapidfuzz/process_cpp.pyx":403
+  /* "rapidfuzz/process_cpp_impl.pyx":438
  *     cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[int64_t](scorer_flags)             # <<<<<<<<<<<<<<
  *     cdef int64_t optimal_score = get_optimal_score[int64_t](scorer_flags)
  * 
  */
-  __Pyx_TraceLine(403,0,__PYX_ERR(0, 403, __pyx_L1_error))
+  __Pyx_TraceLine(438,0,__PYX_ERR(0, 438, __pyx_L1_error))
   __pyx_v_lowest_score_worst = is_lowest_score_worst<int64_t>(__pyx_v_scorer_flags);
 
-  /* "rapidfuzz/process_cpp.pyx":404
+  /* "rapidfuzz/process_cpp_impl.pyx":439
  * 
  *     cdef bool lowest_score_worst = is_lowest_score_worst[int64_t](scorer_flags)
  *     cdef int64_t optimal_score = get_optimal_score[int64_t](scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *     cdef bool result_found = False
  */
-  __Pyx_TraceLine(404,0,__PYX_ERR(0, 404, __pyx_L1_error))
+  __Pyx_TraceLine(439,0,__PYX_ERR(0, 439, __pyx_L1_error))
   __pyx_v_optimal_score = get_optimal_score<int64_t>(__pyx_v_scorer_flags);
 
-  /* "rapidfuzz/process_cpp.pyx":406
+  /* "rapidfuzz/process_cpp_impl.pyx":441
  *     cdef int64_t optimal_score = get_optimal_score[int64_t](scorer_flags)
  * 
  *     cdef bool result_found = False             # <<<<<<<<<<<<<<
  *     cdef int64_t result_score = 0
  *     cdef Py_ssize_t result_index = 0
  */
-  __Pyx_TraceLine(406,0,__PYX_ERR(0, 406, __pyx_L1_error))
+  __Pyx_TraceLine(441,0,__PYX_ERR(0, 441, __pyx_L1_error))
   __pyx_v_result_found = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":407
+  /* "rapidfuzz/process_cpp_impl.pyx":442
  * 
  *     cdef bool result_found = False
  *     cdef int64_t result_score = 0             # <<<<<<<<<<<<<<
  *     cdef Py_ssize_t result_index = 0
  *     result_choice = None
  */
-  __Pyx_TraceLine(407,0,__PYX_ERR(0, 407, __pyx_L1_error))
+  __Pyx_TraceLine(442,0,__PYX_ERR(0, 442, __pyx_L1_error))
   __pyx_v_result_score = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":408
+  /* "rapidfuzz/process_cpp_impl.pyx":443
  *     cdef bool result_found = False
  *     cdef int64_t result_score = 0
  *     cdef Py_ssize_t result_index = 0             # <<<<<<<<<<<<<<
  *     result_choice = None
  * 
  */
-  __Pyx_TraceLine(408,0,__PYX_ERR(0, 408, __pyx_L1_error))
+  __Pyx_TraceLine(443,0,__PYX_ERR(0, 443, __pyx_L1_error))
   __pyx_v_result_index = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":409
+  /* "rapidfuzz/process_cpp_impl.pyx":444
  *     cdef int64_t result_score = 0
  *     cdef Py_ssize_t result_index = 0
  *     result_choice = None             # <<<<<<<<<<<<<<
  * 
  *     for i, choice in enumerate(choices):
  */
-  __Pyx_TraceLine(409,0,__PYX_ERR(0, 409, __pyx_L1_error))
+  __Pyx_TraceLine(444,0,__PYX_ERR(0, 444, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_result_choice = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":411
+  /* "rapidfuzz/process_cpp_impl.pyx":446
  *     result_choice = None
  * 
  *     for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  */
-  __Pyx_TraceLine(411,0,__PYX_ERR(0, 411, __pyx_L1_error))
+  __Pyx_TraceLine(446,0,__PYX_ERR(0, 446, __pyx_L1_error))
   __pyx_t_7 = 0;
   if (likely(PyList_CheckExact(__pyx_v_choices)) || PyTuple_CheckExact(__pyx_v_choices)) {
     __pyx_t_2 = __pyx_v_choices; __Pyx_INCREF(__pyx_t_2); __pyx_t_8 = 0;
     __pyx_t_9 = NULL;
   } else {
-    __pyx_t_8 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_choices); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 411, __pyx_L1_error)
+    __pyx_t_8 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_choices); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 446, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 411, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 446, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_9)) {
       if (likely(PyList_CheckExact(__pyx_t_2))) {
         if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_10 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 411, __pyx_L1_error)
+        __pyx_t_10 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 446, __pyx_L1_error)
         #else
-        __pyx_t_10 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 411, __pyx_L1_error)
+        __pyx_t_10 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 446, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
         #endif
       } else {
         if (__pyx_t_8 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 411, __pyx_L1_error)
+        __pyx_t_10 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_10); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 446, __pyx_L1_error)
         #else
-        __pyx_t_10 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 411, __pyx_L1_error)
+        __pyx_t_10 = PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 446, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
         #endif
       }
     } else {
       __pyx_t_10 = __pyx_t_9(__pyx_t_2);
       if (unlikely(!__pyx_t_10)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 411, __pyx_L1_error)
+          else __PYX_ERR(0, 446, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_10);
     }
     __Pyx_XDECREF_SET(__pyx_v_choice, __pyx_t_10);
     __pyx_t_10 = 0;
     __pyx_v_i = __pyx_t_7;
     __pyx_t_7 = (__pyx_t_7 + 1);
 
-    /* "rapidfuzz/process_cpp.pyx":412
+    /* "rapidfuzz/process_cpp_impl.pyx":447
  * 
  *     for i, choice in enumerate(choices):
  *         if i % 1000 == 0:             # <<<<<<<<<<<<<<
  *             PyErr_CheckSignals()
  *         if choice is None:
  */
-    __Pyx_TraceLine(412,0,__PYX_ERR(0, 412, __pyx_L1_error))
+    __Pyx_TraceLine(447,0,__PYX_ERR(0, 447, __pyx_L1_error))
     __pyx_t_1 = (__Pyx_mod_Py_ssize_t(__pyx_v_i, 0x3E8) == 0);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":413
+      /* "rapidfuzz/process_cpp_impl.pyx":448
  *     for i, choice in enumerate(choices):
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()             # <<<<<<<<<<<<<<
  *         if choice is None:
  *             continue
  */
-      __Pyx_TraceLine(413,0,__PYX_ERR(0, 413, __pyx_L1_error))
-      __pyx_t_11 = PyErr_CheckSignals(); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 413, __pyx_L1_error)
+      __Pyx_TraceLine(448,0,__PYX_ERR(0, 448, __pyx_L1_error))
+      __pyx_t_11 = PyErr_CheckSignals(); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 448, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":412
+      /* "rapidfuzz/process_cpp_impl.pyx":447
  * 
  *     for i, choice in enumerate(choices):
  *         if i % 1000 == 0:             # <<<<<<<<<<<<<<
  *             PyErr_CheckSignals()
  *         if choice is None:
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":414
+    /* "rapidfuzz/process_cpp_impl.pyx":449
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
-    __Pyx_TraceLine(414,0,__PYX_ERR(0, 414, __pyx_L1_error))
+    __Pyx_TraceLine(449,0,__PYX_ERR(0, 449, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_choice == Py_None);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":415
+      /* "rapidfuzz/process_cpp_impl.pyx":450
  *             PyErr_CheckSignals()
  *         if choice is None:
  *             continue             # <<<<<<<<<<<<<<
  * 
  *         if processor is None:
  */
-      __Pyx_TraceLine(415,0,__PYX_ERR(0, 415, __pyx_L1_error))
+      __Pyx_TraceLine(450,0,__PYX_ERR(0, 450, __pyx_L1_error))
       goto __pyx_L5_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":414
+      /* "rapidfuzz/process_cpp_impl.pyx":449
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":417
+    /* "rapidfuzz/process_cpp_impl.pyx":452
  *             continue
  * 
  *         if processor is None:             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  */
-    __Pyx_TraceLine(417,0,__PYX_ERR(0, 417, __pyx_L1_error))
+    __Pyx_TraceLine(452,0,__PYX_ERR(0, 452, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_processor == Py_None);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":418
+      /* "rapidfuzz/process_cpp_impl.pyx":453
  * 
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))             # <<<<<<<<<<<<<<
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)
  */
-      __Pyx_TraceLine(418,0,__PYX_ERR(0, 418, __pyx_L1_error))
-      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 418, __pyx_L1_error)
+      __Pyx_TraceLine(453,0,__PYX_ERR(0, 453, __pyx_L1_error))
+      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 453, __pyx_L1_error)
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
 
-      /* "rapidfuzz/process_cpp.pyx":417
+      /* "rapidfuzz/process_cpp_impl.pyx":452
  *             continue
  * 
  *         if processor is None:             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  */
       goto __pyx_L9;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":419
+    /* "rapidfuzz/process_cpp_impl.pyx":454
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))
  */
-    __Pyx_TraceLine(419,0,__PYX_ERR(0, 419, __pyx_L1_error))
+    __Pyx_TraceLine(454,0,__PYX_ERR(0, 454, __pyx_L1_error))
     __pyx_t_12 = (__pyx_v_processor_context != NULL);
     if (__pyx_t_12) {
     } else {
       __pyx_t_1 = __pyx_t_12;
       goto __pyx_L10_bool_binop_done;
     }
     __pyx_t_12 = (__pyx_v_processor_context->version == 1);
     __pyx_t_1 = __pyx_t_12;
     __pyx_L10_bool_binop_done:;
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":420
+      /* "rapidfuzz/process_cpp_impl.pyx":455
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(proc_str))
  *         else:
  */
-      __Pyx_TraceLine(420,0,__PYX_ERR(0, 420, __pyx_L1_error))
-      __pyx_t_6 = __pyx_v_processor_context->preprocess(__pyx_v_choice, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 420, __pyx_L1_error)
+      __Pyx_TraceLine(455,0,__PYX_ERR(0, 455, __pyx_L1_error))
+      __pyx_t_6 = __pyx_v_processor_context->preprocess(__pyx_v_choice, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(0, 455, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":421
+      /* "rapidfuzz/process_cpp_impl.pyx":456
  *         elif processor_context != NULL and processor_context.version == 1:
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))             # <<<<<<<<<<<<<<
  *         else:
  *             py_proc_choice = processor(choice)
  */
-      __Pyx_TraceLine(421,0,__PYX_ERR(0, 421, __pyx_L1_error))
+      __Pyx_TraceLine(456,0,__PYX_ERR(0, 456, __pyx_L1_error))
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_v_proc_str));
 
-      /* "rapidfuzz/process_cpp.pyx":419
+      /* "rapidfuzz/process_cpp_impl.pyx":454
  *         if processor is None:
  *             proc_choice = move(RF_StringWrapper(conv_sequence(choice)))
  *         elif processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *             processor_context.preprocess(choice, &proc_str)
  *             proc_choice = move(RF_StringWrapper(proc_str))
  */
       goto __pyx_L9;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":423
+    /* "rapidfuzz/process_cpp_impl.pyx":458
  *             proc_choice = move(RF_StringWrapper(proc_str))
  *         else:
  *             py_proc_choice = processor(choice)             # <<<<<<<<<<<<<<
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))
  * 
  */
-    __Pyx_TraceLine(423,0,__PYX_ERR(0, 423, __pyx_L1_error))
+    __Pyx_TraceLine(458,0,__PYX_ERR(0, 458, __pyx_L1_error))
     /*else*/ {
       __Pyx_INCREF(__pyx_v_processor);
       __pyx_t_13 = __pyx_v_processor; __pyx_t_14 = NULL;
       __pyx_t_11 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_13))) {
         __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_13);
         if (likely(__pyx_t_14)) {
@@ -7724,68 +8648,68 @@
           __pyx_t_11 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_v_choice};
         __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_13, __pyx_callargs+1-__pyx_t_11, 1+__pyx_t_11);
         __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
-        if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 423, __pyx_L1_error)
+        if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 458, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_10);
         __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
       }
       __Pyx_XDECREF_SET(__pyx_v_py_proc_choice, __pyx_t_10);
       __pyx_t_10 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":424
+      /* "rapidfuzz/process_cpp_impl.pyx":459
  *         else:
  *             py_proc_choice = processor(choice)
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))             # <<<<<<<<<<<<<<
  * 
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  */
-      __Pyx_TraceLine(424,0,__PYX_ERR(0, 424, __pyx_L1_error))
-      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_py_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 424, __pyx_L1_error)
+      __Pyx_TraceLine(459,0,__PYX_ERR(0, 459, __pyx_L1_error))
+      __pyx_t_4 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_py_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 459, __pyx_L1_error)
       __pyx_v_proc_choice = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_4));
     }
     __pyx_L9:;
 
-    /* "rapidfuzz/process_cpp.pyx":426
+    /* "rapidfuzz/process_cpp_impl.pyx":461
  *             proc_choice = move(RF_StringWrapper(conv_sequence(py_proc_choice)))
  * 
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)             # <<<<<<<<<<<<<<
  * 
  *         if lowest_score_worst:
  */
-    __Pyx_TraceLine(426,0,__PYX_ERR(0, 426, __pyx_L1_error))
+    __Pyx_TraceLine(461,0,__PYX_ERR(0, 461, __pyx_L1_error))
     try {
       __pyx_v_ScorerFunc.call((&__pyx_v_proc_choice.string), __pyx_v_c_score_cutoff, (&__pyx_v_score));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 426, __pyx_L1_error)
+      __PYX_ERR(0, 461, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":428
+    /* "rapidfuzz/process_cpp_impl.pyx":463
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  */
-    __Pyx_TraceLine(428,0,__PYX_ERR(0, 428, __pyx_L1_error))
+    __Pyx_TraceLine(463,0,__PYX_ERR(0, 463, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":429
+      /* "rapidfuzz/process_cpp_impl.pyx":464
  * 
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
-      __Pyx_TraceLine(429,0,__PYX_ERR(0, 429, __pyx_L1_error))
+      __Pyx_TraceLine(464,0,__PYX_ERR(0, 464, __pyx_L1_error))
       __pyx_t_12 = (__pyx_v_score >= __pyx_v_c_score_cutoff);
       if (__pyx_t_12) {
       } else {
         __pyx_t_1 = __pyx_t_12;
         goto __pyx_L14_bool_binop_done;
       }
       __pyx_t_12 = (!(__pyx_v_result_found != 0));
@@ -7795,83 +8719,83 @@
         goto __pyx_L14_bool_binop_done;
       }
       __pyx_t_12 = (__pyx_v_score > __pyx_v_result_score);
       __pyx_t_1 = __pyx_t_12;
       __pyx_L14_bool_binop_done:;
       if (__pyx_t_1) {
 
-        /* "rapidfuzz/process_cpp.pyx":430
+        /* "rapidfuzz/process_cpp_impl.pyx":465
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_index = i
  */
-        __Pyx_TraceLine(430,0,__PYX_ERR(0, 430, __pyx_L1_error))
+        __Pyx_TraceLine(465,0,__PYX_ERR(0, 465, __pyx_L1_error))
         __pyx_v_result_score = __pyx_v_score;
         __pyx_v_c_score_cutoff = __pyx_v_score;
 
-        /* "rapidfuzz/process_cpp.pyx":431
+        /* "rapidfuzz/process_cpp_impl.pyx":466
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_index = i
  *                 result_found = True
  */
-        __Pyx_TraceLine(431,0,__PYX_ERR(0, 431, __pyx_L1_error))
+        __Pyx_TraceLine(466,0,__PYX_ERR(0, 466, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":432
+        /* "rapidfuzz/process_cpp_impl.pyx":467
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  *                 result_index = i             # <<<<<<<<<<<<<<
  *                 result_found = True
  *         else:
  */
-        __Pyx_TraceLine(432,0,__PYX_ERR(0, 432, __pyx_L1_error))
+        __Pyx_TraceLine(467,0,__PYX_ERR(0, 467, __pyx_L1_error))
         __pyx_v_result_index = __pyx_v_i;
 
-        /* "rapidfuzz/process_cpp.pyx":433
+        /* "rapidfuzz/process_cpp_impl.pyx":468
  *                 result_choice = choice
  *                 result_index = i
  *                 result_found = True             # <<<<<<<<<<<<<<
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  */
-        __Pyx_TraceLine(433,0,__PYX_ERR(0, 433, __pyx_L1_error))
+        __Pyx_TraceLine(468,0,__PYX_ERR(0, 468, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":429
+        /* "rapidfuzz/process_cpp_impl.pyx":464
  * 
  *         if lowest_score_worst:
  *             if score >= c_score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":428
+      /* "rapidfuzz/process_cpp_impl.pyx":463
  *         ScorerFunc.call(&proc_choice.string, c_score_cutoff, &score)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= c_score_cutoff and (not result_found or score > result_score):
  *                 result_score = c_score_cutoff = score
  */
       goto __pyx_L12;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":435
+    /* "rapidfuzz/process_cpp_impl.pyx":470
  *                 result_found = True
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
-    __Pyx_TraceLine(435,0,__PYX_ERR(0, 435, __pyx_L1_error))
+    __Pyx_TraceLine(470,0,__PYX_ERR(0, 470, __pyx_L1_error))
     /*else*/ {
       __pyx_t_12 = (__pyx_v_score <= __pyx_v_c_score_cutoff);
       if (__pyx_t_12) {
       } else {
         __pyx_t_1 = __pyx_t_12;
         goto __pyx_L18_bool_binop_done;
       }
@@ -7882,125 +8806,125 @@
         goto __pyx_L18_bool_binop_done;
       }
       __pyx_t_12 = (__pyx_v_score < __pyx_v_result_score);
       __pyx_t_1 = __pyx_t_12;
       __pyx_L18_bool_binop_done:;
       if (__pyx_t_1) {
 
-        /* "rapidfuzz/process_cpp.pyx":436
+        /* "rapidfuzz/process_cpp_impl.pyx":471
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  *                 result_score = c_score_cutoff = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_index = i
  */
-        __Pyx_TraceLine(436,0,__PYX_ERR(0, 436, __pyx_L1_error))
+        __Pyx_TraceLine(471,0,__PYX_ERR(0, 471, __pyx_L1_error))
         __pyx_v_result_score = __pyx_v_score;
         __pyx_v_c_score_cutoff = __pyx_v_score;
 
-        /* "rapidfuzz/process_cpp.pyx":437
+        /* "rapidfuzz/process_cpp_impl.pyx":472
  *             if score <= c_score_cutoff and (not result_found or score < result_score):
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_index = i
  *                 result_found = True
  */
-        __Pyx_TraceLine(437,0,__PYX_ERR(0, 437, __pyx_L1_error))
+        __Pyx_TraceLine(472,0,__PYX_ERR(0, 472, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":438
+        /* "rapidfuzz/process_cpp_impl.pyx":473
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  *                 result_index = i             # <<<<<<<<<<<<<<
  *                 result_found = True
  * 
  */
-        __Pyx_TraceLine(438,0,__PYX_ERR(0, 438, __pyx_L1_error))
+        __Pyx_TraceLine(473,0,__PYX_ERR(0, 473, __pyx_L1_error))
         __pyx_v_result_index = __pyx_v_i;
 
-        /* "rapidfuzz/process_cpp.pyx":439
+        /* "rapidfuzz/process_cpp_impl.pyx":474
  *                 result_choice = choice
  *                 result_index = i
  *                 result_found = True             # <<<<<<<<<<<<<<
  * 
  *         if score == optimal_score:
  */
-        __Pyx_TraceLine(439,0,__PYX_ERR(0, 439, __pyx_L1_error))
+        __Pyx_TraceLine(474,0,__PYX_ERR(0, 474, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":435
+        /* "rapidfuzz/process_cpp_impl.pyx":470
  *                 result_found = True
  *         else:
  *             if score <= c_score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 result_score = c_score_cutoff = score
  *                 result_choice = choice
  */
       }
     }
     __pyx_L12:;
 
-    /* "rapidfuzz/process_cpp.pyx":441
+    /* "rapidfuzz/process_cpp_impl.pyx":476
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
-    __Pyx_TraceLine(441,0,__PYX_ERR(0, 441, __pyx_L1_error))
+    __Pyx_TraceLine(476,0,__PYX_ERR(0, 476, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_score == __pyx_v_optimal_score);
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":442
+      /* "rapidfuzz/process_cpp_impl.pyx":477
  * 
  *         if score == optimal_score:
  *             break             # <<<<<<<<<<<<<<
  * 
  *     return (result_choice, result_score, result_index) if result_found else None
  */
-      __Pyx_TraceLine(442,0,__PYX_ERR(0, 442, __pyx_L1_error))
+      __Pyx_TraceLine(477,0,__PYX_ERR(0, 477, __pyx_L1_error))
       goto __pyx_L6_break;
 
-      /* "rapidfuzz/process_cpp.pyx":441
+      /* "rapidfuzz/process_cpp_impl.pyx":476
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":411
+    /* "rapidfuzz/process_cpp_impl.pyx":446
  *     result_choice = None
  * 
  *     for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *         if i % 1000 == 0:
  *             PyErr_CheckSignals()
  */
-    __Pyx_TraceLine(411,0,__PYX_ERR(0, 411, __pyx_L1_error))
+    __Pyx_TraceLine(446,0,__PYX_ERR(0, 446, __pyx_L1_error))
     __pyx_L5_continue:;
   }
   __pyx_L6_break:;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":444
+  /* "rapidfuzz/process_cpp_impl.pyx":479
  *             break
  * 
  *     return (result_choice, result_score, result_index) if result_found else None             # <<<<<<<<<<<<<<
  * 
  * cdef inline extractOne_list(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):
  */
-  __Pyx_TraceLine(444,0,__PYX_ERR(0, 444, __pyx_L1_error))
+  __Pyx_TraceLine(479,0,__PYX_ERR(0, 479, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   if ((__pyx_v_result_found != 0)) {
-    __pyx_t_10 = __Pyx_PyInt_From_int64_t(__pyx_v_result_score); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 444, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_From_int64_t(__pyx_v_result_score); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 479, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_13 = PyInt_FromSsize_t(__pyx_v_result_index); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 444, __pyx_L1_error)
+    __pyx_t_13 = PyInt_FromSsize_t(__pyx_v_result_index); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 479, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_13);
-    __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 444, __pyx_L1_error)
+    __pyx_t_14 = PyTuple_New(3); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 479, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_14);
     __Pyx_INCREF(__pyx_v_result_choice);
     __Pyx_GIVEREF(__pyx_v_result_choice);
     PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_v_result_choice);
     __Pyx_GIVEREF(__pyx_t_10);
     PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_10);
     __Pyx_GIVEREF(__pyx_t_13);
@@ -8013,347 +8937,347 @@
     __Pyx_INCREF(Py_None);
     __pyx_t_2 = Py_None;
   }
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":386
+  /* "rapidfuzz/process_cpp_impl.pyx":421
  *     return (result_choice, result_score, result_index) if result_found else None
  * 
  * cdef inline extractOne_list_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef int64_t score
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_10);
   __Pyx_XDECREF(__pyx_t_13);
   __Pyx_XDECREF(__pyx_t_14);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extractOne_list_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extractOne_list_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_processor_capsule);
   __Pyx_XDECREF(__pyx_v_result_choice);
   __Pyx_XDECREF(__pyx_v_choice);
   __Pyx_XDECREF(__pyx_v_py_proc_choice);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":446
+/* "rapidfuzz/process_cpp_impl.pyx":481
  *     return (result_choice, result_score, result_index) if result_found else None
  * 
  * cdef inline extractOne_list(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extractOne_list(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_list(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   uint32_t __pyx_v_flags;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   uint32_t __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extractOne_list", 0);
-  __Pyx_TraceCall("extractOne_list", __pyx_f[0], 446, 0, __PYX_ERR(0, 446, __pyx_L1_error));
+  __Pyx_TraceCall("extractOne_list", __pyx_f[0], 481, 0, __PYX_ERR(0, 481, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":447
+  /* "rapidfuzz/process_cpp_impl.pyx":482
  * 
  * cdef inline extractOne_list(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):
  *     flags = dereference(scorer_flags).flags             # <<<<<<<<<<<<<<
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  */
-  __Pyx_TraceLine(447,0,__PYX_ERR(0, 447, __pyx_L1_error))
+  __Pyx_TraceLine(482,0,__PYX_ERR(0, 482, __pyx_L1_error))
   __pyx_t_1 = (*__pyx_v_scorer_flags).flags;
   __pyx_v_flags = __pyx_t_1;
 
-  /* "rapidfuzz/process_cpp.pyx":449
+  /* "rapidfuzz/process_cpp_impl.pyx":484
  *     flags = dereference(scorer_flags).flags
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *         return extractOne_list_f64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  */
-  __Pyx_TraceLine(449,0,__PYX_ERR(0, 449, __pyx_L1_error))
+  __Pyx_TraceLine(484,0,__PYX_ERR(0, 484, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_F64) != 0);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":450
+    /* "rapidfuzz/process_cpp_impl.pyx":485
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  *         return extractOne_list_f64(             # <<<<<<<<<<<<<<
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  *         )
  */
-    __Pyx_TraceLine(450,0,__PYX_ERR(0, 450, __pyx_L1_error))
+    __Pyx_TraceLine(485,0,__PYX_ERR(0, 485, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
 
-    /* "rapidfuzz/process_cpp.pyx":451
+    /* "rapidfuzz/process_cpp_impl.pyx":486
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  *         return extractOne_list_f64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs             # <<<<<<<<<<<<<<
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  */
-    __Pyx_TraceLine(451,0,__PYX_ERR(0, 451, __pyx_L1_error))
-    __pyx_t_3 = __pyx_f_9rapidfuzz_11process_cpp_extractOne_list_f64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 450, __pyx_L1_error)
+    __Pyx_TraceLine(486,0,__PYX_ERR(0, 486, __pyx_L1_error))
+    __pyx_t_3 = __pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_list_f64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 485, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":449
+    /* "rapidfuzz/process_cpp_impl.pyx":484
  *     flags = dereference(scorer_flags).flags
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *         return extractOne_list_f64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":453
+  /* "rapidfuzz/process_cpp_impl.pyx":488
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *         return extractOne_list_i64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  */
-  __Pyx_TraceLine(453,0,__PYX_ERR(0, 453, __pyx_L1_error))
+  __Pyx_TraceLine(488,0,__PYX_ERR(0, 488, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_I64) != 0);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":454
+    /* "rapidfuzz/process_cpp_impl.pyx":489
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  *         return extractOne_list_i64(             # <<<<<<<<<<<<<<
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  *         )
  */
-    __Pyx_TraceLine(454,0,__PYX_ERR(0, 454, __pyx_L1_error))
+    __Pyx_TraceLine(489,0,__PYX_ERR(0, 489, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
 
-    /* "rapidfuzz/process_cpp.pyx":455
+    /* "rapidfuzz/process_cpp_impl.pyx":490
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  *         return extractOne_list_i64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs             # <<<<<<<<<<<<<<
  *         )
  * 
  */
-    __Pyx_TraceLine(455,0,__PYX_ERR(0, 455, __pyx_L1_error))
-    __pyx_t_3 = __pyx_f_9rapidfuzz_11process_cpp_extractOne_list_i64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 454, __pyx_L1_error)
+    __Pyx_TraceLine(490,0,__PYX_ERR(0, 490, __pyx_L1_error))
+    __pyx_t_3 = __pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_list_i64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 489, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":453
+    /* "rapidfuzz/process_cpp_impl.pyx":488
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *         return extractOne_list_i64(
  *             query, choices, scorer, scorer_flags, processor, score_cutoff, kwargs
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":458
+  /* "rapidfuzz/process_cpp_impl.pyx":493
  *         )
  * 
  *     raise ValueError("scorer does not properly use the C-API")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(458,0,__PYX_ERR(0, 458, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 458, __pyx_L1_error)
+  __Pyx_TraceLine(493,0,__PYX_ERR(0, 493, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 493, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_Raise(__pyx_t_3, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __PYX_ERR(0, 458, __pyx_L1_error)
+  __PYX_ERR(0, 493, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":446
+  /* "rapidfuzz/process_cpp_impl.pyx":481
  *     return (result_choice, result_score, result_index) if result_found else None
  * 
  * cdef inline extractOne_list(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extractOne_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extractOne_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":461
+/* "rapidfuzz/process_cpp_impl.pyx":496
  * 
  * 
  * cdef inline get_scorer_flags_py(scorer, dict kwargs):             # <<<<<<<<<<<<<<
  *     params = getattr(scorer, '_RF_ScorerPy', None)
  *     if params is not None:
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_get_scorer_flags_py(PyObject *__pyx_v_scorer, PyObject *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_get_scorer_flags_py(PyObject *__pyx_v_scorer, PyObject *__pyx_v_kwargs) {
   PyObject *__pyx_v_params = NULL;
   PyObject *__pyx_v_flags = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_scorer_flags_py", 0);
-  __Pyx_TraceCall("get_scorer_flags_py", __pyx_f[0], 461, 0, __PYX_ERR(0, 461, __pyx_L1_error));
+  __Pyx_TraceCall("get_scorer_flags_py", __pyx_f[0], 496, 0, __PYX_ERR(0, 496, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":462
+  /* "rapidfuzz/process_cpp_impl.pyx":497
  * 
  * cdef inline get_scorer_flags_py(scorer, dict kwargs):
  *     params = getattr(scorer, '_RF_ScorerPy', None)             # <<<<<<<<<<<<<<
  *     if params is not None:
  *         flags = params["get_scorer_flags"](**kwargs)
  */
-  __Pyx_TraceLine(462,0,__PYX_ERR(0, 462, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_GetAttr3(__pyx_v_scorer, __pyx_n_u_RF_ScorerPy, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 462, __pyx_L1_error)
+  __Pyx_TraceLine(497,0,__PYX_ERR(0, 497, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_GetAttr3(__pyx_v_scorer, __pyx_n_u_RF_ScorerPy, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 497, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_params = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":463
+  /* "rapidfuzz/process_cpp_impl.pyx":498
  * cdef inline get_scorer_flags_py(scorer, dict kwargs):
  *     params = getattr(scorer, '_RF_ScorerPy', None)
  *     if params is not None:             # <<<<<<<<<<<<<<
  *         flags = params["get_scorer_flags"](**kwargs)
  *         return (flags["worst_score"], flags["optimal_score"])
  */
-  __Pyx_TraceLine(463,0,__PYX_ERR(0, 463, __pyx_L1_error))
+  __Pyx_TraceLine(498,0,__PYX_ERR(0, 498, __pyx_L1_error))
   __pyx_t_2 = (__pyx_v_params != Py_None);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":464
+    /* "rapidfuzz/process_cpp_impl.pyx":499
  *     params = getattr(scorer, '_RF_ScorerPy', None)
  *     if params is not None:
  *         flags = params["get_scorer_flags"](**kwargs)             # <<<<<<<<<<<<<<
  *         return (flags["worst_score"], flags["optimal_score"])
  *     return (0, 100)
  */
-    __Pyx_TraceLine(464,0,__PYX_ERR(0, 464, __pyx_L1_error))
-    __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_get_scorer_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 464, __pyx_L1_error)
+    __Pyx_TraceLine(499,0,__PYX_ERR(0, 499, __pyx_L1_error))
+    __pyx_t_1 = __Pyx_PyObject_Dict_GetItem(__pyx_v_params, __pyx_n_u_get_scorer_flags); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 499, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-      __PYX_ERR(0, 464, __pyx_L1_error)
+      __PYX_ERR(0, 499, __pyx_L1_error)
     }
-    __pyx_t_3 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 464, __pyx_L1_error)
+    __pyx_t_3 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 499, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 464, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 499, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_flags = __pyx_t_4;
     __pyx_t_4 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":465
+    /* "rapidfuzz/process_cpp_impl.pyx":500
  *     if params is not None:
  *         flags = params["get_scorer_flags"](**kwargs)
  *         return (flags["worst_score"], flags["optimal_score"])             # <<<<<<<<<<<<<<
  *     return (0, 100)
  * 
  */
-    __Pyx_TraceLine(465,0,__PYX_ERR(0, 465, __pyx_L1_error))
+    __Pyx_TraceLine(500,0,__PYX_ERR(0, 500, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_flags, __pyx_n_u_worst_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 465, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_flags, __pyx_n_u_worst_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 500, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = __Pyx_PyObject_Dict_GetItem(__pyx_v_flags, __pyx_n_u_optimal_score); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 465, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Dict_GetItem(__pyx_v_flags, __pyx_n_u_optimal_score); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 500, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 465, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 500, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_3);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
     __pyx_t_4 = 0;
     __pyx_t_3 = 0;
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":463
+    /* "rapidfuzz/process_cpp_impl.pyx":498
  * cdef inline get_scorer_flags_py(scorer, dict kwargs):
  *     params = getattr(scorer, '_RF_ScorerPy', None)
  *     if params is not None:             # <<<<<<<<<<<<<<
  *         flags = params["get_scorer_flags"](**kwargs)
  *         return (flags["worst_score"], flags["optimal_score"])
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":466
+  /* "rapidfuzz/process_cpp_impl.pyx":501
  *         flags = params["get_scorer_flags"](**kwargs)
  *         return (flags["worst_score"], flags["optimal_score"])
  *     return (0, 100)             # <<<<<<<<<<<<<<
  * 
  * cdef inline py_extractOne_dict(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):
  */
-  __Pyx_TraceLine(466,0,__PYX_ERR(0, 466, __pyx_L1_error))
+  __Pyx_TraceLine(501,0,__PYX_ERR(0, 501, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_tuple__2);
   __pyx_r = __pyx_tuple__2;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":461
+  /* "rapidfuzz/process_cpp_impl.pyx":496
  * 
  * 
  * cdef inline get_scorer_flags_py(scorer, dict kwargs):             # <<<<<<<<<<<<<<
  *     params = getattr(scorer, '_RF_ScorerPy', None)
  *     if params is not None:
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.get_scorer_flags_py", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.get_scorer_flags_py", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_params);
   __Pyx_XDECREF(__pyx_v_flags);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":468
+/* "rapidfuzz/process_cpp_impl.pyx":503
  *     return (0, 100)
  * 
  * cdef inline py_extractOne_dict(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef bool result_found = False
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_py_extractOne_dict(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, double __pyx_v_score_cutoff, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score, PyObject *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_py_extractOne_dict(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, double __pyx_v_score_cutoff, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score, PyObject *__pyx_v_kwargs) {
   bool __pyx_v_lowest_score_worst;
   bool __pyx_v_result_found;
   PyObject *__pyx_v_result_score = NULL;
   PyObject *__pyx_v_result_choice = NULL;
   PyObject *__pyx_v_result_key = NULL;
   PyObject *__pyx_v_choice_key = NULL;
   PyObject *__pyx_v_choice = NULL;
@@ -8373,150 +9297,150 @@
   PyObject *__pyx_t_10 = NULL;
   int __pyx_t_11;
   double __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("py_extractOne_dict", 0);
-  __Pyx_TraceCall("py_extractOne_dict", __pyx_f[0], 468, 0, __PYX_ERR(0, 468, __pyx_L1_error));
+  __Pyx_TraceCall("py_extractOne_dict", __pyx_f[0], 503, 0, __PYX_ERR(0, 503, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":469
+  /* "rapidfuzz/process_cpp_impl.pyx":504
  * 
  * cdef inline py_extractOne_dict(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):
  *     cdef bool lowest_score_worst = optimal_score > worst_score             # <<<<<<<<<<<<<<
  *     cdef bool result_found = False
  *     result_score = 0
  */
-  __Pyx_TraceLine(469,0,__PYX_ERR(0, 469, __pyx_L1_error))
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_optimal_score, __pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 469, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 469, __pyx_L1_error)
+  __Pyx_TraceLine(504,0,__PYX_ERR(0, 504, __pyx_L1_error))
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_optimal_score, __pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 504, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 504, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_lowest_score_worst = __pyx_t_2;
 
-  /* "rapidfuzz/process_cpp.pyx":470
+  /* "rapidfuzz/process_cpp_impl.pyx":505
  * cdef inline py_extractOne_dict(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef bool result_found = False             # <<<<<<<<<<<<<<
  *     result_score = 0
  *     result_choice = None
  */
-  __Pyx_TraceLine(470,0,__PYX_ERR(0, 470, __pyx_L1_error))
+  __Pyx_TraceLine(505,0,__PYX_ERR(0, 505, __pyx_L1_error))
   __pyx_v_result_found = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":471
+  /* "rapidfuzz/process_cpp_impl.pyx":506
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef bool result_found = False
  *     result_score = 0             # <<<<<<<<<<<<<<
  *     result_choice = None
  *     result_key = None
  */
-  __Pyx_TraceLine(471,0,__PYX_ERR(0, 471, __pyx_L1_error))
+  __Pyx_TraceLine(506,0,__PYX_ERR(0, 506, __pyx_L1_error))
   __Pyx_INCREF(__pyx_int_0);
   __pyx_v_result_score = __pyx_int_0;
 
-  /* "rapidfuzz/process_cpp.pyx":472
+  /* "rapidfuzz/process_cpp_impl.pyx":507
  *     cdef bool result_found = False
  *     result_score = 0
  *     result_choice = None             # <<<<<<<<<<<<<<
  *     result_key = None
  * 
  */
-  __Pyx_TraceLine(472,0,__PYX_ERR(0, 472, __pyx_L1_error))
+  __Pyx_TraceLine(507,0,__PYX_ERR(0, 507, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_result_choice = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":473
+  /* "rapidfuzz/process_cpp_impl.pyx":508
  *     result_score = 0
  *     result_choice = None
  *     result_key = None             # <<<<<<<<<<<<<<
  * 
  *     for choice_key, choice in choices.items():
  */
-  __Pyx_TraceLine(473,0,__PYX_ERR(0, 473, __pyx_L1_error))
+  __Pyx_TraceLine(508,0,__PYX_ERR(0, 508, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_result_key = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":475
+  /* "rapidfuzz/process_cpp_impl.pyx":510
  *     result_key = None
  * 
  *     for choice_key, choice in choices.items():             # <<<<<<<<<<<<<<
  *         if choice is None:
  *             continue
  */
-  __Pyx_TraceLine(475,0,__PYX_ERR(0, 475, __pyx_L1_error))
+  __Pyx_TraceLine(510,0,__PYX_ERR(0, 510, __pyx_L1_error))
   __pyx_t_3 = 0;
   if (unlikely(__pyx_v_choices == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-    __PYX_ERR(0, 475, __pyx_L1_error)
+    __PYX_ERR(0, 510, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_dict_iterator(__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_4), (&__pyx_t_5)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 475, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_4), (&__pyx_t_5)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 510, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_8 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_4, &__pyx_t_3, &__pyx_t_6, &__pyx_t_7, NULL, __pyx_t_5);
     if (unlikely(__pyx_t_8 == 0)) break;
-    if (unlikely(__pyx_t_8 == -1)) __PYX_ERR(0, 475, __pyx_L1_error)
+    if (unlikely(__pyx_t_8 == -1)) __PYX_ERR(0, 510, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_XDECREF_SET(__pyx_v_choice_key, __pyx_t_6);
     __pyx_t_6 = 0;
     __Pyx_XDECREF_SET(__pyx_v_choice, __pyx_t_7);
     __pyx_t_7 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":476
+    /* "rapidfuzz/process_cpp_impl.pyx":511
  * 
  *     for choice_key, choice in choices.items():
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
-    __Pyx_TraceLine(476,0,__PYX_ERR(0, 476, __pyx_L1_error))
+    __Pyx_TraceLine(511,0,__PYX_ERR(0, 511, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_choice == Py_None);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":477
+      /* "rapidfuzz/process_cpp_impl.pyx":512
  *     for choice_key, choice in choices.items():
  *         if choice is None:
  *             continue             # <<<<<<<<<<<<<<
  * 
  *         if processor is not None:
  */
-      __Pyx_TraceLine(477,0,__PYX_ERR(0, 477, __pyx_L1_error))
+      __Pyx_TraceLine(512,0,__PYX_ERR(0, 512, __pyx_L1_error))
       goto __pyx_L3_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":476
+      /* "rapidfuzz/process_cpp_impl.pyx":511
  * 
  *     for choice_key, choice in choices.items():
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":479
+    /* "rapidfuzz/process_cpp_impl.pyx":514
  *             continue
  * 
  *         if processor is not None:             # <<<<<<<<<<<<<<
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  */
-    __Pyx_TraceLine(479,0,__PYX_ERR(0, 479, __pyx_L1_error))
+    __Pyx_TraceLine(514,0,__PYX_ERR(0, 514, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_processor != Py_None);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":480
+      /* "rapidfuzz/process_cpp_impl.pyx":515
  * 
  *         if processor is not None:
  *             score = scorer(query, processor(choice), **kwargs)             # <<<<<<<<<<<<<<
  *         else:
  *             score = scorer(query, choice, **kwargs)
  */
-      __Pyx_TraceLine(480,0,__PYX_ERR(0, 480, __pyx_L1_error))
+      __Pyx_TraceLine(515,0,__PYX_ERR(0, 515, __pyx_L1_error))
       __Pyx_INCREF(__pyx_v_processor);
       __pyx_t_6 = __pyx_v_processor; __pyx_t_10 = NULL;
       __pyx_t_8 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
         __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_6);
         if (likely(__pyx_t_10)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
@@ -8526,371 +9450,371 @@
           __pyx_t_8 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_v_choice};
         __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
-        if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 480, __pyx_L1_error)
+        if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 515, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       }
-      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 480, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 515, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_INCREF(__pyx_v_query);
       __Pyx_GIVEREF(__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_query);
       __Pyx_GIVEREF(__pyx_t_7);
       PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_7);
       __pyx_t_7 = 0;
       if (unlikely(__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 480, __pyx_L1_error)
+        __PYX_ERR(0, 515, __pyx_L1_error)
       }
-      __pyx_t_7 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 480, __pyx_L1_error)
+      __pyx_t_7 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 515, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 480, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 515, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_XDECREF_SET(__pyx_v_score, __pyx_t_10);
       __pyx_t_10 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":479
+      /* "rapidfuzz/process_cpp_impl.pyx":514
  *             continue
  * 
  *         if processor is not None:             # <<<<<<<<<<<<<<
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  */
       goto __pyx_L6;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":482
+    /* "rapidfuzz/process_cpp_impl.pyx":517
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  *             score = scorer(query, choice, **kwargs)             # <<<<<<<<<<<<<<
  * 
  *         if lowest_score_worst:
  */
-    __Pyx_TraceLine(482,0,__PYX_ERR(0, 482, __pyx_L1_error))
+    __Pyx_TraceLine(517,0,__PYX_ERR(0, 517, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 482, __pyx_L1_error)
+      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 517, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_INCREF(__pyx_v_query);
       __Pyx_GIVEREF(__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_query);
       __Pyx_INCREF(__pyx_v_choice);
       __Pyx_GIVEREF(__pyx_v_choice);
       PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_v_choice);
       if (unlikely(__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 482, __pyx_L1_error)
+        __PYX_ERR(0, 517, __pyx_L1_error)
       }
-      __pyx_t_7 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 482, __pyx_L1_error)
+      __pyx_t_7 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 517, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_10, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 482, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_10, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 517, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_XDECREF_SET(__pyx_v_score, __pyx_t_6);
       __pyx_t_6 = 0;
     }
     __pyx_L6:;
 
-    /* "rapidfuzz/process_cpp.pyx":484
+    /* "rapidfuzz/process_cpp_impl.pyx":519
  *             score = scorer(query, choice, **kwargs)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= score_cutoff and (not result_found or score > result_score):
  *                 score_cutoff = score
  */
-    __Pyx_TraceLine(484,0,__PYX_ERR(0, 484, __pyx_L1_error))
+    __Pyx_TraceLine(519,0,__PYX_ERR(0, 519, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":485
+      /* "rapidfuzz/process_cpp_impl.pyx":520
  * 
  *         if lowest_score_worst:
  *             if score >= score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  */
-      __Pyx_TraceLine(485,0,__PYX_ERR(0, 485, __pyx_L1_error))
-      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 485, __pyx_L1_error)
+      __Pyx_TraceLine(520,0,__PYX_ERR(0, 520, __pyx_L1_error))
+      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 520, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_7 = PyObject_RichCompare(__pyx_v_score, __pyx_t_6, Py_GE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 485, __pyx_L1_error)
+      __pyx_t_7 = PyObject_RichCompare(__pyx_v_score, __pyx_t_6, Py_GE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 520, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 520, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       if (__pyx_t_11) {
       } else {
         __pyx_t_9 = __pyx_t_11;
         goto __pyx_L9_bool_binop_done;
       }
       __pyx_t_11 = (!(__pyx_v_result_found != 0));
       if (!__pyx_t_11) {
       } else {
         __pyx_t_9 = __pyx_t_11;
         goto __pyx_L9_bool_binop_done;
       }
-      __pyx_t_7 = PyObject_RichCompare(__pyx_v_score, __pyx_v_result_score, Py_GT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 485, __pyx_L1_error)
-      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 485, __pyx_L1_error)
+      __pyx_t_7 = PyObject_RichCompare(__pyx_v_score, __pyx_v_result_score, Py_GT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 520, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 520, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __pyx_t_9 = __pyx_t_11;
       __pyx_L9_bool_binop_done:;
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":486
+        /* "rapidfuzz/process_cpp_impl.pyx":521
  *         if lowest_score_worst:
  *             if score >= score_cutoff and (not result_found or score > result_score):
  *                 score_cutoff = score             # <<<<<<<<<<<<<<
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score
  */
-        __Pyx_TraceLine(486,0,__PYX_ERR(0, 486, __pyx_L1_error))
-        __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_v_score); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 486, __pyx_L1_error)
+        __Pyx_TraceLine(521,0,__PYX_ERR(0, 521, __pyx_L1_error))
+        __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_v_score); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 521, __pyx_L1_error)
         __pyx_v_score_cutoff = __pyx_t_12;
 
-        /* "rapidfuzz/process_cpp.pyx":487
+        /* "rapidfuzz/process_cpp_impl.pyx":522
  *             if score >= score_cutoff and (not result_found or score > result_score):
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score             # <<<<<<<<<<<<<<
  *                 result_score = score
  *                 result_choice = choice
  */
-        __Pyx_TraceLine(487,0,__PYX_ERR(0, 487, __pyx_L1_error))
+        __Pyx_TraceLine(522,0,__PYX_ERR(0, 522, __pyx_L1_error))
         if (unlikely(__pyx_v_kwargs == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-          __PYX_ERR(0, 487, __pyx_L1_error)
+          __PYX_ERR(0, 522, __pyx_L1_error)
         }
-        if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score) < 0))) __PYX_ERR(0, 487, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score) < 0))) __PYX_ERR(0, 522, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":488
+        /* "rapidfuzz/process_cpp_impl.pyx":523
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_key = choice_key
  */
-        __Pyx_TraceLine(488,0,__PYX_ERR(0, 488, __pyx_L1_error))
+        __Pyx_TraceLine(523,0,__PYX_ERR(0, 523, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_score);
         __Pyx_DECREF_SET(__pyx_v_result_score, __pyx_v_score);
 
-        /* "rapidfuzz/process_cpp.pyx":489
+        /* "rapidfuzz/process_cpp_impl.pyx":524
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_key = choice_key
  *                 result_found = True
  */
-        __Pyx_TraceLine(489,0,__PYX_ERR(0, 489, __pyx_L1_error))
+        __Pyx_TraceLine(524,0,__PYX_ERR(0, 524, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":490
+        /* "rapidfuzz/process_cpp_impl.pyx":525
  *                 result_score = score
  *                 result_choice = choice
  *                 result_key = choice_key             # <<<<<<<<<<<<<<
  *                 result_found = True
  *         else:
  */
-        __Pyx_TraceLine(490,0,__PYX_ERR(0, 490, __pyx_L1_error))
+        __Pyx_TraceLine(525,0,__PYX_ERR(0, 525, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice_key);
         __Pyx_DECREF_SET(__pyx_v_result_key, __pyx_v_choice_key);
 
-        /* "rapidfuzz/process_cpp.pyx":491
+        /* "rapidfuzz/process_cpp_impl.pyx":526
  *                 result_choice = choice
  *                 result_key = choice_key
  *                 result_found = True             # <<<<<<<<<<<<<<
  *         else:
  *             if score <= score_cutoff and (not result_found or score < result_score):
  */
-        __Pyx_TraceLine(491,0,__PYX_ERR(0, 491, __pyx_L1_error))
+        __Pyx_TraceLine(526,0,__PYX_ERR(0, 526, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":485
+        /* "rapidfuzz/process_cpp_impl.pyx":520
  * 
  *         if lowest_score_worst:
  *             if score >= score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":484
+      /* "rapidfuzz/process_cpp_impl.pyx":519
  *             score = scorer(query, choice, **kwargs)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= score_cutoff and (not result_found or score > result_score):
  *                 score_cutoff = score
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":493
+    /* "rapidfuzz/process_cpp_impl.pyx":528
  *                 result_found = True
  *         else:
  *             if score <= score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  */
-    __Pyx_TraceLine(493,0,__PYX_ERR(0, 493, __pyx_L1_error))
+    __Pyx_TraceLine(528,0,__PYX_ERR(0, 528, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 493, __pyx_L1_error)
+      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 528, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_t_7, Py_LE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 493, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_t_7, Py_LE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 528, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 493, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 528, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_11) {
       } else {
         __pyx_t_9 = __pyx_t_11;
         goto __pyx_L13_bool_binop_done;
       }
       __pyx_t_11 = (!(__pyx_v_result_found != 0));
       if (!__pyx_t_11) {
       } else {
         __pyx_t_9 = __pyx_t_11;
         goto __pyx_L13_bool_binop_done;
       }
-      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_v_result_score, Py_LT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 493, __pyx_L1_error)
-      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 493, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_v_result_score, Py_LT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 528, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 528, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_9 = __pyx_t_11;
       __pyx_L13_bool_binop_done:;
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":494
+        /* "rapidfuzz/process_cpp_impl.pyx":529
  *         else:
  *             if score <= score_cutoff and (not result_found or score < result_score):
  *                 score_cutoff = score             # <<<<<<<<<<<<<<
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score
  */
-        __Pyx_TraceLine(494,0,__PYX_ERR(0, 494, __pyx_L1_error))
-        __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_v_score); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 494, __pyx_L1_error)
+        __Pyx_TraceLine(529,0,__PYX_ERR(0, 529, __pyx_L1_error))
+        __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_v_score); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 529, __pyx_L1_error)
         __pyx_v_score_cutoff = __pyx_t_12;
 
-        /* "rapidfuzz/process_cpp.pyx":495
+        /* "rapidfuzz/process_cpp_impl.pyx":530
  *             if score <= score_cutoff and (not result_found or score < result_score):
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score             # <<<<<<<<<<<<<<
  *                 result_score = score
  *                 result_choice = choice
  */
-        __Pyx_TraceLine(495,0,__PYX_ERR(0, 495, __pyx_L1_error))
+        __Pyx_TraceLine(530,0,__PYX_ERR(0, 530, __pyx_L1_error))
         if (unlikely(__pyx_v_kwargs == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-          __PYX_ERR(0, 495, __pyx_L1_error)
+          __PYX_ERR(0, 530, __pyx_L1_error)
         }
-        if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score) < 0))) __PYX_ERR(0, 495, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score) < 0))) __PYX_ERR(0, 530, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":496
+        /* "rapidfuzz/process_cpp_impl.pyx":531
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_key = choice_key
  */
-        __Pyx_TraceLine(496,0,__PYX_ERR(0, 496, __pyx_L1_error))
+        __Pyx_TraceLine(531,0,__PYX_ERR(0, 531, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_score);
         __Pyx_DECREF_SET(__pyx_v_result_score, __pyx_v_score);
 
-        /* "rapidfuzz/process_cpp.pyx":497
+        /* "rapidfuzz/process_cpp_impl.pyx":532
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_key = choice_key
  *                 result_found = True
  */
-        __Pyx_TraceLine(497,0,__PYX_ERR(0, 497, __pyx_L1_error))
+        __Pyx_TraceLine(532,0,__PYX_ERR(0, 532, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":498
+        /* "rapidfuzz/process_cpp_impl.pyx":533
  *                 result_score = score
  *                 result_choice = choice
  *                 result_key = choice_key             # <<<<<<<<<<<<<<
  *                 result_found = True
  * 
  */
-        __Pyx_TraceLine(498,0,__PYX_ERR(0, 498, __pyx_L1_error))
+        __Pyx_TraceLine(533,0,__PYX_ERR(0, 533, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice_key);
         __Pyx_DECREF_SET(__pyx_v_result_key, __pyx_v_choice_key);
 
-        /* "rapidfuzz/process_cpp.pyx":499
+        /* "rapidfuzz/process_cpp_impl.pyx":534
  *                 result_choice = choice
  *                 result_key = choice_key
  *                 result_found = True             # <<<<<<<<<<<<<<
  * 
  *         if score == optimal_score:
  */
-        __Pyx_TraceLine(499,0,__PYX_ERR(0, 499, __pyx_L1_error))
+        __Pyx_TraceLine(534,0,__PYX_ERR(0, 534, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":493
+        /* "rapidfuzz/process_cpp_impl.pyx":528
  *                 result_found = True
  *         else:
  *             if score <= score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  */
       }
     }
     __pyx_L7:;
 
-    /* "rapidfuzz/process_cpp.pyx":501
+    /* "rapidfuzz/process_cpp_impl.pyx":536
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
-    __Pyx_TraceLine(501,0,__PYX_ERR(0, 501, __pyx_L1_error))
-    __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_v_optimal_score, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 501, __pyx_L1_error)
-    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 501, __pyx_L1_error)
+    __Pyx_TraceLine(536,0,__PYX_ERR(0, 536, __pyx_L1_error))
+    __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_v_optimal_score, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 536, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 536, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":502
+      /* "rapidfuzz/process_cpp_impl.pyx":537
  * 
  *         if score == optimal_score:
  *             break             # <<<<<<<<<<<<<<
  * 
  *     return (result_choice, result_score, result_key) if result_choice is not None else None
  */
-      __Pyx_TraceLine(502,0,__PYX_ERR(0, 502, __pyx_L1_error))
+      __Pyx_TraceLine(537,0,__PYX_ERR(0, 537, __pyx_L1_error))
       goto __pyx_L4_break;
 
-      /* "rapidfuzz/process_cpp.pyx":501
+      /* "rapidfuzz/process_cpp_impl.pyx":536
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
     }
     __pyx_L3_continue:;
   }
   __pyx_L4_break:;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":504
+  /* "rapidfuzz/process_cpp_impl.pyx":539
  *             break
  * 
  *     return (result_choice, result_score, result_key) if result_choice is not None else None             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(504,0,__PYX_ERR(0, 504, __pyx_L1_error))
+  __Pyx_TraceLine(539,0,__PYX_ERR(0, 539, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_9 = (__pyx_v_result_choice != Py_None);
   if (__pyx_t_9) {
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 504, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 539, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_v_result_choice);
     __Pyx_GIVEREF(__pyx_v_result_choice);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_result_choice);
     __Pyx_INCREF(__pyx_v_result_score);
     __Pyx_GIVEREF(__pyx_v_result_score);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_result_score);
@@ -8903,52 +9827,52 @@
     __Pyx_INCREF(Py_None);
     __pyx_t_1 = Py_None;
   }
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":468
+  /* "rapidfuzz/process_cpp_impl.pyx":503
  *     return (0, 100)
  * 
  * cdef inline py_extractOne_dict(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef bool result_found = False
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_10);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extractOne_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extractOne_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_result_score);
   __Pyx_XDECREF(__pyx_v_result_choice);
   __Pyx_XDECREF(__pyx_v_result_key);
   __Pyx_XDECREF(__pyx_v_choice_key);
   __Pyx_XDECREF(__pyx_v_choice);
   __Pyx_XDECREF(__pyx_v_score);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":507
+/* "rapidfuzz/process_cpp_impl.pyx":542
  * 
  * 
  * cdef inline py_extractOne_list(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef bool result_found = False
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_py_extractOne_list(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, double __pyx_v_score_cutoff, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score, PyObject *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_py_extractOne_list(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, double __pyx_v_score_cutoff, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score, PyObject *__pyx_v_kwargs) {
   bool __pyx_v_lowest_score_worst;
   bool __pyx_v_result_found;
   int64_t __pyx_v_result_index;
   int64_t __pyx_v_i;
   PyObject *__pyx_v_result_score = NULL;
   PyObject *__pyx_v_result_choice = NULL;
   PyObject *__pyx_v_choice = NULL;
@@ -8968,173 +9892,173 @@
   int __pyx_t_10;
   int __pyx_t_11;
   double __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("py_extractOne_list", 0);
-  __Pyx_TraceCall("py_extractOne_list", __pyx_f[0], 507, 0, __PYX_ERR(0, 507, __pyx_L1_error));
+  __Pyx_TraceCall("py_extractOne_list", __pyx_f[0], 542, 0, __PYX_ERR(0, 542, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":508
+  /* "rapidfuzz/process_cpp_impl.pyx":543
  * 
  * cdef inline py_extractOne_list(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):
  *     cdef bool lowest_score_worst = optimal_score > worst_score             # <<<<<<<<<<<<<<
  *     cdef bool result_found = False
  *     cdef int64_t result_index = 0
  */
-  __Pyx_TraceLine(508,0,__PYX_ERR(0, 508, __pyx_L1_error))
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_optimal_score, __pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 508, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 508, __pyx_L1_error)
+  __Pyx_TraceLine(543,0,__PYX_ERR(0, 543, __pyx_L1_error))
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_optimal_score, __pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 543, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 543, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_lowest_score_worst = __pyx_t_2;
 
-  /* "rapidfuzz/process_cpp.pyx":509
+  /* "rapidfuzz/process_cpp_impl.pyx":544
  * cdef inline py_extractOne_list(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef bool result_found = False             # <<<<<<<<<<<<<<
  *     cdef int64_t result_index = 0
  *     cdef int64_t i
  */
-  __Pyx_TraceLine(509,0,__PYX_ERR(0, 509, __pyx_L1_error))
+  __Pyx_TraceLine(544,0,__PYX_ERR(0, 544, __pyx_L1_error))
   __pyx_v_result_found = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":510
+  /* "rapidfuzz/process_cpp_impl.pyx":545
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef bool result_found = False
  *     cdef int64_t result_index = 0             # <<<<<<<<<<<<<<
  *     cdef int64_t i
  *     result_score = 0
  */
-  __Pyx_TraceLine(510,0,__PYX_ERR(0, 510, __pyx_L1_error))
+  __Pyx_TraceLine(545,0,__PYX_ERR(0, 545, __pyx_L1_error))
   __pyx_v_result_index = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":512
+  /* "rapidfuzz/process_cpp_impl.pyx":547
  *     cdef int64_t result_index = 0
  *     cdef int64_t i
  *     result_score = 0             # <<<<<<<<<<<<<<
  *     result_choice = None
  * 
  */
-  __Pyx_TraceLine(512,0,__PYX_ERR(0, 512, __pyx_L1_error))
+  __Pyx_TraceLine(547,0,__PYX_ERR(0, 547, __pyx_L1_error))
   __Pyx_INCREF(__pyx_int_0);
   __pyx_v_result_score = __pyx_int_0;
 
-  /* "rapidfuzz/process_cpp.pyx":513
+  /* "rapidfuzz/process_cpp_impl.pyx":548
  *     cdef int64_t i
  *     result_score = 0
  *     result_choice = None             # <<<<<<<<<<<<<<
  * 
  *     for i, choice in enumerate(choices):
  */
-  __Pyx_TraceLine(513,0,__PYX_ERR(0, 513, __pyx_L1_error))
+  __Pyx_TraceLine(548,0,__PYX_ERR(0, 548, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_result_choice = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":515
+  /* "rapidfuzz/process_cpp_impl.pyx":550
  *     result_choice = None
  * 
  *     for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *         if choice is None:
  *             continue
  */
-  __Pyx_TraceLine(515,0,__PYX_ERR(0, 515, __pyx_L1_error))
+  __Pyx_TraceLine(550,0,__PYX_ERR(0, 550, __pyx_L1_error))
   __pyx_t_3 = 0;
   if (likely(PyList_CheckExact(__pyx_v_choices)) || PyTuple_CheckExact(__pyx_v_choices)) {
     __pyx_t_1 = __pyx_v_choices; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
     __pyx_t_5 = NULL;
   } else {
-    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_choices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 515, __pyx_L1_error)
+    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_choices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 550, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 515, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 550, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_5)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 515, __pyx_L1_error)
+        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 550, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 515, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 550, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
       } else {
         if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 515, __pyx_L1_error)
+        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 550, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 515, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 550, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
       }
     } else {
       __pyx_t_6 = __pyx_t_5(__pyx_t_1);
       if (unlikely(!__pyx_t_6)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 515, __pyx_L1_error)
+          else __PYX_ERR(0, 550, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_6);
     }
     __Pyx_XDECREF_SET(__pyx_v_choice, __pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_v_i = __pyx_t_3;
     __pyx_t_3 = (__pyx_t_3 + 1);
 
-    /* "rapidfuzz/process_cpp.pyx":516
+    /* "rapidfuzz/process_cpp_impl.pyx":551
  * 
  *     for i, choice in enumerate(choices):
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
-    __Pyx_TraceLine(516,0,__PYX_ERR(0, 516, __pyx_L1_error))
+    __Pyx_TraceLine(551,0,__PYX_ERR(0, 551, __pyx_L1_error))
     __pyx_t_7 = (__pyx_v_choice == Py_None);
     if (__pyx_t_7) {
 
-      /* "rapidfuzz/process_cpp.pyx":517
+      /* "rapidfuzz/process_cpp_impl.pyx":552
  *     for i, choice in enumerate(choices):
  *         if choice is None:
  *             continue             # <<<<<<<<<<<<<<
  * 
  *         if processor is not None:
  */
-      __Pyx_TraceLine(517,0,__PYX_ERR(0, 517, __pyx_L1_error))
+      __Pyx_TraceLine(552,0,__PYX_ERR(0, 552, __pyx_L1_error))
       goto __pyx_L3_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":516
+      /* "rapidfuzz/process_cpp_impl.pyx":551
  * 
  *     for i, choice in enumerate(choices):
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":519
+    /* "rapidfuzz/process_cpp_impl.pyx":554
  *             continue
  * 
  *         if processor is not None:             # <<<<<<<<<<<<<<
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  */
-    __Pyx_TraceLine(519,0,__PYX_ERR(0, 519, __pyx_L1_error))
+    __Pyx_TraceLine(554,0,__PYX_ERR(0, 554, __pyx_L1_error))
     __pyx_t_7 = (__pyx_v_processor != Py_None);
     if (__pyx_t_7) {
 
-      /* "rapidfuzz/process_cpp.pyx":520
+      /* "rapidfuzz/process_cpp_impl.pyx":555
  * 
  *         if processor is not None:
  *             score = scorer(query, processor(choice), **kwargs)             # <<<<<<<<<<<<<<
  *         else:
  *             score = scorer(query, choice, **kwargs)
  */
-      __Pyx_TraceLine(520,0,__PYX_ERR(0, 520, __pyx_L1_error))
+      __Pyx_TraceLine(555,0,__PYX_ERR(0, 555, __pyx_L1_error))
       __Pyx_INCREF(__pyx_v_processor);
       __pyx_t_8 = __pyx_v_processor; __pyx_t_9 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -9144,380 +10068,380 @@
           __pyx_t_10 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_v_choice};
         __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 520, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 555, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       }
-      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 520, __pyx_L1_error)
+      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 555, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_INCREF(__pyx_v_query);
       __Pyx_GIVEREF(__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_query);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_6);
       __pyx_t_6 = 0;
       if (unlikely(__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 520, __pyx_L1_error)
+        __PYX_ERR(0, 555, __pyx_L1_error)
       }
-      __pyx_t_6 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 520, __pyx_L1_error)
+      __pyx_t_6 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 555, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 520, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 555, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_XDECREF_SET(__pyx_v_score, __pyx_t_9);
       __pyx_t_9 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":519
+      /* "rapidfuzz/process_cpp_impl.pyx":554
  *             continue
  * 
  *         if processor is not None:             # <<<<<<<<<<<<<<
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  */
       goto __pyx_L6;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":522
+    /* "rapidfuzz/process_cpp_impl.pyx":557
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  *             score = scorer(query, choice, **kwargs)             # <<<<<<<<<<<<<<
  * 
  *         if lowest_score_worst:
  */
-    __Pyx_TraceLine(522,0,__PYX_ERR(0, 522, __pyx_L1_error))
+    __Pyx_TraceLine(557,0,__PYX_ERR(0, 557, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 522, __pyx_L1_error)
+      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 557, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_INCREF(__pyx_v_query);
       __Pyx_GIVEREF(__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_query);
       __Pyx_INCREF(__pyx_v_choice);
       __Pyx_GIVEREF(__pyx_v_choice);
       PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_v_choice);
       if (unlikely(__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 522, __pyx_L1_error)
+        __PYX_ERR(0, 557, __pyx_L1_error)
       }
-      __pyx_t_6 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 522, __pyx_L1_error)
+      __pyx_t_6 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 557, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 522, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 557, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_XDECREF_SET(__pyx_v_score, __pyx_t_8);
       __pyx_t_8 = 0;
     }
     __pyx_L6:;
 
-    /* "rapidfuzz/process_cpp.pyx":524
+    /* "rapidfuzz/process_cpp_impl.pyx":559
  *             score = scorer(query, choice, **kwargs)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= score_cutoff and (not result_found or score > result_score):
  *                 score_cutoff = score
  */
-    __Pyx_TraceLine(524,0,__PYX_ERR(0, 524, __pyx_L1_error))
+    __Pyx_TraceLine(559,0,__PYX_ERR(0, 559, __pyx_L1_error))
     __pyx_t_7 = (__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_7) {
 
-      /* "rapidfuzz/process_cpp.pyx":525
+      /* "rapidfuzz/process_cpp_impl.pyx":560
  * 
  *         if lowest_score_worst:
  *             if score >= score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  */
-      __Pyx_TraceLine(525,0,__PYX_ERR(0, 525, __pyx_L1_error))
-      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 525, __pyx_L1_error)
+      __Pyx_TraceLine(560,0,__PYX_ERR(0, 560, __pyx_L1_error))
+      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 560, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_t_8, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 525, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_t_8, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 560, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 525, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 560, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_11) {
       } else {
         __pyx_t_7 = __pyx_t_11;
         goto __pyx_L9_bool_binop_done;
       }
       __pyx_t_11 = (!(__pyx_v_result_found != 0));
       if (!__pyx_t_11) {
       } else {
         __pyx_t_7 = __pyx_t_11;
         goto __pyx_L9_bool_binop_done;
       }
-      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_v_result_score, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 525, __pyx_L1_error)
-      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 525, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_v_result_score, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 560, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 560, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __pyx_t_7 = __pyx_t_11;
       __pyx_L9_bool_binop_done:;
       if (__pyx_t_7) {
 
-        /* "rapidfuzz/process_cpp.pyx":526
+        /* "rapidfuzz/process_cpp_impl.pyx":561
  *         if lowest_score_worst:
  *             if score >= score_cutoff and (not result_found or score > result_score):
  *                 score_cutoff = score             # <<<<<<<<<<<<<<
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score
  */
-        __Pyx_TraceLine(526,0,__PYX_ERR(0, 526, __pyx_L1_error))
-        __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_v_score); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 526, __pyx_L1_error)
+        __Pyx_TraceLine(561,0,__PYX_ERR(0, 561, __pyx_L1_error))
+        __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_v_score); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 561, __pyx_L1_error)
         __pyx_v_score_cutoff = __pyx_t_12;
 
-        /* "rapidfuzz/process_cpp.pyx":527
+        /* "rapidfuzz/process_cpp_impl.pyx":562
  *             if score >= score_cutoff and (not result_found or score > result_score):
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score             # <<<<<<<<<<<<<<
  *                 result_score = score
  *                 result_choice = choice
  */
-        __Pyx_TraceLine(527,0,__PYX_ERR(0, 527, __pyx_L1_error))
+        __Pyx_TraceLine(562,0,__PYX_ERR(0, 562, __pyx_L1_error))
         if (unlikely(__pyx_v_kwargs == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-          __PYX_ERR(0, 527, __pyx_L1_error)
+          __PYX_ERR(0, 562, __pyx_L1_error)
         }
-        if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score) < 0))) __PYX_ERR(0, 527, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score) < 0))) __PYX_ERR(0, 562, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":528
+        /* "rapidfuzz/process_cpp_impl.pyx":563
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_index = i
  */
-        __Pyx_TraceLine(528,0,__PYX_ERR(0, 528, __pyx_L1_error))
+        __Pyx_TraceLine(563,0,__PYX_ERR(0, 563, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_score);
         __Pyx_DECREF_SET(__pyx_v_result_score, __pyx_v_score);
 
-        /* "rapidfuzz/process_cpp.pyx":529
+        /* "rapidfuzz/process_cpp_impl.pyx":564
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_index = i
  *                 result_found = True
  */
-        __Pyx_TraceLine(529,0,__PYX_ERR(0, 529, __pyx_L1_error))
+        __Pyx_TraceLine(564,0,__PYX_ERR(0, 564, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":530
+        /* "rapidfuzz/process_cpp_impl.pyx":565
  *                 result_score = score
  *                 result_choice = choice
  *                 result_index = i             # <<<<<<<<<<<<<<
  *                 result_found = True
  *         else:
  */
-        __Pyx_TraceLine(530,0,__PYX_ERR(0, 530, __pyx_L1_error))
+        __Pyx_TraceLine(565,0,__PYX_ERR(0, 565, __pyx_L1_error))
         __pyx_v_result_index = __pyx_v_i;
 
-        /* "rapidfuzz/process_cpp.pyx":531
+        /* "rapidfuzz/process_cpp_impl.pyx":566
  *                 result_choice = choice
  *                 result_index = i
  *                 result_found = True             # <<<<<<<<<<<<<<
  *         else:
  *             if score <= score_cutoff and (not result_found or score < result_score):
  */
-        __Pyx_TraceLine(531,0,__PYX_ERR(0, 531, __pyx_L1_error))
+        __Pyx_TraceLine(566,0,__PYX_ERR(0, 566, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":525
+        /* "rapidfuzz/process_cpp_impl.pyx":560
  * 
  *         if lowest_score_worst:
  *             if score >= score_cutoff and (not result_found or score > result_score):             # <<<<<<<<<<<<<<
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":524
+      /* "rapidfuzz/process_cpp_impl.pyx":559
  *             score = scorer(query, choice, **kwargs)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= score_cutoff and (not result_found or score > result_score):
  *                 score_cutoff = score
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":533
+    /* "rapidfuzz/process_cpp_impl.pyx":568
  *                 result_found = True
  *         else:
  *             if score <= score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  */
-    __Pyx_TraceLine(533,0,__PYX_ERR(0, 533, __pyx_L1_error))
+    __Pyx_TraceLine(568,0,__PYX_ERR(0, 568, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 533, __pyx_L1_error)
+      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 568, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_8 = PyObject_RichCompare(__pyx_v_score, __pyx_t_6, Py_LE); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 533, __pyx_L1_error)
+      __pyx_t_8 = PyObject_RichCompare(__pyx_v_score, __pyx_t_6, Py_LE); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 568, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 533, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 568, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       if (__pyx_t_11) {
       } else {
         __pyx_t_7 = __pyx_t_11;
         goto __pyx_L13_bool_binop_done;
       }
       __pyx_t_11 = (!(__pyx_v_result_found != 0));
       if (!__pyx_t_11) {
       } else {
         __pyx_t_7 = __pyx_t_11;
         goto __pyx_L13_bool_binop_done;
       }
-      __pyx_t_8 = PyObject_RichCompare(__pyx_v_score, __pyx_v_result_score, Py_LT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 533, __pyx_L1_error)
-      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 533, __pyx_L1_error)
+      __pyx_t_8 = PyObject_RichCompare(__pyx_v_score, __pyx_v_result_score, Py_LT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 568, __pyx_L1_error)
+      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 568, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __pyx_t_7 = __pyx_t_11;
       __pyx_L13_bool_binop_done:;
       if (__pyx_t_7) {
 
-        /* "rapidfuzz/process_cpp.pyx":534
+        /* "rapidfuzz/process_cpp_impl.pyx":569
  *         else:
  *             if score <= score_cutoff and (not result_found or score < result_score):
  *                 score_cutoff = score             # <<<<<<<<<<<<<<
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score
  */
-        __Pyx_TraceLine(534,0,__PYX_ERR(0, 534, __pyx_L1_error))
-        __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_v_score); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 534, __pyx_L1_error)
+        __Pyx_TraceLine(569,0,__PYX_ERR(0, 569, __pyx_L1_error))
+        __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_v_score); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 569, __pyx_L1_error)
         __pyx_v_score_cutoff = __pyx_t_12;
 
-        /* "rapidfuzz/process_cpp.pyx":535
+        /* "rapidfuzz/process_cpp_impl.pyx":570
  *             if score <= score_cutoff and (not result_found or score < result_score):
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score             # <<<<<<<<<<<<<<
  *                 result_score = score
  *                 result_choice = choice
  */
-        __Pyx_TraceLine(535,0,__PYX_ERR(0, 535, __pyx_L1_error))
+        __Pyx_TraceLine(570,0,__PYX_ERR(0, 570, __pyx_L1_error))
         if (unlikely(__pyx_v_kwargs == Py_None)) {
           PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-          __PYX_ERR(0, 535, __pyx_L1_error)
+          __PYX_ERR(0, 570, __pyx_L1_error)
         }
-        if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score) < 0))) __PYX_ERR(0, 535, __pyx_L1_error)
+        if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score) < 0))) __PYX_ERR(0, 570, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":536
+        /* "rapidfuzz/process_cpp_impl.pyx":571
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score             # <<<<<<<<<<<<<<
  *                 result_choice = choice
  *                 result_index = i
  */
-        __Pyx_TraceLine(536,0,__PYX_ERR(0, 536, __pyx_L1_error))
+        __Pyx_TraceLine(571,0,__PYX_ERR(0, 571, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_score);
         __Pyx_DECREF_SET(__pyx_v_result_score, __pyx_v_score);
 
-        /* "rapidfuzz/process_cpp.pyx":537
+        /* "rapidfuzz/process_cpp_impl.pyx":572
  *                 kwargs["score_cutoff"] = score
  *                 result_score = score
  *                 result_choice = choice             # <<<<<<<<<<<<<<
  *                 result_index = i
  *                 result_found = True
  */
-        __Pyx_TraceLine(537,0,__PYX_ERR(0, 537, __pyx_L1_error))
+        __Pyx_TraceLine(572,0,__PYX_ERR(0, 572, __pyx_L1_error))
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_DECREF_SET(__pyx_v_result_choice, __pyx_v_choice);
 
-        /* "rapidfuzz/process_cpp.pyx":538
+        /* "rapidfuzz/process_cpp_impl.pyx":573
  *                 result_score = score
  *                 result_choice = choice
  *                 result_index = i             # <<<<<<<<<<<<<<
  *                 result_found = True
  * 
  */
-        __Pyx_TraceLine(538,0,__PYX_ERR(0, 538, __pyx_L1_error))
+        __Pyx_TraceLine(573,0,__PYX_ERR(0, 573, __pyx_L1_error))
         __pyx_v_result_index = __pyx_v_i;
 
-        /* "rapidfuzz/process_cpp.pyx":539
+        /* "rapidfuzz/process_cpp_impl.pyx":574
  *                 result_choice = choice
  *                 result_index = i
  *                 result_found = True             # <<<<<<<<<<<<<<
  * 
  *         if score == optimal_score:
  */
-        __Pyx_TraceLine(539,0,__PYX_ERR(0, 539, __pyx_L1_error))
+        __Pyx_TraceLine(574,0,__PYX_ERR(0, 574, __pyx_L1_error))
         __pyx_v_result_found = 1;
 
-        /* "rapidfuzz/process_cpp.pyx":533
+        /* "rapidfuzz/process_cpp_impl.pyx":568
  *                 result_found = True
  *         else:
  *             if score <= score_cutoff and (not result_found or score < result_score):             # <<<<<<<<<<<<<<
  *                 score_cutoff = score
  *                 kwargs["score_cutoff"] = score
  */
       }
     }
     __pyx_L7:;
 
-    /* "rapidfuzz/process_cpp.pyx":541
+    /* "rapidfuzz/process_cpp_impl.pyx":576
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
-    __Pyx_TraceLine(541,0,__PYX_ERR(0, 541, __pyx_L1_error))
-    __pyx_t_8 = PyObject_RichCompare(__pyx_v_score, __pyx_v_optimal_score, Py_EQ); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 541, __pyx_L1_error)
-    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 541, __pyx_L1_error)
+    __Pyx_TraceLine(576,0,__PYX_ERR(0, 576, __pyx_L1_error))
+    __pyx_t_8 = PyObject_RichCompare(__pyx_v_score, __pyx_v_optimal_score, Py_EQ); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 576, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 576, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     if (__pyx_t_7) {
 
-      /* "rapidfuzz/process_cpp.pyx":542
+      /* "rapidfuzz/process_cpp_impl.pyx":577
  * 
  *         if score == optimal_score:
  *             break             # <<<<<<<<<<<<<<
  * 
  *     return (result_choice, result_score, result_index) if result_choice is not None else None
  */
-      __Pyx_TraceLine(542,0,__PYX_ERR(0, 542, __pyx_L1_error))
+      __Pyx_TraceLine(577,0,__PYX_ERR(0, 577, __pyx_L1_error))
       goto __pyx_L4_break;
 
-      /* "rapidfuzz/process_cpp.pyx":541
+      /* "rapidfuzz/process_cpp_impl.pyx":576
  *                 result_found = True
  * 
  *         if score == optimal_score:             # <<<<<<<<<<<<<<
  *             break
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":515
+    /* "rapidfuzz/process_cpp_impl.pyx":550
  *     result_choice = None
  * 
  *     for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *         if choice is None:
  *             continue
  */
-    __Pyx_TraceLine(515,0,__PYX_ERR(0, 515, __pyx_L1_error))
+    __Pyx_TraceLine(550,0,__PYX_ERR(0, 550, __pyx_L1_error))
     __pyx_L3_continue:;
   }
   __pyx_L4_break:;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":544
+  /* "rapidfuzz/process_cpp_impl.pyx":579
  *             break
  * 
  *     return (result_choice, result_score, result_index) if result_choice is not None else None             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(544,0,__PYX_ERR(0, 544, __pyx_L1_error))
+  __Pyx_TraceLine(579,0,__PYX_ERR(0, 579, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_7 = (__pyx_v_result_choice != Py_None);
   if (__pyx_t_7) {
-    __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_result_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 544, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_result_index); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 579, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 544, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 579, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_INCREF(__pyx_v_result_choice);
     __Pyx_GIVEREF(__pyx_v_result_choice);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_result_choice);
     __Pyx_INCREF(__pyx_v_result_score);
     __Pyx_GIVEREF(__pyx_v_result_score);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_result_score);
@@ -9530,67 +10454,67 @@
     __Pyx_INCREF(Py_None);
     __pyx_t_1 = Py_None;
   }
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":507
+  /* "rapidfuzz/process_cpp_impl.pyx":542
  * 
  * 
  * cdef inline py_extractOne_list(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef bool result_found = False
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_8);
   __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extractOne_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extractOne_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_result_score);
   __Pyx_XDECREF(__pyx_v_result_choice);
   __Pyx_XDECREF(__pyx_v_choice);
   __Pyx_XDECREF(__pyx_v_score);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":547
+/* "rapidfuzz/process_cpp_impl.pyx":582
  * 
  * 
  * def extractOne(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best match in a list of choices. When multiple elements have the same similarity,
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_7__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_9__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 547, 0, __PYX_ERR(0, 547, __pyx_L1_error));
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 582, 0, __PYX_ERR(0, 582, __pyx_L1_error));
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 547, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 582, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_scorer, __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_scorer) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 547, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_scorer, __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_scorer) < 0) __PYX_ERR(0, 582, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 582, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 582, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 582, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
   __pyx_t_1 = 0;
@@ -9598,34 +10522,33 @@
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_1extractOne(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_1extractOne(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_11process_cpp_extractOne, "\n    Find the best match in a list of choices. When multiple elements have the same similarity,\n    the first element is returned.\n\n    Parameters\n    ----------\n    query : Sequence[Hashable]\n        string we want to find\n    choices : Iterable[Sequence[Hashable]] | Mapping[Sequence[Hashable]]\n        list of all strings the query should be compared with or dict with a mapping\n        {<result>: <string to compare>}\n    scorer : Callable, optional\n        Optional callable that is used to calculate the matching score between\n        the query and each choice. This can be any of the scorers included in RapidFuzz\n        (both scorers that calculate the edit distance or the normalized edit distance), or\n        a custom function, which returns a normalized edit distance.\n        fuzz.WRatio is used by default.\n    processor : Callable, optional\n        Optional callable that reformats the strings.\n        utils.default_process is used by default, which lowercases the strings and trims whitespace\n    score_cutoff : Any, optional\n        Optional argument for a score threshold. When an edit distance is used this represents the maximum\n        edit distance and matches with a `distance <= score_cutoff` are ignored. When a\n        normalized edit distance is used this represents the minimal similarity\n        and matches with a `similarity >= score_cutoff` are ignored. Default is None, which deactivates this behaviour.\n    **kwargs : Any, optional\n        any other named parameters are passed to the scorer. This can be used to pass\n        e.g. weights to string_metric.levenshtein\n\n    Returns\n    -------\n    Tuple[Sequence[Hashable], Any, Any]\n        Returns the best match in form of a Tuple with 3 elements. The values stored in the\n        tuple depend on the types of the input arguments.\n\n        * The first element is always the `choice`, which is the value thats compared to the query.\n\n        * The second value represents the ""similarity calculated by the scorer. This can be:\n\n          * An edit distance (distance is 0 for a perfect match and > 0 for non perfect matches).\n            In this case only choices which have a `distance <= score_cutoff` are returned.\n            An example of a scorer with this behavior is `string_metric.levenshtein`.\n          * A normalized edit distance (similarity is a score between 0 and 100, with 100 being a perfect match).\n            In this case only choices which have a `similarity >= score_cutoff` are returned.\n            An example of a scorer with this behavior is `string_metric.normalized_levenshtein`.\n\n          Note, that for all scorers, which are not provided by RapidFuzz, only normalized edit distances are supported.\n\n        * The third parameter depends on the type of the `choices` argument it is:\n\n          * The `index of choice` when choices is a simple iterable like a list\n          * The `key of choice` when choices is a mapping like a dict, or a pandas Series\n\n    None\n        When no choice has a `similarity >= score_cutoff`/`distance <= score_cutoff` None is returned\n\n    Examples\n    --------\n\n    >>> from rapidfuzz.process import extractOne\n    >>> from rapidfuzz.string_metric import levenshtein, normalized_levenshtein\n    >>> from rapidfuzz.fuzz import ratio\n\n    extractOne can be used with normalized edit distances.\n\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=ratio)\n    (\"abcd\", 75.0, 1)\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=normalized_levenshtein)\n    (\"abcd\", 75.0, 1)\n\n    extractOne can be used with edit distances as well.\n\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=levenshtein)\n    (\"abce\", 1, 0)\n\n    additional settings of the scorer can be passed as keyword arguments to extractOne\n\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=levenshtein, weights=(1,1,2))\n    (\"abcde\", 2, 1)\n\n    when a mapping is used for the choices the key of the choice is retu""rned instead of the List index\n\n    >>> extractOne(\"abcd\", {\"key\": \"abce\"}, scorer=ratio)\n    (\"abcd\", 75.0, \"key\")\n\n    By default each string is preprocessed using `utils.default_process`, which lowercases the strings,\n    replaces non alphanumeric characters with whitespaces and trims whitespaces from start and end of them.\n    This behavior can be changed by passing a custom function, or None to disable the behavior. Preprocessing\n    can take a significant part of the runtime, so it makes sense to disable it, when it is not required.\n\n\n    >>> extractOne(\"abcd\", [\"abdD\"], scorer=ratio)\n    (\"abcD\", 100.0, 0)\n    >>> extractOne(\"abcd\", [\"abdD\"], scorer=ratio, processor=None)\n    (\"abcD\", 75.0, 0)\n    >>> extractOne(\"abcd\", [\"abdD\"], scorer=ratio, processor=lambda s: s.upper())\n    (\"abcD\", 100.0, 0)\n\n    When only results with a similarity above a certain threshold are relevant, the parameter score_cutoff can be\n    used to filter out results with a lower similarity. This threshold is used by some of the scorers to exit early,\n    when they are sure, that the similarity is below the threshold.\n    For normalized edit distances all results with a similarity below score_cutoff are filtered out\n\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=ratio)\n    (\"abce\", 75.0, 0)\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=ratio, score_cutoff=80)\n    None\n\n    For edit distances all results with an edit distance above the score_cutoff are filtered out\n\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=levenshtein, weights=(1,1,2))\n    (\"abce\", 2, 0)\n    >>> extractOne(\"abcd\", [\"abce\"], scorer=levenshtein, weights=(1,1,2), score_cutoff=1)\n    None\n\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_1extractOne = {"extractOne", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_11process_cpp_1extractOne, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_11process_cpp_extractOne};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_1extractOne(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_1extractOne = {"extractOne", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_1extractOne, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_1extractOne(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_query = 0;
@@ -9667,35 +10590,35 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_query)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 547, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 582, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_choices)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 547, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 582, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("extractOne", 1, 2, 2, 1); __PYX_ERR(0, 547, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("extractOne", 1, 2, 2, 1); __PYX_ERR(0, 582, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && (kw_args <= 3)) {
         Py_ssize_t index;
         for (index = 2; index < 5 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 547, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 582, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kwargs, values + 0, kwd_pos_args, "extractOne") < 0)) __PYX_ERR(0, 547, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kwargs, values + 0, kwd_pos_args, "extractOne") < 0)) __PYX_ERR(0, 582, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
@@ -9703,30 +10626,30 @@
     __pyx_v_choices = values[1];
     __pyx_v_scorer = values[2];
     __pyx_v_processor = values[3];
     __pyx_v_score_cutoff = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("extractOne", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 547, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("extractOne", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 582, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_DECREF(__pyx_v_kwargs); __pyx_v_kwargs = 0;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extractOne", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extractOne", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_11process_cpp_extractOne(__pyx_self, __pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs);
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_extractOne(__pyx_self, __pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs);
 
   /* function exit code */
   __Pyx_DECREF(__pyx_v_kwargs);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_extractOne(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs) {
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_extractOne(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs) {
   RF_Scorer *__pyx_v_scorer_context;
   RF_ScorerFlags __pyx_v_scorer_flags;
   PyObject *__pyx_v_scorer_capsule = NULL;
   RF_KwargsWrapper __pyx_v_kwargs_context;
   PyObject *__pyx_v_worst_score = NULL;
   PyObject *__pyx_v_optimal_score = NULL;
   PyObject *__pyx_r = NULL;
@@ -9744,146 +10667,146 @@
   PyObject *(*__pyx_t_10)(PyObject *);
   double __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_TraceFrameInit(__pyx_codeobj__3)
   __Pyx_RefNannySetupContext("extractOne", 0);
-  __Pyx_TraceCall("extractOne", __pyx_f[0], 547, 0, __PYX_ERR(0, 547, __pyx_L1_error));
+  __Pyx_TraceCall("extractOne", __pyx_f[0], 582, 0, __PYX_ERR(0, 582, __pyx_L1_error));
   __Pyx_INCREF(__pyx_v_query);
   __Pyx_INCREF(__pyx_v_processor);
   __Pyx_INCREF(__pyx_v_score_cutoff);
 
-  /* "rapidfuzz/process_cpp.pyx":664
+  /* "rapidfuzz/process_cpp_impl.pyx":583
  * 
- *     """
+ * def extractOne(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):
  *     cdef RF_Scorer* scorer_context = NULL             # <<<<<<<<<<<<<<
  *     cdef RF_ScorerFlags scorer_flags
  * 
  */
-  __Pyx_TraceLine(664,0,__PYX_ERR(0, 664, __pyx_L1_error))
+  __Pyx_TraceLine(583,0,__PYX_ERR(0, 583, __pyx_L1_error))
   __pyx_v_scorer_context = NULL;
 
-  /* "rapidfuzz/process_cpp.pyx":667
+  /* "rapidfuzz/process_cpp_impl.pyx":586
  *     cdef RF_ScorerFlags scorer_flags
  * 
  *     if query is None:             # <<<<<<<<<<<<<<
  *         return None
  * 
  */
-  __Pyx_TraceLine(667,0,__PYX_ERR(0, 667, __pyx_L1_error))
+  __Pyx_TraceLine(586,0,__PYX_ERR(0, 586, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_query == Py_None);
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":668
+    /* "rapidfuzz/process_cpp_impl.pyx":587
  * 
  *     if query is None:
  *         return None             # <<<<<<<<<<<<<<
  * 
  *     if processor is True:
  */
-    __Pyx_TraceLine(668,0,__PYX_ERR(0, 668, __pyx_L1_error))
+    __Pyx_TraceLine(587,0,__PYX_ERR(0, 587, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":667
+    /* "rapidfuzz/process_cpp_impl.pyx":586
  *     cdef RF_ScorerFlags scorer_flags
  * 
  *     if query is None:             # <<<<<<<<<<<<<<
  *         return None
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":670
+  /* "rapidfuzz/process_cpp_impl.pyx":589
  *         return None
  * 
  *     if processor is True:             # <<<<<<<<<<<<<<
  *         # todo: deprecate this
  *         processor = default_process
  */
-  __Pyx_TraceLine(670,0,__PYX_ERR(0, 670, __pyx_L1_error))
+  __Pyx_TraceLine(589,0,__PYX_ERR(0, 589, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_processor == Py_True);
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":672
+    /* "rapidfuzz/process_cpp_impl.pyx":591
  *     if processor is True:
  *         # todo: deprecate this
  *         processor = default_process             # <<<<<<<<<<<<<<
  *     elif processor is False:
  *         processor = None
  */
-    __Pyx_TraceLine(672,0,__PYX_ERR(0, 672, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 672, __pyx_L1_error)
+    __Pyx_TraceLine(591,0,__PYX_ERR(0, 591, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 591, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF_SET(__pyx_v_processor, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":670
+    /* "rapidfuzz/process_cpp_impl.pyx":589
  *         return None
  * 
  *     if processor is True:             # <<<<<<<<<<<<<<
  *         # todo: deprecate this
  *         processor = default_process
  */
     goto __pyx_L4;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":673
+  /* "rapidfuzz/process_cpp_impl.pyx":592
  *         # todo: deprecate this
  *         processor = default_process
  *     elif processor is False:             # <<<<<<<<<<<<<<
  *         processor = None
  * 
  */
-  __Pyx_TraceLine(673,0,__PYX_ERR(0, 673, __pyx_L1_error))
+  __Pyx_TraceLine(592,0,__PYX_ERR(0, 592, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_processor == Py_False);
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":674
+    /* "rapidfuzz/process_cpp_impl.pyx":593
  *         processor = default_process
  *     elif processor is False:
  *         processor = None             # <<<<<<<<<<<<<<
  * 
  *     # preprocess the query
  */
-    __Pyx_TraceLine(674,0,__PYX_ERR(0, 674, __pyx_L1_error))
+    __Pyx_TraceLine(593,0,__PYX_ERR(0, 593, __pyx_L1_error))
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_processor, Py_None);
 
-    /* "rapidfuzz/process_cpp.pyx":673
+    /* "rapidfuzz/process_cpp_impl.pyx":592
  *         # todo: deprecate this
  *         processor = default_process
  *     elif processor is False:             # <<<<<<<<<<<<<<
  *         processor = None
  * 
  */
   }
   __pyx_L4:;
 
-  /* "rapidfuzz/process_cpp.pyx":677
+  /* "rapidfuzz/process_cpp_impl.pyx":596
  * 
  *     # preprocess the query
  *     if callable(processor):             # <<<<<<<<<<<<<<
  *         query = processor(query)
  * 
  */
-  __Pyx_TraceLine(677,0,__PYX_ERR(0, 677, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyCallable_Check(__pyx_v_processor); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 677, __pyx_L1_error)
+  __Pyx_TraceLine(596,0,__PYX_ERR(0, 596, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyCallable_Check(__pyx_v_processor); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 596, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":678
+    /* "rapidfuzz/process_cpp_impl.pyx":597
  *     # preprocess the query
  *     if callable(processor):
  *         query = processor(query)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-    __Pyx_TraceLine(678,0,__PYX_ERR(0, 678, __pyx_L1_error))
+    __Pyx_TraceLine(597,0,__PYX_ERR(0, 597, __pyx_L1_error))
     __Pyx_INCREF(__pyx_v_processor);
     __pyx_t_3 = __pyx_v_processor; __pyx_t_4 = NULL;
     __pyx_t_5 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -9893,406 +10816,406 @@
         __pyx_t_5 = 1;
       }
     }
     {
       PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_query};
       __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 678, __pyx_L1_error)
+      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 597, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     }
     __Pyx_DECREF_SET(__pyx_v_query, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":677
+    /* "rapidfuzz/process_cpp_impl.pyx":596
  * 
  *     # preprocess the query
  *     if callable(processor):             # <<<<<<<<<<<<<<
  *         query = processor(query)
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":681
+  /* "rapidfuzz/process_cpp_impl.pyx":600
  * 
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)             # <<<<<<<<<<<<<<
  *     if PyCapsule_IsValid(scorer_capsule, NULL):
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  */
-  __Pyx_TraceLine(681,0,__PYX_ERR(0, 681, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_scorer, __pyx_n_u_RF_Scorer, __pyx_v_scorer); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 681, __pyx_L1_error)
+  __Pyx_TraceLine(600,0,__PYX_ERR(0, 600, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_scorer, __pyx_n_u_RF_Scorer, __pyx_v_scorer); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 600, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_scorer_capsule = __pyx_t_2;
   __pyx_t_2 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":682
+  /* "rapidfuzz/process_cpp_impl.pyx":601
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  *     if PyCapsule_IsValid(scorer_capsule, NULL):             # <<<<<<<<<<<<<<
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  */
-  __Pyx_TraceLine(682,0,__PYX_ERR(0, 682, __pyx_L1_error))
+  __Pyx_TraceLine(601,0,__PYX_ERR(0, 601, __pyx_L1_error))
   __pyx_t_1 = PyCapsule_IsValid(__pyx_v_scorer_capsule, NULL);
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":683
+    /* "rapidfuzz/process_cpp_impl.pyx":602
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  *     if PyCapsule_IsValid(scorer_capsule, NULL):
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:
  */
-    __Pyx_TraceLine(683,0,__PYX_ERR(0, 683, __pyx_L1_error))
-    __pyx_t_6 = PyCapsule_GetPointer(__pyx_v_scorer_capsule, NULL); if (unlikely(__pyx_t_6 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 683, __pyx_L1_error)
+    __Pyx_TraceLine(602,0,__PYX_ERR(0, 602, __pyx_L1_error))
+    __pyx_t_6 = PyCapsule_GetPointer(__pyx_v_scorer_capsule, NULL); if (unlikely(__pyx_t_6 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 602, __pyx_L1_error)
     __pyx_v_scorer_context = ((RF_Scorer *)__pyx_t_6);
 
-    /* "rapidfuzz/process_cpp.pyx":682
+    /* "rapidfuzz/process_cpp_impl.pyx":601
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  *     if PyCapsule_IsValid(scorer_capsule, NULL):             # <<<<<<<<<<<<<<
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":685
+  /* "rapidfuzz/process_cpp_impl.pyx":604
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:             # <<<<<<<<<<<<<<
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  */
-  __Pyx_TraceLine(685,0,__PYX_ERR(0, 685, __pyx_L1_error))
+  __Pyx_TraceLine(604,0,__PYX_ERR(0, 604, __pyx_L1_error))
   __pyx_t_7 = (__pyx_v_scorer_context != 0);
   if (__pyx_t_7) {
   } else {
     __pyx_t_1 = __pyx_t_7;
     goto __pyx_L8_bool_binop_done;
   }
   __pyx_t_7 = ((*__pyx_v_scorer_context).version == 1);
   __pyx_t_1 = __pyx_t_7;
   __pyx_L8_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":686
+    /* "rapidfuzz/process_cpp_impl.pyx":605
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:
  *         kwargs_context = RF_KwargsWrapper()             # <<<<<<<<<<<<<<
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  */
-    __Pyx_TraceLine(686,0,__PYX_ERR(0, 686, __pyx_L1_error))
+    __Pyx_TraceLine(605,0,__PYX_ERR(0, 605, __pyx_L1_error))
     __pyx_v_kwargs_context = RF_KwargsWrapper();
 
-    /* "rapidfuzz/process_cpp.pyx":687
+    /* "rapidfuzz/process_cpp_impl.pyx":606
  *     if scorer_context and dereference(scorer_context).version == 1:
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)             # <<<<<<<<<<<<<<
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  * 
  */
-    __Pyx_TraceLine(687,0,__PYX_ERR(0, 687, __pyx_L1_error))
-    __pyx_t_8 = (*__pyx_v_scorer_context).kwargs_init((&__pyx_v_kwargs_context.kwargs), __pyx_v_kwargs); if (unlikely(__pyx_t_8 == ((bool)0))) __PYX_ERR(0, 687, __pyx_L1_error)
+    __Pyx_TraceLine(606,0,__PYX_ERR(0, 606, __pyx_L1_error))
+    __pyx_t_8 = (*__pyx_v_scorer_context).kwargs_init((&__pyx_v_kwargs_context.kwargs), __pyx_v_kwargs); if (unlikely(__pyx_t_8 == ((bool)0))) __PYX_ERR(0, 606, __pyx_L1_error)
 
-    /* "rapidfuzz/process_cpp.pyx":688
+    /* "rapidfuzz/process_cpp_impl.pyx":607
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *         if hasattr(choices, "items"):
  */
-    __Pyx_TraceLine(688,0,__PYX_ERR(0, 688, __pyx_L1_error))
-    __pyx_t_8 = (*__pyx_v_scorer_context).get_scorer_flags((&__pyx_v_kwargs_context.kwargs), (&__pyx_v_scorer_flags)); if (unlikely(__pyx_t_8 == ((bool)0))) __PYX_ERR(0, 688, __pyx_L1_error)
+    __Pyx_TraceLine(607,0,__PYX_ERR(0, 607, __pyx_L1_error))
+    __pyx_t_8 = (*__pyx_v_scorer_context).get_scorer_flags((&__pyx_v_kwargs_context.kwargs), (&__pyx_v_scorer_flags)); if (unlikely(__pyx_t_8 == ((bool)0))) __PYX_ERR(0, 607, __pyx_L1_error)
 
-    /* "rapidfuzz/process_cpp.pyx":690
+    /* "rapidfuzz/process_cpp_impl.pyx":609
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  * 
  *         if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *             return extractOne_dict(query, choices, scorer_context, &scorer_flags,
  *                 processor, score_cutoff, &kwargs_context.kwargs)
  */
-    __Pyx_TraceLine(690,0,__PYX_ERR(0, 690, __pyx_L1_error))
-    __pyx_t_1 = __Pyx_HasAttr(__pyx_v_choices, __pyx_n_u_items); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 690, __pyx_L1_error)
+    __Pyx_TraceLine(609,0,__PYX_ERR(0, 609, __pyx_L1_error))
+    __pyx_t_1 = __Pyx_HasAttr(__pyx_v_choices, __pyx_n_u_items); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 609, __pyx_L1_error)
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":691
+      /* "rapidfuzz/process_cpp_impl.pyx":610
  * 
  *         if hasattr(choices, "items"):
  *             return extractOne_dict(query, choices, scorer_context, &scorer_flags,             # <<<<<<<<<<<<<<
  *                 processor, score_cutoff, &kwargs_context.kwargs)
  *         else:
  */
-      __Pyx_TraceLine(691,0,__PYX_ERR(0, 691, __pyx_L1_error))
+      __Pyx_TraceLine(610,0,__PYX_ERR(0, 610, __pyx_L1_error))
       __Pyx_XDECREF(__pyx_r);
 
-      /* "rapidfuzz/process_cpp.pyx":692
+      /* "rapidfuzz/process_cpp_impl.pyx":611
  *         if hasattr(choices, "items"):
  *             return extractOne_dict(query, choices, scorer_context, &scorer_flags,
  *                 processor, score_cutoff, &kwargs_context.kwargs)             # <<<<<<<<<<<<<<
  *         else:
  *             return extractOne_list(query, choices, scorer_context, &scorer_flags,
  */
-      __Pyx_TraceLine(692,0,__PYX_ERR(0, 692, __pyx_L1_error))
-      __pyx_t_2 = __pyx_f_9rapidfuzz_11process_cpp_extractOne_dict(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer_context, (&__pyx_v_scorer_flags), __pyx_v_processor, __pyx_v_score_cutoff, (&__pyx_v_kwargs_context.kwargs)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 691, __pyx_L1_error)
+      __Pyx_TraceLine(611,0,__PYX_ERR(0, 611, __pyx_L1_error))
+      __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_dict(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer_context, (&__pyx_v_scorer_flags), __pyx_v_processor, __pyx_v_score_cutoff, (&__pyx_v_kwargs_context.kwargs)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 610, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_r = __pyx_t_2;
       __pyx_t_2 = 0;
       goto __pyx_L0;
 
-      /* "rapidfuzz/process_cpp.pyx":690
+      /* "rapidfuzz/process_cpp_impl.pyx":609
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  * 
  *         if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *             return extractOne_dict(query, choices, scorer_context, &scorer_flags,
  *                 processor, score_cutoff, &kwargs_context.kwargs)
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":694
+    /* "rapidfuzz/process_cpp_impl.pyx":613
  *                 processor, score_cutoff, &kwargs_context.kwargs)
  *         else:
  *             return extractOne_list(query, choices, scorer_context, &scorer_flags,             # <<<<<<<<<<<<<<
  *                 processor, score_cutoff, &kwargs_context.kwargs)
  * 
  */
-    __Pyx_TraceLine(694,0,__PYX_ERR(0, 694, __pyx_L1_error))
+    __Pyx_TraceLine(613,0,__PYX_ERR(0, 613, __pyx_L1_error))
     /*else*/ {
       __Pyx_XDECREF(__pyx_r);
 
-      /* "rapidfuzz/process_cpp.pyx":695
+      /* "rapidfuzz/process_cpp_impl.pyx":614
  *         else:
  *             return extractOne_list(query, choices, scorer_context, &scorer_flags,
  *                 processor, score_cutoff, &kwargs_context.kwargs)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-      __Pyx_TraceLine(695,0,__PYX_ERR(0, 695, __pyx_L1_error))
-      __pyx_t_2 = __pyx_f_9rapidfuzz_11process_cpp_extractOne_list(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer_context, (&__pyx_v_scorer_flags), __pyx_v_processor, __pyx_v_score_cutoff, (&__pyx_v_kwargs_context.kwargs)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 694, __pyx_L1_error)
+      __Pyx_TraceLine(614,0,__PYX_ERR(0, 614, __pyx_L1_error))
+      __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_extractOne_list(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer_context, (&__pyx_v_scorer_flags), __pyx_v_processor, __pyx_v_score_cutoff, (&__pyx_v_kwargs_context.kwargs)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 613, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __pyx_r = __pyx_t_2;
       __pyx_t_2 = 0;
       goto __pyx_L0;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":685
+    /* "rapidfuzz/process_cpp_impl.pyx":604
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:             # <<<<<<<<<<<<<<
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":698
+  /* "rapidfuzz/process_cpp_impl.pyx":617
  * 
  * 
  *     worst_score, optimal_score = get_scorer_flags_py(scorer, kwargs)             # <<<<<<<<<<<<<<
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:
  */
-  __Pyx_TraceLine(698,0,__PYX_ERR(0, 698, __pyx_L1_error))
-  __pyx_t_2 = __pyx_f_9rapidfuzz_11process_cpp_get_scorer_flags_py(__pyx_v_scorer, __pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 698, __pyx_L1_error)
+  __Pyx_TraceLine(617,0,__PYX_ERR(0, 617, __pyx_L1_error))
+  __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_get_scorer_flags_py(__pyx_v_scorer, __pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 617, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
     PyObject* sequence = __pyx_t_2;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 698, __pyx_L1_error)
+      __PYX_ERR(0, 617, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_t_4);
     #else
-    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 698, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 617, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 698, __pyx_L1_error)
+    __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 617, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     #endif
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_9 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 698, __pyx_L1_error)
+    __pyx_t_9 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 617, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_9);
     index = 0; __pyx_t_3 = __pyx_t_10(__pyx_t_9); if (unlikely(!__pyx_t_3)) goto __pyx_L11_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_3);
     index = 1; __pyx_t_4 = __pyx_t_10(__pyx_t_9); if (unlikely(!__pyx_t_4)) goto __pyx_L11_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_4);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_9), 2) < 0) __PYX_ERR(0, 698, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_9), 2) < 0) __PYX_ERR(0, 617, __pyx_L1_error)
     __pyx_t_10 = NULL;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     goto __pyx_L12_unpacking_done;
     __pyx_L11_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_t_10 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 698, __pyx_L1_error)
+    __PYX_ERR(0, 617, __pyx_L1_error)
     __pyx_L12_unpacking_done:;
   }
   __pyx_v_worst_score = __pyx_t_3;
   __pyx_t_3 = 0;
   __pyx_v_optimal_score = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":700
+  /* "rapidfuzz/process_cpp_impl.pyx":619
  *     worst_score, optimal_score = get_scorer_flags_py(scorer, kwargs)
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:             # <<<<<<<<<<<<<<
  *         score_cutoff = worst_score
  * 
  */
-  __Pyx_TraceLine(700,0,__PYX_ERR(0, 700, __pyx_L1_error))
+  __Pyx_TraceLine(619,0,__PYX_ERR(0, 619, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_score_cutoff == Py_None);
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":701
+    /* "rapidfuzz/process_cpp_impl.pyx":620
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:
  *         score_cutoff = worst_score             # <<<<<<<<<<<<<<
  * 
  *     kwargs["processor"] = None
  */
-    __Pyx_TraceLine(701,0,__PYX_ERR(0, 701, __pyx_L1_error))
+    __Pyx_TraceLine(620,0,__PYX_ERR(0, 620, __pyx_L1_error))
     __Pyx_INCREF(__pyx_v_worst_score);
     __Pyx_DECREF_SET(__pyx_v_score_cutoff, __pyx_v_worst_score);
 
-    /* "rapidfuzz/process_cpp.pyx":700
+    /* "rapidfuzz/process_cpp_impl.pyx":619
  *     worst_score, optimal_score = get_scorer_flags_py(scorer, kwargs)
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:             # <<<<<<<<<<<<<<
  *         score_cutoff = worst_score
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":703
+  /* "rapidfuzz/process_cpp_impl.pyx":622
  *         score_cutoff = worst_score
  * 
  *     kwargs["processor"] = None             # <<<<<<<<<<<<<<
  *     kwargs["score_cutoff"] = score_cutoff
  * 
  */
-  __Pyx_TraceLine(703,0,__PYX_ERR(0, 703, __pyx_L1_error))
-  if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_processor, Py_None) < 0))) __PYX_ERR(0, 703, __pyx_L1_error)
+  __Pyx_TraceLine(622,0,__PYX_ERR(0, 622, __pyx_L1_error))
+  if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_processor, Py_None) < 0))) __PYX_ERR(0, 622, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":704
+  /* "rapidfuzz/process_cpp_impl.pyx":623
  * 
  *     kwargs["processor"] = None
  *     kwargs["score_cutoff"] = score_cutoff             # <<<<<<<<<<<<<<
  * 
  *     if hasattr(choices, "items"):
  */
-  __Pyx_TraceLine(704,0,__PYX_ERR(0, 704, __pyx_L1_error))
-  if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score_cutoff) < 0))) __PYX_ERR(0, 704, __pyx_L1_error)
+  __Pyx_TraceLine(623,0,__PYX_ERR(0, 623, __pyx_L1_error))
+  if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score_cutoff) < 0))) __PYX_ERR(0, 623, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":706
+  /* "rapidfuzz/process_cpp_impl.pyx":625
  *     kwargs["score_cutoff"] = score_cutoff
  * 
  *     if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *         return py_extractOne_dict(query, choices, scorer, processor, score_cutoff, worst_score, optimal_score, kwargs)
  *     else:
  */
-  __Pyx_TraceLine(706,0,__PYX_ERR(0, 706, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_HasAttr(__pyx_v_choices, __pyx_n_u_items); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 706, __pyx_L1_error)
+  __Pyx_TraceLine(625,0,__PYX_ERR(0, 625, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_HasAttr(__pyx_v_choices, __pyx_n_u_items); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 625, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":707
+    /* "rapidfuzz/process_cpp_impl.pyx":626
  * 
  *     if hasattr(choices, "items"):
  *         return py_extractOne_dict(query, choices, scorer, processor, score_cutoff, worst_score, optimal_score, kwargs)             # <<<<<<<<<<<<<<
  *     else:
  *         return py_extractOne_list(query, choices, scorer, processor, score_cutoff, worst_score, optimal_score, kwargs)
  */
-    __Pyx_TraceLine(707,0,__PYX_ERR(0, 707, __pyx_L1_error))
+    __Pyx_TraceLine(626,0,__PYX_ERR(0, 626, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 707, __pyx_L1_error)
-    __pyx_t_2 = __pyx_f_9rapidfuzz_11process_cpp_py_extractOne_dict(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_t_11, __pyx_v_worst_score, __pyx_v_optimal_score, __pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 707, __pyx_L1_error)
+    __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 626, __pyx_L1_error)
+    __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_py_extractOne_dict(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_t_11, __pyx_v_worst_score, __pyx_v_optimal_score, __pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 626, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_r = __pyx_t_2;
     __pyx_t_2 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":706
+    /* "rapidfuzz/process_cpp_impl.pyx":625
  *     kwargs["score_cutoff"] = score_cutoff
  * 
  *     if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *         return py_extractOne_dict(query, choices, scorer, processor, score_cutoff, worst_score, optimal_score, kwargs)
  *     else:
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":709
+  /* "rapidfuzz/process_cpp_impl.pyx":628
  *         return py_extractOne_dict(query, choices, scorer, processor, score_cutoff, worst_score, optimal_score, kwargs)
  *     else:
  *         return py_extractOne_list(query, choices, scorer, processor, score_cutoff, worst_score, optimal_score, kwargs)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(709,0,__PYX_ERR(0, 709, __pyx_L1_error))
+  __Pyx_TraceLine(628,0,__PYX_ERR(0, 628, __pyx_L1_error))
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 709, __pyx_L1_error)
-    __pyx_t_2 = __pyx_f_9rapidfuzz_11process_cpp_py_extractOne_list(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_t_11, __pyx_v_worst_score, __pyx_v_optimal_score, __pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 709, __pyx_L1_error)
+    __pyx_t_11 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_11 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 628, __pyx_L1_error)
+    __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_py_extractOne_list(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_t_11, __pyx_v_worst_score, __pyx_v_optimal_score, __pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 628, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_r = __pyx_t_2;
     __pyx_t_2 = 0;
     goto __pyx_L0;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":547
+  /* "rapidfuzz/process_cpp_impl.pyx":582
  * 
  * 
  * def extractOne(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best match in a list of choices. When multiple elements have the same similarity,
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extractOne", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extractOne", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_scorer_capsule);
   __Pyx_XDECREF(__pyx_v_worst_score);
   __Pyx_XDECREF(__pyx_v_optimal_score);
   __Pyx_XDECREF(__pyx_v_query);
   __Pyx_XDECREF(__pyx_v_processor);
   __Pyx_XDECREF(__pyx_v_score_cutoff);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":712
+/* "rapidfuzz/process_cpp_impl.pyx":631
  * 
  * 
  * cdef inline extract_dict_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_dict(choices, processor)
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_dict_f64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_dict_f64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   RF_StringWrapper __pyx_v_proc_query;
   std::vector<DictStringElem>  __pyx_v_proc_choices;
   std::vector<DictMatchElem<double> >  __pyx_v_results;
   PyObject *__pyx_v_result_list = NULL;
   int64_t __pyx_v_i;
   PyObject *__pyx_v_result_item = NULL;
   PyObject *__pyx_r = NULL;
@@ -10310,281 +11233,281 @@
   PyObject *__pyx_t_10;
   PyObject *__pyx_t_11;
   PyObject *__pyx_t_12 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_dict_f64", 0);
-  __Pyx_TraceCall("extract_dict_f64", __pyx_f[0], 712, 0, __PYX_ERR(0, 712, __pyx_L1_error));
+  __Pyx_TraceCall("extract_dict_f64", __pyx_f[0], 631, 0, __PYX_ERR(0, 631, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":713
+  /* "rapidfuzz/process_cpp_impl.pyx":632
  * 
  * cdef inline extract_dict_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))             # <<<<<<<<<<<<<<
  *     proc_choices = preprocess_dict(choices, processor)
  * 
  */
-  __Pyx_TraceLine(713,0,__PYX_ERR(0, 713, __pyx_L1_error))
-  __pyx_t_1 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 713, __pyx_L1_error)
+  __Pyx_TraceLine(632,0,__PYX_ERR(0, 632, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 632, __pyx_L1_error)
   __pyx_v_proc_query = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_1));
 
-  /* "rapidfuzz/process_cpp.pyx":714
+  /* "rapidfuzz/process_cpp_impl.pyx":633
  * cdef inline extract_dict_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_dict(choices, processor)             # <<<<<<<<<<<<<<
  * 
  *     cdef vector[DictMatchElem[double]] results = extract_dict_impl[double](
  */
-  __Pyx_TraceLine(714,0,__PYX_ERR(0, 714, __pyx_L1_error))
-  __pyx_t_2 = __pyx_f_9rapidfuzz_11process_cpp_preprocess_dict(__pyx_v_choices, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 714, __pyx_L1_error)
+  __Pyx_TraceLine(633,0,__PYX_ERR(0, 633, __pyx_L1_error))
+  __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_dict(__pyx_v_choices, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 633, __pyx_L1_error)
   __pyx_v_proc_choices = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_2);
 
-  /* "rapidfuzz/process_cpp.pyx":718
+  /* "rapidfuzz/process_cpp_impl.pyx":637
  *     cdef vector[DictMatchElem[double]] results = extract_dict_impl[double](
  *         kwargs, scorer_flags, scorer, proc_query, proc_choices,
  *         get_score_cutoff_f64(score_cutoff, scorer_flags))             # <<<<<<<<<<<<<<
  * 
  *     # due to score_cutoff not always completely filled
  */
-  __Pyx_TraceLine(718,0,__PYX_ERR(0, 718, __pyx_L1_error))
-  __pyx_t_3 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_3 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 718, __pyx_L1_error)
+  __Pyx_TraceLine(637,0,__PYX_ERR(0, 637, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_3 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 637, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":716
+  /* "rapidfuzz/process_cpp_impl.pyx":635
  *     proc_choices = preprocess_dict(choices, processor)
  * 
  *     cdef vector[DictMatchElem[double]] results = extract_dict_impl[double](             # <<<<<<<<<<<<<<
  *         kwargs, scorer_flags, scorer, proc_query, proc_choices,
  *         get_score_cutoff_f64(score_cutoff, scorer_flags))
  */
-  __Pyx_TraceLine(716,0,__PYX_ERR(0, 716, __pyx_L1_error))
+  __Pyx_TraceLine(635,0,__PYX_ERR(0, 635, __pyx_L1_error))
   try {
     __pyx_t_4 = extract_dict_impl<double>(__pyx_v_kwargs, __pyx_v_scorer_flags, __pyx_v_scorer, __pyx_v_proc_query, __pyx_v_proc_choices, __pyx_t_3);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 716, __pyx_L1_error)
+    __PYX_ERR(0, 635, __pyx_L1_error)
   }
   __pyx_v_results = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_4);
 
-  /* "rapidfuzz/process_cpp.pyx":721
+  /* "rapidfuzz/process_cpp_impl.pyx":640
  * 
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         limit = <int64_t>results.size()
  * 
  */
-  __Pyx_TraceLine(721,0,__PYX_ERR(0, 721, __pyx_L1_error))
+  __Pyx_TraceLine(640,0,__PYX_ERR(0, 640, __pyx_L1_error))
   __pyx_t_5 = (__pyx_v_limit > ((int64_t)__pyx_v_results.size()));
   if (__pyx_t_5) {
 
-    /* "rapidfuzz/process_cpp.pyx":722
+    /* "rapidfuzz/process_cpp_impl.pyx":641
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():
  *         limit = <int64_t>results.size()             # <<<<<<<<<<<<<<
  * 
  *     if limit >= <int64_t>results.size():
  */
-    __Pyx_TraceLine(722,0,__PYX_ERR(0, 722, __pyx_L1_error))
+    __Pyx_TraceLine(641,0,__PYX_ERR(0, 641, __pyx_L1_error))
     __pyx_v_limit = ((int64_t)__pyx_v_results.size());
 
-    /* "rapidfuzz/process_cpp.pyx":721
+    /* "rapidfuzz/process_cpp_impl.pyx":640
  * 
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         limit = <int64_t>results.size()
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":724
+  /* "rapidfuzz/process_cpp_impl.pyx":643
  *         limit = <int64_t>results.size()
  * 
  *     if limit >= <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  */
-  __Pyx_TraceLine(724,0,__PYX_ERR(0, 724, __pyx_L1_error))
+  __Pyx_TraceLine(643,0,__PYX_ERR(0, 643, __pyx_L1_error))
   __pyx_t_5 = (__pyx_v_limit >= ((int64_t)__pyx_v_results.size()));
   if (__pyx_t_5) {
 
-    /* "rapidfuzz/process_cpp.pyx":725
+    /* "rapidfuzz/process_cpp_impl.pyx":644
  * 
  *     if limit >= <int64_t>results.size():
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))             # <<<<<<<<<<<<<<
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))
  */
-    __Pyx_TraceLine(725,0,__PYX_ERR(0, 725, __pyx_L1_error))
+    __Pyx_TraceLine(644,0,__PYX_ERR(0, 644, __pyx_L1_error))
     try {
       std::sort<std::vector<DictMatchElem<double> > ::iterator,ExtractComp>(__pyx_v_results.begin(), __pyx_v_results.end(), ExtractComp(__pyx_v_scorer_flags));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 725, __pyx_L1_error)
+      __PYX_ERR(0, 644, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":724
+    /* "rapidfuzz/process_cpp_impl.pyx":643
  *         limit = <int64_t>results.size()
  * 
  *     if limit >= <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  */
     goto __pyx_L4;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":727
+  /* "rapidfuzz/process_cpp_impl.pyx":646
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))             # <<<<<<<<<<<<<<
  *         results.resize(limit)
  * 
  */
-  __Pyx_TraceLine(727,0,__PYX_ERR(0, 727, __pyx_L1_error))
+  __Pyx_TraceLine(646,0,__PYX_ERR(0, 646, __pyx_L1_error))
   /*else*/ {
     try {
       std::partial_sort<std::vector<DictMatchElem<double> > ::iterator,ExtractComp>(__pyx_v_results.begin(), (__pyx_v_results.begin() + ((ptrdiff_t)__pyx_v_limit)), __pyx_v_results.end(), ExtractComp(__pyx_v_scorer_flags));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 727, __pyx_L1_error)
+      __PYX_ERR(0, 646, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":728
+    /* "rapidfuzz/process_cpp_impl.pyx":647
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))
  *         results.resize(limit)             # <<<<<<<<<<<<<<
  * 
  *     # copy elements into Python List
  */
-    __Pyx_TraceLine(728,0,__PYX_ERR(0, 728, __pyx_L1_error))
+    __Pyx_TraceLine(647,0,__PYX_ERR(0, 647, __pyx_L1_error))
     try {
       __pyx_v_results.resize(__pyx_v_limit);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 728, __pyx_L1_error)
+      __PYX_ERR(0, 647, __pyx_L1_error)
     }
   }
   __pyx_L4:;
 
-  /* "rapidfuzz/process_cpp.pyx":731
+  /* "rapidfuzz/process_cpp_impl.pyx":650
  * 
  *     # copy elements into Python List
  *     result_list = PyList_New(<Py_ssize_t>limit)             # <<<<<<<<<<<<<<
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, <object>results[i].key.obj)
  */
-  __Pyx_TraceLine(731,0,__PYX_ERR(0, 731, __pyx_L1_error))
-  __pyx_t_6 = PyList_New(((Py_ssize_t)__pyx_v_limit)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 731, __pyx_L1_error)
+  __Pyx_TraceLine(650,0,__PYX_ERR(0, 650, __pyx_L1_error))
+  __pyx_t_6 = PyList_New(((Py_ssize_t)__pyx_v_limit)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 650, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_result_list = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":732
+  /* "rapidfuzz/process_cpp_impl.pyx":651
  *     # copy elements into Python List
  *     result_list = PyList_New(<Py_ssize_t>limit)
  *     for i in range(limit):             # <<<<<<<<<<<<<<
  *         result_item = (<object>results[i].choice.obj, results[i].score, <object>results[i].key.obj)
  *         Py_INCREF(result_item)
  */
-  __Pyx_TraceLine(732,0,__PYX_ERR(0, 732, __pyx_L1_error))
+  __Pyx_TraceLine(651,0,__PYX_ERR(0, 651, __pyx_L1_error))
   __pyx_t_7 = __pyx_v_limit;
   __pyx_t_8 = __pyx_t_7;
   for (__pyx_t_9 = 0; __pyx_t_9 < __pyx_t_8; __pyx_t_9+=1) {
     __pyx_v_i = __pyx_t_9;
 
-    /* "rapidfuzz/process_cpp.pyx":733
+    /* "rapidfuzz/process_cpp_impl.pyx":652
  *     result_list = PyList_New(<Py_ssize_t>limit)
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, <object>results[i].key.obj)             # <<<<<<<<<<<<<<
  *         Py_INCREF(result_item)
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  */
-    __Pyx_TraceLine(733,0,__PYX_ERR(0, 733, __pyx_L1_error))
+    __Pyx_TraceLine(652,0,__PYX_ERR(0, 652, __pyx_L1_error))
     __pyx_t_10 = (__pyx_v_results[__pyx_v_i]).choice.obj;
-    __pyx_t_6 = PyFloat_FromDouble((__pyx_v_results[__pyx_v_i]).score); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 733, __pyx_L1_error)
+    __pyx_t_6 = PyFloat_FromDouble((__pyx_v_results[__pyx_v_i]).score); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 652, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_t_11 = (__pyx_v_results[__pyx_v_i]).key.obj;
-    __pyx_t_12 = PyTuple_New(3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 733, __pyx_L1_error)
+    __pyx_t_12 = PyTuple_New(3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 652, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_INCREF(((PyObject *)__pyx_t_10));
     __Pyx_GIVEREF(((PyObject *)__pyx_t_10));
     PyTuple_SET_ITEM(__pyx_t_12, 0, ((PyObject *)__pyx_t_10));
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_6);
     __Pyx_INCREF(((PyObject *)__pyx_t_11));
     __Pyx_GIVEREF(((PyObject *)__pyx_t_11));
     PyTuple_SET_ITEM(__pyx_t_12, 2, ((PyObject *)__pyx_t_11));
     __pyx_t_6 = 0;
     __Pyx_XDECREF_SET(__pyx_v_result_item, ((PyObject*)__pyx_t_12));
     __pyx_t_12 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":734
+    /* "rapidfuzz/process_cpp_impl.pyx":653
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, <object>results[i].key.obj)
  *         Py_INCREF(result_item)             # <<<<<<<<<<<<<<
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  * 
  */
-    __Pyx_TraceLine(734,0,__PYX_ERR(0, 734, __pyx_L1_error))
+    __Pyx_TraceLine(653,0,__PYX_ERR(0, 653, __pyx_L1_error))
     Py_INCREF(__pyx_v_result_item);
 
-    /* "rapidfuzz/process_cpp.pyx":735
+    /* "rapidfuzz/process_cpp_impl.pyx":654
  *         result_item = (<object>results[i].choice.obj, results[i].score, <object>results[i].key.obj)
  *         Py_INCREF(result_item)
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)             # <<<<<<<<<<<<<<
  * 
  *     return result_list
  */
-    __Pyx_TraceLine(735,0,__PYX_ERR(0, 735, __pyx_L1_error))
+    __Pyx_TraceLine(654,0,__PYX_ERR(0, 654, __pyx_L1_error))
     PyList_SET_ITEM(__pyx_v_result_list, ((Py_ssize_t)__pyx_v_i), __pyx_v_result_item);
   }
 
-  /* "rapidfuzz/process_cpp.pyx":737
+  /* "rapidfuzz/process_cpp_impl.pyx":656
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  * 
  *     return result_list             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(737,0,__PYX_ERR(0, 737, __pyx_L1_error))
+  __Pyx_TraceLine(656,0,__PYX_ERR(0, 656, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_result_list);
   __pyx_r = __pyx_v_result_list;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":712
+  /* "rapidfuzz/process_cpp_impl.pyx":631
  * 
  * 
  * cdef inline extract_dict_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_dict(choices, processor)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_12);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_dict_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_dict_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_result_list);
   __Pyx_XDECREF(__pyx_v_result_item);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":740
+/* "rapidfuzz/process_cpp_impl.pyx":659
  * 
  * 
  * cdef inline extract_dict_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_dict(choices, processor)
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_dict_i64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_dict_i64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   RF_StringWrapper __pyx_v_proc_query;
   std::vector<DictStringElem>  __pyx_v_proc_choices;
   std::vector<DictMatchElem<int64_t> >  __pyx_v_results;
   PyObject *__pyx_v_result_list = NULL;
   int64_t __pyx_v_i;
   PyObject *__pyx_v_result_item = NULL;
   PyObject *__pyx_r = NULL;
@@ -10601,436 +11524,436 @@
   PyObject *__pyx_t_9;
   PyObject *__pyx_t_10;
   PyObject *__pyx_t_11 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_dict_i64", 0);
-  __Pyx_TraceCall("extract_dict_i64", __pyx_f[0], 740, 0, __PYX_ERR(0, 740, __pyx_L1_error));
+  __Pyx_TraceCall("extract_dict_i64", __pyx_f[0], 659, 0, __PYX_ERR(0, 659, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":741
+  /* "rapidfuzz/process_cpp_impl.pyx":660
  * 
  * cdef inline extract_dict_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))             # <<<<<<<<<<<<<<
  *     proc_choices = preprocess_dict(choices, processor)
  * 
  */
-  __Pyx_TraceLine(741,0,__PYX_ERR(0, 741, __pyx_L1_error))
-  __pyx_t_1 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 741, __pyx_L1_error)
+  __Pyx_TraceLine(660,0,__PYX_ERR(0, 660, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 660, __pyx_L1_error)
   __pyx_v_proc_query = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_1));
 
-  /* "rapidfuzz/process_cpp.pyx":742
+  /* "rapidfuzz/process_cpp_impl.pyx":661
  * cdef inline extract_dict_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_dict(choices, processor)             # <<<<<<<<<<<<<<
  * 
  *     cdef vector[DictMatchElem[int64_t]] results = extract_dict_impl[int64_t](
  */
-  __Pyx_TraceLine(742,0,__PYX_ERR(0, 742, __pyx_L1_error))
-  __pyx_t_2 = __pyx_f_9rapidfuzz_11process_cpp_preprocess_dict(__pyx_v_choices, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 742, __pyx_L1_error)
+  __Pyx_TraceLine(661,0,__PYX_ERR(0, 661, __pyx_L1_error))
+  __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_dict(__pyx_v_choices, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 661, __pyx_L1_error)
   __pyx_v_proc_choices = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_2);
 
-  /* "rapidfuzz/process_cpp.pyx":746
+  /* "rapidfuzz/process_cpp_impl.pyx":665
  *     cdef vector[DictMatchElem[int64_t]] results = extract_dict_impl[int64_t](
  *         kwargs, scorer_flags, scorer, proc_query, proc_choices,
  *         get_score_cutoff_i64(score_cutoff, scorer_flags))             # <<<<<<<<<<<<<<
  * 
  *     # due to score_cutoff not always completely filled
  */
-  __Pyx_TraceLine(746,0,__PYX_ERR(0, 746, __pyx_L1_error))
-  __pyx_t_3 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_3 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 746, __pyx_L1_error)
+  __Pyx_TraceLine(665,0,__PYX_ERR(0, 665, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_3 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 665, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":744
+  /* "rapidfuzz/process_cpp_impl.pyx":663
  *     proc_choices = preprocess_dict(choices, processor)
  * 
  *     cdef vector[DictMatchElem[int64_t]] results = extract_dict_impl[int64_t](             # <<<<<<<<<<<<<<
  *         kwargs, scorer_flags, scorer, proc_query, proc_choices,
  *         get_score_cutoff_i64(score_cutoff, scorer_flags))
  */
-  __Pyx_TraceLine(744,0,__PYX_ERR(0, 744, __pyx_L1_error))
+  __Pyx_TraceLine(663,0,__PYX_ERR(0, 663, __pyx_L1_error))
   try {
     __pyx_t_4 = extract_dict_impl<int64_t>(__pyx_v_kwargs, __pyx_v_scorer_flags, __pyx_v_scorer, __pyx_v_proc_query, __pyx_v_proc_choices, __pyx_t_3);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 744, __pyx_L1_error)
+    __PYX_ERR(0, 663, __pyx_L1_error)
   }
   __pyx_v_results = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_4);
 
-  /* "rapidfuzz/process_cpp.pyx":749
+  /* "rapidfuzz/process_cpp_impl.pyx":668
  * 
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         limit = <int64_t>results.size()
  * 
  */
-  __Pyx_TraceLine(749,0,__PYX_ERR(0, 749, __pyx_L1_error))
+  __Pyx_TraceLine(668,0,__PYX_ERR(0, 668, __pyx_L1_error))
   __pyx_t_5 = (__pyx_v_limit > ((int64_t)__pyx_v_results.size()));
   if (__pyx_t_5) {
 
-    /* "rapidfuzz/process_cpp.pyx":750
+    /* "rapidfuzz/process_cpp_impl.pyx":669
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():
  *         limit = <int64_t>results.size()             # <<<<<<<<<<<<<<
  * 
  *     if limit >= <int64_t>results.size():
  */
-    __Pyx_TraceLine(750,0,__PYX_ERR(0, 750, __pyx_L1_error))
+    __Pyx_TraceLine(669,0,__PYX_ERR(0, 669, __pyx_L1_error))
     __pyx_v_limit = ((int64_t)__pyx_v_results.size());
 
-    /* "rapidfuzz/process_cpp.pyx":749
+    /* "rapidfuzz/process_cpp_impl.pyx":668
  * 
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         limit = <int64_t>results.size()
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":752
+  /* "rapidfuzz/process_cpp_impl.pyx":671
  *         limit = <int64_t>results.size()
  * 
  *     if limit >= <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  */
-  __Pyx_TraceLine(752,0,__PYX_ERR(0, 752, __pyx_L1_error))
+  __Pyx_TraceLine(671,0,__PYX_ERR(0, 671, __pyx_L1_error))
   __pyx_t_5 = (__pyx_v_limit >= ((int64_t)__pyx_v_results.size()));
   if (__pyx_t_5) {
 
-    /* "rapidfuzz/process_cpp.pyx":753
+    /* "rapidfuzz/process_cpp_impl.pyx":672
  * 
  *     if limit >= <int64_t>results.size():
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))             # <<<<<<<<<<<<<<
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))
  */
-    __Pyx_TraceLine(753,0,__PYX_ERR(0, 753, __pyx_L1_error))
+    __Pyx_TraceLine(672,0,__PYX_ERR(0, 672, __pyx_L1_error))
     try {
       std::sort<std::vector<DictMatchElem<int64_t> > ::iterator,ExtractComp>(__pyx_v_results.begin(), __pyx_v_results.end(), ExtractComp(__pyx_v_scorer_flags));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 753, __pyx_L1_error)
+      __PYX_ERR(0, 672, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":752
+    /* "rapidfuzz/process_cpp_impl.pyx":671
  *         limit = <int64_t>results.size()
  * 
  *     if limit >= <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  */
     goto __pyx_L4;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":755
+  /* "rapidfuzz/process_cpp_impl.pyx":674
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))             # <<<<<<<<<<<<<<
  *         results.resize(limit)
  * 
  */
-  __Pyx_TraceLine(755,0,__PYX_ERR(0, 755, __pyx_L1_error))
+  __Pyx_TraceLine(674,0,__PYX_ERR(0, 674, __pyx_L1_error))
   /*else*/ {
     try {
       std::partial_sort<std::vector<DictMatchElem<int64_t> > ::iterator,ExtractComp>(__pyx_v_results.begin(), (__pyx_v_results.begin() + ((ptrdiff_t)__pyx_v_limit)), __pyx_v_results.end(), ExtractComp(__pyx_v_scorer_flags));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 755, __pyx_L1_error)
+      __PYX_ERR(0, 674, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":756
+    /* "rapidfuzz/process_cpp_impl.pyx":675
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))
  *         results.resize(limit)             # <<<<<<<<<<<<<<
  * 
  *     # copy elements into Python List
  */
-    __Pyx_TraceLine(756,0,__PYX_ERR(0, 756, __pyx_L1_error))
+    __Pyx_TraceLine(675,0,__PYX_ERR(0, 675, __pyx_L1_error))
     try {
       __pyx_v_results.resize(__pyx_v_limit);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 756, __pyx_L1_error)
+      __PYX_ERR(0, 675, __pyx_L1_error)
     }
   }
   __pyx_L4:;
 
-  /* "rapidfuzz/process_cpp.pyx":759
+  /* "rapidfuzz/process_cpp_impl.pyx":678
  * 
  *     # copy elements into Python List
  *     result_list = PyList_New(<Py_ssize_t>limit)             # <<<<<<<<<<<<<<
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, <object>results[i].key.obj)
  */
-  __Pyx_TraceLine(759,0,__PYX_ERR(0, 759, __pyx_L1_error))
-  __pyx_t_6 = PyList_New(((Py_ssize_t)__pyx_v_limit)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 759, __pyx_L1_error)
+  __Pyx_TraceLine(678,0,__PYX_ERR(0, 678, __pyx_L1_error))
+  __pyx_t_6 = PyList_New(((Py_ssize_t)__pyx_v_limit)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 678, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_result_list = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":760
+  /* "rapidfuzz/process_cpp_impl.pyx":679
  *     # copy elements into Python List
  *     result_list = PyList_New(<Py_ssize_t>limit)
  *     for i in range(limit):             # <<<<<<<<<<<<<<
  *         result_item = (<object>results[i].choice.obj, results[i].score, <object>results[i].key.obj)
  *         Py_INCREF(result_item)
  */
-  __Pyx_TraceLine(760,0,__PYX_ERR(0, 760, __pyx_L1_error))
+  __Pyx_TraceLine(679,0,__PYX_ERR(0, 679, __pyx_L1_error))
   __pyx_t_3 = __pyx_v_limit;
   __pyx_t_7 = __pyx_t_3;
   for (__pyx_t_8 = 0; __pyx_t_8 < __pyx_t_7; __pyx_t_8+=1) {
     __pyx_v_i = __pyx_t_8;
 
-    /* "rapidfuzz/process_cpp.pyx":761
+    /* "rapidfuzz/process_cpp_impl.pyx":680
  *     result_list = PyList_New(<Py_ssize_t>limit)
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, <object>results[i].key.obj)             # <<<<<<<<<<<<<<
  *         Py_INCREF(result_item)
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  */
-    __Pyx_TraceLine(761,0,__PYX_ERR(0, 761, __pyx_L1_error))
+    __Pyx_TraceLine(680,0,__PYX_ERR(0, 680, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_results[__pyx_v_i]).choice.obj;
-    __pyx_t_6 = __Pyx_PyInt_From_int64_t((__pyx_v_results[__pyx_v_i]).score); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 761, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_int64_t((__pyx_v_results[__pyx_v_i]).score); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 680, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_t_10 = (__pyx_v_results[__pyx_v_i]).key.obj;
-    __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 761, __pyx_L1_error)
+    __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 680, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_INCREF(((PyObject *)__pyx_t_9));
     __Pyx_GIVEREF(((PyObject *)__pyx_t_9));
     PyTuple_SET_ITEM(__pyx_t_11, 0, ((PyObject *)__pyx_t_9));
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_6);
     __Pyx_INCREF(((PyObject *)__pyx_t_10));
     __Pyx_GIVEREF(((PyObject *)__pyx_t_10));
     PyTuple_SET_ITEM(__pyx_t_11, 2, ((PyObject *)__pyx_t_10));
     __pyx_t_6 = 0;
     __Pyx_XDECREF_SET(__pyx_v_result_item, ((PyObject*)__pyx_t_11));
     __pyx_t_11 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":762
+    /* "rapidfuzz/process_cpp_impl.pyx":681
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, <object>results[i].key.obj)
  *         Py_INCREF(result_item)             # <<<<<<<<<<<<<<
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  * 
  */
-    __Pyx_TraceLine(762,0,__PYX_ERR(0, 762, __pyx_L1_error))
+    __Pyx_TraceLine(681,0,__PYX_ERR(0, 681, __pyx_L1_error))
     Py_INCREF(__pyx_v_result_item);
 
-    /* "rapidfuzz/process_cpp.pyx":763
+    /* "rapidfuzz/process_cpp_impl.pyx":682
  *         result_item = (<object>results[i].choice.obj, results[i].score, <object>results[i].key.obj)
  *         Py_INCREF(result_item)
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)             # <<<<<<<<<<<<<<
  * 
  *     return result_list
  */
-    __Pyx_TraceLine(763,0,__PYX_ERR(0, 763, __pyx_L1_error))
+    __Pyx_TraceLine(682,0,__PYX_ERR(0, 682, __pyx_L1_error))
     PyList_SET_ITEM(__pyx_v_result_list, ((Py_ssize_t)__pyx_v_i), __pyx_v_result_item);
   }
 
-  /* "rapidfuzz/process_cpp.pyx":765
+  /* "rapidfuzz/process_cpp_impl.pyx":684
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  * 
  *     return result_list             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(765,0,__PYX_ERR(0, 765, __pyx_L1_error))
+  __Pyx_TraceLine(684,0,__PYX_ERR(0, 684, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_result_list);
   __pyx_r = __pyx_v_result_list;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":740
+  /* "rapidfuzz/process_cpp_impl.pyx":659
  * 
  * 
  * cdef inline extract_dict_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_dict(choices, processor)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_11);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_dict_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_dict_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_result_list);
   __Pyx_XDECREF(__pyx_v_result_item);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":768
+/* "rapidfuzz/process_cpp_impl.pyx":687
  * 
  * 
  * cdef inline extract_dict(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_dict(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_dict(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   uint32_t __pyx_v_flags;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   uint32_t __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_dict", 0);
-  __Pyx_TraceCall("extract_dict", __pyx_f[0], 768, 0, __PYX_ERR(0, 768, __pyx_L1_error));
+  __Pyx_TraceCall("extract_dict", __pyx_f[0], 687, 0, __PYX_ERR(0, 687, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":769
+  /* "rapidfuzz/process_cpp_impl.pyx":688
  * 
  * cdef inline extract_dict(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):
  *     flags = dereference(scorer_flags).flags             # <<<<<<<<<<<<<<
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  */
-  __Pyx_TraceLine(769,0,__PYX_ERR(0, 769, __pyx_L1_error))
+  __Pyx_TraceLine(688,0,__PYX_ERR(0, 688, __pyx_L1_error))
   __pyx_t_1 = (*__pyx_v_scorer_flags).flags;
   __pyx_v_flags = __pyx_t_1;
 
-  /* "rapidfuzz/process_cpp.pyx":771
+  /* "rapidfuzz/process_cpp_impl.pyx":690
  *     flags = dereference(scorer_flags).flags
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *         return extract_dict_f64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  */
-  __Pyx_TraceLine(771,0,__PYX_ERR(0, 771, __pyx_L1_error))
+  __Pyx_TraceLine(690,0,__PYX_ERR(0, 690, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_F64) != 0);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":772
+    /* "rapidfuzz/process_cpp_impl.pyx":691
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  *         return extract_dict_f64(             # <<<<<<<<<<<<<<
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  *         )
  */
-    __Pyx_TraceLine(772,0,__PYX_ERR(0, 772, __pyx_L1_error))
+    __Pyx_TraceLine(691,0,__PYX_ERR(0, 691, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
 
-    /* "rapidfuzz/process_cpp.pyx":773
+    /* "rapidfuzz/process_cpp_impl.pyx":692
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  *         return extract_dict_f64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs             # <<<<<<<<<<<<<<
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  */
-    __Pyx_TraceLine(773,0,__PYX_ERR(0, 773, __pyx_L1_error))
-    __pyx_t_3 = __pyx_f_9rapidfuzz_11process_cpp_extract_dict_f64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_limit, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 772, __pyx_L1_error)
+    __Pyx_TraceLine(692,0,__PYX_ERR(0, 692, __pyx_L1_error))
+    __pyx_t_3 = __pyx_f_9rapidfuzz_16process_cpp_impl_extract_dict_f64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_limit, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 691, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":771
+    /* "rapidfuzz/process_cpp_impl.pyx":690
  *     flags = dereference(scorer_flags).flags
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *         return extract_dict_f64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":775
+  /* "rapidfuzz/process_cpp_impl.pyx":694
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *         return extract_dict_i64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  */
-  __Pyx_TraceLine(775,0,__PYX_ERR(0, 775, __pyx_L1_error))
+  __Pyx_TraceLine(694,0,__PYX_ERR(0, 694, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_I64) != 0);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":776
+    /* "rapidfuzz/process_cpp_impl.pyx":695
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  *         return extract_dict_i64(             # <<<<<<<<<<<<<<
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  *         )
  */
-    __Pyx_TraceLine(776,0,__PYX_ERR(0, 776, __pyx_L1_error))
+    __Pyx_TraceLine(695,0,__PYX_ERR(0, 695, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
 
-    /* "rapidfuzz/process_cpp.pyx":777
+    /* "rapidfuzz/process_cpp_impl.pyx":696
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  *         return extract_dict_i64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs             # <<<<<<<<<<<<<<
  *         )
  * 
  */
-    __Pyx_TraceLine(777,0,__PYX_ERR(0, 777, __pyx_L1_error))
-    __pyx_t_3 = __pyx_f_9rapidfuzz_11process_cpp_extract_dict_i64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_limit, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 776, __pyx_L1_error)
+    __Pyx_TraceLine(696,0,__PYX_ERR(0, 696, __pyx_L1_error))
+    __pyx_t_3 = __pyx_f_9rapidfuzz_16process_cpp_impl_extract_dict_i64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_limit, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 695, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":775
+    /* "rapidfuzz/process_cpp_impl.pyx":694
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *         return extract_dict_i64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":780
+  /* "rapidfuzz/process_cpp_impl.pyx":699
  *         )
  * 
  *     raise ValueError("scorer does not properly use the C-API")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(780,0,__PYX_ERR(0, 780, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 780, __pyx_L1_error)
+  __Pyx_TraceLine(699,0,__PYX_ERR(0, 699, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 699, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_Raise(__pyx_t_3, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __PYX_ERR(0, 780, __pyx_L1_error)
+  __PYX_ERR(0, 699, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":768
+  /* "rapidfuzz/process_cpp_impl.pyx":687
  * 
  * 
  * cdef inline extract_dict(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":783
+/* "rapidfuzz/process_cpp_impl.pyx":702
  * 
  * 
  * cdef inline extract_list_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_list(choices, processor)
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_list_f64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_list_f64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   RF_StringWrapper __pyx_v_proc_query;
   std::vector<ListStringElem>  __pyx_v_proc_choices;
   std::vector<ListMatchElem<double> >  __pyx_v_results;
   PyObject *__pyx_v_result_list = NULL;
   int64_t __pyx_v_i;
   PyObject *__pyx_v_result_item = NULL;
   PyObject *__pyx_r = NULL;
@@ -11048,283 +11971,283 @@
   PyObject *__pyx_t_10;
   PyObject *__pyx_t_11 = NULL;
   PyObject *__pyx_t_12 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_list_f64", 0);
-  __Pyx_TraceCall("extract_list_f64", __pyx_f[0], 783, 0, __PYX_ERR(0, 783, __pyx_L1_error));
+  __Pyx_TraceCall("extract_list_f64", __pyx_f[0], 702, 0, __PYX_ERR(0, 702, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":784
+  /* "rapidfuzz/process_cpp_impl.pyx":703
  * 
  * cdef inline extract_list_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))             # <<<<<<<<<<<<<<
  *     proc_choices = preprocess_list(choices, processor)
  * 
  */
-  __Pyx_TraceLine(784,0,__PYX_ERR(0, 784, __pyx_L1_error))
-  __pyx_t_1 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 784, __pyx_L1_error)
+  __Pyx_TraceLine(703,0,__PYX_ERR(0, 703, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 703, __pyx_L1_error)
   __pyx_v_proc_query = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_1));
 
-  /* "rapidfuzz/process_cpp.pyx":785
+  /* "rapidfuzz/process_cpp_impl.pyx":704
  * cdef inline extract_list_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_list(choices, processor)             # <<<<<<<<<<<<<<
  * 
  *     cdef vector[ListMatchElem[double]] results = extract_list_impl[double](
  */
-  __Pyx_TraceLine(785,0,__PYX_ERR(0, 785, __pyx_L1_error))
-  __pyx_t_2 = __pyx_f_9rapidfuzz_11process_cpp_preprocess_list(__pyx_v_choices, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 785, __pyx_L1_error)
+  __Pyx_TraceLine(704,0,__PYX_ERR(0, 704, __pyx_L1_error))
+  __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_list(__pyx_v_choices, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 704, __pyx_L1_error)
   __pyx_v_proc_choices = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_2);
 
-  /* "rapidfuzz/process_cpp.pyx":789
+  /* "rapidfuzz/process_cpp_impl.pyx":708
  *     cdef vector[ListMatchElem[double]] results = extract_list_impl[double](
  *         kwargs, scorer_flags, scorer, proc_query, proc_choices,
  *         get_score_cutoff_f64(score_cutoff, scorer_flags))             # <<<<<<<<<<<<<<
  * 
  *     # due to score_cutoff not always completely filled
  */
-  __Pyx_TraceLine(789,0,__PYX_ERR(0, 789, __pyx_L1_error))
-  __pyx_t_3 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_3 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 789, __pyx_L1_error)
+  __Pyx_TraceLine(708,0,__PYX_ERR(0, 708, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_3 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 708, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":787
+  /* "rapidfuzz/process_cpp_impl.pyx":706
  *     proc_choices = preprocess_list(choices, processor)
  * 
  *     cdef vector[ListMatchElem[double]] results = extract_list_impl[double](             # <<<<<<<<<<<<<<
  *         kwargs, scorer_flags, scorer, proc_query, proc_choices,
  *         get_score_cutoff_f64(score_cutoff, scorer_flags))
  */
-  __Pyx_TraceLine(787,0,__PYX_ERR(0, 787, __pyx_L1_error))
+  __Pyx_TraceLine(706,0,__PYX_ERR(0, 706, __pyx_L1_error))
   try {
     __pyx_t_4 = extract_list_impl<double>(__pyx_v_kwargs, __pyx_v_scorer_flags, __pyx_v_scorer, __pyx_v_proc_query, __pyx_v_proc_choices, __pyx_t_3);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 787, __pyx_L1_error)
+    __PYX_ERR(0, 706, __pyx_L1_error)
   }
   __pyx_v_results = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_4);
 
-  /* "rapidfuzz/process_cpp.pyx":792
+  /* "rapidfuzz/process_cpp_impl.pyx":711
  * 
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         limit = <int64_t>results.size()
  * 
  */
-  __Pyx_TraceLine(792,0,__PYX_ERR(0, 792, __pyx_L1_error))
+  __Pyx_TraceLine(711,0,__PYX_ERR(0, 711, __pyx_L1_error))
   __pyx_t_5 = (__pyx_v_limit > ((int64_t)__pyx_v_results.size()));
   if (__pyx_t_5) {
 
-    /* "rapidfuzz/process_cpp.pyx":793
+    /* "rapidfuzz/process_cpp_impl.pyx":712
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():
  *         limit = <int64_t>results.size()             # <<<<<<<<<<<<<<
  * 
  *     if limit >= <int64_t>results.size():
  */
-    __Pyx_TraceLine(793,0,__PYX_ERR(0, 793, __pyx_L1_error))
+    __Pyx_TraceLine(712,0,__PYX_ERR(0, 712, __pyx_L1_error))
     __pyx_v_limit = ((int64_t)__pyx_v_results.size());
 
-    /* "rapidfuzz/process_cpp.pyx":792
+    /* "rapidfuzz/process_cpp_impl.pyx":711
  * 
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         limit = <int64_t>results.size()
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":795
+  /* "rapidfuzz/process_cpp_impl.pyx":714
  *         limit = <int64_t>results.size()
  * 
  *     if limit >= <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  */
-  __Pyx_TraceLine(795,0,__PYX_ERR(0, 795, __pyx_L1_error))
+  __Pyx_TraceLine(714,0,__PYX_ERR(0, 714, __pyx_L1_error))
   __pyx_t_5 = (__pyx_v_limit >= ((int64_t)__pyx_v_results.size()));
   if (__pyx_t_5) {
 
-    /* "rapidfuzz/process_cpp.pyx":796
+    /* "rapidfuzz/process_cpp_impl.pyx":715
  * 
  *     if limit >= <int64_t>results.size():
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))             # <<<<<<<<<<<<<<
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))
  */
-    __Pyx_TraceLine(796,0,__PYX_ERR(0, 796, __pyx_L1_error))
+    __Pyx_TraceLine(715,0,__PYX_ERR(0, 715, __pyx_L1_error))
     try {
       std::sort<std::vector<ListMatchElem<double> > ::iterator,ExtractComp>(__pyx_v_results.begin(), __pyx_v_results.end(), ExtractComp(__pyx_v_scorer_flags));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 796, __pyx_L1_error)
+      __PYX_ERR(0, 715, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":795
+    /* "rapidfuzz/process_cpp_impl.pyx":714
  *         limit = <int64_t>results.size()
  * 
  *     if limit >= <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  */
     goto __pyx_L4;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":798
+  /* "rapidfuzz/process_cpp_impl.pyx":717
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))             # <<<<<<<<<<<<<<
  *         results.resize(limit)
  * 
  */
-  __Pyx_TraceLine(798,0,__PYX_ERR(0, 798, __pyx_L1_error))
+  __Pyx_TraceLine(717,0,__PYX_ERR(0, 717, __pyx_L1_error))
   /*else*/ {
     try {
       std::partial_sort<std::vector<ListMatchElem<double> > ::iterator,ExtractComp>(__pyx_v_results.begin(), (__pyx_v_results.begin() + ((ptrdiff_t)__pyx_v_limit)), __pyx_v_results.end(), ExtractComp(__pyx_v_scorer_flags));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 798, __pyx_L1_error)
+      __PYX_ERR(0, 717, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":799
+    /* "rapidfuzz/process_cpp_impl.pyx":718
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))
  *         results.resize(limit)             # <<<<<<<<<<<<<<
  * 
  *     # copy elements into Python List
  */
-    __Pyx_TraceLine(799,0,__PYX_ERR(0, 799, __pyx_L1_error))
+    __Pyx_TraceLine(718,0,__PYX_ERR(0, 718, __pyx_L1_error))
     try {
       __pyx_v_results.resize(__pyx_v_limit);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 799, __pyx_L1_error)
+      __PYX_ERR(0, 718, __pyx_L1_error)
     }
   }
   __pyx_L4:;
 
-  /* "rapidfuzz/process_cpp.pyx":802
+  /* "rapidfuzz/process_cpp_impl.pyx":721
  * 
  *     # copy elements into Python List
  *     result_list = PyList_New(<Py_ssize_t>limit)             # <<<<<<<<<<<<<<
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, results[i].index)
  */
-  __Pyx_TraceLine(802,0,__PYX_ERR(0, 802, __pyx_L1_error))
-  __pyx_t_6 = PyList_New(((Py_ssize_t)__pyx_v_limit)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 802, __pyx_L1_error)
+  __Pyx_TraceLine(721,0,__PYX_ERR(0, 721, __pyx_L1_error))
+  __pyx_t_6 = PyList_New(((Py_ssize_t)__pyx_v_limit)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 721, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_result_list = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":803
+  /* "rapidfuzz/process_cpp_impl.pyx":722
  *     # copy elements into Python List
  *     result_list = PyList_New(<Py_ssize_t>limit)
  *     for i in range(limit):             # <<<<<<<<<<<<<<
  *         result_item = (<object>results[i].choice.obj, results[i].score, results[i].index)
  *         Py_INCREF(result_item)
  */
-  __Pyx_TraceLine(803,0,__PYX_ERR(0, 803, __pyx_L1_error))
+  __Pyx_TraceLine(722,0,__PYX_ERR(0, 722, __pyx_L1_error))
   __pyx_t_7 = __pyx_v_limit;
   __pyx_t_8 = __pyx_t_7;
   for (__pyx_t_9 = 0; __pyx_t_9 < __pyx_t_8; __pyx_t_9+=1) {
     __pyx_v_i = __pyx_t_9;
 
-    /* "rapidfuzz/process_cpp.pyx":804
+    /* "rapidfuzz/process_cpp_impl.pyx":723
  *     result_list = PyList_New(<Py_ssize_t>limit)
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, results[i].index)             # <<<<<<<<<<<<<<
  *         Py_INCREF(result_item)
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  */
-    __Pyx_TraceLine(804,0,__PYX_ERR(0, 804, __pyx_L1_error))
+    __Pyx_TraceLine(723,0,__PYX_ERR(0, 723, __pyx_L1_error))
     __pyx_t_10 = (__pyx_v_results[__pyx_v_i]).choice.obj;
-    __pyx_t_6 = PyFloat_FromDouble((__pyx_v_results[__pyx_v_i]).score); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 804, __pyx_L1_error)
+    __pyx_t_6 = PyFloat_FromDouble((__pyx_v_results[__pyx_v_i]).score); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 723, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_11 = __Pyx_PyInt_From_int64_t((__pyx_v_results[__pyx_v_i]).index); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 804, __pyx_L1_error)
+    __pyx_t_11 = __Pyx_PyInt_From_int64_t((__pyx_v_results[__pyx_v_i]).index); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 723, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
-    __pyx_t_12 = PyTuple_New(3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 804, __pyx_L1_error)
+    __pyx_t_12 = PyTuple_New(3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 723, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_12);
     __Pyx_INCREF(((PyObject *)__pyx_t_10));
     __Pyx_GIVEREF(((PyObject *)__pyx_t_10));
     PyTuple_SET_ITEM(__pyx_t_12, 0, ((PyObject *)__pyx_t_10));
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_11);
     PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_11);
     __pyx_t_6 = 0;
     __pyx_t_11 = 0;
     __Pyx_XDECREF_SET(__pyx_v_result_item, ((PyObject*)__pyx_t_12));
     __pyx_t_12 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":805
+    /* "rapidfuzz/process_cpp_impl.pyx":724
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, results[i].index)
  *         Py_INCREF(result_item)             # <<<<<<<<<<<<<<
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  * 
  */
-    __Pyx_TraceLine(805,0,__PYX_ERR(0, 805, __pyx_L1_error))
+    __Pyx_TraceLine(724,0,__PYX_ERR(0, 724, __pyx_L1_error))
     Py_INCREF(__pyx_v_result_item);
 
-    /* "rapidfuzz/process_cpp.pyx":806
+    /* "rapidfuzz/process_cpp_impl.pyx":725
  *         result_item = (<object>results[i].choice.obj, results[i].score, results[i].index)
  *         Py_INCREF(result_item)
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)             # <<<<<<<<<<<<<<
  * 
  *     return result_list
  */
-    __Pyx_TraceLine(806,0,__PYX_ERR(0, 806, __pyx_L1_error))
+    __Pyx_TraceLine(725,0,__PYX_ERR(0, 725, __pyx_L1_error))
     PyList_SET_ITEM(__pyx_v_result_list, ((Py_ssize_t)__pyx_v_i), __pyx_v_result_item);
   }
 
-  /* "rapidfuzz/process_cpp.pyx":808
+  /* "rapidfuzz/process_cpp_impl.pyx":727
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  * 
  *     return result_list             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(808,0,__PYX_ERR(0, 808, __pyx_L1_error))
+  __Pyx_TraceLine(727,0,__PYX_ERR(0, 727, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_result_list);
   __pyx_r = __pyx_v_result_list;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":783
+  /* "rapidfuzz/process_cpp_impl.pyx":702
  * 
  * 
  * cdef inline extract_list_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_list(choices, processor)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_11);
   __Pyx_XDECREF(__pyx_t_12);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_list_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_list_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_result_list);
   __Pyx_XDECREF(__pyx_v_result_item);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":811
+/* "rapidfuzz/process_cpp_impl.pyx":730
  * 
  * 
  * cdef inline extract_list_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_list(choices, processor)
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_list_i64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_list_i64(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   RF_StringWrapper __pyx_v_proc_query;
   std::vector<ListStringElem>  __pyx_v_proc_choices;
   std::vector<ListMatchElem<int64_t> >  __pyx_v_results;
   PyObject *__pyx_v_result_list = NULL;
   int64_t __pyx_v_i;
   PyObject *__pyx_v_result_item = NULL;
   PyObject *__pyx_r = NULL;
@@ -11341,447 +12264,447 @@
   PyObject *__pyx_t_9;
   PyObject *__pyx_t_10 = NULL;
   PyObject *__pyx_t_11 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_list_i64", 0);
-  __Pyx_TraceCall("extract_list_i64", __pyx_f[0], 811, 0, __PYX_ERR(0, 811, __pyx_L1_error));
+  __Pyx_TraceCall("extract_list_i64", __pyx_f[0], 730, 0, __PYX_ERR(0, 730, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":812
+  /* "rapidfuzz/process_cpp_impl.pyx":731
  * 
  * cdef inline extract_list_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))             # <<<<<<<<<<<<<<
  *     proc_choices = preprocess_list(choices, processor)
  * 
  */
-  __Pyx_TraceLine(812,0,__PYX_ERR(0, 812, __pyx_L1_error))
-  __pyx_t_1 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 812, __pyx_L1_error)
+  __Pyx_TraceLine(731,0,__PYX_ERR(0, 731, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 731, __pyx_L1_error)
   __pyx_v_proc_query = cython_std::move<RF_StringWrapper>(RF_StringWrapper(__pyx_t_1));
 
-  /* "rapidfuzz/process_cpp.pyx":813
+  /* "rapidfuzz/process_cpp_impl.pyx":732
  * cdef inline extract_list_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_list(choices, processor)             # <<<<<<<<<<<<<<
  * 
  *     cdef vector[ListMatchElem[int64_t]] results = extract_list_impl[int64_t](
  */
-  __Pyx_TraceLine(813,0,__PYX_ERR(0, 813, __pyx_L1_error))
-  __pyx_t_2 = __pyx_f_9rapidfuzz_11process_cpp_preprocess_list(__pyx_v_choices, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 813, __pyx_L1_error)
+  __Pyx_TraceLine(732,0,__PYX_ERR(0, 732, __pyx_L1_error))
+  __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_list(__pyx_v_choices, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 732, __pyx_L1_error)
   __pyx_v_proc_choices = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_2);
 
-  /* "rapidfuzz/process_cpp.pyx":817
+  /* "rapidfuzz/process_cpp_impl.pyx":736
  *     cdef vector[ListMatchElem[int64_t]] results = extract_list_impl[int64_t](
  *         kwargs, scorer_flags, scorer, proc_query, proc_choices,
  *         get_score_cutoff_i64(score_cutoff, scorer_flags))             # <<<<<<<<<<<<<<
  * 
  *     # due to score_cutoff not always completely filled
  */
-  __Pyx_TraceLine(817,0,__PYX_ERR(0, 817, __pyx_L1_error))
-  __pyx_t_3 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_3 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 817, __pyx_L1_error)
+  __Pyx_TraceLine(736,0,__PYX_ERR(0, 736, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_3 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 736, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":815
+  /* "rapidfuzz/process_cpp_impl.pyx":734
  *     proc_choices = preprocess_list(choices, processor)
  * 
  *     cdef vector[ListMatchElem[int64_t]] results = extract_list_impl[int64_t](             # <<<<<<<<<<<<<<
  *         kwargs, scorer_flags, scorer, proc_query, proc_choices,
  *         get_score_cutoff_i64(score_cutoff, scorer_flags))
  */
-  __Pyx_TraceLine(815,0,__PYX_ERR(0, 815, __pyx_L1_error))
+  __Pyx_TraceLine(734,0,__PYX_ERR(0, 734, __pyx_L1_error))
   try {
     __pyx_t_4 = extract_list_impl<int64_t>(__pyx_v_kwargs, __pyx_v_scorer_flags, __pyx_v_scorer, __pyx_v_proc_query, __pyx_v_proc_choices, __pyx_t_3);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(0, 815, __pyx_L1_error)
+    __PYX_ERR(0, 734, __pyx_L1_error)
   }
   __pyx_v_results = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_4);
 
-  /* "rapidfuzz/process_cpp.pyx":820
+  /* "rapidfuzz/process_cpp_impl.pyx":739
  * 
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         limit = <int64_t>results.size()
  * 
  */
-  __Pyx_TraceLine(820,0,__PYX_ERR(0, 820, __pyx_L1_error))
+  __Pyx_TraceLine(739,0,__PYX_ERR(0, 739, __pyx_L1_error))
   __pyx_t_5 = (__pyx_v_limit > ((int64_t)__pyx_v_results.size()));
   if (__pyx_t_5) {
 
-    /* "rapidfuzz/process_cpp.pyx":821
+    /* "rapidfuzz/process_cpp_impl.pyx":740
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():
  *         limit = <int64_t>results.size()             # <<<<<<<<<<<<<<
  * 
  *     if limit >= <int64_t>results.size():
  */
-    __Pyx_TraceLine(821,0,__PYX_ERR(0, 821, __pyx_L1_error))
+    __Pyx_TraceLine(740,0,__PYX_ERR(0, 740, __pyx_L1_error))
     __pyx_v_limit = ((int64_t)__pyx_v_results.size());
 
-    /* "rapidfuzz/process_cpp.pyx":820
+    /* "rapidfuzz/process_cpp_impl.pyx":739
  * 
  *     # due to score_cutoff not always completely filled
  *     if limit > <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         limit = <int64_t>results.size()
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":823
+  /* "rapidfuzz/process_cpp_impl.pyx":742
  *         limit = <int64_t>results.size()
  * 
  *     if limit >= <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  */
-  __Pyx_TraceLine(823,0,__PYX_ERR(0, 823, __pyx_L1_error))
+  __Pyx_TraceLine(742,0,__PYX_ERR(0, 742, __pyx_L1_error))
   __pyx_t_5 = (__pyx_v_limit >= ((int64_t)__pyx_v_results.size()));
   if (__pyx_t_5) {
 
-    /* "rapidfuzz/process_cpp.pyx":824
+    /* "rapidfuzz/process_cpp_impl.pyx":743
  * 
  *     if limit >= <int64_t>results.size():
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))             # <<<<<<<<<<<<<<
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))
  */
-    __Pyx_TraceLine(824,0,__PYX_ERR(0, 824, __pyx_L1_error))
+    __Pyx_TraceLine(743,0,__PYX_ERR(0, 743, __pyx_L1_error))
     try {
       std::sort<std::vector<ListMatchElem<int64_t> > ::iterator,ExtractComp>(__pyx_v_results.begin(), __pyx_v_results.end(), ExtractComp(__pyx_v_scorer_flags));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 824, __pyx_L1_error)
+      __PYX_ERR(0, 743, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":823
+    /* "rapidfuzz/process_cpp_impl.pyx":742
  *         limit = <int64_t>results.size()
  * 
  *     if limit >= <int64_t>results.size():             # <<<<<<<<<<<<<<
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  */
     goto __pyx_L4;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":826
+  /* "rapidfuzz/process_cpp_impl.pyx":745
  *         algorithm.sort(results.begin(), results.end(), ExtractComp(scorer_flags))
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))             # <<<<<<<<<<<<<<
  *         results.resize(limit)
  * 
  */
-  __Pyx_TraceLine(826,0,__PYX_ERR(0, 826, __pyx_L1_error))
+  __Pyx_TraceLine(745,0,__PYX_ERR(0, 745, __pyx_L1_error))
   /*else*/ {
     try {
       std::partial_sort<std::vector<ListMatchElem<int64_t> > ::iterator,ExtractComp>(__pyx_v_results.begin(), (__pyx_v_results.begin() + ((ptrdiff_t)__pyx_v_limit)), __pyx_v_results.end(), ExtractComp(__pyx_v_scorer_flags));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 826, __pyx_L1_error)
+      __PYX_ERR(0, 745, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":827
+    /* "rapidfuzz/process_cpp_impl.pyx":746
  *     else:
  *         algorithm.partial_sort(results.begin(), results.begin() + <ptrdiff_t>limit, results.end(), ExtractComp(scorer_flags))
  *         results.resize(limit)             # <<<<<<<<<<<<<<
  * 
  *     # copy elements into Python List
  */
-    __Pyx_TraceLine(827,0,__PYX_ERR(0, 827, __pyx_L1_error))
+    __Pyx_TraceLine(746,0,__PYX_ERR(0, 746, __pyx_L1_error))
     try {
       __pyx_v_results.resize(__pyx_v_limit);
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 827, __pyx_L1_error)
+      __PYX_ERR(0, 746, __pyx_L1_error)
     }
   }
   __pyx_L4:;
 
-  /* "rapidfuzz/process_cpp.pyx":830
+  /* "rapidfuzz/process_cpp_impl.pyx":749
  * 
  *     # copy elements into Python List
  *     result_list = PyList_New(<Py_ssize_t>limit)             # <<<<<<<<<<<<<<
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, results[i].index)
  */
-  __Pyx_TraceLine(830,0,__PYX_ERR(0, 830, __pyx_L1_error))
-  __pyx_t_6 = PyList_New(((Py_ssize_t)__pyx_v_limit)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 830, __pyx_L1_error)
+  __Pyx_TraceLine(749,0,__PYX_ERR(0, 749, __pyx_L1_error))
+  __pyx_t_6 = PyList_New(((Py_ssize_t)__pyx_v_limit)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 749, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_v_result_list = ((PyObject*)__pyx_t_6);
   __pyx_t_6 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":831
+  /* "rapidfuzz/process_cpp_impl.pyx":750
  *     # copy elements into Python List
  *     result_list = PyList_New(<Py_ssize_t>limit)
  *     for i in range(limit):             # <<<<<<<<<<<<<<
  *         result_item = (<object>results[i].choice.obj, results[i].score, results[i].index)
  *         Py_INCREF(result_item)
  */
-  __Pyx_TraceLine(831,0,__PYX_ERR(0, 831, __pyx_L1_error))
+  __Pyx_TraceLine(750,0,__PYX_ERR(0, 750, __pyx_L1_error))
   __pyx_t_3 = __pyx_v_limit;
   __pyx_t_7 = __pyx_t_3;
   for (__pyx_t_8 = 0; __pyx_t_8 < __pyx_t_7; __pyx_t_8+=1) {
     __pyx_v_i = __pyx_t_8;
 
-    /* "rapidfuzz/process_cpp.pyx":832
+    /* "rapidfuzz/process_cpp_impl.pyx":751
  *     result_list = PyList_New(<Py_ssize_t>limit)
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, results[i].index)             # <<<<<<<<<<<<<<
  *         Py_INCREF(result_item)
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  */
-    __Pyx_TraceLine(832,0,__PYX_ERR(0, 832, __pyx_L1_error))
+    __Pyx_TraceLine(751,0,__PYX_ERR(0, 751, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_results[__pyx_v_i]).choice.obj;
-    __pyx_t_6 = __Pyx_PyInt_From_int64_t((__pyx_v_results[__pyx_v_i]).score); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_From_int64_t((__pyx_v_results[__pyx_v_i]).score); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 751, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    __pyx_t_10 = __Pyx_PyInt_From_int64_t((__pyx_v_results[__pyx_v_i]).index); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_From_int64_t((__pyx_v_results[__pyx_v_i]).index); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 751, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 832, __pyx_L1_error)
+    __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 751, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_INCREF(((PyObject *)__pyx_t_9));
     __Pyx_GIVEREF(((PyObject *)__pyx_t_9));
     PyTuple_SET_ITEM(__pyx_t_11, 0, ((PyObject *)__pyx_t_9));
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_10);
     PyTuple_SET_ITEM(__pyx_t_11, 2, __pyx_t_10);
     __pyx_t_6 = 0;
     __pyx_t_10 = 0;
     __Pyx_XDECREF_SET(__pyx_v_result_item, ((PyObject*)__pyx_t_11));
     __pyx_t_11 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":833
+    /* "rapidfuzz/process_cpp_impl.pyx":752
  *     for i in range(limit):
  *         result_item = (<object>results[i].choice.obj, results[i].score, results[i].index)
  *         Py_INCREF(result_item)             # <<<<<<<<<<<<<<
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  * 
  */
-    __Pyx_TraceLine(833,0,__PYX_ERR(0, 833, __pyx_L1_error))
+    __Pyx_TraceLine(752,0,__PYX_ERR(0, 752, __pyx_L1_error))
     Py_INCREF(__pyx_v_result_item);
 
-    /* "rapidfuzz/process_cpp.pyx":834
+    /* "rapidfuzz/process_cpp_impl.pyx":753
  *         result_item = (<object>results[i].choice.obj, results[i].score, results[i].index)
  *         Py_INCREF(result_item)
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)             # <<<<<<<<<<<<<<
  * 
  *     return result_list
  */
-    __Pyx_TraceLine(834,0,__PYX_ERR(0, 834, __pyx_L1_error))
+    __Pyx_TraceLine(753,0,__PYX_ERR(0, 753, __pyx_L1_error))
     PyList_SET_ITEM(__pyx_v_result_list, ((Py_ssize_t)__pyx_v_i), __pyx_v_result_item);
   }
 
-  /* "rapidfuzz/process_cpp.pyx":836
+  /* "rapidfuzz/process_cpp_impl.pyx":755
  *         PyList_SET_ITEM(result_list, <Py_ssize_t>i, result_item)
  * 
  *     return result_list             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(836,0,__PYX_ERR(0, 836, __pyx_L1_error))
+  __Pyx_TraceLine(755,0,__PYX_ERR(0, 755, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_result_list);
   __pyx_r = __pyx_v_result_list;
   goto __pyx_L0;
 
-  /* "rapidfuzz/process_cpp.pyx":811
+  /* "rapidfuzz/process_cpp_impl.pyx":730
  * 
  * 
  * cdef inline extract_list_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_list(choices, processor)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_10);
   __Pyx_XDECREF(__pyx_t_11);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_list_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_list_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_result_list);
   __Pyx_XDECREF(__pyx_v_result_item);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":839
+/* "rapidfuzz/process_cpp_impl.pyx":758
  * 
  * 
  * cdef inline extract_list(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_extract_list(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_extract_list(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, PyObject *__pyx_v_score_cutoff, RF_Kwargs const *__pyx_v_kwargs) {
   uint32_t __pyx_v_flags;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   uint32_t __pyx_t_1;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_list", 0);
-  __Pyx_TraceCall("extract_list", __pyx_f[0], 839, 0, __PYX_ERR(0, 839, __pyx_L1_error));
+  __Pyx_TraceCall("extract_list", __pyx_f[0], 758, 0, __PYX_ERR(0, 758, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":840
+  /* "rapidfuzz/process_cpp_impl.pyx":759
  * 
  * cdef inline extract_list(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):
  *     flags = dereference(scorer_flags).flags             # <<<<<<<<<<<<<<
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  */
-  __Pyx_TraceLine(840,0,__PYX_ERR(0, 840, __pyx_L1_error))
+  __Pyx_TraceLine(759,0,__PYX_ERR(0, 759, __pyx_L1_error))
   __pyx_t_1 = (*__pyx_v_scorer_flags).flags;
   __pyx_v_flags = __pyx_t_1;
 
-  /* "rapidfuzz/process_cpp.pyx":842
+  /* "rapidfuzz/process_cpp_impl.pyx":761
  *     flags = dereference(scorer_flags).flags
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *         return extract_list_f64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  */
-  __Pyx_TraceLine(842,0,__PYX_ERR(0, 842, __pyx_L1_error))
+  __Pyx_TraceLine(761,0,__PYX_ERR(0, 761, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_F64) != 0);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":843
+    /* "rapidfuzz/process_cpp_impl.pyx":762
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  *         return extract_list_f64(             # <<<<<<<<<<<<<<
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  *         )
  */
-    __Pyx_TraceLine(843,0,__PYX_ERR(0, 843, __pyx_L1_error))
+    __Pyx_TraceLine(762,0,__PYX_ERR(0, 762, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
 
-    /* "rapidfuzz/process_cpp.pyx":844
+    /* "rapidfuzz/process_cpp_impl.pyx":763
  *     if flags & RF_SCORER_FLAG_RESULT_F64:
  *         return extract_list_f64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs             # <<<<<<<<<<<<<<
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  */
-    __Pyx_TraceLine(844,0,__PYX_ERR(0, 844, __pyx_L1_error))
-    __pyx_t_3 = __pyx_f_9rapidfuzz_11process_cpp_extract_list_f64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_limit, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 843, __pyx_L1_error)
+    __Pyx_TraceLine(763,0,__PYX_ERR(0, 763, __pyx_L1_error))
+    __pyx_t_3 = __pyx_f_9rapidfuzz_16process_cpp_impl_extract_list_f64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_limit, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 762, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":842
+    /* "rapidfuzz/process_cpp_impl.pyx":761
  *     flags = dereference(scorer_flags).flags
  * 
  *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *         return extract_list_f64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":846
+  /* "rapidfuzz/process_cpp_impl.pyx":765
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *         return extract_list_i64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  */
-  __Pyx_TraceLine(846,0,__PYX_ERR(0, 846, __pyx_L1_error))
+  __Pyx_TraceLine(765,0,__PYX_ERR(0, 765, __pyx_L1_error))
   __pyx_t_2 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_I64) != 0);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":847
+    /* "rapidfuzz/process_cpp_impl.pyx":766
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  *         return extract_list_i64(             # <<<<<<<<<<<<<<
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  *         )
  */
-    __Pyx_TraceLine(847,0,__PYX_ERR(0, 847, __pyx_L1_error))
+    __Pyx_TraceLine(766,0,__PYX_ERR(0, 766, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
 
-    /* "rapidfuzz/process_cpp.pyx":848
+    /* "rapidfuzz/process_cpp_impl.pyx":767
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:
  *         return extract_list_i64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs             # <<<<<<<<<<<<<<
  *         )
  * 
  */
-    __Pyx_TraceLine(848,0,__PYX_ERR(0, 848, __pyx_L1_error))
-    __pyx_t_3 = __pyx_f_9rapidfuzz_11process_cpp_extract_list_i64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_limit, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 847, __pyx_L1_error)
+    __Pyx_TraceLine(767,0,__PYX_ERR(0, 767, __pyx_L1_error))
+    __pyx_t_3 = __pyx_f_9rapidfuzz_16process_cpp_impl_extract_list_i64(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_scorer_flags, __pyx_v_processor, __pyx_v_limit, __pyx_v_score_cutoff, __pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 766, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __pyx_r = __pyx_t_3;
     __pyx_t_3 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":846
+    /* "rapidfuzz/process_cpp_impl.pyx":765
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  *         )
  *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *         return extract_list_i64(
  *             query, choices, scorer, scorer_flags, processor, limit, score_cutoff, kwargs
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":851
+  /* "rapidfuzz/process_cpp_impl.pyx":770
  *         )
  * 
  *     raise ValueError("scorer does not properly use the C-API")             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(851,0,__PYX_ERR(0, 851, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 851, __pyx_L1_error)
+  __Pyx_TraceLine(770,0,__PYX_ERR(0, 770, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 770, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_Raise(__pyx_t_3, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __PYX_ERR(0, 851, __pyx_L1_error)
+  __PYX_ERR(0, 770, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":839
+  /* "rapidfuzz/process_cpp_impl.pyx":758
  * 
  * 
  * cdef inline extract_list(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":876
+/* "rapidfuzz/process_cpp_impl.pyx":795
  * 
  *     if lowest_score_worst:
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])             # <<<<<<<<<<<<<<
  *     else:
  *         return heapq.nsmallest(limit, result_list, key=lambda i: i[1])
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_dict_lambda(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_dict_lambda(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_15py_extract_dict_lambda = {"lambda", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_dict_lambda, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_dict_lambda(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_15py_extract_dict_lambda = {"lambda", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_dict_lambda, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_dict_lambda(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_i = 0;
@@ -11810,33 +12733,33 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_i)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 876, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 795, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda") < 0)) __PYX_ERR(0, 876, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda") < 0)) __PYX_ERR(0, 795, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_i = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("lambda", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 876, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("lambda", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 795, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extract_dict.lambda", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extract_dict.lambda", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_lambda_funcdef_lambda(__pyx_self, __pyx_v_i);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
@@ -11848,52 +12771,52 @@
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("lambda", 0);
-  __Pyx_TraceCall("lambda", __pyx_f[0], 876, 0, __PYX_ERR(0, 876, __pyx_L1_error));
+  __Pyx_TraceCall("lambda", __pyx_f[0], 795, 0, __PYX_ERR(0, 795, __pyx_L1_error));
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_i, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 876, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_i, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 795, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extract_dict.lambda", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extract_dict.lambda", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":878
+/* "rapidfuzz/process_cpp_impl.pyx":797
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])
  *     else:
  *         return heapq.nsmallest(limit, result_list, key=lambda i: i[1])             # <<<<<<<<<<<<<<
  * 
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_dict_1lambda1(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_dict_1lambda1(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_15py_extract_dict_1lambda1 = {"lambda1", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_dict_1lambda1, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_dict_1lambda1(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_15py_extract_dict_1lambda1 = {"lambda1", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_dict_1lambda1, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_dict_1lambda1(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_i = 0;
@@ -11922,33 +12845,33 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_i)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 878, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 797, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda1") < 0)) __PYX_ERR(0, 878, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda1") < 0)) __PYX_ERR(0, 797, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_i = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("lambda1", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 878, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("lambda1", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 797, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extract_dict.lambda1", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extract_dict.lambda1", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_lambda_funcdef_lambda1(__pyx_self, __pyx_v_i);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
@@ -11960,43 +12883,43 @@
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("lambda1", 0);
-  __Pyx_TraceCall("lambda1", __pyx_f[0], 878, 0, __PYX_ERR(0, 878, __pyx_L1_error));
+  __Pyx_TraceCall("lambda1", __pyx_f[0], 797, 0, __PYX_ERR(0, 797, __pyx_L1_error));
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_i, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 878, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_i, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 797, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extract_dict.lambda1", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extract_dict.lambda1", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":854
+/* "rapidfuzz/process_cpp_impl.pyx":773
  * 
  * 
  * cdef inline py_extract_dict(query, choices, scorer, processor, int64_t limit, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef object score = None
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_py_extract_dict(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, double __pyx_v_score_cutoff, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score, PyObject *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_py_extract_dict(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, double __pyx_v_score_cutoff, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score, PyObject *__pyx_v_kwargs) {
   bool __pyx_v_lowest_score_worst;
   PyObject *__pyx_v_score = 0;
   PyObject *__pyx_v_result_list = 0;
   PyObject *__pyx_v_choice_key = NULL;
   PyObject *__pyx_v_choice = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
@@ -12012,131 +12935,131 @@
   int __pyx_t_9;
   PyObject *__pyx_t_10 = NULL;
   int __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("py_extract_dict", 0);
-  __Pyx_TraceCall("py_extract_dict", __pyx_f[0], 854, 0, __PYX_ERR(0, 854, __pyx_L1_error));
+  __Pyx_TraceCall("py_extract_dict", __pyx_f[0], 773, 0, __PYX_ERR(0, 773, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":855
+  /* "rapidfuzz/process_cpp_impl.pyx":774
  * 
  * cdef inline py_extract_dict(query, choices, scorer, processor, int64_t limit, double score_cutoff, worst_score, optimal_score, dict kwargs):
  *     cdef bool lowest_score_worst = optimal_score > worst_score             # <<<<<<<<<<<<<<
  *     cdef object score = None
  *     cdef list result_list = []
  */
-  __Pyx_TraceLine(855,0,__PYX_ERR(0, 855, __pyx_L1_error))
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_optimal_score, __pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 855, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 855, __pyx_L1_error)
+  __Pyx_TraceLine(774,0,__PYX_ERR(0, 774, __pyx_L1_error))
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_optimal_score, __pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 774, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 774, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_lowest_score_worst = __pyx_t_2;
 
-  /* "rapidfuzz/process_cpp.pyx":856
+  /* "rapidfuzz/process_cpp_impl.pyx":775
  * cdef inline py_extract_dict(query, choices, scorer, processor, int64_t limit, double score_cutoff, worst_score, optimal_score, dict kwargs):
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef object score = None             # <<<<<<<<<<<<<<
  *     cdef list result_list = []
  * 
  */
-  __Pyx_TraceLine(856,0,__PYX_ERR(0, 856, __pyx_L1_error))
+  __Pyx_TraceLine(775,0,__PYX_ERR(0, 775, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_score = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":857
+  /* "rapidfuzz/process_cpp_impl.pyx":776
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef object score = None
  *     cdef list result_list = []             # <<<<<<<<<<<<<<
  * 
  *     for choice_key, choice in choices.items():
  */
-  __Pyx_TraceLine(857,0,__PYX_ERR(0, 857, __pyx_L1_error))
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 857, __pyx_L1_error)
+  __Pyx_TraceLine(776,0,__PYX_ERR(0, 776, __pyx_L1_error))
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 776, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_result_list = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":859
+  /* "rapidfuzz/process_cpp_impl.pyx":778
  *     cdef list result_list = []
  * 
  *     for choice_key, choice in choices.items():             # <<<<<<<<<<<<<<
  *         if choice is None:
  *             continue
  */
-  __Pyx_TraceLine(859,0,__PYX_ERR(0, 859, __pyx_L1_error))
+  __Pyx_TraceLine(778,0,__PYX_ERR(0, 778, __pyx_L1_error))
   __pyx_t_3 = 0;
   if (unlikely(__pyx_v_choices == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-    __PYX_ERR(0, 859, __pyx_L1_error)
+    __PYX_ERR(0, 778, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_dict_iterator(__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_4), (&__pyx_t_5)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 859, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_4), (&__pyx_t_5)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 778, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_8 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_4, &__pyx_t_3, &__pyx_t_6, &__pyx_t_7, NULL, __pyx_t_5);
     if (unlikely(__pyx_t_8 == 0)) break;
-    if (unlikely(__pyx_t_8 == -1)) __PYX_ERR(0, 859, __pyx_L1_error)
+    if (unlikely(__pyx_t_8 == -1)) __PYX_ERR(0, 778, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_XDECREF_SET(__pyx_v_choice_key, __pyx_t_6);
     __pyx_t_6 = 0;
     __Pyx_XDECREF_SET(__pyx_v_choice, __pyx_t_7);
     __pyx_t_7 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":860
+    /* "rapidfuzz/process_cpp_impl.pyx":779
  * 
  *     for choice_key, choice in choices.items():
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
-    __Pyx_TraceLine(860,0,__PYX_ERR(0, 860, __pyx_L1_error))
+    __Pyx_TraceLine(779,0,__PYX_ERR(0, 779, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_choice == Py_None);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":861
+      /* "rapidfuzz/process_cpp_impl.pyx":780
  *     for choice_key, choice in choices.items():
  *         if choice is None:
  *             continue             # <<<<<<<<<<<<<<
  * 
  *         if processor is not None:
  */
-      __Pyx_TraceLine(861,0,__PYX_ERR(0, 861, __pyx_L1_error))
+      __Pyx_TraceLine(780,0,__PYX_ERR(0, 780, __pyx_L1_error))
       goto __pyx_L3_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":860
+      /* "rapidfuzz/process_cpp_impl.pyx":779
  * 
  *     for choice_key, choice in choices.items():
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":863
+    /* "rapidfuzz/process_cpp_impl.pyx":782
  *             continue
  * 
  *         if processor is not None:             # <<<<<<<<<<<<<<
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  */
-    __Pyx_TraceLine(863,0,__PYX_ERR(0, 863, __pyx_L1_error))
+    __Pyx_TraceLine(782,0,__PYX_ERR(0, 782, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_processor != Py_None);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":864
+      /* "rapidfuzz/process_cpp_impl.pyx":783
  * 
  *         if processor is not None:
  *             score = scorer(query, processor(choice), **kwargs)             # <<<<<<<<<<<<<<
  *         else:
  *             score = scorer(query, choice, **kwargs)
  */
-      __Pyx_TraceLine(864,0,__PYX_ERR(0, 864, __pyx_L1_error))
+      __Pyx_TraceLine(783,0,__PYX_ERR(0, 783, __pyx_L1_error))
       __Pyx_INCREF(__pyx_v_processor);
       __pyx_t_6 = __pyx_v_processor; __pyx_t_10 = NULL;
       __pyx_t_8 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
         __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_6);
         if (likely(__pyx_t_10)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
@@ -12146,347 +13069,347 @@
           __pyx_t_8 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_v_choice};
         __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
-        if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 864, __pyx_L1_error)
+        if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 783, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       }
-      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 864, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 783, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_INCREF(__pyx_v_query);
       __Pyx_GIVEREF(__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_query);
       __Pyx_GIVEREF(__pyx_t_7);
       PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_7);
       __pyx_t_7 = 0;
       if (unlikely(__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 864, __pyx_L1_error)
+        __PYX_ERR(0, 783, __pyx_L1_error)
       }
-      __pyx_t_7 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 864, __pyx_L1_error)
+      __pyx_t_7 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 783, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 864, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 783, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF_SET(__pyx_v_score, __pyx_t_10);
       __pyx_t_10 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":863
+      /* "rapidfuzz/process_cpp_impl.pyx":782
  *             continue
  * 
  *         if processor is not None:             # <<<<<<<<<<<<<<
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  */
       goto __pyx_L6;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":866
+    /* "rapidfuzz/process_cpp_impl.pyx":785
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  *             score = scorer(query, choice, **kwargs)             # <<<<<<<<<<<<<<
  * 
  *         if lowest_score_worst:
  */
-    __Pyx_TraceLine(866,0,__PYX_ERR(0, 866, __pyx_L1_error))
+    __Pyx_TraceLine(785,0,__PYX_ERR(0, 785, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 785, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_INCREF(__pyx_v_query);
       __Pyx_GIVEREF(__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_query);
       __Pyx_INCREF(__pyx_v_choice);
       __Pyx_GIVEREF(__pyx_v_choice);
       PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_v_choice);
       if (unlikely(__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 866, __pyx_L1_error)
+        __PYX_ERR(0, 785, __pyx_L1_error)
       }
-      __pyx_t_7 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_7 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 785, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_10, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 866, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_10, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 785, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_DECREF_SET(__pyx_v_score, __pyx_t_6);
       __pyx_t_6 = 0;
     }
     __pyx_L6:;
 
-    /* "rapidfuzz/process_cpp.pyx":868
+    /* "rapidfuzz/process_cpp_impl.pyx":787
  *             score = scorer(query, choice, **kwargs)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= score_cutoff:
  *                 result_list.append((choice, score, choice_key))
  */
-    __Pyx_TraceLine(868,0,__PYX_ERR(0, 868, __pyx_L1_error))
+    __Pyx_TraceLine(787,0,__PYX_ERR(0, 787, __pyx_L1_error))
     __pyx_t_9 = (__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":869
+      /* "rapidfuzz/process_cpp_impl.pyx":788
  * 
  *         if lowest_score_worst:
  *             if score >= score_cutoff:             # <<<<<<<<<<<<<<
  *                 result_list.append((choice, score, choice_key))
  *         else:
  */
-      __Pyx_TraceLine(869,0,__PYX_ERR(0, 869, __pyx_L1_error))
-      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 869, __pyx_L1_error)
+      __Pyx_TraceLine(788,0,__PYX_ERR(0, 788, __pyx_L1_error))
+      __pyx_t_6 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 788, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_7 = PyObject_RichCompare(__pyx_v_score, __pyx_t_6, Py_GE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 869, __pyx_L1_error)
+      __pyx_t_7 = PyObject_RichCompare(__pyx_v_score, __pyx_t_6, Py_GE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 788, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 869, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 788, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":870
+        /* "rapidfuzz/process_cpp_impl.pyx":789
  *         if lowest_score_worst:
  *             if score >= score_cutoff:
  *                 result_list.append((choice, score, choice_key))             # <<<<<<<<<<<<<<
  *         else:
  *             if score <= score_cutoff:
  */
-        __Pyx_TraceLine(870,0,__PYX_ERR(0, 870, __pyx_L1_error))
-        __pyx_t_7 = PyTuple_New(3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 870, __pyx_L1_error)
+        __Pyx_TraceLine(789,0,__PYX_ERR(0, 789, __pyx_L1_error))
+        __pyx_t_7 = PyTuple_New(3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 789, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_choice);
         __Pyx_INCREF(__pyx_v_score);
         __Pyx_GIVEREF(__pyx_v_score);
         PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_score);
         __Pyx_INCREF(__pyx_v_choice_key);
         __Pyx_GIVEREF(__pyx_v_choice_key);
         PyTuple_SET_ITEM(__pyx_t_7, 2, __pyx_v_choice_key);
-        __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_result_list, __pyx_t_7); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 870, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_result_list, __pyx_t_7); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 789, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
 
-        /* "rapidfuzz/process_cpp.pyx":869
+        /* "rapidfuzz/process_cpp_impl.pyx":788
  * 
  *         if lowest_score_worst:
  *             if score >= score_cutoff:             # <<<<<<<<<<<<<<
  *                 result_list.append((choice, score, choice_key))
  *         else:
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":868
+      /* "rapidfuzz/process_cpp_impl.pyx":787
  *             score = scorer(query, choice, **kwargs)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= score_cutoff:
  *                 result_list.append((choice, score, choice_key))
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":872
+    /* "rapidfuzz/process_cpp_impl.pyx":791
  *                 result_list.append((choice, score, choice_key))
  *         else:
  *             if score <= score_cutoff:             # <<<<<<<<<<<<<<
  *                 result_list.append((choice, score, choice_key))
  * 
  */
-    __Pyx_TraceLine(872,0,__PYX_ERR(0, 872, __pyx_L1_error))
+    __Pyx_TraceLine(791,0,__PYX_ERR(0, 791, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 872, __pyx_L1_error)
+      __pyx_t_7 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 791, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_t_7, Py_LE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 872, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_t_7, Py_LE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 791, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 872, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 791, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":873
+        /* "rapidfuzz/process_cpp_impl.pyx":792
  *         else:
  *             if score <= score_cutoff:
  *                 result_list.append((choice, score, choice_key))             # <<<<<<<<<<<<<<
  * 
  *     if lowest_score_worst:
  */
-        __Pyx_TraceLine(873,0,__PYX_ERR(0, 873, __pyx_L1_error))
-        __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 873, __pyx_L1_error)
+        __Pyx_TraceLine(792,0,__PYX_ERR(0, 792, __pyx_L1_error))
+        __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 792, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_choice);
         __Pyx_INCREF(__pyx_v_score);
         __Pyx_GIVEREF(__pyx_v_score);
         PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_score);
         __Pyx_INCREF(__pyx_v_choice_key);
         __Pyx_GIVEREF(__pyx_v_choice_key);
         PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_v_choice_key);
-        __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_result_list, __pyx_t_6); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 873, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_result_list, __pyx_t_6); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 792, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-        /* "rapidfuzz/process_cpp.pyx":872
+        /* "rapidfuzz/process_cpp_impl.pyx":791
  *                 result_list.append((choice, score, choice_key))
  *         else:
  *             if score <= score_cutoff:             # <<<<<<<<<<<<<<
  *                 result_list.append((choice, score, choice_key))
  * 
  */
       }
     }
     __pyx_L7:;
     __pyx_L3_continue:;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":875
+  /* "rapidfuzz/process_cpp_impl.pyx":794
  *                 result_list.append((choice, score, choice_key))
  * 
  *     if lowest_score_worst:             # <<<<<<<<<<<<<<
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])
  *     else:
  */
-  __Pyx_TraceLine(875,0,__PYX_ERR(0, 875, __pyx_L1_error))
+  __Pyx_TraceLine(794,0,__PYX_ERR(0, 794, __pyx_L1_error))
   __pyx_t_9 = (__pyx_v_lowest_score_worst != 0);
   if (__pyx_t_9) {
 
-    /* "rapidfuzz/process_cpp.pyx":876
+    /* "rapidfuzz/process_cpp_impl.pyx":795
  * 
  *     if lowest_score_worst:
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])             # <<<<<<<<<<<<<<
  *     else:
  *         return heapq.nsmallest(limit, result_list, key=lambda i: i[1])
  */
-    __Pyx_TraceLine(876,0,__PYX_ERR(0, 876, __pyx_L1_error))
+    __Pyx_TraceLine(795,0,__PYX_ERR(0, 795, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_heapq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 876, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_heapq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 795, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_nlargest); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 876, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_nlargest); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 795, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_limit); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 876, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_limit); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 795, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 876, __pyx_L1_error)
+    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 795, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
     __Pyx_INCREF(__pyx_v_result_list);
     __Pyx_GIVEREF(__pyx_v_result_list);
     PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_result_list);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 876, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 795, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_10 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_15py_extract_dict_lambda, 0, __pyx_n_s_py_extract_dict_locals_lambda, NULL, __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 876, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_15py_extract_dict_lambda, 0, __pyx_n_s_py_extract_dict_locals_lambda, NULL, __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 795, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_key, __pyx_t_10) < 0) __PYX_ERR(0, 876, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_key, __pyx_t_10) < 0) __PYX_ERR(0, 795, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 876, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 795, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_r = __pyx_t_10;
     __pyx_t_10 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":875
+    /* "rapidfuzz/process_cpp_impl.pyx":794
  *                 result_list.append((choice, score, choice_key))
  * 
  *     if lowest_score_worst:             # <<<<<<<<<<<<<<
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])
  *     else:
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":878
+  /* "rapidfuzz/process_cpp_impl.pyx":797
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])
  *     else:
  *         return heapq.nsmallest(limit, result_list, key=lambda i: i[1])             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(878,0,__PYX_ERR(0, 878, __pyx_L1_error))
+  __Pyx_TraceLine(797,0,__PYX_ERR(0, 797, __pyx_L1_error))
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_heapq); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 878, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_heapq); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 797, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_nsmallest); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 878, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_nsmallest); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 797, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    __pyx_t_10 = __Pyx_PyInt_From_int64_t(__pyx_v_limit); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 878, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_From_int64_t(__pyx_v_limit); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 797, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 878, __pyx_L1_error)
+    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 797, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_10);
     PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_10);
     __Pyx_INCREF(__pyx_v_result_list);
     __Pyx_GIVEREF(__pyx_v_result_list);
     PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_result_list);
     __pyx_t_10 = 0;
-    __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 878, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 797, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_10);
-    __pyx_t_6 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_15py_extract_dict_1lambda1, 0, __pyx_n_s_py_extract_dict_locals_lambda, NULL, __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 878, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_15py_extract_dict_1lambda1, 0, __pyx_n_s_py_extract_dict_locals_lambda, NULL, __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 797, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_key, __pyx_t_6) < 0) __PYX_ERR(0, 878, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_key, __pyx_t_6) < 0) __PYX_ERR(0, 797, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, __pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 878, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_7, __pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 797, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":854
+  /* "rapidfuzz/process_cpp_impl.pyx":773
  * 
  * 
  * cdef inline py_extract_dict(query, choices, scorer, processor, int64_t limit, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef object score = None
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_10);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extract_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extract_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_score);
   __Pyx_XDECREF(__pyx_v_result_list);
   __Pyx_XDECREF(__pyx_v_choice_key);
   __Pyx_XDECREF(__pyx_v_choice);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":904
+/* "rapidfuzz/process_cpp_impl.pyx":823
  * 
  *     if lowest_score_worst:
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])             # <<<<<<<<<<<<<<
  *     else:
  *         return heapq.nsmallest(limit, result_list, key=lambda i: i[1])
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_list_lambda2(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_list_lambda2(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_15py_extract_list_lambda2 = {"lambda2", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_list_lambda2, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_list_lambda2(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_15py_extract_list_lambda2 = {"lambda2", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_list_lambda2, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_list_lambda2(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_i = 0;
@@ -12515,33 +13438,33 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_i)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 904, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 823, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda2") < 0)) __PYX_ERR(0, 904, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda2") < 0)) __PYX_ERR(0, 823, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_i = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("lambda2", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 904, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("lambda2", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 823, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extract_list.lambda2", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extract_list.lambda2", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_lambda_funcdef_lambda2(__pyx_self, __pyx_v_i);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
@@ -12553,52 +13476,52 @@
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("lambda2", 0);
-  __Pyx_TraceCall("lambda2", __pyx_f[0], 904, 0, __PYX_ERR(0, 904, __pyx_L1_error));
+  __Pyx_TraceCall("lambda2", __pyx_f[0], 823, 0, __PYX_ERR(0, 823, __pyx_L1_error));
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_i, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 904, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_i, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extract_list.lambda2", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extract_list.lambda2", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":906
+/* "rapidfuzz/process_cpp_impl.pyx":825
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])
  *     else:
  *         return heapq.nsmallest(limit, result_list, key=lambda i: i[1])             # <<<<<<<<<<<<<<
  * 
  * 
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_list_1lambda3(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_list_1lambda3(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_15py_extract_list_1lambda3 = {"lambda3", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_list_1lambda3, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_15py_extract_list_1lambda3(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_15py_extract_list_1lambda3 = {"lambda3", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_list_1lambda3, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_15py_extract_list_1lambda3(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_i = 0;
@@ -12627,33 +13550,33 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_i)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 906, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 825, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda3") < 0)) __PYX_ERR(0, 906, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda3") < 0)) __PYX_ERR(0, 825, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
     __pyx_v_i = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("lambda3", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 906, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("lambda3", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 825, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extract_list.lambda3", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extract_list.lambda3", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
   __pyx_r = __pyx_lambda_funcdef_lambda3(__pyx_self, __pyx_v_i);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
@@ -12665,43 +13588,43 @@
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("lambda3", 0);
-  __Pyx_TraceCall("lambda3", __pyx_f[0], 906, 0, __PYX_ERR(0, 906, __pyx_L1_error));
+  __Pyx_TraceCall("lambda3", __pyx_f[0], 825, 0, __PYX_ERR(0, 825, __pyx_L1_error));
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_i, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 906, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_i, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 825, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extract_list.lambda3", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extract_list.lambda3", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":881
+/* "rapidfuzz/process_cpp_impl.pyx":800
  * 
  * 
  * cdef inline py_extract_list(query, choices, scorer, processor, int64_t limit, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef object score = None
  */
 
-static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_11process_cpp_py_extract_list(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, double __pyx_v_score_cutoff, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score, PyObject *__pyx_v_kwargs) {
+static CYTHON_INLINE PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_py_extract_list(PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, int64_t __pyx_v_limit, double __pyx_v_score_cutoff, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score, PyObject *__pyx_v_kwargs) {
   bool __pyx_v_lowest_score_worst;
   PyObject *__pyx_v_score = 0;
   PyObject *__pyx_v_result_list = 0;
   int64_t __pyx_v_i;
   PyObject *__pyx_v_choice = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
@@ -12717,155 +13640,155 @@
   PyObject *__pyx_t_9 = NULL;
   int __pyx_t_10;
   int __pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("py_extract_list", 0);
-  __Pyx_TraceCall("py_extract_list", __pyx_f[0], 881, 0, __PYX_ERR(0, 881, __pyx_L1_error));
+  __Pyx_TraceCall("py_extract_list", __pyx_f[0], 800, 0, __PYX_ERR(0, 800, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":882
+  /* "rapidfuzz/process_cpp_impl.pyx":801
  * 
  * cdef inline py_extract_list(query, choices, scorer, processor, int64_t limit, double score_cutoff, worst_score, optimal_score, dict kwargs):
  *     cdef bool lowest_score_worst = optimal_score > worst_score             # <<<<<<<<<<<<<<
  *     cdef object score = None
  *     cdef list result_list = []
  */
-  __Pyx_TraceLine(882,0,__PYX_ERR(0, 882, __pyx_L1_error))
-  __pyx_t_1 = PyObject_RichCompare(__pyx_v_optimal_score, __pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 882, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 882, __pyx_L1_error)
+  __Pyx_TraceLine(801,0,__PYX_ERR(0, 801, __pyx_L1_error))
+  __pyx_t_1 = PyObject_RichCompare(__pyx_v_optimal_score, __pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 801, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 801, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_lowest_score_worst = __pyx_t_2;
 
-  /* "rapidfuzz/process_cpp.pyx":883
+  /* "rapidfuzz/process_cpp_impl.pyx":802
  * cdef inline py_extract_list(query, choices, scorer, processor, int64_t limit, double score_cutoff, worst_score, optimal_score, dict kwargs):
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef object score = None             # <<<<<<<<<<<<<<
  *     cdef list result_list = []
  *     cdef int64_t i
  */
-  __Pyx_TraceLine(883,0,__PYX_ERR(0, 883, __pyx_L1_error))
+  __Pyx_TraceLine(802,0,__PYX_ERR(0, 802, __pyx_L1_error))
   __Pyx_INCREF(Py_None);
   __pyx_v_score = Py_None;
 
-  /* "rapidfuzz/process_cpp.pyx":884
+  /* "rapidfuzz/process_cpp_impl.pyx":803
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef object score = None
  *     cdef list result_list = []             # <<<<<<<<<<<<<<
  *     cdef int64_t i
  * 
  */
-  __Pyx_TraceLine(884,0,__PYX_ERR(0, 884, __pyx_L1_error))
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 884, __pyx_L1_error)
+  __Pyx_TraceLine(803,0,__PYX_ERR(0, 803, __pyx_L1_error))
+  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 803, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_result_list = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":887
+  /* "rapidfuzz/process_cpp_impl.pyx":806
  *     cdef int64_t i
  * 
  *     for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *         if choice is None:
  *             continue
  */
-  __Pyx_TraceLine(887,0,__PYX_ERR(0, 887, __pyx_L1_error))
+  __Pyx_TraceLine(806,0,__PYX_ERR(0, 806, __pyx_L1_error))
   __pyx_t_3 = 0;
   if (likely(PyList_CheckExact(__pyx_v_choices)) || PyTuple_CheckExact(__pyx_v_choices)) {
     __pyx_t_1 = __pyx_v_choices; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
     __pyx_t_5 = NULL;
   } else {
-    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_choices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 887, __pyx_L1_error)
+    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_choices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 806, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 887, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 806, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_5)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 806, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 887, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 806, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
       } else {
         if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 887, __pyx_L1_error)
+        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 806, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 887, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 806, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
       }
     } else {
       __pyx_t_6 = __pyx_t_5(__pyx_t_1);
       if (unlikely(!__pyx_t_6)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 887, __pyx_L1_error)
+          else __PYX_ERR(0, 806, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_6);
     }
     __Pyx_XDECREF_SET(__pyx_v_choice, __pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_v_i = __pyx_t_3;
     __pyx_t_3 = (__pyx_t_3 + 1);
 
-    /* "rapidfuzz/process_cpp.pyx":888
+    /* "rapidfuzz/process_cpp_impl.pyx":807
  * 
  *     for i, choice in enumerate(choices):
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
-    __Pyx_TraceLine(888,0,__PYX_ERR(0, 888, __pyx_L1_error))
+    __Pyx_TraceLine(807,0,__PYX_ERR(0, 807, __pyx_L1_error))
     __pyx_t_7 = (__pyx_v_choice == Py_None);
     if (__pyx_t_7) {
 
-      /* "rapidfuzz/process_cpp.pyx":889
+      /* "rapidfuzz/process_cpp_impl.pyx":808
  *     for i, choice in enumerate(choices):
  *         if choice is None:
  *             continue             # <<<<<<<<<<<<<<
  * 
  *         if processor is not None:
  */
-      __Pyx_TraceLine(889,0,__PYX_ERR(0, 889, __pyx_L1_error))
+      __Pyx_TraceLine(808,0,__PYX_ERR(0, 808, __pyx_L1_error))
       goto __pyx_L3_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":888
+      /* "rapidfuzz/process_cpp_impl.pyx":807
  * 
  *     for i, choice in enumerate(choices):
  *         if choice is None:             # <<<<<<<<<<<<<<
  *             continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":891
+    /* "rapidfuzz/process_cpp_impl.pyx":810
  *             continue
  * 
  *         if processor is not None:             # <<<<<<<<<<<<<<
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  */
-    __Pyx_TraceLine(891,0,__PYX_ERR(0, 891, __pyx_L1_error))
+    __Pyx_TraceLine(810,0,__PYX_ERR(0, 810, __pyx_L1_error))
     __pyx_t_7 = (__pyx_v_processor != Py_None);
     if (__pyx_t_7) {
 
-      /* "rapidfuzz/process_cpp.pyx":892
+      /* "rapidfuzz/process_cpp_impl.pyx":811
  * 
  *         if processor is not None:
  *             score = scorer(query, processor(choice), **kwargs)             # <<<<<<<<<<<<<<
  *         else:
  *             score = scorer(query, choice, **kwargs)
  */
-      __Pyx_TraceLine(892,0,__PYX_ERR(0, 892, __pyx_L1_error))
+      __Pyx_TraceLine(811,0,__PYX_ERR(0, 811, __pyx_L1_error))
       __Pyx_INCREF(__pyx_v_processor);
       __pyx_t_8 = __pyx_v_processor; __pyx_t_9 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -12875,368 +13798,368 @@
           __pyx_t_10 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_v_choice};
         __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 892, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 811, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       }
-      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 892, __pyx_L1_error)
+      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 811, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_INCREF(__pyx_v_query);
       __Pyx_GIVEREF(__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_query);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_6);
       __pyx_t_6 = 0;
       if (unlikely(__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 892, __pyx_L1_error)
+        __PYX_ERR(0, 811, __pyx_L1_error)
       }
-      __pyx_t_6 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 892, __pyx_L1_error)
+      __pyx_t_6 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 811, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 892, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 811, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF_SET(__pyx_v_score, __pyx_t_9);
       __pyx_t_9 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":891
+      /* "rapidfuzz/process_cpp_impl.pyx":810
  *             continue
  * 
  *         if processor is not None:             # <<<<<<<<<<<<<<
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  */
       goto __pyx_L6;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":894
+    /* "rapidfuzz/process_cpp_impl.pyx":813
  *             score = scorer(query, processor(choice), **kwargs)
  *         else:
  *             score = scorer(query, choice, **kwargs)             # <<<<<<<<<<<<<<
  * 
  *         if lowest_score_worst:
  */
-    __Pyx_TraceLine(894,0,__PYX_ERR(0, 894, __pyx_L1_error))
+    __Pyx_TraceLine(813,0,__PYX_ERR(0, 813, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 813, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_INCREF(__pyx_v_query);
       __Pyx_GIVEREF(__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_query);
       __Pyx_INCREF(__pyx_v_choice);
       __Pyx_GIVEREF(__pyx_v_choice);
       PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_v_choice);
       if (unlikely(__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 894, __pyx_L1_error)
+        __PYX_ERR(0, 813, __pyx_L1_error)
       }
-      __pyx_t_6 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_6 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 813, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 894, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 813, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF_SET(__pyx_v_score, __pyx_t_8);
       __pyx_t_8 = 0;
     }
     __pyx_L6:;
 
-    /* "rapidfuzz/process_cpp.pyx":896
+    /* "rapidfuzz/process_cpp_impl.pyx":815
  *             score = scorer(query, choice, **kwargs)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= score_cutoff:
  *                 result_list.append((choice, score, i))
  */
-    __Pyx_TraceLine(896,0,__PYX_ERR(0, 896, __pyx_L1_error))
+    __Pyx_TraceLine(815,0,__PYX_ERR(0, 815, __pyx_L1_error))
     __pyx_t_7 = (__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_7) {
 
-      /* "rapidfuzz/process_cpp.pyx":897
+      /* "rapidfuzz/process_cpp_impl.pyx":816
  * 
  *         if lowest_score_worst:
  *             if score >= score_cutoff:             # <<<<<<<<<<<<<<
  *                 result_list.append((choice, score, i))
  *         else:
  */
-      __Pyx_TraceLine(897,0,__PYX_ERR(0, 897, __pyx_L1_error))
-      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 897, __pyx_L1_error)
+      __Pyx_TraceLine(816,0,__PYX_ERR(0, 816, __pyx_L1_error))
+      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 816, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_t_8, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 897, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_t_8, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 816, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 897, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 816, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_7) {
 
-        /* "rapidfuzz/process_cpp.pyx":898
+        /* "rapidfuzz/process_cpp_impl.pyx":817
  *         if lowest_score_worst:
  *             if score >= score_cutoff:
  *                 result_list.append((choice, score, i))             # <<<<<<<<<<<<<<
  *         else:
  *             if score <= score_cutoff:
  */
-        __Pyx_TraceLine(898,0,__PYX_ERR(0, 898, __pyx_L1_error))
-        __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 898, __pyx_L1_error)
+        __Pyx_TraceLine(817,0,__PYX_ERR(0, 817, __pyx_L1_error))
+        __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 817, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 898, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 817, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_choice);
         __Pyx_INCREF(__pyx_v_score);
         __Pyx_GIVEREF(__pyx_v_score);
         PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_score);
         __Pyx_GIVEREF(__pyx_t_6);
         PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_6);
         __pyx_t_6 = 0;
-        __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_result_list, __pyx_t_8); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 898, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_result_list, __pyx_t_8); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 817, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-        /* "rapidfuzz/process_cpp.pyx":897
+        /* "rapidfuzz/process_cpp_impl.pyx":816
  * 
  *         if lowest_score_worst:
  *             if score >= score_cutoff:             # <<<<<<<<<<<<<<
  *                 result_list.append((choice, score, i))
  *         else:
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":896
+      /* "rapidfuzz/process_cpp_impl.pyx":815
  *             score = scorer(query, choice, **kwargs)
  * 
  *         if lowest_score_worst:             # <<<<<<<<<<<<<<
  *             if score >= score_cutoff:
  *                 result_list.append((choice, score, i))
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":900
+    /* "rapidfuzz/process_cpp_impl.pyx":819
  *                 result_list.append((choice, score, i))
  *         else:
  *             if score <= score_cutoff:             # <<<<<<<<<<<<<<
  *                 result_list.append((choice, score, i))
  * 
  */
-    __Pyx_TraceLine(900,0,__PYX_ERR(0, 900, __pyx_L1_error))
+    __Pyx_TraceLine(819,0,__PYX_ERR(0, 819, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 900, __pyx_L1_error)
+      __pyx_t_8 = PyFloat_FromDouble(__pyx_v_score_cutoff); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 819, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_t_8, Py_LE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 900, __pyx_L1_error)
+      __pyx_t_6 = PyObject_RichCompare(__pyx_v_score, __pyx_t_8, Py_LE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 819, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 900, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 819, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_7) {
 
-        /* "rapidfuzz/process_cpp.pyx":901
+        /* "rapidfuzz/process_cpp_impl.pyx":820
  *         else:
  *             if score <= score_cutoff:
  *                 result_list.append((choice, score, i))             # <<<<<<<<<<<<<<
  * 
  *     if lowest_score_worst:
  */
-        __Pyx_TraceLine(901,0,__PYX_ERR(0, 901, __pyx_L1_error))
-        __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 901, __pyx_L1_error)
+        __Pyx_TraceLine(820,0,__PYX_ERR(0, 820, __pyx_L1_error))
+        __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 820, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 820, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_INCREF(__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_choice);
         __Pyx_INCREF(__pyx_v_score);
         __Pyx_GIVEREF(__pyx_v_score);
         PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_score);
         __Pyx_GIVEREF(__pyx_t_6);
         PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_6);
         __pyx_t_6 = 0;
-        __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_result_list, __pyx_t_8); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 901, __pyx_L1_error)
+        __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_result_list, __pyx_t_8); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 820, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-        /* "rapidfuzz/process_cpp.pyx":900
+        /* "rapidfuzz/process_cpp_impl.pyx":819
  *                 result_list.append((choice, score, i))
  *         else:
  *             if score <= score_cutoff:             # <<<<<<<<<<<<<<
  *                 result_list.append((choice, score, i))
  * 
  */
       }
     }
     __pyx_L7:;
 
-    /* "rapidfuzz/process_cpp.pyx":887
+    /* "rapidfuzz/process_cpp_impl.pyx":806
  *     cdef int64_t i
  * 
  *     for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *         if choice is None:
  *             continue
  */
-    __Pyx_TraceLine(887,0,__PYX_ERR(0, 887, __pyx_L1_error))
+    __Pyx_TraceLine(806,0,__PYX_ERR(0, 806, __pyx_L1_error))
     __pyx_L3_continue:;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":903
+  /* "rapidfuzz/process_cpp_impl.pyx":822
  *                 result_list.append((choice, score, i))
  * 
  *     if lowest_score_worst:             # <<<<<<<<<<<<<<
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])
  *     else:
  */
-  __Pyx_TraceLine(903,0,__PYX_ERR(0, 903, __pyx_L1_error))
+  __Pyx_TraceLine(822,0,__PYX_ERR(0, 822, __pyx_L1_error))
   __pyx_t_7 = (__pyx_v_lowest_score_worst != 0);
   if (__pyx_t_7) {
 
-    /* "rapidfuzz/process_cpp.pyx":904
+    /* "rapidfuzz/process_cpp_impl.pyx":823
  * 
  *     if lowest_score_worst:
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])             # <<<<<<<<<<<<<<
  *     else:
  *         return heapq.nsmallest(limit, result_list, key=lambda i: i[1])
  */
-    __Pyx_TraceLine(904,0,__PYX_ERR(0, 904, __pyx_L1_error))
+    __Pyx_TraceLine(823,0,__PYX_ERR(0, 823, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_heapq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 904, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_heapq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_nlargest); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 904, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_nlargest); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_limit); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 904, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyInt_From_int64_t(__pyx_v_limit); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 904, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_1);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_1);
     __Pyx_INCREF(__pyx_v_result_list);
     __Pyx_GIVEREF(__pyx_v_result_list);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_result_list);
     __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 904, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_9 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_15py_extract_list_lambda2, 0, __pyx_n_s_py_extract_list_locals_lambda, NULL, __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 904, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_15py_extract_list_lambda2, 0, __pyx_n_s_py_extract_list_locals_lambda, NULL, __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_key, __pyx_t_9) < 0) __PYX_ERR(0, 904, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_key, __pyx_t_9) < 0) __PYX_ERR(0, 823, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 904, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_t_6, __pyx_t_1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 823, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_r = __pyx_t_9;
     __pyx_t_9 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":903
+    /* "rapidfuzz/process_cpp_impl.pyx":822
  *                 result_list.append((choice, score, i))
  * 
  *     if lowest_score_worst:             # <<<<<<<<<<<<<<
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])
  *     else:
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":906
+  /* "rapidfuzz/process_cpp_impl.pyx":825
  *         return heapq.nlargest(limit, result_list, key=lambda i: i[1])
  *     else:
  *         return heapq.nsmallest(limit, result_list, key=lambda i: i[1])             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(906,0,__PYX_ERR(0, 906, __pyx_L1_error))
+  __Pyx_TraceLine(825,0,__PYX_ERR(0, 825, __pyx_L1_error))
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_heapq); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 906, __pyx_L1_error)
+    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_heapq); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 825, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_nsmallest); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 906, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_nsmallest); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 825, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyInt_From_int64_t(__pyx_v_limit); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 906, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyInt_From_int64_t(__pyx_v_limit); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 825, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 906, __pyx_L1_error)
+    __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 825, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_9);
     PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_9);
     __Pyx_INCREF(__pyx_v_result_list);
     __Pyx_GIVEREF(__pyx_v_result_list);
     PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_result_list);
     __pyx_t_9 = 0;
-    __pyx_t_9 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 906, __pyx_L1_error)
+    __pyx_t_9 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 825, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
-    __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_15py_extract_list_1lambda3, 0, __pyx_n_s_py_extract_list_locals_lambda, NULL, __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 906, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_15py_extract_list_1lambda3, 0, __pyx_n_s_py_extract_list_locals_lambda, NULL, __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 825, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
-    if (PyDict_SetItem(__pyx_t_9, __pyx_n_s_key, __pyx_t_8) < 0) __PYX_ERR(0, 906, __pyx_L1_error)
+    if (PyDict_SetItem(__pyx_t_9, __pyx_n_s_key, __pyx_t_8) < 0) __PYX_ERR(0, 825, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 906, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 825, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_r = __pyx_t_8;
     __pyx_t_8 = 0;
     goto __pyx_L0;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":881
+  /* "rapidfuzz/process_cpp_impl.pyx":800
  * 
  * 
  * cdef inline py_extract_list(query, choices, scorer, processor, int64_t limit, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef object score = None
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_8);
   __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.py_extract_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.py_extract_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_score);
   __Pyx_XDECREF(__pyx_v_result_list);
   __Pyx_XDECREF(__pyx_v_choice);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":909
+/* "rapidfuzz/process_cpp_impl.pyx":828
  * 
  * 
  * def extract(query, choices, *, scorer=WRatio, processor=default_process, limit=5, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best matches in a list of choices. The list is sorted by the similarity.
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_9__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_11__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 909, 0, __PYX_ERR(0, 909, __pyx_L1_error));
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 828, 0, __PYX_ERR(0, 828, __pyx_L1_error));
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 909, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 828, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_scorer, __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_scorer) < 0) __PYX_ERR(0, 909, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 909, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_limit, ((PyObject *)__pyx_int_5)) < 0) __PYX_ERR(0, 909, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 909, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 909, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_scorer, __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_scorer) < 0) __PYX_ERR(0, 828, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 828, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_limit, ((PyObject *)__pyx_int_5)) < 0) __PYX_ERR(0, 828, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 828, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 828, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
   __pyx_t_1 = 0;
@@ -13244,34 +14167,33 @@
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_3extract(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_3extract(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_11process_cpp_2extract, "\n    Find the best matches in a list of choices. The list is sorted by the similarity.\n    When multiple choices have the same similarity, they are sorted by their index\n\n    Parameters\n    ----------\n    query : Sequence[Hashable]\n        string we want to find\n    choices : Collection[Sequence[Hashable]] | Mapping[Sequence[Hashable]]\n        list of all strings the query should be compared with or dict with a mapping\n        {<result>: <string to compare>}\n    scorer : Callable, optional\n        Optional callable that is used to calculate the matching score between\n        the query and each choice. This can be any of the scorers included in RapidFuzz\n        (both scorers that calculate the edit distance or the normalized edit distance), or\n        a custom function, which returns a normalized edit distance.\n        fuzz.WRatio is used by default.\n    processor : Callable, optional\n        Optional callable that reformats the strings.\n        utils.default_process is used by default, which lowercases the strings and trims whitespace\n    limit : int\n        maximum amount of results to return\n    score_cutoff : Any, optional\n        Optional argument for a score threshold. When an edit distance is used this represents the maximum\n        edit distance and matches with a `distance <= score_cutoff` are ignored. When a\n        normalized edit distance is used this represents the minimal similarity\n        and matches with a `similarity >= score_cutoff` are ignored. Default is None, which deactivates this behaviour.\n    **kwargs : Any, optional\n        any other named parameters are passed to the scorer. This can be used to pass\n        e.g. weights to string_metric.levenshtein\n\n    Returns\n    -------\n    List[Tuple[Sequence[Hashable], Any, Any]]\n        The return type is always a List of Tuples with 3 elements. However the values stored in the\n        tuple depend on the types of the input arguments.\n\n        * The first element"" is always the `choice`, which is the value thats compared to the query.\n\n        * The second value represents the similarity calculated by the scorer. This can be:\n\n          * An edit distance (distance is 0 for a perfect match and > 0 for non perfect matches).\n            In this case only choices which have a `distance <= max` are returned.\n            An example of a scorer with this behavior is `string_metric.levenshtein`.\n          * A normalized edit distance (similarity is a score between 0 and 100, with 100 being a perfect match).\n            In this case only choices which have a `similarity >= score_cutoff` are returned.\n            An example of a scorer with this behavior is `string_metric.normalized_levenshtein`.\n\n          Note, that for all scorers, which are not provided by RapidFuzz, only normalized edit distances are supported.\n\n        * The third parameter depends on the type of the `choices` argument it is:\n\n          * The `index of choice` when choices is a simple iterable like a list\n          * The `key of choice` when choices is a mapping like a dict, or a pandas Series\n\n        The list is sorted by `score_cutoff` or `max` depending on the scorer used. The first element in the list\n        has the `highest similarity`/`smallest distance`.\n\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_3extract = {"extract", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_11process_cpp_3extract, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_11process_cpp_2extract};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_3extract(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_3extract = {"extract", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_3extract, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_3extract(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_query = 0;
@@ -13315,35 +14237,35 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_query)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 909, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 828, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_choices)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 909, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 828, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("extract", 1, 2, 2, 1); __PYX_ERR(0, 909, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("extract", 1, 2, 2, 1); __PYX_ERR(0, 828, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && (kw_args <= 4)) {
         Py_ssize_t index;
         for (index = 2; index < 6 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 909, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 828, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kwargs, values + 0, kwd_pos_args, "extract") < 0)) __PYX_ERR(0, 909, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kwargs, values + 0, kwd_pos_args, "extract") < 0)) __PYX_ERR(0, 828, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
@@ -13352,30 +14274,30 @@
     __pyx_v_scorer = values[2];
     __pyx_v_processor = values[3];
     __pyx_v_limit = values[4];
     __pyx_v_score_cutoff = values[5];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("extract", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 909, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("extract", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 828, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_DECREF(__pyx_v_kwargs); __pyx_v_kwargs = 0;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_11process_cpp_2extract(__pyx_self, __pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_v_limit, __pyx_v_score_cutoff, __pyx_v_kwargs);
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_2extract(__pyx_self, __pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_v_limit, __pyx_v_score_cutoff, __pyx_v_kwargs);
 
   /* function exit code */
   __Pyx_DECREF(__pyx_v_kwargs);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_2extract(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_limit, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs) {
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_2extract(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_limit, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs) {
   RF_Scorer *__pyx_v_scorer_context;
   RF_ScorerFlags __pyx_v_scorer_flags;
   PyObject *__pyx_v_scorer_capsule = NULL;
   RF_KwargsWrapper __pyx_v_kwargs_context;
   PyObject *__pyx_v_worst_score = NULL;
   PyObject *__pyx_v_optimal_score = NULL;
   PyObject *__pyx_r = NULL;
@@ -13395,198 +14317,198 @@
   PyObject *(*__pyx_t_12)(PyObject *);
   double __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_TraceFrameInit(__pyx_codeobj__4)
   __Pyx_RefNannySetupContext("extract", 0);
-  __Pyx_TraceCall("extract", __pyx_f[0], 909, 0, __PYX_ERR(0, 909, __pyx_L1_error));
+  __Pyx_TraceCall("extract", __pyx_f[0], 828, 0, __PYX_ERR(0, 828, __pyx_L1_error));
   __Pyx_INCREF(__pyx_v_query);
   __Pyx_INCREF(__pyx_v_processor);
   __Pyx_INCREF(__pyx_v_limit);
   __Pyx_INCREF(__pyx_v_score_cutoff);
 
-  /* "rapidfuzz/process_cpp.pyx":969
+  /* "rapidfuzz/process_cpp_impl.pyx":829
  * 
- *     """
+ * def extract(query, choices, *, scorer=WRatio, processor=default_process, limit=5, score_cutoff=None, **kwargs):
  *     cdef RF_Scorer* scorer_context = NULL             # <<<<<<<<<<<<<<
  *     cdef RF_ScorerFlags scorer_flags
  * 
  */
-  __Pyx_TraceLine(969,0,__PYX_ERR(0, 969, __pyx_L1_error))
+  __Pyx_TraceLine(829,0,__PYX_ERR(0, 829, __pyx_L1_error))
   __pyx_v_scorer_context = NULL;
 
-  /* "rapidfuzz/process_cpp.pyx":972
+  /* "rapidfuzz/process_cpp_impl.pyx":832
  *     cdef RF_ScorerFlags scorer_flags
  * 
  *     if query is None:             # <<<<<<<<<<<<<<
  *         return []
  * 
  */
-  __Pyx_TraceLine(972,0,__PYX_ERR(0, 972, __pyx_L1_error))
+  __Pyx_TraceLine(832,0,__PYX_ERR(0, 832, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_query == Py_None);
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":973
+    /* "rapidfuzz/process_cpp_impl.pyx":833
  * 
  *     if query is None:
  *         return []             # <<<<<<<<<<<<<<
  * 
  *     if processor is True:
  */
-    __Pyx_TraceLine(973,0,__PYX_ERR(0, 973, __pyx_L1_error))
+    __Pyx_TraceLine(833,0,__PYX_ERR(0, 833, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 973, __pyx_L1_error)
+    __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 833, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __pyx_r = __pyx_t_2;
     __pyx_t_2 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":972
+    /* "rapidfuzz/process_cpp_impl.pyx":832
  *     cdef RF_ScorerFlags scorer_flags
  * 
  *     if query is None:             # <<<<<<<<<<<<<<
  *         return []
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":975
+  /* "rapidfuzz/process_cpp_impl.pyx":835
  *         return []
  * 
  *     if processor is True:             # <<<<<<<<<<<<<<
  *         processor = default_process
  *     elif processor is False:
  */
-  __Pyx_TraceLine(975,0,__PYX_ERR(0, 975, __pyx_L1_error))
+  __Pyx_TraceLine(835,0,__PYX_ERR(0, 835, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_processor == Py_True);
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":976
+    /* "rapidfuzz/process_cpp_impl.pyx":836
  * 
  *     if processor is True:
  *         processor = default_process             # <<<<<<<<<<<<<<
  *     elif processor is False:
  *         processor = None
  */
-    __Pyx_TraceLine(976,0,__PYX_ERR(0, 976, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 976, __pyx_L1_error)
+    __Pyx_TraceLine(836,0,__PYX_ERR(0, 836, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 836, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF_SET(__pyx_v_processor, __pyx_t_2);
     __pyx_t_2 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":975
+    /* "rapidfuzz/process_cpp_impl.pyx":835
  *         return []
  * 
  *     if processor is True:             # <<<<<<<<<<<<<<
  *         processor = default_process
  *     elif processor is False:
  */
     goto __pyx_L4;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":977
+  /* "rapidfuzz/process_cpp_impl.pyx":837
  *     if processor is True:
  *         processor = default_process
  *     elif processor is False:             # <<<<<<<<<<<<<<
  *         processor = None
  * 
  */
-  __Pyx_TraceLine(977,0,__PYX_ERR(0, 977, __pyx_L1_error))
+  __Pyx_TraceLine(837,0,__PYX_ERR(0, 837, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_processor == Py_False);
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":978
+    /* "rapidfuzz/process_cpp_impl.pyx":838
  *         processor = default_process
  *     elif processor is False:
  *         processor = None             # <<<<<<<<<<<<<<
  * 
  *     if limit is None or limit > len(choices):
  */
-    __Pyx_TraceLine(978,0,__PYX_ERR(0, 978, __pyx_L1_error))
+    __Pyx_TraceLine(838,0,__PYX_ERR(0, 838, __pyx_L1_error))
     __Pyx_INCREF(Py_None);
     __Pyx_DECREF_SET(__pyx_v_processor, Py_None);
 
-    /* "rapidfuzz/process_cpp.pyx":977
+    /* "rapidfuzz/process_cpp_impl.pyx":837
  *     if processor is True:
  *         processor = default_process
  *     elif processor is False:             # <<<<<<<<<<<<<<
  *         processor = None
  * 
  */
   }
   __pyx_L4:;
 
-  /* "rapidfuzz/process_cpp.pyx":980
+  /* "rapidfuzz/process_cpp_impl.pyx":840
  *         processor = None
  * 
  *     if limit is None or limit > len(choices):             # <<<<<<<<<<<<<<
  *         limit = len(choices)
  * 
  */
-  __Pyx_TraceLine(980,0,__PYX_ERR(0, 980, __pyx_L1_error))
+  __Pyx_TraceLine(840,0,__PYX_ERR(0, 840, __pyx_L1_error))
   __pyx_t_3 = (__pyx_v_limit == Py_None);
   if (!__pyx_t_3) {
   } else {
     __pyx_t_1 = __pyx_t_3;
     goto __pyx_L6_bool_binop_done;
   }
-  __pyx_t_4 = PyObject_Length(__pyx_v_choices); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 980, __pyx_L1_error)
-  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 980, __pyx_L1_error)
+  __pyx_t_4 = PyObject_Length(__pyx_v_choices); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 840, __pyx_L1_error)
+  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 840, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyObject_RichCompare(__pyx_v_limit, __pyx_t_2, Py_GT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 980, __pyx_L1_error)
+  __pyx_t_5 = PyObject_RichCompare(__pyx_v_limit, __pyx_t_2, Py_GT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 840, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 980, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 840, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_1 = __pyx_t_3;
   __pyx_L6_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":981
+    /* "rapidfuzz/process_cpp_impl.pyx":841
  * 
  *     if limit is None or limit > len(choices):
  *         limit = len(choices)             # <<<<<<<<<<<<<<
  * 
  *     # preprocess the query
  */
-    __Pyx_TraceLine(981,0,__PYX_ERR(0, 981, __pyx_L1_error))
-    __pyx_t_4 = PyObject_Length(__pyx_v_choices); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 981, __pyx_L1_error)
-    __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 981, __pyx_L1_error)
+    __Pyx_TraceLine(841,0,__PYX_ERR(0, 841, __pyx_L1_error))
+    __pyx_t_4 = PyObject_Length(__pyx_v_choices); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 841, __pyx_L1_error)
+    __pyx_t_5 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 841, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF_SET(__pyx_v_limit, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":980
+    /* "rapidfuzz/process_cpp_impl.pyx":840
  *         processor = None
  * 
  *     if limit is None or limit > len(choices):             # <<<<<<<<<<<<<<
  *         limit = len(choices)
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":984
+  /* "rapidfuzz/process_cpp_impl.pyx":844
  * 
  *     # preprocess the query
  *     if callable(processor):             # <<<<<<<<<<<<<<
  *         query = processor(query)
  * 
  */
-  __Pyx_TraceLine(984,0,__PYX_ERR(0, 984, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyCallable_Check(__pyx_v_processor); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 984, __pyx_L1_error)
+  __Pyx_TraceLine(844,0,__PYX_ERR(0, 844, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyCallable_Check(__pyx_v_processor); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 844, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":985
+    /* "rapidfuzz/process_cpp_impl.pyx":845
  *     # preprocess the query
  *     if callable(processor):
  *         query = processor(query)             # <<<<<<<<<<<<<<
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  */
-    __Pyx_TraceLine(985,0,__PYX_ERR(0, 985, __pyx_L1_error))
+    __Pyx_TraceLine(845,0,__PYX_ERR(0, 845, __pyx_L1_error))
     __Pyx_INCREF(__pyx_v_processor);
     __pyx_t_2 = __pyx_v_processor; __pyx_t_6 = NULL;
     __pyx_t_7 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
       __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
       if (likely(__pyx_t_6)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
@@ -13596,447 +14518,447 @@
         __pyx_t_7 = 1;
       }
     }
     {
       PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_v_query};
       __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
       __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 985, __pyx_L1_error)
+      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 845, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     }
     __Pyx_DECREF_SET(__pyx_v_query, __pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":984
+    /* "rapidfuzz/process_cpp_impl.pyx":844
  * 
  *     # preprocess the query
  *     if callable(processor):             # <<<<<<<<<<<<<<
  *         query = processor(query)
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":987
+  /* "rapidfuzz/process_cpp_impl.pyx":847
  *         query = processor(query)
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)             # <<<<<<<<<<<<<<
  *     if PyCapsule_IsValid(scorer_capsule, NULL):
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  */
-  __Pyx_TraceLine(987,0,__PYX_ERR(0, 987, __pyx_L1_error))
-  __pyx_t_5 = __Pyx_GetAttr3(__pyx_v_scorer, __pyx_n_u_RF_Scorer, __pyx_v_scorer); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 987, __pyx_L1_error)
+  __Pyx_TraceLine(847,0,__PYX_ERR(0, 847, __pyx_L1_error))
+  __pyx_t_5 = __Pyx_GetAttr3(__pyx_v_scorer, __pyx_n_u_RF_Scorer, __pyx_v_scorer); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 847, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __pyx_v_scorer_capsule = __pyx_t_5;
   __pyx_t_5 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":988
+  /* "rapidfuzz/process_cpp_impl.pyx":848
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  *     if PyCapsule_IsValid(scorer_capsule, NULL):             # <<<<<<<<<<<<<<
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  */
-  __Pyx_TraceLine(988,0,__PYX_ERR(0, 988, __pyx_L1_error))
+  __Pyx_TraceLine(848,0,__PYX_ERR(0, 848, __pyx_L1_error))
   __pyx_t_1 = PyCapsule_IsValid(__pyx_v_scorer_capsule, NULL);
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":989
+    /* "rapidfuzz/process_cpp_impl.pyx":849
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  *     if PyCapsule_IsValid(scorer_capsule, NULL):
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:
  */
-    __Pyx_TraceLine(989,0,__PYX_ERR(0, 989, __pyx_L1_error))
-    __pyx_t_8 = PyCapsule_GetPointer(__pyx_v_scorer_capsule, NULL); if (unlikely(__pyx_t_8 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 989, __pyx_L1_error)
+    __Pyx_TraceLine(849,0,__PYX_ERR(0, 849, __pyx_L1_error))
+    __pyx_t_8 = PyCapsule_GetPointer(__pyx_v_scorer_capsule, NULL); if (unlikely(__pyx_t_8 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 849, __pyx_L1_error)
     __pyx_v_scorer_context = ((RF_Scorer *)__pyx_t_8);
 
-    /* "rapidfuzz/process_cpp.pyx":988
+    /* "rapidfuzz/process_cpp_impl.pyx":848
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  *     if PyCapsule_IsValid(scorer_capsule, NULL):             # <<<<<<<<<<<<<<
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":991
+  /* "rapidfuzz/process_cpp_impl.pyx":851
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:             # <<<<<<<<<<<<<<
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  */
-  __Pyx_TraceLine(991,0,__PYX_ERR(0, 991, __pyx_L1_error))
+  __Pyx_TraceLine(851,0,__PYX_ERR(0, 851, __pyx_L1_error))
   __pyx_t_3 = (__pyx_v_scorer_context != 0);
   if (__pyx_t_3) {
   } else {
     __pyx_t_1 = __pyx_t_3;
     goto __pyx_L11_bool_binop_done;
   }
   __pyx_t_3 = ((*__pyx_v_scorer_context).version == 1);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L11_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":992
+    /* "rapidfuzz/process_cpp_impl.pyx":852
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:
  *         kwargs_context = RF_KwargsWrapper()             # <<<<<<<<<<<<<<
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  */
-    __Pyx_TraceLine(992,0,__PYX_ERR(0, 992, __pyx_L1_error))
+    __Pyx_TraceLine(852,0,__PYX_ERR(0, 852, __pyx_L1_error))
     __pyx_v_kwargs_context = RF_KwargsWrapper();
 
-    /* "rapidfuzz/process_cpp.pyx":993
+    /* "rapidfuzz/process_cpp_impl.pyx":853
  *     if scorer_context and dereference(scorer_context).version == 1:
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)             # <<<<<<<<<<<<<<
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  * 
  */
-    __Pyx_TraceLine(993,0,__PYX_ERR(0, 993, __pyx_L1_error))
-    __pyx_t_9 = (*__pyx_v_scorer_context).kwargs_init((&__pyx_v_kwargs_context.kwargs), __pyx_v_kwargs); if (unlikely(__pyx_t_9 == ((bool)0))) __PYX_ERR(0, 993, __pyx_L1_error)
+    __Pyx_TraceLine(853,0,__PYX_ERR(0, 853, __pyx_L1_error))
+    __pyx_t_9 = (*__pyx_v_scorer_context).kwargs_init((&__pyx_v_kwargs_context.kwargs), __pyx_v_kwargs); if (unlikely(__pyx_t_9 == ((bool)0))) __PYX_ERR(0, 853, __pyx_L1_error)
 
-    /* "rapidfuzz/process_cpp.pyx":994
+    /* "rapidfuzz/process_cpp_impl.pyx":854
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *         if hasattr(choices, "items"):
  */
-    __Pyx_TraceLine(994,0,__PYX_ERR(0, 994, __pyx_L1_error))
-    __pyx_t_9 = (*__pyx_v_scorer_context).get_scorer_flags((&__pyx_v_kwargs_context.kwargs), (&__pyx_v_scorer_flags)); if (unlikely(__pyx_t_9 == ((bool)0))) __PYX_ERR(0, 994, __pyx_L1_error)
+    __Pyx_TraceLine(854,0,__PYX_ERR(0, 854, __pyx_L1_error))
+    __pyx_t_9 = (*__pyx_v_scorer_context).get_scorer_flags((&__pyx_v_kwargs_context.kwargs), (&__pyx_v_scorer_flags)); if (unlikely(__pyx_t_9 == ((bool)0))) __PYX_ERR(0, 854, __pyx_L1_error)
 
-    /* "rapidfuzz/process_cpp.pyx":996
+    /* "rapidfuzz/process_cpp_impl.pyx":856
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  * 
  *         if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *             return extract_dict(query, choices, scorer_context, &scorer_flags,
  *                 processor, limit, score_cutoff, &kwargs_context.kwargs)
  */
-    __Pyx_TraceLine(996,0,__PYX_ERR(0, 996, __pyx_L1_error))
-    __pyx_t_1 = __Pyx_HasAttr(__pyx_v_choices, __pyx_n_u_items); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 996, __pyx_L1_error)
+    __Pyx_TraceLine(856,0,__PYX_ERR(0, 856, __pyx_L1_error))
+    __pyx_t_1 = __Pyx_HasAttr(__pyx_v_choices, __pyx_n_u_items); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 856, __pyx_L1_error)
     if (__pyx_t_1) {
 
-      /* "rapidfuzz/process_cpp.pyx":997
+      /* "rapidfuzz/process_cpp_impl.pyx":857
  * 
  *         if hasattr(choices, "items"):
  *             return extract_dict(query, choices, scorer_context, &scorer_flags,             # <<<<<<<<<<<<<<
  *                 processor, limit, score_cutoff, &kwargs_context.kwargs)
  *         else:
  */
-      __Pyx_TraceLine(997,0,__PYX_ERR(0, 997, __pyx_L1_error))
+      __Pyx_TraceLine(857,0,__PYX_ERR(0, 857, __pyx_L1_error))
       __Pyx_XDECREF(__pyx_r);
 
-      /* "rapidfuzz/process_cpp.pyx":998
+      /* "rapidfuzz/process_cpp_impl.pyx":858
  *         if hasattr(choices, "items"):
  *             return extract_dict(query, choices, scorer_context, &scorer_flags,
  *                 processor, limit, score_cutoff, &kwargs_context.kwargs)             # <<<<<<<<<<<<<<
  *         else:
  *             return extract_list(query, choices, scorer_context, &scorer_flags,
  */
-      __Pyx_TraceLine(998,0,__PYX_ERR(0, 998, __pyx_L1_error))
-      __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_limit); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 998, __pyx_L1_error)
+      __Pyx_TraceLine(858,0,__PYX_ERR(0, 858, __pyx_L1_error))
+      __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_limit); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 858, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":997
+      /* "rapidfuzz/process_cpp_impl.pyx":857
  * 
  *         if hasattr(choices, "items"):
  *             return extract_dict(query, choices, scorer_context, &scorer_flags,             # <<<<<<<<<<<<<<
  *                 processor, limit, score_cutoff, &kwargs_context.kwargs)
  *         else:
  */
-      __Pyx_TraceLine(997,0,__PYX_ERR(0, 997, __pyx_L1_error))
-      __pyx_t_5 = __pyx_f_9rapidfuzz_11process_cpp_extract_dict(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer_context, (&__pyx_v_scorer_flags), __pyx_v_processor, __pyx_t_10, __pyx_v_score_cutoff, (&__pyx_v_kwargs_context.kwargs)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 997, __pyx_L1_error)
+      __Pyx_TraceLine(857,0,__PYX_ERR(0, 857, __pyx_L1_error))
+      __pyx_t_5 = __pyx_f_9rapidfuzz_16process_cpp_impl_extract_dict(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer_context, (&__pyx_v_scorer_flags), __pyx_v_processor, __pyx_t_10, __pyx_v_score_cutoff, (&__pyx_v_kwargs_context.kwargs)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 857, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __pyx_r = __pyx_t_5;
       __pyx_t_5 = 0;
       goto __pyx_L0;
 
-      /* "rapidfuzz/process_cpp.pyx":996
+      /* "rapidfuzz/process_cpp_impl.pyx":856
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  * 
  *         if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *             return extract_dict(query, choices, scorer_context, &scorer_flags,
  *                 processor, limit, score_cutoff, &kwargs_context.kwargs)
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1000
+    /* "rapidfuzz/process_cpp_impl.pyx":860
  *                 processor, limit, score_cutoff, &kwargs_context.kwargs)
  *         else:
  *             return extract_list(query, choices, scorer_context, &scorer_flags,             # <<<<<<<<<<<<<<
  *                 processor, limit, score_cutoff, &kwargs_context.kwargs)
  * 
  */
-    __Pyx_TraceLine(1000,0,__PYX_ERR(0, 1000, __pyx_L1_error))
+    __Pyx_TraceLine(860,0,__PYX_ERR(0, 860, __pyx_L1_error))
     /*else*/ {
       __Pyx_XDECREF(__pyx_r);
 
-      /* "rapidfuzz/process_cpp.pyx":1001
+      /* "rapidfuzz/process_cpp_impl.pyx":861
  *         else:
  *             return extract_list(query, choices, scorer_context, &scorer_flags,
  *                 processor, limit, score_cutoff, &kwargs_context.kwargs)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-      __Pyx_TraceLine(1001,0,__PYX_ERR(0, 1001, __pyx_L1_error))
-      __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_limit); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1001, __pyx_L1_error)
+      __Pyx_TraceLine(861,0,__PYX_ERR(0, 861, __pyx_L1_error))
+      __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_limit); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 861, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":1000
+      /* "rapidfuzz/process_cpp_impl.pyx":860
  *                 processor, limit, score_cutoff, &kwargs_context.kwargs)
  *         else:
  *             return extract_list(query, choices, scorer_context, &scorer_flags,             # <<<<<<<<<<<<<<
  *                 processor, limit, score_cutoff, &kwargs_context.kwargs)
  * 
  */
-      __Pyx_TraceLine(1000,0,__PYX_ERR(0, 1000, __pyx_L1_error))
-      __pyx_t_5 = __pyx_f_9rapidfuzz_11process_cpp_extract_list(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer_context, (&__pyx_v_scorer_flags), __pyx_v_processor, __pyx_t_10, __pyx_v_score_cutoff, (&__pyx_v_kwargs_context.kwargs)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1000, __pyx_L1_error)
+      __Pyx_TraceLine(860,0,__PYX_ERR(0, 860, __pyx_L1_error))
+      __pyx_t_5 = __pyx_f_9rapidfuzz_16process_cpp_impl_extract_list(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer_context, (&__pyx_v_scorer_flags), __pyx_v_processor, __pyx_t_10, __pyx_v_score_cutoff, (&__pyx_v_kwargs_context.kwargs)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 860, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __pyx_r = __pyx_t_5;
       __pyx_t_5 = 0;
       goto __pyx_L0;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":991
+    /* "rapidfuzz/process_cpp_impl.pyx":851
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:             # <<<<<<<<<<<<<<
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":1004
+  /* "rapidfuzz/process_cpp_impl.pyx":864
  * 
  * 
  *     worst_score, optimal_score = get_scorer_flags_py(scorer, kwargs)             # <<<<<<<<<<<<<<
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:
  */
-  __Pyx_TraceLine(1004,0,__PYX_ERR(0, 1004, __pyx_L1_error))
-  __pyx_t_5 = __pyx_f_9rapidfuzz_11process_cpp_get_scorer_flags_py(__pyx_v_scorer, __pyx_v_kwargs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1004, __pyx_L1_error)
+  __Pyx_TraceLine(864,0,__PYX_ERR(0, 864, __pyx_L1_error))
+  __pyx_t_5 = __pyx_f_9rapidfuzz_16process_cpp_impl_get_scorer_flags_py(__pyx_v_scorer, __pyx_v_kwargs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 864, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   if ((likely(PyTuple_CheckExact(__pyx_t_5))) || (PyList_CheckExact(__pyx_t_5))) {
     PyObject* sequence = __pyx_t_5;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 1004, __pyx_L1_error)
+      __PYX_ERR(0, 864, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_6 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_6 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_2);
     __Pyx_INCREF(__pyx_t_6);
     #else
-    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1004, __pyx_L1_error)
+    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 864, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1004, __pyx_L1_error)
+    __pyx_t_6 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 864, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     #endif
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_11 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1004, __pyx_L1_error)
+    __pyx_t_11 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 864, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_11);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     __pyx_t_12 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_11);
     index = 0; __pyx_t_2 = __pyx_t_12(__pyx_t_11); if (unlikely(!__pyx_t_2)) goto __pyx_L14_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_2);
     index = 1; __pyx_t_6 = __pyx_t_12(__pyx_t_11); if (unlikely(!__pyx_t_6)) goto __pyx_L14_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_6);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_11), 2) < 0) __PYX_ERR(0, 1004, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_11), 2) < 0) __PYX_ERR(0, 864, __pyx_L1_error)
     __pyx_t_12 = NULL;
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     goto __pyx_L15_unpacking_done;
     __pyx_L14_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
     __pyx_t_12 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 1004, __pyx_L1_error)
+    __PYX_ERR(0, 864, __pyx_L1_error)
     __pyx_L15_unpacking_done:;
   }
   __pyx_v_worst_score = __pyx_t_2;
   __pyx_t_2 = 0;
   __pyx_v_optimal_score = __pyx_t_6;
   __pyx_t_6 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1006
+  /* "rapidfuzz/process_cpp_impl.pyx":866
  *     worst_score, optimal_score = get_scorer_flags_py(scorer, kwargs)
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:             # <<<<<<<<<<<<<<
  *         score_cutoff = worst_score
  * 
  */
-  __Pyx_TraceLine(1006,0,__PYX_ERR(0, 1006, __pyx_L1_error))
+  __Pyx_TraceLine(866,0,__PYX_ERR(0, 866, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_score_cutoff == Py_None);
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":1007
+    /* "rapidfuzz/process_cpp_impl.pyx":867
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:
  *         score_cutoff = worst_score             # <<<<<<<<<<<<<<
  * 
  *     kwargs["processor"] = None
  */
-    __Pyx_TraceLine(1007,0,__PYX_ERR(0, 1007, __pyx_L1_error))
+    __Pyx_TraceLine(867,0,__PYX_ERR(0, 867, __pyx_L1_error))
     __Pyx_INCREF(__pyx_v_worst_score);
     __Pyx_DECREF_SET(__pyx_v_score_cutoff, __pyx_v_worst_score);
 
-    /* "rapidfuzz/process_cpp.pyx":1006
+    /* "rapidfuzz/process_cpp_impl.pyx":866
  *     worst_score, optimal_score = get_scorer_flags_py(scorer, kwargs)
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:             # <<<<<<<<<<<<<<
  *         score_cutoff = worst_score
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":1009
+  /* "rapidfuzz/process_cpp_impl.pyx":869
  *         score_cutoff = worst_score
  * 
  *     kwargs["processor"] = None             # <<<<<<<<<<<<<<
  *     kwargs["score_cutoff"] = score_cutoff
  * 
  */
-  __Pyx_TraceLine(1009,0,__PYX_ERR(0, 1009, __pyx_L1_error))
-  if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_processor, Py_None) < 0))) __PYX_ERR(0, 1009, __pyx_L1_error)
+  __Pyx_TraceLine(869,0,__PYX_ERR(0, 869, __pyx_L1_error))
+  if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_processor, Py_None) < 0))) __PYX_ERR(0, 869, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1010
+  /* "rapidfuzz/process_cpp_impl.pyx":870
  * 
  *     kwargs["processor"] = None
  *     kwargs["score_cutoff"] = score_cutoff             # <<<<<<<<<<<<<<
  * 
  *     if hasattr(choices, "items"):
  */
-  __Pyx_TraceLine(1010,0,__PYX_ERR(0, 1010, __pyx_L1_error))
-  if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score_cutoff) < 0))) __PYX_ERR(0, 1010, __pyx_L1_error)
+  __Pyx_TraceLine(870,0,__PYX_ERR(0, 870, __pyx_L1_error))
+  if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score_cutoff) < 0))) __PYX_ERR(0, 870, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1012
+  /* "rapidfuzz/process_cpp_impl.pyx":872
  *     kwargs["score_cutoff"] = score_cutoff
  * 
  *     if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *         return py_extract_dict(query, choices, scorer, processor, limit, score_cutoff, worst_score, optimal_score, kwargs)
  *     else:
  */
-  __Pyx_TraceLine(1012,0,__PYX_ERR(0, 1012, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_HasAttr(__pyx_v_choices, __pyx_n_u_items); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 1012, __pyx_L1_error)
+  __Pyx_TraceLine(872,0,__PYX_ERR(0, 872, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_HasAttr(__pyx_v_choices, __pyx_n_u_items); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 872, __pyx_L1_error)
   if (__pyx_t_1) {
 
-    /* "rapidfuzz/process_cpp.pyx":1013
+    /* "rapidfuzz/process_cpp_impl.pyx":873
  * 
  *     if hasattr(choices, "items"):
  *         return py_extract_dict(query, choices, scorer, processor, limit, score_cutoff, worst_score, optimal_score, kwargs)             # <<<<<<<<<<<<<<
  *     else:
  *         return py_extract_list(query, choices, scorer, processor, limit, score_cutoff, worst_score, optimal_score, kwargs)
  */
-    __Pyx_TraceLine(1013,0,__PYX_ERR(0, 1013, __pyx_L1_error))
+    __Pyx_TraceLine(873,0,__PYX_ERR(0, 873, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_limit); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1013, __pyx_L1_error)
-    __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1013, __pyx_L1_error)
-    __pyx_t_5 = __pyx_f_9rapidfuzz_11process_cpp_py_extract_dict(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_t_10, __pyx_t_13, __pyx_v_worst_score, __pyx_v_optimal_score, __pyx_v_kwargs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1013, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_limit); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
+    __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 873, __pyx_L1_error)
+    __pyx_t_5 = __pyx_f_9rapidfuzz_16process_cpp_impl_py_extract_dict(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_t_10, __pyx_t_13, __pyx_v_worst_score, __pyx_v_optimal_score, __pyx_v_kwargs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 873, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_r = __pyx_t_5;
     __pyx_t_5 = 0;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":1012
+    /* "rapidfuzz/process_cpp_impl.pyx":872
  *     kwargs["score_cutoff"] = score_cutoff
  * 
  *     if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *         return py_extract_dict(query, choices, scorer, processor, limit, score_cutoff, worst_score, optimal_score, kwargs)
  *     else:
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":1015
+  /* "rapidfuzz/process_cpp_impl.pyx":875
  *         return py_extract_dict(query, choices, scorer, processor, limit, score_cutoff, worst_score, optimal_score, kwargs)
  *     else:
  *         return py_extract_list(query, choices, scorer, processor, limit, score_cutoff, worst_score, optimal_score, kwargs)             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(1015,0,__PYX_ERR(0, 1015, __pyx_L1_error))
+  __Pyx_TraceLine(875,0,__PYX_ERR(0, 875, __pyx_L1_error))
   /*else*/ {
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_limit); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1015, __pyx_L1_error)
-    __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1015, __pyx_L1_error)
-    __pyx_t_5 = __pyx_f_9rapidfuzz_11process_cpp_py_extract_list(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_t_10, __pyx_t_13, __pyx_v_worst_score, __pyx_v_optimal_score, __pyx_v_kwargs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1015, __pyx_L1_error)
+    __pyx_t_10 = __Pyx_PyInt_As_int64_t(__pyx_v_limit); if (unlikely((__pyx_t_10 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L1_error)
+    __pyx_t_13 = __pyx_PyFloat_AsDouble(__pyx_v_score_cutoff); if (unlikely((__pyx_t_13 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 875, __pyx_L1_error)
+    __pyx_t_5 = __pyx_f_9rapidfuzz_16process_cpp_impl_py_extract_list(__pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_t_10, __pyx_t_13, __pyx_v_worst_score, __pyx_v_optimal_score, __pyx_v_kwargs); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 875, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_r = __pyx_t_5;
     __pyx_t_5 = 0;
     goto __pyx_L0;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":909
+  /* "rapidfuzz/process_cpp_impl.pyx":828
  * 
  * 
  * def extract(query, choices, *, scorer=WRatio, processor=default_process, limit=5, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best matches in a list of choices. The list is sorted by the similarity.
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_5);
   __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_11);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_scorer_capsule);
   __Pyx_XDECREF(__pyx_v_worst_score);
   __Pyx_XDECREF(__pyx_v_optimal_score);
   __Pyx_XDECREF(__pyx_v_query);
   __Pyx_XDECREF(__pyx_v_processor);
   __Pyx_XDECREF(__pyx_v_limit);
   __Pyx_XDECREF(__pyx_v_score_cutoff);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_6generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_6generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "rapidfuzz/process_cpp.pyx":1018
+/* "rapidfuzz/process_cpp_impl.pyx":878
  * 
  * 
  * def extract_iter(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best match in a list of choices
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_11__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_13__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__defaults__", 0);
-  __Pyx_TraceCall("__defaults__", __pyx_f[0], 1018, 0, __PYX_ERR(0, 1018, __pyx_L1_error));
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 878, 0, __PYX_ERR(0, 878, __pyx_L1_error));
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 878, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_scorer, __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_scorer) < 0) __PYX_ERR(0, 1018, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 1018, __pyx_L1_error)
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 1018, __pyx_L1_error)
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_scorer, __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_scorer) < 0) __PYX_ERR(0, 878, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_processor) < 0) __PYX_ERR(0, 878, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 878, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 878, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
   __pyx_t_1 = 0;
@@ -14044,34 +14966,33 @@
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_5extract_iter(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_5extract_iter(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_11process_cpp_4extract_iter, "\n    Find the best match in a list of choices\n\n    Parameters\n    ----------\n    query : Sequence[Hashable]\n        string we want to find\n    choices : Iterable[Sequence[Hashable]] | Mapping[Sequence[Hashable]]\n        list of all strings the query should be compared with or dict with a mapping\n        {<result>: <string to compare>}\n    scorer : Callable, optional\n        Optional callable that is used to calculate the matching score between\n        the query and each choice. This can be any of the scorers included in RapidFuzz\n        (both scorers that calculate the edit distance or the normalized edit distance), or\n        a custom function, which returns a normalized edit distance.\n        fuzz.WRatio is used by default.\n    processor : Callable, optional\n        Optional callable that reformats the strings.\n        utils.default_process is used by default, which lowercases the strings and trims whitespace\n    score_cutoff : Any, optional\n        Optional argument for a score threshold. When an edit distance is used this represents the maximum\n        edit distance and matches with a `distance <= score_cutoff` are ignored. When a\n        normalized edit distance is used this represents the minimal similarity\n        and matches with a `similarity >= score_cutoff` are ignored. Default is None, which deactivates this behaviour.\n    **kwargs : Any, optional\n        any other named parameters are passed to the scorer. This can be used to pass\n        e.g. weights to string_metric.levenshtein\n\n    Yields\n    -------\n    Tuple[Sequence[Hashable], Any, Any]\n        Yields similarity between the query and each choice in form of a Tuple with 3 elements.\n        The values stored in the tuple depend on the types of the input arguments.\n\n        * The first element is always the current `choice`, which is the value thats compared to the query.\n\n        * The second value represents the similarity calculated by the scorer. This can be:""\n\n          * An edit distance (distance is 0 for a perfect match and > 0 for non perfect matches).\n            In this case only choices which have a `distance <= max` are yielded.\n            An example of a scorer with this behavior is `string_metric.levenshtein`.\n          * A normalized edit distance (similarity is a score between 0 and 100, with 100 being a perfect match).\n            In this case only choices which have a `similarity >= score_cutoff` are yielded.\n            An example of a scorer with this behavior is `string_metric.normalized_levenshtein`.\n\n          Note, that for all scorers, which are not provided by RapidFuzz, only normalized edit distances are supported.\n\n        * The third parameter depends on the type of the `choices` argument it is:\n\n          * The `index of choice` when choices is a simple iterable like a list\n          * The `key of choice` when choices is a mapping like a dict, or a pandas Series\n\n    ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_5extract_iter = {"extract_iter", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_11process_cpp_5extract_iter, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_11process_cpp_4extract_iter};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_5extract_iter(PyObject *__pyx_self, 
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_5extract_iter = {"extract_iter", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_5extract_iter, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_5extract_iter(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_query = 0;
@@ -14113,35 +15034,35 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_query)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1018, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 878, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_choices)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1018, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 878, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("extract_iter", 1, 2, 2, 1); __PYX_ERR(0, 1018, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("extract_iter", 1, 2, 2, 1); __PYX_ERR(0, 878, __pyx_L3_error)
         }
       }
       if (kw_args > 0 && (kw_args <= 3)) {
         Py_ssize_t index;
         for (index = 2; index < 5 && kw_args > 0; index++) {
           PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
           if (value) { values[index] = value; kw_args--; }
-          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1018, __pyx_L3_error)
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 878, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kwargs, values + 0, kwd_pos_args, "extract_iter") < 0)) __PYX_ERR(0, 1018, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kwargs, values + 0, kwd_pos_args, "extract_iter") < 0)) __PYX_ERR(0, 878, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
@@ -14149,48 +15070,48 @@
     __pyx_v_choices = values[1];
     __pyx_v_scorer = values[2];
     __pyx_v_processor = values[3];
     __pyx_v_score_cutoff = values[4];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("extract_iter", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 1018, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("extract_iter", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 878, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_CLEAR(__pyx_v_kwargs);
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_iter", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_iter", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_11process_cpp_4extract_iter(__pyx_self, __pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs);
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_4extract_iter(__pyx_self, __pyx_v_query, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_kwargs);
 
   /* function exit code */
   __Pyx_DECREF(__pyx_v_kwargs);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_4extract_iter(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *__pyx_cur_scope;
-  PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_2generator1 = 0;
-  PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_5generator2 = 0;
-  PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_8generator3 = 0;
-  PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_11generator4 = 0;
-  PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_14generator5 = 0;
-  PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_17generator6 = 0;
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_4extract_iter(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_query, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_kwargs) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *__pyx_cur_scope;
+  PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_2generator1 = 0;
+  PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_5generator2 = 0;
+  PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_8generator3 = 0;
+  PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_11generator4 = 0;
+  PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_14generator5 = 0;
+  PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_17generator6 = 0;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_iter", 0);
-  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter, __pyx_empty_tuple, NULL);
+  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
-    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *)Py_None);
+    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1018, __pyx_L1_error)
+    __PYX_ERR(0, 878, __pyx_L1_error)
   } else {
     __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_query = __pyx_v_query;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_query);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_query);
   __pyx_cur_scope->__pyx_v_choices = __pyx_v_choices;
@@ -14205,100 +15126,100 @@
   __pyx_cur_scope->__pyx_v_score_cutoff = __pyx_v_score_cutoff;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_score_cutoff);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_score_cutoff);
   __pyx_cur_scope->__pyx_v_kwargs = __pyx_v_kwargs;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_kwargs);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_kwargs);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_11process_cpp_6generator, __pyx_codeobj__5, (PyObject *) __pyx_cur_scope, __pyx_n_s_extract_iter, __pyx_n_s_extract_iter, __pyx_n_s_rapidfuzz_process_cpp); if (unlikely(!gen)) __PYX_ERR(0, 1018, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_16process_cpp_impl_6generator, __pyx_codeobj__5, (PyObject *) __pyx_cur_scope, __pyx_n_s_extract_iter, __pyx_n_s_extract_iter, __pyx_n_s_rapidfuzz_process_cpp_impl); if (unlikely(!gen)) __PYX_ERR(0, 878, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_iter", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_iter", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
-  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_2generator1);
-  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_5generator2);
-  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_8generator3);
-  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_11generator4);
-  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_14generator5);
-  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_17generator6);
+  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_2generator1);
+  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_5generator2);
+  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_8generator3);
+  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_11generator4);
+  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_14generator5);
+  __Pyx_XDECREF(__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_17generator6);
   __Pyx_DECREF((PyObject *)__pyx_cur_scope);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_2generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_2generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "rapidfuzz/process_cpp.pyx":1077
+/* "rapidfuzz/process_cpp_impl.pyx":884
  *     cdef RF_KwargsWrapper kwargs_context
  * 
  *     def extract_iter_dict_f64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_1extract_iter_dict_f64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_extract_iter_dict_f64, "\n        implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type\n        float64\n        ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_1extract_iter_dict_f64 = {"extract_iter_dict_f64", (PyCFunction)__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_1extract_iter_dict_f64, METH_NOARGS, __pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_extract_iter_dict_f64};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_1extract_iter_dict_f64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_1extract_iter_dict_f64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+PyDoc_STRVAR(__pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_extract_iter_dict_f64, "\n        implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type\n        float64\n        ");
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_1extract_iter_dict_f64 = {"extract_iter_dict_f64", (PyCFunction)__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_1extract_iter_dict_f64, METH_NOARGS, __pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_extract_iter_dict_f64};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_1extract_iter_dict_f64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("extract_iter_dict_f64 (wrapper)", 0);
-  __pyx_r = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_extract_iter_dict_f64(__pyx_self);
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_extract_iter_dict_f64(__pyx_self);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_extract_iter_dict_f64(PyObject *__pyx_self) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *__pyx_cur_scope;
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_extract_iter_dict_f64(PyObject *__pyx_self) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *__pyx_cur_scope;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_iter_dict_f64", 0);
-  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64, __pyx_empty_tuple, NULL);
+  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
-    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *)Py_None);
+    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1077, __pyx_L1_error)
+    __PYX_ERR(0, 884, __pyx_L1_error)
   } else {
     __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
   }
-  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
+  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_2generator1, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_extract_iter_dict_f64, __pyx_n_s_extract_iter_locals_extract_iter, __pyx_n_s_rapidfuzz_process_cpp); if (unlikely(!gen)) __PYX_ERR(0, 1077, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_2generator1, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_extract_iter_dict_f64, __pyx_n_s_extract_iter_locals_extract_iter, __pyx_n_s_rapidfuzz_process_cpp_impl); if (unlikely(!gen)) __PYX_ERR(0, 884, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_iter.extract_iter_dict_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_iter.extract_iter_dict_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_DECREF((PyObject *)__pyx_cur_scope);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_2generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_2generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
 {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *)__pyx_generator->closure);
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *)__pyx_generator->closure);
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   double __pyx_t_2;
   RF_String __pyx_t_3;
   bool __pyx_t_4;
   Py_ssize_t __pyx_t_5;
@@ -14311,221 +15232,221 @@
   int __pyx_t_12;
   PyObject *__pyx_t_13 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("extract_iter_dict_f64", 0);
-  __Pyx_TraceCall("extract_iter_dict_f64", __pyx_f[0], 1077, 0, __PYX_ERR(0, 1077, __pyx_L1_error));
+  __Pyx_TraceCall("extract_iter_dict_f64", __pyx_f[0], 884, 0, __PYX_ERR(0, 884, __pyx_L1_error));
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L13_resume_from_yield;
     case 2: goto __pyx_L15_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_TraceReturn(Py_None, 0);
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1077, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 884, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1083
+  /* "rapidfuzz/process_cpp_impl.pyx":890
  *         """
  *         cdef RF_String proc_str
  *         cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, &scorer_flags)             # <<<<<<<<<<<<<<
  *         query_proc = RF_StringWrapper(conv_sequence(query))
  * 
  */
-  __Pyx_TraceLine(1083,0,__PYX_ERR(0, 1083, __pyx_L1_error))
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1083, __pyx_L1_error) }
+  __Pyx_TraceLine(890,0,__PYX_ERR(0, 890, __pyx_L1_error))
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 890, __pyx_L1_error) }
   __pyx_t_1 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff;
   __Pyx_INCREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_t_1, (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags)); if (unlikely(__pyx_t_2 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1083, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_t_1, (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags)); if (unlikely(__pyx_t_2 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 890, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_c_score_cutoff = __pyx_t_2;
 
-  /* "rapidfuzz/process_cpp.pyx":1084
+  /* "rapidfuzz/process_cpp_impl.pyx":891
  *         cdef RF_String proc_str
  *         cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, &scorer_flags)
  *         query_proc = RF_StringWrapper(conv_sequence(query))             # <<<<<<<<<<<<<<
  * 
  *         cdef RF_ScorerFunc scorer_func
  */
-  __Pyx_TraceLine(1084,0,__PYX_ERR(0, 1084, __pyx_L1_error))
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1084, __pyx_L1_error) }
+  __Pyx_TraceLine(891,0,__PYX_ERR(0, 891, __pyx_L1_error))
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 891, __pyx_L1_error) }
   __pyx_t_1 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_query;
   __Pyx_INCREF(__pyx_t_1);
-  __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1084, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 891, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_query_proc = RF_StringWrapper(__pyx_t_3);
 
-  /* "rapidfuzz/process_cpp.pyx":1087
+  /* "rapidfuzz/process_cpp_impl.pyx":894
  * 
  *         cdef RF_ScorerFunc scorer_func
  *         dereference(scorer_context).scorer_func_init(             # <<<<<<<<<<<<<<
  *             &scorer_func, &kwargs_context.kwargs, 1, &query_proc.string
  *         )
  */
-  __Pyx_TraceLine(1087,0,__PYX_ERR(0, 1087, __pyx_L1_error))
-  __pyx_t_4 = (*__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_context).scorer_func_init((&__pyx_cur_scope->__pyx_v_scorer_func), (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs_context.kwargs), 1, (&__pyx_cur_scope->__pyx_v_query_proc.string)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1087, __pyx_L1_error)
+  __Pyx_TraceLine(894,0,__PYX_ERR(0, 894, __pyx_L1_error))
+  __pyx_t_4 = (*__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_context).scorer_func_init((&__pyx_cur_scope->__pyx_v_scorer_func), (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs_context.kwargs), 1, (&__pyx_cur_scope->__pyx_v_query_proc.string)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 894, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1090
+  /* "rapidfuzz/process_cpp_impl.pyx":897
  *             &scorer_func, &kwargs_context.kwargs, 1, &query_proc.string
  *         )
  *         cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)             # <<<<<<<<<<<<<<
  *         cdef bool lowest_score_worst = is_lowest_score_worst[double](&scorer_flags)
  *         cdef double score
  */
-  __Pyx_TraceLine(1090,0,__PYX_ERR(0, 1090, __pyx_L1_error))
+  __Pyx_TraceLine(897,0,__PYX_ERR(0, 897, __pyx_L1_error))
   __pyx_cur_scope->__pyx_v_ScorerFunc = RF_ScorerWrapper(__pyx_cur_scope->__pyx_v_scorer_func);
 
-  /* "rapidfuzz/process_cpp.pyx":1091
+  /* "rapidfuzz/process_cpp_impl.pyx":898
  *         )
  *         cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  *         cdef bool lowest_score_worst = is_lowest_score_worst[double](&scorer_flags)             # <<<<<<<<<<<<<<
  *         cdef double score
  * 
  */
-  __Pyx_TraceLine(1091,0,__PYX_ERR(0, 1091, __pyx_L1_error))
+  __Pyx_TraceLine(898,0,__PYX_ERR(0, 898, __pyx_L1_error))
   __pyx_cur_scope->__pyx_v_lowest_score_worst = is_lowest_score_worst<double>((&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags));
 
-  /* "rapidfuzz/process_cpp.pyx":1094
+  /* "rapidfuzz/process_cpp_impl.pyx":901
  *         cdef double score
  * 
  *         for choice_key, choice in choices.items():             # <<<<<<<<<<<<<<
  *             if choice is None:
  *                 continue
  */
-  __Pyx_TraceLine(1094,0,__PYX_ERR(0, 1094, __pyx_L1_error))
+  __Pyx_TraceLine(901,0,__PYX_ERR(0, 901, __pyx_L1_error))
   __pyx_t_5 = 0;
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 1094, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 901, __pyx_L1_error) }
   if (unlikely(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-    __PYX_ERR(0, 1094, __pyx_L1_error)
+    __PYX_ERR(0, 901, __pyx_L1_error)
   }
-  __pyx_t_8 = __Pyx_dict_iterator(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_6), (&__pyx_t_7)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1094, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_dict_iterator(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_6), (&__pyx_t_7)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 901, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_8;
   __pyx_t_8 = 0;
   while (1) {
     __pyx_t_10 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_6, &__pyx_t_5, &__pyx_t_8, &__pyx_t_9, NULL, __pyx_t_7);
     if (unlikely(__pyx_t_10 == 0)) break;
-    if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 1094, __pyx_L1_error)
+    if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 901, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_choice_key);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_choice_key, __pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_8);
     __pyx_t_8 = 0;
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_choice);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_choice, __pyx_t_9);
     __Pyx_GIVEREF(__pyx_t_9);
     __pyx_t_9 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":1095
+    /* "rapidfuzz/process_cpp_impl.pyx":902
  * 
  *         for choice_key, choice in choices.items():
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
-    __Pyx_TraceLine(1095,0,__PYX_ERR(0, 1095, __pyx_L1_error))
+    __Pyx_TraceLine(902,0,__PYX_ERR(0, 902, __pyx_L1_error))
     __pyx_t_11 = (__pyx_cur_scope->__pyx_v_choice == Py_None);
     if (__pyx_t_11) {
 
-      /* "rapidfuzz/process_cpp.pyx":1096
+      /* "rapidfuzz/process_cpp_impl.pyx":903
  *         for choice_key, choice in choices.items():
  *             if choice is None:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             # use RapidFuzz C-Api
  */
-      __Pyx_TraceLine(1096,0,__PYX_ERR(0, 1096, __pyx_L1_error))
+      __Pyx_TraceLine(903,0,__PYX_ERR(0, 903, __pyx_L1_error))
       goto __pyx_L4_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":1095
+      /* "rapidfuzz/process_cpp_impl.pyx":902
  * 
  *         for choice_key, choice in choices.items():
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1099
+    /* "rapidfuzz/process_cpp_impl.pyx":906
  * 
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  */
-    __Pyx_TraceLine(1099,0,__PYX_ERR(0, 1099, __pyx_L1_error))
+    __Pyx_TraceLine(906,0,__PYX_ERR(0, 906, __pyx_L1_error))
     __pyx_t_12 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context != NULL);
     if (__pyx_t_12) {
     } else {
       __pyx_t_11 = __pyx_t_12;
       goto __pyx_L8_bool_binop_done;
     }
     __pyx_t_12 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->version == 1);
     __pyx_t_11 = __pyx_t_12;
     __pyx_L8_bool_binop_done:;
     if (__pyx_t_11) {
 
-      /* "rapidfuzz/process_cpp.pyx":1100
+      /* "rapidfuzz/process_cpp_impl.pyx":907
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:
  *                 processor_context.preprocess(choice, &proc_str)             # <<<<<<<<<<<<<<
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:
  */
-      __Pyx_TraceLine(1100,0,__PYX_ERR(0, 1100, __pyx_L1_error))
-      __pyx_t_4 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->preprocess(__pyx_cur_scope->__pyx_v_choice, (&__pyx_cur_scope->__pyx_v_proc_str)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1100, __pyx_L1_error)
+      __Pyx_TraceLine(907,0,__PYX_ERR(0, 907, __pyx_L1_error))
+      __pyx_t_4 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->preprocess(__pyx_cur_scope->__pyx_v_choice, (&__pyx_cur_scope->__pyx_v_proc_str)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 907, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":1101
+      /* "rapidfuzz/process_cpp_impl.pyx":908
  *             if processor_context != NULL and processor_context.version == 1:
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)             # <<<<<<<<<<<<<<
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  */
-      __Pyx_TraceLine(1101,0,__PYX_ERR(0, 1101, __pyx_L1_error))
+      __Pyx_TraceLine(908,0,__PYX_ERR(0, 908, __pyx_L1_error))
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_cur_scope->__pyx_v_proc_str);
 
-      /* "rapidfuzz/process_cpp.pyx":1099
+      /* "rapidfuzz/process_cpp_impl.pyx":906
  * 
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1102
+    /* "rapidfuzz/process_cpp_impl.pyx":909
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:             # <<<<<<<<<<<<<<
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  */
-    __Pyx_TraceLine(1102,0,__PYX_ERR(0, 1102, __pyx_L1_error))
-    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1102, __pyx_L1_error) }
+    __Pyx_TraceLine(909,0,__PYX_ERR(0, 909, __pyx_L1_error))
+    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 909, __pyx_L1_error) }
     __pyx_t_11 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor != Py_None);
     if (__pyx_t_11) {
 
-      /* "rapidfuzz/process_cpp.pyx":1103
+      /* "rapidfuzz/process_cpp_impl.pyx":910
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:
  *                 proc_choice = processor(choice)             # <<<<<<<<<<<<<<
  *                 if proc_choice is None:
  *                     continue
  */
-      __Pyx_TraceLine(1103,0,__PYX_ERR(0, 1103, __pyx_L1_error))
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1103, __pyx_L1_error) }
+      __Pyx_TraceLine(910,0,__PYX_ERR(0, 910, __pyx_L1_error))
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 910, __pyx_L1_error) }
       __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor);
       __pyx_t_8 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor; __pyx_t_13 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
         __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_8);
         if (likely(__pyx_t_13)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -14535,136 +15456,136 @@
           __pyx_t_10 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_13, __pyx_cur_scope->__pyx_v_choice};
         __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
-        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1103, __pyx_L1_error)
+        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 910, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       }
       __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_proc_choice);
       __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_proc_choice, __pyx_t_9);
       __Pyx_GIVEREF(__pyx_t_9);
       __pyx_t_9 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":1104
+      /* "rapidfuzz/process_cpp_impl.pyx":911
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
-      __Pyx_TraceLine(1104,0,__PYX_ERR(0, 1104, __pyx_L1_error))
+      __Pyx_TraceLine(911,0,__PYX_ERR(0, 911, __pyx_L1_error))
       __pyx_t_11 = (__pyx_cur_scope->__pyx_v_proc_choice == Py_None);
       if (__pyx_t_11) {
 
-        /* "rapidfuzz/process_cpp.pyx":1105
+        /* "rapidfuzz/process_cpp_impl.pyx":912
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))
  */
-        __Pyx_TraceLine(1105,0,__PYX_ERR(0, 1105, __pyx_L1_error))
+        __Pyx_TraceLine(912,0,__PYX_ERR(0, 912, __pyx_L1_error))
         goto __pyx_L4_continue;
 
-        /* "rapidfuzz/process_cpp.pyx":1104
+        /* "rapidfuzz/process_cpp_impl.pyx":911
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1107
+      /* "rapidfuzz/process_cpp_impl.pyx":914
  *                     continue
  * 
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))             # <<<<<<<<<<<<<<
  *             else:
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))
  */
-      __Pyx_TraceLine(1107,0,__PYX_ERR(0, 1107, __pyx_L1_error))
-      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1107, __pyx_L1_error)
+      __Pyx_TraceLine(914,0,__PYX_ERR(0, 914, __pyx_L1_error))
+      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 914, __pyx_L1_error)
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_t_3);
 
-      /* "rapidfuzz/process_cpp.pyx":1102
+      /* "rapidfuzz/process_cpp_impl.pyx":909
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:             # <<<<<<<<<<<<<<
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1109
+    /* "rapidfuzz/process_cpp_impl.pyx":916
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))
  *             else:
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))             # <<<<<<<<<<<<<<
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  */
-    __Pyx_TraceLine(1109,0,__PYX_ERR(0, 1109, __pyx_L1_error))
+    __Pyx_TraceLine(916,0,__PYX_ERR(0, 916, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1109, __pyx_L1_error)
+      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 916, __pyx_L1_error)
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_t_3);
     }
     __pyx_L7:;
 
-    /* "rapidfuzz/process_cpp.pyx":1111
+    /* "rapidfuzz/process_cpp_impl.pyx":918
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)             # <<<<<<<<<<<<<<
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:
  */
-    __Pyx_TraceLine(1111,0,__PYX_ERR(0, 1111, __pyx_L1_error))
+    __Pyx_TraceLine(918,0,__PYX_ERR(0, 918, __pyx_L1_error))
     try {
       __pyx_cur_scope->__pyx_v_ScorerFunc.call((&__pyx_cur_scope->__pyx_v_choice_proc.string), __pyx_cur_scope->__pyx_v_c_score_cutoff, (&__pyx_cur_scope->__pyx_v_score));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 1111, __pyx_L1_error)
+      __PYX_ERR(0, 918, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1112
+    /* "rapidfuzz/process_cpp_impl.pyx":919
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, choice_key)
  */
-    __Pyx_TraceLine(1112,0,__PYX_ERR(0, 1112, __pyx_L1_error))
+    __Pyx_TraceLine(919,0,__PYX_ERR(0, 919, __pyx_L1_error))
     __pyx_t_11 = (__pyx_cur_scope->__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_11) {
 
-      /* "rapidfuzz/process_cpp.pyx":1113
+      /* "rapidfuzz/process_cpp_impl.pyx":920
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  *             else:
  */
-      __Pyx_TraceLine(1113,0,__PYX_ERR(0, 1113, __pyx_L1_error))
+      __Pyx_TraceLine(920,0,__PYX_ERR(0, 920, __pyx_L1_error))
       __pyx_t_11 = (__pyx_cur_scope->__pyx_v_score >= __pyx_cur_scope->__pyx_v_c_score_cutoff);
       if (__pyx_t_11) {
 
-        /* "rapidfuzz/process_cpp.pyx":1114
+        /* "rapidfuzz/process_cpp_impl.pyx":921
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, choice_key)             # <<<<<<<<<<<<<<
  *             else:
  *                 if score <= c_score_cutoff:
  */
-        __Pyx_TraceLine(1114,0,__PYX_ERR(0, 1114, __pyx_L1_error))
-        __pyx_t_9 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1114, __pyx_L1_error)
+        __Pyx_TraceLine(921,0,__PYX_ERR(0, 921, __pyx_L1_error))
+        __pyx_t_9 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 921, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
-        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1114, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 921, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_t_9);
         PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_9);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice_key);
@@ -14688,58 +15609,58 @@
         __pyx_L13_resume_from_yield:;
         __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_1;
         __pyx_t_6 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_7 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1114, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 921, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1113
+        /* "rapidfuzz/process_cpp_impl.pyx":920
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  *             else:
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1112
+      /* "rapidfuzz/process_cpp_impl.pyx":919
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, choice_key)
  */
       goto __pyx_L11;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1116
+    /* "rapidfuzz/process_cpp_impl.pyx":923
  *                     yield (choice, score, choice_key)
  *             else:
  *                 if score <= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  * 
  */
-    __Pyx_TraceLine(1116,0,__PYX_ERR(0, 1116, __pyx_L1_error))
+    __Pyx_TraceLine(923,0,__PYX_ERR(0, 923, __pyx_L1_error))
     /*else*/ {
       __pyx_t_11 = (__pyx_cur_scope->__pyx_v_score <= __pyx_cur_scope->__pyx_v_c_score_cutoff);
       if (__pyx_t_11) {
 
-        /* "rapidfuzz/process_cpp.pyx":1117
+        /* "rapidfuzz/process_cpp_impl.pyx":924
  *             else:
  *                 if score <= c_score_cutoff:
  *                     yield (choice, score, choice_key)             # <<<<<<<<<<<<<<
  * 
  *     def extract_iter_dict_i64():
  */
-        __Pyx_TraceLine(1117,0,__PYX_ERR(0, 1117, __pyx_L1_error))
-        __pyx_t_8 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1117, __pyx_L1_error)
+        __Pyx_TraceLine(924,0,__PYX_ERR(0, 924, __pyx_L1_error))
+        __pyx_t_8 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 924, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1117, __pyx_L1_error)
+        __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 924, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_8);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice_key);
@@ -14763,32 +15684,32 @@
         __pyx_L15_resume_from_yield:;
         __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_1;
         __pyx_t_6 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_7 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1117, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 924, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1116
+        /* "rapidfuzz/process_cpp_impl.pyx":923
  *                     yield (choice, score, choice_key)
  *             else:
  *                 if score <= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  * 
  */
       }
     }
     __pyx_L11:;
     __pyx_L4_continue:;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "rapidfuzz/process_cpp.pyx":1077
+  /* "rapidfuzz/process_cpp_impl.pyx":884
  *     cdef RF_KwargsWrapper kwargs_context
  * 
  *     def extract_iter_dict_f64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type
  */
 
@@ -14809,79 +15730,79 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_5generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_5generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "rapidfuzz/process_cpp.pyx":1119
+/* "rapidfuzz/process_cpp_impl.pyx":926
  *                     yield (choice, score, choice_key)
  * 
  *     def extract_iter_dict_i64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_4extract_iter_dict_i64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_3extract_iter_dict_i64, "\n        implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type\n        int64_t\n        ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_4extract_iter_dict_i64 = {"extract_iter_dict_i64", (PyCFunction)__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_4extract_iter_dict_i64, METH_NOARGS, __pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_3extract_iter_dict_i64};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_4extract_iter_dict_i64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_4extract_iter_dict_i64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+PyDoc_STRVAR(__pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_3extract_iter_dict_i64, "\n        implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type\n        int64_t\n        ");
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_4extract_iter_dict_i64 = {"extract_iter_dict_i64", (PyCFunction)__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_4extract_iter_dict_i64, METH_NOARGS, __pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_3extract_iter_dict_i64};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_4extract_iter_dict_i64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("extract_iter_dict_i64 (wrapper)", 0);
-  __pyx_r = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_3extract_iter_dict_i64(__pyx_self);
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_3extract_iter_dict_i64(__pyx_self);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_3extract_iter_dict_i64(PyObject *__pyx_self) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *__pyx_cur_scope;
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_3extract_iter_dict_i64(PyObject *__pyx_self) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *__pyx_cur_scope;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_iter_dict_i64", 0);
-  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64, __pyx_empty_tuple, NULL);
+  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
-    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *)Py_None);
+    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1119, __pyx_L1_error)
+    __PYX_ERR(0, 926, __pyx_L1_error)
   } else {
     __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
   }
-  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
+  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_5generator2, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_extract_iter_dict_i64, __pyx_n_s_extract_iter_locals_extract_iter_2, __pyx_n_s_rapidfuzz_process_cpp); if (unlikely(!gen)) __PYX_ERR(0, 1119, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_5generator2, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_extract_iter_dict_i64, __pyx_n_s_extract_iter_locals_extract_iter_2, __pyx_n_s_rapidfuzz_process_cpp_impl); if (unlikely(!gen)) __PYX_ERR(0, 926, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_iter.extract_iter_dict_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_iter.extract_iter_dict_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_DECREF((PyObject *)__pyx_cur_scope);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_5generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_5generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
 {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *)__pyx_generator->closure);
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *)__pyx_generator->closure);
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   int64_t __pyx_t_2;
   RF_String __pyx_t_3;
   bool __pyx_t_4;
   Py_ssize_t __pyx_t_5;
@@ -14894,221 +15815,221 @@
   int __pyx_t_12;
   PyObject *__pyx_t_13 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("extract_iter_dict_i64", 0);
-  __Pyx_TraceCall("extract_iter_dict_i64", __pyx_f[0], 1119, 0, __PYX_ERR(0, 1119, __pyx_L1_error));
+  __Pyx_TraceCall("extract_iter_dict_i64", __pyx_f[0], 926, 0, __PYX_ERR(0, 926, __pyx_L1_error));
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L13_resume_from_yield;
     case 2: goto __pyx_L15_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_TraceReturn(Py_None, 0);
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1119, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 926, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1125
+  /* "rapidfuzz/process_cpp_impl.pyx":932
  *         """
  *         cdef RF_String proc_str
  *         cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, &scorer_flags)             # <<<<<<<<<<<<<<
  *         query_proc = RF_StringWrapper(conv_sequence(query))
  * 
  */
-  __Pyx_TraceLine(1125,0,__PYX_ERR(0, 1125, __pyx_L1_error))
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1125, __pyx_L1_error) }
+  __Pyx_TraceLine(932,0,__PYX_ERR(0, 932, __pyx_L1_error))
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 932, __pyx_L1_error) }
   __pyx_t_1 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff;
   __Pyx_INCREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_t_1, (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags)); if (unlikely(__pyx_t_2 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1125, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_t_1, (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags)); if (unlikely(__pyx_t_2 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 932, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_c_score_cutoff = __pyx_t_2;
 
-  /* "rapidfuzz/process_cpp.pyx":1126
+  /* "rapidfuzz/process_cpp_impl.pyx":933
  *         cdef RF_String proc_str
  *         cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, &scorer_flags)
  *         query_proc = RF_StringWrapper(conv_sequence(query))             # <<<<<<<<<<<<<<
  * 
  *         cdef RF_ScorerFunc scorer_func
  */
-  __Pyx_TraceLine(1126,0,__PYX_ERR(0, 1126, __pyx_L1_error))
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1126, __pyx_L1_error) }
+  __Pyx_TraceLine(933,0,__PYX_ERR(0, 933, __pyx_L1_error))
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 933, __pyx_L1_error) }
   __pyx_t_1 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_query;
   __Pyx_INCREF(__pyx_t_1);
-  __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1126, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 933, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_query_proc = RF_StringWrapper(__pyx_t_3);
 
-  /* "rapidfuzz/process_cpp.pyx":1129
+  /* "rapidfuzz/process_cpp_impl.pyx":936
  * 
  *         cdef RF_ScorerFunc scorer_func
  *         dereference(scorer_context).scorer_func_init(             # <<<<<<<<<<<<<<
  *             &scorer_func, &kwargs_context.kwargs, 1, &query_proc.string
  *         )
  */
-  __Pyx_TraceLine(1129,0,__PYX_ERR(0, 1129, __pyx_L1_error))
-  __pyx_t_4 = (*__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_context).scorer_func_init((&__pyx_cur_scope->__pyx_v_scorer_func), (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs_context.kwargs), 1, (&__pyx_cur_scope->__pyx_v_query_proc.string)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1129, __pyx_L1_error)
+  __Pyx_TraceLine(936,0,__PYX_ERR(0, 936, __pyx_L1_error))
+  __pyx_t_4 = (*__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_context).scorer_func_init((&__pyx_cur_scope->__pyx_v_scorer_func), (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs_context.kwargs), 1, (&__pyx_cur_scope->__pyx_v_query_proc.string)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 936, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1132
+  /* "rapidfuzz/process_cpp_impl.pyx":939
  *             &scorer_func, &kwargs_context.kwargs, 1, &query_proc.string
  *         )
  *         cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)             # <<<<<<<<<<<<<<
  *         cdef bool lowest_score_worst = is_lowest_score_worst[int64_t](&scorer_flags)
  *         cdef int64_t score
  */
-  __Pyx_TraceLine(1132,0,__PYX_ERR(0, 1132, __pyx_L1_error))
+  __Pyx_TraceLine(939,0,__PYX_ERR(0, 939, __pyx_L1_error))
   __pyx_cur_scope->__pyx_v_ScorerFunc = RF_ScorerWrapper(__pyx_cur_scope->__pyx_v_scorer_func);
 
-  /* "rapidfuzz/process_cpp.pyx":1133
+  /* "rapidfuzz/process_cpp_impl.pyx":940
  *         )
  *         cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  *         cdef bool lowest_score_worst = is_lowest_score_worst[int64_t](&scorer_flags)             # <<<<<<<<<<<<<<
  *         cdef int64_t score
  * 
  */
-  __Pyx_TraceLine(1133,0,__PYX_ERR(0, 1133, __pyx_L1_error))
+  __Pyx_TraceLine(940,0,__PYX_ERR(0, 940, __pyx_L1_error))
   __pyx_cur_scope->__pyx_v_lowest_score_worst = is_lowest_score_worst<int64_t>((&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags));
 
-  /* "rapidfuzz/process_cpp.pyx":1136
+  /* "rapidfuzz/process_cpp_impl.pyx":943
  *         cdef int64_t score
  * 
  *         for choice_key, choice in choices.items():             # <<<<<<<<<<<<<<
  *             if choice is None:
  *                 continue
  */
-  __Pyx_TraceLine(1136,0,__PYX_ERR(0, 1136, __pyx_L1_error))
+  __Pyx_TraceLine(943,0,__PYX_ERR(0, 943, __pyx_L1_error))
   __pyx_t_5 = 0;
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 1136, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 943, __pyx_L1_error) }
   if (unlikely(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-    __PYX_ERR(0, 1136, __pyx_L1_error)
+    __PYX_ERR(0, 943, __pyx_L1_error)
   }
-  __pyx_t_8 = __Pyx_dict_iterator(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_6), (&__pyx_t_7)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1136, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_dict_iterator(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_6), (&__pyx_t_7)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 943, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_8;
   __pyx_t_8 = 0;
   while (1) {
     __pyx_t_10 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_6, &__pyx_t_5, &__pyx_t_8, &__pyx_t_9, NULL, __pyx_t_7);
     if (unlikely(__pyx_t_10 == 0)) break;
-    if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 1136, __pyx_L1_error)
+    if (unlikely(__pyx_t_10 == -1)) __PYX_ERR(0, 943, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_choice_key);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_choice_key, __pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_8);
     __pyx_t_8 = 0;
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_choice);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_choice, __pyx_t_9);
     __Pyx_GIVEREF(__pyx_t_9);
     __pyx_t_9 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":1137
+    /* "rapidfuzz/process_cpp_impl.pyx":944
  * 
  *         for choice_key, choice in choices.items():
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
-    __Pyx_TraceLine(1137,0,__PYX_ERR(0, 1137, __pyx_L1_error))
+    __Pyx_TraceLine(944,0,__PYX_ERR(0, 944, __pyx_L1_error))
     __pyx_t_11 = (__pyx_cur_scope->__pyx_v_choice == Py_None);
     if (__pyx_t_11) {
 
-      /* "rapidfuzz/process_cpp.pyx":1138
+      /* "rapidfuzz/process_cpp_impl.pyx":945
  *         for choice_key, choice in choices.items():
  *             if choice is None:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             # use RapidFuzz C-Api
  */
-      __Pyx_TraceLine(1138,0,__PYX_ERR(0, 1138, __pyx_L1_error))
+      __Pyx_TraceLine(945,0,__PYX_ERR(0, 945, __pyx_L1_error))
       goto __pyx_L4_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":1137
+      /* "rapidfuzz/process_cpp_impl.pyx":944
  * 
  *         for choice_key, choice in choices.items():
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1141
+    /* "rapidfuzz/process_cpp_impl.pyx":948
  * 
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  */
-    __Pyx_TraceLine(1141,0,__PYX_ERR(0, 1141, __pyx_L1_error))
+    __Pyx_TraceLine(948,0,__PYX_ERR(0, 948, __pyx_L1_error))
     __pyx_t_12 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context != NULL);
     if (__pyx_t_12) {
     } else {
       __pyx_t_11 = __pyx_t_12;
       goto __pyx_L8_bool_binop_done;
     }
     __pyx_t_12 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->version == 1);
     __pyx_t_11 = __pyx_t_12;
     __pyx_L8_bool_binop_done:;
     if (__pyx_t_11) {
 
-      /* "rapidfuzz/process_cpp.pyx":1142
+      /* "rapidfuzz/process_cpp_impl.pyx":949
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:
  *                 processor_context.preprocess(choice, &proc_str)             # <<<<<<<<<<<<<<
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:
  */
-      __Pyx_TraceLine(1142,0,__PYX_ERR(0, 1142, __pyx_L1_error))
-      __pyx_t_4 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->preprocess(__pyx_cur_scope->__pyx_v_choice, (&__pyx_cur_scope->__pyx_v_proc_str)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1142, __pyx_L1_error)
+      __Pyx_TraceLine(949,0,__PYX_ERR(0, 949, __pyx_L1_error))
+      __pyx_t_4 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->preprocess(__pyx_cur_scope->__pyx_v_choice, (&__pyx_cur_scope->__pyx_v_proc_str)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 949, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":1143
+      /* "rapidfuzz/process_cpp_impl.pyx":950
  *             if processor_context != NULL and processor_context.version == 1:
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)             # <<<<<<<<<<<<<<
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  */
-      __Pyx_TraceLine(1143,0,__PYX_ERR(0, 1143, __pyx_L1_error))
+      __Pyx_TraceLine(950,0,__PYX_ERR(0, 950, __pyx_L1_error))
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_cur_scope->__pyx_v_proc_str);
 
-      /* "rapidfuzz/process_cpp.pyx":1141
+      /* "rapidfuzz/process_cpp_impl.pyx":948
  * 
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1144
+    /* "rapidfuzz/process_cpp_impl.pyx":951
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:             # <<<<<<<<<<<<<<
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  */
-    __Pyx_TraceLine(1144,0,__PYX_ERR(0, 1144, __pyx_L1_error))
-    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1144, __pyx_L1_error) }
+    __Pyx_TraceLine(951,0,__PYX_ERR(0, 951, __pyx_L1_error))
+    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 951, __pyx_L1_error) }
     __pyx_t_11 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor != Py_None);
     if (__pyx_t_11) {
 
-      /* "rapidfuzz/process_cpp.pyx":1145
+      /* "rapidfuzz/process_cpp_impl.pyx":952
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:
  *                 proc_choice = processor(choice)             # <<<<<<<<<<<<<<
  *                 if proc_choice is None:
  *                     continue
  */
-      __Pyx_TraceLine(1145,0,__PYX_ERR(0, 1145, __pyx_L1_error))
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1145, __pyx_L1_error) }
+      __Pyx_TraceLine(952,0,__PYX_ERR(0, 952, __pyx_L1_error))
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 952, __pyx_L1_error) }
       __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor);
       __pyx_t_8 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor; __pyx_t_13 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
         __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_8);
         if (likely(__pyx_t_13)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -15118,136 +16039,136 @@
           __pyx_t_10 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_13, __pyx_cur_scope->__pyx_v_choice};
         __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
         __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
-        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1145, __pyx_L1_error)
+        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 952, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       }
       __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_proc_choice);
       __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_proc_choice, __pyx_t_9);
       __Pyx_GIVEREF(__pyx_t_9);
       __pyx_t_9 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":1146
+      /* "rapidfuzz/process_cpp_impl.pyx":953
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
-      __Pyx_TraceLine(1146,0,__PYX_ERR(0, 1146, __pyx_L1_error))
+      __Pyx_TraceLine(953,0,__PYX_ERR(0, 953, __pyx_L1_error))
       __pyx_t_11 = (__pyx_cur_scope->__pyx_v_proc_choice == Py_None);
       if (__pyx_t_11) {
 
-        /* "rapidfuzz/process_cpp.pyx":1147
+        /* "rapidfuzz/process_cpp_impl.pyx":954
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))
  */
-        __Pyx_TraceLine(1147,0,__PYX_ERR(0, 1147, __pyx_L1_error))
+        __Pyx_TraceLine(954,0,__PYX_ERR(0, 954, __pyx_L1_error))
         goto __pyx_L4_continue;
 
-        /* "rapidfuzz/process_cpp.pyx":1146
+        /* "rapidfuzz/process_cpp_impl.pyx":953
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1149
+      /* "rapidfuzz/process_cpp_impl.pyx":956
  *                     continue
  * 
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))             # <<<<<<<<<<<<<<
  *             else:
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))
  */
-      __Pyx_TraceLine(1149,0,__PYX_ERR(0, 1149, __pyx_L1_error))
-      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1149, __pyx_L1_error)
+      __Pyx_TraceLine(956,0,__PYX_ERR(0, 956, __pyx_L1_error))
+      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 956, __pyx_L1_error)
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_t_3);
 
-      /* "rapidfuzz/process_cpp.pyx":1144
+      /* "rapidfuzz/process_cpp_impl.pyx":951
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:             # <<<<<<<<<<<<<<
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1151
+    /* "rapidfuzz/process_cpp_impl.pyx":958
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))
  *             else:
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))             # <<<<<<<<<<<<<<
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  */
-    __Pyx_TraceLine(1151,0,__PYX_ERR(0, 1151, __pyx_L1_error))
+    __Pyx_TraceLine(958,0,__PYX_ERR(0, 958, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1151, __pyx_L1_error)
+      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 958, __pyx_L1_error)
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_t_3);
     }
     __pyx_L7:;
 
-    /* "rapidfuzz/process_cpp.pyx":1153
+    /* "rapidfuzz/process_cpp_impl.pyx":960
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)             # <<<<<<<<<<<<<<
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:
  */
-    __Pyx_TraceLine(1153,0,__PYX_ERR(0, 1153, __pyx_L1_error))
+    __Pyx_TraceLine(960,0,__PYX_ERR(0, 960, __pyx_L1_error))
     try {
       __pyx_cur_scope->__pyx_v_ScorerFunc.call((&__pyx_cur_scope->__pyx_v_choice_proc.string), __pyx_cur_scope->__pyx_v_c_score_cutoff, (&__pyx_cur_scope->__pyx_v_score));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 1153, __pyx_L1_error)
+      __PYX_ERR(0, 960, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1154
+    /* "rapidfuzz/process_cpp_impl.pyx":961
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, choice_key)
  */
-    __Pyx_TraceLine(1154,0,__PYX_ERR(0, 1154, __pyx_L1_error))
+    __Pyx_TraceLine(961,0,__PYX_ERR(0, 961, __pyx_L1_error))
     __pyx_t_11 = (__pyx_cur_scope->__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_11) {
 
-      /* "rapidfuzz/process_cpp.pyx":1155
+      /* "rapidfuzz/process_cpp_impl.pyx":962
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  *             else:
  */
-      __Pyx_TraceLine(1155,0,__PYX_ERR(0, 1155, __pyx_L1_error))
+      __Pyx_TraceLine(962,0,__PYX_ERR(0, 962, __pyx_L1_error))
       __pyx_t_11 = (__pyx_cur_scope->__pyx_v_score >= __pyx_cur_scope->__pyx_v_c_score_cutoff);
       if (__pyx_t_11) {
 
-        /* "rapidfuzz/process_cpp.pyx":1156
+        /* "rapidfuzz/process_cpp_impl.pyx":963
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, choice_key)             # <<<<<<<<<<<<<<
  *             else:
  *                 if score <= c_score_cutoff:
  */
-        __Pyx_TraceLine(1156,0,__PYX_ERR(0, 1156, __pyx_L1_error))
-        __pyx_t_9 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1156, __pyx_L1_error)
+        __Pyx_TraceLine(963,0,__PYX_ERR(0, 963, __pyx_L1_error))
+        __pyx_t_9 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 963, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
-        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1156, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 963, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_t_9);
         PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_9);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice_key);
@@ -15271,58 +16192,58 @@
         __pyx_L13_resume_from_yield:;
         __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_1;
         __pyx_t_6 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_7 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1156, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 963, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1155
+        /* "rapidfuzz/process_cpp_impl.pyx":962
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  *             else:
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1154
+      /* "rapidfuzz/process_cpp_impl.pyx":961
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, choice_key)
  */
       goto __pyx_L11;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1158
+    /* "rapidfuzz/process_cpp_impl.pyx":965
  *                     yield (choice, score, choice_key)
  *             else:
  *                 if score <= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  * 
  */
-    __Pyx_TraceLine(1158,0,__PYX_ERR(0, 1158, __pyx_L1_error))
+    __Pyx_TraceLine(965,0,__PYX_ERR(0, 965, __pyx_L1_error))
     /*else*/ {
       __pyx_t_11 = (__pyx_cur_scope->__pyx_v_score <= __pyx_cur_scope->__pyx_v_c_score_cutoff);
       if (__pyx_t_11) {
 
-        /* "rapidfuzz/process_cpp.pyx":1159
+        /* "rapidfuzz/process_cpp_impl.pyx":966
  *             else:
  *                 if score <= c_score_cutoff:
  *                     yield (choice, score, choice_key)             # <<<<<<<<<<<<<<
  * 
  *     def extract_iter_list_f64():
  */
-        __Pyx_TraceLine(1159,0,__PYX_ERR(0, 1159, __pyx_L1_error))
-        __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1159, __pyx_L1_error)
+        __Pyx_TraceLine(966,0,__PYX_ERR(0, 966, __pyx_L1_error))
+        __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 966, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1159, __pyx_L1_error)
+        __pyx_t_9 = PyTuple_New(3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 966, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_8);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice_key);
@@ -15346,32 +16267,32 @@
         __pyx_L15_resume_from_yield:;
         __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_1;
         __pyx_t_6 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_7 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1159, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 966, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1158
+        /* "rapidfuzz/process_cpp_impl.pyx":965
  *                     yield (choice, score, choice_key)
  *             else:
  *                 if score <= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  * 
  */
       }
     }
     __pyx_L11:;
     __pyx_L4_continue:;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "rapidfuzz/process_cpp.pyx":1119
+  /* "rapidfuzz/process_cpp_impl.pyx":926
  *                     yield (choice, score, choice_key)
  * 
  *     def extract_iter_dict_i64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type
  */
 
@@ -15392,79 +16313,79 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_8generator3(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_8generator3(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "rapidfuzz/process_cpp.pyx":1161
+/* "rapidfuzz/process_cpp_impl.pyx":968
  *                     yield (choice, score, choice_key)
  * 
  *     def extract_iter_list_f64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_7extract_iter_list_f64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_6extract_iter_list_f64, "\n        implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type\n        float64\n        ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_7extract_iter_list_f64 = {"extract_iter_list_f64", (PyCFunction)__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_7extract_iter_list_f64, METH_NOARGS, __pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_6extract_iter_list_f64};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_7extract_iter_list_f64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_7extract_iter_list_f64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+PyDoc_STRVAR(__pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_6extract_iter_list_f64, "\n        implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type\n        float64\n        ");
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_7extract_iter_list_f64 = {"extract_iter_list_f64", (PyCFunction)__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_7extract_iter_list_f64, METH_NOARGS, __pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_6extract_iter_list_f64};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_7extract_iter_list_f64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("extract_iter_list_f64 (wrapper)", 0);
-  __pyx_r = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_6extract_iter_list_f64(__pyx_self);
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_6extract_iter_list_f64(__pyx_self);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_6extract_iter_list_f64(PyObject *__pyx_self) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *__pyx_cur_scope;
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_6extract_iter_list_f64(PyObject *__pyx_self) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *__pyx_cur_scope;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_iter_list_f64", 0);
-  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64, __pyx_empty_tuple, NULL);
+  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
-    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *)Py_None);
+    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1161, __pyx_L1_error)
+    __PYX_ERR(0, 968, __pyx_L1_error)
   } else {
     __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
   }
-  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
+  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_8generator3, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_extract_iter_list_f64, __pyx_n_s_extract_iter_locals_extract_iter_3, __pyx_n_s_rapidfuzz_process_cpp); if (unlikely(!gen)) __PYX_ERR(0, 1161, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_8generator3, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_extract_iter_list_f64, __pyx_n_s_extract_iter_locals_extract_iter_3, __pyx_n_s_rapidfuzz_process_cpp_impl); if (unlikely(!gen)) __PYX_ERR(0, 968, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_iter.extract_iter_list_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_iter.extract_iter_list_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_DECREF((PyObject *)__pyx_cur_scope);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_8generator3(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_8generator3(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
 {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *)__pyx_generator->closure);
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *)__pyx_generator->closure);
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   double __pyx_t_2;
   RF_String __pyx_t_3;
   bool __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
@@ -15477,251 +16398,251 @@
   PyObject *__pyx_t_12 = NULL;
   int __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("extract_iter_list_f64", 0);
-  __Pyx_TraceCall("extract_iter_list_f64", __pyx_f[0], 1161, 0, __PYX_ERR(0, 1161, __pyx_L1_error));
+  __Pyx_TraceCall("extract_iter_list_f64", __pyx_f[0], 968, 0, __PYX_ERR(0, 968, __pyx_L1_error));
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L13_resume_from_yield;
     case 2: goto __pyx_L15_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_TraceReturn(Py_None, 0);
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1161, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 968, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1167
+  /* "rapidfuzz/process_cpp_impl.pyx":974
  *         """
  *         cdef RF_String proc_str
  *         cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, &scorer_flags)             # <<<<<<<<<<<<<<
  *         query_proc = RF_StringWrapper(conv_sequence(query))
  * 
  */
-  __Pyx_TraceLine(1167,0,__PYX_ERR(0, 1167, __pyx_L1_error))
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1167, __pyx_L1_error) }
+  __Pyx_TraceLine(974,0,__PYX_ERR(0, 974, __pyx_L1_error))
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 974, __pyx_L1_error) }
   __pyx_t_1 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff;
   __Pyx_INCREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_t_1, (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags)); if (unlikely(__pyx_t_2 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1167, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_t_1, (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags)); if (unlikely(__pyx_t_2 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 974, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_c_score_cutoff = __pyx_t_2;
 
-  /* "rapidfuzz/process_cpp.pyx":1168
+  /* "rapidfuzz/process_cpp_impl.pyx":975
  *         cdef RF_String proc_str
  *         cdef double c_score_cutoff = get_score_cutoff_f64(score_cutoff, &scorer_flags)
  *         query_proc = RF_StringWrapper(conv_sequence(query))             # <<<<<<<<<<<<<<
  * 
  *         cdef RF_ScorerFunc scorer_func
  */
-  __Pyx_TraceLine(1168,0,__PYX_ERR(0, 1168, __pyx_L1_error))
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1168, __pyx_L1_error) }
+  __Pyx_TraceLine(975,0,__PYX_ERR(0, 975, __pyx_L1_error))
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 975, __pyx_L1_error) }
   __pyx_t_1 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_query;
   __Pyx_INCREF(__pyx_t_1);
-  __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1168, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 975, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_query_proc = RF_StringWrapper(__pyx_t_3);
 
-  /* "rapidfuzz/process_cpp.pyx":1171
+  /* "rapidfuzz/process_cpp_impl.pyx":978
  * 
  *         cdef RF_ScorerFunc scorer_func
  *         dereference(scorer_context).scorer_func_init(             # <<<<<<<<<<<<<<
  *             &scorer_func, &kwargs_context.kwargs, 1, &query_proc.string
  *         )
  */
-  __Pyx_TraceLine(1171,0,__PYX_ERR(0, 1171, __pyx_L1_error))
-  __pyx_t_4 = (*__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_context).scorer_func_init((&__pyx_cur_scope->__pyx_v_scorer_func), (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs_context.kwargs), 1, (&__pyx_cur_scope->__pyx_v_query_proc.string)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1171, __pyx_L1_error)
+  __Pyx_TraceLine(978,0,__PYX_ERR(0, 978, __pyx_L1_error))
+  __pyx_t_4 = (*__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_context).scorer_func_init((&__pyx_cur_scope->__pyx_v_scorer_func), (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs_context.kwargs), 1, (&__pyx_cur_scope->__pyx_v_query_proc.string)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 978, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1174
+  /* "rapidfuzz/process_cpp_impl.pyx":981
  *             &scorer_func, &kwargs_context.kwargs, 1, &query_proc.string
  *         )
  *         cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)             # <<<<<<<<<<<<<<
  *         cdef bool lowest_score_worst = is_lowest_score_worst[double](&scorer_flags)
  *         cdef double score
  */
-  __Pyx_TraceLine(1174,0,__PYX_ERR(0, 1174, __pyx_L1_error))
+  __Pyx_TraceLine(981,0,__PYX_ERR(0, 981, __pyx_L1_error))
   __pyx_cur_scope->__pyx_v_ScorerFunc = RF_ScorerWrapper(__pyx_cur_scope->__pyx_v_scorer_func);
 
-  /* "rapidfuzz/process_cpp.pyx":1175
+  /* "rapidfuzz/process_cpp_impl.pyx":982
  *         )
  *         cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  *         cdef bool lowest_score_worst = is_lowest_score_worst[double](&scorer_flags)             # <<<<<<<<<<<<<<
  *         cdef double score
  * 
  */
-  __Pyx_TraceLine(1175,0,__PYX_ERR(0, 1175, __pyx_L1_error))
+  __Pyx_TraceLine(982,0,__PYX_ERR(0, 982, __pyx_L1_error))
   __pyx_cur_scope->__pyx_v_lowest_score_worst = is_lowest_score_worst<double>((&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags));
 
-  /* "rapidfuzz/process_cpp.pyx":1178
+  /* "rapidfuzz/process_cpp_impl.pyx":985
  *         cdef double score
  * 
  *         for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *             if choice is None:
  *                 continue
  */
-  __Pyx_TraceLine(1178,0,__PYX_ERR(0, 1178, __pyx_L1_error))
+  __Pyx_TraceLine(985,0,__PYX_ERR(0, 985, __pyx_L1_error))
   __Pyx_INCREF(__pyx_int_0);
   __pyx_t_1 = __pyx_int_0;
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 1178, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 985, __pyx_L1_error) }
   if (likely(PyList_CheckExact(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) || PyTuple_CheckExact(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) {
     __pyx_t_5 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices; __Pyx_INCREF(__pyx_t_5); __pyx_t_6 = 0;
     __pyx_t_7 = NULL;
   } else {
-    __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1178, __pyx_L1_error)
+    __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 985, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1178, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 985, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_7)) {
       if (likely(PyList_CheckExact(__pyx_t_5))) {
         if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_5)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_8 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 1178, __pyx_L1_error)
+        __pyx_t_8 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 985, __pyx_L1_error)
         #else
-        __pyx_t_8 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1178, __pyx_L1_error)
+        __pyx_t_8 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 985, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         #endif
       } else {
         if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 1178, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 985, __pyx_L1_error)
         #else
-        __pyx_t_8 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1178, __pyx_L1_error)
+        __pyx_t_8 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 985, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         #endif
       }
     } else {
       __pyx_t_8 = __pyx_t_7(__pyx_t_5);
       if (unlikely(!__pyx_t_8)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 1178, __pyx_L1_error)
+          else __PYX_ERR(0, 985, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_8);
     }
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_choice);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_choice, __pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_8);
     __pyx_t_8 = 0;
     __Pyx_INCREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_i);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_i, __pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1178, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 985, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_1);
     __pyx_t_1 = __pyx_t_8;
     __pyx_t_8 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":1179
+    /* "rapidfuzz/process_cpp_impl.pyx":986
  * 
  *         for i, choice in enumerate(choices):
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
-    __Pyx_TraceLine(1179,0,__PYX_ERR(0, 1179, __pyx_L1_error))
+    __Pyx_TraceLine(986,0,__PYX_ERR(0, 986, __pyx_L1_error))
     __pyx_t_9 = (__pyx_cur_scope->__pyx_v_choice == Py_None);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1180
+      /* "rapidfuzz/process_cpp_impl.pyx":987
  *         for i, choice in enumerate(choices):
  *             if choice is None:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             # use RapidFuzz C-Api
  */
-      __Pyx_TraceLine(1180,0,__PYX_ERR(0, 1180, __pyx_L1_error))
+      __Pyx_TraceLine(987,0,__PYX_ERR(0, 987, __pyx_L1_error))
       goto __pyx_L4_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":1179
+      /* "rapidfuzz/process_cpp_impl.pyx":986
  * 
  *         for i, choice in enumerate(choices):
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1183
+    /* "rapidfuzz/process_cpp_impl.pyx":990
  * 
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  */
-    __Pyx_TraceLine(1183,0,__PYX_ERR(0, 1183, __pyx_L1_error))
+    __Pyx_TraceLine(990,0,__PYX_ERR(0, 990, __pyx_L1_error))
     __pyx_t_10 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context != NULL);
     if (__pyx_t_10) {
     } else {
       __pyx_t_9 = __pyx_t_10;
       goto __pyx_L8_bool_binop_done;
     }
     __pyx_t_10 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->version == 1);
     __pyx_t_9 = __pyx_t_10;
     __pyx_L8_bool_binop_done:;
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1184
+      /* "rapidfuzz/process_cpp_impl.pyx":991
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:
  *                 processor_context.preprocess(choice, &proc_str)             # <<<<<<<<<<<<<<
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:
  */
-      __Pyx_TraceLine(1184,0,__PYX_ERR(0, 1184, __pyx_L1_error))
-      __pyx_t_4 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->preprocess(__pyx_cur_scope->__pyx_v_choice, (&__pyx_cur_scope->__pyx_v_proc_str)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1184, __pyx_L1_error)
+      __Pyx_TraceLine(991,0,__PYX_ERR(0, 991, __pyx_L1_error))
+      __pyx_t_4 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->preprocess(__pyx_cur_scope->__pyx_v_choice, (&__pyx_cur_scope->__pyx_v_proc_str)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 991, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":1185
+      /* "rapidfuzz/process_cpp_impl.pyx":992
  *             if processor_context != NULL and processor_context.version == 1:
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)             # <<<<<<<<<<<<<<
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  */
-      __Pyx_TraceLine(1185,0,__PYX_ERR(0, 1185, __pyx_L1_error))
+      __Pyx_TraceLine(992,0,__PYX_ERR(0, 992, __pyx_L1_error))
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_cur_scope->__pyx_v_proc_str);
 
-      /* "rapidfuzz/process_cpp.pyx":1183
+      /* "rapidfuzz/process_cpp_impl.pyx":990
  * 
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1186
+    /* "rapidfuzz/process_cpp_impl.pyx":993
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:             # <<<<<<<<<<<<<<
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  */
-    __Pyx_TraceLine(1186,0,__PYX_ERR(0, 1186, __pyx_L1_error))
-    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1186, __pyx_L1_error) }
+    __Pyx_TraceLine(993,0,__PYX_ERR(0, 993, __pyx_L1_error))
+    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 993, __pyx_L1_error) }
     __pyx_t_9 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor != Py_None);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1187
+      /* "rapidfuzz/process_cpp_impl.pyx":994
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:
  *                 proc_choice = processor(choice)             # <<<<<<<<<<<<<<
  *                 if proc_choice is None:
  *                     continue
  */
-      __Pyx_TraceLine(1187,0,__PYX_ERR(0, 1187, __pyx_L1_error))
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1187, __pyx_L1_error) }
+      __Pyx_TraceLine(994,0,__PYX_ERR(0, 994, __pyx_L1_error))
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 994, __pyx_L1_error) }
       __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor);
       __pyx_t_11 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor; __pyx_t_12 = NULL;
       __pyx_t_13 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
         __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_11);
         if (likely(__pyx_t_12)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
@@ -15731,136 +16652,136 @@
           __pyx_t_13 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_12, __pyx_cur_scope->__pyx_v_choice};
         __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_13, 1+__pyx_t_13);
         __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-        if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1187, __pyx_L1_error)
+        if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 994, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       }
       __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_proc_choice);
       __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_proc_choice, __pyx_t_8);
       __Pyx_GIVEREF(__pyx_t_8);
       __pyx_t_8 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":1188
+      /* "rapidfuzz/process_cpp_impl.pyx":995
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
-      __Pyx_TraceLine(1188,0,__PYX_ERR(0, 1188, __pyx_L1_error))
+      __Pyx_TraceLine(995,0,__PYX_ERR(0, 995, __pyx_L1_error))
       __pyx_t_9 = (__pyx_cur_scope->__pyx_v_proc_choice == Py_None);
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":1189
+        /* "rapidfuzz/process_cpp_impl.pyx":996
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))
  */
-        __Pyx_TraceLine(1189,0,__PYX_ERR(0, 1189, __pyx_L1_error))
+        __Pyx_TraceLine(996,0,__PYX_ERR(0, 996, __pyx_L1_error))
         goto __pyx_L4_continue;
 
-        /* "rapidfuzz/process_cpp.pyx":1188
+        /* "rapidfuzz/process_cpp_impl.pyx":995
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1191
+      /* "rapidfuzz/process_cpp_impl.pyx":998
  *                     continue
  * 
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))             # <<<<<<<<<<<<<<
  *             else:
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))
  */
-      __Pyx_TraceLine(1191,0,__PYX_ERR(0, 1191, __pyx_L1_error))
-      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1191, __pyx_L1_error)
+      __Pyx_TraceLine(998,0,__PYX_ERR(0, 998, __pyx_L1_error))
+      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 998, __pyx_L1_error)
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_t_3);
 
-      /* "rapidfuzz/process_cpp.pyx":1186
+      /* "rapidfuzz/process_cpp_impl.pyx":993
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:             # <<<<<<<<<<<<<<
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1193
+    /* "rapidfuzz/process_cpp_impl.pyx":1000
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))
  *             else:
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))             # <<<<<<<<<<<<<<
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  */
-    __Pyx_TraceLine(1193,0,__PYX_ERR(0, 1193, __pyx_L1_error))
+    __Pyx_TraceLine(1000,0,__PYX_ERR(0, 1000, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1193, __pyx_L1_error)
+      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1000, __pyx_L1_error)
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_t_3);
     }
     __pyx_L7:;
 
-    /* "rapidfuzz/process_cpp.pyx":1195
+    /* "rapidfuzz/process_cpp_impl.pyx":1002
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)             # <<<<<<<<<<<<<<
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:
  */
-    __Pyx_TraceLine(1195,0,__PYX_ERR(0, 1195, __pyx_L1_error))
+    __Pyx_TraceLine(1002,0,__PYX_ERR(0, 1002, __pyx_L1_error))
     try {
       __pyx_cur_scope->__pyx_v_ScorerFunc.call((&__pyx_cur_scope->__pyx_v_choice_proc.string), __pyx_cur_scope->__pyx_v_c_score_cutoff, (&__pyx_cur_scope->__pyx_v_score));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 1195, __pyx_L1_error)
+      __PYX_ERR(0, 1002, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1196
+    /* "rapidfuzz/process_cpp_impl.pyx":1003
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, i)
  */
-    __Pyx_TraceLine(1196,0,__PYX_ERR(0, 1196, __pyx_L1_error))
+    __Pyx_TraceLine(1003,0,__PYX_ERR(0, 1003, __pyx_L1_error))
     __pyx_t_9 = (__pyx_cur_scope->__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1197
+      /* "rapidfuzz/process_cpp_impl.pyx":1004
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  *             else:
  */
-      __Pyx_TraceLine(1197,0,__PYX_ERR(0, 1197, __pyx_L1_error))
+      __Pyx_TraceLine(1004,0,__PYX_ERR(0, 1004, __pyx_L1_error))
       __pyx_t_9 = (__pyx_cur_scope->__pyx_v_score >= __pyx_cur_scope->__pyx_v_c_score_cutoff);
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":1198
+        /* "rapidfuzz/process_cpp_impl.pyx":1005
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, i)             # <<<<<<<<<<<<<<
  *             else:
  *                 if score <= c_score_cutoff:
  */
-        __Pyx_TraceLine(1198,0,__PYX_ERR(0, 1198, __pyx_L1_error))
-        __pyx_t_8 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1198, __pyx_L1_error)
+        __Pyx_TraceLine(1005,0,__PYX_ERR(0, 1005, __pyx_L1_error))
+        __pyx_t_8 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1005, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1198, __pyx_L1_error)
+        __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1005, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_8);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_i);
@@ -15887,58 +16808,58 @@
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_1;
         __pyx_cur_scope->__pyx_t_1 = 0;
         __Pyx_XGOTREF(__pyx_t_5);
         __pyx_t_6 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_7 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1198, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1005, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1197
+        /* "rapidfuzz/process_cpp_impl.pyx":1004
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  *             else:
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1196
+      /* "rapidfuzz/process_cpp_impl.pyx":1003
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, i)
  */
       goto __pyx_L11;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1200
+    /* "rapidfuzz/process_cpp_impl.pyx":1007
  *                     yield (choice, score, i)
  *             else:
  *                 if score <= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  * 
  */
-    __Pyx_TraceLine(1200,0,__PYX_ERR(0, 1200, __pyx_L1_error))
+    __Pyx_TraceLine(1007,0,__PYX_ERR(0, 1007, __pyx_L1_error))
     /*else*/ {
       __pyx_t_9 = (__pyx_cur_scope->__pyx_v_score <= __pyx_cur_scope->__pyx_v_c_score_cutoff);
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":1201
+        /* "rapidfuzz/process_cpp_impl.pyx":1008
  *             else:
  *                 if score <= c_score_cutoff:
  *                     yield (choice, score, i)             # <<<<<<<<<<<<<<
  * 
  *     def extract_iter_list_i64():
  */
-        __Pyx_TraceLine(1201,0,__PYX_ERR(0, 1201, __pyx_L1_error))
-        __pyx_t_11 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1201, __pyx_L1_error)
+        __Pyx_TraceLine(1008,0,__PYX_ERR(0, 1008, __pyx_L1_error))
+        __pyx_t_11 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1008, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
-        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1201, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1008, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_t_11);
         PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_11);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_i);
@@ -15965,42 +16886,42 @@
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_1;
         __pyx_cur_scope->__pyx_t_1 = 0;
         __Pyx_XGOTREF(__pyx_t_5);
         __pyx_t_6 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_7 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1201, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1008, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1200
+        /* "rapidfuzz/process_cpp_impl.pyx":1007
  *                     yield (choice, score, i)
  *             else:
  *                 if score <= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  * 
  */
       }
     }
     __pyx_L11:;
 
-    /* "rapidfuzz/process_cpp.pyx":1178
+    /* "rapidfuzz/process_cpp_impl.pyx":985
  *         cdef double score
  * 
  *         for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *             if choice is None:
  *                 continue
  */
-    __Pyx_TraceLine(1178,0,__PYX_ERR(0, 1178, __pyx_L1_error))
+    __Pyx_TraceLine(985,0,__PYX_ERR(0, 985, __pyx_L1_error))
     __pyx_L4_continue:;
   }
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "rapidfuzz/process_cpp.pyx":1161
+  /* "rapidfuzz/process_cpp_impl.pyx":968
  *                     yield (choice, score, choice_key)
  * 
  *     def extract_iter_list_f64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type
  */
 
@@ -16022,79 +16943,79 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_11generator4(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_11generator4(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "rapidfuzz/process_cpp.pyx":1203
+/* "rapidfuzz/process_cpp_impl.pyx":1010
  *                     yield (choice, score, i)
  * 
  *     def extract_iter_list_i64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_10extract_iter_list_i64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_9extract_iter_list_i64, "\n        implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type\n        int64_t\n        ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_10extract_iter_list_i64 = {"extract_iter_list_i64", (PyCFunction)__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_10extract_iter_list_i64, METH_NOARGS, __pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_9extract_iter_list_i64};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_10extract_iter_list_i64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_10extract_iter_list_i64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+PyDoc_STRVAR(__pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_9extract_iter_list_i64, "\n        implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type\n        int64_t\n        ");
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_10extract_iter_list_i64 = {"extract_iter_list_i64", (PyCFunction)__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_10extract_iter_list_i64, METH_NOARGS, __pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_9extract_iter_list_i64};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_10extract_iter_list_i64(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
   CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("extract_iter_list_i64 (wrapper)", 0);
-  __pyx_r = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_9extract_iter_list_i64(__pyx_self);
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_9extract_iter_list_i64(__pyx_self);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_9extract_iter_list_i64(PyObject *__pyx_self) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *__pyx_cur_scope;
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_9extract_iter_list_i64(PyObject *__pyx_self) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *__pyx_cur_scope;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_iter_list_i64", 0);
-  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64, __pyx_empty_tuple, NULL);
+  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
-    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *)Py_None);
+    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1203, __pyx_L1_error)
+    __PYX_ERR(0, 1010, __pyx_L1_error)
   } else {
     __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
   }
-  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
+  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_11generator4, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_extract_iter_list_i64, __pyx_n_s_extract_iter_locals_extract_iter_4, __pyx_n_s_rapidfuzz_process_cpp); if (unlikely(!gen)) __PYX_ERR(0, 1203, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_11generator4, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_extract_iter_list_i64, __pyx_n_s_extract_iter_locals_extract_iter_4, __pyx_n_s_rapidfuzz_process_cpp_impl); if (unlikely(!gen)) __PYX_ERR(0, 1010, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_iter.extract_iter_list_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_iter.extract_iter_list_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_DECREF((PyObject *)__pyx_cur_scope);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_11generator4(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_11generator4(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
 {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *)__pyx_generator->closure);
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *)__pyx_generator->closure);
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   int64_t __pyx_t_2;
   RF_String __pyx_t_3;
   bool __pyx_t_4;
   PyObject *__pyx_t_5 = NULL;
@@ -16107,251 +17028,251 @@
   PyObject *__pyx_t_12 = NULL;
   int __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("extract_iter_list_i64", 0);
-  __Pyx_TraceCall("extract_iter_list_i64", __pyx_f[0], 1203, 0, __PYX_ERR(0, 1203, __pyx_L1_error));
+  __Pyx_TraceCall("extract_iter_list_i64", __pyx_f[0], 1010, 0, __PYX_ERR(0, 1010, __pyx_L1_error));
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L13_resume_from_yield;
     case 2: goto __pyx_L15_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_TraceReturn(Py_None, 0);
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1203, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1010, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1209
+  /* "rapidfuzz/process_cpp_impl.pyx":1016
  *         """
  *         cdef RF_String proc_str
  *         cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, &scorer_flags)             # <<<<<<<<<<<<<<
  *         query_proc = RF_StringWrapper(conv_sequence(query))
  * 
  */
-  __Pyx_TraceLine(1209,0,__PYX_ERR(0, 1209, __pyx_L1_error))
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1209, __pyx_L1_error) }
+  __Pyx_TraceLine(1016,0,__PYX_ERR(0, 1016, __pyx_L1_error))
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1016, __pyx_L1_error) }
   __pyx_t_1 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff;
   __Pyx_INCREF(__pyx_t_1);
-  __pyx_t_2 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_t_1, (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags)); if (unlikely(__pyx_t_2 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1209, __pyx_L1_error)
+  __pyx_t_2 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_t_1, (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags)); if (unlikely(__pyx_t_2 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1016, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_c_score_cutoff = __pyx_t_2;
 
-  /* "rapidfuzz/process_cpp.pyx":1210
+  /* "rapidfuzz/process_cpp_impl.pyx":1017
  *         cdef RF_String proc_str
  *         cdef int64_t c_score_cutoff = get_score_cutoff_i64(score_cutoff, &scorer_flags)
  *         query_proc = RF_StringWrapper(conv_sequence(query))             # <<<<<<<<<<<<<<
  * 
  *         cdef RF_ScorerFunc scorer_func
  */
-  __Pyx_TraceLine(1210,0,__PYX_ERR(0, 1210, __pyx_L1_error))
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1210, __pyx_L1_error) }
+  __Pyx_TraceLine(1017,0,__PYX_ERR(0, 1017, __pyx_L1_error))
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1017, __pyx_L1_error) }
   __pyx_t_1 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_query;
   __Pyx_INCREF(__pyx_t_1);
-  __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1210, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1017, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_query_proc = RF_StringWrapper(__pyx_t_3);
 
-  /* "rapidfuzz/process_cpp.pyx":1213
+  /* "rapidfuzz/process_cpp_impl.pyx":1020
  * 
  *         cdef RF_ScorerFunc scorer_func
  *         dereference(scorer_context).scorer_func_init(             # <<<<<<<<<<<<<<
  *             &scorer_func, &kwargs_context.kwargs, 1, &query_proc.string
  *         )
  */
-  __Pyx_TraceLine(1213,0,__PYX_ERR(0, 1213, __pyx_L1_error))
-  __pyx_t_4 = (*__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_context).scorer_func_init((&__pyx_cur_scope->__pyx_v_scorer_func), (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs_context.kwargs), 1, (&__pyx_cur_scope->__pyx_v_query_proc.string)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1213, __pyx_L1_error)
+  __Pyx_TraceLine(1020,0,__PYX_ERR(0, 1020, __pyx_L1_error))
+  __pyx_t_4 = (*__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_context).scorer_func_init((&__pyx_cur_scope->__pyx_v_scorer_func), (&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs_context.kwargs), 1, (&__pyx_cur_scope->__pyx_v_query_proc.string)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1020, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1216
+  /* "rapidfuzz/process_cpp_impl.pyx":1023
  *             &scorer_func, &kwargs_context.kwargs, 1, &query_proc.string
  *         )
  *         cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)             # <<<<<<<<<<<<<<
  *         cdef bool lowest_score_worst = is_lowest_score_worst[int64_t](&scorer_flags)
  *         cdef int64_t score
  */
-  __Pyx_TraceLine(1216,0,__PYX_ERR(0, 1216, __pyx_L1_error))
+  __Pyx_TraceLine(1023,0,__PYX_ERR(0, 1023, __pyx_L1_error))
   __pyx_cur_scope->__pyx_v_ScorerFunc = RF_ScorerWrapper(__pyx_cur_scope->__pyx_v_scorer_func);
 
-  /* "rapidfuzz/process_cpp.pyx":1217
+  /* "rapidfuzz/process_cpp_impl.pyx":1024
  *         )
  *         cdef RF_ScorerWrapper ScorerFunc = RF_ScorerWrapper(scorer_func)
  *         cdef bool lowest_score_worst = is_lowest_score_worst[int64_t](&scorer_flags)             # <<<<<<<<<<<<<<
  *         cdef int64_t score
  * 
  */
-  __Pyx_TraceLine(1217,0,__PYX_ERR(0, 1217, __pyx_L1_error))
+  __Pyx_TraceLine(1024,0,__PYX_ERR(0, 1024, __pyx_L1_error))
   __pyx_cur_scope->__pyx_v_lowest_score_worst = is_lowest_score_worst<int64_t>((&__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer_flags));
 
-  /* "rapidfuzz/process_cpp.pyx":1220
+  /* "rapidfuzz/process_cpp_impl.pyx":1027
  *         cdef int64_t score
  * 
  *         for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *             if choice is None:
  *                 continue
  */
-  __Pyx_TraceLine(1220,0,__PYX_ERR(0, 1220, __pyx_L1_error))
+  __Pyx_TraceLine(1027,0,__PYX_ERR(0, 1027, __pyx_L1_error))
   __Pyx_INCREF(__pyx_int_0);
   __pyx_t_1 = __pyx_int_0;
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 1220, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 1027, __pyx_L1_error) }
   if (likely(PyList_CheckExact(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) || PyTuple_CheckExact(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) {
     __pyx_t_5 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices; __Pyx_INCREF(__pyx_t_5); __pyx_t_6 = 0;
     __pyx_t_7 = NULL;
   } else {
-    __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1220, __pyx_L1_error)
+    __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1027, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1220, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1027, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_7)) {
       if (likely(PyList_CheckExact(__pyx_t_5))) {
         if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_5)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_8 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 1220, __pyx_L1_error)
+        __pyx_t_8 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 1027, __pyx_L1_error)
         #else
-        __pyx_t_8 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1220, __pyx_L1_error)
+        __pyx_t_8 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1027, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         #endif
       } else {
         if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 1220, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_8); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 1027, __pyx_L1_error)
         #else
-        __pyx_t_8 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1220, __pyx_L1_error)
+        __pyx_t_8 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1027, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         #endif
       }
     } else {
       __pyx_t_8 = __pyx_t_7(__pyx_t_5);
       if (unlikely(!__pyx_t_8)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 1220, __pyx_L1_error)
+          else __PYX_ERR(0, 1027, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_8);
     }
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_choice);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_choice, __pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_8);
     __pyx_t_8 = 0;
     __Pyx_INCREF(__pyx_t_1);
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_i);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_i, __pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1220, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1027, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_1);
     __pyx_t_1 = __pyx_t_8;
     __pyx_t_8 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":1221
+    /* "rapidfuzz/process_cpp_impl.pyx":1028
  * 
  *         for i, choice in enumerate(choices):
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
-    __Pyx_TraceLine(1221,0,__PYX_ERR(0, 1221, __pyx_L1_error))
+    __Pyx_TraceLine(1028,0,__PYX_ERR(0, 1028, __pyx_L1_error))
     __pyx_t_9 = (__pyx_cur_scope->__pyx_v_choice == Py_None);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1222
+      /* "rapidfuzz/process_cpp_impl.pyx":1029
  *         for i, choice in enumerate(choices):
  *             if choice is None:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             # use RapidFuzz C-Api
  */
-      __Pyx_TraceLine(1222,0,__PYX_ERR(0, 1222, __pyx_L1_error))
+      __Pyx_TraceLine(1029,0,__PYX_ERR(0, 1029, __pyx_L1_error))
       goto __pyx_L4_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":1221
+      /* "rapidfuzz/process_cpp_impl.pyx":1028
  * 
  *         for i, choice in enumerate(choices):
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1225
+    /* "rapidfuzz/process_cpp_impl.pyx":1032
  * 
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  */
-    __Pyx_TraceLine(1225,0,__PYX_ERR(0, 1225, __pyx_L1_error))
+    __Pyx_TraceLine(1032,0,__PYX_ERR(0, 1032, __pyx_L1_error))
     __pyx_t_10 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context != NULL);
     if (__pyx_t_10) {
     } else {
       __pyx_t_9 = __pyx_t_10;
       goto __pyx_L8_bool_binop_done;
     }
     __pyx_t_10 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->version == 1);
     __pyx_t_9 = __pyx_t_10;
     __pyx_L8_bool_binop_done:;
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1226
+      /* "rapidfuzz/process_cpp_impl.pyx":1033
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:
  *                 processor_context.preprocess(choice, &proc_str)             # <<<<<<<<<<<<<<
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:
  */
-      __Pyx_TraceLine(1226,0,__PYX_ERR(0, 1226, __pyx_L1_error))
-      __pyx_t_4 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->preprocess(__pyx_cur_scope->__pyx_v_choice, (&__pyx_cur_scope->__pyx_v_proc_str)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1226, __pyx_L1_error)
+      __Pyx_TraceLine(1033,0,__PYX_ERR(0, 1033, __pyx_L1_error))
+      __pyx_t_4 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor_context->preprocess(__pyx_cur_scope->__pyx_v_choice, (&__pyx_cur_scope->__pyx_v_proc_str)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1033, __pyx_L1_error)
 
-      /* "rapidfuzz/process_cpp.pyx":1227
+      /* "rapidfuzz/process_cpp_impl.pyx":1034
  *             if processor_context != NULL and processor_context.version == 1:
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)             # <<<<<<<<<<<<<<
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  */
-      __Pyx_TraceLine(1227,0,__PYX_ERR(0, 1227, __pyx_L1_error))
+      __Pyx_TraceLine(1034,0,__PYX_ERR(0, 1034, __pyx_L1_error))
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_cur_scope->__pyx_v_proc_str);
 
-      /* "rapidfuzz/process_cpp.pyx":1225
+      /* "rapidfuzz/process_cpp_impl.pyx":1032
  * 
  *             # use RapidFuzz C-Api
  *             if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1228
+    /* "rapidfuzz/process_cpp_impl.pyx":1035
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:             # <<<<<<<<<<<<<<
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  */
-    __Pyx_TraceLine(1228,0,__PYX_ERR(0, 1228, __pyx_L1_error))
-    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1228, __pyx_L1_error) }
+    __Pyx_TraceLine(1035,0,__PYX_ERR(0, 1035, __pyx_L1_error))
+    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1035, __pyx_L1_error) }
     __pyx_t_9 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor != Py_None);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1229
+      /* "rapidfuzz/process_cpp_impl.pyx":1036
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:
  *                 proc_choice = processor(choice)             # <<<<<<<<<<<<<<
  *                 if proc_choice is None:
  *                     continue
  */
-      __Pyx_TraceLine(1229,0,__PYX_ERR(0, 1229, __pyx_L1_error))
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1229, __pyx_L1_error) }
+      __Pyx_TraceLine(1036,0,__PYX_ERR(0, 1036, __pyx_L1_error))
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1036, __pyx_L1_error) }
       __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor);
       __pyx_t_11 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor; __pyx_t_12 = NULL;
       __pyx_t_13 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_11))) {
         __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_11);
         if (likely(__pyx_t_12)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
@@ -16361,136 +17282,136 @@
           __pyx_t_13 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_12, __pyx_cur_scope->__pyx_v_choice};
         __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_13, 1+__pyx_t_13);
         __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
-        if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1229, __pyx_L1_error)
+        if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1036, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
       }
       __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_proc_choice);
       __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_proc_choice, __pyx_t_8);
       __Pyx_GIVEREF(__pyx_t_8);
       __pyx_t_8 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":1230
+      /* "rapidfuzz/process_cpp_impl.pyx":1037
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
-      __Pyx_TraceLine(1230,0,__PYX_ERR(0, 1230, __pyx_L1_error))
+      __Pyx_TraceLine(1037,0,__PYX_ERR(0, 1037, __pyx_L1_error))
       __pyx_t_9 = (__pyx_cur_scope->__pyx_v_proc_choice == Py_None);
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":1231
+        /* "rapidfuzz/process_cpp_impl.pyx":1038
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  *                     continue             # <<<<<<<<<<<<<<
  * 
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))
  */
-        __Pyx_TraceLine(1231,0,__PYX_ERR(0, 1231, __pyx_L1_error))
+        __Pyx_TraceLine(1038,0,__PYX_ERR(0, 1038, __pyx_L1_error))
         goto __pyx_L4_continue;
 
-        /* "rapidfuzz/process_cpp.pyx":1230
+        /* "rapidfuzz/process_cpp_impl.pyx":1037
  *             elif processor is not None:
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:             # <<<<<<<<<<<<<<
  *                     continue
  * 
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1233
+      /* "rapidfuzz/process_cpp_impl.pyx":1040
  *                     continue
  * 
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))             # <<<<<<<<<<<<<<
  *             else:
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))
  */
-      __Pyx_TraceLine(1233,0,__PYX_ERR(0, 1233, __pyx_L1_error))
-      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1233, __pyx_L1_error)
+      __Pyx_TraceLine(1040,0,__PYX_ERR(0, 1040, __pyx_L1_error))
+      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_proc_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1040, __pyx_L1_error)
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_t_3);
 
-      /* "rapidfuzz/process_cpp.pyx":1228
+      /* "rapidfuzz/process_cpp_impl.pyx":1035
  *                 processor_context.preprocess(choice, &proc_str)
  *                 choice_proc = RF_StringWrapper(proc_str)
  *             elif processor is not None:             # <<<<<<<<<<<<<<
  *                 proc_choice = processor(choice)
  *                 if proc_choice is None:
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1235
+    /* "rapidfuzz/process_cpp_impl.pyx":1042
  *                 choice_proc = RF_StringWrapper(conv_sequence(proc_choice))
  *             else:
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))             # <<<<<<<<<<<<<<
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  */
-    __Pyx_TraceLine(1235,0,__PYX_ERR(0, 1235, __pyx_L1_error))
+    __Pyx_TraceLine(1042,0,__PYX_ERR(0, 1042, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1235, __pyx_L1_error)
+      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_cur_scope->__pyx_v_choice); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1042, __pyx_L1_error)
       __pyx_cur_scope->__pyx_v_choice_proc = RF_StringWrapper(__pyx_t_3);
     }
     __pyx_L7:;
 
-    /* "rapidfuzz/process_cpp.pyx":1237
+    /* "rapidfuzz/process_cpp_impl.pyx":1044
  *                 choice_proc = RF_StringWrapper(conv_sequence(choice))
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)             # <<<<<<<<<<<<<<
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:
  */
-    __Pyx_TraceLine(1237,0,__PYX_ERR(0, 1237, __pyx_L1_error))
+    __Pyx_TraceLine(1044,0,__PYX_ERR(0, 1044, __pyx_L1_error))
     try {
       __pyx_cur_scope->__pyx_v_ScorerFunc.call((&__pyx_cur_scope->__pyx_v_choice_proc.string), __pyx_cur_scope->__pyx_v_c_score_cutoff, (&__pyx_cur_scope->__pyx_v_score));
     } catch(...) {
       __Pyx_CppExn2PyErr();
-      __PYX_ERR(0, 1237, __pyx_L1_error)
+      __PYX_ERR(0, 1044, __pyx_L1_error)
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1238
+    /* "rapidfuzz/process_cpp_impl.pyx":1045
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, i)
  */
-    __Pyx_TraceLine(1238,0,__PYX_ERR(0, 1238, __pyx_L1_error))
+    __Pyx_TraceLine(1045,0,__PYX_ERR(0, 1045, __pyx_L1_error))
     __pyx_t_9 = (__pyx_cur_scope->__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1239
+      /* "rapidfuzz/process_cpp_impl.pyx":1046
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  *             else:
  */
-      __Pyx_TraceLine(1239,0,__PYX_ERR(0, 1239, __pyx_L1_error))
+      __Pyx_TraceLine(1046,0,__PYX_ERR(0, 1046, __pyx_L1_error))
       __pyx_t_9 = (__pyx_cur_scope->__pyx_v_score >= __pyx_cur_scope->__pyx_v_c_score_cutoff);
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":1240
+        /* "rapidfuzz/process_cpp_impl.pyx":1047
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, i)             # <<<<<<<<<<<<<<
  *             else:
  *                 if score <= c_score_cutoff:
  */
-        __Pyx_TraceLine(1240,0,__PYX_ERR(0, 1240, __pyx_L1_error))
-        __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1240, __pyx_L1_error)
+        __Pyx_TraceLine(1047,0,__PYX_ERR(0, 1047, __pyx_L1_error))
+        __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1047, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1240, __pyx_L1_error)
+        __pyx_t_11 = PyTuple_New(3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1047, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_8);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_i);
@@ -16517,58 +17438,58 @@
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_1;
         __pyx_cur_scope->__pyx_t_1 = 0;
         __Pyx_XGOTREF(__pyx_t_5);
         __pyx_t_6 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_7 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1240, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1047, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1239
+        /* "rapidfuzz/process_cpp_impl.pyx":1046
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:
  *                 if score >= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  *             else:
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1238
+      /* "rapidfuzz/process_cpp_impl.pyx":1045
  * 
  *             ScorerFunc.call(&choice_proc.string, c_score_cutoff, &score)
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= c_score_cutoff:
  *                     yield (choice, score, i)
  */
       goto __pyx_L11;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1242
+    /* "rapidfuzz/process_cpp_impl.pyx":1049
  *                     yield (choice, score, i)
  *             else:
  *                 if score <= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  * 
  */
-    __Pyx_TraceLine(1242,0,__PYX_ERR(0, 1242, __pyx_L1_error))
+    __Pyx_TraceLine(1049,0,__PYX_ERR(0, 1049, __pyx_L1_error))
     /*else*/ {
       __pyx_t_9 = (__pyx_cur_scope->__pyx_v_score <= __pyx_cur_scope->__pyx_v_c_score_cutoff);
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":1243
+        /* "rapidfuzz/process_cpp_impl.pyx":1050
  *             else:
  *                 if score <= c_score_cutoff:
  *                     yield (choice, score, i)             # <<<<<<<<<<<<<<
  * 
  *     def py_extract_iter_dict(worst_score, optimal_score):
  */
-        __Pyx_TraceLine(1243,0,__PYX_ERR(0, 1243, __pyx_L1_error))
-        __pyx_t_11 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1243, __pyx_L1_error)
+        __Pyx_TraceLine(1050,0,__PYX_ERR(0, 1050, __pyx_L1_error))
+        __pyx_t_11 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_score); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1050, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_11);
-        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1243, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1050, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_t_11);
         PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_11);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_i);
@@ -16595,42 +17516,42 @@
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_1;
         __pyx_cur_scope->__pyx_t_1 = 0;
         __Pyx_XGOTREF(__pyx_t_5);
         __pyx_t_6 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_7 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1243, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1050, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1242
+        /* "rapidfuzz/process_cpp_impl.pyx":1049
  *                     yield (choice, score, i)
  *             else:
  *                 if score <= c_score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  * 
  */
       }
     }
     __pyx_L11:;
 
-    /* "rapidfuzz/process_cpp.pyx":1220
+    /* "rapidfuzz/process_cpp_impl.pyx":1027
  *         cdef int64_t score
  * 
  *         for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *             if choice is None:
  *                 continue
  */
-    __Pyx_TraceLine(1220,0,__PYX_ERR(0, 1220, __pyx_L1_error))
+    __Pyx_TraceLine(1027,0,__PYX_ERR(0, 1027, __pyx_L1_error))
     __pyx_L4_continue:;
   }
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "rapidfuzz/process_cpp.pyx":1203
+  /* "rapidfuzz/process_cpp_impl.pyx":1010
  *                     yield (choice, score, i)
  * 
  *     def extract_iter_list_i64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type
  */
 
@@ -16652,35 +17573,35 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_14generator5(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_14generator5(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "rapidfuzz/process_cpp.pyx":1245
+/* "rapidfuzz/process_cpp_impl.pyx":1052
  *                     yield (choice, score, i)
  * 
  *     def py_extract_iter_dict(worst_score, optimal_score):             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for:
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_13py_extract_iter_dict(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_13py_extract_iter_dict(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_12py_extract_iter_dict, "\n        implementation of extract_iter for:\n          - type of choices = dict\n          - scorer = python function\n        ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_13py_extract_iter_dict = {"py_extract_iter_dict", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_13py_extract_iter_dict, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_12py_extract_iter_dict};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_13py_extract_iter_dict(PyObject *__pyx_self, 
+PyDoc_STRVAR(__pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_12py_extract_iter_dict, "\n        implementation of extract_iter for:\n          - type of choices = dict\n          - scorer = python function\n        ");
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_13py_extract_iter_dict = {"py_extract_iter_dict", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_13py_extract_iter_dict, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_12py_extract_iter_dict};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_13py_extract_iter_dict(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_worst_score = 0;
@@ -16712,97 +17633,97 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_worst_score)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1245, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1052, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_optimal_score)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1245, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1052, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("py_extract_iter_dict", 1, 2, 2, 1); __PYX_ERR(0, 1245, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("py_extract_iter_dict", 1, 2, 2, 1); __PYX_ERR(0, 1052, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "py_extract_iter_dict") < 0)) __PYX_ERR(0, 1245, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "py_extract_iter_dict") < 0)) __PYX_ERR(0, 1052, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_worst_score = values[0];
     __pyx_v_optimal_score = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("py_extract_iter_dict", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 1245, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("py_extract_iter_dict", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 1052, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_iter.py_extract_iter_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_iter.py_extract_iter_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_12py_extract_iter_dict(__pyx_self, __pyx_v_worst_score, __pyx_v_optimal_score);
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_12py_extract_iter_dict(__pyx_self, __pyx_v_worst_score, __pyx_v_optimal_score);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_12py_extract_iter_dict(PyObject *__pyx_self, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *__pyx_cur_scope;
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_12py_extract_iter_dict(PyObject *__pyx_self, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *__pyx_cur_scope;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("py_extract_iter_dict", 0);
-  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict, __pyx_empty_tuple, NULL);
+  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
-    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *)Py_None);
+    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1245, __pyx_L1_error)
+    __PYX_ERR(0, 1052, __pyx_L1_error)
   } else {
     __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
   }
-  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
+  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   __pyx_cur_scope->__pyx_v_worst_score = __pyx_v_worst_score;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_worst_score);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_worst_score);
   __pyx_cur_scope->__pyx_v_optimal_score = __pyx_v_optimal_score;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_optimal_score);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_optimal_score);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_14generator5, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_py_extract_iter_dict, __pyx_n_s_extract_iter_locals_py_extract_i, __pyx_n_s_rapidfuzz_process_cpp); if (unlikely(!gen)) __PYX_ERR(0, 1245, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_14generator5, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_py_extract_iter_dict, __pyx_n_s_extract_iter_locals_py_extract_i, __pyx_n_s_rapidfuzz_process_cpp_impl); if (unlikely(!gen)) __PYX_ERR(0, 1052, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_iter.py_extract_iter_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_iter.py_extract_iter_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_DECREF((PyObject *)__pyx_cur_scope);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_14generator5(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_14generator5(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
 {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *)__pyx_generator->closure);
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *)__pyx_generator->closure);
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   bool __pyx_t_2;
   Py_ssize_t __pyx_t_3;
   Py_ssize_t __pyx_t_4;
   int __pyx_t_5;
@@ -16812,127 +17733,127 @@
   int __pyx_t_9;
   PyObject *__pyx_t_10 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("py_extract_iter_dict", 0);
-  __Pyx_TraceCall("py_extract_iter_dict", __pyx_f[0], 1245, 0, __PYX_ERR(0, 1245, __pyx_L1_error));
+  __Pyx_TraceCall("py_extract_iter_dict", __pyx_f[0], 1052, 0, __PYX_ERR(0, 1052, __pyx_L1_error));
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L10_resume_from_yield;
     case 2: goto __pyx_L12_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_TraceReturn(Py_None, 0);
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1245, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1052, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1251
+  /* "rapidfuzz/process_cpp_impl.pyx":1058
  *           - scorer = python function
  *         """
  *         cdef bool lowest_score_worst = optimal_score > worst_score             # <<<<<<<<<<<<<<
  * 
  *         for choice_key, choice in choices.items():
  */
-  __Pyx_TraceLine(1251,0,__PYX_ERR(0, 1251, __pyx_L1_error))
-  __pyx_t_1 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_optimal_score, __pyx_cur_scope->__pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1251, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1251, __pyx_L1_error)
+  __Pyx_TraceLine(1058,0,__PYX_ERR(0, 1058, __pyx_L1_error))
+  __pyx_t_1 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_optimal_score, __pyx_cur_scope->__pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1058, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1058, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_lowest_score_worst = __pyx_t_2;
 
-  /* "rapidfuzz/process_cpp.pyx":1253
+  /* "rapidfuzz/process_cpp_impl.pyx":1060
  *         cdef bool lowest_score_worst = optimal_score > worst_score
  * 
  *         for choice_key, choice in choices.items():             # <<<<<<<<<<<<<<
  *             if choice is None:
  *                 continue
  */
-  __Pyx_TraceLine(1253,0,__PYX_ERR(0, 1253, __pyx_L1_error))
+  __Pyx_TraceLine(1060,0,__PYX_ERR(0, 1060, __pyx_L1_error))
   __pyx_t_3 = 0;
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 1253, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 1060, __pyx_L1_error) }
   if (unlikely(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-    __PYX_ERR(0, 1253, __pyx_L1_error)
+    __PYX_ERR(0, 1060, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_dict_iterator(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_4), (&__pyx_t_5)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1253, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_dict_iterator(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices, 0, __pyx_n_s_items, (&__pyx_t_4), (&__pyx_t_5)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1060, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_1);
   __pyx_t_1 = __pyx_t_6;
   __pyx_t_6 = 0;
   while (1) {
     __pyx_t_8 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_4, &__pyx_t_3, &__pyx_t_6, &__pyx_t_7, NULL, __pyx_t_5);
     if (unlikely(__pyx_t_8 == 0)) break;
-    if (unlikely(__pyx_t_8 == -1)) __PYX_ERR(0, 1253, __pyx_L1_error)
+    if (unlikely(__pyx_t_8 == -1)) __PYX_ERR(0, 1060, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_GOTREF(__pyx_t_7);
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_choice_key);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_choice_key, __pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_6);
     __pyx_t_6 = 0;
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_choice);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_choice, __pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_7);
     __pyx_t_7 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":1254
+    /* "rapidfuzz/process_cpp_impl.pyx":1061
  * 
  *         for choice_key, choice in choices.items():
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
-    __Pyx_TraceLine(1254,0,__PYX_ERR(0, 1254, __pyx_L1_error))
+    __Pyx_TraceLine(1061,0,__PYX_ERR(0, 1061, __pyx_L1_error))
     __pyx_t_9 = (__pyx_cur_scope->__pyx_v_choice == Py_None);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1255
+      /* "rapidfuzz/process_cpp_impl.pyx":1062
  *         for choice_key, choice in choices.items():
  *             if choice is None:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             if processor is not None:
  */
-      __Pyx_TraceLine(1255,0,__PYX_ERR(0, 1255, __pyx_L1_error))
+      __Pyx_TraceLine(1062,0,__PYX_ERR(0, 1062, __pyx_L1_error))
       goto __pyx_L4_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":1254
+      /* "rapidfuzz/process_cpp_impl.pyx":1061
  * 
  *         for choice_key, choice in choices.items():
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1257
+    /* "rapidfuzz/process_cpp_impl.pyx":1064
  *                 continue
  * 
  *             if processor is not None:             # <<<<<<<<<<<<<<
  *                 score = scorer(query, processor(choice), **kwargs)
  *             else:
  */
-    __Pyx_TraceLine(1257,0,__PYX_ERR(0, 1257, __pyx_L1_error))
-    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1257, __pyx_L1_error) }
+    __Pyx_TraceLine(1064,0,__PYX_ERR(0, 1064, __pyx_L1_error))
+    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1064, __pyx_L1_error) }
     __pyx_t_9 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor != Py_None);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1258
+      /* "rapidfuzz/process_cpp_impl.pyx":1065
  * 
  *             if processor is not None:
  *                 score = scorer(query, processor(choice), **kwargs)             # <<<<<<<<<<<<<<
  *             else:
  *                 score = scorer(query, choice, **kwargs)
  */
-      __Pyx_TraceLine(1258,0,__PYX_ERR(0, 1258, __pyx_L1_error))
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer)) { __Pyx_RaiseClosureNameError("scorer"); __PYX_ERR(0, 1258, __pyx_L1_error) }
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1258, __pyx_L1_error) }
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1258, __pyx_L1_error) }
+      __Pyx_TraceLine(1065,0,__PYX_ERR(0, 1065, __pyx_L1_error))
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer)) { __Pyx_RaiseClosureNameError("scorer"); __PYX_ERR(0, 1065, __pyx_L1_error) }
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1065, __pyx_L1_error) }
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1065, __pyx_L1_error) }
       __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor);
       __pyx_t_6 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor; __pyx_t_10 = NULL;
       __pyx_t_8 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_6))) {
         __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_6);
         if (likely(__pyx_t_10)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
@@ -16942,123 +17863,123 @@
           __pyx_t_8 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_cur_scope->__pyx_v_choice};
         __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
         __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
-        if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1258, __pyx_L1_error)
+        if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1065, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       }
-      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1258, __pyx_L1_error)
+      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1065, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       __Pyx_GIVEREF(__pyx_t_7);
       PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_7);
       __pyx_t_7 = 0;
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs)) { __Pyx_RaiseClosureNameError("kwargs"); __PYX_ERR(0, 1258, __pyx_L1_error) }
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs)) { __Pyx_RaiseClosureNameError("kwargs"); __PYX_ERR(0, 1065, __pyx_L1_error) }
       if (unlikely(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 1258, __pyx_L1_error)
+        __PYX_ERR(0, 1065, __pyx_L1_error)
       }
-      __pyx_t_7 = PyDict_Copy(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1258, __pyx_L1_error)
+      __pyx_t_7 = PyDict_Copy(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1065, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1258, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1065, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_score);
       __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_score, __pyx_t_10);
       __Pyx_GIVEREF(__pyx_t_10);
       __pyx_t_10 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":1257
+      /* "rapidfuzz/process_cpp_impl.pyx":1064
  *                 continue
  * 
  *             if processor is not None:             # <<<<<<<<<<<<<<
  *                 score = scorer(query, processor(choice), **kwargs)
  *             else:
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1260
+    /* "rapidfuzz/process_cpp_impl.pyx":1067
  *                 score = scorer(query, processor(choice), **kwargs)
  *             else:
  *                 score = scorer(query, choice, **kwargs)             # <<<<<<<<<<<<<<
  * 
  *             if lowest_score_worst:
  */
-    __Pyx_TraceLine(1260,0,__PYX_ERR(0, 1260, __pyx_L1_error))
+    __Pyx_TraceLine(1067,0,__PYX_ERR(0, 1067, __pyx_L1_error))
     /*else*/ {
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer)) { __Pyx_RaiseClosureNameError("scorer"); __PYX_ERR(0, 1260, __pyx_L1_error) }
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1260, __pyx_L1_error) }
-      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1260, __pyx_L1_error)
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer)) { __Pyx_RaiseClosureNameError("scorer"); __PYX_ERR(0, 1067, __pyx_L1_error) }
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1067, __pyx_L1_error) }
+      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1067, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_10);
       __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
       PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_cur_scope->__pyx_v_choice);
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs)) { __Pyx_RaiseClosureNameError("kwargs"); __PYX_ERR(0, 1260, __pyx_L1_error) }
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs)) { __Pyx_RaiseClosureNameError("kwargs"); __PYX_ERR(0, 1067, __pyx_L1_error) }
       if (unlikely(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 1260, __pyx_L1_error)
+        __PYX_ERR(0, 1067, __pyx_L1_error)
       }
-      __pyx_t_7 = PyDict_Copy(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1260, __pyx_L1_error)
+      __pyx_t_7 = PyDict_Copy(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1067, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer, __pyx_t_10, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1260, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer, __pyx_t_10, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1067, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_score);
       __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_score, __pyx_t_6);
       __Pyx_GIVEREF(__pyx_t_6);
       __pyx_t_6 = 0;
     }
     __pyx_L7:;
 
-    /* "rapidfuzz/process_cpp.pyx":1262
+    /* "rapidfuzz/process_cpp_impl.pyx":1069
  *                 score = scorer(query, choice, **kwargs)
  * 
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= score_cutoff:
  *                     yield (choice, score, choice_key)
  */
-    __Pyx_TraceLine(1262,0,__PYX_ERR(0, 1262, __pyx_L1_error))
+    __Pyx_TraceLine(1069,0,__PYX_ERR(0, 1069, __pyx_L1_error))
     __pyx_t_9 = (__pyx_cur_scope->__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_9) {
 
-      /* "rapidfuzz/process_cpp.pyx":1263
+      /* "rapidfuzz/process_cpp_impl.pyx":1070
  * 
  *             if lowest_score_worst:
  *                 if score >= score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  *             else:
  */
-      __Pyx_TraceLine(1263,0,__PYX_ERR(0, 1263, __pyx_L1_error))
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1263, __pyx_L1_error) }
-      __pyx_t_6 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_score, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1263, __pyx_L1_error)
-      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 1263, __pyx_L1_error)
+      __Pyx_TraceLine(1070,0,__PYX_ERR(0, 1070, __pyx_L1_error))
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1070, __pyx_L1_error) }
+      __pyx_t_6 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_score, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff, Py_GE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1070, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 1070, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":1264
+        /* "rapidfuzz/process_cpp_impl.pyx":1071
  *             if lowest_score_worst:
  *                 if score >= score_cutoff:
  *                     yield (choice, score, choice_key)             # <<<<<<<<<<<<<<
  *             else:
  *                 if score <= score_cutoff:
  */
-        __Pyx_TraceLine(1264,0,__PYX_ERR(0, 1264, __pyx_L1_error))
-        __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1264, __pyx_L1_error)
+        __Pyx_TraceLine(1071,0,__PYX_ERR(0, 1071, __pyx_L1_error))
+        __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1071, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_score);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_score);
         PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_cur_scope->__pyx_v_score);
@@ -17082,59 +18003,59 @@
         __pyx_L10_resume_from_yield:;
         __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_3 = __pyx_cur_scope->__pyx_t_1;
         __pyx_t_4 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1264, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1071, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1263
+        /* "rapidfuzz/process_cpp_impl.pyx":1070
  * 
  *             if lowest_score_worst:
  *                 if score >= score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  *             else:
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1262
+      /* "rapidfuzz/process_cpp_impl.pyx":1069
  *                 score = scorer(query, choice, **kwargs)
  * 
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= score_cutoff:
  *                     yield (choice, score, choice_key)
  */
       goto __pyx_L8;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1266
+    /* "rapidfuzz/process_cpp_impl.pyx":1073
  *                     yield (choice, score, choice_key)
  *             else:
  *                 if score <= score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  * 
  */
-    __Pyx_TraceLine(1266,0,__PYX_ERR(0, 1266, __pyx_L1_error))
+    __Pyx_TraceLine(1073,0,__PYX_ERR(0, 1073, __pyx_L1_error))
     /*else*/ {
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1266, __pyx_L1_error) }
-      __pyx_t_6 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_score, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff, Py_LE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1266, __pyx_L1_error)
-      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 1266, __pyx_L1_error)
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1073, __pyx_L1_error) }
+      __pyx_t_6 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_score, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff, Py_LE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1073, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 1073, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_9) {
 
-        /* "rapidfuzz/process_cpp.pyx":1267
+        /* "rapidfuzz/process_cpp_impl.pyx":1074
  *             else:
  *                 if score <= score_cutoff:
  *                     yield (choice, score, choice_key)             # <<<<<<<<<<<<<<
  * 
  *     def py_extract_iter_list(worst_score, optimal_score):
  */
-        __Pyx_TraceLine(1267,0,__PYX_ERR(0, 1267, __pyx_L1_error))
-        __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1267, __pyx_L1_error)
+        __Pyx_TraceLine(1074,0,__PYX_ERR(0, 1074, __pyx_L1_error))
+        __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1074, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_score);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_score);
         PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_cur_scope->__pyx_v_score);
@@ -17158,32 +18079,32 @@
         __pyx_L12_resume_from_yield:;
         __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_3 = __pyx_cur_scope->__pyx_t_1;
         __pyx_t_4 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1267, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1074, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1266
+        /* "rapidfuzz/process_cpp_impl.pyx":1073
  *                     yield (choice, score, choice_key)
  *             else:
  *                 if score <= score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, choice_key)
  * 
  */
       }
     }
     __pyx_L8:;
     __pyx_L4_continue:;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "rapidfuzz/process_cpp.pyx":1245
+  /* "rapidfuzz/process_cpp_impl.pyx":1052
  *                     yield (choice, score, i)
  * 
  *     def py_extract_iter_dict(worst_score, optimal_score):             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for:
  */
 
@@ -17204,35 +18125,35 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_17generator6(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_17generator6(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "rapidfuzz/process_cpp.pyx":1269
+/* "rapidfuzz/process_cpp_impl.pyx":1076
  *                     yield (choice, score, choice_key)
  * 
  *     def py_extract_iter_list(worst_score, optimal_score):             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for:
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_16py_extract_iter_list(PyObject *__pyx_self, 
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_16py_extract_iter_list(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ); /*proto*/
-PyDoc_STRVAR(__pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_15py_extract_iter_list, "\n        implementation of extract_iter for:\n          - type of choices = list\n          - scorer = python function\n        ");
-static PyMethodDef __pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_16py_extract_iter_list = {"py_extract_iter_list", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_16py_extract_iter_list, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_11process_cpp_12extract_iter_15py_extract_iter_list};
-static PyObject *__pyx_pw_9rapidfuzz_11process_cpp_12extract_iter_16py_extract_iter_list(PyObject *__pyx_self, 
+PyDoc_STRVAR(__pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_15py_extract_iter_list, "\n        implementation of extract_iter for:\n          - type of choices = list\n          - scorer = python function\n        ");
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_16py_extract_iter_list = {"py_extract_iter_list", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_16py_extract_iter_list, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_9rapidfuzz_16process_cpp_impl_12extract_iter_15py_extract_iter_list};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_12extract_iter_16py_extract_iter_list(PyObject *__pyx_self, 
 #if CYTHON_METH_FASTCALL
 PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
 #else
 PyObject *__pyx_args, PyObject *__pyx_kwds
 #endif
 ) {
   PyObject *__pyx_v_worst_score = 0;
@@ -17264,97 +18185,97 @@
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
       kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
       switch (__pyx_nargs) {
         case  0:
         if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_worst_score)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1269, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1076, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_optimal_score)) != 0)) kw_args--;
-        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1269, __pyx_L3_error)
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1076, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("py_extract_iter_list", 1, 2, 2, 1); __PYX_ERR(0, 1269, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("py_extract_iter_list", 1, 2, 2, 1); __PYX_ERR(0, 1076, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
         const Py_ssize_t kwd_pos_args = __pyx_nargs;
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "py_extract_iter_list") < 0)) __PYX_ERR(0, 1269, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "py_extract_iter_list") < 0)) __PYX_ERR(0, 1076, __pyx_L3_error)
       }
     } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
       values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_worst_score = values[0];
     __pyx_v_optimal_score = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("py_extract_iter_list", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 1269, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("py_extract_iter_list", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 1076, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_iter.py_extract_iter_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_iter.py_extract_iter_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_15py_extract_iter_list(__pyx_self, __pyx_v_worst_score, __pyx_v_optimal_score);
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_15py_extract_iter_list(__pyx_self, __pyx_v_worst_score, __pyx_v_optimal_score);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_15py_extract_iter_list(PyObject *__pyx_self, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *__pyx_cur_scope;
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_15py_extract_iter_list(PyObject *__pyx_self, PyObject *__pyx_v_worst_score, PyObject *__pyx_v_optimal_score) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *__pyx_cur_scope;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("py_extract_iter_list", 0);
-  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list, __pyx_empty_tuple, NULL);
+  __pyx_cur_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
-    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *)Py_None);
+    __pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1269, __pyx_L1_error)
+    __PYX_ERR(0, 1076, __pyx_L1_error)
   } else {
     __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
   }
-  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
+  __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *) __Pyx_CyFunction_GetClosure(__pyx_self);
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_outer_scope);
   __pyx_cur_scope->__pyx_v_worst_score = __pyx_v_worst_score;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_worst_score);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_worst_score);
   __pyx_cur_scope->__pyx_v_optimal_score = __pyx_v_optimal_score;
   __Pyx_INCREF(__pyx_cur_scope->__pyx_v_optimal_score);
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_optimal_score);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_17generator6, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_py_extract_iter_list, __pyx_n_s_extract_iter_locals_py_extract_i_2, __pyx_n_s_rapidfuzz_process_cpp); if (unlikely(!gen)) __PYX_ERR(0, 1269, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_17generator6, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_py_extract_iter_list, __pyx_n_s_extract_iter_locals_py_extract_i_2, __pyx_n_s_rapidfuzz_process_cpp_impl); if (unlikely(!gen)) __PYX_ERR(0, 1076, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_AddTraceback("rapidfuzz.process_cpp.extract_iter.py_extract_iter_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.extract_iter.py_extract_iter_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_DECREF((PyObject *)__pyx_cur_scope);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_12extract_iter_17generator6(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_12extract_iter_17generator6(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
 {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *)__pyx_generator->closure);
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *)__pyx_generator->closure);
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   bool __pyx_t_2;
   int64_t __pyx_t_3;
   Py_ssize_t __pyx_t_4;
   PyObject *(*__pyx_t_5)(PyObject *);
@@ -17364,149 +18285,149 @@
   PyObject *__pyx_t_9 = NULL;
   int __pyx_t_10;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("py_extract_iter_list", 0);
-  __Pyx_TraceCall("py_extract_iter_list", __pyx_f[0], 1269, 0, __PYX_ERR(0, 1269, __pyx_L1_error));
+  __Pyx_TraceCall("py_extract_iter_list", __pyx_f[0], 1076, 0, __PYX_ERR(0, 1076, __pyx_L1_error));
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L10_resume_from_yield;
     case 2: goto __pyx_L12_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_TraceReturn(Py_None, 0);
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1269, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1076, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1275
+  /* "rapidfuzz/process_cpp_impl.pyx":1082
  *           - scorer = python function
  *         """
  *         cdef bool lowest_score_worst = optimal_score > worst_score             # <<<<<<<<<<<<<<
  *         cdef int64_t i
  * 
  */
-  __Pyx_TraceLine(1275,0,__PYX_ERR(0, 1275, __pyx_L1_error))
-  __pyx_t_1 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_optimal_score, __pyx_cur_scope->__pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1275, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1275, __pyx_L1_error)
+  __Pyx_TraceLine(1082,0,__PYX_ERR(0, 1082, __pyx_L1_error))
+  __pyx_t_1 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_optimal_score, __pyx_cur_scope->__pyx_v_worst_score, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1082, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 == ((bool)-1)) && PyErr_Occurred())) __PYX_ERR(0, 1082, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_cur_scope->__pyx_v_lowest_score_worst = __pyx_t_2;
 
-  /* "rapidfuzz/process_cpp.pyx":1278
+  /* "rapidfuzz/process_cpp_impl.pyx":1085
  *         cdef int64_t i
  * 
  *         for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *             if choice is None:
  *                 continue
  */
-  __Pyx_TraceLine(1278,0,__PYX_ERR(0, 1278, __pyx_L1_error))
+  __Pyx_TraceLine(1085,0,__PYX_ERR(0, 1085, __pyx_L1_error))
   __pyx_t_3 = 0;
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 1278, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) { __Pyx_RaiseClosureNameError("choices"); __PYX_ERR(0, 1085, __pyx_L1_error) }
   if (likely(PyList_CheckExact(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) || PyTuple_CheckExact(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices)) {
     __pyx_t_1 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices; __Pyx_INCREF(__pyx_t_1); __pyx_t_4 = 0;
     __pyx_t_5 = NULL;
   } else {
-    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1278, __pyx_L1_error)
+    __pyx_t_4 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_choices); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1085, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1278, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1085, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_5)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_4 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 1278, __pyx_L1_error)
+        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 1085, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1278, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1085, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
       } else {
         if (__pyx_t_4 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 1278, __pyx_L1_error)
+        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_4); __Pyx_INCREF(__pyx_t_6); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 1085, __pyx_L1_error)
         #else
-        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1278, __pyx_L1_error)
+        __pyx_t_6 = PySequence_ITEM(__pyx_t_1, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1085, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         #endif
       }
     } else {
       __pyx_t_6 = __pyx_t_5(__pyx_t_1);
       if (unlikely(!__pyx_t_6)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 1278, __pyx_L1_error)
+          else __PYX_ERR(0, 1085, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_6);
     }
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_choice);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_choice, __pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_6);
     __pyx_t_6 = 0;
     __pyx_cur_scope->__pyx_v_i = __pyx_t_3;
     __pyx_t_3 = (__pyx_t_3 + 1);
 
-    /* "rapidfuzz/process_cpp.pyx":1279
+    /* "rapidfuzz/process_cpp_impl.pyx":1086
  * 
  *         for i, choice in enumerate(choices):
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
-    __Pyx_TraceLine(1279,0,__PYX_ERR(0, 1279, __pyx_L1_error))
+    __Pyx_TraceLine(1086,0,__PYX_ERR(0, 1086, __pyx_L1_error))
     __pyx_t_7 = (__pyx_cur_scope->__pyx_v_choice == Py_None);
     if (__pyx_t_7) {
 
-      /* "rapidfuzz/process_cpp.pyx":1280
+      /* "rapidfuzz/process_cpp_impl.pyx":1087
  *         for i, choice in enumerate(choices):
  *             if choice is None:
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             if processor is not None:
  */
-      __Pyx_TraceLine(1280,0,__PYX_ERR(0, 1280, __pyx_L1_error))
+      __Pyx_TraceLine(1087,0,__PYX_ERR(0, 1087, __pyx_L1_error))
       goto __pyx_L4_continue;
 
-      /* "rapidfuzz/process_cpp.pyx":1279
+      /* "rapidfuzz/process_cpp_impl.pyx":1086
  * 
  *         for i, choice in enumerate(choices):
  *             if choice is None:             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1282
+    /* "rapidfuzz/process_cpp_impl.pyx":1089
  *                 continue
  * 
  *             if processor is not None:             # <<<<<<<<<<<<<<
  *                 score = scorer(query, processor(choice), **kwargs)
  *             else:
  */
-    __Pyx_TraceLine(1282,0,__PYX_ERR(0, 1282, __pyx_L1_error))
-    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1282, __pyx_L1_error) }
+    __Pyx_TraceLine(1089,0,__PYX_ERR(0, 1089, __pyx_L1_error))
+    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1089, __pyx_L1_error) }
     __pyx_t_7 = (__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor != Py_None);
     if (__pyx_t_7) {
 
-      /* "rapidfuzz/process_cpp.pyx":1283
+      /* "rapidfuzz/process_cpp_impl.pyx":1090
  * 
  *             if processor is not None:
  *                 score = scorer(query, processor(choice), **kwargs)             # <<<<<<<<<<<<<<
  *             else:
  *                 score = scorer(query, choice, **kwargs)
  */
-      __Pyx_TraceLine(1283,0,__PYX_ERR(0, 1283, __pyx_L1_error))
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer)) { __Pyx_RaiseClosureNameError("scorer"); __PYX_ERR(0, 1283, __pyx_L1_error) }
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1283, __pyx_L1_error) }
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1283, __pyx_L1_error) }
+      __Pyx_TraceLine(1090,0,__PYX_ERR(0, 1090, __pyx_L1_error))
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer)) { __Pyx_RaiseClosureNameError("scorer"); __PYX_ERR(0, 1090, __pyx_L1_error) }
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1090, __pyx_L1_error) }
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor)) { __Pyx_RaiseClosureNameError("processor"); __PYX_ERR(0, 1090, __pyx_L1_error) }
       __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor);
       __pyx_t_8 = __pyx_cur_scope->__pyx_outer_scope->__pyx_v_processor; __pyx_t_9 = NULL;
       __pyx_t_10 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_8))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
@@ -17516,125 +18437,125 @@
           __pyx_t_10 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_cur_scope->__pyx_v_choice};
         __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
         __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1283, __pyx_L1_error)
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1090, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       }
-      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1283, __pyx_L1_error)
+      __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1090, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       __Pyx_GIVEREF(__pyx_t_6);
       PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_6);
       __pyx_t_6 = 0;
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs)) { __Pyx_RaiseClosureNameError("kwargs"); __PYX_ERR(0, 1283, __pyx_L1_error) }
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs)) { __Pyx_RaiseClosureNameError("kwargs"); __PYX_ERR(0, 1090, __pyx_L1_error) }
       if (unlikely(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 1283, __pyx_L1_error)
+        __PYX_ERR(0, 1090, __pyx_L1_error)
       }
-      __pyx_t_6 = PyDict_Copy(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1283, __pyx_L1_error)
+      __pyx_t_6 = PyDict_Copy(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1090, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer, __pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1283, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer, __pyx_t_8, __pyx_t_6); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1090, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_score);
       __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_score, __pyx_t_9);
       __Pyx_GIVEREF(__pyx_t_9);
       __pyx_t_9 = 0;
 
-      /* "rapidfuzz/process_cpp.pyx":1282
+      /* "rapidfuzz/process_cpp_impl.pyx":1089
  *                 continue
  * 
  *             if processor is not None:             # <<<<<<<<<<<<<<
  *                 score = scorer(query, processor(choice), **kwargs)
  *             else:
  */
       goto __pyx_L7;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1285
+    /* "rapidfuzz/process_cpp_impl.pyx":1092
  *                 score = scorer(query, processor(choice), **kwargs)
  *             else:
  *                 score = scorer(query, choice, **kwargs)             # <<<<<<<<<<<<<<
  * 
  *             if lowest_score_worst:
  */
-    __Pyx_TraceLine(1285,0,__PYX_ERR(0, 1285, __pyx_L1_error))
+    __Pyx_TraceLine(1092,0,__PYX_ERR(0, 1092, __pyx_L1_error))
     /*else*/ {
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer)) { __Pyx_RaiseClosureNameError("scorer"); __PYX_ERR(0, 1285, __pyx_L1_error) }
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1285, __pyx_L1_error) }
-      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1285, __pyx_L1_error)
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer)) { __Pyx_RaiseClosureNameError("scorer"); __PYX_ERR(0, 1092, __pyx_L1_error) }
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query)) { __Pyx_RaiseClosureNameError("query"); __PYX_ERR(0, 1092, __pyx_L1_error) }
+      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1092, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_INCREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_query);
       __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
       __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
       PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_cur_scope->__pyx_v_choice);
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs)) { __Pyx_RaiseClosureNameError("kwargs"); __PYX_ERR(0, 1285, __pyx_L1_error) }
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs)) { __Pyx_RaiseClosureNameError("kwargs"); __PYX_ERR(0, 1092, __pyx_L1_error) }
       if (unlikely(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs == Py_None)) {
         PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
-        __PYX_ERR(0, 1285, __pyx_L1_error)
+        __PYX_ERR(0, 1092, __pyx_L1_error)
       }
-      __pyx_t_6 = PyDict_Copy(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1285, __pyx_L1_error)
+      __pyx_t_6 = PyDict_Copy(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_kwargs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1092, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer, __pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1285, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_cur_scope->__pyx_outer_scope->__pyx_v_scorer, __pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1092, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_score);
       __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_score, __pyx_t_8);
       __Pyx_GIVEREF(__pyx_t_8);
       __pyx_t_8 = 0;
     }
     __pyx_L7:;
 
-    /* "rapidfuzz/process_cpp.pyx":1287
+    /* "rapidfuzz/process_cpp_impl.pyx":1094
  *                 score = scorer(query, choice, **kwargs)
  * 
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= score_cutoff:
  *                     yield (choice, score, i)
  */
-    __Pyx_TraceLine(1287,0,__PYX_ERR(0, 1287, __pyx_L1_error))
+    __Pyx_TraceLine(1094,0,__PYX_ERR(0, 1094, __pyx_L1_error))
     __pyx_t_7 = (__pyx_cur_scope->__pyx_v_lowest_score_worst != 0);
     if (__pyx_t_7) {
 
-      /* "rapidfuzz/process_cpp.pyx":1288
+      /* "rapidfuzz/process_cpp_impl.pyx":1095
  * 
  *             if lowest_score_worst:
  *                 if score >= score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  *             else:
  */
-      __Pyx_TraceLine(1288,0,__PYX_ERR(0, 1288, __pyx_L1_error))
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1288, __pyx_L1_error) }
-      __pyx_t_8 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_score, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff, Py_GE); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1288, __pyx_L1_error)
-      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 1288, __pyx_L1_error)
+      __Pyx_TraceLine(1095,0,__PYX_ERR(0, 1095, __pyx_L1_error))
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1095, __pyx_L1_error) }
+      __pyx_t_8 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_score, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff, Py_GE); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1095, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 1095, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       if (__pyx_t_7) {
 
-        /* "rapidfuzz/process_cpp.pyx":1289
+        /* "rapidfuzz/process_cpp_impl.pyx":1096
  *             if lowest_score_worst:
  *                 if score >= score_cutoff:
  *                     yield (choice, score, i)             # <<<<<<<<<<<<<<
  *             else:
  *                 if score <= score_cutoff:
  */
-        __Pyx_TraceLine(1289,0,__PYX_ERR(0, 1289, __pyx_L1_error))
-        __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_i); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1289, __pyx_L1_error)
+        __Pyx_TraceLine(1096,0,__PYX_ERR(0, 1096, __pyx_L1_error))
+        __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_i); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1096, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1289, __pyx_L1_error)
+        __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1096, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_score);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_score);
         PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_cur_scope->__pyx_v_score);
@@ -17658,61 +18579,61 @@
         __pyx_L10_resume_from_yield:;
         __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_3 = __pyx_cur_scope->__pyx_t_1;
         __pyx_t_4 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1289, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1096, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1288
+        /* "rapidfuzz/process_cpp_impl.pyx":1095
  * 
  *             if lowest_score_worst:
  *                 if score >= score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  *             else:
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1287
+      /* "rapidfuzz/process_cpp_impl.pyx":1094
  *                 score = scorer(query, choice, **kwargs)
  * 
  *             if lowest_score_worst:             # <<<<<<<<<<<<<<
  *                 if score >= score_cutoff:
  *                     yield (choice, score, i)
  */
       goto __pyx_L8;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1291
+    /* "rapidfuzz/process_cpp_impl.pyx":1098
  *                     yield (choice, score, i)
  *             else:
  *                 if score <= score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  * 
  */
-    __Pyx_TraceLine(1291,0,__PYX_ERR(0, 1291, __pyx_L1_error))
+    __Pyx_TraceLine(1098,0,__PYX_ERR(0, 1098, __pyx_L1_error))
     /*else*/ {
-      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1291, __pyx_L1_error) }
-      __pyx_t_6 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_score, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff, Py_LE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1291, __pyx_L1_error)
-      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 1291, __pyx_L1_error)
+      if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff)) { __Pyx_RaiseClosureNameError("score_cutoff"); __PYX_ERR(0, 1098, __pyx_L1_error) }
+      __pyx_t_6 = PyObject_RichCompare(__pyx_cur_scope->__pyx_v_score, __pyx_cur_scope->__pyx_outer_scope->__pyx_v_score_cutoff, Py_LE); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1098, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 1098, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
       if (__pyx_t_7) {
 
-        /* "rapidfuzz/process_cpp.pyx":1292
+        /* "rapidfuzz/process_cpp_impl.pyx":1099
  *             else:
  *                 if score <= score_cutoff:
  *                     yield (choice, score, i)             # <<<<<<<<<<<<<<
  * 
  *     if query is None:
  */
-        __Pyx_TraceLine(1292,0,__PYX_ERR(0, 1292, __pyx_L1_error))
-        __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1292, __pyx_L1_error)
+        __Pyx_TraceLine(1099,0,__PYX_ERR(0, 1099, __pyx_L1_error))
+        __pyx_t_6 = __Pyx_PyInt_From_int64_t(__pyx_cur_scope->__pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1099, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_6);
-        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1292, __pyx_L1_error)
+        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1099, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_choice);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_choice);
         PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_cur_scope->__pyx_v_choice);
         __Pyx_INCREF(__pyx_cur_scope->__pyx_v_score);
         __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_score);
         PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_cur_scope->__pyx_v_score);
@@ -17736,41 +18657,41 @@
         __pyx_L12_resume_from_yield:;
         __pyx_t_1 = __pyx_cur_scope->__pyx_t_0;
         __pyx_cur_scope->__pyx_t_0 = 0;
         __Pyx_XGOTREF(__pyx_t_1);
         __pyx_t_3 = __pyx_cur_scope->__pyx_t_1;
         __pyx_t_4 = __pyx_cur_scope->__pyx_t_2;
         __pyx_t_5 = __pyx_cur_scope->__pyx_t_3;
-        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1292, __pyx_L1_error)
+        if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1099, __pyx_L1_error)
 
-        /* "rapidfuzz/process_cpp.pyx":1291
+        /* "rapidfuzz/process_cpp_impl.pyx":1098
  *                     yield (choice, score, i)
  *             else:
  *                 if score <= score_cutoff:             # <<<<<<<<<<<<<<
  *                     yield (choice, score, i)
  * 
  */
       }
     }
     __pyx_L8:;
 
-    /* "rapidfuzz/process_cpp.pyx":1278
+    /* "rapidfuzz/process_cpp_impl.pyx":1085
  *         cdef int64_t i
  * 
  *         for i, choice in enumerate(choices):             # <<<<<<<<<<<<<<
  *             if choice is None:
  *                 continue
  */
-    __Pyx_TraceLine(1278,0,__PYX_ERR(0, 1278, __pyx_L1_error))
+    __Pyx_TraceLine(1085,0,__PYX_ERR(0, 1085, __pyx_L1_error))
     __pyx_L4_continue:;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "rapidfuzz/process_cpp.pyx":1269
+  /* "rapidfuzz/process_cpp_impl.pyx":1076
  *                     yield (choice, score, choice_key)
  * 
  *     def py_extract_iter_list(worst_score, optimal_score):             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for:
  */
 
@@ -17792,25 +18713,25 @@
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "rapidfuzz/process_cpp.pyx":1018
+/* "rapidfuzz/process_cpp_impl.pyx":878
  * 
  * 
  * def extract_iter(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best match in a list of choices
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
 
-static PyObject *__pyx_gb_9rapidfuzz_11process_cpp_6generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
+static PyObject *__pyx_gb_9rapidfuzz_16process_cpp_impl_6generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
 {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *)__pyx_generator->closure);
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *__pyx_cur_scope = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *)__pyx_generator->closure);
   PyObject *__pyx_r = NULL;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_t_5;
@@ -17821,259 +18742,259 @@
   PyObject *(*__pyx_t_10)(PyObject *);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("extract_iter", 0);
   __Pyx_TraceFrameInit(__pyx_codeobj__5)
-  __Pyx_TraceCall("extract_iter", __pyx_f[0], 1018, 0, __PYX_ERR(0, 1018, __pyx_L1_error));
+  __Pyx_TraceCall("extract_iter", __pyx_f[0], 878, 0, __PYX_ERR(0, 878, __pyx_L1_error));
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L14_resume_from_yield_from;
     case 2: goto __pyx_L15_resume_from_yield_from;
     case 3: goto __pyx_L17_resume_from_yield_from;
     case 4: goto __pyx_L18_resume_from_yield_from;
     case 5: goto __pyx_L23_resume_from_yield_from;
     case 6: goto __pyx_L24_resume_from_yield_from;
     default: /* CPython raises the right error here */
     __Pyx_TraceReturn(Py_None, 0);
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 878, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1072
+  /* "rapidfuzz/process_cpp_impl.pyx":879
  * 
- *     """
+ * def extract_iter(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):
  *     cdef RF_Scorer* scorer_context = NULL             # <<<<<<<<<<<<<<
  *     cdef RF_ScorerFlags scorer_flags
  *     cdef RF_Preprocessor* processor_context = NULL
  */
-  __Pyx_TraceLine(1072,0,__PYX_ERR(0, 1072, __pyx_L1_error))
+  __Pyx_TraceLine(879,0,__PYX_ERR(0, 879, __pyx_L1_error))
   __pyx_cur_scope->__pyx_v_scorer_context = NULL;
 
-  /* "rapidfuzz/process_cpp.pyx":1074
+  /* "rapidfuzz/process_cpp_impl.pyx":881
  *     cdef RF_Scorer* scorer_context = NULL
  *     cdef RF_ScorerFlags scorer_flags
  *     cdef RF_Preprocessor* processor_context = NULL             # <<<<<<<<<<<<<<
  *     cdef RF_KwargsWrapper kwargs_context
  * 
  */
-  __Pyx_TraceLine(1074,0,__PYX_ERR(0, 1074, __pyx_L1_error))
+  __Pyx_TraceLine(881,0,__PYX_ERR(0, 881, __pyx_L1_error))
   __pyx_cur_scope->__pyx_v_processor_context = NULL;
 
-  /* "rapidfuzz/process_cpp.pyx":1077
+  /* "rapidfuzz/process_cpp_impl.pyx":884
  *     cdef RF_KwargsWrapper kwargs_context
  * 
  *     def extract_iter_dict_f64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type
  */
-  __Pyx_TraceLine(1077,0,__PYX_ERR(0, 1077, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_1extract_iter_dict_f64, 0, __pyx_n_s_extract_iter_locals_extract_iter, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__7)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1077, __pyx_L1_error)
+  __Pyx_TraceLine(884,0,__PYX_ERR(0, 884, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_1extract_iter_dict_f64, 0, __pyx_n_s_extract_iter_locals_extract_iter, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__7)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 884, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_extract_iter_dict_f64 = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1119
+  /* "rapidfuzz/process_cpp_impl.pyx":926
  *                     yield (choice, score, choice_key)
  * 
  *     def extract_iter_dict_i64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type
  */
-  __Pyx_TraceLine(1119,0,__PYX_ERR(0, 1119, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_4extract_iter_dict_i64, 0, __pyx_n_s_extract_iter_locals_extract_iter_2, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1119, __pyx_L1_error)
+  __Pyx_TraceLine(926,0,__PYX_ERR(0, 926, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_4extract_iter_dict_i64, 0, __pyx_n_s_extract_iter_locals_extract_iter_2, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 926, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_extract_iter_dict_i64 = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1161
+  /* "rapidfuzz/process_cpp_impl.pyx":968
  *                     yield (choice, score, choice_key)
  * 
  *     def extract_iter_list_f64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type
  */
-  __Pyx_TraceLine(1161,0,__PYX_ERR(0, 1161, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_7extract_iter_list_f64, 0, __pyx_n_s_extract_iter_locals_extract_iter_3, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1161, __pyx_L1_error)
+  __Pyx_TraceLine(968,0,__PYX_ERR(0, 968, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_7extract_iter_list_f64, 0, __pyx_n_s_extract_iter_locals_extract_iter_3, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__10)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 968, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_extract_iter_list_f64 = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1203
+  /* "rapidfuzz/process_cpp_impl.pyx":1010
  *                     yield (choice, score, i)
  * 
  *     def extract_iter_list_i64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type
  */
-  __Pyx_TraceLine(1203,0,__PYX_ERR(0, 1203, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_10extract_iter_list_i64, 0, __pyx_n_s_extract_iter_locals_extract_iter_4, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__11)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1203, __pyx_L1_error)
+  __Pyx_TraceLine(1010,0,__PYX_ERR(0, 1010, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_10extract_iter_list_i64, 0, __pyx_n_s_extract_iter_locals_extract_iter_4, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__11)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1010, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_extract_iter_list_i64 = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1245
+  /* "rapidfuzz/process_cpp_impl.pyx":1052
  *                     yield (choice, score, i)
  * 
  *     def py_extract_iter_dict(worst_score, optimal_score):             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for:
  */
-  __Pyx_TraceLine(1245,0,__PYX_ERR(0, 1245, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_13py_extract_iter_dict, 0, __pyx_n_s_extract_iter_locals_py_extract_i, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__13)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1245, __pyx_L1_error)
+  __Pyx_TraceLine(1052,0,__PYX_ERR(0, 1052, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_13py_extract_iter_dict, 0, __pyx_n_s_extract_iter_locals_py_extract_i, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__13)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1052, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_py_extract_iter_dict = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1269
+  /* "rapidfuzz/process_cpp_impl.pyx":1076
  *                     yield (choice, score, choice_key)
  * 
  *     def py_extract_iter_list(worst_score, optimal_score):             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for:
  */
-  __Pyx_TraceLine(1269,0,__PYX_ERR(0, 1269, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_12extract_iter_16py_extract_iter_list, 0, __pyx_n_s_extract_iter_locals_py_extract_i_2, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__15)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1269, __pyx_L1_error)
+  __Pyx_TraceLine(1076,0,__PYX_ERR(0, 1076, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_12extract_iter_16py_extract_iter_list, 0, __pyx_n_s_extract_iter_locals_py_extract_i_2, ((PyObject*)__pyx_cur_scope), __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__15)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_py_extract_iter_list = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1294
+  /* "rapidfuzz/process_cpp_impl.pyx":1101
  *                     yield (choice, score, i)
  * 
  *     if query is None:             # <<<<<<<<<<<<<<
  *         # finish generator
  *         return
  */
-  __Pyx_TraceLine(1294,0,__PYX_ERR(0, 1294, __pyx_L1_error))
+  __Pyx_TraceLine(1101,0,__PYX_ERR(0, 1101, __pyx_L1_error))
   __pyx_t_2 = (__pyx_cur_scope->__pyx_v_query == Py_None);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":1296
+    /* "rapidfuzz/process_cpp_impl.pyx":1103
  *     if query is None:
  *         # finish generator
  *         return             # <<<<<<<<<<<<<<
  * 
  *     if processor is True:
  */
-    __Pyx_TraceLine(1296,0,__PYX_ERR(0, 1296, __pyx_L1_error))
+    __Pyx_TraceLine(1103,0,__PYX_ERR(0, 1103, __pyx_L1_error))
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "rapidfuzz/process_cpp.pyx":1294
+    /* "rapidfuzz/process_cpp_impl.pyx":1101
  *                     yield (choice, score, i)
  * 
  *     if query is None:             # <<<<<<<<<<<<<<
  *         # finish generator
  *         return
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":1298
+  /* "rapidfuzz/process_cpp_impl.pyx":1105
  *         return
  * 
  *     if processor is True:             # <<<<<<<<<<<<<<
  *         processor = default_process
  *     elif processor is False:
  */
-  __Pyx_TraceLine(1298,0,__PYX_ERR(0, 1298, __pyx_L1_error))
+  __Pyx_TraceLine(1105,0,__PYX_ERR(0, 1105, __pyx_L1_error))
   __pyx_t_2 = (__pyx_cur_scope->__pyx_v_processor == Py_True);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":1299
+    /* "rapidfuzz/process_cpp_impl.pyx":1106
  * 
  *     if processor is True:
  *         processor = default_process             # <<<<<<<<<<<<<<
  *     elif processor is False:
  *         processor = None
  */
-    __Pyx_TraceLine(1299,0,__PYX_ERR(0, 1299, __pyx_L1_error))
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_default_process); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1299, __pyx_L1_error)
+    __Pyx_TraceLine(1106,0,__PYX_ERR(0, 1106, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_default_process); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1106, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_processor);
     __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_processor, __pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":1298
+    /* "rapidfuzz/process_cpp_impl.pyx":1105
  *         return
  * 
  *     if processor is True:             # <<<<<<<<<<<<<<
  *         processor = default_process
  *     elif processor is False:
  */
     goto __pyx_L5;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":1300
+  /* "rapidfuzz/process_cpp_impl.pyx":1107
  *     if processor is True:
  *         processor = default_process
  *     elif processor is False:             # <<<<<<<<<<<<<<
  *         processor = None
  * 
  */
-  __Pyx_TraceLine(1300,0,__PYX_ERR(0, 1300, __pyx_L1_error))
+  __Pyx_TraceLine(1107,0,__PYX_ERR(0, 1107, __pyx_L1_error))
   __pyx_t_2 = (__pyx_cur_scope->__pyx_v_processor == Py_False);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":1301
+    /* "rapidfuzz/process_cpp_impl.pyx":1108
  *         processor = default_process
  *     elif processor is False:
  *         processor = None             # <<<<<<<<<<<<<<
  * 
  *     # preprocess the query
  */
-    __Pyx_TraceLine(1301,0,__PYX_ERR(0, 1301, __pyx_L1_error))
+    __Pyx_TraceLine(1108,0,__PYX_ERR(0, 1108, __pyx_L1_error))
     __Pyx_INCREF(Py_None);
     __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_processor);
     __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_processor, Py_None);
     __Pyx_GIVEREF(Py_None);
 
-    /* "rapidfuzz/process_cpp.pyx":1300
+    /* "rapidfuzz/process_cpp_impl.pyx":1107
  *     if processor is True:
  *         processor = default_process
  *     elif processor is False:             # <<<<<<<<<<<<<<
  *         processor = None
  * 
  */
   }
   __pyx_L5:;
 
-  /* "rapidfuzz/process_cpp.pyx":1304
+  /* "rapidfuzz/process_cpp_impl.pyx":1111
  * 
  *     # preprocess the query
  *     if callable(processor):             # <<<<<<<<<<<<<<
  *         query = processor(query)
  * 
  */
-  __Pyx_TraceLine(1304,0,__PYX_ERR(0, 1304, __pyx_L1_error))
+  __Pyx_TraceLine(1111,0,__PYX_ERR(0, 1111, __pyx_L1_error))
   __pyx_t_1 = __pyx_cur_scope->__pyx_v_processor;
   __Pyx_INCREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyCallable_Check(__pyx_t_1); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 1304, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyCallable_Check(__pyx_t_1); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 1111, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":1305
+    /* "rapidfuzz/process_cpp_impl.pyx":1112
  *     # preprocess the query
  *     if callable(processor):
  *         query = processor(query)             # <<<<<<<<<<<<<<
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  */
-    __Pyx_TraceLine(1305,0,__PYX_ERR(0, 1305, __pyx_L1_error))
+    __Pyx_TraceLine(1112,0,__PYX_ERR(0, 1112, __pyx_L1_error))
     __Pyx_INCREF(__pyx_cur_scope->__pyx_v_processor);
     __pyx_t_3 = __pyx_cur_scope->__pyx_v_processor; __pyx_t_4 = NULL;
     __pyx_t_5 = 0;
     if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
       __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
       if (likely(__pyx_t_4)) {
         PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
@@ -18083,704 +19004,706 @@
         __pyx_t_5 = 1;
       }
     }
     {
       PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_cur_scope->__pyx_v_query};
       __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
       __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1305, __pyx_L1_error)
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1112, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     }
     __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_query);
     __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_query, __pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":1304
+    /* "rapidfuzz/process_cpp_impl.pyx":1111
  * 
  *     # preprocess the query
  *     if callable(processor):             # <<<<<<<<<<<<<<
  *         query = processor(query)
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":1307
+  /* "rapidfuzz/process_cpp_impl.pyx":1114
  *         query = processor(query)
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)             # <<<<<<<<<<<<<<
  *     if PyCapsule_IsValid(scorer_capsule, NULL):
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  */
-  __Pyx_TraceLine(1307,0,__PYX_ERR(0, 1307, __pyx_L1_error))
+  __Pyx_TraceLine(1114,0,__PYX_ERR(0, 1114, __pyx_L1_error))
   __pyx_t_1 = __pyx_cur_scope->__pyx_v_scorer;
   __Pyx_INCREF(__pyx_t_1);
   __pyx_t_3 = __pyx_cur_scope->__pyx_v_scorer;
   __Pyx_INCREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_GetAttr3(__pyx_t_1, __pyx_n_u_RF_Scorer, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1307, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_GetAttr3(__pyx_t_1, __pyx_n_u_RF_Scorer, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1114, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_GIVEREF(__pyx_t_4);
   __pyx_cur_scope->__pyx_v_scorer_capsule = __pyx_t_4;
   __pyx_t_4 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1308
+  /* "rapidfuzz/process_cpp_impl.pyx":1115
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  *     if PyCapsule_IsValid(scorer_capsule, NULL):             # <<<<<<<<<<<<<<
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  */
-  __Pyx_TraceLine(1308,0,__PYX_ERR(0, 1308, __pyx_L1_error))
+  __Pyx_TraceLine(1115,0,__PYX_ERR(0, 1115, __pyx_L1_error))
   __pyx_t_2 = PyCapsule_IsValid(__pyx_cur_scope->__pyx_v_scorer_capsule, NULL);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":1309
+    /* "rapidfuzz/process_cpp_impl.pyx":1116
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  *     if PyCapsule_IsValid(scorer_capsule, NULL):
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:
  */
-    __Pyx_TraceLine(1309,0,__PYX_ERR(0, 1309, __pyx_L1_error))
-    __pyx_t_6 = PyCapsule_GetPointer(__pyx_cur_scope->__pyx_v_scorer_capsule, NULL); if (unlikely(__pyx_t_6 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 1309, __pyx_L1_error)
+    __Pyx_TraceLine(1116,0,__PYX_ERR(0, 1116, __pyx_L1_error))
+    __pyx_t_6 = PyCapsule_GetPointer(__pyx_cur_scope->__pyx_v_scorer_capsule, NULL); if (unlikely(__pyx_t_6 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 1116, __pyx_L1_error)
     __pyx_cur_scope->__pyx_v_scorer_context = ((RF_Scorer *)__pyx_t_6);
 
-    /* "rapidfuzz/process_cpp.pyx":1308
+    /* "rapidfuzz/process_cpp_impl.pyx":1115
  * 
  *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
  *     if PyCapsule_IsValid(scorer_capsule, NULL):             # <<<<<<<<<<<<<<
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":1311
+  /* "rapidfuzz/process_cpp_impl.pyx":1118
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:             # <<<<<<<<<<<<<<
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  */
-  __Pyx_TraceLine(1311,0,__PYX_ERR(0, 1311, __pyx_L1_error))
+  __Pyx_TraceLine(1118,0,__PYX_ERR(0, 1118, __pyx_L1_error))
   __pyx_t_7 = (__pyx_cur_scope->__pyx_v_scorer_context != 0);
   if (__pyx_t_7) {
   } else {
     __pyx_t_2 = __pyx_t_7;
     goto __pyx_L9_bool_binop_done;
   }
   __pyx_t_7 = ((*__pyx_cur_scope->__pyx_v_scorer_context).version == 1);
   __pyx_t_2 = __pyx_t_7;
   __pyx_L9_bool_binop_done:;
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":1312
+    /* "rapidfuzz/process_cpp_impl.pyx":1119
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:
  *         kwargs_context = RF_KwargsWrapper()             # <<<<<<<<<<<<<<
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  */
-    __Pyx_TraceLine(1312,0,__PYX_ERR(0, 1312, __pyx_L1_error))
+    __Pyx_TraceLine(1119,0,__PYX_ERR(0, 1119, __pyx_L1_error))
     __pyx_cur_scope->__pyx_v_kwargs_context = RF_KwargsWrapper();
 
-    /* "rapidfuzz/process_cpp.pyx":1313
+    /* "rapidfuzz/process_cpp_impl.pyx":1120
  *     if scorer_context and dereference(scorer_context).version == 1:
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)             # <<<<<<<<<<<<<<
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  * 
  */
-    __Pyx_TraceLine(1313,0,__PYX_ERR(0, 1313, __pyx_L1_error))
+    __Pyx_TraceLine(1120,0,__PYX_ERR(0, 1120, __pyx_L1_error))
     __pyx_t_4 = __pyx_cur_scope->__pyx_v_kwargs;
     __Pyx_INCREF(__pyx_t_4);
-    __pyx_t_8 = (*__pyx_cur_scope->__pyx_v_scorer_context).kwargs_init((&__pyx_cur_scope->__pyx_v_kwargs_context.kwargs), ((PyObject*)__pyx_t_4)); if (unlikely(__pyx_t_8 == ((bool)0))) __PYX_ERR(0, 1313, __pyx_L1_error)
+    __pyx_t_8 = (*__pyx_cur_scope->__pyx_v_scorer_context).kwargs_init((&__pyx_cur_scope->__pyx_v_kwargs_context.kwargs), ((PyObject*)__pyx_t_4)); if (unlikely(__pyx_t_8 == ((bool)0))) __PYX_ERR(0, 1120, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":1314
+    /* "rapidfuzz/process_cpp_impl.pyx":1121
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)             # <<<<<<<<<<<<<<
  * 
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  */
-    __Pyx_TraceLine(1314,0,__PYX_ERR(0, 1314, __pyx_L1_error))
-    __pyx_t_8 = (*__pyx_cur_scope->__pyx_v_scorer_context).get_scorer_flags((&__pyx_cur_scope->__pyx_v_kwargs_context.kwargs), (&__pyx_cur_scope->__pyx_v_scorer_flags)); if (unlikely(__pyx_t_8 == ((bool)0))) __PYX_ERR(0, 1314, __pyx_L1_error)
+    __Pyx_TraceLine(1121,0,__PYX_ERR(0, 1121, __pyx_L1_error))
+    __pyx_t_8 = (*__pyx_cur_scope->__pyx_v_scorer_context).get_scorer_flags((&__pyx_cur_scope->__pyx_v_kwargs_context.kwargs), (&__pyx_cur_scope->__pyx_v_scorer_flags)); if (unlikely(__pyx_t_8 == ((bool)0))) __PYX_ERR(0, 1121, __pyx_L1_error)
 
-    /* "rapidfuzz/process_cpp.pyx":1316
+    /* "rapidfuzz/process_cpp_impl.pyx":1123
  *         dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
  * 
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)             # <<<<<<<<<<<<<<
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  */
-    __Pyx_TraceLine(1316,0,__PYX_ERR(0, 1316, __pyx_L1_error))
+    __Pyx_TraceLine(1123,0,__PYX_ERR(0, 1123, __pyx_L1_error))
     __pyx_t_4 = __pyx_cur_scope->__pyx_v_processor;
     __Pyx_INCREF(__pyx_t_4);
     __pyx_t_3 = __pyx_cur_scope->__pyx_v_processor;
     __Pyx_INCREF(__pyx_t_3);
-    __pyx_t_1 = __Pyx_GetAttr3(__pyx_t_4, __pyx_n_u_RF_Preprocess, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1316, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetAttr3(__pyx_t_4, __pyx_n_u_RF_Preprocess, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1123, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GIVEREF(__pyx_t_1);
     __pyx_cur_scope->__pyx_v_processor_capsule = __pyx_t_1;
     __pyx_t_1 = 0;
 
-    /* "rapidfuzz/process_cpp.pyx":1317
+    /* "rapidfuzz/process_cpp_impl.pyx":1124
  * 
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
-    __Pyx_TraceLine(1317,0,__PYX_ERR(0, 1317, __pyx_L1_error))
+    __Pyx_TraceLine(1124,0,__PYX_ERR(0, 1124, __pyx_L1_error))
     __pyx_t_2 = PyCapsule_IsValid(__pyx_cur_scope->__pyx_v_processor_capsule, NULL);
     if (__pyx_t_2) {
 
-      /* "rapidfuzz/process_cpp.pyx":1318
+      /* "rapidfuzz/process_cpp_impl.pyx":1125
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *         if hasattr(choices, "items"):
  */
-      __Pyx_TraceLine(1318,0,__PYX_ERR(0, 1318, __pyx_L1_error))
-      __pyx_t_6 = PyCapsule_GetPointer(__pyx_cur_scope->__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_6 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 1318, __pyx_L1_error)
+      __Pyx_TraceLine(1125,0,__PYX_ERR(0, 1125, __pyx_L1_error))
+      __pyx_t_6 = PyCapsule_GetPointer(__pyx_cur_scope->__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_6 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 1125, __pyx_L1_error)
       __pyx_cur_scope->__pyx_v_processor_context = ((RF_Preprocessor *)__pyx_t_6);
 
-      /* "rapidfuzz/process_cpp.pyx":1317
+      /* "rapidfuzz/process_cpp_impl.pyx":1124
  * 
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1320
+    /* "rapidfuzz/process_cpp_impl.pyx":1127
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  *         if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:
  *                 yield from extract_iter_dict_f64()
  */
-    __Pyx_TraceLine(1320,0,__PYX_ERR(0, 1320, __pyx_L1_error))
+    __Pyx_TraceLine(1127,0,__PYX_ERR(0, 1127, __pyx_L1_error))
     __pyx_t_1 = __pyx_cur_scope->__pyx_v_choices;
     __Pyx_INCREF(__pyx_t_1);
-    __pyx_t_2 = __Pyx_HasAttr(__pyx_t_1, __pyx_n_u_items); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 1320, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_HasAttr(__pyx_t_1, __pyx_n_u_items); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 1127, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (__pyx_t_2) {
 
-      /* "rapidfuzz/process_cpp.pyx":1321
+      /* "rapidfuzz/process_cpp_impl.pyx":1128
  * 
  *         if hasattr(choices, "items"):
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *                 yield from extract_iter_dict_f64()
  *                 return
  */
-      __Pyx_TraceLine(1321,0,__PYX_ERR(0, 1321, __pyx_L1_error))
+      __Pyx_TraceLine(1128,0,__PYX_ERR(0, 1128, __pyx_L1_error))
       __pyx_t_2 = ((__pyx_cur_scope->__pyx_v_scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64) != 0);
       if (__pyx_t_2) {
 
-        /* "rapidfuzz/process_cpp.pyx":1322
+        /* "rapidfuzz/process_cpp_impl.pyx":1129
  *         if hasattr(choices, "items"):
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:
  *                 yield from extract_iter_dict_f64()             # <<<<<<<<<<<<<<
  *                 return
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:
  */
-        __Pyx_TraceLine(1322,0,__PYX_ERR(0, 1322, __pyx_L1_error))
-        __pyx_t_1 = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_extract_iter_dict_f64(__pyx_cur_scope->__pyx_v_extract_iter_dict_f64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1322, __pyx_L1_error)
+        __Pyx_TraceLine(1129,0,__PYX_ERR(0, 1129, __pyx_L1_error))
+        __pyx_t_1 = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_extract_iter_dict_f64(__pyx_cur_scope->__pyx_v_extract_iter_dict_f64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1129, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_1);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XGOTREF(__pyx_r);
         if (likely(__pyx_r)) {
           __Pyx_XGIVEREF(__pyx_r);
           __Pyx_TraceReturn(__pyx_r, 0);
           __Pyx_RefNannyFinishContext();
           __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
           /* return from generator, yielding value */
           __pyx_generator->resume_label = 1;
           return __pyx_r;
           __pyx_L14_resume_from_yield_from:;
-          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1322, __pyx_L1_error)
+          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1129, __pyx_L1_error)
         } else {
           PyObject* exc_type = __Pyx_PyErr_Occurred();
           if (exc_type) {
             if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
-            else __PYX_ERR(0, 1322, __pyx_L1_error)
+            else __PYX_ERR(0, 1129, __pyx_L1_error)
           }
         }
 
-        /* "rapidfuzz/process_cpp.pyx":1323
+        /* "rapidfuzz/process_cpp_impl.pyx":1130
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:
  *                 yield from extract_iter_dict_f64()
  *                 return             # <<<<<<<<<<<<<<
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:
  *                 yield from extract_iter_dict_i64()
  */
-        __Pyx_TraceLine(1323,0,__PYX_ERR(0, 1323, __pyx_L1_error))
+        __Pyx_TraceLine(1130,0,__PYX_ERR(0, 1130, __pyx_L1_error))
         __Pyx_XDECREF(__pyx_r);
         __pyx_r = NULL;
         goto __pyx_L0;
 
-        /* "rapidfuzz/process_cpp.pyx":1321
+        /* "rapidfuzz/process_cpp_impl.pyx":1128
  * 
  *         if hasattr(choices, "items"):
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *                 yield from extract_iter_dict_f64()
  *                 return
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1324
+      /* "rapidfuzz/process_cpp_impl.pyx":1131
  *                 yield from extract_iter_dict_f64()
  *                 return
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *                 yield from extract_iter_dict_i64()
  *                 return
  */
-      __Pyx_TraceLine(1324,0,__PYX_ERR(0, 1324, __pyx_L1_error))
+      __Pyx_TraceLine(1131,0,__PYX_ERR(0, 1131, __pyx_L1_error))
       __pyx_t_2 = ((__pyx_cur_scope->__pyx_v_scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64) != 0);
       if (__pyx_t_2) {
 
-        /* "rapidfuzz/process_cpp.pyx":1325
+        /* "rapidfuzz/process_cpp_impl.pyx":1132
  *                 return
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:
  *                 yield from extract_iter_dict_i64()             # <<<<<<<<<<<<<<
  *                 return
  *         else:
  */
-        __Pyx_TraceLine(1325,0,__PYX_ERR(0, 1325, __pyx_L1_error))
-        __pyx_t_1 = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_3extract_iter_dict_i64(__pyx_cur_scope->__pyx_v_extract_iter_dict_i64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1325, __pyx_L1_error)
+        __Pyx_TraceLine(1132,0,__PYX_ERR(0, 1132, __pyx_L1_error))
+        __pyx_t_1 = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_3extract_iter_dict_i64(__pyx_cur_scope->__pyx_v_extract_iter_dict_i64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1132, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_1);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XGOTREF(__pyx_r);
         if (likely(__pyx_r)) {
           __Pyx_XGIVEREF(__pyx_r);
           __Pyx_TraceReturn(__pyx_r, 0);
           __Pyx_RefNannyFinishContext();
           __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
           /* return from generator, yielding value */
           __pyx_generator->resume_label = 2;
           return __pyx_r;
           __pyx_L15_resume_from_yield_from:;
-          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1325, __pyx_L1_error)
+          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1132, __pyx_L1_error)
         } else {
           PyObject* exc_type = __Pyx_PyErr_Occurred();
           if (exc_type) {
             if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
-            else __PYX_ERR(0, 1325, __pyx_L1_error)
+            else __PYX_ERR(0, 1132, __pyx_L1_error)
           }
         }
 
-        /* "rapidfuzz/process_cpp.pyx":1326
+        /* "rapidfuzz/process_cpp_impl.pyx":1133
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:
  *                 yield from extract_iter_dict_i64()
  *                 return             # <<<<<<<<<<<<<<
  *         else:
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:
  */
-        __Pyx_TraceLine(1326,0,__PYX_ERR(0, 1326, __pyx_L1_error))
+        __Pyx_TraceLine(1133,0,__PYX_ERR(0, 1133, __pyx_L1_error))
         __Pyx_XDECREF(__pyx_r);
         __pyx_r = NULL;
         goto __pyx_L0;
 
-        /* "rapidfuzz/process_cpp.pyx":1324
+        /* "rapidfuzz/process_cpp_impl.pyx":1131
  *                 yield from extract_iter_dict_f64()
  *                 return
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *                 yield from extract_iter_dict_i64()
  *                 return
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1320
+      /* "rapidfuzz/process_cpp_impl.pyx":1127
  *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  *         if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:
  *                 yield from extract_iter_dict_f64()
  */
       goto __pyx_L12;
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1328
+    /* "rapidfuzz/process_cpp_impl.pyx":1135
  *                 return
  *         else:
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *                 yield from extract_iter_list_f64()
  *                 return
  */
-    __Pyx_TraceLine(1328,0,__PYX_ERR(0, 1328, __pyx_L1_error))
+    __Pyx_TraceLine(1135,0,__PYX_ERR(0, 1135, __pyx_L1_error))
     /*else*/ {
       __pyx_t_2 = ((__pyx_cur_scope->__pyx_v_scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64) != 0);
       if (__pyx_t_2) {
 
-        /* "rapidfuzz/process_cpp.pyx":1329
+        /* "rapidfuzz/process_cpp_impl.pyx":1136
  *         else:
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:
  *                 yield from extract_iter_list_f64()             # <<<<<<<<<<<<<<
  *                 return
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:
  */
-        __Pyx_TraceLine(1329,0,__PYX_ERR(0, 1329, __pyx_L1_error))
-        __pyx_t_1 = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_6extract_iter_list_f64(__pyx_cur_scope->__pyx_v_extract_iter_list_f64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1329, __pyx_L1_error)
+        __Pyx_TraceLine(1136,0,__PYX_ERR(0, 1136, __pyx_L1_error))
+        __pyx_t_1 = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_6extract_iter_list_f64(__pyx_cur_scope->__pyx_v_extract_iter_list_f64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1136, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_1);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XGOTREF(__pyx_r);
         if (likely(__pyx_r)) {
           __Pyx_XGIVEREF(__pyx_r);
           __Pyx_TraceReturn(__pyx_r, 0);
           __Pyx_RefNannyFinishContext();
           __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
           /* return from generator, yielding value */
           __pyx_generator->resume_label = 3;
           return __pyx_r;
           __pyx_L17_resume_from_yield_from:;
-          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1329, __pyx_L1_error)
+          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1136, __pyx_L1_error)
         } else {
           PyObject* exc_type = __Pyx_PyErr_Occurred();
           if (exc_type) {
             if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
-            else __PYX_ERR(0, 1329, __pyx_L1_error)
+            else __PYX_ERR(0, 1136, __pyx_L1_error)
           }
         }
 
-        /* "rapidfuzz/process_cpp.pyx":1330
+        /* "rapidfuzz/process_cpp_impl.pyx":1137
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:
  *                 yield from extract_iter_list_f64()
  *                 return             # <<<<<<<<<<<<<<
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:
  *                 yield from extract_iter_list_i64()
  */
-        __Pyx_TraceLine(1330,0,__PYX_ERR(0, 1330, __pyx_L1_error))
+        __Pyx_TraceLine(1137,0,__PYX_ERR(0, 1137, __pyx_L1_error))
         __Pyx_XDECREF(__pyx_r);
         __pyx_r = NULL;
         goto __pyx_L0;
 
-        /* "rapidfuzz/process_cpp.pyx":1328
+        /* "rapidfuzz/process_cpp_impl.pyx":1135
  *                 return
  *         else:
  *             if scorer_flags.flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
  *                 yield from extract_iter_list_f64()
  *                 return
  */
       }
 
-      /* "rapidfuzz/process_cpp.pyx":1331
+      /* "rapidfuzz/process_cpp_impl.pyx":1138
  *                 yield from extract_iter_list_f64()
  *                 return
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *                 yield from extract_iter_list_i64()
  *                 return
  */
-      __Pyx_TraceLine(1331,0,__PYX_ERR(0, 1331, __pyx_L1_error))
+      __Pyx_TraceLine(1138,0,__PYX_ERR(0, 1138, __pyx_L1_error))
       __pyx_t_2 = ((__pyx_cur_scope->__pyx_v_scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64) != 0);
       if (__pyx_t_2) {
 
-        /* "rapidfuzz/process_cpp.pyx":1332
+        /* "rapidfuzz/process_cpp_impl.pyx":1139
  *                 return
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:
  *                 yield from extract_iter_list_i64()             # <<<<<<<<<<<<<<
  *                 return
  * 
  */
-        __Pyx_TraceLine(1332,0,__PYX_ERR(0, 1332, __pyx_L1_error))
-        __pyx_t_1 = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_9extract_iter_list_i64(__pyx_cur_scope->__pyx_v_extract_iter_list_i64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1332, __pyx_L1_error)
+        __Pyx_TraceLine(1139,0,__PYX_ERR(0, 1139, __pyx_L1_error))
+        __pyx_t_1 = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_9extract_iter_list_i64(__pyx_cur_scope->__pyx_v_extract_iter_list_i64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1139, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_1);
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __Pyx_XGOTREF(__pyx_r);
         if (likely(__pyx_r)) {
           __Pyx_XGIVEREF(__pyx_r);
           __Pyx_TraceReturn(__pyx_r, 0);
           __Pyx_RefNannyFinishContext();
           __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
           /* return from generator, yielding value */
           __pyx_generator->resume_label = 4;
           return __pyx_r;
           __pyx_L18_resume_from_yield_from:;
-          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1332, __pyx_L1_error)
+          if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1139, __pyx_L1_error)
         } else {
           PyObject* exc_type = __Pyx_PyErr_Occurred();
           if (exc_type) {
             if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
-            else __PYX_ERR(0, 1332, __pyx_L1_error)
+            else __PYX_ERR(0, 1139, __pyx_L1_error)
           }
         }
 
-        /* "rapidfuzz/process_cpp.pyx":1333
+        /* "rapidfuzz/process_cpp_impl.pyx":1140
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:
  *                 yield from extract_iter_list_i64()
  *                 return             # <<<<<<<<<<<<<<
  * 
  *         raise ValueError("scorer does not properly use the C-API")
  */
-        __Pyx_TraceLine(1333,0,__PYX_ERR(0, 1333, __pyx_L1_error))
+        __Pyx_TraceLine(1140,0,__PYX_ERR(0, 1140, __pyx_L1_error))
         __Pyx_XDECREF(__pyx_r);
         __pyx_r = NULL;
         goto __pyx_L0;
 
-        /* "rapidfuzz/process_cpp.pyx":1331
+        /* "rapidfuzz/process_cpp_impl.pyx":1138
  *                 yield from extract_iter_list_f64()
  *                 return
  *             elif scorer_flags.flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
  *                 yield from extract_iter_list_i64()
  *                 return
  */
       }
     }
     __pyx_L12:;
 
-    /* "rapidfuzz/process_cpp.pyx":1335
+    /* "rapidfuzz/process_cpp_impl.pyx":1142
  *                 return
  * 
  *         raise ValueError("scorer does not properly use the C-API")             # <<<<<<<<<<<<<<
  * 
  *     worst_score, optimal_score = get_scorer_flags_py(scorer, kwargs)
  */
-    __Pyx_TraceLine(1335,0,__PYX_ERR(0, 1335, __pyx_L1_error))
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1335, __pyx_L1_error)
+    __Pyx_TraceLine(1142,0,__PYX_ERR(0, 1142, __pyx_L1_error))
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1142, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1335, __pyx_L1_error)
+    __PYX_ERR(0, 1142, __pyx_L1_error)
 
-    /* "rapidfuzz/process_cpp.pyx":1311
+    /* "rapidfuzz/process_cpp_impl.pyx":1118
  *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
  * 
  *     if scorer_context and dereference(scorer_context).version == 1:             # <<<<<<<<<<<<<<
  *         kwargs_context = RF_KwargsWrapper()
  *         dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":1337
+  /* "rapidfuzz/process_cpp_impl.pyx":1144
  *         raise ValueError("scorer does not properly use the C-API")
  * 
  *     worst_score, optimal_score = get_scorer_flags_py(scorer, kwargs)             # <<<<<<<<<<<<<<
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:
  */
-  __Pyx_TraceLine(1337,0,__PYX_ERR(0, 1337, __pyx_L1_error))
+  __Pyx_TraceLine(1144,0,__PYX_ERR(0, 1144, __pyx_L1_error))
   __pyx_t_1 = __pyx_cur_scope->__pyx_v_scorer;
   __Pyx_INCREF(__pyx_t_1);
   __pyx_t_3 = __pyx_cur_scope->__pyx_v_kwargs;
   __Pyx_INCREF(__pyx_t_3);
-  __pyx_t_4 = __pyx_f_9rapidfuzz_11process_cpp_get_scorer_flags_py(__pyx_t_1, ((PyObject*)__pyx_t_3)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1337, __pyx_L1_error)
+  __pyx_t_4 = __pyx_f_9rapidfuzz_16process_cpp_impl_get_scorer_flags_py(__pyx_t_1, ((PyObject*)__pyx_t_3)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1144, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
     PyObject* sequence = __pyx_t_4;
     Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
     if (unlikely(size != 2)) {
       if (size > 2) __Pyx_RaiseTooManyValuesError(2);
       else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
-      __PYX_ERR(0, 1337, __pyx_L1_error)
+      __PYX_ERR(0, 1144, __pyx_L1_error)
     }
     #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
     if (likely(PyTuple_CheckExact(sequence))) {
       __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
       __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
     } else {
       __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
       __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
     }
     __Pyx_INCREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_t_1);
     #else
-    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1337, __pyx_L1_error)
+    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1144, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1337, __pyx_L1_error)
+    __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1144, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     #endif
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   } else {
     Py_ssize_t index = -1;
-    __pyx_t_9 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1337, __pyx_L1_error)
+    __pyx_t_9 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1144, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_9);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_9);
     index = 0; __pyx_t_3 = __pyx_t_10(__pyx_t_9); if (unlikely(!__pyx_t_3)) goto __pyx_L19_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_3);
     index = 1; __pyx_t_1 = __pyx_t_10(__pyx_t_9); if (unlikely(!__pyx_t_1)) goto __pyx_L19_unpacking_failed;
     __Pyx_GOTREF(__pyx_t_1);
-    if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_9), 2) < 0) __PYX_ERR(0, 1337, __pyx_L1_error)
+    if (__Pyx_IternextUnpackEndCheck(__pyx_t_10(__pyx_t_9), 2) < 0) __PYX_ERR(0, 1144, __pyx_L1_error)
     __pyx_t_10 = NULL;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     goto __pyx_L20_unpacking_done;
     __pyx_L19_unpacking_failed:;
     __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
     __pyx_t_10 = NULL;
     if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
-    __PYX_ERR(0, 1337, __pyx_L1_error)
+    __PYX_ERR(0, 1144, __pyx_L1_error)
     __pyx_L20_unpacking_done:;
   }
   __Pyx_GIVEREF(__pyx_t_3);
   __pyx_cur_scope->__pyx_v_worst_score = __pyx_t_3;
   __pyx_t_3 = 0;
   __Pyx_GIVEREF(__pyx_t_1);
   __pyx_cur_scope->__pyx_v_optimal_score = __pyx_t_1;
   __pyx_t_1 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1339
+  /* "rapidfuzz/process_cpp_impl.pyx":1146
  *     worst_score, optimal_score = get_scorer_flags_py(scorer, kwargs)
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:             # <<<<<<<<<<<<<<
  *         score_cutoff = worst_score
  * 
  */
-  __Pyx_TraceLine(1339,0,__PYX_ERR(0, 1339, __pyx_L1_error))
+  __Pyx_TraceLine(1146,0,__PYX_ERR(0, 1146, __pyx_L1_error))
   __pyx_t_2 = (__pyx_cur_scope->__pyx_v_score_cutoff == Py_None);
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":1340
+    /* "rapidfuzz/process_cpp_impl.pyx":1147
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:
  *         score_cutoff = worst_score             # <<<<<<<<<<<<<<
  * 
  *     kwargs["processor"] = None
  */
-    __Pyx_TraceLine(1340,0,__PYX_ERR(0, 1340, __pyx_L1_error))
+    __Pyx_TraceLine(1147,0,__PYX_ERR(0, 1147, __pyx_L1_error))
     __Pyx_INCREF(__pyx_cur_scope->__pyx_v_worst_score);
     __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_score_cutoff);
     __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_score_cutoff, __pyx_cur_scope->__pyx_v_worst_score);
     __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_worst_score);
 
-    /* "rapidfuzz/process_cpp.pyx":1339
+    /* "rapidfuzz/process_cpp_impl.pyx":1146
  *     worst_score, optimal_score = get_scorer_flags_py(scorer, kwargs)
  *     # the scorer has to be called through Python
  *     if score_cutoff is None:             # <<<<<<<<<<<<<<
  *         score_cutoff = worst_score
  * 
  */
   }
 
-  /* "rapidfuzz/process_cpp.pyx":1342
+  /* "rapidfuzz/process_cpp_impl.pyx":1149
  *         score_cutoff = worst_score
  * 
  *     kwargs["processor"] = None             # <<<<<<<<<<<<<<
  *     kwargs["score_cutoff"] = score_cutoff
  * 
  */
-  __Pyx_TraceLine(1342,0,__PYX_ERR(0, 1342, __pyx_L1_error))
-  if (unlikely((PyDict_SetItem(__pyx_cur_scope->__pyx_v_kwargs, __pyx_n_u_processor, Py_None) < 0))) __PYX_ERR(0, 1342, __pyx_L1_error)
+  __Pyx_TraceLine(1149,0,__PYX_ERR(0, 1149, __pyx_L1_error))
+  if (unlikely((PyDict_SetItem(__pyx_cur_scope->__pyx_v_kwargs, __pyx_n_u_processor, Py_None) < 0))) __PYX_ERR(0, 1149, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1343
+  /* "rapidfuzz/process_cpp_impl.pyx":1150
  * 
  *     kwargs["processor"] = None
  *     kwargs["score_cutoff"] = score_cutoff             # <<<<<<<<<<<<<<
  * 
  *     if hasattr(choices, "items"):
  */
-  __Pyx_TraceLine(1343,0,__PYX_ERR(0, 1343, __pyx_L1_error))
-  if (unlikely((PyDict_SetItem(__pyx_cur_scope->__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_cur_scope->__pyx_v_score_cutoff) < 0))) __PYX_ERR(0, 1343, __pyx_L1_error)
+  __Pyx_TraceLine(1150,0,__PYX_ERR(0, 1150, __pyx_L1_error))
+  if (unlikely((PyDict_SetItem(__pyx_cur_scope->__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_cur_scope->__pyx_v_score_cutoff) < 0))) __PYX_ERR(0, 1150, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1345
+  /* "rapidfuzz/process_cpp_impl.pyx":1152
  *     kwargs["score_cutoff"] = score_cutoff
  * 
  *     if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *         yield from py_extract_iter_dict(worst_score, optimal_score)
  *     else:
  */
-  __Pyx_TraceLine(1345,0,__PYX_ERR(0, 1345, __pyx_L1_error))
+  __Pyx_TraceLine(1152,0,__PYX_ERR(0, 1152, __pyx_L1_error))
   __pyx_t_4 = __pyx_cur_scope->__pyx_v_choices;
   __Pyx_INCREF(__pyx_t_4);
-  __pyx_t_2 = __Pyx_HasAttr(__pyx_t_4, __pyx_n_u_items); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 1345, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_HasAttr(__pyx_t_4, __pyx_n_u_items); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 1152, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (__pyx_t_2) {
 
-    /* "rapidfuzz/process_cpp.pyx":1346
+    /* "rapidfuzz/process_cpp_impl.pyx":1153
  * 
  *     if hasattr(choices, "items"):
  *         yield from py_extract_iter_dict(worst_score, optimal_score)             # <<<<<<<<<<<<<<
  *     else:
  *         yield from py_extract_iter_list(worst_score, optimal_score)
  */
-    __Pyx_TraceLine(1346,0,__PYX_ERR(0, 1346, __pyx_L1_error))
-    __pyx_t_4 = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_12py_extract_iter_dict(__pyx_cur_scope->__pyx_v_py_extract_iter_dict, __pyx_cur_scope->__pyx_v_worst_score, __pyx_cur_scope->__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1346, __pyx_L1_error)
+    __Pyx_TraceLine(1153,0,__PYX_ERR(0, 1153, __pyx_L1_error))
+    __pyx_t_4 = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_12py_extract_iter_dict(__pyx_cur_scope->__pyx_v_py_extract_iter_dict, __pyx_cur_scope->__pyx_v_worst_score, __pyx_cur_scope->__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1153, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_XGOTREF(__pyx_r);
     if (likely(__pyx_r)) {
       __Pyx_XGIVEREF(__pyx_r);
       __Pyx_TraceReturn(__pyx_r, 0);
       __Pyx_RefNannyFinishContext();
       __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
       /* return from generator, yielding value */
       __pyx_generator->resume_label = 5;
       return __pyx_r;
       __pyx_L23_resume_from_yield_from:;
-      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1346, __pyx_L1_error)
+      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1153, __pyx_L1_error)
     } else {
       PyObject* exc_type = __Pyx_PyErr_Occurred();
       if (exc_type) {
         if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
-        else __PYX_ERR(0, 1346, __pyx_L1_error)
+        else __PYX_ERR(0, 1153, __pyx_L1_error)
       }
     }
 
-    /* "rapidfuzz/process_cpp.pyx":1345
+    /* "rapidfuzz/process_cpp_impl.pyx":1152
  *     kwargs["score_cutoff"] = score_cutoff
  * 
  *     if hasattr(choices, "items"):             # <<<<<<<<<<<<<<
  *         yield from py_extract_iter_dict(worst_score, optimal_score)
  *     else:
  */
     goto __pyx_L22;
   }
 
-  /* "rapidfuzz/process_cpp.pyx":1348
+  /* "rapidfuzz/process_cpp_impl.pyx":1155
  *         yield from py_extract_iter_dict(worst_score, optimal_score)
  *     else:
  *         yield from py_extract_iter_list(worst_score, optimal_score)             # <<<<<<<<<<<<<<
+ * 
+ * 
  */
-  __Pyx_TraceLine(1348,0,__PYX_ERR(0, 1348, __pyx_L1_error))
+  __Pyx_TraceLine(1155,0,__PYX_ERR(0, 1155, __pyx_L1_error))
   /*else*/ {
-    __pyx_t_4 = __pyx_pf_9rapidfuzz_11process_cpp_12extract_iter_15py_extract_iter_list(__pyx_cur_scope->__pyx_v_py_extract_iter_list, __pyx_cur_scope->__pyx_v_worst_score, __pyx_cur_scope->__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1348, __pyx_L1_error)
+    __pyx_t_4 = __pyx_pf_9rapidfuzz_16process_cpp_impl_12extract_iter_15py_extract_iter_list(__pyx_cur_scope->__pyx_v_py_extract_iter_list, __pyx_cur_scope->__pyx_v_worst_score, __pyx_cur_scope->__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1155, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_r = __Pyx_Generator_Yield_From(__pyx_generator, __pyx_t_4);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_XGOTREF(__pyx_r);
     if (likely(__pyx_r)) {
       __Pyx_XGIVEREF(__pyx_r);
       __Pyx_TraceReturn(__pyx_r, 0);
       __Pyx_RefNannyFinishContext();
       __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
       /* return from generator, yielding value */
       __pyx_generator->resume_label = 6;
       return __pyx_r;
       __pyx_L24_resume_from_yield_from:;
-      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1348, __pyx_L1_error)
+      if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1155, __pyx_L1_error)
     } else {
       PyObject* exc_type = __Pyx_PyErr_Occurred();
       if (exc_type) {
         if (likely(exc_type == PyExc_StopIteration || (exc_type != PyExc_GeneratorExit && __Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))) PyErr_Clear();
-        else __PYX_ERR(0, 1348, __pyx_L1_error)
+        else __PYX_ERR(0, 1155, __pyx_L1_error)
       }
     }
   }
   __pyx_L22:;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "rapidfuzz/process_cpp.pyx":1018
+  /* "rapidfuzz/process_cpp_impl.pyx":878
  * 
  * 
  * def extract_iter(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best match in a list of choices
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
 
   /* function exit code */
   PyErr_SetNone(PyExc_StopIteration);
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_Generator_Replace_StopIteration(0);
@@ -18797,14 +19720,2974 @@
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_TraceReturn(__pyx_r, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
+/* "rapidfuzz/process_cpp_impl.pyx":1169
+ * UINT64 = MatrixType.UINT64
+ * 
+ * cdef inline vector[PyObjectWrapper] preprocess_py(queries, processor) except *:             # <<<<<<<<<<<<<<
+ *     cdef vector[PyObjectWrapper] proc_queries
+ *     cdef int64_t queries_len = <int64_t>len(queries)
+ */
+
+static CYTHON_INLINE std::vector<PyObjectWrapper>  __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_py(PyObject *__pyx_v_queries, PyObject *__pyx_v_processor) {
+  std::vector<PyObjectWrapper>  __pyx_v_proc_queries;
+  int64_t __pyx_v_queries_len;
+  PyObject *__pyx_v_query = NULL;
+  PyObject *__pyx_v_proc_query = NULL;
+  std::vector<PyObjectWrapper>  __pyx_r;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  Py_ssize_t __pyx_t_1;
+  int __pyx_t_2;
+  int __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *(*__pyx_t_5)(PyObject *);
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  int __pyx_t_9;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("preprocess_py", 0);
+  __Pyx_TraceCall("preprocess_py", __pyx_f[0], 1169, 0, __PYX_ERR(0, 1169, __pyx_L1_error));
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1171
+ * cdef inline vector[PyObjectWrapper] preprocess_py(queries, processor) except *:
+ *     cdef vector[PyObjectWrapper] proc_queries
+ *     cdef int64_t queries_len = <int64_t>len(queries)             # <<<<<<<<<<<<<<
+ *     proc_queries.reserve(queries_len)
+ * 
+ */
+  __Pyx_TraceLine(1171,0,__PYX_ERR(0, 1171, __pyx_L1_error))
+  __pyx_t_1 = PyObject_Length(__pyx_v_queries); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1171, __pyx_L1_error)
+  __pyx_v_queries_len = ((int64_t)__pyx_t_1);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1172
+ *     cdef vector[PyObjectWrapper] proc_queries
+ *     cdef int64_t queries_len = <int64_t>len(queries)
+ *     proc_queries.reserve(queries_len)             # <<<<<<<<<<<<<<
+ * 
+ *     # processor None/False
+ */
+  __Pyx_TraceLine(1172,0,__PYX_ERR(0, 1172, __pyx_L1_error))
+  try {
+    __pyx_v_proc_queries.reserve(__pyx_v_queries_len);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 1172, __pyx_L1_error)
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1175
+ * 
+ *     # processor None/False
+ *     if not processor:             # <<<<<<<<<<<<<<
+ *         for query in queries:
+ *             proc_queries.emplace_back(<PyObject*>query)
+ */
+  __Pyx_TraceLine(1175,0,__PYX_ERR(0, 1175, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 1175, __pyx_L1_error)
+  __pyx_t_3 = (!__pyx_t_2);
+  if (__pyx_t_3) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1176
+ *     # processor None/False
+ *     if not processor:
+ *         for query in queries:             # <<<<<<<<<<<<<<
+ *             proc_queries.emplace_back(<PyObject*>query)
+ *     # processor has to be called through python
+ */
+    __Pyx_TraceLine(1176,0,__PYX_ERR(0, 1176, __pyx_L1_error))
+    if (likely(PyList_CheckExact(__pyx_v_queries)) || PyTuple_CheckExact(__pyx_v_queries)) {
+      __pyx_t_4 = __pyx_v_queries; __Pyx_INCREF(__pyx_t_4); __pyx_t_1 = 0;
+      __pyx_t_5 = NULL;
+    } else {
+      __pyx_t_1 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1176, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1176, __pyx_L1_error)
+    }
+    for (;;) {
+      if (likely(!__pyx_t_5)) {
+        if (likely(PyList_CheckExact(__pyx_t_4))) {
+          if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_4)) break;
+          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 1176, __pyx_L1_error)
+          #else
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1176, __pyx_L1_error)
+          __Pyx_GOTREF(__pyx_t_6);
+          #endif
+        } else {
+          if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
+          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 1176, __pyx_L1_error)
+          #else
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1176, __pyx_L1_error)
+          __Pyx_GOTREF(__pyx_t_6);
+          #endif
+        }
+      } else {
+        __pyx_t_6 = __pyx_t_5(__pyx_t_4);
+        if (unlikely(!__pyx_t_6)) {
+          PyObject* exc_type = PyErr_Occurred();
+          if (exc_type) {
+            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
+            else __PYX_ERR(0, 1176, __pyx_L1_error)
+          }
+          break;
+        }
+        __Pyx_GOTREF(__pyx_t_6);
+      }
+      __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_6);
+      __pyx_t_6 = 0;
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1177
+ *     if not processor:
+ *         for query in queries:
+ *             proc_queries.emplace_back(<PyObject*>query)             # <<<<<<<<<<<<<<
+ *     # processor has to be called through python
+ *     else:
+ */
+      __Pyx_TraceLine(1177,0,__PYX_ERR(0, 1177, __pyx_L1_error))
+      try {
+        __pyx_v_proc_queries.emplace_back(((PyObject *)__pyx_v_query));
+      } catch(...) {
+        __Pyx_CppExn2PyErr();
+        __PYX_ERR(0, 1177, __pyx_L1_error)
+      }
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1176
+ *     # processor None/False
+ *     if not processor:
+ *         for query in queries:             # <<<<<<<<<<<<<<
+ *             proc_queries.emplace_back(<PyObject*>query)
+ *     # processor has to be called through python
+ */
+      __Pyx_TraceLine(1176,0,__PYX_ERR(0, 1176, __pyx_L1_error))
+    }
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1175
+ * 
+ *     # processor None/False
+ *     if not processor:             # <<<<<<<<<<<<<<
+ *         for query in queries:
+ *             proc_queries.emplace_back(<PyObject*>query)
+ */
+    goto __pyx_L3;
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1180
+ *     # processor has to be called through python
+ *     else:
+ *         for query in queries:             # <<<<<<<<<<<<<<
+ *             proc_query = processor(query)
+ *             proc_queries.emplace_back(<PyObject*>proc_query)
+ */
+  __Pyx_TraceLine(1180,0,__PYX_ERR(0, 1180, __pyx_L1_error))
+  /*else*/ {
+    if (likely(PyList_CheckExact(__pyx_v_queries)) || PyTuple_CheckExact(__pyx_v_queries)) {
+      __pyx_t_4 = __pyx_v_queries; __Pyx_INCREF(__pyx_t_4); __pyx_t_1 = 0;
+      __pyx_t_5 = NULL;
+    } else {
+      __pyx_t_1 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1180, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1180, __pyx_L1_error)
+    }
+    for (;;) {
+      if (likely(!__pyx_t_5)) {
+        if (likely(PyList_CheckExact(__pyx_t_4))) {
+          if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_4)) break;
+          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 1180, __pyx_L1_error)
+          #else
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1180, __pyx_L1_error)
+          __Pyx_GOTREF(__pyx_t_6);
+          #endif
+        } else {
+          if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
+          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 1180, __pyx_L1_error)
+          #else
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1180, __pyx_L1_error)
+          __Pyx_GOTREF(__pyx_t_6);
+          #endif
+        }
+      } else {
+        __pyx_t_6 = __pyx_t_5(__pyx_t_4);
+        if (unlikely(!__pyx_t_6)) {
+          PyObject* exc_type = PyErr_Occurred();
+          if (exc_type) {
+            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
+            else __PYX_ERR(0, 1180, __pyx_L1_error)
+          }
+          break;
+        }
+        __Pyx_GOTREF(__pyx_t_6);
+      }
+      __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_6);
+      __pyx_t_6 = 0;
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1181
+ *     else:
+ *         for query in queries:
+ *             proc_query = processor(query)             # <<<<<<<<<<<<<<
+ *             proc_queries.emplace_back(<PyObject*>proc_query)
+ * 
+ */
+      __Pyx_TraceLine(1181,0,__PYX_ERR(0, 1181, __pyx_L1_error))
+      __Pyx_INCREF(__pyx_v_processor);
+      __pyx_t_7 = __pyx_v_processor; __pyx_t_8 = NULL;
+      __pyx_t_9 = 0;
+      if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
+        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
+        if (likely(__pyx_t_8)) {
+          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
+          __Pyx_INCREF(__pyx_t_8);
+          __Pyx_INCREF(function);
+          __Pyx_DECREF_SET(__pyx_t_7, function);
+          __pyx_t_9 = 1;
+        }
+      }
+      {
+        PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_v_query};
+        __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_9, 1+__pyx_t_9);
+        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
+        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1181, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_6);
+        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      }
+      __Pyx_XDECREF_SET(__pyx_v_proc_query, __pyx_t_6);
+      __pyx_t_6 = 0;
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1182
+ *         for query in queries:
+ *             proc_query = processor(query)
+ *             proc_queries.emplace_back(<PyObject*>proc_query)             # <<<<<<<<<<<<<<
+ * 
+ *     return move(proc_queries)
+ */
+      __Pyx_TraceLine(1182,0,__PYX_ERR(0, 1182, __pyx_L1_error))
+      try {
+        __pyx_v_proc_queries.emplace_back(((PyObject *)__pyx_v_proc_query));
+      } catch(...) {
+        __Pyx_CppExn2PyErr();
+        __PYX_ERR(0, 1182, __pyx_L1_error)
+      }
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1180
+ *     # processor has to be called through python
+ *     else:
+ *         for query in queries:             # <<<<<<<<<<<<<<
+ *             proc_query = processor(query)
+ *             proc_queries.emplace_back(<PyObject*>proc_query)
+ */
+      __Pyx_TraceLine(1180,0,__PYX_ERR(0, 1180, __pyx_L1_error))
+    }
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  }
+  __pyx_L3:;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1184
+ *             proc_queries.emplace_back(<PyObject*>proc_query)
+ * 
+ *     return move(proc_queries)             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline vector[RF_StringWrapper] preprocess(queries, processor) except *:
+ */
+  __Pyx_TraceLine(1184,0,__PYX_ERR(0, 1184, __pyx_L1_error))
+  __pyx_r = cython_std::move<std::vector<PyObjectWrapper> >(__pyx_v_proc_queries);
+  goto __pyx_L0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1169
+ * UINT64 = MatrixType.UINT64
+ * 
+ * cdef inline vector[PyObjectWrapper] preprocess_py(queries, processor) except *:             # <<<<<<<<<<<<<<
+ *     cdef vector[PyObjectWrapper] proc_queries
+ *     cdef int64_t queries_len = <int64_t>len(queries)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.preprocess_py", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_pretend_to_initialize(&__pyx_r);
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_query);
+  __Pyx_XDECREF(__pyx_v_proc_query);
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/process_cpp_impl.pyx":1186
+ *     return move(proc_queries)
+ * 
+ * cdef inline vector[RF_StringWrapper] preprocess(queries, processor) except *:             # <<<<<<<<<<<<<<
+ *     cdef vector[RF_StringWrapper] proc_queries
+ *     cdef int64_t queries_len = <int64_t>len(queries)
+ */
+
+static CYTHON_INLINE std::vector<RF_StringWrapper>  __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess(PyObject *__pyx_v_queries, PyObject *__pyx_v_processor) {
+  std::vector<RF_StringWrapper>  __pyx_v_proc_queries;
+  int64_t __pyx_v_queries_len;
+  RF_String __pyx_v_proc_str;
+  RF_Preprocessor *__pyx_v_processor_context;
+  PyObject *__pyx_v_query = NULL;
+  PyObject *__pyx_v_processor_capsule = NULL;
+  PyObject *__pyx_v_proc_query = NULL;
+  std::vector<RF_StringWrapper>  __pyx_r;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  Py_ssize_t __pyx_t_1;
+  int __pyx_t_2;
+  int __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *(*__pyx_t_5)(PyObject *);
+  PyObject *__pyx_t_6 = NULL;
+  RF_String __pyx_t_7;
+  void *__pyx_t_8;
+  bool __pyx_t_9;
+  PyObject *__pyx_t_10 = NULL;
+  PyObject *__pyx_t_11 = NULL;
+  int __pyx_t_12;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("preprocess", 0);
+  __Pyx_TraceCall("preprocess", __pyx_f[0], 1186, 0, __PYX_ERR(0, 1186, __pyx_L1_error));
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1188
+ * cdef inline vector[RF_StringWrapper] preprocess(queries, processor) except *:
+ *     cdef vector[RF_StringWrapper] proc_queries
+ *     cdef int64_t queries_len = <int64_t>len(queries)             # <<<<<<<<<<<<<<
+ *     cdef RF_String proc_str
+ *     cdef RF_Preprocessor* processor_context = NULL
+ */
+  __Pyx_TraceLine(1188,0,__PYX_ERR(0, 1188, __pyx_L1_error))
+  __pyx_t_1 = PyObject_Length(__pyx_v_queries); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1188, __pyx_L1_error)
+  __pyx_v_queries_len = ((int64_t)__pyx_t_1);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1190
+ *     cdef int64_t queries_len = <int64_t>len(queries)
+ *     cdef RF_String proc_str
+ *     cdef RF_Preprocessor* processor_context = NULL             # <<<<<<<<<<<<<<
+ *     proc_queries.reserve(queries_len)
+ * 
+ */
+  __Pyx_TraceLine(1190,0,__PYX_ERR(0, 1190, __pyx_L1_error))
+  __pyx_v_processor_context = NULL;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1191
+ *     cdef RF_String proc_str
+ *     cdef RF_Preprocessor* processor_context = NULL
+ *     proc_queries.reserve(queries_len)             # <<<<<<<<<<<<<<
+ * 
+ *     # No processor
+ */
+  __Pyx_TraceLine(1191,0,__PYX_ERR(0, 1191, __pyx_L1_error))
+  try {
+    __pyx_v_proc_queries.reserve(__pyx_v_queries_len);
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 1191, __pyx_L1_error)
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1194
+ * 
+ *     # No processor
+ *     if not processor:             # <<<<<<<<<<<<<<
+ *         for query in queries:
+ *             proc_queries.emplace_back(conv_sequence(query))
+ */
+  __Pyx_TraceLine(1194,0,__PYX_ERR(0, 1194, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 1194, __pyx_L1_error)
+  __pyx_t_3 = (!__pyx_t_2);
+  if (__pyx_t_3) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1195
+ *     # No processor
+ *     if not processor:
+ *         for query in queries:             # <<<<<<<<<<<<<<
+ *             proc_queries.emplace_back(conv_sequence(query))
+ *     else:
+ */
+    __Pyx_TraceLine(1195,0,__PYX_ERR(0, 1195, __pyx_L1_error))
+    if (likely(PyList_CheckExact(__pyx_v_queries)) || PyTuple_CheckExact(__pyx_v_queries)) {
+      __pyx_t_4 = __pyx_v_queries; __Pyx_INCREF(__pyx_t_4); __pyx_t_1 = 0;
+      __pyx_t_5 = NULL;
+    } else {
+      __pyx_t_1 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1195, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1195, __pyx_L1_error)
+    }
+    for (;;) {
+      if (likely(!__pyx_t_5)) {
+        if (likely(PyList_CheckExact(__pyx_t_4))) {
+          if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_4)) break;
+          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 1195, __pyx_L1_error)
+          #else
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1195, __pyx_L1_error)
+          __Pyx_GOTREF(__pyx_t_6);
+          #endif
+        } else {
+          if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
+          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 1195, __pyx_L1_error)
+          #else
+          __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1195, __pyx_L1_error)
+          __Pyx_GOTREF(__pyx_t_6);
+          #endif
+        }
+      } else {
+        __pyx_t_6 = __pyx_t_5(__pyx_t_4);
+        if (unlikely(!__pyx_t_6)) {
+          PyObject* exc_type = PyErr_Occurred();
+          if (exc_type) {
+            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
+            else __PYX_ERR(0, 1195, __pyx_L1_error)
+          }
+          break;
+        }
+        __Pyx_GOTREF(__pyx_t_6);
+      }
+      __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_6);
+      __pyx_t_6 = 0;
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1196
+ *     if not processor:
+ *         for query in queries:
+ *             proc_queries.emplace_back(conv_sequence(query))             # <<<<<<<<<<<<<<
+ *     else:
+ *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
+ */
+      __Pyx_TraceLine(1196,0,__PYX_ERR(0, 1196, __pyx_L1_error))
+      __pyx_t_7 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1196, __pyx_L1_error)
+      try {
+        __pyx_v_proc_queries.emplace_back(__pyx_t_7);
+      } catch(...) {
+        __Pyx_CppExn2PyErr();
+        __PYX_ERR(0, 1196, __pyx_L1_error)
+      }
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1195
+ *     # No processor
+ *     if not processor:
+ *         for query in queries:             # <<<<<<<<<<<<<<
+ *             proc_queries.emplace_back(conv_sequence(query))
+ *     else:
+ */
+      __Pyx_TraceLine(1195,0,__PYX_ERR(0, 1195, __pyx_L1_error))
+    }
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1194
+ * 
+ *     # No processor
+ *     if not processor:             # <<<<<<<<<<<<<<
+ *         for query in queries:
+ *             proc_queries.emplace_back(conv_sequence(query))
+ */
+    goto __pyx_L3;
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1198
+ *             proc_queries.emplace_back(conv_sequence(query))
+ *     else:
+ *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)             # <<<<<<<<<<<<<<
+ *         if PyCapsule_IsValid(processor_capsule, NULL):
+ *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
+ */
+  __Pyx_TraceLine(1198,0,__PYX_ERR(0, 1198, __pyx_L1_error))
+  /*else*/ {
+    __pyx_t_4 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1198, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_v_processor_capsule = __pyx_t_4;
+    __pyx_t_4 = 0;
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1199
+ *     else:
+ *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
+ *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
+ *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
+ * 
+ */
+    __Pyx_TraceLine(1199,0,__PYX_ERR(0, 1199, __pyx_L1_error))
+    __pyx_t_3 = PyCapsule_IsValid(__pyx_v_processor_capsule, NULL);
+    if (__pyx_t_3) {
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1200
+ *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
+ *         if PyCapsule_IsValid(processor_capsule, NULL):
+ *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)             # <<<<<<<<<<<<<<
+ * 
+ *         # use RapidFuzz C-Api
+ */
+      __Pyx_TraceLine(1200,0,__PYX_ERR(0, 1200, __pyx_L1_error))
+      __pyx_t_8 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_8 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 1200, __pyx_L1_error)
+      __pyx_v_processor_context = ((RF_Preprocessor *)__pyx_t_8);
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1199
+ *     else:
+ *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
+ *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
+ *             processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
+ * 
+ */
+    }
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1203
+ * 
+ *         # use RapidFuzz C-Api
+ *         if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
+ *             for query in queries:
+ *                 processor_context.preprocess(query, &proc_str)
+ */
+    __Pyx_TraceLine(1203,0,__PYX_ERR(0, 1203, __pyx_L1_error))
+    __pyx_t_2 = (__pyx_v_processor_context != NULL);
+    if (__pyx_t_2) {
+    } else {
+      __pyx_t_3 = __pyx_t_2;
+      goto __pyx_L8_bool_binop_done;
+    }
+    __pyx_t_2 = (__pyx_v_processor_context->version == 1);
+    __pyx_t_3 = __pyx_t_2;
+    __pyx_L8_bool_binop_done:;
+    if (__pyx_t_3) {
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1204
+ *         # use RapidFuzz C-Api
+ *         if processor_context != NULL and processor_context.version == 1:
+ *             for query in queries:             # <<<<<<<<<<<<<<
+ *                 processor_context.preprocess(query, &proc_str)
+ *                 proc_queries.emplace_back(proc_str)
+ */
+      __Pyx_TraceLine(1204,0,__PYX_ERR(0, 1204, __pyx_L1_error))
+      if (likely(PyList_CheckExact(__pyx_v_queries)) || PyTuple_CheckExact(__pyx_v_queries)) {
+        __pyx_t_4 = __pyx_v_queries; __Pyx_INCREF(__pyx_t_4); __pyx_t_1 = 0;
+        __pyx_t_5 = NULL;
+      } else {
+        __pyx_t_1 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1204, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_4);
+        __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1204, __pyx_L1_error)
+      }
+      for (;;) {
+        if (likely(!__pyx_t_5)) {
+          if (likely(PyList_CheckExact(__pyx_t_4))) {
+            if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_4)) break;
+            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+            __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 1204, __pyx_L1_error)
+            #else
+            __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1204, __pyx_L1_error)
+            __Pyx_GOTREF(__pyx_t_6);
+            #endif
+          } else {
+            if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
+            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+            __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 1204, __pyx_L1_error)
+            #else
+            __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1204, __pyx_L1_error)
+            __Pyx_GOTREF(__pyx_t_6);
+            #endif
+          }
+        } else {
+          __pyx_t_6 = __pyx_t_5(__pyx_t_4);
+          if (unlikely(!__pyx_t_6)) {
+            PyObject* exc_type = PyErr_Occurred();
+            if (exc_type) {
+              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
+              else __PYX_ERR(0, 1204, __pyx_L1_error)
+            }
+            break;
+          }
+          __Pyx_GOTREF(__pyx_t_6);
+        }
+        __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_6);
+        __pyx_t_6 = 0;
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1205
+ *         if processor_context != NULL and processor_context.version == 1:
+ *             for query in queries:
+ *                 processor_context.preprocess(query, &proc_str)             # <<<<<<<<<<<<<<
+ *                 proc_queries.emplace_back(proc_str)
+ * 
+ */
+        __Pyx_TraceLine(1205,0,__PYX_ERR(0, 1205, __pyx_L1_error))
+        __pyx_t_9 = __pyx_v_processor_context->preprocess(__pyx_v_query, (&__pyx_v_proc_str)); if (unlikely(__pyx_t_9 == ((bool)0))) __PYX_ERR(0, 1205, __pyx_L1_error)
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1206
+ *             for query in queries:
+ *                 processor_context.preprocess(query, &proc_str)
+ *                 proc_queries.emplace_back(proc_str)             # <<<<<<<<<<<<<<
+ * 
+ *         # Call Processor through Python
+ */
+        __Pyx_TraceLine(1206,0,__PYX_ERR(0, 1206, __pyx_L1_error))
+        try {
+          __pyx_v_proc_queries.emplace_back(__pyx_v_proc_str);
+        } catch(...) {
+          __Pyx_CppExn2PyErr();
+          __PYX_ERR(0, 1206, __pyx_L1_error)
+        }
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1204
+ *         # use RapidFuzz C-Api
+ *         if processor_context != NULL and processor_context.version == 1:
+ *             for query in queries:             # <<<<<<<<<<<<<<
+ *                 processor_context.preprocess(query, &proc_str)
+ *                 proc_queries.emplace_back(proc_str)
+ */
+        __Pyx_TraceLine(1204,0,__PYX_ERR(0, 1204, __pyx_L1_error))
+      }
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1203
+ * 
+ *         # use RapidFuzz C-Api
+ *         if processor_context != NULL and processor_context.version == 1:             # <<<<<<<<<<<<<<
+ *             for query in queries:
+ *                 processor_context.preprocess(query, &proc_str)
+ */
+      goto __pyx_L7;
+    }
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1210
+ *         # Call Processor through Python
+ *         else:
+ *             for query in queries:             # <<<<<<<<<<<<<<
+ *                 proc_query = processor(query)
+ *                 proc_queries.emplace_back(conv_sequence(proc_query), <PyObject*>proc_query)
+ */
+    __Pyx_TraceLine(1210,0,__PYX_ERR(0, 1210, __pyx_L1_error))
+    /*else*/ {
+      if (likely(PyList_CheckExact(__pyx_v_queries)) || PyTuple_CheckExact(__pyx_v_queries)) {
+        __pyx_t_4 = __pyx_v_queries; __Pyx_INCREF(__pyx_t_4); __pyx_t_1 = 0;
+        __pyx_t_5 = NULL;
+      } else {
+        __pyx_t_1 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_queries); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1210, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_4);
+        __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1210, __pyx_L1_error)
+      }
+      for (;;) {
+        if (likely(!__pyx_t_5)) {
+          if (likely(PyList_CheckExact(__pyx_t_4))) {
+            if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_4)) break;
+            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+            __pyx_t_6 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 1210, __pyx_L1_error)
+            #else
+            __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1210, __pyx_L1_error)
+            __Pyx_GOTREF(__pyx_t_6);
+            #endif
+          } else {
+            if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
+            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+            __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_1); __Pyx_INCREF(__pyx_t_6); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 1210, __pyx_L1_error)
+            #else
+            __pyx_t_6 = PySequence_ITEM(__pyx_t_4, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1210, __pyx_L1_error)
+            __Pyx_GOTREF(__pyx_t_6);
+            #endif
+          }
+        } else {
+          __pyx_t_6 = __pyx_t_5(__pyx_t_4);
+          if (unlikely(!__pyx_t_6)) {
+            PyObject* exc_type = PyErr_Occurred();
+            if (exc_type) {
+              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
+              else __PYX_ERR(0, 1210, __pyx_L1_error)
+            }
+            break;
+          }
+          __Pyx_GOTREF(__pyx_t_6);
+        }
+        __Pyx_XDECREF_SET(__pyx_v_query, __pyx_t_6);
+        __pyx_t_6 = 0;
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1211
+ *         else:
+ *             for query in queries:
+ *                 proc_query = processor(query)             # <<<<<<<<<<<<<<
+ *                 proc_queries.emplace_back(conv_sequence(proc_query), <PyObject*>proc_query)
+ * 
+ */
+        __Pyx_TraceLine(1211,0,__PYX_ERR(0, 1211, __pyx_L1_error))
+        __Pyx_INCREF(__pyx_v_processor);
+        __pyx_t_10 = __pyx_v_processor; __pyx_t_11 = NULL;
+        __pyx_t_12 = 0;
+        if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
+          __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_10);
+          if (likely(__pyx_t_11)) {
+            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
+            __Pyx_INCREF(__pyx_t_11);
+            __Pyx_INCREF(function);
+            __Pyx_DECREF_SET(__pyx_t_10, function);
+            __pyx_t_12 = 1;
+          }
+        }
+        {
+          PyObject *__pyx_callargs[2] = {__pyx_t_11, __pyx_v_query};
+          __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_12, 1+__pyx_t_12);
+          __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
+          if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1211, __pyx_L1_error)
+          __Pyx_GOTREF(__pyx_t_6);
+          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
+        }
+        __Pyx_XDECREF_SET(__pyx_v_proc_query, __pyx_t_6);
+        __pyx_t_6 = 0;
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1212
+ *             for query in queries:
+ *                 proc_query = processor(query)
+ *                 proc_queries.emplace_back(conv_sequence(proc_query), <PyObject*>proc_query)             # <<<<<<<<<<<<<<
+ * 
+ *     return move(proc_queries)
+ */
+        __Pyx_TraceLine(1212,0,__PYX_ERR(0, 1212, __pyx_L1_error))
+        __pyx_t_7 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_proc_query); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1212, __pyx_L1_error)
+        try {
+          __pyx_v_proc_queries.emplace_back(__pyx_t_7, ((PyObject *)__pyx_v_proc_query));
+        } catch(...) {
+          __Pyx_CppExn2PyErr();
+          __PYX_ERR(0, 1212, __pyx_L1_error)
+        }
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1210
+ *         # Call Processor through Python
+ *         else:
+ *             for query in queries:             # <<<<<<<<<<<<<<
+ *                 proc_query = processor(query)
+ *                 proc_queries.emplace_back(conv_sequence(proc_query), <PyObject*>proc_query)
+ */
+        __Pyx_TraceLine(1210,0,__PYX_ERR(0, 1210, __pyx_L1_error))
+      }
+      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    }
+    __pyx_L7:;
+  }
+  __pyx_L3:;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1214
+ *                 proc_queries.emplace_back(conv_sequence(proc_query), <PyObject*>proc_query)
+ * 
+ *     return move(proc_queries)             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline MatrixType dtype_to_type_num_f64(dtype) except MatrixType.UNDEFINED:
+ */
+  __Pyx_TraceLine(1214,0,__PYX_ERR(0, 1214, __pyx_L1_error))
+  __pyx_r = cython_std::move<std::vector<RF_StringWrapper> >(__pyx_v_proc_queries);
+  goto __pyx_L0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1186
+ *     return move(proc_queries)
+ * 
+ * cdef inline vector[RF_StringWrapper] preprocess(queries, processor) except *:             # <<<<<<<<<<<<<<
+ *     cdef vector[RF_StringWrapper] proc_queries
+ *     cdef int64_t queries_len = <int64_t>len(queries)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_10);
+  __Pyx_XDECREF(__pyx_t_11);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.preprocess", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_pretend_to_initialize(&__pyx_r);
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_query);
+  __Pyx_XDECREF(__pyx_v_processor_capsule);
+  __Pyx_XDECREF(__pyx_v_proc_query);
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/process_cpp_impl.pyx":1216
+ *     return move(proc_queries)
+ * 
+ * cdef inline MatrixType dtype_to_type_num_f64(dtype) except MatrixType.UNDEFINED:             # <<<<<<<<<<<<<<
+ *     if dtype is None:
+ *         return MatrixType.FLOAT32
+ */
+
+static CYTHON_INLINE __PYX_ENUM_CLASS_DECL MatrixType __pyx_f_9rapidfuzz_16process_cpp_impl_dtype_to_type_num_f64(PyObject *__pyx_v_dtype) {
+  __PYX_ENUM_CLASS_DECL MatrixType __pyx_r;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  __PYX_ENUM_CLASS_DECL MatrixType __pyx_t_2;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("dtype_to_type_num_f64", 0);
+  __Pyx_TraceCall("dtype_to_type_num_f64", __pyx_f[0], 1216, 0, __PYX_ERR(0, 1216, __pyx_L1_error));
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1217
+ * 
+ * cdef inline MatrixType dtype_to_type_num_f64(dtype) except MatrixType.UNDEFINED:
+ *     if dtype is None:             # <<<<<<<<<<<<<<
+ *         return MatrixType.FLOAT32
+ *     return <MatrixType>dtype
+ */
+  __Pyx_TraceLine(1217,0,__PYX_ERR(0, 1217, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_dtype == Py_None);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1218
+ * cdef inline MatrixType dtype_to_type_num_f64(dtype) except MatrixType.UNDEFINED:
+ *     if dtype is None:
+ *         return MatrixType.FLOAT32             # <<<<<<<<<<<<<<
+ *     return <MatrixType>dtype
+ * 
+ */
+    __Pyx_TraceLine(1218,0,__PYX_ERR(0, 1218, __pyx_L1_error))
+    __pyx_r = MatrixType::FLOAT32;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1217
+ * 
+ * cdef inline MatrixType dtype_to_type_num_f64(dtype) except MatrixType.UNDEFINED:
+ *     if dtype is None:             # <<<<<<<<<<<<<<
+ *         return MatrixType.FLOAT32
+ *     return <MatrixType>dtype
+ */
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1219
+ *     if dtype is None:
+ *         return MatrixType.FLOAT32
+ *     return <MatrixType>dtype             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline MatrixType dtype_to_type_num_i64(dtype) except MatrixType.UNDEFINED:
+ */
+  __Pyx_TraceLine(1219,0,__PYX_ERR(0, 1219, __pyx_L1_error))
+  __pyx_t_2 = (MatrixType)__Pyx_PyInt_As_int(__pyx_v_dtype); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1219, __pyx_L1_error)
+  __pyx_r = ((__PYX_ENUM_CLASS_DECL MatrixType)__pyx_t_2);
+  goto __pyx_L0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1216
+ *     return move(proc_queries)
+ * 
+ * cdef inline MatrixType dtype_to_type_num_f64(dtype) except MatrixType.UNDEFINED:             # <<<<<<<<<<<<<<
+ *     if dtype is None:
+ *         return MatrixType.FLOAT32
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.dtype_to_type_num_f64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = MatrixType::UNDEFINED;
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/process_cpp_impl.pyx":1221
+ *     return <MatrixType>dtype
+ * 
+ * cdef inline MatrixType dtype_to_type_num_i64(dtype) except MatrixType.UNDEFINED:             # <<<<<<<<<<<<<<
+ *     if dtype is None:
+ *         return MatrixType.INT32
+ */
+
+static CYTHON_INLINE __PYX_ENUM_CLASS_DECL MatrixType __pyx_f_9rapidfuzz_16process_cpp_impl_dtype_to_type_num_i64(PyObject *__pyx_v_dtype) {
+  __PYX_ENUM_CLASS_DECL MatrixType __pyx_r;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  __PYX_ENUM_CLASS_DECL MatrixType __pyx_t_2;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("dtype_to_type_num_i64", 0);
+  __Pyx_TraceCall("dtype_to_type_num_i64", __pyx_f[0], 1221, 0, __PYX_ERR(0, 1221, __pyx_L1_error));
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1222
+ * 
+ * cdef inline MatrixType dtype_to_type_num_i64(dtype) except MatrixType.UNDEFINED:
+ *     if dtype is None:             # <<<<<<<<<<<<<<
+ *         return MatrixType.INT32
+ *     return <MatrixType>dtype
+ */
+  __Pyx_TraceLine(1222,0,__PYX_ERR(0, 1222, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_dtype == Py_None);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1223
+ * cdef inline MatrixType dtype_to_type_num_i64(dtype) except MatrixType.UNDEFINED:
+ *     if dtype is None:
+ *         return MatrixType.INT32             # <<<<<<<<<<<<<<
+ *     return <MatrixType>dtype
+ * 
+ */
+    __Pyx_TraceLine(1223,0,__PYX_ERR(0, 1223, __pyx_L1_error))
+    __pyx_r = MatrixType::INT32;
+    goto __pyx_L0;
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1222
+ * 
+ * cdef inline MatrixType dtype_to_type_num_i64(dtype) except MatrixType.UNDEFINED:
+ *     if dtype is None:             # <<<<<<<<<<<<<<
+ *         return MatrixType.INT32
+ *     return <MatrixType>dtype
+ */
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1224
+ *     if dtype is None:
+ *         return MatrixType.INT32
+ *     return <MatrixType>dtype             # <<<<<<<<<<<<<<
+ * 
+ * from cpython cimport Py_buffer
+ */
+  __Pyx_TraceLine(1224,0,__PYX_ERR(0, 1224, __pyx_L1_error))
+  __pyx_t_2 = (MatrixType)__Pyx_PyInt_As_int(__pyx_v_dtype); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1224, __pyx_L1_error)
+  __pyx_r = ((__PYX_ENUM_CLASS_DECL MatrixType)__pyx_t_2);
+  goto __pyx_L0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1221
+ *     return <MatrixType>dtype
+ * 
+ * cdef inline MatrixType dtype_to_type_num_i64(dtype) except MatrixType.UNDEFINED:             # <<<<<<<<<<<<<<
+ *     if dtype is None:
+ *         return MatrixType.INT32
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.dtype_to_type_num_i64", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = MatrixType::UNDEFINED;
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/process_cpp_impl.pyx":1234
+ *     cdef RfMatrix matrix
+ * 
+ *     def __getbuffer__(self, Py_buffer *buffer, int flags):             # <<<<<<<<<<<<<<
+ *         self.shape[0] = self.matrix.m_rows
+ *         self.shape[1] = self.matrix.m_cols
+ */
+
+/* Python wrapper */
+static CYTHON_UNUSED int __pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer, int __pyx_v_flags); /*proto*/
+static CYTHON_UNUSED int __pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_1__getbuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer, int __pyx_v_flags) {
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__getbuffer__ (wrapper)", 0);
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix___getbuffer__(((struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *)__pyx_v_self), ((Py_buffer *)__pyx_v_buffer), ((int)__pyx_v_flags));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static int __pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix___getbuffer__(struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_self, Py_buffer *__pyx_v_buffer, CYTHON_UNUSED int __pyx_v_flags) {
+  int __pyx_r;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  size_t __pyx_t_1;
+  int __pyx_t_2;
+  char const *__pyx_t_3;
+  Py_ssize_t *__pyx_t_4;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  if (unlikely(__pyx_v_buffer == NULL)) {
+    PyErr_SetString(PyExc_BufferError, "PyObject_GetBuffer: view==NULL argument is obsolete");
+    return -1;
+  }
+  __Pyx_RefNannySetupContext("__getbuffer__", 0);
+  __pyx_v_buffer->obj = Py_None; __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(__pyx_v_buffer->obj);
+  __Pyx_TraceCall("__getbuffer__", __pyx_f[0], 1234, 0, __PYX_ERR(0, 1234, __pyx_L1_error));
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1235
+ * 
+ *     def __getbuffer__(self, Py_buffer *buffer, int flags):
+ *         self.shape[0] = self.matrix.m_rows             # <<<<<<<<<<<<<<
+ *         self.shape[1] = self.matrix.m_cols
+ *         self.strides[1] = self.matrix.get_dtype_size()
+ */
+  __Pyx_TraceLine(1235,0,__PYX_ERR(0, 1235, __pyx_L1_error))
+  __pyx_t_1 = __pyx_v_self->matrix.m_rows;
+  (__pyx_v_self->shape[0]) = __pyx_t_1;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1236
+ *     def __getbuffer__(self, Py_buffer *buffer, int flags):
+ *         self.shape[0] = self.matrix.m_rows
+ *         self.shape[1] = self.matrix.m_cols             # <<<<<<<<<<<<<<
+ *         self.strides[1] = self.matrix.get_dtype_size()
+ *         self.strides[0] = self.matrix.m_cols * self.strides[1]
+ */
+  __Pyx_TraceLine(1236,0,__PYX_ERR(0, 1236, __pyx_L1_error))
+  __pyx_t_1 = __pyx_v_self->matrix.m_cols;
+  (__pyx_v_self->shape[1]) = __pyx_t_1;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1237
+ *         self.shape[0] = self.matrix.m_rows
+ *         self.shape[1] = self.matrix.m_cols
+ *         self.strides[1] = self.matrix.get_dtype_size()             # <<<<<<<<<<<<<<
+ *         self.strides[0] = self.matrix.m_cols * self.strides[1]
+ * 
+ */
+  __Pyx_TraceLine(1237,0,__PYX_ERR(0, 1237, __pyx_L1_error))
+  try {
+    __pyx_t_2 = __pyx_v_self->matrix.get_dtype_size();
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 1237, __pyx_L1_error)
+  }
+  (__pyx_v_self->strides[1]) = __pyx_t_2;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1238
+ *         self.shape[1] = self.matrix.m_cols
+ *         self.strides[1] = self.matrix.get_dtype_size()
+ *         self.strides[0] = self.matrix.m_cols * self.strides[1]             # <<<<<<<<<<<<<<
+ * 
+ *         buffer.buf = <char *>self.matrix.m_matrix
+ */
+  __Pyx_TraceLine(1238,0,__PYX_ERR(0, 1238, __pyx_L1_error))
+  (__pyx_v_self->strides[0]) = (__pyx_v_self->matrix.m_cols * (__pyx_v_self->strides[1]));
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1240
+ *         self.strides[0] = self.matrix.m_cols * self.strides[1]
+ * 
+ *         buffer.buf = <char *>self.matrix.m_matrix             # <<<<<<<<<<<<<<
+ *         buffer.format = <char *>self.matrix.get_format()
+ *         buffer.internal = NULL
+ */
+  __Pyx_TraceLine(1240,0,__PYX_ERR(0, 1240, __pyx_L1_error))
+  __pyx_v_buffer->buf = ((char *)__pyx_v_self->matrix.m_matrix);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1241
+ * 
+ *         buffer.buf = <char *>self.matrix.m_matrix
+ *         buffer.format = <char *>self.matrix.get_format()             # <<<<<<<<<<<<<<
+ *         buffer.internal = NULL
+ *         buffer.itemsize = self.matrix.get_dtype_size()
+ */
+  __Pyx_TraceLine(1241,0,__PYX_ERR(0, 1241, __pyx_L1_error))
+  try {
+    __pyx_t_3 = __pyx_v_self->matrix.get_format();
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 1241, __pyx_L1_error)
+  }
+  __pyx_v_buffer->format = ((char *)__pyx_t_3);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1242
+ *         buffer.buf = <char *>self.matrix.m_matrix
+ *         buffer.format = <char *>self.matrix.get_format()
+ *         buffer.internal = NULL             # <<<<<<<<<<<<<<
+ *         buffer.itemsize = self.matrix.get_dtype_size()
+ *         buffer.len = self.matrix.m_rows * self.matrix.m_cols * self.matrix.get_dtype_size()
+ */
+  __Pyx_TraceLine(1242,0,__PYX_ERR(0, 1242, __pyx_L1_error))
+  __pyx_v_buffer->internal = NULL;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1243
+ *         buffer.format = <char *>self.matrix.get_format()
+ *         buffer.internal = NULL
+ *         buffer.itemsize = self.matrix.get_dtype_size()             # <<<<<<<<<<<<<<
+ *         buffer.len = self.matrix.m_rows * self.matrix.m_cols * self.matrix.get_dtype_size()
+ *         buffer.ndim = 2
+ */
+  __Pyx_TraceLine(1243,0,__PYX_ERR(0, 1243, __pyx_L1_error))
+  try {
+    __pyx_t_2 = __pyx_v_self->matrix.get_dtype_size();
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 1243, __pyx_L1_error)
+  }
+  __pyx_v_buffer->itemsize = __pyx_t_2;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1244
+ *         buffer.internal = NULL
+ *         buffer.itemsize = self.matrix.get_dtype_size()
+ *         buffer.len = self.matrix.m_rows * self.matrix.m_cols * self.matrix.get_dtype_size()             # <<<<<<<<<<<<<<
+ *         buffer.ndim = 2
+ *         buffer.obj = self
+ */
+  __Pyx_TraceLine(1244,0,__PYX_ERR(0, 1244, __pyx_L1_error))
+  try {
+    __pyx_t_2 = __pyx_v_self->matrix.get_dtype_size();
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 1244, __pyx_L1_error)
+  }
+  __pyx_v_buffer->len = ((__pyx_v_self->matrix.m_rows * __pyx_v_self->matrix.m_cols) * __pyx_t_2);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1245
+ *         buffer.itemsize = self.matrix.get_dtype_size()
+ *         buffer.len = self.matrix.m_rows * self.matrix.m_cols * self.matrix.get_dtype_size()
+ *         buffer.ndim = 2             # <<<<<<<<<<<<<<
+ *         buffer.obj = self
+ *         buffer.readonly = 0
+ */
+  __Pyx_TraceLine(1245,0,__PYX_ERR(0, 1245, __pyx_L1_error))
+  __pyx_v_buffer->ndim = 2;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1246
+ *         buffer.len = self.matrix.m_rows * self.matrix.m_cols * self.matrix.get_dtype_size()
+ *         buffer.ndim = 2
+ *         buffer.obj = self             # <<<<<<<<<<<<<<
+ *         buffer.readonly = 0
+ *         buffer.shape = self.shape
+ */
+  __Pyx_TraceLine(1246,0,__PYX_ERR(0, 1246, __pyx_L1_error))
+  __Pyx_INCREF((PyObject *)__pyx_v_self);
+  __Pyx_GIVEREF((PyObject *)__pyx_v_self);
+  __Pyx_GOTREF(__pyx_v_buffer->obj);
+  __Pyx_DECREF(__pyx_v_buffer->obj);
+  __pyx_v_buffer->obj = ((PyObject *)__pyx_v_self);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1247
+ *         buffer.ndim = 2
+ *         buffer.obj = self
+ *         buffer.readonly = 0             # <<<<<<<<<<<<<<
+ *         buffer.shape = self.shape
+ *         buffer.strides = self.strides
+ */
+  __Pyx_TraceLine(1247,0,__PYX_ERR(0, 1247, __pyx_L1_error))
+  __pyx_v_buffer->readonly = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1248
+ *         buffer.obj = self
+ *         buffer.readonly = 0
+ *         buffer.shape = self.shape             # <<<<<<<<<<<<<<
+ *         buffer.strides = self.strides
+ *         buffer.suboffsets = NULL
+ */
+  __Pyx_TraceLine(1248,0,__PYX_ERR(0, 1248, __pyx_L1_error))
+  __pyx_t_4 = __pyx_v_self->shape;
+  __pyx_v_buffer->shape = __pyx_t_4;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1249
+ *         buffer.readonly = 0
+ *         buffer.shape = self.shape
+ *         buffer.strides = self.strides             # <<<<<<<<<<<<<<
+ *         buffer.suboffsets = NULL
+ * 
+ */
+  __Pyx_TraceLine(1249,0,__PYX_ERR(0, 1249, __pyx_L1_error))
+  __pyx_t_4 = __pyx_v_self->strides;
+  __pyx_v_buffer->strides = __pyx_t_4;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1250
+ *         buffer.shape = self.shape
+ *         buffer.strides = self.strides
+ *         buffer.suboffsets = NULL             # <<<<<<<<<<<<<<
+ * 
+ *     def __releasebuffer__(self, Py_buffer *buffer):
+ */
+  __Pyx_TraceLine(1250,0,__PYX_ERR(0, 1250, __pyx_L1_error))
+  __pyx_v_buffer->suboffsets = NULL;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1234
+ *     cdef RfMatrix matrix
+ * 
+ *     def __getbuffer__(self, Py_buffer *buffer, int flags):             # <<<<<<<<<<<<<<
+ *         self.shape[0] = self.matrix.m_rows
+ *         self.shape[1] = self.matrix.m_cols
+ */
+
+  /* function exit code */
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.Matrix.__getbuffer__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1;
+  if (__pyx_v_buffer->obj != NULL) {
+    __Pyx_GOTREF(__pyx_v_buffer->obj);
+    __Pyx_DECREF(__pyx_v_buffer->obj); __pyx_v_buffer->obj = 0;
+  }
+  goto __pyx_L2;
+  __pyx_L0:;
+  if (__pyx_v_buffer->obj == Py_None) {
+    __Pyx_GOTREF(__pyx_v_buffer->obj);
+    __Pyx_DECREF(__pyx_v_buffer->obj); __pyx_v_buffer->obj = 0;
+  }
+  __pyx_L2:;
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/process_cpp_impl.pyx":1252
+ *         buffer.suboffsets = NULL
+ * 
+ *     def __releasebuffer__(self, Py_buffer *buffer):             # <<<<<<<<<<<<<<
+ *         pass
+ * 
+ */
+
+/* Python wrapper */
+static CYTHON_UNUSED void __pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_3__releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer); /*proto*/
+static CYTHON_UNUSED void __pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_3__releasebuffer__(PyObject *__pyx_v_self, Py_buffer *__pyx_v_buffer) {
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__releasebuffer__ (wrapper)", 0);
+  __pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix_2__releasebuffer__(((struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *)__pyx_v_self), ((Py_buffer *)__pyx_v_buffer));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+}
+
+static void __pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix_2__releasebuffer__(CYTHON_UNUSED struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_self, CYTHON_UNUSED Py_buffer *__pyx_v_buffer) {
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__releasebuffer__", 0);
+  __Pyx_TraceCall("__releasebuffer__", __pyx_f[0], 1252, 0, __PYX_ERR(0, 1252, __pyx_L1_error));
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_WriteUnraisable("rapidfuzz.process_cpp_impl.Matrix.__releasebuffer__", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
+  __pyx_L0:;
+  __Pyx_TraceReturn(Py_None, 0);
+  __Pyx_RefNannyFinishContext();
+}
+
+/* "(tree fragment)":1
+ * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ * def __setstate_cython__(self, __pyx_state):
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_5__reduce_cython__(PyObject *__pyx_v_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_6Matrix_5__reduce_cython__ = {"__reduce_cython__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_5__reduce_cython__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_5__reduce_cython__(PyObject *__pyx_v_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
+  if (unlikely(__pyx_nargs > 0)) {
+    __Pyx_RaiseArgtupleInvalid("__reduce_cython__", 1, 0, 0, __pyx_nargs); return NULL;}
+  if (unlikely(__pyx_kwds) && __Pyx_NumKwargs_FASTCALL(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__reduce_cython__", 0))) return NULL;
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix_4__reduce_cython__(((struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *)__pyx_v_self));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix_4__reduce_cython__(CYTHON_UNUSED struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__16)
+  __Pyx_RefNannySetupContext("__reduce_cython__", 0);
+  __Pyx_TraceCall("__reduce_cython__", __pyx_f[1], 1, 0, __PYX_ERR(1, 1, __pyx_L1_error));
+
+  /* "(tree fragment)":2
+ * def __reduce_cython__(self):
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"             # <<<<<<<<<<<<<<
+ * def __setstate_cython__(self, __pyx_state):
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ */
+  __Pyx_TraceLine(2,0,__PYX_ERR(1, 2, __pyx_L1_error))
+  __Pyx_Raise(__pyx_builtin_TypeError, __pyx_kp_s_self_matrix_cannot_be_converted, 0, 0);
+  __PYX_ERR(1, 2, __pyx_L1_error)
+
+  /* "(tree fragment)":1
+ * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ * def __setstate_cython__(self, __pyx_state):
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.Matrix.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "(tree fragment)":3
+ * def __reduce_cython__(self):
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_7__setstate_cython__(PyObject *__pyx_v_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_6Matrix_7__setstate_cython__ = {"__setstate_cython__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_7__setstate_cython__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_7__setstate_cython__(PyObject *__pyx_v_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  CYTHON_UNUSED PyObject *__pyx_v___pyx_state = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_state,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_state,0};
+    #endif
+    PyObject* values[1] = {0};
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_pyx_state)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 3, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__setstate_cython__") < 0)) __PYX_ERR(1, 3, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 1)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+    }
+    __pyx_v___pyx_state = values[0];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("__setstate_cython__", 1, 1, 1, __pyx_nargs); __PYX_ERR(1, 3, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.Matrix.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix_6__setstate_cython__(((struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *)__pyx_v_self), __pyx_v___pyx_state);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_6Matrix_6__setstate_cython__(CYTHON_UNUSED struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v___pyx_state) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__17)
+  __Pyx_RefNannySetupContext("__setstate_cython__", 0);
+  __Pyx_TraceCall("__setstate_cython__", __pyx_f[1], 3, 0, __PYX_ERR(1, 3, __pyx_L1_error));
+
+  /* "(tree fragment)":4
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ * def __setstate_cython__(self, __pyx_state):
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"             # <<<<<<<<<<<<<<
+ */
+  __Pyx_TraceLine(4,0,__PYX_ERR(1, 4, __pyx_L1_error))
+  __Pyx_Raise(__pyx_builtin_TypeError, __pyx_kp_s_self_matrix_cannot_be_converted, 0, 0);
+  __PYX_ERR(1, 4, __pyx_L1_error)
+
+  /* "(tree fragment)":3
+ * def __reduce_cython__(self):
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.Matrix.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/process_cpp_impl.pyx":1255
+ *         pass
+ * 
+ * cdef cdist_two_lists(queries, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
+ *     proc_queries = preprocess(queries, processor)
+ *     proc_choices = preprocess(choices, processor)
+ */
+
+static PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_cdist_two_lists(PyObject *__pyx_v_queries, PyObject *__pyx_v_choices, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_dtype, int __pyx_v_c_workers, RF_Kwargs const *__pyx_v_kwargs) {
+  std::vector<RF_StringWrapper>  __pyx_v_proc_queries;
+  std::vector<RF_StringWrapper>  __pyx_v_proc_choices;
+  uint32_t __pyx_v_flags;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_matrix = 0;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  std::vector<RF_StringWrapper>  __pyx_t_1;
+  uint32_t __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  __PYX_ENUM_CLASS_DECL MatrixType __pyx_t_5;
+  double __pyx_t_6;
+  Matrix __pyx_t_7;
+  int64_t __pyx_t_8;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("cdist_two_lists", 0);
+  __Pyx_TraceCall("cdist_two_lists", __pyx_f[0], 1255, 0, __PYX_ERR(0, 1255, __pyx_L1_error));
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1256
+ * 
+ * cdef cdist_two_lists(queries, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):
+ *     proc_queries = preprocess(queries, processor)             # <<<<<<<<<<<<<<
+ *     proc_choices = preprocess(choices, processor)
+ *     flags = dereference(scorer_flags).flags
+ */
+  __Pyx_TraceLine(1256,0,__PYX_ERR(0, 1256, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess(__pyx_v_queries, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1256, __pyx_L1_error)
+  __pyx_v_proc_queries = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_1);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1257
+ * cdef cdist_two_lists(queries, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):
+ *     proc_queries = preprocess(queries, processor)
+ *     proc_choices = preprocess(choices, processor)             # <<<<<<<<<<<<<<
+ *     flags = dereference(scorer_flags).flags
+ *     cdef Matrix matrix = Matrix()
+ */
+  __Pyx_TraceLine(1257,0,__PYX_ERR(0, 1257, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess(__pyx_v_choices, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1257, __pyx_L1_error)
+  __pyx_v_proc_choices = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_1);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1258
+ *     proc_queries = preprocess(queries, processor)
+ *     proc_choices = preprocess(choices, processor)
+ *     flags = dereference(scorer_flags).flags             # <<<<<<<<<<<<<<
+ *     cdef Matrix matrix = Matrix()
+ * 
+ */
+  __Pyx_TraceLine(1258,0,__PYX_ERR(0, 1258, __pyx_L1_error))
+  __pyx_t_2 = (*__pyx_v_scorer_flags).flags;
+  __pyx_v_flags = __pyx_t_2;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1259
+ *     proc_choices = preprocess(choices, processor)
+ *     flags = dereference(scorer_flags).flags
+ *     cdef Matrix matrix = Matrix()             # <<<<<<<<<<<<<<
+ * 
+ *     if flags & RF_SCORER_FLAG_RESULT_F64:
+ */
+  __Pyx_TraceLine(1259,0,__PYX_ERR(0, 1259, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_CallNoArg(((PyObject *)__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1259, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_v_matrix = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *)__pyx_t_3);
+  __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1261
+ *     cdef Matrix matrix = Matrix()
+ * 
+ *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
+ *         matrix.matrix = cdist_two_lists_impl(
+ *             kwargs, scorer, proc_queries, proc_choices,
+ */
+  __Pyx_TraceLine(1261,0,__PYX_ERR(0, 1261, __pyx_L1_error))
+  __pyx_t_4 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_F64) != 0);
+  if (__pyx_t_4) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1264
+ *         matrix.matrix = cdist_two_lists_impl(
+ *             kwargs, scorer, proc_queries, proc_choices,
+ *             dtype_to_type_num_f64(dtype),             # <<<<<<<<<<<<<<
+ *             c_workers,
+ *             get_score_cutoff_f64(score_cutoff, scorer_flags))
+ */
+    __Pyx_TraceLine(1264,0,__PYX_ERR(0, 1264, __pyx_L1_error))
+    __pyx_t_5 = __pyx_f_9rapidfuzz_16process_cpp_impl_dtype_to_type_num_f64(__pyx_v_dtype); if (unlikely(__pyx_t_5 == ((__PYX_ENUM_CLASS_DECL MatrixType)MatrixType::UNDEFINED))) __PYX_ERR(0, 1264, __pyx_L1_error)
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1266
+ *             dtype_to_type_num_f64(dtype),
+ *             c_workers,
+ *             get_score_cutoff_f64(score_cutoff, scorer_flags))             # <<<<<<<<<<<<<<
+ * 
+ *     elif flags & RF_SCORER_FLAG_RESULT_I64:
+ */
+    __Pyx_TraceLine(1266,0,__PYX_ERR(0, 1266, __pyx_L1_error))
+    __pyx_t_6 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_6 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1266, __pyx_L1_error)
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1262
+ * 
+ *     if flags & RF_SCORER_FLAG_RESULT_F64:
+ *         matrix.matrix = cdist_two_lists_impl(             # <<<<<<<<<<<<<<
+ *             kwargs, scorer, proc_queries, proc_choices,
+ *             dtype_to_type_num_f64(dtype),
+ */
+    __Pyx_TraceLine(1262,0,__PYX_ERR(0, 1262, __pyx_L1_error))
+    try {
+      __pyx_t_7 = cdist_two_lists_impl<double>(__pyx_v_kwargs, __pyx_v_scorer, __pyx_v_proc_queries, __pyx_v_proc_choices, __pyx_t_5, __pyx_v_c_workers, __pyx_t_6);
+    } catch(...) {
+      __Pyx_CppExn2PyErr();
+      __PYX_ERR(0, 1262, __pyx_L1_error)
+    }
+    __pyx_v_matrix->matrix = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_7);
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1261
+ *     cdef Matrix matrix = Matrix()
+ * 
+ *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
+ *         matrix.matrix = cdist_two_lists_impl(
+ *             kwargs, scorer, proc_queries, proc_choices,
+ */
+    goto __pyx_L3;
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1268
+ *             get_score_cutoff_f64(score_cutoff, scorer_flags))
+ * 
+ *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
+ *         matrix.matrix = cdist_two_lists_impl(
+ *             kwargs, scorer, proc_queries, proc_choices,
+ */
+  __Pyx_TraceLine(1268,0,__PYX_ERR(0, 1268, __pyx_L1_error))
+  __pyx_t_4 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_I64) != 0);
+  if (likely(__pyx_t_4)) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1271
+ *         matrix.matrix = cdist_two_lists_impl(
+ *             kwargs, scorer, proc_queries, proc_choices,
+ *             dtype_to_type_num_i64(dtype),             # <<<<<<<<<<<<<<
+ *             c_workers,
+ *             get_score_cutoff_i64(score_cutoff, scorer_flags))
+ */
+    __Pyx_TraceLine(1271,0,__PYX_ERR(0, 1271, __pyx_L1_error))
+    __pyx_t_5 = __pyx_f_9rapidfuzz_16process_cpp_impl_dtype_to_type_num_i64(__pyx_v_dtype); if (unlikely(__pyx_t_5 == ((__PYX_ENUM_CLASS_DECL MatrixType)MatrixType::UNDEFINED))) __PYX_ERR(0, 1271, __pyx_L1_error)
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1273
+ *             dtype_to_type_num_i64(dtype),
+ *             c_workers,
+ *             get_score_cutoff_i64(score_cutoff, scorer_flags))             # <<<<<<<<<<<<<<
+ *     else:
+ *         raise ValueError("scorer does not properly use the C-API")
+ */
+    __Pyx_TraceLine(1273,0,__PYX_ERR(0, 1273, __pyx_L1_error))
+    __pyx_t_8 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_8 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1273, __pyx_L1_error)
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1269
+ * 
+ *     elif flags & RF_SCORER_FLAG_RESULT_I64:
+ *         matrix.matrix = cdist_two_lists_impl(             # <<<<<<<<<<<<<<
+ *             kwargs, scorer, proc_queries, proc_choices,
+ *             dtype_to_type_num_i64(dtype),
+ */
+    __Pyx_TraceLine(1269,0,__PYX_ERR(0, 1269, __pyx_L1_error))
+    try {
+      __pyx_t_7 = cdist_two_lists_impl<int64_t>(__pyx_v_kwargs, __pyx_v_scorer, __pyx_v_proc_queries, __pyx_v_proc_choices, __pyx_t_5, __pyx_v_c_workers, __pyx_t_8);
+    } catch(...) {
+      __Pyx_CppExn2PyErr();
+      __PYX_ERR(0, 1269, __pyx_L1_error)
+    }
+    __pyx_v_matrix->matrix = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_7);
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1268
+ *             get_score_cutoff_f64(score_cutoff, scorer_flags))
+ * 
+ *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
+ *         matrix.matrix = cdist_two_lists_impl(
+ *             kwargs, scorer, proc_queries, proc_choices,
+ */
+    goto __pyx_L3;
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1275
+ *             get_score_cutoff_i64(score_cutoff, scorer_flags))
+ *     else:
+ *         raise ValueError("scorer does not properly use the C-API")             # <<<<<<<<<<<<<<
+ * 
+ *     return matrix
+ */
+  __Pyx_TraceLine(1275,0,__PYX_ERR(0, 1275, __pyx_L1_error))
+  /*else*/ {
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1275, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __PYX_ERR(0, 1275, __pyx_L1_error)
+  }
+  __pyx_L3:;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1277
+ *         raise ValueError("scorer does not properly use the C-API")
+ * 
+ *     return matrix             # <<<<<<<<<<<<<<
+ * 
+ * cdef Matrix cdist_single_list(queries, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):
+ */
+  __Pyx_TraceLine(1277,0,__PYX_ERR(0, 1277, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF((PyObject *)__pyx_v_matrix);
+  __pyx_r = ((PyObject *)__pyx_v_matrix);
+  goto __pyx_L0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1255
+ *         pass
+ * 
+ * cdef cdist_two_lists(queries, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
+ *     proc_queries = preprocess(queries, processor)
+ *     proc_choices = preprocess(choices, processor)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.cdist_two_lists", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_matrix);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/process_cpp_impl.pyx":1279
+ *     return matrix
+ * 
+ * cdef Matrix cdist_single_list(queries, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
+ *     proc_queries = preprocess(queries, processor)
+ *     flags = dereference(scorer_flags).flags
+ */
+
+static struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_f_9rapidfuzz_16process_cpp_impl_cdist_single_list(PyObject *__pyx_v_queries, RF_Scorer *__pyx_v_scorer, RF_ScorerFlags const *__pyx_v_scorer_flags, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_dtype, int __pyx_v_c_workers, RF_Kwargs const *__pyx_v_kwargs) {
+  std::vector<RF_StringWrapper>  __pyx_v_proc_queries;
+  uint32_t __pyx_v_flags;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_matrix = 0;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  std::vector<RF_StringWrapper>  __pyx_t_1;
+  uint32_t __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  __PYX_ENUM_CLASS_DECL MatrixType __pyx_t_5;
+  double __pyx_t_6;
+  Matrix __pyx_t_7;
+  int64_t __pyx_t_8;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("cdist_single_list", 0);
+  __Pyx_TraceCall("cdist_single_list", __pyx_f[0], 1279, 0, __PYX_ERR(0, 1279, __pyx_L1_error));
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1280
+ * 
+ * cdef Matrix cdist_single_list(queries, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):
+ *     proc_queries = preprocess(queries, processor)             # <<<<<<<<<<<<<<
+ *     flags = dereference(scorer_flags).flags
+ *     cdef Matrix matrix = Matrix()
+ */
+  __Pyx_TraceLine(1280,0,__PYX_ERR(0, 1280, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess(__pyx_v_queries, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1280, __pyx_L1_error)
+  __pyx_v_proc_queries = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_1);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1281
+ * cdef Matrix cdist_single_list(queries, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):
+ *     proc_queries = preprocess(queries, processor)
+ *     flags = dereference(scorer_flags).flags             # <<<<<<<<<<<<<<
+ *     cdef Matrix matrix = Matrix()
+ * 
+ */
+  __Pyx_TraceLine(1281,0,__PYX_ERR(0, 1281, __pyx_L1_error))
+  __pyx_t_2 = (*__pyx_v_scorer_flags).flags;
+  __pyx_v_flags = __pyx_t_2;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1282
+ *     proc_queries = preprocess(queries, processor)
+ *     flags = dereference(scorer_flags).flags
+ *     cdef Matrix matrix = Matrix()             # <<<<<<<<<<<<<<
+ * 
+ *     if flags & RF_SCORER_FLAG_RESULT_F64:
+ */
+  __Pyx_TraceLine(1282,0,__PYX_ERR(0, 1282, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_PyObject_CallNoArg(((PyObject *)__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1282, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_v_matrix = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *)__pyx_t_3);
+  __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1284
+ *     cdef Matrix matrix = Matrix()
+ * 
+ *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
+ *         matrix.matrix = cdist_single_list_impl(
+ *             kwargs, scorer, proc_queries,
+ */
+  __Pyx_TraceLine(1284,0,__PYX_ERR(0, 1284, __pyx_L1_error))
+  __pyx_t_4 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_F64) != 0);
+  if (__pyx_t_4) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1287
+ *         matrix.matrix = cdist_single_list_impl(
+ *             kwargs, scorer, proc_queries,
+ *             dtype_to_type_num_f64(dtype),             # <<<<<<<<<<<<<<
+ *             c_workers,
+ *             get_score_cutoff_f64(score_cutoff, scorer_flags))
+ */
+    __Pyx_TraceLine(1287,0,__PYX_ERR(0, 1287, __pyx_L1_error))
+    __pyx_t_5 = __pyx_f_9rapidfuzz_16process_cpp_impl_dtype_to_type_num_f64(__pyx_v_dtype); if (unlikely(__pyx_t_5 == ((__PYX_ENUM_CLASS_DECL MatrixType)MatrixType::UNDEFINED))) __PYX_ERR(0, 1287, __pyx_L1_error)
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1289
+ *             dtype_to_type_num_f64(dtype),
+ *             c_workers,
+ *             get_score_cutoff_f64(score_cutoff, scorer_flags))             # <<<<<<<<<<<<<<
+ * 
+ *     elif flags & RF_SCORER_FLAG_RESULT_I64:
+ */
+    __Pyx_TraceLine(1289,0,__PYX_ERR(0, 1289, __pyx_L1_error))
+    __pyx_t_6 = __pyx_f_10cpp_common_get_score_cutoff_f64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_6 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1289, __pyx_L1_error)
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1285
+ * 
+ *     if flags & RF_SCORER_FLAG_RESULT_F64:
+ *         matrix.matrix = cdist_single_list_impl(             # <<<<<<<<<<<<<<
+ *             kwargs, scorer, proc_queries,
+ *             dtype_to_type_num_f64(dtype),
+ */
+    __Pyx_TraceLine(1285,0,__PYX_ERR(0, 1285, __pyx_L1_error))
+    try {
+      __pyx_t_7 = cdist_single_list_impl<double>(__pyx_v_kwargs, __pyx_v_scorer, __pyx_v_proc_queries, __pyx_t_5, __pyx_v_c_workers, __pyx_t_6);
+    } catch(...) {
+      __Pyx_CppExn2PyErr();
+      __PYX_ERR(0, 1285, __pyx_L1_error)
+    }
+    __pyx_v_matrix->matrix = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_7);
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1284
+ *     cdef Matrix matrix = Matrix()
+ * 
+ *     if flags & RF_SCORER_FLAG_RESULT_F64:             # <<<<<<<<<<<<<<
+ *         matrix.matrix = cdist_single_list_impl(
+ *             kwargs, scorer, proc_queries,
+ */
+    goto __pyx_L3;
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1291
+ *             get_score_cutoff_f64(score_cutoff, scorer_flags))
+ * 
+ *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
+ *         matrix.matrix = cdist_single_list_impl(
+ *             kwargs, scorer, proc_queries,
+ */
+  __Pyx_TraceLine(1291,0,__PYX_ERR(0, 1291, __pyx_L1_error))
+  __pyx_t_4 = ((__pyx_v_flags & RF_SCORER_FLAG_RESULT_I64) != 0);
+  if (likely(__pyx_t_4)) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1294
+ *         matrix.matrix = cdist_single_list_impl(
+ *             kwargs, scorer, proc_queries,
+ *             dtype_to_type_num_i64(dtype),             # <<<<<<<<<<<<<<
+ *             c_workers,
+ *             get_score_cutoff_i64(score_cutoff, scorer_flags))
+ */
+    __Pyx_TraceLine(1294,0,__PYX_ERR(0, 1294, __pyx_L1_error))
+    __pyx_t_5 = __pyx_f_9rapidfuzz_16process_cpp_impl_dtype_to_type_num_i64(__pyx_v_dtype); if (unlikely(__pyx_t_5 == ((__PYX_ENUM_CLASS_DECL MatrixType)MatrixType::UNDEFINED))) __PYX_ERR(0, 1294, __pyx_L1_error)
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1296
+ *             dtype_to_type_num_i64(dtype),
+ *             c_workers,
+ *             get_score_cutoff_i64(score_cutoff, scorer_flags))             # <<<<<<<<<<<<<<
+ *     else:
+ *         raise ValueError("scorer does not properly use the C-API")
+ */
+    __Pyx_TraceLine(1296,0,__PYX_ERR(0, 1296, __pyx_L1_error))
+    __pyx_t_8 = __pyx_f_10cpp_common_get_score_cutoff_i64(__pyx_v_score_cutoff, __pyx_v_scorer_flags); if (unlikely(__pyx_t_8 == ((int64_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1296, __pyx_L1_error)
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1292
+ * 
+ *     elif flags & RF_SCORER_FLAG_RESULT_I64:
+ *         matrix.matrix = cdist_single_list_impl(             # <<<<<<<<<<<<<<
+ *             kwargs, scorer, proc_queries,
+ *             dtype_to_type_num_i64(dtype),
+ */
+    __Pyx_TraceLine(1292,0,__PYX_ERR(0, 1292, __pyx_L1_error))
+    try {
+      __pyx_t_7 = cdist_single_list_impl<int64_t>(__pyx_v_kwargs, __pyx_v_scorer, __pyx_v_proc_queries, __pyx_t_5, __pyx_v_c_workers, __pyx_t_8);
+    } catch(...) {
+      __Pyx_CppExn2PyErr();
+      __PYX_ERR(0, 1292, __pyx_L1_error)
+    }
+    __pyx_v_matrix->matrix = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_7);
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1291
+ *             get_score_cutoff_f64(score_cutoff, scorer_flags))
+ * 
+ *     elif flags & RF_SCORER_FLAG_RESULT_I64:             # <<<<<<<<<<<<<<
+ *         matrix.matrix = cdist_single_list_impl(
+ *             kwargs, scorer, proc_queries,
+ */
+    goto __pyx_L3;
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1298
+ *             get_score_cutoff_i64(score_cutoff, scorer_flags))
+ *     else:
+ *         raise ValueError("scorer does not properly use the C-API")             # <<<<<<<<<<<<<<
+ * 
+ *     return matrix
+ */
+  __Pyx_TraceLine(1298,0,__PYX_ERR(0, 1298, __pyx_L1_error))
+  /*else*/ {
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1298, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __PYX_ERR(0, 1298, __pyx_L1_error)
+  }
+  __pyx_L3:;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1300
+ *         raise ValueError("scorer does not properly use the C-API")
+ * 
+ *     return matrix             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(1300,0,__PYX_ERR(0, 1300, __pyx_L1_error))
+  __Pyx_XDECREF((PyObject *)__pyx_r);
+  __Pyx_INCREF((PyObject *)__pyx_v_matrix);
+  __pyx_r = __pyx_v_matrix;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1279
+ *     return matrix
+ * 
+ * cdef Matrix cdist_single_list(queries, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
+ *     proc_queries = preprocess(queries, processor)
+ *     flags = dereference(scorer_flags).flags
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.cdist_single_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_matrix);
+  __Pyx_XGIVEREF((PyObject *)__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/process_cpp_impl.pyx":1305
+ * @cython.boundscheck(False)
+ * @cython.wraparound(False)
+ * cdef cdist_py(queries, choices, scorer, processor, score_cutoff, dtype, workers, dict kwargs):             # <<<<<<<<<<<<<<
+ *     proc_queries = preprocess_py(queries, processor)
+ *     proc_choices = preprocess_py(choices, processor)
+ */
+
+static PyObject *__pyx_f_9rapidfuzz_16process_cpp_impl_cdist_py(PyObject *__pyx_v_queries, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_dtype, CYTHON_UNUSED PyObject *__pyx_v_workers, PyObject *__pyx_v_kwargs) {
+  std::vector<PyObjectWrapper>  __pyx_v_proc_queries;
+  std::vector<PyObjectWrapper>  __pyx_v_proc_choices;
+  double __pyx_v_score;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *__pyx_v_matrix = 0;
+  PyObject *__pyx_v_c_dtype = NULL;
+  std::vector<PyObjectWrapper> ::size_type __pyx_v_i;
+  std::vector<PyObjectWrapper> ::size_type __pyx_v_j;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  std::vector<PyObjectWrapper>  __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  __PYX_ENUM_CLASS_DECL MatrixType __pyx_t_3;
+  Matrix __pyx_t_4;
+  std::vector<PyObjectWrapper> ::size_type __pyx_t_5;
+  std::vector<PyObjectWrapper> ::size_type __pyx_t_6;
+  std::vector<PyObjectWrapper> ::size_type __pyx_t_7;
+  std::vector<PyObjectWrapper> ::size_type __pyx_t_8;
+  std::vector<PyObjectWrapper> ::size_type __pyx_t_9;
+  std::vector<PyObjectWrapper> ::size_type __pyx_t_10;
+  PyObject *__pyx_t_11;
+  PyObject *__pyx_t_12;
+  PyObject *__pyx_t_13 = NULL;
+  PyObject *__pyx_t_14 = NULL;
+  double __pyx_t_15;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("cdist_py", 0);
+  __Pyx_TraceCall("cdist_py", __pyx_f[0], 1305, 0, __PYX_ERR(0, 1305, __pyx_L1_error));
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1306
+ * @cython.wraparound(False)
+ * cdef cdist_py(queries, choices, scorer, processor, score_cutoff, dtype, workers, dict kwargs):
+ *     proc_queries = preprocess_py(queries, processor)             # <<<<<<<<<<<<<<
+ *     proc_choices = preprocess_py(choices, processor)
+ *     cdef double score
+ */
+  __Pyx_TraceLine(1306,0,__PYX_ERR(0, 1306, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_py(__pyx_v_queries, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1306, __pyx_L1_error)
+  __pyx_v_proc_queries = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_1);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1307
+ * cdef cdist_py(queries, choices, scorer, processor, score_cutoff, dtype, workers, dict kwargs):
+ *     proc_queries = preprocess_py(queries, processor)
+ *     proc_choices = preprocess_py(choices, processor)             # <<<<<<<<<<<<<<
+ *     cdef double score
+ *     cdef Matrix matrix = Matrix()
+ */
+  __Pyx_TraceLine(1307,0,__PYX_ERR(0, 1307, __pyx_L1_error))
+  __pyx_t_1 = __pyx_f_9rapidfuzz_16process_cpp_impl_preprocess_py(__pyx_v_choices, __pyx_v_processor); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1307, __pyx_L1_error)
+  __pyx_v_proc_choices = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_1);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1309
+ *     proc_choices = preprocess_py(choices, processor)
+ *     cdef double score
+ *     cdef Matrix matrix = Matrix()             # <<<<<<<<<<<<<<
+ *     c_dtype = dtype_to_type_num_f64(dtype)
+ *     matrix.matrix = RfMatrix(c_dtype, proc_queries.size(), proc_choices.size())
+ */
+  __Pyx_TraceLine(1309,0,__PYX_ERR(0, 1309, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyObject_CallNoArg(((PyObject *)__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1309, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_v_matrix = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *)__pyx_t_2);
+  __pyx_t_2 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1310
+ *     cdef double score
+ *     cdef Matrix matrix = Matrix()
+ *     c_dtype = dtype_to_type_num_f64(dtype)             # <<<<<<<<<<<<<<
+ *     matrix.matrix = RfMatrix(c_dtype, proc_queries.size(), proc_choices.size())
+ * 
+ */
+  __Pyx_TraceLine(1310,0,__PYX_ERR(0, 1310, __pyx_L1_error))
+  __pyx_t_3 = __pyx_f_9rapidfuzz_16process_cpp_impl_dtype_to_type_num_f64(__pyx_v_dtype); if (unlikely(__pyx_t_3 == ((__PYX_ENUM_CLASS_DECL MatrixType)MatrixType::UNDEFINED))) __PYX_ERR(0, 1310, __pyx_L1_error)
+  __pyx_t_2 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1310, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_v_c_dtype = __pyx_t_2;
+  __pyx_t_2 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1311
+ *     cdef Matrix matrix = Matrix()
+ *     c_dtype = dtype_to_type_num_f64(dtype)
+ *     matrix.matrix = RfMatrix(c_dtype, proc_queries.size(), proc_choices.size())             # <<<<<<<<<<<<<<
+ * 
+ *     kwargs["processor"] = None
+ */
+  __Pyx_TraceLine(1311,0,__PYX_ERR(0, 1311, __pyx_L1_error))
+  __pyx_t_3 = (MatrixType)__Pyx_PyInt_As_int(__pyx_v_c_dtype); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1311, __pyx_L1_error)
+  try {
+    __pyx_t_4 = Matrix(__pyx_t_3, __pyx_v_proc_queries.size(), __pyx_v_proc_choices.size());
+  } catch(...) {
+    __Pyx_CppExn2PyErr();
+    __PYX_ERR(0, 1311, __pyx_L1_error)
+  }
+  __pyx_v_matrix->matrix = __PYX_STD_MOVE_IF_SUPPORTED(__pyx_t_4);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1313
+ *     matrix.matrix = RfMatrix(c_dtype, proc_queries.size(), proc_choices.size())
+ * 
+ *     kwargs["processor"] = None             # <<<<<<<<<<<<<<
+ *     kwargs["score_cutoff"] = score_cutoff
+ * 
+ */
+  __Pyx_TraceLine(1313,0,__PYX_ERR(0, 1313, __pyx_L1_error))
+  if (unlikely(__pyx_v_kwargs == Py_None)) {
+    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+    __PYX_ERR(0, 1313, __pyx_L1_error)
+  }
+  if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_processor, Py_None) < 0))) __PYX_ERR(0, 1313, __pyx_L1_error)
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1314
+ * 
+ *     kwargs["processor"] = None
+ *     kwargs["score_cutoff"] = score_cutoff             # <<<<<<<<<<<<<<
+ * 
+ *     for i in range(proc_queries.size()):
+ */
+  __Pyx_TraceLine(1314,0,__PYX_ERR(0, 1314, __pyx_L1_error))
+  if (unlikely(__pyx_v_kwargs == Py_None)) {
+    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+    __PYX_ERR(0, 1314, __pyx_L1_error)
+  }
+  if (unlikely((PyDict_SetItem(__pyx_v_kwargs, __pyx_n_u_score_cutoff, __pyx_v_score_cutoff) < 0))) __PYX_ERR(0, 1314, __pyx_L1_error)
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1316
+ *     kwargs["score_cutoff"] = score_cutoff
+ * 
+ *     for i in range(proc_queries.size()):             # <<<<<<<<<<<<<<
+ *         for j in range(proc_choices.size()):
+ *             score = scorer(<object>proc_queries[i].obj, <object>proc_choices[j].obj,**kwargs)
+ */
+  __Pyx_TraceLine(1316,0,__PYX_ERR(0, 1316, __pyx_L1_error))
+  __pyx_t_5 = __pyx_v_proc_queries.size();
+  __pyx_t_6 = __pyx_t_5;
+  for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
+    __pyx_v_i = __pyx_t_7;
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1317
+ * 
+ *     for i in range(proc_queries.size()):
+ *         for j in range(proc_choices.size()):             # <<<<<<<<<<<<<<
+ *             score = scorer(<object>proc_queries[i].obj, <object>proc_choices[j].obj,**kwargs)
+ *             matrix.matrix.set(i, j, score)
+ */
+    __Pyx_TraceLine(1317,0,__PYX_ERR(0, 1317, __pyx_L1_error))
+    __pyx_t_8 = __pyx_v_proc_choices.size();
+    __pyx_t_9 = __pyx_t_8;
+    for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
+      __pyx_v_j = __pyx_t_10;
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1318
+ *     for i in range(proc_queries.size()):
+ *         for j in range(proc_choices.size()):
+ *             score = scorer(<object>proc_queries[i].obj, <object>proc_choices[j].obj,**kwargs)             # <<<<<<<<<<<<<<
+ *             matrix.matrix.set(i, j, score)
+ * 
+ */
+      __Pyx_TraceLine(1318,0,__PYX_ERR(0, 1318, __pyx_L1_error))
+      __pyx_t_11 = (__pyx_v_proc_queries[__pyx_v_i]).obj;
+      __pyx_t_12 = (__pyx_v_proc_choices[__pyx_v_j]).obj;
+      __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1318, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_2);
+      __Pyx_INCREF(((PyObject *)__pyx_t_11));
+      __Pyx_GIVEREF(((PyObject *)__pyx_t_11));
+      PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)__pyx_t_11));
+      __Pyx_INCREF(((PyObject *)__pyx_t_12));
+      __Pyx_GIVEREF(((PyObject *)__pyx_t_12));
+      PyTuple_SET_ITEM(__pyx_t_2, 1, ((PyObject *)__pyx_t_12));
+      if (unlikely(__pyx_v_kwargs == Py_None)) {
+        PyErr_SetString(PyExc_TypeError, "argument after ** must be a mapping, not NoneType");
+        __PYX_ERR(0, 1318, __pyx_L1_error)
+      }
+      __pyx_t_13 = PyDict_Copy(__pyx_v_kwargs); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 1318, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_13);
+      __pyx_t_14 = __Pyx_PyObject_Call(__pyx_v_scorer, __pyx_t_2, __pyx_t_13); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 1318, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_14);
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+      __pyx_t_15 = __pyx_PyFloat_AsDouble(__pyx_t_14); if (unlikely((__pyx_t_15 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 1318, __pyx_L1_error)
+      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+      __pyx_v_score = __pyx_t_15;
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1319
+ *         for j in range(proc_choices.size()):
+ *             score = scorer(<object>proc_queries[i].obj, <object>proc_choices[j].obj,**kwargs)
+ *             matrix.matrix.set(i, j, score)             # <<<<<<<<<<<<<<
+ * 
+ *     return matrix
+ */
+      __Pyx_TraceLine(1319,0,__PYX_ERR(0, 1319, __pyx_L1_error))
+      try {
+        __pyx_v_matrix->matrix.set(__pyx_v_i, __pyx_v_j, __pyx_v_score);
+      } catch(...) {
+        __Pyx_CppExn2PyErr();
+        __PYX_ERR(0, 1319, __pyx_L1_error)
+      }
+    }
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1321
+ *             matrix.matrix.set(i, j, score)
+ * 
+ *     return matrix             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_TraceLine(1321,0,__PYX_ERR(0, 1321, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF((PyObject *)__pyx_v_matrix);
+  __pyx_r = ((PyObject *)__pyx_v_matrix);
+  goto __pyx_L0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1305
+ * @cython.boundscheck(False)
+ * @cython.wraparound(False)
+ * cdef cdist_py(queries, choices, scorer, processor, score_cutoff, dtype, workers, dict kwargs):             # <<<<<<<<<<<<<<
+ *     proc_queries = preprocess_py(queries, processor)
+ *     proc_choices = preprocess_py(choices, processor)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_13);
+  __Pyx_XDECREF(__pyx_t_14);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.cdist_py", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_matrix);
+  __Pyx_XDECREF(__pyx_v_c_dtype);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "rapidfuzz/process_cpp_impl.pyx":1324
+ * 
+ * 
+ * def cdist(queries, choices, *, scorer=ratio, processor=None, score_cutoff=None, dtype=None, workers=1, **kwargs):             # <<<<<<<<<<<<<<
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
+ */
+
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_15__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__defaults__", 0);
+  __Pyx_TraceCall("__defaults__", __pyx_f[0], 1324, 0, __PYX_ERR(0, 1324, __pyx_L1_error));
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1324, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_scorer, __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_scorer) < 0) __PYX_ERR(0, 1324, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_processor, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 1324, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_score_cutoff, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 1324, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, ((PyObject *)Py_None)) < 0) __PYX_ERR(0, 1324, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_workers, ((PyObject *)__pyx_int_1)) < 0) __PYX_ERR(0, 1324, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1324, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF(Py_None);
+  __Pyx_GIVEREF(Py_None);
+  PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
+  __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* Python wrapper */
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_8cdist(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_9rapidfuzz_16process_cpp_impl_8cdist = {"cdist", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_8cdist, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_9rapidfuzz_16process_cpp_impl_8cdist(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_queries = 0;
+  PyObject *__pyx_v_choices = 0;
+  PyObject *__pyx_v_scorer = 0;
+  PyObject *__pyx_v_processor = 0;
+  PyObject *__pyx_v_score_cutoff = 0;
+  PyObject *__pyx_v_dtype = 0;
+  PyObject *__pyx_v_workers = 0;
+  PyObject *__pyx_v_kwargs = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("cdist (wrapper)", 0);
+  __pyx_v_kwargs = PyDict_New(); if (unlikely(!__pyx_v_kwargs)) return NULL;
+  __Pyx_GOTREF(__pyx_v_kwargs);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_queries,&__pyx_n_s_choices,&__pyx_n_s_scorer,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,&__pyx_n_s_dtype,&__pyx_n_s_workers,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_queries,&__pyx_n_s_choices,&__pyx_n_s_scorer,&__pyx_n_s_processor,&__pyx_n_s_score_cutoff,&__pyx_n_s_dtype,&__pyx_n_s_workers,0};
+    #endif
+    PyObject* values[7] = {0,0,0,0,0,0,0};
+    __pyx_defaults3 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self);
+    values[2] = __pyx_dynamic_args->__pyx_arg_scorer;
+    values[3] = ((PyObject *)((PyObject *)Py_None));
+    values[4] = ((PyObject *)((PyObject *)Py_None));
+    values[5] = ((PyObject *)((PyObject *)Py_None));
+    values[6] = ((PyObject *)((PyObject *)__pyx_int_1));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_queries)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1324, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_choices)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1324, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("cdist", 1, 2, 2, 1); __PYX_ERR(0, 1324, __pyx_L3_error)
+        }
+      }
+      if (kw_args > 0 && (kw_args <= 5)) {
+        Py_ssize_t index;
+        for (index = 2; index < 7 && kw_args > 0; index++) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
+          if (value) { values[index] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1324, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kwargs, values + 0, kwd_pos_args, "cdist") < 0)) __PYX_ERR(0, 1324, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+    }
+    __pyx_v_queries = values[0];
+    __pyx_v_choices = values[1];
+    __pyx_v_scorer = values[2];
+    __pyx_v_processor = values[3];
+    __pyx_v_score_cutoff = values[4];
+    __pyx_v_dtype = values[5];
+    __pyx_v_workers = values[6];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("cdist", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 1324, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_DECREF(__pyx_v_kwargs); __pyx_v_kwargs = 0;
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.cdist", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_9rapidfuzz_16process_cpp_impl_7cdist(__pyx_self, __pyx_v_queries, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_dtype, __pyx_v_workers, __pyx_v_kwargs);
+
+  /* function exit code */
+  __Pyx_DECREF(__pyx_v_kwargs);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_9rapidfuzz_16process_cpp_impl_7cdist(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_queries, PyObject *__pyx_v_choices, PyObject *__pyx_v_scorer, PyObject *__pyx_v_processor, PyObject *__pyx_v_score_cutoff, PyObject *__pyx_v_dtype, PyObject *__pyx_v_workers, PyObject *__pyx_v_kwargs) {
+  RF_Scorer *__pyx_v_scorer_context;
+  RF_ScorerFlags __pyx_v_scorer_flags;
+  PyObject *__pyx_v_scorer_capsule = NULL;
+  RF_KwargsWrapper __pyx_v_kwargs_context;
+  PyObject *__pyx_r = NULL;
+  __Pyx_TraceDeclarations
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  void *__pyx_t_3;
+  bool __pyx_t_4;
+  int __pyx_t_5;
+  int __pyx_t_6;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_TraceFrameInit(__pyx_codeobj__18)
+  __Pyx_RefNannySetupContext("cdist", 0);
+  __Pyx_TraceCall("cdist", __pyx_f[0], 1324, 0, __PYX_ERR(0, 1324, __pyx_L1_error));
+  __Pyx_INCREF(__pyx_v_processor);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1325
+ * 
+ * def cdist(queries, choices, *, scorer=ratio, processor=None, score_cutoff=None, dtype=None, workers=1, **kwargs):
+ *     cdef RF_Scorer* scorer_context = NULL             # <<<<<<<<<<<<<<
+ *     cdef RF_ScorerFlags scorer_flags
+ * 
+ */
+  __Pyx_TraceLine(1325,0,__PYX_ERR(0, 1325, __pyx_L1_error))
+  __pyx_v_scorer_context = NULL;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1328
+ *     cdef RF_ScorerFlags scorer_flags
+ * 
+ *     if processor is True:             # <<<<<<<<<<<<<<
+ *         # todo: deprecate this
+ *         processor = default_process
+ */
+  __Pyx_TraceLine(1328,0,__PYX_ERR(0, 1328, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_processor == Py_True);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1330
+ *     if processor is True:
+ *         # todo: deprecate this
+ *         processor = default_process             # <<<<<<<<<<<<<<
+ *     elif processor is False:
+ *         processor = None
+ */
+    __Pyx_TraceLine(1330,0,__PYX_ERR(0, 1330, __pyx_L1_error))
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1330, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF_SET(__pyx_v_processor, __pyx_t_2);
+    __pyx_t_2 = 0;
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1328
+ *     cdef RF_ScorerFlags scorer_flags
+ * 
+ *     if processor is True:             # <<<<<<<<<<<<<<
+ *         # todo: deprecate this
+ *         processor = default_process
+ */
+    goto __pyx_L3;
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1331
+ *         # todo: deprecate this
+ *         processor = default_process
+ *     elif processor is False:             # <<<<<<<<<<<<<<
+ *         processor = None
+ * 
+ */
+  __Pyx_TraceLine(1331,0,__PYX_ERR(0, 1331, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_processor == Py_False);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1332
+ *         processor = default_process
+ *     elif processor is False:
+ *         processor = None             # <<<<<<<<<<<<<<
+ * 
+ *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
+ */
+    __Pyx_TraceLine(1332,0,__PYX_ERR(0, 1332, __pyx_L1_error))
+    __Pyx_INCREF(Py_None);
+    __Pyx_DECREF_SET(__pyx_v_processor, Py_None);
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1331
+ *         # todo: deprecate this
+ *         processor = default_process
+ *     elif processor is False:             # <<<<<<<<<<<<<<
+ *         processor = None
+ * 
+ */
+  }
+  __pyx_L3:;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1334
+ *         processor = None
+ * 
+ *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)             # <<<<<<<<<<<<<<
+ *     if PyCapsule_IsValid(scorer_capsule, NULL):
+ *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
+ */
+  __Pyx_TraceLine(1334,0,__PYX_ERR(0, 1334, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_GetAttr3(__pyx_v_scorer, __pyx_n_u_RF_Scorer, __pyx_v_scorer); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1334, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_v_scorer_capsule = __pyx_t_2;
+  __pyx_t_2 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1335
+ * 
+ *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
+ *     if PyCapsule_IsValid(scorer_capsule, NULL):             # <<<<<<<<<<<<<<
+ *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
+ * 
+ */
+  __Pyx_TraceLine(1335,0,__PYX_ERR(0, 1335, __pyx_L1_error))
+  __pyx_t_1 = PyCapsule_IsValid(__pyx_v_scorer_capsule, NULL);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1336
+ *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
+ *     if PyCapsule_IsValid(scorer_capsule, NULL):
+ *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)             # <<<<<<<<<<<<<<
+ * 
+ *     if scorer_context:
+ */
+    __Pyx_TraceLine(1336,0,__PYX_ERR(0, 1336, __pyx_L1_error))
+    __pyx_t_3 = PyCapsule_GetPointer(__pyx_v_scorer_capsule, NULL); if (unlikely(__pyx_t_3 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 1336, __pyx_L1_error)
+    __pyx_v_scorer_context = ((RF_Scorer *)__pyx_t_3);
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1335
+ * 
+ *     scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
+ *     if PyCapsule_IsValid(scorer_capsule, NULL):             # <<<<<<<<<<<<<<
+ *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
+ * 
+ */
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1338
+ *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
+ * 
+ *     if scorer_context:             # <<<<<<<<<<<<<<
+ *         if dereference(scorer_context).version == 1:
+ *             kwargs_context = RF_KwargsWrapper()
+ */
+  __Pyx_TraceLine(1338,0,__PYX_ERR(0, 1338, __pyx_L1_error))
+  __pyx_t_1 = (__pyx_v_scorer_context != 0);
+  if (__pyx_t_1) {
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1339
+ * 
+ *     if scorer_context:
+ *         if dereference(scorer_context).version == 1:             # <<<<<<<<<<<<<<
+ *             kwargs_context = RF_KwargsWrapper()
+ *             dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
+ */
+    __Pyx_TraceLine(1339,0,__PYX_ERR(0, 1339, __pyx_L1_error))
+    __pyx_t_1 = ((*__pyx_v_scorer_context).version == 1);
+    if (__pyx_t_1) {
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1340
+ *     if scorer_context:
+ *         if dereference(scorer_context).version == 1:
+ *             kwargs_context = RF_KwargsWrapper()             # <<<<<<<<<<<<<<
+ *             dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
+ *             dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
+ */
+      __Pyx_TraceLine(1340,0,__PYX_ERR(0, 1340, __pyx_L1_error))
+      __pyx_v_kwargs_context = RF_KwargsWrapper();
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1341
+ *         if dereference(scorer_context).version == 1:
+ *             kwargs_context = RF_KwargsWrapper()
+ *             dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)             # <<<<<<<<<<<<<<
+ *             dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
+ * 
+ */
+      __Pyx_TraceLine(1341,0,__PYX_ERR(0, 1341, __pyx_L1_error))
+      __pyx_t_4 = (*__pyx_v_scorer_context).kwargs_init((&__pyx_v_kwargs_context.kwargs), __pyx_v_kwargs); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1341, __pyx_L1_error)
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1342
+ *             kwargs_context = RF_KwargsWrapper()
+ *             dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
+ *             dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)             # <<<<<<<<<<<<<<
+ * 
+ *             # scorer(queries[i], choices[j]) == scorer(queries[j], choices[i])
+ */
+      __Pyx_TraceLine(1342,0,__PYX_ERR(0, 1342, __pyx_L1_error))
+      __pyx_t_4 = (*__pyx_v_scorer_context).get_scorer_flags((&__pyx_v_kwargs_context.kwargs), (&__pyx_v_scorer_flags)); if (unlikely(__pyx_t_4 == ((bool)0))) __PYX_ERR(0, 1342, __pyx_L1_error)
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1345
+ * 
+ *             # scorer(queries[i], choices[j]) == scorer(queries[j], choices[i])
+ *             if scorer_flags.flags & RF_SCORER_FLAG_SYMMETRIC and queries is choices:             # <<<<<<<<<<<<<<
+ *                 return cdist_single_list(
+ *                     queries, scorer_context, &scorer_flags, processor,
+ */
+      __Pyx_TraceLine(1345,0,__PYX_ERR(0, 1345, __pyx_L1_error))
+      __pyx_t_5 = ((__pyx_v_scorer_flags.flags & RF_SCORER_FLAG_SYMMETRIC) != 0);
+      if (__pyx_t_5) {
+      } else {
+        __pyx_t_1 = __pyx_t_5;
+        goto __pyx_L8_bool_binop_done;
+      }
+      __pyx_t_5 = (__pyx_v_queries == __pyx_v_choices);
+      __pyx_t_1 = __pyx_t_5;
+      __pyx_L8_bool_binop_done:;
+      if (__pyx_t_1) {
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1346
+ *             # scorer(queries[i], choices[j]) == scorer(queries[j], choices[i])
+ *             if scorer_flags.flags & RF_SCORER_FLAG_SYMMETRIC and queries is choices:
+ *                 return cdist_single_list(             # <<<<<<<<<<<<<<
+ *                     queries, scorer_context, &scorer_flags, processor,
+ *                     score_cutoff, dtype, workers, &kwargs_context.kwargs)
+ */
+        __Pyx_TraceLine(1346,0,__PYX_ERR(0, 1346, __pyx_L1_error))
+        __Pyx_XDECREF(__pyx_r);
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1348
+ *                 return cdist_single_list(
+ *                     queries, scorer_context, &scorer_flags, processor,
+ *                     score_cutoff, dtype, workers, &kwargs_context.kwargs)             # <<<<<<<<<<<<<<
+ *             else:
+ *                 return cdist_two_lists(
+ */
+        __Pyx_TraceLine(1348,0,__PYX_ERR(0, 1348, __pyx_L1_error))
+        __pyx_t_6 = __Pyx_PyInt_As_int(__pyx_v_workers); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1348, __pyx_L1_error)
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1346
+ *             # scorer(queries[i], choices[j]) == scorer(queries[j], choices[i])
+ *             if scorer_flags.flags & RF_SCORER_FLAG_SYMMETRIC and queries is choices:
+ *                 return cdist_single_list(             # <<<<<<<<<<<<<<
+ *                     queries, scorer_context, &scorer_flags, processor,
+ *                     score_cutoff, dtype, workers, &kwargs_context.kwargs)
+ */
+        __Pyx_TraceLine(1346,0,__PYX_ERR(0, 1346, __pyx_L1_error))
+        __pyx_t_2 = ((PyObject *)__pyx_f_9rapidfuzz_16process_cpp_impl_cdist_single_list(__pyx_v_queries, __pyx_v_scorer_context, (&__pyx_v_scorer_flags), __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_dtype, __pyx_t_6, (&__pyx_v_kwargs_context.kwargs))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1346, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_2);
+        __pyx_r = __pyx_t_2;
+        __pyx_t_2 = 0;
+        goto __pyx_L0;
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1345
+ * 
+ *             # scorer(queries[i], choices[j]) == scorer(queries[j], choices[i])
+ *             if scorer_flags.flags & RF_SCORER_FLAG_SYMMETRIC and queries is choices:             # <<<<<<<<<<<<<<
+ *                 return cdist_single_list(
+ *                     queries, scorer_context, &scorer_flags, processor,
+ */
+      }
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1350
+ *                     score_cutoff, dtype, workers, &kwargs_context.kwargs)
+ *             else:
+ *                 return cdist_two_lists(             # <<<<<<<<<<<<<<
+ *                     queries, choices, scorer_context, &scorer_flags, processor,
+ *                     score_cutoff, dtype, workers, &kwargs_context.kwargs)
+ */
+      __Pyx_TraceLine(1350,0,__PYX_ERR(0, 1350, __pyx_L1_error))
+      /*else*/ {
+        __Pyx_XDECREF(__pyx_r);
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1352
+ *                 return cdist_two_lists(
+ *                     queries, choices, scorer_context, &scorer_flags, processor,
+ *                     score_cutoff, dtype, workers, &kwargs_context.kwargs)             # <<<<<<<<<<<<<<
+ * 
+ *     return cdist_py(queries, choices, scorer, processor, score_cutoff, dtype, workers, kwargs)
+ */
+        __Pyx_TraceLine(1352,0,__PYX_ERR(0, 1352, __pyx_L1_error))
+        __pyx_t_6 = __Pyx_PyInt_As_int(__pyx_v_workers); if (unlikely((__pyx_t_6 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1352, __pyx_L1_error)
+
+        /* "rapidfuzz/process_cpp_impl.pyx":1350
+ *                     score_cutoff, dtype, workers, &kwargs_context.kwargs)
+ *             else:
+ *                 return cdist_two_lists(             # <<<<<<<<<<<<<<
+ *                     queries, choices, scorer_context, &scorer_flags, processor,
+ *                     score_cutoff, dtype, workers, &kwargs_context.kwargs)
+ */
+        __Pyx_TraceLine(1350,0,__PYX_ERR(0, 1350, __pyx_L1_error))
+        __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_cdist_two_lists(__pyx_v_queries, __pyx_v_choices, __pyx_v_scorer_context, (&__pyx_v_scorer_flags), __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_dtype, __pyx_t_6, (&__pyx_v_kwargs_context.kwargs)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1350, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_2);
+        __pyx_r = __pyx_t_2;
+        __pyx_t_2 = 0;
+        goto __pyx_L0;
+      }
+
+      /* "rapidfuzz/process_cpp_impl.pyx":1339
+ * 
+ *     if scorer_context:
+ *         if dereference(scorer_context).version == 1:             # <<<<<<<<<<<<<<
+ *             kwargs_context = RF_KwargsWrapper()
+ *             dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
+ */
+    }
+
+    /* "rapidfuzz/process_cpp_impl.pyx":1338
+ *         scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
+ * 
+ *     if scorer_context:             # <<<<<<<<<<<<<<
+ *         if dereference(scorer_context).version == 1:
+ *             kwargs_context = RF_KwargsWrapper()
+ */
+  }
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1354
+ *                     score_cutoff, dtype, workers, &kwargs_context.kwargs)
+ * 
+ *     return cdist_py(queries, choices, scorer, processor, score_cutoff, dtype, workers, kwargs)             # <<<<<<<<<<<<<<
+ */
+  __Pyx_TraceLine(1354,0,__PYX_ERR(0, 1354, __pyx_L1_error))
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_2 = __pyx_f_9rapidfuzz_16process_cpp_impl_cdist_py(__pyx_v_queries, __pyx_v_choices, __pyx_v_scorer, __pyx_v_processor, __pyx_v_score_cutoff, __pyx_v_dtype, __pyx_v_workers, __pyx_v_kwargs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1354, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1324
+ * 
+ * 
+ * def cdist(queries, choices, *, scorer=ratio, processor=None, score_cutoff=None, dtype=None, workers=1, **kwargs):             # <<<<<<<<<<<<<<
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("rapidfuzz.process_cpp_impl.cdist", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_scorer_capsule);
+  __Pyx_XDECREF(__pyx_v_processor);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_TraceReturn(__pyx_r, 0);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "cpython/complex.pxd":19
+ * 
+ *         @property
+ *         cdef inline double real(self):             # <<<<<<<<<<<<<<
+ *             return self.cval.real
+ * 
+ */
+
+static CYTHON_INLINE double __pyx_f_7cpython_7complex_7complex_4real_real(PyComplexObject *__pyx_v_self) {
+  double __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("real", 0);
+
+  /* "cpython/complex.pxd":20
+ *         @property
+ *         cdef inline double real(self):
+ *             return self.cval.real             # <<<<<<<<<<<<<<
+ * 
+ *         @property
+ */
+  __pyx_r = __pyx_v_self->cval.real;
+  goto __pyx_L0;
+
+  /* "cpython/complex.pxd":19
+ * 
+ *         @property
+ *         cdef inline double real(self):             # <<<<<<<<<<<<<<
+ *             return self.cval.real
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "cpython/complex.pxd":23
+ * 
+ *         @property
+ *         cdef inline double imag(self):             # <<<<<<<<<<<<<<
+ *             return self.cval.imag
+ * 
+ */
+
+static CYTHON_INLINE double __pyx_f_7cpython_7complex_7complex_4imag_imag(PyComplexObject *__pyx_v_self) {
+  double __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("imag", 0);
+
+  /* "cpython/complex.pxd":24
+ *         @property
+ *         cdef inline double imag(self):
+ *             return self.cval.imag             # <<<<<<<<<<<<<<
+ * 
+ *     # PyTypeObject PyComplex_Type
+ */
+  __pyx_r = __pyx_v_self->cval.imag;
+  goto __pyx_L0;
+
+  /* "cpython/complex.pxd":23
+ * 
+ *         @property
+ *         cdef inline double imag(self):             # <<<<<<<<<<<<<<
+ *             return self.cval.imag
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "cpython/contextvars.pxd":112
+ * 
+ * 
+ * cdef inline object get_value(var, default_value=None):             # <<<<<<<<<<<<<<
+ *     """Return a new reference to the value of the context variable,
+ *     or the default value of the context variable,
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_7cpython_11contextvars_get_value(PyObject *__pyx_v_var, struct __pyx_opt_args_7cpython_11contextvars_get_value *__pyx_optional_args) {
+  PyObject *__pyx_v_default_value = ((PyObject *)Py_None);
+  PyObject *__pyx_v_value;
+  PyObject *__pyx_v_pyvalue = NULL;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("get_value", 0);
+  if (__pyx_optional_args) {
+    if (__pyx_optional_args->__pyx_n > 0) {
+      __pyx_v_default_value = __pyx_optional_args->default_value;
+    }
+  }
+
+  /* "cpython/contextvars.pxd":117
+ *     or None if no such value or default was found.
+ *     """
+ *     cdef PyObject *value = NULL             # <<<<<<<<<<<<<<
+ *     PyContextVar_Get(var, NULL, &value)
+ *     if value is NULL:
+ */
+  __pyx_v_value = NULL;
+
+  /* "cpython/contextvars.pxd":118
+ *     """
+ *     cdef PyObject *value = NULL
+ *     PyContextVar_Get(var, NULL, &value)             # <<<<<<<<<<<<<<
+ *     if value is NULL:
+ *         # context variable does not have a default
+ */
+  __pyx_t_1 = PyContextVar_Get(__pyx_v_var, NULL, (&__pyx_v_value)); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(2, 118, __pyx_L1_error)
+
+  /* "cpython/contextvars.pxd":119
+ *     cdef PyObject *value = NULL
+ *     PyContextVar_Get(var, NULL, &value)
+ *     if value is NULL:             # <<<<<<<<<<<<<<
+ *         # context variable does not have a default
+ *         pyvalue = default_value
+ */
+  __pyx_t_2 = (__pyx_v_value == NULL);
+  if (__pyx_t_2) {
+
+    /* "cpython/contextvars.pxd":121
+ *     if value is NULL:
+ *         # context variable does not have a default
+ *         pyvalue = default_value             # <<<<<<<<<<<<<<
+ *     else:
+ *         # value or default value of context variable
+ */
+    __Pyx_INCREF(__pyx_v_default_value);
+    __pyx_v_pyvalue = __pyx_v_default_value;
+
+    /* "cpython/contextvars.pxd":119
+ *     cdef PyObject *value = NULL
+ *     PyContextVar_Get(var, NULL, &value)
+ *     if value is NULL:             # <<<<<<<<<<<<<<
+ *         # context variable does not have a default
+ *         pyvalue = default_value
+ */
+    goto __pyx_L3;
+  }
+
+  /* "cpython/contextvars.pxd":124
+ *     else:
+ *         # value or default value of context variable
+ *         pyvalue = <object>value             # <<<<<<<<<<<<<<
+ *         Py_XDECREF(value)  # PyContextVar_Get() returned an owned reference as 'PyObject*'
+ *     return pyvalue
+ */
+  /*else*/ {
+    __pyx_t_3 = ((PyObject *)__pyx_v_value);
+    __Pyx_INCREF(__pyx_t_3);
+    __pyx_v_pyvalue = __pyx_t_3;
+    __pyx_t_3 = 0;
+
+    /* "cpython/contextvars.pxd":125
+ *         # value or default value of context variable
+ *         pyvalue = <object>value
+ *         Py_XDECREF(value)  # PyContextVar_Get() returned an owned reference as 'PyObject*'             # <<<<<<<<<<<<<<
+ *     return pyvalue
+ * 
+ */
+    Py_XDECREF(__pyx_v_value);
+  }
+  __pyx_L3:;
+
+  /* "cpython/contextvars.pxd":126
+ *         pyvalue = <object>value
+ *         Py_XDECREF(value)  # PyContextVar_Get() returned an owned reference as 'PyObject*'
+ *     return pyvalue             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(__pyx_v_pyvalue);
+  __pyx_r = __pyx_v_pyvalue;
+  goto __pyx_L0;
+
+  /* "cpython/contextvars.pxd":112
+ * 
+ * 
+ * cdef inline object get_value(var, default_value=None):             # <<<<<<<<<<<<<<
+ *     """Return a new reference to the value of the context variable,
+ *     or the default value of the context variable,
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("cpython.contextvars.get_value", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_pyvalue);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "cpython/contextvars.pxd":129
+ * 
+ * 
+ * cdef inline object get_value_no_default(var, default_value=None):             # <<<<<<<<<<<<<<
+ *     """Return a new reference to the value of the context variable,
+ *     or the provided default value if no such value was found.
+ */
+
+static CYTHON_INLINE PyObject *__pyx_f_7cpython_11contextvars_get_value_no_default(PyObject *__pyx_v_var, struct __pyx_opt_args_7cpython_11contextvars_get_value_no_default *__pyx_optional_args) {
+  PyObject *__pyx_v_default_value = ((PyObject *)Py_None);
+  PyObject *__pyx_v_value;
+  PyObject *__pyx_v_pyvalue = NULL;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("get_value_no_default", 0);
+  if (__pyx_optional_args) {
+    if (__pyx_optional_args->__pyx_n > 0) {
+      __pyx_v_default_value = __pyx_optional_args->default_value;
+    }
+  }
+
+  /* "cpython/contextvars.pxd":135
+ *     Ignores the default value of the context variable, if any.
+ *     """
+ *     cdef PyObject *value = NULL             # <<<<<<<<<<<<<<
+ *     PyContextVar_Get(var, <PyObject*>default_value, &value)
+ *     # value of context variable or 'default_value'
+ */
+  __pyx_v_value = NULL;
+
+  /* "cpython/contextvars.pxd":136
+ *     """
+ *     cdef PyObject *value = NULL
+ *     PyContextVar_Get(var, <PyObject*>default_value, &value)             # <<<<<<<<<<<<<<
+ *     # value of context variable or 'default_value'
+ *     pyvalue = <object>value
+ */
+  __pyx_t_1 = PyContextVar_Get(__pyx_v_var, ((PyObject *)__pyx_v_default_value), (&__pyx_v_value)); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(2, 136, __pyx_L1_error)
+
+  /* "cpython/contextvars.pxd":138
+ *     PyContextVar_Get(var, <PyObject*>default_value, &value)
+ *     # value of context variable or 'default_value'
+ *     pyvalue = <object>value             # <<<<<<<<<<<<<<
+ *     Py_XDECREF(value)  # PyContextVar_Get() returned an owned reference as 'PyObject*'
+ *     return pyvalue
+ */
+  __pyx_t_2 = ((PyObject *)__pyx_v_value);
+  __Pyx_INCREF(__pyx_t_2);
+  __pyx_v_pyvalue = __pyx_t_2;
+  __pyx_t_2 = 0;
+
+  /* "cpython/contextvars.pxd":139
+ *     # value of context variable or 'default_value'
+ *     pyvalue = <object>value
+ *     Py_XDECREF(value)  # PyContextVar_Get() returned an owned reference as 'PyObject*'             # <<<<<<<<<<<<<<
+ *     return pyvalue
+ */
+  Py_XDECREF(__pyx_v_value);
+
+  /* "cpython/contextvars.pxd":140
+ *     pyvalue = <object>value
+ *     Py_XDECREF(value)  # PyContextVar_Get() returned an owned reference as 'PyObject*'
+ *     return pyvalue             # <<<<<<<<<<<<<<
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(__pyx_v_pyvalue);
+  __pyx_r = __pyx_v_pyvalue;
+  goto __pyx_L0;
+
+  /* "cpython/contextvars.pxd":129
+ * 
+ * 
+ * cdef inline object get_value_no_default(var, default_value=None):             # <<<<<<<<<<<<<<
+ *     """Return a new reference to the value of the context variable,
+ *     or the provided default value if no such value was found.
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("cpython.contextvars.get_value_no_default", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_pyvalue);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
 /* "cpp_common.pxd":242
  *     void validate_string(object py_str, const char* err) except +
  * 
  * cdef inline RF_String hash_array(arr) except *:             # <<<<<<<<<<<<<<
  *     # TODO on Cpython this does not require any copies
  *     cdef RF_String s_proc
  */
@@ -18840,71 +22723,71 @@
   PyObject *__pyx_t_21 = NULL;
   PyObject *__pyx_t_22 = NULL;
   PyObject *__pyx_t_23 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("hash_array", 0);
-  __Pyx_TraceCall("hash_array", __pyx_f[1], 242, 0, __PYX_ERR(1, 242, __pyx_L1_error));
+  __Pyx_TraceCall("hash_array", __pyx_f[3], 242, 0, __PYX_ERR(3, 242, __pyx_L1_error));
 
   /* "cpp_common.pxd":245
  *     # TODO on Cpython this does not require any copies
  *     cdef RF_String s_proc
  *     cdef Py_UCS4 typecode = <Py_UCS4>arr.typecode             # <<<<<<<<<<<<<<
  *     s_proc.length = <int64_t>len(arr)
  * 
  */
-  __Pyx_TraceLine(245,0,__PYX_ERR(1, 245, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_typecode); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 245, __pyx_L1_error)
+  __Pyx_TraceLine(245,0,__PYX_ERR(3, 245, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_typecode); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_AsPy_UCS4(__pyx_t_1); if (unlikely((__pyx_t_2 == (Py_UCS4)-1) && PyErr_Occurred())) __PYX_ERR(1, 245, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_AsPy_UCS4(__pyx_t_1); if (unlikely((__pyx_t_2 == (Py_UCS4)-1) && PyErr_Occurred())) __PYX_ERR(3, 245, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_typecode = ((Py_UCS4)__pyx_t_2);
 
   /* "cpp_common.pxd":246
  *     cdef RF_String s_proc
  *     cdef Py_UCS4 typecode = <Py_UCS4>arr.typecode
  *     s_proc.length = <int64_t>len(arr)             # <<<<<<<<<<<<<<
  * 
  *     s_proc.data = malloc(s_proc.length * sizeof(uint64_t))
  */
-  __Pyx_TraceLine(246,0,__PYX_ERR(1, 246, __pyx_L1_error))
-  __pyx_t_3 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(1, 246, __pyx_L1_error)
+  __Pyx_TraceLine(246,0,__PYX_ERR(3, 246, __pyx_L1_error))
+  __pyx_t_3 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(3, 246, __pyx_L1_error)
   __pyx_v_s_proc.length = ((int64_t)__pyx_t_3);
 
   /* "cpp_common.pxd":248
  *     s_proc.length = <int64_t>len(arr)
  * 
  *     s_proc.data = malloc(s_proc.length * sizeof(uint64_t))             # <<<<<<<<<<<<<<
  * 
  *     if s_proc.data == NULL:
  */
-  __Pyx_TraceLine(248,0,__PYX_ERR(1, 248, __pyx_L1_error))
+  __Pyx_TraceLine(248,0,__PYX_ERR(3, 248, __pyx_L1_error))
   __pyx_v_s_proc.data = malloc((__pyx_v_s_proc.length * (sizeof(uint64_t))));
 
   /* "cpp_common.pxd":250
  *     s_proc.data = malloc(s_proc.length * sizeof(uint64_t))
  * 
  *     if s_proc.data == NULL:             # <<<<<<<<<<<<<<
  *         raise MemoryError
  * 
  */
-  __Pyx_TraceLine(250,0,__PYX_ERR(1, 250, __pyx_L1_error))
+  __Pyx_TraceLine(250,0,__PYX_ERR(3, 250, __pyx_L1_error))
   __pyx_t_4 = (__pyx_v_s_proc.data == NULL);
   if (unlikely(__pyx_t_4)) {
 
     /* "cpp_common.pxd":251
  * 
  *     if s_proc.data == NULL:
  *         raise MemoryError             # <<<<<<<<<<<<<<
  * 
  *     try:
  */
-    __Pyx_TraceLine(251,0,__PYX_ERR(1, 251, __pyx_L1_error))
-    PyErr_NoMemory(); __PYX_ERR(1, 251, __pyx_L1_error)
+    __Pyx_TraceLine(251,0,__PYX_ERR(3, 251, __pyx_L1_error))
+    PyErr_NoMemory(); __PYX_ERR(3, 251, __pyx_L1_error)
 
     /* "cpp_common.pxd":250
  *     s_proc.data = malloc(s_proc.length * sizeof(uint64_t))
  * 
  *     if s_proc.data == NULL:             # <<<<<<<<<<<<<<
  *         raise MemoryError
  * 
@@ -18914,15 +22797,15 @@
   /* "cpp_common.pxd":253
  *         raise MemoryError
  * 
  *     try:             # <<<<<<<<<<<<<<
  *         # ignore signed/unsigned, since it is not relevant in any of the algorithms
  *         if typecode in {'b', 'B'}: # signed/unsigned char
  */
-  __Pyx_TraceLine(253,0,__PYX_ERR(1, 253, __pyx_L1_error))
+  __Pyx_TraceLine(253,0,__PYX_ERR(3, 253, __pyx_L1_error))
   {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7);
     __Pyx_XGOTREF(__pyx_t_5);
     __Pyx_XGOTREF(__pyx_t_6);
     __Pyx_XGOTREF(__pyx_t_7);
@@ -18931,54 +22814,54 @@
       /* "cpp_common.pxd":255
  *     try:
  *         # ignore signed/unsigned, since it is not relevant in any of the algorithms
  *         if typecode in {'b', 'B'}: # signed/unsigned char             # <<<<<<<<<<<<<<
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  */
-      __Pyx_TraceLine(255,0,__PYX_ERR(1, 255, __pyx_L4_error))
+      __Pyx_TraceLine(255,0,__PYX_ERR(3, 255, __pyx_L4_error))
       switch (__pyx_v_typecode) {
         case 98:
         CYTHON_FALLTHROUGH;
         case 66:
 
         /* "cpp_common.pxd":256
  *         # ignore signed/unsigned, since it is not relevant in any of the algorithms
  *         if typecode in {'b', 'B'}: # signed/unsigned char
  *             s_proc.kind = RF_StringType.RF_UINT64             # <<<<<<<<<<<<<<
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  */
-        __Pyx_TraceLine(256,0,__PYX_ERR(1, 256, __pyx_L4_error))
+        __Pyx_TraceLine(256,0,__PYX_ERR(3, 256, __pyx_L4_error))
         __pyx_v_s_proc.kind = RF_UINT64;
 
         /* "cpp_common.pxd":257
  *         if typecode in {'b', 'B'}: # signed/unsigned char
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode == 'u': # 'u' wchar_t
  */
-        __Pyx_TraceLine(257,0,__PYX_ERR(1, 257, __pyx_L4_error))
+        __Pyx_TraceLine(257,0,__PYX_ERR(3, 257, __pyx_L4_error))
         __pyx_t_8 = __pyx_v_s_proc.length;
         __pyx_t_9 = __pyx_t_8;
         for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
           __pyx_v_i = __pyx_t_10;
 
           /* "cpp_common.pxd":258
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]             # <<<<<<<<<<<<<<
  *         elif typecode == 'u': # 'u' wchar_t
  *             s_proc.kind = RF_StringType.RF_UINT64
  */
-          __Pyx_TraceLine(258,0,__PYX_ERR(1, 258, __pyx_L4_error))
-          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 258, __pyx_L4_error)
+          __Pyx_TraceLine(258,0,__PYX_ERR(3, 258, __pyx_L4_error))
+          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 258, __pyx_L4_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_11 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_11 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(1, 258, __pyx_L4_error)
+          __pyx_t_11 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_11 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(3, 258, __pyx_L4_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           (((uint64_t *)__pyx_v_s_proc.data)[__pyx_v_i]) = ((uint64_t)__pyx_t_11);
         }
 
         /* "cpp_common.pxd":255
  *     try:
  *         # ignore signed/unsigned, since it is not relevant in any of the algorithms
@@ -18992,41 +22875,41 @@
         /* "cpp_common.pxd":260
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode == 'u': # 'u' wchar_t
  *             s_proc.kind = RF_StringType.RF_UINT64             # <<<<<<<<<<<<<<
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>arr[i]
  */
-        __Pyx_TraceLine(260,0,__PYX_ERR(1, 260, __pyx_L4_error))
+        __Pyx_TraceLine(260,0,__PYX_ERR(3, 260, __pyx_L4_error))
         __pyx_v_s_proc.kind = RF_UINT64;
 
         /* "cpp_common.pxd":261
  *         elif typecode == 'u': # 'u' wchar_t
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>arr[i]
  *         elif typecode in {'h', 'H'}: #  signed/unsigned short
  */
-        __Pyx_TraceLine(261,0,__PYX_ERR(1, 261, __pyx_L4_error))
+        __Pyx_TraceLine(261,0,__PYX_ERR(3, 261, __pyx_L4_error))
         __pyx_t_8 = __pyx_v_s_proc.length;
         __pyx_t_9 = __pyx_t_8;
         for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
           __pyx_v_i = __pyx_t_10;
 
           /* "cpp_common.pxd":262
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>arr[i]             # <<<<<<<<<<<<<<
  *         elif typecode in {'h', 'H'}: #  signed/unsigned short
  *             s_proc.kind = RF_StringType.RF_UINT64
  */
-          __Pyx_TraceLine(262,0,__PYX_ERR(1, 262, __pyx_L4_error))
-          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 262, __pyx_L4_error)
+          __Pyx_TraceLine(262,0,__PYX_ERR(3, 262, __pyx_L4_error))
+          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 262, __pyx_L4_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_2 = __Pyx_PyObject_AsPy_UCS4(__pyx_t_1); if (unlikely((__pyx_t_2 == (Py_UCS4)-1) && PyErr_Occurred())) __PYX_ERR(1, 262, __pyx_L4_error)
+          __pyx_t_2 = __Pyx_PyObject_AsPy_UCS4(__pyx_t_1); if (unlikely((__pyx_t_2 == (Py_UCS4)-1) && PyErr_Occurred())) __PYX_ERR(3, 262, __pyx_L4_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           (((uint64_t *)__pyx_v_s_proc.data)[__pyx_v_i]) = ((uint64_t)((Py_UCS4)__pyx_t_2));
         }
 
         /* "cpp_common.pxd":259
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
@@ -19040,52 +22923,52 @@
         /* "cpp_common.pxd":263
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>arr[i]
  *         elif typecode in {'h', 'H'}: #  signed/unsigned short             # <<<<<<<<<<<<<<
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  */
-        __Pyx_TraceLine(263,0,__PYX_ERR(1, 263, __pyx_L4_error))
+        __Pyx_TraceLine(263,0,__PYX_ERR(3, 263, __pyx_L4_error))
         CYTHON_FALLTHROUGH;
         case 72:
 
         /* "cpp_common.pxd":264
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>arr[i]
  *         elif typecode in {'h', 'H'}: #  signed/unsigned short
  *             s_proc.kind = RF_StringType.RF_UINT64             # <<<<<<<<<<<<<<
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  */
-        __Pyx_TraceLine(264,0,__PYX_ERR(1, 264, __pyx_L4_error))
+        __Pyx_TraceLine(264,0,__PYX_ERR(3, 264, __pyx_L4_error))
         __pyx_v_s_proc.kind = RF_UINT64;
 
         /* "cpp_common.pxd":265
  *         elif typecode in {'h', 'H'}: #  signed/unsigned short
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode in {'i', 'I'}: # signed/unsigned int
  */
-        __Pyx_TraceLine(265,0,__PYX_ERR(1, 265, __pyx_L4_error))
+        __Pyx_TraceLine(265,0,__PYX_ERR(3, 265, __pyx_L4_error))
         __pyx_t_8 = __pyx_v_s_proc.length;
         __pyx_t_9 = __pyx_t_8;
         for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
           __pyx_v_i = __pyx_t_10;
 
           /* "cpp_common.pxd":266
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]             # <<<<<<<<<<<<<<
  *         elif typecode in {'i', 'I'}: # signed/unsigned int
  *             s_proc.kind = RF_StringType.RF_UINT64
  */
-          __Pyx_TraceLine(266,0,__PYX_ERR(1, 266, __pyx_L4_error))
-          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 266, __pyx_L4_error)
+          __Pyx_TraceLine(266,0,__PYX_ERR(3, 266, __pyx_L4_error))
+          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 266, __pyx_L4_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_11 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_11 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(1, 266, __pyx_L4_error)
+          __pyx_t_11 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_11 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(3, 266, __pyx_L4_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           (((uint64_t *)__pyx_v_s_proc.data)[__pyx_v_i]) = ((uint64_t)__pyx_t_11);
         }
 
         /* "cpp_common.pxd":263
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>arr[i]
@@ -19099,52 +22982,52 @@
         /* "cpp_common.pxd":267
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode in {'i', 'I'}: # signed/unsigned int             # <<<<<<<<<<<<<<
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  */
-        __Pyx_TraceLine(267,0,__PYX_ERR(1, 267, __pyx_L4_error))
+        __Pyx_TraceLine(267,0,__PYX_ERR(3, 267, __pyx_L4_error))
         CYTHON_FALLTHROUGH;
         case 73:
 
         /* "cpp_common.pxd":268
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode in {'i', 'I'}: # signed/unsigned int
  *             s_proc.kind = RF_StringType.RF_UINT64             # <<<<<<<<<<<<<<
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  */
-        __Pyx_TraceLine(268,0,__PYX_ERR(1, 268, __pyx_L4_error))
+        __Pyx_TraceLine(268,0,__PYX_ERR(3, 268, __pyx_L4_error))
         __pyx_v_s_proc.kind = RF_UINT64;
 
         /* "cpp_common.pxd":269
  *         elif typecode in {'i', 'I'}: # signed/unsigned int
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode in {'l', 'L'}: # signed/unsigned long
  */
-        __Pyx_TraceLine(269,0,__PYX_ERR(1, 269, __pyx_L4_error))
+        __Pyx_TraceLine(269,0,__PYX_ERR(3, 269, __pyx_L4_error))
         __pyx_t_8 = __pyx_v_s_proc.length;
         __pyx_t_9 = __pyx_t_8;
         for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
           __pyx_v_i = __pyx_t_10;
 
           /* "cpp_common.pxd":270
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]             # <<<<<<<<<<<<<<
  *         elif typecode in {'l', 'L'}: # signed/unsigned long
  *             s_proc.kind = RF_StringType.RF_UINT64
  */
-          __Pyx_TraceLine(270,0,__PYX_ERR(1, 270, __pyx_L4_error))
-          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 270, __pyx_L4_error)
+          __Pyx_TraceLine(270,0,__PYX_ERR(3, 270, __pyx_L4_error))
+          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 270, __pyx_L4_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_11 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_11 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(1, 270, __pyx_L4_error)
+          __pyx_t_11 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_11 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(3, 270, __pyx_L4_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           (((uint64_t *)__pyx_v_s_proc.data)[__pyx_v_i]) = ((uint64_t)__pyx_t_11);
         }
 
         /* "cpp_common.pxd":267
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
@@ -19158,52 +23041,52 @@
         /* "cpp_common.pxd":271
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode in {'l', 'L'}: # signed/unsigned long             # <<<<<<<<<<<<<<
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  */
-        __Pyx_TraceLine(271,0,__PYX_ERR(1, 271, __pyx_L4_error))
+        __Pyx_TraceLine(271,0,__PYX_ERR(3, 271, __pyx_L4_error))
         CYTHON_FALLTHROUGH;
         case 76:
 
         /* "cpp_common.pxd":272
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode in {'l', 'L'}: # signed/unsigned long
  *             s_proc.kind = RF_StringType.RF_UINT64             # <<<<<<<<<<<<<<
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  */
-        __Pyx_TraceLine(272,0,__PYX_ERR(1, 272, __pyx_L4_error))
+        __Pyx_TraceLine(272,0,__PYX_ERR(3, 272, __pyx_L4_error))
         __pyx_v_s_proc.kind = RF_UINT64;
 
         /* "cpp_common.pxd":273
  *         elif typecode in {'l', 'L'}: # signed/unsigned long
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode in {'q', 'Q'}: # signed/unsigned long long
  */
-        __Pyx_TraceLine(273,0,__PYX_ERR(1, 273, __pyx_L4_error))
+        __Pyx_TraceLine(273,0,__PYX_ERR(3, 273, __pyx_L4_error))
         __pyx_t_8 = __pyx_v_s_proc.length;
         __pyx_t_9 = __pyx_t_8;
         for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
           __pyx_v_i = __pyx_t_10;
 
           /* "cpp_common.pxd":274
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]             # <<<<<<<<<<<<<<
  *         elif typecode in {'q', 'Q'}: # signed/unsigned long long
  *             s_proc.kind = RF_StringType.RF_UINT64
  */
-          __Pyx_TraceLine(274,0,__PYX_ERR(1, 274, __pyx_L4_error))
-          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 274, __pyx_L4_error)
+          __Pyx_TraceLine(274,0,__PYX_ERR(3, 274, __pyx_L4_error))
+          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 274, __pyx_L4_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_11 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_11 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(1, 274, __pyx_L4_error)
+          __pyx_t_11 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_11 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(3, 274, __pyx_L4_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           (((uint64_t *)__pyx_v_s_proc.data)[__pyx_v_i]) = ((uint64_t)__pyx_t_11);
         }
 
         /* "cpp_common.pxd":271
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
@@ -19217,52 +23100,52 @@
         /* "cpp_common.pxd":275
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode in {'q', 'Q'}: # signed/unsigned long long             # <<<<<<<<<<<<<<
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  */
-        __Pyx_TraceLine(275,0,__PYX_ERR(1, 275, __pyx_L4_error))
+        __Pyx_TraceLine(275,0,__PYX_ERR(3, 275, __pyx_L4_error))
         CYTHON_FALLTHROUGH;
         case 81:
 
         /* "cpp_common.pxd":276
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         elif typecode in {'q', 'Q'}: # signed/unsigned long long
  *             s_proc.kind = RF_StringType.RF_UINT64             # <<<<<<<<<<<<<<
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  */
-        __Pyx_TraceLine(276,0,__PYX_ERR(1, 276, __pyx_L4_error))
+        __Pyx_TraceLine(276,0,__PYX_ERR(3, 276, __pyx_L4_error))
         __pyx_v_s_proc.kind = RF_UINT64;
 
         /* "cpp_common.pxd":277
  *         elif typecode in {'q', 'Q'}: # signed/unsigned long long
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         else: # float/double are hashed
  */
-        __Pyx_TraceLine(277,0,__PYX_ERR(1, 277, __pyx_L4_error))
+        __Pyx_TraceLine(277,0,__PYX_ERR(3, 277, __pyx_L4_error))
         __pyx_t_8 = __pyx_v_s_proc.length;
         __pyx_t_9 = __pyx_t_8;
         for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
           __pyx_v_i = __pyx_t_10;
 
           /* "cpp_common.pxd":278
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]             # <<<<<<<<<<<<<<
  *         else: # float/double are hashed
  *             s_proc.kind = RF_StringType.RF_UINT64
  */
-          __Pyx_TraceLine(278,0,__PYX_ERR(1, 278, __pyx_L4_error))
-          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 278, __pyx_L4_error)
+          __Pyx_TraceLine(278,0,__PYX_ERR(3, 278, __pyx_L4_error))
+          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 278, __pyx_L4_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_11 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_11 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(1, 278, __pyx_L4_error)
+          __pyx_t_11 = __Pyx_PyInt_As_uint64_t(__pyx_t_1); if (unlikely((__pyx_t_11 == ((uint64_t)-1)) && PyErr_Occurred())) __PYX_ERR(3, 278, __pyx_L4_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           (((uint64_t *)__pyx_v_s_proc.data)[__pyx_v_i]) = ((uint64_t)__pyx_t_11);
         }
 
         /* "cpp_common.pxd":275
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
@@ -19276,41 +23159,41 @@
         /* "cpp_common.pxd":280
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>arr[i]
  *         else: # float/double are hashed
  *             s_proc.kind = RF_StringType.RF_UINT64             # <<<<<<<<<<<<<<
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(arr[i])
  */
-        __Pyx_TraceLine(280,0,__PYX_ERR(1, 280, __pyx_L4_error))
+        __Pyx_TraceLine(280,0,__PYX_ERR(3, 280, __pyx_L4_error))
         __pyx_v_s_proc.kind = RF_UINT64;
 
         /* "cpp_common.pxd":281
  *         else: # float/double are hashed
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(arr[i])
  *     except Exception as e:
  */
-        __Pyx_TraceLine(281,0,__PYX_ERR(1, 281, __pyx_L4_error))
+        __Pyx_TraceLine(281,0,__PYX_ERR(3, 281, __pyx_L4_error))
         __pyx_t_8 = __pyx_v_s_proc.length;
         __pyx_t_9 = __pyx_t_8;
         for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
           __pyx_v_i = __pyx_t_10;
 
           /* "cpp_common.pxd":282
  *             s_proc.kind = RF_StringType.RF_UINT64
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(arr[i])             # <<<<<<<<<<<<<<
  *     except Exception as e:
  *         free(s_proc.data)
  */
-          __Pyx_TraceLine(282,0,__PYX_ERR(1, 282, __pyx_L4_error))
-          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 282, __pyx_L4_error)
+          __Pyx_TraceLine(282,0,__PYX_ERR(3, 282, __pyx_L4_error))
+          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 282, __pyx_L4_error)
           __Pyx_GOTREF(__pyx_t_1);
-          __pyx_t_12 = PyObject_Hash(__pyx_t_1); if (unlikely(__pyx_t_12 == ((Py_hash_t)-1))) __PYX_ERR(1, 282, __pyx_L4_error)
+          __pyx_t_12 = PyObject_Hash(__pyx_t_1); if (unlikely(__pyx_t_12 == ((Py_hash_t)-1))) __PYX_ERR(3, 282, __pyx_L4_error)
           __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
           (((uint64_t *)__pyx_v_s_proc.data)[__pyx_v_i]) = ((uint64_t)__pyx_t_12);
         }
         break;
       }
 
       /* "cpp_common.pxd":253
@@ -19331,70 +23214,70 @@
     /* "cpp_common.pxd":283
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(arr[i])
  *     except Exception as e:             # <<<<<<<<<<<<<<
  *         free(s_proc.data)
  *         s_proc.data = NULL
  */
-    __Pyx_TraceLine(283,0,__PYX_ERR(1, 283, __pyx_L6_except_error))
+    __Pyx_TraceLine(283,0,__PYX_ERR(3, 283, __pyx_L6_except_error))
     __pyx_t_13 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_13) {
       __Pyx_AddTraceback("cpp_common.hash_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_14, &__pyx_t_15) < 0) __PYX_ERR(1, 283, __pyx_L6_except_error)
+      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_14, &__pyx_t_15) < 0) __PYX_ERR(3, 283, __pyx_L6_except_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_GOTREF(__pyx_t_14);
       __Pyx_GOTREF(__pyx_t_15);
       __Pyx_INCREF(__pyx_t_14);
       __pyx_v_e = __pyx_t_14;
       /*try:*/ {
 
         /* "cpp_common.pxd":284
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(arr[i])
  *     except Exception as e:
  *         free(s_proc.data)             # <<<<<<<<<<<<<<
  *         s_proc.data = NULL
  *         raise
  */
-        __Pyx_TraceLine(284,0,__PYX_ERR(1, 284, __pyx_L29_error))
+        __Pyx_TraceLine(284,0,__PYX_ERR(3, 284, __pyx_L29_error))
         free(__pyx_v_s_proc.data);
 
         /* "cpp_common.pxd":285
  *     except Exception as e:
  *         free(s_proc.data)
  *         s_proc.data = NULL             # <<<<<<<<<<<<<<
  *         raise
  * 
  */
-        __Pyx_TraceLine(285,0,__PYX_ERR(1, 285, __pyx_L29_error))
+        __Pyx_TraceLine(285,0,__PYX_ERR(3, 285, __pyx_L29_error))
         __pyx_v_s_proc.data = NULL;
 
         /* "cpp_common.pxd":286
  *         free(s_proc.data)
  *         s_proc.data = NULL
  *         raise             # <<<<<<<<<<<<<<
  * 
  *     s_proc.dtor = default_string_deinit
  */
-        __Pyx_TraceLine(286,0,__PYX_ERR(1, 286, __pyx_L29_error))
+        __Pyx_TraceLine(286,0,__PYX_ERR(3, 286, __pyx_L29_error))
         __Pyx_GIVEREF(__pyx_t_1);
         __Pyx_GIVEREF(__pyx_t_14);
         __Pyx_XGIVEREF(__pyx_t_15);
         __Pyx_ErrRestoreWithState(__pyx_t_1, __pyx_t_14, __pyx_t_15);
         __pyx_t_1 = 0; __pyx_t_14 = 0; __pyx_t_15 = 0; 
-        __PYX_ERR(1, 286, __pyx_L29_error)
+        __PYX_ERR(3, 286, __pyx_L29_error)
       }
 
       /* "cpp_common.pxd":283
  *             for i in range(s_proc.length):
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(arr[i])
  *     except Exception as e:             # <<<<<<<<<<<<<<
  *         free(s_proc.data)
  *         s_proc.data = NULL
  */
-      __Pyx_TraceLine(283,0,__PYX_ERR(1, 283, __pyx_L29_error))
+      __Pyx_TraceLine(283,0,__PYX_ERR(3, 283, __pyx_L29_error))
       /*finally:*/ {
         __pyx_L29_error:;
         /*exception exit:*/{
           __Pyx_PyThreadState_declare
           __Pyx_PyThreadState_assign
           __pyx_t_18 = 0; __pyx_t_19 = 0; __pyx_t_20 = 0; __pyx_t_21 = 0; __pyx_t_22 = 0; __pyx_t_23 = 0;
           if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_21, &__pyx_t_22, &__pyx_t_23);
@@ -19446,25 +23329,25 @@
   /* "cpp_common.pxd":288
  *         raise
  * 
  *     s_proc.dtor = default_string_deinit             # <<<<<<<<<<<<<<
  *     return s_proc
  * 
  */
-  __Pyx_TraceLine(288,0,__PYX_ERR(1, 288, __pyx_L1_error))
+  __Pyx_TraceLine(288,0,__PYX_ERR(3, 288, __pyx_L1_error))
   __pyx_v_s_proc.dtor = default_string_deinit;
 
   /* "cpp_common.pxd":289
  * 
  *     s_proc.dtor = default_string_deinit
  *     return s_proc             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  __Pyx_TraceLine(289,0,__PYX_ERR(1, 289, __pyx_L1_error))
+  __Pyx_TraceLine(289,0,__PYX_ERR(3, 289, __pyx_L1_error))
   __pyx_r = __pyx_v_s_proc;
   goto __pyx_L0;
 
   /* "cpp_common.pxd":242
  *     void validate_string(object py_str, const char* err) except +
  * 
  * cdef inline RF_String hash_array(arr) except *:             # <<<<<<<<<<<<<<
@@ -19525,57 +23408,57 @@
   PyObject *__pyx_t_21 = NULL;
   PyObject *__pyx_t_22 = NULL;
   PyObject *__pyx_t_23 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("hash_sequence", 0);
-  __Pyx_TraceCall("hash_sequence", __pyx_f[1], 292, 0, __PYX_ERR(1, 292, __pyx_L1_error));
+  __Pyx_TraceCall("hash_sequence", __pyx_f[3], 292, 0, __PYX_ERR(3, 292, __pyx_L1_error));
 
   /* "cpp_common.pxd":294
  * cdef inline RF_String hash_sequence(seq) except *:
  *     cdef RF_String s_proc
  *     s_proc.length = <int64_t>len(seq)             # <<<<<<<<<<<<<<
  * 
  *     s_proc.data = malloc(s_proc.length * sizeof(uint64_t))
  */
-  __Pyx_TraceLine(294,0,__PYX_ERR(1, 294, __pyx_L1_error))
-  __pyx_t_1 = PyObject_Length(__pyx_v_seq); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(1, 294, __pyx_L1_error)
+  __Pyx_TraceLine(294,0,__PYX_ERR(3, 294, __pyx_L1_error))
+  __pyx_t_1 = PyObject_Length(__pyx_v_seq); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(3, 294, __pyx_L1_error)
   __pyx_v_s_proc.length = ((int64_t)__pyx_t_1);
 
   /* "cpp_common.pxd":296
  *     s_proc.length = <int64_t>len(seq)
  * 
  *     s_proc.data = malloc(s_proc.length * sizeof(uint64_t))             # <<<<<<<<<<<<<<
  * 
  *     if s_proc.data == NULL:
  */
-  __Pyx_TraceLine(296,0,__PYX_ERR(1, 296, __pyx_L1_error))
+  __Pyx_TraceLine(296,0,__PYX_ERR(3, 296, __pyx_L1_error))
   __pyx_v_s_proc.data = malloc((__pyx_v_s_proc.length * (sizeof(uint64_t))));
 
   /* "cpp_common.pxd":298
  *     s_proc.data = malloc(s_proc.length * sizeof(uint64_t))
  * 
  *     if s_proc.data == NULL:             # <<<<<<<<<<<<<<
  *         raise MemoryError
  * 
  */
-  __Pyx_TraceLine(298,0,__PYX_ERR(1, 298, __pyx_L1_error))
+  __Pyx_TraceLine(298,0,__PYX_ERR(3, 298, __pyx_L1_error))
   __pyx_t_2 = (__pyx_v_s_proc.data == NULL);
   if (unlikely(__pyx_t_2)) {
 
     /* "cpp_common.pxd":299
  * 
  *     if s_proc.data == NULL:
  *         raise MemoryError             # <<<<<<<<<<<<<<
  * 
  *     try:
  */
-    __Pyx_TraceLine(299,0,__PYX_ERR(1, 299, __pyx_L1_error))
-    PyErr_NoMemory(); __PYX_ERR(1, 299, __pyx_L1_error)
+    __Pyx_TraceLine(299,0,__PYX_ERR(3, 299, __pyx_L1_error))
+    PyErr_NoMemory(); __PYX_ERR(3, 299, __pyx_L1_error)
 
     /* "cpp_common.pxd":298
  *     s_proc.data = malloc(s_proc.length * sizeof(uint64_t))
  * 
  *     if s_proc.data == NULL:             # <<<<<<<<<<<<<<
  *         raise MemoryError
  * 
@@ -19585,15 +23468,15 @@
   /* "cpp_common.pxd":301
  *         raise MemoryError
  * 
  *     try:             # <<<<<<<<<<<<<<
  *         s_proc.kind = RF_StringType.RF_UINT64
  *         for i in range(s_proc.length):
  */
-  __Pyx_TraceLine(301,0,__PYX_ERR(1, 301, __pyx_L1_error))
+  __Pyx_TraceLine(301,0,__PYX_ERR(3, 301, __pyx_L1_error))
   {
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_3, &__pyx_t_4, &__pyx_t_5);
     __Pyx_XGOTREF(__pyx_t_3);
     __Pyx_XGOTREF(__pyx_t_4);
     __Pyx_XGOTREF(__pyx_t_5);
@@ -19602,72 +23485,72 @@
       /* "cpp_common.pxd":302
  * 
  *     try:
  *         s_proc.kind = RF_StringType.RF_UINT64             # <<<<<<<<<<<<<<
  *         for i in range(s_proc.length):
  *             elem = seq[i]
  */
-      __Pyx_TraceLine(302,0,__PYX_ERR(1, 302, __pyx_L4_error))
+      __Pyx_TraceLine(302,0,__PYX_ERR(3, 302, __pyx_L4_error))
       __pyx_v_s_proc.kind = RF_UINT64;
 
       /* "cpp_common.pxd":303
  *     try:
  *         s_proc.kind = RF_StringType.RF_UINT64
  *         for i in range(s_proc.length):             # <<<<<<<<<<<<<<
  *             elem = seq[i]
  *             # this is required so e.g. a list of char can be compared to a string
  */
-      __Pyx_TraceLine(303,0,__PYX_ERR(1, 303, __pyx_L4_error))
+      __Pyx_TraceLine(303,0,__PYX_ERR(3, 303, __pyx_L4_error))
       __pyx_t_6 = __pyx_v_s_proc.length;
       __pyx_t_7 = __pyx_t_6;
       for (__pyx_t_8 = 0; __pyx_t_8 < __pyx_t_7; __pyx_t_8+=1) {
         __pyx_v_i = __pyx_t_8;
 
         /* "cpp_common.pxd":304
  *         s_proc.kind = RF_StringType.RF_UINT64
  *         for i in range(s_proc.length):
  *             elem = seq[i]             # <<<<<<<<<<<<<<
  *             # this is required so e.g. a list of char can be compared to a string
  *             if isinstance(elem, str) and len(elem) == 1:
  */
-        __Pyx_TraceLine(304,0,__PYX_ERR(1, 304, __pyx_L4_error))
-        __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_seq, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 304, __pyx_L4_error)
+        __Pyx_TraceLine(304,0,__PYX_ERR(3, 304, __pyx_L4_error))
+        __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_seq, __pyx_v_i, int64_t, 1, __Pyx_PyInt_From_int64_t, 0, 1, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(3, 304, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_9);
         __Pyx_XDECREF_SET(__pyx_v_elem, __pyx_t_9);
         __pyx_t_9 = 0;
 
         /* "cpp_common.pxd":306
  *             elem = seq[i]
  *             # this is required so e.g. a list of char can be compared to a string
  *             if isinstance(elem, str) and len(elem) == 1:             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>elem
  *             elif isinstance(elem, int) and elem == -1:
  */
-        __Pyx_TraceLine(306,0,__PYX_ERR(1, 306, __pyx_L4_error))
+        __Pyx_TraceLine(306,0,__PYX_ERR(3, 306, __pyx_L4_error))
         __pyx_t_10 = PyUnicode_Check(__pyx_v_elem); 
         if (__pyx_t_10) {
         } else {
           __pyx_t_2 = __pyx_t_10;
           goto __pyx_L13_bool_binop_done;
         }
-        __pyx_t_1 = PyObject_Length(__pyx_v_elem); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(1, 306, __pyx_L4_error)
+        __pyx_t_1 = PyObject_Length(__pyx_v_elem); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(3, 306, __pyx_L4_error)
         __pyx_t_10 = (__pyx_t_1 == 1);
         __pyx_t_2 = __pyx_t_10;
         __pyx_L13_bool_binop_done:;
         if (__pyx_t_2) {
 
           /* "cpp_common.pxd":307
  *             # this is required so e.g. a list of char can be compared to a string
  *             if isinstance(elem, str) and len(elem) == 1:
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>elem             # <<<<<<<<<<<<<<
  *             elif isinstance(elem, int) and elem == -1:
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>-1
  */
-          __Pyx_TraceLine(307,0,__PYX_ERR(1, 307, __pyx_L4_error))
-          __pyx_t_11 = __Pyx_PyObject_AsPy_UCS4(__pyx_v_elem); if (unlikely((__pyx_t_11 == (Py_UCS4)-1) && PyErr_Occurred())) __PYX_ERR(1, 307, __pyx_L4_error)
+          __Pyx_TraceLine(307,0,__PYX_ERR(3, 307, __pyx_L4_error))
+          __pyx_t_11 = __Pyx_PyObject_AsPy_UCS4(__pyx_v_elem); if (unlikely((__pyx_t_11 == (Py_UCS4)-1) && PyErr_Occurred())) __PYX_ERR(3, 307, __pyx_L4_error)
           (((uint64_t *)__pyx_v_s_proc.data)[__pyx_v_i]) = ((uint64_t)((Py_UCS4)__pyx_t_11));
 
           /* "cpp_common.pxd":306
  *             elem = seq[i]
  *             # this is required so e.g. a list of char can be compared to a string
  *             if isinstance(elem, str) and len(elem) == 1:             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>elem
@@ -19679,37 +23562,37 @@
         /* "cpp_common.pxd":308
  *             if isinstance(elem, str) and len(elem) == 1:
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>elem
  *             elif isinstance(elem, int) and elem == -1:             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>-1
  *             else:
  */
-        __Pyx_TraceLine(308,0,__PYX_ERR(1, 308, __pyx_L4_error))
+        __Pyx_TraceLine(308,0,__PYX_ERR(3, 308, __pyx_L4_error))
         __pyx_t_10 = PyInt_Check(__pyx_v_elem); 
         if (__pyx_t_10) {
         } else {
           __pyx_t_2 = __pyx_t_10;
           goto __pyx_L15_bool_binop_done;
         }
-        __pyx_t_9 = __Pyx_PyInt_EqObjC(__pyx_v_elem, __pyx_int_neg_1, -1L, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 308, __pyx_L4_error)
+        __pyx_t_9 = __Pyx_PyInt_EqObjC(__pyx_v_elem, __pyx_int_neg_1, -1L, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(3, 308, __pyx_L4_error)
         __Pyx_GOTREF(__pyx_t_9);
-        __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(1, 308, __pyx_L4_error)
+        __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(3, 308, __pyx_L4_error)
         __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
         __pyx_t_2 = __pyx_t_10;
         __pyx_L15_bool_binop_done:;
         if (__pyx_t_2) {
 
           /* "cpp_common.pxd":309
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>elem
  *             elif isinstance(elem, int) and elem == -1:
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>-1             # <<<<<<<<<<<<<<
  *             else:
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(elem)
  */
-          __Pyx_TraceLine(309,0,__PYX_ERR(1, 309, __pyx_L4_error))
+          __Pyx_TraceLine(309,0,__PYX_ERR(3, 309, __pyx_L4_error))
           (((uint64_t *)__pyx_v_s_proc.data)[__pyx_v_i]) = ((uint64_t)-1L);
 
           /* "cpp_common.pxd":308
  *             if isinstance(elem, str) and len(elem) == 1:
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t><Py_UCS4>elem
  *             elif isinstance(elem, int) and elem == -1:             # <<<<<<<<<<<<<<
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>-1
@@ -19721,17 +23604,17 @@
         /* "cpp_common.pxd":311
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>-1
  *             else:
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(elem)             # <<<<<<<<<<<<<<
  *     except Exception as e:
  *         free(s_proc.data)
  */
-        __Pyx_TraceLine(311,0,__PYX_ERR(1, 311, __pyx_L4_error))
+        __Pyx_TraceLine(311,0,__PYX_ERR(3, 311, __pyx_L4_error))
         /*else*/ {
-          __pyx_t_12 = PyObject_Hash(__pyx_v_elem); if (unlikely(__pyx_t_12 == ((Py_hash_t)-1))) __PYX_ERR(1, 311, __pyx_L4_error)
+          __pyx_t_12 = PyObject_Hash(__pyx_v_elem); if (unlikely(__pyx_t_12 == ((Py_hash_t)-1))) __PYX_ERR(3, 311, __pyx_L4_error)
           (((uint64_t *)__pyx_v_s_proc.data)[__pyx_v_i]) = ((uint64_t)__pyx_t_12);
         }
         __pyx_L12:;
       }
 
       /* "cpp_common.pxd":301
  *         raise MemoryError
@@ -19751,70 +23634,70 @@
     /* "cpp_common.pxd":312
  *             else:
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(elem)
  *     except Exception as e:             # <<<<<<<<<<<<<<
  *         free(s_proc.data)
  *         s_proc.data = NULL
  */
-    __Pyx_TraceLine(312,0,__PYX_ERR(1, 312, __pyx_L6_except_error))
+    __Pyx_TraceLine(312,0,__PYX_ERR(3, 312, __pyx_L6_except_error))
     __pyx_t_13 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
     if (__pyx_t_13) {
       __Pyx_AddTraceback("cpp_common.hash_sequence", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_9, &__pyx_t_14, &__pyx_t_15) < 0) __PYX_ERR(1, 312, __pyx_L6_except_error)
+      if (__Pyx_GetException(&__pyx_t_9, &__pyx_t_14, &__pyx_t_15) < 0) __PYX_ERR(3, 312, __pyx_L6_except_error)
       __Pyx_GOTREF(__pyx_t_9);
       __Pyx_GOTREF(__pyx_t_14);
       __Pyx_GOTREF(__pyx_t_15);
       __Pyx_INCREF(__pyx_t_14);
       __pyx_v_e = __pyx_t_14;
       /*try:*/ {
 
         /* "cpp_common.pxd":313
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(elem)
  *     except Exception as e:
  *         free(s_proc.data)             # <<<<<<<<<<<<<<
  *         s_proc.data = NULL
  *         raise
  */
-        __Pyx_TraceLine(313,0,__PYX_ERR(1, 313, __pyx_L22_error))
+        __Pyx_TraceLine(313,0,__PYX_ERR(3, 313, __pyx_L22_error))
         free(__pyx_v_s_proc.data);
 
         /* "cpp_common.pxd":314
  *     except Exception as e:
  *         free(s_proc.data)
  *         s_proc.data = NULL             # <<<<<<<<<<<<<<
  *         raise
  * 
  */
-        __Pyx_TraceLine(314,0,__PYX_ERR(1, 314, __pyx_L22_error))
+        __Pyx_TraceLine(314,0,__PYX_ERR(3, 314, __pyx_L22_error))
         __pyx_v_s_proc.data = NULL;
 
         /* "cpp_common.pxd":315
  *         free(s_proc.data)
  *         s_proc.data = NULL
  *         raise             # <<<<<<<<<<<<<<
  * 
  *     s_proc.dtor = default_string_deinit
  */
-        __Pyx_TraceLine(315,0,__PYX_ERR(1, 315, __pyx_L22_error))
+        __Pyx_TraceLine(315,0,__PYX_ERR(3, 315, __pyx_L22_error))
         __Pyx_GIVEREF(__pyx_t_9);
         __Pyx_GIVEREF(__pyx_t_14);
         __Pyx_XGIVEREF(__pyx_t_15);
         __Pyx_ErrRestoreWithState(__pyx_t_9, __pyx_t_14, __pyx_t_15);
         __pyx_t_9 = 0; __pyx_t_14 = 0; __pyx_t_15 = 0; 
-        __PYX_ERR(1, 315, __pyx_L22_error)
+        __PYX_ERR(3, 315, __pyx_L22_error)
       }
 
       /* "cpp_common.pxd":312
  *             else:
  *                 (<uint64_t*>s_proc.data)[i] = <uint64_t>hash(elem)
  *     except Exception as e:             # <<<<<<<<<<<<<<
  *         free(s_proc.data)
  *         s_proc.data = NULL
  */
-      __Pyx_TraceLine(312,0,__PYX_ERR(1, 312, __pyx_L22_error))
+      __Pyx_TraceLine(312,0,__PYX_ERR(3, 312, __pyx_L22_error))
       /*finally:*/ {
         __pyx_L22_error:;
         /*exception exit:*/{
           __Pyx_PyThreadState_declare
           __Pyx_PyThreadState_assign
           __pyx_t_18 = 0; __pyx_t_19 = 0; __pyx_t_20 = 0; __pyx_t_21 = 0; __pyx_t_22 = 0; __pyx_t_23 = 0;
           if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_21, &__pyx_t_22, &__pyx_t_23);
@@ -19866,25 +23749,25 @@
   /* "cpp_common.pxd":317
  *         raise
  * 
  *     s_proc.dtor = default_string_deinit             # <<<<<<<<<<<<<<
  *     return s_proc
  * 
  */
-  __Pyx_TraceLine(317,0,__PYX_ERR(1, 317, __pyx_L1_error))
+  __Pyx_TraceLine(317,0,__PYX_ERR(3, 317, __pyx_L1_error))
   __pyx_v_s_proc.dtor = default_string_deinit;
 
   /* "cpp_common.pxd":318
  * 
  *     s_proc.dtor = default_string_deinit
  *     return s_proc             # <<<<<<<<<<<<<<
  * 
  * cdef inline RF_String conv_sequence(seq) except *:
  */
-  __Pyx_TraceLine(318,0,__PYX_ERR(1, 318, __pyx_L1_error))
+  __Pyx_TraceLine(318,0,__PYX_ERR(3, 318, __pyx_L1_error))
   __pyx_r = __pyx_v_s_proc;
   goto __pyx_L0;
 
   /* "cpp_common.pxd":292
  * 
  * 
  * cdef inline RF_String hash_sequence(seq) except *:             # <<<<<<<<<<<<<<
@@ -19923,41 +23806,41 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   RF_String __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("conv_sequence", 0);
-  __Pyx_TraceCall("conv_sequence", __pyx_f[1], 320, 0, __PYX_ERR(1, 320, __pyx_L1_error));
+  __Pyx_TraceCall("conv_sequence", __pyx_f[3], 320, 0, __PYX_ERR(3, 320, __pyx_L1_error));
 
   /* "cpp_common.pxd":321
  * 
  * cdef inline RF_String conv_sequence(seq) except *:
  *     if is_valid_string(seq):             # <<<<<<<<<<<<<<
  *         return move(convert_string(seq))
  *     elif isinstance(seq, array):
  */
-  __Pyx_TraceLine(321,0,__PYX_ERR(1, 321, __pyx_L1_error))
+  __Pyx_TraceLine(321,0,__PYX_ERR(3, 321, __pyx_L1_error))
   try {
     __pyx_t_1 = is_valid_string(__pyx_v_seq);
   } catch(...) {
     __Pyx_CppExn2PyErr();
-    __PYX_ERR(1, 321, __pyx_L1_error)
+    __PYX_ERR(3, 321, __pyx_L1_error)
   }
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
     /* "cpp_common.pxd":322
  * cdef inline RF_String conv_sequence(seq) except *:
  *     if is_valid_string(seq):
  *         return move(convert_string(seq))             # <<<<<<<<<<<<<<
  *     elif isinstance(seq, array):
  *         return move(hash_array(seq))
  */
-    __Pyx_TraceLine(322,0,__PYX_ERR(1, 322, __pyx_L1_error))
+    __Pyx_TraceLine(322,0,__PYX_ERR(3, 322, __pyx_L1_error))
     __pyx_r = cython_std::move<RF_String>(convert_string(__pyx_v_seq));
     goto __pyx_L0;
 
     /* "cpp_common.pxd":321
  * 
  * cdef inline RF_String conv_sequence(seq) except *:
  *     if is_valid_string(seq):             # <<<<<<<<<<<<<<
@@ -19969,30 +23852,30 @@
   /* "cpp_common.pxd":323
  *     if is_valid_string(seq):
  *         return move(convert_string(seq))
  *     elif isinstance(seq, array):             # <<<<<<<<<<<<<<
  *         return move(hash_array(seq))
  *     else:
  */
-  __Pyx_TraceLine(323,0,__PYX_ERR(1, 323, __pyx_L1_error))
-  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 323, __pyx_L1_error)
+  __Pyx_TraceLine(323,0,__PYX_ERR(3, 323, __pyx_L1_error))
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_3)) __PYX_ERR(3, 323, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = PyObject_IsInstance(__pyx_v_seq, __pyx_t_3); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(1, 323, __pyx_L1_error)
+  __pyx_t_2 = PyObject_IsInstance(__pyx_v_seq, __pyx_t_3); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(3, 323, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   if (__pyx_t_2) {
 
     /* "cpp_common.pxd":324
  *         return move(convert_string(seq))
  *     elif isinstance(seq, array):
  *         return move(hash_array(seq))             # <<<<<<<<<<<<<<
  *     else:
  *         return move(hash_sequence(seq))
  */
-    __Pyx_TraceLine(324,0,__PYX_ERR(1, 324, __pyx_L1_error))
-    __pyx_t_4 = __pyx_f_10cpp_common_hash_array(__pyx_v_seq); if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 324, __pyx_L1_error)
+    __Pyx_TraceLine(324,0,__PYX_ERR(3, 324, __pyx_L1_error))
+    __pyx_t_4 = __pyx_f_10cpp_common_hash_array(__pyx_v_seq); if (unlikely(PyErr_Occurred())) __PYX_ERR(3, 324, __pyx_L1_error)
     __pyx_r = cython_std::move<RF_String>(__pyx_t_4);
     goto __pyx_L0;
 
     /* "cpp_common.pxd":323
  *     if is_valid_string(seq):
  *         return move(convert_string(seq))
  *     elif isinstance(seq, array):             # <<<<<<<<<<<<<<
@@ -20004,17 +23887,17 @@
   /* "cpp_common.pxd":326
  *         return move(hash_array(seq))
  *     else:
  *         return move(hash_sequence(seq))             # <<<<<<<<<<<<<<
  * 
  * cdef inline double get_score_cutoff_f64(score_cutoff, const RF_ScorerFlags* scorer_flags) except *:
  */
-  __Pyx_TraceLine(326,0,__PYX_ERR(1, 326, __pyx_L1_error))
+  __Pyx_TraceLine(326,0,__PYX_ERR(3, 326, __pyx_L1_error))
   /*else*/ {
-    __pyx_t_4 = __pyx_f_10cpp_common_hash_sequence(__pyx_v_seq); if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 326, __pyx_L1_error)
+    __pyx_t_4 = __pyx_f_10cpp_common_hash_sequence(__pyx_v_seq); if (unlikely(PyErr_Occurred())) __PYX_ERR(3, 326, __pyx_L1_error)
     __pyx_r = cython_std::move<RF_String>(__pyx_t_4);
     goto __pyx_L0;
   }
 
   /* "cpp_common.pxd":320
  *     return s_proc
  * 
@@ -20057,162 +23940,162 @@
   Py_ssize_t __pyx_t_6;
   Py_UCS4 __pyx_t_7;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_score_cutoff_f64", 0);
-  __Pyx_TraceCall("get_score_cutoff_f64", __pyx_f[1], 328, 0, __PYX_ERR(1, 328, __pyx_L1_error));
+  __Pyx_TraceCall("get_score_cutoff_f64", __pyx_f[3], 328, 0, __PYX_ERR(3, 328, __pyx_L1_error));
 
   /* "cpp_common.pxd":329
  * 
  * cdef inline double get_score_cutoff_f64(score_cutoff, const RF_ScorerFlags* scorer_flags) except *:
  *     worst_score = dereference(scorer_flags).worst_score.f64             # <<<<<<<<<<<<<<
  *     optimal_score = dereference(scorer_flags).optimal_score.f64
  *     c_score_cutoff = worst_score
  */
-  __Pyx_TraceLine(329,0,__PYX_ERR(1, 329, __pyx_L1_error))
+  __Pyx_TraceLine(329,0,__PYX_ERR(3, 329, __pyx_L1_error))
   __pyx_t_1 = (*__pyx_v_scorer_flags).worst_score.f64;
   __pyx_v_worst_score = __pyx_t_1;
 
   /* "cpp_common.pxd":330
  * cdef inline double get_score_cutoff_f64(score_cutoff, const RF_ScorerFlags* scorer_flags) except *:
  *     worst_score = dereference(scorer_flags).worst_score.f64
  *     optimal_score = dereference(scorer_flags).optimal_score.f64             # <<<<<<<<<<<<<<
  *     c_score_cutoff = worst_score
  * 
  */
-  __Pyx_TraceLine(330,0,__PYX_ERR(1, 330, __pyx_L1_error))
+  __Pyx_TraceLine(330,0,__PYX_ERR(3, 330, __pyx_L1_error))
   __pyx_t_1 = (*__pyx_v_scorer_flags).optimal_score.f64;
   __pyx_v_optimal_score = __pyx_t_1;
 
   /* "cpp_common.pxd":331
  *     worst_score = dereference(scorer_flags).worst_score.f64
  *     optimal_score = dereference(scorer_flags).optimal_score.f64
  *     c_score_cutoff = worst_score             # <<<<<<<<<<<<<<
  * 
  *     if score_cutoff is not None:
  */
-  __Pyx_TraceLine(331,0,__PYX_ERR(1, 331, __pyx_L1_error))
-  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 331, __pyx_L1_error)
+  __Pyx_TraceLine(331,0,__PYX_ERR(3, 331, __pyx_L1_error))
+  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 331, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_c_score_cutoff = __pyx_t_2;
   __pyx_t_2 = 0;
 
   /* "cpp_common.pxd":333
  *     c_score_cutoff = worst_score
  * 
  *     if score_cutoff is not None:             # <<<<<<<<<<<<<<
  *         c_score_cutoff = score_cutoff
  *         if optimal_score > worst_score:
  */
-  __Pyx_TraceLine(333,0,__PYX_ERR(1, 333, __pyx_L1_error))
+  __Pyx_TraceLine(333,0,__PYX_ERR(3, 333, __pyx_L1_error))
   __pyx_t_3 = (__pyx_v_score_cutoff != Py_None);
   if (__pyx_t_3) {
 
     /* "cpp_common.pxd":334
  * 
  *     if score_cutoff is not None:
  *         c_score_cutoff = score_cutoff             # <<<<<<<<<<<<<<
  *         if optimal_score > worst_score:
  *             # e.g. 0.0 - 100.0
  */
-    __Pyx_TraceLine(334,0,__PYX_ERR(1, 334, __pyx_L1_error))
+    __Pyx_TraceLine(334,0,__PYX_ERR(3, 334, __pyx_L1_error))
     __Pyx_INCREF(__pyx_v_score_cutoff);
     __Pyx_DECREF_SET(__pyx_v_c_score_cutoff, __pyx_v_score_cutoff);
 
     /* "cpp_common.pxd":335
  *     if score_cutoff is not None:
  *         c_score_cutoff = score_cutoff
  *         if optimal_score > worst_score:             # <<<<<<<<<<<<<<
  *             # e.g. 0.0 - 100.0
  *             if c_score_cutoff < worst_score or c_score_cutoff > optimal_score:
  */
-    __Pyx_TraceLine(335,0,__PYX_ERR(1, 335, __pyx_L1_error))
+    __Pyx_TraceLine(335,0,__PYX_ERR(3, 335, __pyx_L1_error))
     __pyx_t_3 = (__pyx_v_optimal_score > __pyx_v_worst_score);
     if (__pyx_t_3) {
 
       /* "cpp_common.pxd":337
  *         if optimal_score > worst_score:
  *             # e.g. 0.0 - 100.0
  *             if c_score_cutoff < worst_score or c_score_cutoff > optimal_score:             # <<<<<<<<<<<<<<
  *                 raise TypeError(f"score_cutoff has to be in the range of {worst_score} - {optimal_score}")
  *         else:
  */
-      __Pyx_TraceLine(337,0,__PYX_ERR(1, 337, __pyx_L1_error))
-      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 337, __pyx_L1_error)
+      __Pyx_TraceLine(337,0,__PYX_ERR(3, 337, __pyx_L1_error))
+      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 337, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_4 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_2, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 337, __pyx_L1_error)
+      __pyx_t_4 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_2, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 337, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(1, 337, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(3, 337, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       if (!__pyx_t_5) {
       } else {
         __pyx_t_3 = __pyx_t_5;
         goto __pyx_L6_bool_binop_done;
       }
-      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 337, __pyx_L1_error)
+      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 337, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_2 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_4, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 337, __pyx_L1_error)
+      __pyx_t_2 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_4, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 337, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(1, 337, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(3, 337, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __pyx_t_3 = __pyx_t_5;
       __pyx_L6_bool_binop_done:;
       if (unlikely(__pyx_t_3)) {
 
         /* "cpp_common.pxd":338
  *             # e.g. 0.0 - 100.0
  *             if c_score_cutoff < worst_score or c_score_cutoff > optimal_score:
  *                 raise TypeError(f"score_cutoff has to be in the range of {worst_score} - {optimal_score}")             # <<<<<<<<<<<<<<
  *         else:
  *             # e.g. DBL_MAX - 0
  */
-        __Pyx_TraceLine(338,0,__PYX_ERR(1, 338, __pyx_L1_error))
-        __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 338, __pyx_L1_error)
+        __Pyx_TraceLine(338,0,__PYX_ERR(3, 338, __pyx_L1_error))
+        __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_6 = 0;
         __pyx_t_7 = 127;
         __Pyx_INCREF(__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
         __pyx_t_6 += 39;
         __Pyx_GIVEREF(__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
         PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
-        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 338, __pyx_L1_error)
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 338, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(3, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__16);
+        __Pyx_INCREF(__pyx_kp_u__19);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__16);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__16);
-        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 338, __pyx_L1_error)
+        __Pyx_GIVEREF(__pyx_kp_u__19);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__19);
+        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(3, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 338, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
         __Pyx_GIVEREF(__pyx_t_4);
         PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_t_4);
         __pyx_t_4 = 0;
-        __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 338, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 338, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 338, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_Raise(__pyx_t_2, 0, 0, 0);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __PYX_ERR(1, 338, __pyx_L1_error)
+        __PYX_ERR(3, 338, __pyx_L1_error)
 
         /* "cpp_common.pxd":337
  *         if optimal_score > worst_score:
  *             # e.g. 0.0 - 100.0
  *             if c_score_cutoff < worst_score or c_score_cutoff > optimal_score:             # <<<<<<<<<<<<<<
  *                 raise TypeError(f"score_cutoff has to be in the range of {worst_score} - {optimal_score}")
  *         else:
@@ -20232,86 +24115,86 @@
     /* "cpp_common.pxd":341
  *         else:
  *             # e.g. DBL_MAX - 0
  *             if c_score_cutoff > worst_score or c_score_cutoff < optimal_score:             # <<<<<<<<<<<<<<
  *                 raise TypeError(f"score_cutoff has to be in the range of {optimal_score} - {worst_score}")
  * 
  */
-    __Pyx_TraceLine(341,0,__PYX_ERR(1, 341, __pyx_L1_error))
+    __Pyx_TraceLine(341,0,__PYX_ERR(3, 341, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 341, __pyx_L1_error)
+      __pyx_t_2 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 341, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_4 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_2, Py_GT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 341, __pyx_L1_error)
+      __pyx_t_4 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_2, Py_GT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 341, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(1, 341, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(3, 341, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       if (!__pyx_t_5) {
       } else {
         __pyx_t_3 = __pyx_t_5;
         goto __pyx_L9_bool_binop_done;
       }
-      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 341, __pyx_L1_error)
+      __pyx_t_4 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 341, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_2 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_4, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 341, __pyx_L1_error)
+      __pyx_t_2 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_4, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 341, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(1, 341, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(3, 341, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __pyx_t_3 = __pyx_t_5;
       __pyx_L9_bool_binop_done:;
       if (unlikely(__pyx_t_3)) {
 
         /* "cpp_common.pxd":342
  *             # e.g. DBL_MAX - 0
  *             if c_score_cutoff > worst_score or c_score_cutoff < optimal_score:
  *                 raise TypeError(f"score_cutoff has to be in the range of {optimal_score} - {worst_score}")             # <<<<<<<<<<<<<<
  * 
  *     return c_score_cutoff
  */
-        __Pyx_TraceLine(342,0,__PYX_ERR(1, 342, __pyx_L1_error))
-        __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 342, __pyx_L1_error)
+        __Pyx_TraceLine(342,0,__PYX_ERR(3, 342, __pyx_L1_error))
+        __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_6 = 0;
         __pyx_t_7 = 127;
         __Pyx_INCREF(__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
         __pyx_t_6 += 39;
         __Pyx_GIVEREF(__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
         PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
-        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 342, __pyx_L1_error)
+        __pyx_t_4 = PyFloat_FromDouble(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 342, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(3, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__16);
+        __Pyx_INCREF(__pyx_kp_u__19);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__16);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__16);
-        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 342, __pyx_L1_error)
+        __Pyx_GIVEREF(__pyx_kp_u__19);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__19);
+        __pyx_t_8 = PyFloat_FromDouble(__pyx_v_worst_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(3, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 342, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
         __Pyx_GIVEREF(__pyx_t_4);
         PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_t_4);
         __pyx_t_4 = 0;
-        __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 342, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 342, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 342, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_Raise(__pyx_t_2, 0, 0, 0);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __PYX_ERR(1, 342, __pyx_L1_error)
+        __PYX_ERR(3, 342, __pyx_L1_error)
 
         /* "cpp_common.pxd":341
  *         else:
  *             # e.g. DBL_MAX - 0
  *             if c_score_cutoff > worst_score or c_score_cutoff < optimal_score:             # <<<<<<<<<<<<<<
  *                 raise TypeError(f"score_cutoff has to be in the range of {optimal_score} - {worst_score}")
  * 
@@ -20332,16 +24215,16 @@
   /* "cpp_common.pxd":344
  *                 raise TypeError(f"score_cutoff has to be in the range of {optimal_score} - {worst_score}")
  * 
  *     return c_score_cutoff             # <<<<<<<<<<<<<<
  * 
  * cdef inline int64_t get_score_cutoff_i64(score_cutoff, const RF_ScorerFlags* scorer_flags) except *:
  */
-  __Pyx_TraceLine(344,0,__PYX_ERR(1, 344, __pyx_L1_error))
-  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_c_score_cutoff); if (unlikely((__pyx_t_1 == (double)-1) && PyErr_Occurred())) __PYX_ERR(1, 344, __pyx_L1_error)
+  __Pyx_TraceLine(344,0,__PYX_ERR(3, 344, __pyx_L1_error))
+  __pyx_t_1 = __pyx_PyFloat_AsDouble(__pyx_v_c_score_cutoff); if (unlikely((__pyx_t_1 == (double)-1) && PyErr_Occurred())) __PYX_ERR(3, 344, __pyx_L1_error)
   __pyx_r = __pyx_t_1;
   goto __pyx_L0;
 
   /* "cpp_common.pxd":328
  *         return move(hash_sequence(seq))
  * 
  * cdef inline double get_score_cutoff_f64(score_cutoff, const RF_ScorerFlags* scorer_flags) except *:             # <<<<<<<<<<<<<<
@@ -20386,162 +24269,162 @@
   Py_ssize_t __pyx_t_6;
   Py_UCS4 __pyx_t_7;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_score_cutoff_i64", 0);
-  __Pyx_TraceCall("get_score_cutoff_i64", __pyx_f[1], 346, 0, __PYX_ERR(1, 346, __pyx_L1_error));
+  __Pyx_TraceCall("get_score_cutoff_i64", __pyx_f[3], 346, 0, __PYX_ERR(3, 346, __pyx_L1_error));
 
   /* "cpp_common.pxd":347
  * 
  * cdef inline int64_t get_score_cutoff_i64(score_cutoff, const RF_ScorerFlags* scorer_flags) except *:
  *     worst_score = dereference(scorer_flags).worst_score.i64             # <<<<<<<<<<<<<<
  *     optimal_score = dereference(scorer_flags).optimal_score.i64
  *     c_score_cutoff = worst_score
  */
-  __Pyx_TraceLine(347,0,__PYX_ERR(1, 347, __pyx_L1_error))
+  __Pyx_TraceLine(347,0,__PYX_ERR(3, 347, __pyx_L1_error))
   __pyx_t_1 = (*__pyx_v_scorer_flags).worst_score.i64;
   __pyx_v_worst_score = __pyx_t_1;
 
   /* "cpp_common.pxd":348
  * cdef inline int64_t get_score_cutoff_i64(score_cutoff, const RF_ScorerFlags* scorer_flags) except *:
  *     worst_score = dereference(scorer_flags).worst_score.i64
  *     optimal_score = dereference(scorer_flags).optimal_score.i64             # <<<<<<<<<<<<<<
  *     c_score_cutoff = worst_score
  * 
  */
-  __Pyx_TraceLine(348,0,__PYX_ERR(1, 348, __pyx_L1_error))
+  __Pyx_TraceLine(348,0,__PYX_ERR(3, 348, __pyx_L1_error))
   __pyx_t_1 = (*__pyx_v_scorer_flags).optimal_score.i64;
   __pyx_v_optimal_score = __pyx_t_1;
 
   /* "cpp_common.pxd":349
  *     worst_score = dereference(scorer_flags).worst_score.i64
  *     optimal_score = dereference(scorer_flags).optimal_score.i64
  *     c_score_cutoff = worst_score             # <<<<<<<<<<<<<<
  * 
  *     if score_cutoff is not None:
  */
-  __Pyx_TraceLine(349,0,__PYX_ERR(1, 349, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 349, __pyx_L1_error)
+  __Pyx_TraceLine(349,0,__PYX_ERR(3, 349, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_c_score_cutoff = __pyx_t_2;
   __pyx_t_2 = 0;
 
   /* "cpp_common.pxd":351
  *     c_score_cutoff = worst_score
  * 
  *     if score_cutoff is not None:             # <<<<<<<<<<<<<<
  *         c_score_cutoff = score_cutoff
  *         if optimal_score > worst_score:
  */
-  __Pyx_TraceLine(351,0,__PYX_ERR(1, 351, __pyx_L1_error))
+  __Pyx_TraceLine(351,0,__PYX_ERR(3, 351, __pyx_L1_error))
   __pyx_t_3 = (__pyx_v_score_cutoff != Py_None);
   if (__pyx_t_3) {
 
     /* "cpp_common.pxd":352
  * 
  *     if score_cutoff is not None:
  *         c_score_cutoff = score_cutoff             # <<<<<<<<<<<<<<
  *         if optimal_score > worst_score:
  *             # e.g. 0.0 - 100.0
  */
-    __Pyx_TraceLine(352,0,__PYX_ERR(1, 352, __pyx_L1_error))
+    __Pyx_TraceLine(352,0,__PYX_ERR(3, 352, __pyx_L1_error))
     __Pyx_INCREF(__pyx_v_score_cutoff);
     __Pyx_DECREF_SET(__pyx_v_c_score_cutoff, __pyx_v_score_cutoff);
 
     /* "cpp_common.pxd":353
  *     if score_cutoff is not None:
  *         c_score_cutoff = score_cutoff
  *         if optimal_score > worst_score:             # <<<<<<<<<<<<<<
  *             # e.g. 0.0 - 100.0
  *             if c_score_cutoff < worst_score or c_score_cutoff > optimal_score:
  */
-    __Pyx_TraceLine(353,0,__PYX_ERR(1, 353, __pyx_L1_error))
+    __Pyx_TraceLine(353,0,__PYX_ERR(3, 353, __pyx_L1_error))
     __pyx_t_3 = (__pyx_v_optimal_score > __pyx_v_worst_score);
     if (__pyx_t_3) {
 
       /* "cpp_common.pxd":355
  *         if optimal_score > worst_score:
  *             # e.g. 0.0 - 100.0
  *             if c_score_cutoff < worst_score or c_score_cutoff > optimal_score:             # <<<<<<<<<<<<<<
  *                 raise TypeError(f"score_cutoff has to be in the range of {worst_score} - {optimal_score}")
  *         else:
  */
-      __Pyx_TraceLine(355,0,__PYX_ERR(1, 355, __pyx_L1_error))
-      __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 355, __pyx_L1_error)
+      __Pyx_TraceLine(355,0,__PYX_ERR(3, 355, __pyx_L1_error))
+      __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 355, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_4 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_2, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 355, __pyx_L1_error)
+      __pyx_t_4 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_2, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 355, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(1, 355, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(3, 355, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       if (!__pyx_t_5) {
       } else {
         __pyx_t_3 = __pyx_t_5;
         goto __pyx_L6_bool_binop_done;
       }
-      __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 355, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 355, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_2 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_4, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 355, __pyx_L1_error)
+      __pyx_t_2 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_4, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 355, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(1, 355, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(3, 355, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __pyx_t_3 = __pyx_t_5;
       __pyx_L6_bool_binop_done:;
       if (unlikely(__pyx_t_3)) {
 
         /* "cpp_common.pxd":356
  *             # e.g. 0.0 - 100.0
  *             if c_score_cutoff < worst_score or c_score_cutoff > optimal_score:
  *                 raise TypeError(f"score_cutoff has to be in the range of {worst_score} - {optimal_score}")             # <<<<<<<<<<<<<<
  *         else:
  *             # e.g. DBL_MAX - 0
  */
-        __Pyx_TraceLine(356,0,__PYX_ERR(1, 356, __pyx_L1_error))
-        __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 356, __pyx_L1_error)
+        __Pyx_TraceLine(356,0,__PYX_ERR(3, 356, __pyx_L1_error))
+        __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_6 = 0;
         __pyx_t_7 = 127;
         __Pyx_INCREF(__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
         __pyx_t_6 += 39;
         __Pyx_GIVEREF(__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
         PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
-        __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 356, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 356, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(3, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__16);
+        __Pyx_INCREF(__pyx_kp_u__19);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__16);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__16);
-        __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 356, __pyx_L1_error)
+        __Pyx_GIVEREF(__pyx_kp_u__19);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__19);
+        __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(3, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 356, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
         __Pyx_GIVEREF(__pyx_t_4);
         PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_t_4);
         __pyx_t_4 = 0;
-        __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 356, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 356, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 356, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_Raise(__pyx_t_2, 0, 0, 0);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __PYX_ERR(1, 356, __pyx_L1_error)
+        __PYX_ERR(3, 356, __pyx_L1_error)
 
         /* "cpp_common.pxd":355
  *         if optimal_score > worst_score:
  *             # e.g. 0.0 - 100.0
  *             if c_score_cutoff < worst_score or c_score_cutoff > optimal_score:             # <<<<<<<<<<<<<<
  *                 raise TypeError(f"score_cutoff has to be in the range of {worst_score} - {optimal_score}")
  *         else:
@@ -20561,86 +24444,86 @@
     /* "cpp_common.pxd":359
  *         else:
  *             # e.g. DBL_MAX - 0
  *             if c_score_cutoff > worst_score or c_score_cutoff < optimal_score:             # <<<<<<<<<<<<<<
  *                 raise TypeError(f"score_cutoff has to be in the range of {optimal_score} - {worst_score}")
  * 
  */
-    __Pyx_TraceLine(359,0,__PYX_ERR(1, 359, __pyx_L1_error))
+    __Pyx_TraceLine(359,0,__PYX_ERR(3, 359, __pyx_L1_error))
     /*else*/ {
-      __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 359, __pyx_L1_error)
+      __pyx_t_2 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 359, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_4 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_2, Py_GT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 359, __pyx_L1_error)
+      __pyx_t_4 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_2, Py_GT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 359, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(1, 359, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(3, 359, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       if (!__pyx_t_5) {
       } else {
         __pyx_t_3 = __pyx_t_5;
         goto __pyx_L9_bool_binop_done;
       }
-      __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 359, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 359, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_2 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_4, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 359, __pyx_L1_error)
+      __pyx_t_2 = PyObject_RichCompare(__pyx_v_c_score_cutoff, __pyx_t_4, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 359, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(1, 359, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(3, 359, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __pyx_t_3 = __pyx_t_5;
       __pyx_L9_bool_binop_done:;
       if (unlikely(__pyx_t_3)) {
 
         /* "cpp_common.pxd":360
  *             # e.g. DBL_MAX - 0
  *             if c_score_cutoff > worst_score or c_score_cutoff < optimal_score:
  *                 raise TypeError(f"score_cutoff has to be in the range of {optimal_score} - {worst_score}")             # <<<<<<<<<<<<<<
  * 
  *     return c_score_cutoff
  */
-        __Pyx_TraceLine(360,0,__PYX_ERR(1, 360, __pyx_L1_error))
-        __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 360, __pyx_L1_error)
+        __Pyx_TraceLine(360,0,__PYX_ERR(3, 360, __pyx_L1_error))
+        __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __pyx_t_6 = 0;
         __pyx_t_7 = 127;
         __Pyx_INCREF(__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
         __pyx_t_6 += 39;
         __Pyx_GIVEREF(__pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
         PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_score_cutoff_has_to_be_in_the_ra);
-        __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 360, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyInt_From_int64_t(__pyx_v_optimal_score); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 360, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(3, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
         __Pyx_GIVEREF(__pyx_t_8);
         PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
         __pyx_t_8 = 0;
-        __Pyx_INCREF(__pyx_kp_u__16);
+        __Pyx_INCREF(__pyx_kp_u__19);
         __pyx_t_6 += 3;
-        __Pyx_GIVEREF(__pyx_kp_u__16);
-        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__16);
-        __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 360, __pyx_L1_error)
+        __Pyx_GIVEREF(__pyx_kp_u__19);
+        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u__19);
+        __pyx_t_8 = __Pyx_PyInt_From_int64_t(__pyx_v_worst_score); if (unlikely(!__pyx_t_8)) __PYX_ERR(3, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
-        __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 360, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
         __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_7;
         __pyx_t_6 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
         __Pyx_GIVEREF(__pyx_t_4);
         PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_t_4);
         __pyx_t_4 = 0;
-        __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 360, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_6, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 360, __pyx_L1_error)
+        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(3, 360, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_Raise(__pyx_t_2, 0, 0, 0);
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __PYX_ERR(1, 360, __pyx_L1_error)
+        __PYX_ERR(3, 360, __pyx_L1_error)
 
         /* "cpp_common.pxd":359
  *         else:
  *             # e.g. DBL_MAX - 0
  *             if c_score_cutoff > worst_score or c_score_cutoff < optimal_score:             # <<<<<<<<<<<<<<
  *                 raise TypeError(f"score_cutoff has to be in the range of {optimal_score} - {worst_score}")
  * 
@@ -20661,16 +24544,16 @@
   /* "cpp_common.pxd":362
  *                 raise TypeError(f"score_cutoff has to be in the range of {optimal_score} - {worst_score}")
  * 
  *     return c_score_cutoff             # <<<<<<<<<<<<<<
  * 
  * cdef inline void preprocess_strings(s1, s2, processor, RF_StringWrapper* s1_proc, RF_StringWrapper* s2_proc, object default) except *:
  */
-  __Pyx_TraceLine(362,0,__PYX_ERR(1, 362, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyInt_As_int64_t(__pyx_v_c_score_cutoff); if (unlikely((__pyx_t_1 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(1, 362, __pyx_L1_error)
+  __Pyx_TraceLine(362,0,__PYX_ERR(3, 362, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyInt_As_int64_t(__pyx_v_c_score_cutoff); if (unlikely((__pyx_t_1 == ((int64_t)-1)) && PyErr_Occurred())) __PYX_ERR(3, 362, __pyx_L1_error)
   __pyx_r = __pyx_t_1;
   goto __pyx_L0;
 
   /* "cpp_common.pxd":346
  *     return c_score_cutoff
  * 
  * cdef inline int64_t get_score_cutoff_i64(score_cutoff, const RF_ScorerFlags* scorer_flags) except *:             # <<<<<<<<<<<<<<
@@ -20714,48 +24597,48 @@
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_t_9;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("preprocess_strings", 0);
-  __Pyx_TraceCall("preprocess_strings", __pyx_f[1], 364, 0, __PYX_ERR(1, 364, __pyx_L1_error));
+  __Pyx_TraceCall("preprocess_strings", __pyx_f[3], 364, 0, __PYX_ERR(3, 364, __pyx_L1_error));
   __Pyx_INCREF(__pyx_v_s1);
   __Pyx_INCREF(__pyx_v_s2);
   __Pyx_INCREF(__pyx_v_processor);
 
   /* "cpp_common.pxd":365
  * 
  * cdef inline void preprocess_strings(s1, s2, processor, RF_StringWrapper* s1_proc, RF_StringWrapper* s2_proc, object default) except *:
  *     cdef RF_Preprocessor* preprocess_context = NULL             # <<<<<<<<<<<<<<
  * 
  *     if processor is True:
  */
-  __Pyx_TraceLine(365,0,__PYX_ERR(1, 365, __pyx_L1_error))
+  __Pyx_TraceLine(365,0,__PYX_ERR(3, 365, __pyx_L1_error))
   __pyx_v_preprocess_context = NULL;
 
   /* "cpp_common.pxd":367
  *     cdef RF_Preprocessor* preprocess_context = NULL
  * 
  *     if processor is True:             # <<<<<<<<<<<<<<
  *         # todo: deprecate
  *         processor = default
  */
-  __Pyx_TraceLine(367,0,__PYX_ERR(1, 367, __pyx_L1_error))
+  __Pyx_TraceLine(367,0,__PYX_ERR(3, 367, __pyx_L1_error))
   __pyx_t_1 = (__pyx_v_processor == Py_True);
   if (__pyx_t_1) {
 
     /* "cpp_common.pxd":369
  *     if processor is True:
  *         # todo: deprecate
  *         processor = default             # <<<<<<<<<<<<<<
  * 
  *     if not processor:
  */
-    __Pyx_TraceLine(369,0,__PYX_ERR(1, 369, __pyx_L1_error))
+    __Pyx_TraceLine(369,0,__PYX_ERR(3, 369, __pyx_L1_error))
     __Pyx_INCREF(__pyx_v_default);
     __Pyx_DECREF_SET(__pyx_v_processor, __pyx_v_default);
 
     /* "cpp_common.pxd":367
  *     cdef RF_Preprocessor* preprocess_context = NULL
  * 
  *     if processor is True:             # <<<<<<<<<<<<<<
@@ -20767,39 +24650,39 @@
   /* "cpp_common.pxd":371
  *         processor = default
  * 
  *     if not processor:             # <<<<<<<<<<<<<<
  *         s1_proc[0] = RF_StringWrapper(conv_sequence(s1))
  *         s2_proc[0] = RF_StringWrapper(conv_sequence(s2))
  */
-  __Pyx_TraceLine(371,0,__PYX_ERR(1, 371, __pyx_L1_error))
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(1, 371, __pyx_L1_error)
+  __Pyx_TraceLine(371,0,__PYX_ERR(3, 371, __pyx_L1_error))
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_processor); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(3, 371, __pyx_L1_error)
   __pyx_t_2 = (!__pyx_t_1);
   if (__pyx_t_2) {
 
     /* "cpp_common.pxd":372
  * 
  *     if not processor:
  *         s1_proc[0] = RF_StringWrapper(conv_sequence(s1))             # <<<<<<<<<<<<<<
  *         s2_proc[0] = RF_StringWrapper(conv_sequence(s2))
  *     else:
  */
-    __Pyx_TraceLine(372,0,__PYX_ERR(1, 372, __pyx_L1_error))
-    __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_s1); if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 372, __pyx_L1_error)
+    __Pyx_TraceLine(372,0,__PYX_ERR(3, 372, __pyx_L1_error))
+    __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_s1); if (unlikely(PyErr_Occurred())) __PYX_ERR(3, 372, __pyx_L1_error)
     (__pyx_v_s1_proc[0]) = RF_StringWrapper(__pyx_t_3);
 
     /* "cpp_common.pxd":373
  *     if not processor:
  *         s1_proc[0] = RF_StringWrapper(conv_sequence(s1))
  *         s2_proc[0] = RF_StringWrapper(conv_sequence(s2))             # <<<<<<<<<<<<<<
  *     else:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  */
-    __Pyx_TraceLine(373,0,__PYX_ERR(1, 373, __pyx_L1_error))
-    __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_s2); if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 373, __pyx_L1_error)
+    __Pyx_TraceLine(373,0,__PYX_ERR(3, 373, __pyx_L1_error))
+    __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_s2); if (unlikely(PyErr_Occurred())) __PYX_ERR(3, 373, __pyx_L1_error)
     (__pyx_v_s2_proc[0]) = RF_StringWrapper(__pyx_t_3);
 
     /* "cpp_common.pxd":371
  *         processor = default
  * 
  *     if not processor:             # <<<<<<<<<<<<<<
  *         s1_proc[0] = RF_StringWrapper(conv_sequence(s1))
@@ -20811,41 +24694,41 @@
   /* "cpp_common.pxd":375
  *         s2_proc[0] = RF_StringWrapper(conv_sequence(s2))
  *     else:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)             # <<<<<<<<<<<<<<
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             preprocess_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  */
-  __Pyx_TraceLine(375,0,__PYX_ERR(1, 375, __pyx_L1_error))
+  __Pyx_TraceLine(375,0,__PYX_ERR(3, 375, __pyx_L1_error))
   /*else*/ {
-    __pyx_t_4 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 375, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_GetAttr3(__pyx_v_processor, __pyx_n_u_RF_Preprocess, __pyx_v_processor); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 375, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_v_processor_capsule = __pyx_t_4;
     __pyx_t_4 = 0;
 
     /* "cpp_common.pxd":376
  *     else:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             preprocess_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  */
-    __Pyx_TraceLine(376,0,__PYX_ERR(1, 376, __pyx_L1_error))
+    __Pyx_TraceLine(376,0,__PYX_ERR(3, 376, __pyx_L1_error))
     __pyx_t_2 = PyCapsule_IsValid(__pyx_v_processor_capsule, NULL);
     if (__pyx_t_2) {
 
       /* "cpp_common.pxd":377
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):
  *             preprocess_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)             # <<<<<<<<<<<<<<
  * 
  *         if preprocess_context != NULL and preprocess_context.version == 1:
  */
-      __Pyx_TraceLine(377,0,__PYX_ERR(1, 377, __pyx_L1_error))
-      __pyx_t_5 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_5 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(1, 377, __pyx_L1_error)
+      __Pyx_TraceLine(377,0,__PYX_ERR(3, 377, __pyx_L1_error))
+      __pyx_t_5 = PyCapsule_GetPointer(__pyx_v_processor_capsule, NULL); if (unlikely(__pyx_t_5 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(3, 377, __pyx_L1_error)
       __pyx_v_preprocess_context = ((RF_Preprocessor *)__pyx_t_5);
 
       /* "cpp_common.pxd":376
  *     else:
  *         processor_capsule = getattr(processor, '_RF_Preprocess', processor)
  *         if PyCapsule_IsValid(processor_capsule, NULL):             # <<<<<<<<<<<<<<
  *             preprocess_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
@@ -20856,15 +24739,15 @@
     /* "cpp_common.pxd":379
  *             preprocess_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  *         if preprocess_context != NULL and preprocess_context.version == 1:             # <<<<<<<<<<<<<<
  *             preprocess_context.preprocess(s1, &(s1_proc[0].string))
  *             preprocess_context.preprocess(s2, &(s2_proc[0].string))
  */
-    __Pyx_TraceLine(379,0,__PYX_ERR(1, 379, __pyx_L1_error))
+    __Pyx_TraceLine(379,0,__PYX_ERR(3, 379, __pyx_L1_error))
     __pyx_t_1 = (__pyx_v_preprocess_context != NULL);
     if (__pyx_t_1) {
     } else {
       __pyx_t_2 = __pyx_t_1;
       goto __pyx_L7_bool_binop_done;
     }
     __pyx_t_1 = (__pyx_v_preprocess_context->version == 1);
@@ -20875,26 +24758,26 @@
       /* "cpp_common.pxd":380
  * 
  *         if preprocess_context != NULL and preprocess_context.version == 1:
  *             preprocess_context.preprocess(s1, &(s1_proc[0].string))             # <<<<<<<<<<<<<<
  *             preprocess_context.preprocess(s2, &(s2_proc[0].string))
  *         else:
  */
-      __Pyx_TraceLine(380,0,__PYX_ERR(1, 380, __pyx_L1_error))
-      __pyx_t_6 = __pyx_v_preprocess_context->preprocess(__pyx_v_s1, (&(__pyx_v_s1_proc[0]).string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(1, 380, __pyx_L1_error)
+      __Pyx_TraceLine(380,0,__PYX_ERR(3, 380, __pyx_L1_error))
+      __pyx_t_6 = __pyx_v_preprocess_context->preprocess(__pyx_v_s1, (&(__pyx_v_s1_proc[0]).string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(3, 380, __pyx_L1_error)
 
       /* "cpp_common.pxd":381
  *         if preprocess_context != NULL and preprocess_context.version == 1:
  *             preprocess_context.preprocess(s1, &(s1_proc[0].string))
  *             preprocess_context.preprocess(s2, &(s2_proc[0].string))             # <<<<<<<<<<<<<<
  *         else:
  *             s1 = processor(s1)
  */
-      __Pyx_TraceLine(381,0,__PYX_ERR(1, 381, __pyx_L1_error))
-      __pyx_t_6 = __pyx_v_preprocess_context->preprocess(__pyx_v_s2, (&(__pyx_v_s2_proc[0]).string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(1, 381, __pyx_L1_error)
+      __Pyx_TraceLine(381,0,__PYX_ERR(3, 381, __pyx_L1_error))
+      __pyx_t_6 = __pyx_v_preprocess_context->preprocess(__pyx_v_s2, (&(__pyx_v_s2_proc[0]).string)); if (unlikely(__pyx_t_6 == ((bool)0))) __PYX_ERR(3, 381, __pyx_L1_error)
 
       /* "cpp_common.pxd":379
  *             preprocess_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
  * 
  *         if preprocess_context != NULL and preprocess_context.version == 1:             # <<<<<<<<<<<<<<
  *             preprocess_context.preprocess(s1, &(s1_proc[0].string))
  *             preprocess_context.preprocess(s2, &(s2_proc[0].string))
@@ -20905,15 +24788,15 @@
     /* "cpp_common.pxd":383
  *             preprocess_context.preprocess(s2, &(s2_proc[0].string))
  *         else:
  *             s1 = processor(s1)             # <<<<<<<<<<<<<<
  *             s1_proc[0] = RF_StringWrapper(conv_sequence(s1), s1)
  *             s2 = processor(s2)
  */
-    __Pyx_TraceLine(383,0,__PYX_ERR(1, 383, __pyx_L1_error))
+    __Pyx_TraceLine(383,0,__PYX_ERR(3, 383, __pyx_L1_error))
     /*else*/ {
       __Pyx_INCREF(__pyx_v_processor);
       __pyx_t_7 = __pyx_v_processor; __pyx_t_8 = NULL;
       __pyx_t_9 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
         __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
         if (likely(__pyx_t_8)) {
@@ -20924,40 +24807,40 @@
           __pyx_t_9 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_v_s1};
         __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_9, 1+__pyx_t_9);
         __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-        if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 383, __pyx_L1_error)
+        if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 383, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       }
       __Pyx_DECREF_SET(__pyx_v_s1, __pyx_t_4);
       __pyx_t_4 = 0;
 
       /* "cpp_common.pxd":384
  *         else:
  *             s1 = processor(s1)
  *             s1_proc[0] = RF_StringWrapper(conv_sequence(s1), s1)             # <<<<<<<<<<<<<<
  *             s2 = processor(s2)
  *             s2_proc[0] = RF_StringWrapper(conv_sequence(s2), s2)
  */
-      __Pyx_TraceLine(384,0,__PYX_ERR(1, 384, __pyx_L1_error))
-      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_s1); if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 384, __pyx_L1_error)
+      __Pyx_TraceLine(384,0,__PYX_ERR(3, 384, __pyx_L1_error))
+      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_s1); if (unlikely(PyErr_Occurred())) __PYX_ERR(3, 384, __pyx_L1_error)
       (__pyx_v_s1_proc[0]) = RF_StringWrapper(__pyx_t_3, __pyx_v_s1);
 
       /* "cpp_common.pxd":385
  *             s1 = processor(s1)
  *             s1_proc[0] = RF_StringWrapper(conv_sequence(s1), s1)
  *             s2 = processor(s2)             # <<<<<<<<<<<<<<
  *             s2_proc[0] = RF_StringWrapper(conv_sequence(s2), s2)
  * 
  */
-      __Pyx_TraceLine(385,0,__PYX_ERR(1, 385, __pyx_L1_error))
+      __Pyx_TraceLine(385,0,__PYX_ERR(3, 385, __pyx_L1_error))
       __Pyx_INCREF(__pyx_v_processor);
       __pyx_t_7 = __pyx_v_processor; __pyx_t_8 = NULL;
       __pyx_t_9 = 0;
       if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
         __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
         if (likely(__pyx_t_8)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
@@ -20967,30 +24850,30 @@
           __pyx_t_9 = 1;
         }
       }
       {
         PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_v_s2};
         __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_9, 1+__pyx_t_9);
         __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-        if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 385, __pyx_L1_error)
+        if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 385, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       }
       __Pyx_DECREF_SET(__pyx_v_s2, __pyx_t_4);
       __pyx_t_4 = 0;
 
       /* "cpp_common.pxd":386
  *             s1_proc[0] = RF_StringWrapper(conv_sequence(s1), s1)
  *             s2 = processor(s2)
  *             s2_proc[0] = RF_StringWrapper(conv_sequence(s2), s2)             # <<<<<<<<<<<<<<
  * 
  * cdef inline bool NoKwargsInit(RF_Kwargs* self, dict kwargs) except False:
  */
-      __Pyx_TraceLine(386,0,__PYX_ERR(1, 386, __pyx_L1_error))
-      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_s2); if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 386, __pyx_L1_error)
+      __Pyx_TraceLine(386,0,__PYX_ERR(3, 386, __pyx_L1_error))
+      __pyx_t_3 = __pyx_f_10cpp_common_conv_sequence(__pyx_v_s2); if (unlikely(PyErr_Occurred())) __PYX_ERR(3, 386, __pyx_L1_error)
       (__pyx_v_s2_proc[0]) = RF_StringWrapper(__pyx_t_3, __pyx_v_s2);
     }
     __pyx_L6:;
   }
   __pyx_L4:;
 
   /* "cpp_common.pxd":364
@@ -21033,63 +24916,63 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("NoKwargsInit", 0);
-  __Pyx_TraceCall("NoKwargsInit", __pyx_f[1], 388, 0, __PYX_ERR(1, 388, __pyx_L1_error));
+  __Pyx_TraceCall("NoKwargsInit", __pyx_f[3], 388, 0, __PYX_ERR(3, 388, __pyx_L1_error));
 
   /* "cpp_common.pxd":389
  * 
  * cdef inline bool NoKwargsInit(RF_Kwargs* self, dict kwargs) except False:
  *     if len(kwargs):             # <<<<<<<<<<<<<<
  *         raise TypeError("Got unexpected keyword arguments: ", ", ".join(kwargs.keys()))
  * 
  */
-  __Pyx_TraceLine(389,0,__PYX_ERR(1, 389, __pyx_L1_error))
+  __Pyx_TraceLine(389,0,__PYX_ERR(3, 389, __pyx_L1_error))
   if (unlikely(__pyx_v_kwargs == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(1, 389, __pyx_L1_error)
+    __PYX_ERR(3, 389, __pyx_L1_error)
   }
-  __pyx_t_1 = PyDict_Size(__pyx_v_kwargs); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(1, 389, __pyx_L1_error)
+  __pyx_t_1 = PyDict_Size(__pyx_v_kwargs); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(3, 389, __pyx_L1_error)
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (unlikely(__pyx_t_2)) {
 
     /* "cpp_common.pxd":390
  * cdef inline bool NoKwargsInit(RF_Kwargs* self, dict kwargs) except False:
  *     if len(kwargs):
  *         raise TypeError("Got unexpected keyword arguments: ", ", ".join(kwargs.keys()))             # <<<<<<<<<<<<<<
  * 
  *     dereference(self).context = NULL
  */
-    __Pyx_TraceLine(390,0,__PYX_ERR(1, 390, __pyx_L1_error))
+    __Pyx_TraceLine(390,0,__PYX_ERR(3, 390, __pyx_L1_error))
     if (unlikely(__pyx_v_kwargs == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "keys");
-      __PYX_ERR(1, 390, __pyx_L1_error)
+      __PYX_ERR(3, 390, __pyx_L1_error)
     }
-    __pyx_t_3 = __Pyx_PyDict_Keys(__pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 390, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyDict_Keys(__pyx_v_kwargs); if (unlikely(!__pyx_t_3)) __PYX_ERR(3, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__17, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 390, __pyx_L1_error)
+    __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__20, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 390, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(3, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(__pyx_kp_u_Got_unexpected_keyword_arguments);
     __Pyx_GIVEREF(__pyx_kp_u_Got_unexpected_keyword_arguments);
     PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_Got_unexpected_keyword_arguments);
     __Pyx_GIVEREF(__pyx_t_4);
     PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 390, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(3, 390, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(1, 390, __pyx_L1_error)
+    __PYX_ERR(3, 390, __pyx_L1_error)
 
     /* "cpp_common.pxd":389
  * 
  * cdef inline bool NoKwargsInit(RF_Kwargs* self, dict kwargs) except False:
  *     if len(kwargs):             # <<<<<<<<<<<<<<
  *         raise TypeError("Got unexpected keyword arguments: ", ", ".join(kwargs.keys()))
  * 
@@ -21099,35 +24982,35 @@
   /* "cpp_common.pxd":392
  *         raise TypeError("Got unexpected keyword arguments: ", ", ".join(kwargs.keys()))
  * 
  *     dereference(self).context = NULL             # <<<<<<<<<<<<<<
  *     dereference(self).dtor = NULL
  *     return True
  */
-  __Pyx_TraceLine(392,0,__PYX_ERR(1, 392, __pyx_L1_error))
+  __Pyx_TraceLine(392,0,__PYX_ERR(3, 392, __pyx_L1_error))
   (*__pyx_v_self).context = NULL;
 
   /* "cpp_common.pxd":393
  * 
  *     dereference(self).context = NULL
  *     dereference(self).dtor = NULL             # <<<<<<<<<<<<<<
  *     return True
  * 
  */
-  __Pyx_TraceLine(393,0,__PYX_ERR(1, 393, __pyx_L1_error))
+  __Pyx_TraceLine(393,0,__PYX_ERR(3, 393, __pyx_L1_error))
   (*__pyx_v_self).dtor = NULL;
 
   /* "cpp_common.pxd":394
  *     dereference(self).context = NULL
  *     dereference(self).dtor = NULL
  *     return True             # <<<<<<<<<<<<<<
  * 
  * cdef inline RF_Scorer CreateScorerContext(RF_KwargsInit kwargs_init, RF_GetScorerFlags get_scorer_flags, RF_ScorerFuncInit scorer_func_init):
  */
-  __Pyx_TraceLine(394,0,__PYX_ERR(1, 394, __pyx_L1_error))
+  __Pyx_TraceLine(394,0,__PYX_ERR(3, 394, __pyx_L1_error))
   __pyx_r = 1;
   goto __pyx_L0;
 
   /* "cpp_common.pxd":388
  *             s2_proc[0] = RF_StringWrapper(conv_sequence(s2), s2)
  * 
  * cdef inline bool NoKwargsInit(RF_Kwargs* self, dict kwargs) except False:             # <<<<<<<<<<<<<<
@@ -21160,64 +25043,64 @@
   RF_Scorer __pyx_r;
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("CreateScorerContext", 0);
-  __Pyx_TraceCall("CreateScorerContext", __pyx_f[1], 396, 0, __PYX_ERR(1, 396, __pyx_L1_error));
+  __Pyx_TraceCall("CreateScorerContext", __pyx_f[3], 396, 0, __PYX_ERR(3, 396, __pyx_L1_error));
 
   /* "cpp_common.pxd":398
  * cdef inline RF_Scorer CreateScorerContext(RF_KwargsInit kwargs_init, RF_GetScorerFlags get_scorer_flags, RF_ScorerFuncInit scorer_func_init):
  *     cdef RF_Scorer context
  *     context.version = SCORER_STRUCT_VERSION             # <<<<<<<<<<<<<<
  *     context.kwargs_init = kwargs_init
  *     context.get_scorer_flags = get_scorer_flags
  */
-  __Pyx_TraceLine(398,0,__PYX_ERR(1, 398, __pyx_L1_error))
+  __Pyx_TraceLine(398,0,__PYX_ERR(3, 398, __pyx_L1_error))
   __pyx_v_context.version = SCORER_STRUCT_VERSION;
 
   /* "cpp_common.pxd":399
  *     cdef RF_Scorer context
  *     context.version = SCORER_STRUCT_VERSION
  *     context.kwargs_init = kwargs_init             # <<<<<<<<<<<<<<
  *     context.get_scorer_flags = get_scorer_flags
  *     context.scorer_func_init = scorer_func_init
  */
-  __Pyx_TraceLine(399,0,__PYX_ERR(1, 399, __pyx_L1_error))
+  __Pyx_TraceLine(399,0,__PYX_ERR(3, 399, __pyx_L1_error))
   __pyx_v_context.kwargs_init = __pyx_v_kwargs_init;
 
   /* "cpp_common.pxd":400
  *     context.version = SCORER_STRUCT_VERSION
  *     context.kwargs_init = kwargs_init
  *     context.get_scorer_flags = get_scorer_flags             # <<<<<<<<<<<<<<
  *     context.scorer_func_init = scorer_func_init
  *     return context
  */
-  __Pyx_TraceLine(400,0,__PYX_ERR(1, 400, __pyx_L1_error))
+  __Pyx_TraceLine(400,0,__PYX_ERR(3, 400, __pyx_L1_error))
   __pyx_v_context.get_scorer_flags = __pyx_v_get_scorer_flags;
 
   /* "cpp_common.pxd":401
  *     context.kwargs_init = kwargs_init
  *     context.get_scorer_flags = get_scorer_flags
  *     context.scorer_func_init = scorer_func_init             # <<<<<<<<<<<<<<
  *     return context
  * 
  */
-  __Pyx_TraceLine(401,0,__PYX_ERR(1, 401, __pyx_L1_error))
+  __Pyx_TraceLine(401,0,__PYX_ERR(3, 401, __pyx_L1_error))
   __pyx_v_context.scorer_func_init = __pyx_v_scorer_func_init;
 
   /* "cpp_common.pxd":402
  *     context.get_scorer_flags = get_scorer_flags
  *     context.scorer_func_init = scorer_func_init
  *     return context             # <<<<<<<<<<<<<<
  * 
  * cdef inline dict CreateScorerContextPy(get_scorer_flags):
  */
-  __Pyx_TraceLine(402,0,__PYX_ERR(1, 402, __pyx_L1_error))
+  __Pyx_TraceLine(402,0,__PYX_ERR(3, 402, __pyx_L1_error))
   __pyx_r = __pyx_v_context;
   goto __pyx_L0;
 
   /* "cpp_common.pxd":396
  *     return True
  * 
  * cdef inline RF_Scorer CreateScorerContext(RF_KwargsInit kwargs_init, RF_GetScorerFlags get_scorer_flags, RF_ScorerFuncInit scorer_func_init):             # <<<<<<<<<<<<<<
@@ -21248,28 +25131,28 @@
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("CreateScorerContextPy", 0);
-  __Pyx_TraceCall("CreateScorerContextPy", __pyx_f[1], 404, 0, __PYX_ERR(1, 404, __pyx_L1_error));
+  __Pyx_TraceCall("CreateScorerContextPy", __pyx_f[3], 404, 0, __PYX_ERR(3, 404, __pyx_L1_error));
 
   /* "cpp_common.pxd":405
  * 
  * cdef inline dict CreateScorerContextPy(get_scorer_flags):
  *     return {"get_scorer_flags": get_scorer_flags}             # <<<<<<<<<<<<<<
  * 
  * cdef inline bool AddScorerContext(func, py_context, RF_Scorer* c_context) except False:
  */
-  __Pyx_TraceLine(405,0,__PYX_ERR(1, 405, __pyx_L1_error))
+  __Pyx_TraceLine(405,0,__PYX_ERR(3, 405, __pyx_L1_error))
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 405, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 405, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_get_scorer_flags, __pyx_v_get_scorer_flags) < 0) __PYX_ERR(1, 405, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_get_scorer_flags, __pyx_v_get_scorer_flags) < 0) __PYX_ERR(3, 405, __pyx_L1_error)
   __pyx_r = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* "cpp_common.pxd":404
  *     return context
  * 
@@ -21303,44 +25186,44 @@
   __Pyx_TraceDeclarations
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("AddScorerContext", 0);
-  __Pyx_TraceCall("AddScorerContext", __pyx_f[1], 407, 0, __PYX_ERR(1, 407, __pyx_L1_error));
+  __Pyx_TraceCall("AddScorerContext", __pyx_f[3], 407, 0, __PYX_ERR(3, 407, __pyx_L1_error));
 
   /* "cpp_common.pxd":408
  * 
  * cdef inline bool AddScorerContext(func, py_context, RF_Scorer* c_context) except False:
  *     func._RF_Scorer = PyCapsule_New(c_context, NULL, NULL)             # <<<<<<<<<<<<<<
  *     func._RF_ScorerPy = py_context
  *     return True
  */
-  __Pyx_TraceLine(408,0,__PYX_ERR(1, 408, __pyx_L1_error))
-  __pyx_t_1 = PyCapsule_New(__pyx_v_c_context, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 408, __pyx_L1_error)
+  __Pyx_TraceLine(408,0,__PYX_ERR(3, 408, __pyx_L1_error))
+  __pyx_t_1 = PyCapsule_New(__pyx_v_c_context, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 408, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_func, __pyx_n_s_RF_Scorer, __pyx_t_1) < 0) __PYX_ERR(1, 408, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_func, __pyx_n_s_RF_Scorer, __pyx_t_1) < 0) __PYX_ERR(3, 408, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "cpp_common.pxd":409
  * cdef inline bool AddScorerContext(func, py_context, RF_Scorer* c_context) except False:
  *     func._RF_Scorer = PyCapsule_New(c_context, NULL, NULL)
  *     func._RF_ScorerPy = py_context             # <<<<<<<<<<<<<<
  *     return True
  */
-  __Pyx_TraceLine(409,0,__PYX_ERR(1, 409, __pyx_L1_error))
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_func, __pyx_n_s_RF_ScorerPy, __pyx_v_py_context) < 0) __PYX_ERR(1, 409, __pyx_L1_error)
+  __Pyx_TraceLine(409,0,__PYX_ERR(3, 409, __pyx_L1_error))
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_func, __pyx_n_s_RF_ScorerPy, __pyx_v_py_context) < 0) __PYX_ERR(3, 409, __pyx_L1_error)
 
   /* "cpp_common.pxd":410
  *     func._RF_Scorer = PyCapsule_New(c_context, NULL, NULL)
  *     func._RF_ScorerPy = py_context
  *     return True             # <<<<<<<<<<<<<<
  */
-  __Pyx_TraceLine(410,0,__PYX_ERR(1, 410, __pyx_L1_error))
+  __Pyx_TraceLine(410,0,__PYX_ERR(3, 410, __pyx_L1_error))
   __pyx_r = 1;
   goto __pyx_L0;
 
   /* "cpp_common.pxd":407
  *     return {"get_scorer_flags": get_scorer_flags}
  * 
  * cdef inline bool AddScorerContext(func, py_context, RF_Scorer* c_context) except False:             # <<<<<<<<<<<<<<
@@ -21355,42 +25238,1968 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_TraceReturn(Py_None, 0);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter[8];
-static int __pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter = 0;
+/* "EnumBase":13
+ * @cython.internal
+ * cdef class __Pyx_EnumMeta(type):
+ *     def __init__(cls, name, parents, dct):             # <<<<<<<<<<<<<<
+ *         type.__init__(cls, name, parents, dct)
+ *         cls.__members__ = __Pyx_OrderedDict()
+ */
+
+/* Python wrapper */
+static int __pyx_pw_8EnumBase_14__Pyx_EnumMeta_1__init__(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
+static int __pyx_pw_8EnumBase_14__Pyx_EnumMeta_1__init__(PyObject *__pyx_v_cls, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+  PyObject *__pyx_v_name = 0;
+  PyObject *__pyx_v_parents = 0;
+  PyObject *__pyx_v_dct = 0;
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_name,&__pyx_n_s_parents,&__pyx_n_s_dct,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_name,&__pyx_n_s_parents,&__pyx_n_s_dct,0};
+    #endif
+    PyObject* values[3] = {0,0,0};
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  3: values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_VARARGS(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_name)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 13, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_parents)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 13, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 1); __PYX_ERR(1, 13, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (likely((values[2] = __Pyx_GetKwValue_VARARGS(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_dct)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 13, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, 2); __PYX_ERR(1, 13, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__init__") < 0)) __PYX_ERR(1, 13, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 3)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_VARARGS(__pyx_args, 0);
+      values[1] = __Pyx_Arg_VARARGS(__pyx_args, 1);
+      values[2] = __Pyx_Arg_VARARGS(__pyx_args, 2);
+    }
+    __pyx_v_name = values[0];
+    __pyx_v_parents = values[1];
+    __pyx_v_dct = values[2];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 3, 3, __pyx_nargs); __PYX_ERR(1, 13, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumMeta.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return -1;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_8EnumBase_14__Pyx_EnumMeta___init__(((struct __pyx_obj___Pyx_EnumMeta *)__pyx_v_cls), __pyx_v_name, __pyx_v_parents, __pyx_v_dct);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static int __pyx_pf_8EnumBase_14__Pyx_EnumMeta___init__(struct __pyx_obj___Pyx_EnumMeta *__pyx_v_cls, PyObject *__pyx_v_name, PyObject *__pyx_v_parents, PyObject *__pyx_v_dct) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__init__", 0);
+
+  /* "EnumBase":14
+ * cdef class __Pyx_EnumMeta(type):
+ *     def __init__(cls, name, parents, dct):
+ *         type.__init__(cls, name, parents, dct)             # <<<<<<<<<<<<<<
+ *         cls.__members__ = __Pyx_OrderedDict()
+ *     def __iter__(cls):
+ */
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)(&PyType_Type)), __pyx_n_s_init); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 14, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = NULL;
+  __pyx_t_4 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
+    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
+    if (likely(__pyx_t_3)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
+      __Pyx_INCREF(__pyx_t_3);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_2, function);
+      __pyx_t_4 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[5] = {__pyx_t_3, ((PyObject *)__pyx_v_cls), __pyx_v_name, __pyx_v_parents, __pyx_v_dct};
+    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 4+__pyx_t_4);
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 14, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  }
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "EnumBase":15
+ *     def __init__(cls, name, parents, dct):
+ *         type.__init__(cls, name, parents, dct)
+ *         cls.__members__ = __Pyx_OrderedDict()             # <<<<<<<<<<<<<<
+ *     def __iter__(cls):
+ *         return iter(cls.__members__.values())
+ */
+  __Pyx_INCREF(__Pyx_OrderedDict);
+  __pyx_t_2 = __Pyx_OrderedDict; __pyx_t_3 = NULL;
+  __pyx_t_4 = 0;
+  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
+    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
+    if (likely(__pyx_t_3)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
+      __Pyx_INCREF(__pyx_t_3);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_2, function);
+      __pyx_t_4 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[1] = {__pyx_t_3, };
+    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 15, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  }
+  if (__Pyx_PyObject_SetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_members, __pyx_t_1) < 0) __PYX_ERR(1, 15, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "EnumBase":13
+ * @cython.internal
+ * cdef class __Pyx_EnumMeta(type):
+ *     def __init__(cls, name, parents, dct):             # <<<<<<<<<<<<<<
+ *         type.__init__(cls, name, parents, dct)
+ *         cls.__members__ = __Pyx_OrderedDict()
+ */
+
+  /* function exit code */
+  __pyx_r = 0;
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumMeta.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = -1;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "EnumBase":16
+ *         type.__init__(cls, name, parents, dct)
+ *         cls.__members__ = __Pyx_OrderedDict()
+ *     def __iter__(cls):             # <<<<<<<<<<<<<<
+ *         return iter(cls.__members__.values())
+ *     def __getitem__(cls, name):
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumMeta_3__iter__(PyObject *__pyx_v_cls); /*proto*/
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumMeta_3__iter__(PyObject *__pyx_v_cls) {
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__iter__ (wrapper)", 0);
+  __pyx_r = __pyx_pf_8EnumBase_14__Pyx_EnumMeta_2__iter__(((struct __pyx_obj___Pyx_EnumMeta *)__pyx_v_cls));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumMeta_2__iter__(struct __pyx_obj___Pyx_EnumMeta *__pyx_v_cls) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__iter__", 0);
+
+  /* "EnumBase":17
+ *         cls.__members__ = __Pyx_OrderedDict()
+ *     def __iter__(cls):
+ *         return iter(cls.__members__.values())             # <<<<<<<<<<<<<<
+ *     def __getitem__(cls, name):
+ *         return cls.__members__[name]
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_members); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 17, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_values); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 17, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = NULL;
+  __pyx_t_4 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
+    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
+    if (likely(__pyx_t_2)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+      __Pyx_INCREF(__pyx_t_2);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_3, function);
+      __pyx_t_4 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[1] = {__pyx_t_2, };
+    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
+    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  }
+  __pyx_t_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 17, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_3;
+  __pyx_t_3 = 0;
+  goto __pyx_L0;
+
+  /* "EnumBase":16
+ *         type.__init__(cls, name, parents, dct)
+ *         cls.__members__ = __Pyx_OrderedDict()
+ *     def __iter__(cls):             # <<<<<<<<<<<<<<
+ *         return iter(cls.__members__.values())
+ *     def __getitem__(cls, name):
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumMeta.__iter__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "EnumBase":18
+ *     def __iter__(cls):
+ *         return iter(cls.__members__.values())
+ *     def __getitem__(cls, name):             # <<<<<<<<<<<<<<
+ *         return cls.__members__[name]
+ * 
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumMeta_5__getitem__(PyObject *__pyx_v_cls, PyObject *__pyx_v_name); /*proto*/
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumMeta_5__getitem__(PyObject *__pyx_v_cls, PyObject *__pyx_v_name) {
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__getitem__ (wrapper)", 0);
+  __pyx_r = __pyx_pf_8EnumBase_14__Pyx_EnumMeta_4__getitem__(((struct __pyx_obj___Pyx_EnumMeta *)__pyx_v_cls), ((PyObject *)__pyx_v_name));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumMeta_4__getitem__(struct __pyx_obj___Pyx_EnumMeta *__pyx_v_cls, PyObject *__pyx_v_name) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__getitem__", 0);
+
+  /* "EnumBase":19
+ *         return iter(cls.__members__.values())
+ *     def __getitem__(cls, name):
+ *         return cls.__members__[name]             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_cls), __pyx_n_s_members); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 19, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 19, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_2;
+  __pyx_t_2 = 0;
+  goto __pyx_L0;
+
+  /* "EnumBase":18
+ *     def __iter__(cls):
+ *         return iter(cls.__members__.values())
+ *     def __getitem__(cls, name):             # <<<<<<<<<<<<<<
+ *         return cls.__members__[name]
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumMeta.__getitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "(tree fragment)":1
+ * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
+ *     cdef tuple state
+ *     cdef object _dict
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumMeta_7__reduce_cython__(PyObject *__pyx_v_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8EnumBase_14__Pyx_EnumMeta_7__reduce_cython__ = {"__reduce_cython__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8EnumBase_14__Pyx_EnumMeta_7__reduce_cython__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumMeta_7__reduce_cython__(PyObject *__pyx_v_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__reduce_cython__ (wrapper)", 0);
+  if (unlikely(__pyx_nargs > 0)) {
+    __Pyx_RaiseArgtupleInvalid("__reduce_cython__", 1, 0, 0, __pyx_nargs); return NULL;}
+  if (unlikely(__pyx_kwds) && __Pyx_NumKwargs_FASTCALL(__pyx_kwds) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "__reduce_cython__", 0))) return NULL;
+  __pyx_r = __pyx_pf_8EnumBase_14__Pyx_EnumMeta_6__reduce_cython__(((struct __pyx_obj___Pyx_EnumMeta *)__pyx_v_self));
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumMeta_6__reduce_cython__(struct __pyx_obj___Pyx_EnumMeta *__pyx_v_self) {
+  PyObject *__pyx_v_state = 0;
+  PyObject *__pyx_v__dict = 0;
+  int __pyx_v_use_setstate;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__reduce_cython__", 0);
+
+  /* "(tree fragment)":5
+ *     cdef object _dict
+ *     cdef bint use_setstate
+ *     state = ()             # <<<<<<<<<<<<<<
+ *     _dict = getattr(self, '__dict__', None)
+ *     if _dict is not None:
+ */
+  __Pyx_INCREF(__pyx_empty_tuple);
+  __pyx_v_state = __pyx_empty_tuple;
+
+  /* "(tree fragment)":6
+ *     cdef bint use_setstate
+ *     state = ()
+ *     _dict = getattr(self, '__dict__', None)             # <<<<<<<<<<<<<<
+ *     if _dict is not None:
+ *         state += (_dict,)
+ */
+  __pyx_t_1 = __Pyx_GetAttr3(((PyObject *)__pyx_v_self), __pyx_n_s_dict, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 6, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_v__dict = __pyx_t_1;
+  __pyx_t_1 = 0;
 
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *p;
+  /* "(tree fragment)":7
+ *     state = ()
+ *     _dict = getattr(self, '__dict__', None)
+ *     if _dict is not None:             # <<<<<<<<<<<<<<
+ *         state += (_dict,)
+ *         use_setstate = True
+ */
+  __pyx_t_2 = (__pyx_v__dict != Py_None);
+  if (__pyx_t_2) {
+
+    /* "(tree fragment)":8
+ *     _dict = getattr(self, '__dict__', None)
+ *     if _dict is not None:
+ *         state += (_dict,)             # <<<<<<<<<<<<<<
+ *         use_setstate = True
+ *     else:
+ */
+    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 8, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(__pyx_v__dict);
+    __Pyx_GIVEREF(__pyx_v__dict);
+    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v__dict);
+    __pyx_t_3 = PyNumber_InPlaceAdd(__pyx_v_state, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 8, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF_SET(__pyx_v_state, ((PyObject*)__pyx_t_3));
+    __pyx_t_3 = 0;
+
+    /* "(tree fragment)":9
+ *     if _dict is not None:
+ *         state += (_dict,)
+ *         use_setstate = True             # <<<<<<<<<<<<<<
+ *     else:
+ *         use_setstate = False
+ */
+    __pyx_v_use_setstate = 1;
+
+    /* "(tree fragment)":7
+ *     state = ()
+ *     _dict = getattr(self, '__dict__', None)
+ *     if _dict is not None:             # <<<<<<<<<<<<<<
+ *         state += (_dict,)
+ *         use_setstate = True
+ */
+    goto __pyx_L3;
+  }
+
+  /* "(tree fragment)":11
+ *         use_setstate = True
+ *     else:
+ *         use_setstate = False             # <<<<<<<<<<<<<<
+ *     if use_setstate:
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, None), state
+ */
+  /*else*/ {
+    __pyx_v_use_setstate = 0;
+  }
+  __pyx_L3:;
+
+  /* "(tree fragment)":12
+ *     else:
+ *         use_setstate = False
+ *     if use_setstate:             # <<<<<<<<<<<<<<
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, None), state
+ *     else:
+ */
+  if (__pyx_v_use_setstate) {
+
+    /* "(tree fragment)":13
+ *         use_setstate = False
+ *     if use_setstate:
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, None), state             # <<<<<<<<<<<<<<
+ *     else:
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, state)
+ */
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_pyx_unpickle___Pyx_EnumMeta); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 13, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 13, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
+    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
+    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
+    __Pyx_INCREF(__pyx_int_238750788);
+    __Pyx_GIVEREF(__pyx_int_238750788);
+    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_238750788);
+    __Pyx_INCREF(Py_None);
+    __Pyx_GIVEREF(Py_None);
+    PyTuple_SET_ITEM(__pyx_t_1, 2, Py_None);
+    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 13, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_3);
+    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
+    __Pyx_GIVEREF(__pyx_t_1);
+    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
+    __Pyx_INCREF(__pyx_v_state);
+    __Pyx_GIVEREF(__pyx_v_state);
+    PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_v_state);
+    __pyx_t_3 = 0;
+    __pyx_t_1 = 0;
+    __pyx_r = __pyx_t_4;
+    __pyx_t_4 = 0;
+    goto __pyx_L0;
+
+    /* "(tree fragment)":12
+ *     else:
+ *         use_setstate = False
+ *     if use_setstate:             # <<<<<<<<<<<<<<
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, None), state
+ *     else:
+ */
+  }
+
+  /* "(tree fragment)":15
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, None), state
+ *     else:
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, state)             # <<<<<<<<<<<<<<
+ * def __setstate_cython__(self, __pyx_state):
+ *     __pyx_unpickle___Pyx_EnumMeta__set_state(self, __pyx_state)
+ */
+  /*else*/ {
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pyx_unpickle___Pyx_EnumMeta); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 15, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 15, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
+    __Pyx_GIVEREF(((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
+    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)Py_TYPE(((PyObject *)__pyx_v_self))));
+    __Pyx_INCREF(__pyx_int_238750788);
+    __Pyx_GIVEREF(__pyx_int_238750788);
+    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_238750788);
+    __Pyx_INCREF(__pyx_v_state);
+    __Pyx_GIVEREF(__pyx_v_state);
+    PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_state);
+    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 15, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_1);
+    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
+    __pyx_t_4 = 0;
+    __pyx_t_1 = 0;
+    __pyx_r = __pyx_t_3;
+    __pyx_t_3 = 0;
+    goto __pyx_L0;
+  }
+
+  /* "(tree fragment)":1
+ * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
+ *     cdef tuple state
+ *     cdef object _dict
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumMeta.__reduce_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_state);
+  __Pyx_XDECREF(__pyx_v__dict);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "(tree fragment)":16
+ *     else:
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, state)
+ * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
+ *     __pyx_unpickle___Pyx_EnumMeta__set_state(self, __pyx_state)
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumMeta_9__setstate_cython__(PyObject *__pyx_v_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8EnumBase_14__Pyx_EnumMeta_9__setstate_cython__ = {"__setstate_cython__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8EnumBase_14__Pyx_EnumMeta_9__setstate_cython__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumMeta_9__setstate_cython__(PyObject *__pyx_v_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v___pyx_state = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__setstate_cython__ (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_state,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_state,0};
+    #endif
+    PyObject* values[1] = {0};
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_pyx_state)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 16, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__setstate_cython__") < 0)) __PYX_ERR(1, 16, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 1)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+    }
+    __pyx_v___pyx_state = values[0];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("__setstate_cython__", 1, 1, 1, __pyx_nargs); __PYX_ERR(1, 16, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumMeta.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_8EnumBase_14__Pyx_EnumMeta_8__setstate_cython__(((struct __pyx_obj___Pyx_EnumMeta *)__pyx_v_self), __pyx_v___pyx_state);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumMeta_8__setstate_cython__(struct __pyx_obj___Pyx_EnumMeta *__pyx_v_self, PyObject *__pyx_v___pyx_state) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__setstate_cython__", 0);
+
+  /* "(tree fragment)":17
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, state)
+ * def __setstate_cython__(self, __pyx_state):
+ *     __pyx_unpickle___Pyx_EnumMeta__set_state(self, __pyx_state)             # <<<<<<<<<<<<<<
+ */
+  if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None) || __Pyx_RaiseUnexpectedTypeError("tuple", __pyx_v___pyx_state))) __PYX_ERR(1, 17, __pyx_L1_error)
+  __pyx_t_1 = __pyx_unpickle___Pyx_EnumMeta__set_state(__pyx_v_self, ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 17, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "(tree fragment)":16
+ *     else:
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, state)
+ * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
+ *     __pyx_unpickle___Pyx_EnumMeta__set_state(self, __pyx_state)
+ */
+
+  /* function exit code */
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumMeta.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "EnumBase":24
+ * cdef object __Pyx_EnumBase
+ * class __Pyx_EnumBase(int, metaclass=__Pyx_EnumMeta):
+ *     def __new__(cls, value, name=None):             # <<<<<<<<<<<<<<
+ *         for v in cls:
+ *             if v == value:
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumBase_1__new__(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8EnumBase_14__Pyx_EnumBase_1__new__ = {"__new__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8EnumBase_14__Pyx_EnumBase_1__new__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumBase_1__new__(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_cls = 0;
+  PyObject *__pyx_v_value = 0;
+  PyObject *__pyx_v_name = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__new__ (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_cls,&__pyx_n_s_value,&__pyx_n_s_name,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_cls,&__pyx_n_s_value,&__pyx_n_s_name,0};
+    #endif
+    PyObject* values[3] = {0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cls)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 24, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_value)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 24, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("__new__", 0, 2, 3, 1); __PYX_ERR(1, 24, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (kw_args > 0) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_name);
+          if (value) { values[2] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 24, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__new__") < 0)) __PYX_ERR(1, 24, __pyx_L3_error)
+      }
+    } else {
+      switch (__pyx_nargs) {
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+    }
+    __pyx_v_cls = values[0];
+    __pyx_v_value = values[1];
+    __pyx_v_name = values[2];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("__new__", 0, 2, 3, __pyx_nargs); __PYX_ERR(1, 24, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumBase.__new__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_8EnumBase_14__Pyx_EnumBase___new__(__pyx_self, __pyx_v_cls, __pyx_v_value, __pyx_v_name);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumBase___new__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_cls, PyObject *__pyx_v_value, PyObject *__pyx_v_name) {
+  PyObject *__pyx_v_v = NULL;
+  PyObject *__pyx_v_res = NULL;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  Py_ssize_t __pyx_t_2;
+  PyObject *(*__pyx_t_3)(PyObject *);
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_t_5;
+  PyObject *__pyx_t_6 = NULL;
+  int __pyx_t_7;
+  int __pyx_t_8;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__new__", 0);
+
+  /* "EnumBase":25
+ * class __Pyx_EnumBase(int, metaclass=__Pyx_EnumMeta):
+ *     def __new__(cls, value, name=None):
+ *         for v in cls:             # <<<<<<<<<<<<<<
+ *             if v == value:
+ *                 return v
+ */
+  if (likely(PyList_CheckExact(__pyx_v_cls)) || PyTuple_CheckExact(__pyx_v_cls)) {
+    __pyx_t_1 = __pyx_v_cls; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
+    __pyx_t_3 = NULL;
+  } else {
+    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_cls); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 25, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_3 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 25, __pyx_L1_error)
+  }
+  for (;;) {
+    if (likely(!__pyx_t_3)) {
+      if (likely(PyList_CheckExact(__pyx_t_1))) {
+        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
+        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(1, 25, __pyx_L1_error)
+        #else
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 25, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_4);
+        #endif
+      } else {
+        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
+        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(1, 25, __pyx_L1_error)
+        #else
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 25, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_4);
+        #endif
+      }
+    } else {
+      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
+      if (unlikely(!__pyx_t_4)) {
+        PyObject* exc_type = PyErr_Occurred();
+        if (exc_type) {
+          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
+          else __PYX_ERR(1, 25, __pyx_L1_error)
+        }
+        break;
+      }
+      __Pyx_GOTREF(__pyx_t_4);
+    }
+    __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "EnumBase":26
+ *     def __new__(cls, value, name=None):
+ *         for v in cls:
+ *             if v == value:             # <<<<<<<<<<<<<<
+ *                 return v
+ *         if name is None:
+ */
+    __pyx_t_4 = PyObject_RichCompare(__pyx_v_v, __pyx_v_value, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 26, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(1, 26, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (__pyx_t_5) {
+
+      /* "EnumBase":27
+ *         for v in cls:
+ *             if v == value:
+ *                 return v             # <<<<<<<<<<<<<<
+ *         if name is None:
+ *             raise ValueError("Unknown enum value: '%s'" % value)
+ */
+      __Pyx_XDECREF(__pyx_r);
+      __Pyx_INCREF(__pyx_v_v);
+      __pyx_r = __pyx_v_v;
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      goto __pyx_L0;
+
+      /* "EnumBase":26
+ *     def __new__(cls, value, name=None):
+ *         for v in cls:
+ *             if v == value:             # <<<<<<<<<<<<<<
+ *                 return v
+ *         if name is None:
+ */
+    }
+
+    /* "EnumBase":25
+ * class __Pyx_EnumBase(int, metaclass=__Pyx_EnumMeta):
+ *     def __new__(cls, value, name=None):
+ *         for v in cls:             # <<<<<<<<<<<<<<
+ *             if v == value:
+ *                 return v
+ */
+  }
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "EnumBase":28
+ *             if v == value:
+ *                 return v
+ *         if name is None:             # <<<<<<<<<<<<<<
+ *             raise ValueError("Unknown enum value: '%s'" % value)
+ *         res = int.__new__(cls, value)
+ */
+  __pyx_t_5 = (__pyx_v_name == Py_None);
+  if (unlikely(__pyx_t_5)) {
+
+    /* "EnumBase":29
+ *                 return v
+ *         if name is None:
+ *             raise ValueError("Unknown enum value: '%s'" % value)             # <<<<<<<<<<<<<<
+ *         res = int.__new__(cls, value)
+ *         res.name = name
+ */
+    __pyx_t_1 = __Pyx_PyString_FormatSafe(__pyx_kp_s_Unknown_enum_value_s, __pyx_v_value); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 29, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 29, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __PYX_ERR(1, 29, __pyx_L1_error)
+
+    /* "EnumBase":28
+ *             if v == value:
+ *                 return v
+ *         if name is None:             # <<<<<<<<<<<<<<
+ *             raise ValueError("Unknown enum value: '%s'" % value)
+ *         res = int.__new__(cls, value)
+ */
+  }
+
+  /* "EnumBase":30
+ *         if name is None:
+ *             raise ValueError("Unknown enum value: '%s'" % value)
+ *         res = int.__new__(cls, value)             # <<<<<<<<<<<<<<
+ *         res.name = name
+ *         setattr(cls, name, res)
+ */
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)(&PyInt_Type)), __pyx_n_s_new); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 30, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_6 = NULL;
+  __pyx_t_7 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
+    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
+    if (likely(__pyx_t_6)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
+      __Pyx_INCREF(__pyx_t_6);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_1, function);
+      __pyx_t_7 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[3] = {__pyx_t_6, __pyx_v_cls, __pyx_v_value};
+    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
+    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+    if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 30, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  }
+  __pyx_v_res = __pyx_t_4;
+  __pyx_t_4 = 0;
+
+  /* "EnumBase":31
+ *             raise ValueError("Unknown enum value: '%s'" % value)
+ *         res = int.__new__(cls, value)
+ *         res.name = name             # <<<<<<<<<<<<<<
+ *         setattr(cls, name, res)
+ *         cls.__members__[name] = res
+ */
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_res, __pyx_n_s_name, __pyx_v_name) < 0) __PYX_ERR(1, 31, __pyx_L1_error)
+
+  /* "EnumBase":32
+ *         res = int.__new__(cls, value)
+ *         res.name = name
+ *         setattr(cls, name, res)             # <<<<<<<<<<<<<<
+ *         cls.__members__[name] = res
+ *         return res
+ */
+  __pyx_t_8 = PyObject_SetAttr(__pyx_v_cls, __pyx_v_name, __pyx_v_res); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(1, 32, __pyx_L1_error)
+
+  /* "EnumBase":33
+ *         res.name = name
+ *         setattr(cls, name, res)
+ *         cls.__members__[name] = res             # <<<<<<<<<<<<<<
+ *         return res
+ *     def __repr__(self):
+ */
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_cls, __pyx_n_s_members); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 33, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  if (unlikely((PyObject_SetItem(__pyx_t_4, __pyx_v_name, __pyx_v_res) < 0))) __PYX_ERR(1, 33, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+  /* "EnumBase":34
+ *         setattr(cls, name, res)
+ *         cls.__members__[name] = res
+ *         return res             # <<<<<<<<<<<<<<
+ *     def __repr__(self):
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(__pyx_v_res);
+  __pyx_r = __pyx_v_res;
+  goto __pyx_L0;
+
+  /* "EnumBase":24
+ * cdef object __Pyx_EnumBase
+ * class __Pyx_EnumBase(int, metaclass=__Pyx_EnumMeta):
+ *     def __new__(cls, value, name=None):             # <<<<<<<<<<<<<<
+ *         for v in cls:
+ *             if v == value:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumBase.__new__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_v);
+  __Pyx_XDECREF(__pyx_v_res);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "EnumBase":35
+ *         cls.__members__[name] = res
+ *         return res
+ *     def __repr__(self):             # <<<<<<<<<<<<<<
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
+ *     def __str__(self):
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumBase_3__repr__(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8EnumBase_14__Pyx_EnumBase_3__repr__ = {"__repr__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8EnumBase_14__Pyx_EnumBase_3__repr__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumBase_3__repr__(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_self = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__repr__ (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,0};
+    #endif
+    PyObject* values[1] = {0};
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_self)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 35, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__repr__") < 0)) __PYX_ERR(1, 35, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 1)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+    }
+    __pyx_v_self = values[0];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("__repr__", 1, 1, 1, __pyx_nargs); __PYX_ERR(1, 35, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumBase.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_8EnumBase_14__Pyx_EnumBase_2__repr__(__pyx_self, __pyx_v_self);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumBase_2__repr__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__repr__", 0);
+
+  /* "EnumBase":36
+ *         return res
+ *     def __repr__(self):
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)             # <<<<<<<<<<<<<<
+ *     def __str__(self):
+ *         return "%s.%s" % (self.__class__.__name__, self.name)
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_class); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 36, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 36, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 36, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyTuple_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 36, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
+  __Pyx_INCREF(__pyx_v_self);
+  __Pyx_GIVEREF(__pyx_v_self);
+  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_v_self);
+  __pyx_t_2 = 0;
+  __pyx_t_1 = 0;
+  __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_s_s_d, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 36, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* "EnumBase":35
+ *         cls.__members__[name] = res
+ *         return res
+ *     def __repr__(self):             # <<<<<<<<<<<<<<
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
+ *     def __str__(self):
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumBase.__repr__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "EnumBase":37
+ *     def __repr__(self):
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
+ *     def __str__(self):             # <<<<<<<<<<<<<<
+ *         return "%s.%s" % (self.__class__.__name__, self.name)
+ * 
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumBase_5__str__(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8EnumBase_14__Pyx_EnumBase_5__str__ = {"__str__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8EnumBase_14__Pyx_EnumBase_5__str__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8EnumBase_14__Pyx_EnumBase_5__str__(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_self = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__str__ (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,0};
+    #endif
+    PyObject* values[1] = {0};
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_self)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 37, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__str__") < 0)) __PYX_ERR(1, 37, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 1)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+    }
+    __pyx_v_self = values[0];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("__str__", 1, 1, 1, __pyx_nargs); __PYX_ERR(1, 37, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumBase.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_8EnumBase_14__Pyx_EnumBase_4__str__(__pyx_self, __pyx_v_self);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8EnumBase_14__Pyx_EnumBase_4__str__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__str__", 0);
+
+  /* "EnumBase":38
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
+ *     def __str__(self):
+ *         return "%s.%s" % (self.__class__.__name__, self.name)             # <<<<<<<<<<<<<<
+ * 
+ * if PY_VERSION_HEX >= 0x03040000:
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_class); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 38, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 38, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_self, __pyx_n_s_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 38, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 38, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_1);
+  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
+  __pyx_t_2 = 0;
+  __pyx_t_1 = 0;
+  __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_s_s, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 38, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
+
+  /* "EnumBase":37
+ *     def __repr__(self):
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
+ *     def __str__(self):             # <<<<<<<<<<<<<<
+ *         return "%s.%s" % (self.__class__.__name__, self.name)
+ * 
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("EnumBase.__Pyx_EnumBase.__str__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "(tree fragment)":1
+ * def __pyx_unpickle___Pyx_EnumMeta(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
+ *     cdef object __pyx_PickleError
+ *     cdef object __pyx_result
+ */
+
+/* Python wrapper */
+static PyObject *__pyx_pw_8EnumBase_1__pyx_unpickle___Pyx_EnumMeta(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8EnumBase_1__pyx_unpickle___Pyx_EnumMeta = {"__pyx_unpickle___Pyx_EnumMeta", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8EnumBase_1__pyx_unpickle___Pyx_EnumMeta, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8EnumBase_1__pyx_unpickle___Pyx_EnumMeta(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v___pyx_type = 0;
+  long __pyx_v___pyx_checksum;
+  PyObject *__pyx_v___pyx_state = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("__pyx_unpickle___Pyx_EnumMeta (wrapper)", 0);
+  {
+    #if CYTHON_USE_MODULE_STATE
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_type,&__pyx_n_s_pyx_checksum,&__pyx_n_s_pyx_state,0};
+    #else
+    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_pyx_type,&__pyx_n_s_pyx_checksum,&__pyx_n_s_pyx_state,0};
+    #endif
+    PyObject* values[3] = {0,0,0};
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_pyx_type)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_pyx_checksum)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle___Pyx_EnumMeta", 1, 3, 3, 1); __PYX_ERR(1, 1, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_pyx_state)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("__pyx_unpickle___Pyx_EnumMeta", 1, 3, 3, 2); __PYX_ERR(1, 1, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__pyx_unpickle___Pyx_EnumMeta") < 0)) __PYX_ERR(1, 1, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 3)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+    }
+    __pyx_v___pyx_type = values[0];
+    __pyx_v___pyx_checksum = __Pyx_PyInt_As_long(values[1]); if (unlikely((__pyx_v___pyx_checksum == (long)-1) && PyErr_Occurred())) __PYX_ERR(1, 1, __pyx_L3_error)
+    __pyx_v___pyx_state = values[2];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("__pyx_unpickle___Pyx_EnumMeta", 1, 3, 3, __pyx_nargs); __PYX_ERR(1, 1, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("EnumBase.__pyx_unpickle___Pyx_EnumMeta", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_8EnumBase___pyx_unpickle___Pyx_EnumMeta(__pyx_self, __pyx_v___pyx_type, __pyx_v___pyx_checksum, __pyx_v___pyx_state);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8EnumBase___pyx_unpickle___Pyx_EnumMeta(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v___pyx_type, long __pyx_v___pyx_checksum, PyObject *__pyx_v___pyx_state) {
+  PyObject *__pyx_v___pyx_PickleError = 0;
+  PyObject *__pyx_v___pyx_result = 0;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_t_5;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__pyx_unpickle___Pyx_EnumMeta", 0);
+
+  /* "(tree fragment)":4
+ *     cdef object __pyx_PickleError
+ *     cdef object __pyx_result
+ *     if __pyx_checksum not in (0xe3b0c44, 0xda39a3e, 0xd41d8cd):             # <<<<<<<<<<<<<<
+ *         from pickle import PickleError as __pyx_PickleError
+ *         raise __pyx_PickleError, "Incompatible checksums (0x%x vs (0xe3b0c44, 0xda39a3e, 0xd41d8cd) = ())" % __pyx_checksum
+ */
+  __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_tuple__21, Py_NE)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (__pyx_t_2) {
+
+    /* "(tree fragment)":5
+ *     cdef object __pyx_result
+ *     if __pyx_checksum not in (0xe3b0c44, 0xda39a3e, 0xd41d8cd):
+ *         from pickle import PickleError as __pyx_PickleError             # <<<<<<<<<<<<<<
+ *         raise __pyx_PickleError, "Incompatible checksums (0x%x vs (0xe3b0c44, 0xda39a3e, 0xd41d8cd) = ())" % __pyx_checksum
+ *     __pyx_result = __Pyx_EnumMeta.__new__(__pyx_type)
+ */
+    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 5, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(__pyx_n_s_PickleError);
+    __Pyx_GIVEREF(__pyx_n_s_PickleError);
+    PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_PickleError);
+    __pyx_t_3 = __Pyx_Import(__pyx_n_s_pickle, __pyx_t_1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 5, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_PickleError); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 5, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_INCREF(__pyx_t_1);
+    __pyx_v___pyx_PickleError = __pyx_t_1;
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+    /* "(tree fragment)":6
+ *     if __pyx_checksum not in (0xe3b0c44, 0xda39a3e, 0xd41d8cd):
+ *         from pickle import PickleError as __pyx_PickleError
+ *         raise __pyx_PickleError, "Incompatible checksums (0x%x vs (0xe3b0c44, 0xda39a3e, 0xd41d8cd) = ())" % __pyx_checksum             # <<<<<<<<<<<<<<
+ *     __pyx_result = __Pyx_EnumMeta.__new__(__pyx_type)
+ *     if __pyx_state is not None:
+ */
+    __pyx_t_3 = __Pyx_PyInt_From_long(__pyx_v___pyx_checksum); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 6, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_1 = __Pyx_PyString_Format(__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 6, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_Raise(__pyx_v___pyx_PickleError, __pyx_t_1, 0, 0);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __PYX_ERR(1, 6, __pyx_L1_error)
+
+    /* "(tree fragment)":4
+ *     cdef object __pyx_PickleError
+ *     cdef object __pyx_result
+ *     if __pyx_checksum not in (0xe3b0c44, 0xda39a3e, 0xd41d8cd):             # <<<<<<<<<<<<<<
+ *         from pickle import PickleError as __pyx_PickleError
+ *         raise __pyx_PickleError, "Incompatible checksums (0x%x vs (0xe3b0c44, 0xda39a3e, 0xd41d8cd) = ())" % __pyx_checksum
+ */
+  }
+
+  /* "(tree fragment)":7
+ *         from pickle import PickleError as __pyx_PickleError
+ *         raise __pyx_PickleError, "Incompatible checksums (0x%x vs (0xe3b0c44, 0xda39a3e, 0xd41d8cd) = ())" % __pyx_checksum
+ *     __pyx_result = __Pyx_EnumMeta.__new__(__pyx_type)             # <<<<<<<<<<<<<<
+ *     if __pyx_state is not None:
+ *         __pyx_unpickle___Pyx_EnumMeta__set_state(<__Pyx_EnumMeta> __pyx_result, __pyx_state)
+ */
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_ptype___Pyx_EnumMeta), __pyx_n_s_new); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 7, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = NULL;
+  __pyx_t_5 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
+    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+    if (likely(__pyx_t_4)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+      __Pyx_INCREF(__pyx_t_4);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_3, function);
+      __pyx_t_5 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v___pyx_type};
+    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 7, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  }
+  __pyx_v___pyx_result = __pyx_t_1;
+  __pyx_t_1 = 0;
+
+  /* "(tree fragment)":8
+ *         raise __pyx_PickleError, "Incompatible checksums (0x%x vs (0xe3b0c44, 0xda39a3e, 0xd41d8cd) = ())" % __pyx_checksum
+ *     __pyx_result = __Pyx_EnumMeta.__new__(__pyx_type)
+ *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
+ *         __pyx_unpickle___Pyx_EnumMeta__set_state(<__Pyx_EnumMeta> __pyx_result, __pyx_state)
+ *     return __pyx_result
+ */
+  __pyx_t_2 = (__pyx_v___pyx_state != Py_None);
+  if (__pyx_t_2) {
+
+    /* "(tree fragment)":9
+ *     __pyx_result = __Pyx_EnumMeta.__new__(__pyx_type)
+ *     if __pyx_state is not None:
+ *         __pyx_unpickle___Pyx_EnumMeta__set_state(<__Pyx_EnumMeta> __pyx_result, __pyx_state)             # <<<<<<<<<<<<<<
+ *     return __pyx_result
+ * cdef __pyx_unpickle___Pyx_EnumMeta__set_state(__Pyx_EnumMeta __pyx_result, tuple __pyx_state):
+ */
+    if (!(likely(PyTuple_CheckExact(__pyx_v___pyx_state))||((__pyx_v___pyx_state) == Py_None) || __Pyx_RaiseUnexpectedTypeError("tuple", __pyx_v___pyx_state))) __PYX_ERR(1, 9, __pyx_L1_error)
+    __pyx_t_1 = __pyx_unpickle___Pyx_EnumMeta__set_state(((struct __pyx_obj___Pyx_EnumMeta *)__pyx_v___pyx_result), ((PyObject*)__pyx_v___pyx_state)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 9, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+    /* "(tree fragment)":8
+ *         raise __pyx_PickleError, "Incompatible checksums (0x%x vs (0xe3b0c44, 0xda39a3e, 0xd41d8cd) = ())" % __pyx_checksum
+ *     __pyx_result = __Pyx_EnumMeta.__new__(__pyx_type)
+ *     if __pyx_state is not None:             # <<<<<<<<<<<<<<
+ *         __pyx_unpickle___Pyx_EnumMeta__set_state(<__Pyx_EnumMeta> __pyx_result, __pyx_state)
+ *     return __pyx_result
+ */
+  }
+
+  /* "(tree fragment)":10
+ *     if __pyx_state is not None:
+ *         __pyx_unpickle___Pyx_EnumMeta__set_state(<__Pyx_EnumMeta> __pyx_result, __pyx_state)
+ *     return __pyx_result             # <<<<<<<<<<<<<<
+ * cdef __pyx_unpickle___Pyx_EnumMeta__set_state(__Pyx_EnumMeta __pyx_result, tuple __pyx_state):
+ *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
+ */
+  __Pyx_XDECREF(__pyx_r);
+  __Pyx_INCREF(__pyx_v___pyx_result);
+  __pyx_r = __pyx_v___pyx_result;
+  goto __pyx_L0;
+
+  /* "(tree fragment)":1
+ * def __pyx_unpickle___Pyx_EnumMeta(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
+ *     cdef object __pyx_PickleError
+ *     cdef object __pyx_result
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("EnumBase.__pyx_unpickle___Pyx_EnumMeta", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v___pyx_PickleError);
+  __Pyx_XDECREF(__pyx_v___pyx_result);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "(tree fragment)":11
+ *         __pyx_unpickle___Pyx_EnumMeta__set_state(<__Pyx_EnumMeta> __pyx_result, __pyx_state)
+ *     return __pyx_result
+ * cdef __pyx_unpickle___Pyx_EnumMeta__set_state(__Pyx_EnumMeta __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
+ *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
+ *         __pyx_result.__dict__.update(__pyx_state[0])
+ */
+
+static PyObject *__pyx_unpickle___Pyx_EnumMeta__set_state(struct __pyx_obj___Pyx_EnumMeta *__pyx_v___pyx_result, PyObject *__pyx_v___pyx_state) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  Py_ssize_t __pyx_t_2;
+  int __pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  int __pyx_t_8;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("__pyx_unpickle___Pyx_EnumMeta__set_state", 0);
+
+  /* "(tree fragment)":12
+ *     return __pyx_result
+ * cdef __pyx_unpickle___Pyx_EnumMeta__set_state(__Pyx_EnumMeta __pyx_result, tuple __pyx_state):
+ *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
+ *         __pyx_result.__dict__.update(__pyx_state[0])
+ */
+  if (unlikely(__pyx_v___pyx_state == Py_None)) {
+    PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
+    __PYX_ERR(1, 12, __pyx_L1_error)
+  }
+  __pyx_t_2 = PyTuple_GET_SIZE(__pyx_v___pyx_state); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(1, 12, __pyx_L1_error)
+  __pyx_t_3 = (__pyx_t_2 > 0);
+  if (__pyx_t_3) {
+  } else {
+    __pyx_t_1 = __pyx_t_3;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_3 = __Pyx_HasAttr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(1, 12, __pyx_L1_error)
+  __pyx_t_1 = __pyx_t_3;
+  __pyx_L4_bool_binop_done:;
+  if (__pyx_t_1) {
+
+    /* "(tree fragment)":13
+ * cdef __pyx_unpickle___Pyx_EnumMeta__set_state(__Pyx_EnumMeta __pyx_result, tuple __pyx_state):
+ *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
+ *         __pyx_result.__dict__.update(__pyx_state[0])             # <<<<<<<<<<<<<<
+ */
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v___pyx_result), __pyx_n_s_dict); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 13, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_update); if (unlikely(!__pyx_t_6)) __PYX_ERR(1, 13, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    if (unlikely(__pyx_v___pyx_state == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 13, __pyx_L1_error)
+    }
+    __pyx_t_5 = __Pyx_GetItemInt_Tuple(__pyx_v___pyx_state, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 13, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __pyx_t_7 = NULL;
+    __pyx_t_8 = 0;
+    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
+      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
+      if (likely(__pyx_t_7)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
+        __Pyx_INCREF(__pyx_t_7);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_6, function);
+        __pyx_t_8 = 1;
+      }
+    }
+    {
+      PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_t_5};
+      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
+      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 13, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    }
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "(tree fragment)":12
+ *     return __pyx_result
+ * cdef __pyx_unpickle___Pyx_EnumMeta__set_state(__Pyx_EnumMeta __pyx_result, tuple __pyx_state):
+ *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):             # <<<<<<<<<<<<<<
+ *         __pyx_result.__dict__.update(__pyx_state[0])
+ */
+  }
+
+  /* "(tree fragment)":11
+ *         __pyx_unpickle___Pyx_EnumMeta__set_state(<__Pyx_EnumMeta> __pyx_result, __pyx_state)
+ *     return __pyx_result
+ * cdef __pyx_unpickle___Pyx_EnumMeta__set_state(__Pyx_EnumMeta __pyx_result, tuple __pyx_state):             # <<<<<<<<<<<<<<
+ *     if len(__pyx_state) > 0 and hasattr(__pyx_result, '__dict__'):
+ *         __pyx_result.__dict__.update(__pyx_state[0])
+ */
+
+  /* function exit code */
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_AddTraceback("EnumBase.__pyx_unpickle___Pyx_EnumMeta__set_state", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl_Matrix(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *p;
+  PyObject *o;
+  #if CYTHON_COMPILING_IN_LIMITED_API
+  allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
+  o = alloc_func(t, 0);
+  #else
+  if (likely(!__Pyx_PyType_HasFeature(t, Py_TPFLAGS_IS_ABSTRACT))) {
+    o = (*t->tp_alloc)(t, 0);
+  } else {
+    o = (PyObject *) PyBaseObject_Type.tp_new(t, __pyx_empty_tuple, 0);
+  }
+  if (unlikely(!o)) return 0;
+  #endif
+  p = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *)o);
+  new((void*)&(p->matrix)) Matrix();
+  return o;
+}
+
+static void __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl_Matrix(PyObject *o) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix *)o;
+  #if CYTHON_USE_TP_FINALIZE
+  if (unlikely((PY_VERSION_HEX >= 0x03080000 || __Pyx_PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE)) && __Pyx_PyObject_GetSlot(o, tp_finalize, destructor)) && (!PyType_IS_GC(Py_TYPE(o)) || !_PyGC_FINALIZED(o))) {
+    if (__Pyx_PyObject_GetSlot(o, tp_dealloc, destructor) == __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl_Matrix) {
+      if (PyObject_CallFinalizerFromDealloc(o)) return;
+    }
+  }
+  #endif
+  __Pyx_call_destructor(p->matrix);
+  (*Py_TYPE(o)->tp_free)(o);
+}
+
+static PyMethodDef __pyx_methods_9rapidfuzz_16process_cpp_impl_Matrix[] = {
+  {"__reduce_cython__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_5__reduce_cython__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0},
+  {"__setstate_cython__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_7__setstate_cython__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0},
+  {0, 0, 0, 0}
+};
+#if CYTHON_USE_TYPE_SPECS
+#if !CYTHON_COMPILING_IN_LIMITED_API
+
+static PyBufferProcs __pyx_tp_as_buffer_Matrix = {
+  #if PY_MAJOR_VERSION < 3
+  0, /*bf_getreadbuffer*/
+  #endif
+  #if PY_MAJOR_VERSION < 3
+  0, /*bf_getwritebuffer*/
+  #endif
+  #if PY_MAJOR_VERSION < 3
+  0, /*bf_getsegcount*/
+  #endif
+  #if PY_MAJOR_VERSION < 3
+  0, /*bf_getcharbuffer*/
+  #endif
+  __pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_1__getbuffer__, /*bf_getbuffer*/
+  __pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_3__releasebuffer__, /*bf_releasebuffer*/
+};
+#endif
+static PyType_Slot __pyx_type_9rapidfuzz_16process_cpp_impl_Matrix_slots[] = {
+  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl_Matrix},
+  {Py_tp_methods, (void *)__pyx_methods_9rapidfuzz_16process_cpp_impl_Matrix},
+  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl_Matrix},
+  {0, 0},
+};
+static PyType_Spec __pyx_type_9rapidfuzz_16process_cpp_impl_Matrix_spec = {
+  "rapidfuzz.process_cpp_impl.Matrix",
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix),
+  0,
+  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE,
+  __pyx_type_9rapidfuzz_16process_cpp_impl_Matrix_slots,
+};
+#else
+
+static PyBufferProcs __pyx_tp_as_buffer_Matrix = {
+  #if PY_MAJOR_VERSION < 3
+  0, /*bf_getreadbuffer*/
+  #endif
+  #if PY_MAJOR_VERSION < 3
+  0, /*bf_getwritebuffer*/
+  #endif
+  #if PY_MAJOR_VERSION < 3
+  0, /*bf_getsegcount*/
+  #endif
+  #if PY_MAJOR_VERSION < 3
+  0, /*bf_getcharbuffer*/
+  #endif
+  __pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_1__getbuffer__, /*bf_getbuffer*/
+  __pyx_pw_9rapidfuzz_16process_cpp_impl_6Matrix_3__releasebuffer__, /*bf_releasebuffer*/
+};
+
+static PyTypeObject __pyx_type_9rapidfuzz_16process_cpp_impl_Matrix = {
+  PyVarObject_HEAD_INIT(0, 0)
+  "rapidfuzz.process_cpp_impl.""Matrix", /*tp_name*/
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl_Matrix), /*tp_basicsize*/
+  0, /*tp_itemsize*/
+  __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl_Matrix, /*tp_dealloc*/
+  #if PY_VERSION_HEX < 0x030800b4
+  0, /*tp_print*/
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b4
+  0, /*tp_vectorcall_offset*/
+  #endif
+  0, /*tp_getattr*/
+  0, /*tp_setattr*/
+  #if PY_MAJOR_VERSION < 3
+  0, /*tp_compare*/
+  #endif
+  #if PY_MAJOR_VERSION >= 3
+  0, /*tp_as_async*/
+  #endif
+  0, /*tp_repr*/
+  0, /*tp_as_number*/
+  0, /*tp_as_sequence*/
+  0, /*tp_as_mapping*/
+  0, /*tp_hash*/
+  0, /*tp_call*/
+  0, /*tp_str*/
+  0, /*tp_getattro*/
+  0, /*tp_setattro*/
+  &__pyx_tp_as_buffer_Matrix, /*tp_as_buffer*/
+  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE, /*tp_flags*/
+  0, /*tp_doc*/
+  0, /*tp_traverse*/
+  0, /*tp_clear*/
+  0, /*tp_richcompare*/
+  0, /*tp_weaklistoffset*/
+  0, /*tp_iter*/
+  0, /*tp_iternext*/
+  __pyx_methods_9rapidfuzz_16process_cpp_impl_Matrix, /*tp_methods*/
+  0, /*tp_members*/
+  0, /*tp_getset*/
+  0, /*tp_base*/
+  0, /*tp_dict*/
+  0, /*tp_descr_get*/
+  0, /*tp_descr_set*/
+  #if !CYTHON_USE_TYPE_SPECS
+  0, /*tp_dictoffset*/
+  #endif
+  0, /*tp_init*/
+  0, /*tp_alloc*/
+  __pyx_tp_new_9rapidfuzz_16process_cpp_impl_Matrix, /*tp_new*/
+  0, /*tp_free*/
+  0, /*tp_is_gc*/
+  0, /*tp_bases*/
+  0, /*tp_mro*/
+  0, /*tp_cache*/
+  0, /*tp_subclasses*/
+  0, /*tp_weaklist*/
+  0, /*tp_del*/
+  0, /*tp_version_tag*/
+  #if PY_VERSION_HEX >= 0x030400a1
+  #if CYTHON_USE_TP_FINALIZE
+  0, /*tp_finalize*/
+  #else
+  NULL, /*tp_finalize*/
+  #endif
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
+  0, /*tp_vectorcall*/
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
+  0, /*tp_print*/
+  #endif
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  0, /*tp_pypy_flags*/
+  #endif
+};
+#endif
+
+static struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter[8];
+static int __pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter = 0;
+
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *p;
   PyObject *o;
   #if CYTHON_COMPILING_IN_LIMITED_API
   allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
   o = alloc_func(t, 0);
   #else
-  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter)))) {
-    o = (PyObject*)__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter[--__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter];
-    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter));
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter)))) {
+    o = (PyObject*)__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter[--__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter];
+    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter));
     (void) PyObject_INIT(o, t);
     PyObject_GC_Track(o);
   } else {
     o = (*t->tp_alloc)(t, 0);
     if (unlikely(!o)) return 0;
   }
   #endif
-  p = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *)o);
+  p = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *)o);
   new((void*)&(p->__pyx_v_kwargs_context)) RF_KwargsWrapper();
   new((void*)&(p->__pyx_v_scorer_flags)) RF_ScorerFlags();
   return o;
 }
 
-static void __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter(PyObject *o) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *)o;
+static void __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter(PyObject *o) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *)o;
   PyObject_GC_UnTrack(o);
   __Pyx_call_destructor(p->__pyx_v_kwargs_context);
   __Pyx_call_destructor(p->__pyx_v_scorer_flags);
   Py_CLEAR(p->__pyx_v_choices);
   Py_CLEAR(p->__pyx_v_extract_iter_dict_f64);
   Py_CLEAR(p->__pyx_v_extract_iter_dict_i64);
   Py_CLEAR(p->__pyx_v_extract_iter_list_f64);
@@ -21402,24 +27211,24 @@
   Py_CLEAR(p->__pyx_v_py_extract_iter_dict);
   Py_CLEAR(p->__pyx_v_py_extract_iter_list);
   Py_CLEAR(p->__pyx_v_query);
   Py_CLEAR(p->__pyx_v_score_cutoff);
   Py_CLEAR(p->__pyx_v_scorer);
   Py_CLEAR(p->__pyx_v_scorer_capsule);
   Py_CLEAR(p->__pyx_v_worst_score);
-  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter)))) {
-    __pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter[__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter++] = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *)o);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter)))) {
+    __pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter[__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter++] = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *)o);
   } else {
     (*Py_TYPE(o)->tp_free)(o);
   }
 }
 
-static int __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter(PyObject *o, visitproc v, void *a) {
+static int __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter(PyObject *o, visitproc v, void *a) {
   int e;
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter *)o;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter *)o;
   if (p->__pyx_v_choices) {
     e = (*v)(p->__pyx_v_choices, a); if (e) return e;
   }
   if (p->__pyx_v_extract_iter_dict_f64) {
     e = (*v)(p->__pyx_v_extract_iter_dict_f64, a); if (e) return e;
   }
   if (p->__pyx_v_extract_iter_dict_i64) {
@@ -21463,35 +27272,35 @@
   }
   if (p->__pyx_v_worst_score) {
     e = (*v)(p->__pyx_v_worst_score, a); if (e) return e;
   }
   return 0;
 }
 #if CYTHON_USE_TYPE_SPECS
-static PyType_Slot __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter_slots[] = {
-  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter},
-  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter},
-  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter},
+static PyType_Slot __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter_slots[] = {
+  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter},
+  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter},
+  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter},
   {0, 0},
 };
-static PyType_Spec __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter_spec = {
-  "rapidfuzz.process_cpp.__pyx_scope_struct__extract_iter",
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter),
+static PyType_Spec __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter_spec = {
+  "rapidfuzz.process_cpp_impl.__pyx_scope_struct__extract_iter",
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter),
   0,
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC,
-  __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter_slots,
+  __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter_slots,
 };
 #else
 
-static PyTypeObject __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter = {
+static PyTypeObject __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter = {
   PyVarObject_HEAD_INIT(0, 0)
-  "rapidfuzz.process_cpp.""__pyx_scope_struct__extract_iter", /*tp_name*/
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter), /*tp_basicsize*/
+  "rapidfuzz.process_cpp_impl.""__pyx_scope_struct__extract_iter", /*tp_name*/
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter, /*tp_dealloc*/
+  __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
@@ -21510,15 +27319,15 @@
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   0, /*tp_doc*/
-  __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter, /*tp_traverse*/
+  __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter, /*tp_traverse*/
   0, /*tp_clear*/
   0, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
   0, /*tp_iter*/
   0, /*tp_iternext*/
   0, /*tp_methods*/
   0, /*tp_members*/
@@ -21528,15 +27337,15 @@
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   #if !CYTHON_USE_TYPE_SPECS
   0, /*tp_dictoffset*/
   #endif
   0, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter, /*tp_new*/
+  __pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -21557,66 +27366,66 @@
   #endif
   #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
   0, /*tp_pypy_flags*/
   #endif
 };
 #endif
 
-static struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64[8];
-static int __pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 = 0;
+static struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64[8];
+static int __pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 = 0;
 
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *p;
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *p;
   PyObject *o;
   #if CYTHON_COMPILING_IN_LIMITED_API
   allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
   o = alloc_func(t, 0);
   #else
-  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64)))) {
-    o = (PyObject*)__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64[--__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64];
-    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64));
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64)))) {
+    o = (PyObject*)__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64[--__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64];
+    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64));
     (void) PyObject_INIT(o, t);
     PyObject_GC_Track(o);
   } else {
     o = (*t->tp_alloc)(t, 0);
     if (unlikely(!o)) return 0;
   }
   #endif
-  p = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *)o);
+  p = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *)o);
   new((void*)&(p->__pyx_v_ScorerFunc)) RF_ScorerWrapper();
   new((void*)&(p->__pyx_v_choice_proc)) RF_StringWrapper();
   new((void*)&(p->__pyx_v_proc_str)) RF_String();
   new((void*)&(p->__pyx_v_query_proc)) RF_StringWrapper();
   new((void*)&(p->__pyx_v_scorer_func)) RF_ScorerFunc();
   return o;
 }
 
-static void __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64(PyObject *o) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *)o;
+static void __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64(PyObject *o) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *)o;
   PyObject_GC_UnTrack(o);
   __Pyx_call_destructor(p->__pyx_v_ScorerFunc);
   __Pyx_call_destructor(p->__pyx_v_choice_proc);
   __Pyx_call_destructor(p->__pyx_v_proc_str);
   __Pyx_call_destructor(p->__pyx_v_query_proc);
   __Pyx_call_destructor(p->__pyx_v_scorer_func);
   Py_CLEAR(p->__pyx_outer_scope);
   Py_CLEAR(p->__pyx_v_choice);
   Py_CLEAR(p->__pyx_v_choice_key);
   Py_CLEAR(p->__pyx_v_proc_choice);
   Py_CLEAR(p->__pyx_t_0);
-  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64)))) {
-    __pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64[__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64++] = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *)o);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64)))) {
+    __pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64[__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64++] = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *)o);
   } else {
     (*Py_TYPE(o)->tp_free)(o);
   }
 }
 
-static int __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64(PyObject *o, visitproc v, void *a) {
+static int __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64(PyObject *o, visitproc v, void *a) {
   int e;
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 *)o;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 *)o;
   if (p->__pyx_outer_scope) {
     e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
   }
   if (p->__pyx_v_choice) {
     e = (*v)(p->__pyx_v_choice, a); if (e) return e;
   }
   if (p->__pyx_v_choice_key) {
@@ -21627,35 +27436,35 @@
   }
   if (p->__pyx_t_0) {
     e = (*v)(p->__pyx_t_0, a); if (e) return e;
   }
   return 0;
 }
 #if CYTHON_USE_TYPE_SPECS
-static PyType_Slot __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64_slots[] = {
-  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64},
-  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64},
-  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64},
+static PyType_Slot __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64_slots[] = {
+  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64},
+  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64},
+  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64},
   {0, 0},
 };
-static PyType_Spec __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64_spec = {
-  "rapidfuzz.process_cpp.__pyx_scope_struct_1_extract_iter_dict_f64",
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64),
+static PyType_Spec __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64_spec = {
+  "rapidfuzz.process_cpp_impl.__pyx_scope_struct_1_extract_iter_dict_f64",
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64),
   0,
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC,
-  __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64_slots,
+  __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64_slots,
 };
 #else
 
-static PyTypeObject __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 = {
+static PyTypeObject __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 = {
   PyVarObject_HEAD_INIT(0, 0)
-  "rapidfuzz.process_cpp.""__pyx_scope_struct_1_extract_iter_dict_f64", /*tp_name*/
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64), /*tp_basicsize*/
+  "rapidfuzz.process_cpp_impl.""__pyx_scope_struct_1_extract_iter_dict_f64", /*tp_name*/
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64, /*tp_dealloc*/
+  __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
@@ -21674,15 +27483,15 @@
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   0, /*tp_doc*/
-  __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64, /*tp_traverse*/
+  __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64, /*tp_traverse*/
   0, /*tp_clear*/
   0, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
   0, /*tp_iter*/
   0, /*tp_iternext*/
   0, /*tp_methods*/
   0, /*tp_members*/
@@ -21692,15 +27501,15 @@
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   #if !CYTHON_USE_TYPE_SPECS
   0, /*tp_dictoffset*/
   #endif
   0, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64, /*tp_new*/
+  __pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -21721,66 +27530,66 @@
   #endif
   #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
   0, /*tp_pypy_flags*/
   #endif
 };
 #endif
 
-static struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64[8];
-static int __pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 = 0;
+static struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64[8];
+static int __pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 = 0;
 
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *p;
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *p;
   PyObject *o;
   #if CYTHON_COMPILING_IN_LIMITED_API
   allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
   o = alloc_func(t, 0);
   #else
-  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64)))) {
-    o = (PyObject*)__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64[--__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64];
-    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64));
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64)))) {
+    o = (PyObject*)__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64[--__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64];
+    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64));
     (void) PyObject_INIT(o, t);
     PyObject_GC_Track(o);
   } else {
     o = (*t->tp_alloc)(t, 0);
     if (unlikely(!o)) return 0;
   }
   #endif
-  p = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *)o);
+  p = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *)o);
   new((void*)&(p->__pyx_v_ScorerFunc)) RF_ScorerWrapper();
   new((void*)&(p->__pyx_v_choice_proc)) RF_StringWrapper();
   new((void*)&(p->__pyx_v_proc_str)) RF_String();
   new((void*)&(p->__pyx_v_query_proc)) RF_StringWrapper();
   new((void*)&(p->__pyx_v_scorer_func)) RF_ScorerFunc();
   return o;
 }
 
-static void __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64(PyObject *o) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *)o;
+static void __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64(PyObject *o) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *)o;
   PyObject_GC_UnTrack(o);
   __Pyx_call_destructor(p->__pyx_v_ScorerFunc);
   __Pyx_call_destructor(p->__pyx_v_choice_proc);
   __Pyx_call_destructor(p->__pyx_v_proc_str);
   __Pyx_call_destructor(p->__pyx_v_query_proc);
   __Pyx_call_destructor(p->__pyx_v_scorer_func);
   Py_CLEAR(p->__pyx_outer_scope);
   Py_CLEAR(p->__pyx_v_choice);
   Py_CLEAR(p->__pyx_v_choice_key);
   Py_CLEAR(p->__pyx_v_proc_choice);
   Py_CLEAR(p->__pyx_t_0);
-  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64)))) {
-    __pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64[__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64++] = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *)o);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64)))) {
+    __pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64[__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64++] = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *)o);
   } else {
     (*Py_TYPE(o)->tp_free)(o);
   }
 }
 
-static int __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64(PyObject *o, visitproc v, void *a) {
+static int __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64(PyObject *o, visitproc v, void *a) {
   int e;
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 *)o;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 *)o;
   if (p->__pyx_outer_scope) {
     e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
   }
   if (p->__pyx_v_choice) {
     e = (*v)(p->__pyx_v_choice, a); if (e) return e;
   }
   if (p->__pyx_v_choice_key) {
@@ -21791,35 +27600,35 @@
   }
   if (p->__pyx_t_0) {
     e = (*v)(p->__pyx_t_0, a); if (e) return e;
   }
   return 0;
 }
 #if CYTHON_USE_TYPE_SPECS
-static PyType_Slot __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64_slots[] = {
-  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64},
-  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64},
-  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64},
+static PyType_Slot __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64_slots[] = {
+  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64},
+  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64},
+  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64},
   {0, 0},
 };
-static PyType_Spec __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64_spec = {
-  "rapidfuzz.process_cpp.__pyx_scope_struct_2_extract_iter_dict_i64",
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64),
+static PyType_Spec __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64_spec = {
+  "rapidfuzz.process_cpp_impl.__pyx_scope_struct_2_extract_iter_dict_i64",
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64),
   0,
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC,
-  __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64_slots,
+  __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64_slots,
 };
 #else
 
-static PyTypeObject __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 = {
+static PyTypeObject __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 = {
   PyVarObject_HEAD_INIT(0, 0)
-  "rapidfuzz.process_cpp.""__pyx_scope_struct_2_extract_iter_dict_i64", /*tp_name*/
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64), /*tp_basicsize*/
+  "rapidfuzz.process_cpp_impl.""__pyx_scope_struct_2_extract_iter_dict_i64", /*tp_name*/
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64, /*tp_dealloc*/
+  __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
@@ -21838,15 +27647,15 @@
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   0, /*tp_doc*/
-  __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64, /*tp_traverse*/
+  __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64, /*tp_traverse*/
   0, /*tp_clear*/
   0, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
   0, /*tp_iter*/
   0, /*tp_iternext*/
   0, /*tp_methods*/
   0, /*tp_members*/
@@ -21856,15 +27665,15 @@
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   #if !CYTHON_USE_TYPE_SPECS
   0, /*tp_dictoffset*/
   #endif
   0, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64, /*tp_new*/
+  __pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -21885,67 +27694,67 @@
   #endif
   #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
   0, /*tp_pypy_flags*/
   #endif
 };
 #endif
 
-static struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64[8];
-static int __pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 = 0;
+static struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64[8];
+static int __pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 = 0;
 
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *p;
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *p;
   PyObject *o;
   #if CYTHON_COMPILING_IN_LIMITED_API
   allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
   o = alloc_func(t, 0);
   #else
-  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64)))) {
-    o = (PyObject*)__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64[--__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64];
-    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64));
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64)))) {
+    o = (PyObject*)__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64[--__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64];
+    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64));
     (void) PyObject_INIT(o, t);
     PyObject_GC_Track(o);
   } else {
     o = (*t->tp_alloc)(t, 0);
     if (unlikely(!o)) return 0;
   }
   #endif
-  p = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *)o);
+  p = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *)o);
   new((void*)&(p->__pyx_v_ScorerFunc)) RF_ScorerWrapper();
   new((void*)&(p->__pyx_v_choice_proc)) RF_StringWrapper();
   new((void*)&(p->__pyx_v_proc_str)) RF_String();
   new((void*)&(p->__pyx_v_query_proc)) RF_StringWrapper();
   new((void*)&(p->__pyx_v_scorer_func)) RF_ScorerFunc();
   return o;
 }
 
-static void __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64(PyObject *o) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *)o;
+static void __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64(PyObject *o) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *)o;
   PyObject_GC_UnTrack(o);
   __Pyx_call_destructor(p->__pyx_v_ScorerFunc);
   __Pyx_call_destructor(p->__pyx_v_choice_proc);
   __Pyx_call_destructor(p->__pyx_v_proc_str);
   __Pyx_call_destructor(p->__pyx_v_query_proc);
   __Pyx_call_destructor(p->__pyx_v_scorer_func);
   Py_CLEAR(p->__pyx_outer_scope);
   Py_CLEAR(p->__pyx_v_choice);
   Py_CLEAR(p->__pyx_v_i);
   Py_CLEAR(p->__pyx_v_proc_choice);
   Py_CLEAR(p->__pyx_t_0);
   Py_CLEAR(p->__pyx_t_1);
-  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64)))) {
-    __pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64[__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64++] = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *)o);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64)))) {
+    __pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64[__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64++] = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *)o);
   } else {
     (*Py_TYPE(o)->tp_free)(o);
   }
 }
 
-static int __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64(PyObject *o, visitproc v, void *a) {
+static int __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64(PyObject *o, visitproc v, void *a) {
   int e;
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 *)o;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 *)o;
   if (p->__pyx_outer_scope) {
     e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
   }
   if (p->__pyx_v_choice) {
     e = (*v)(p->__pyx_v_choice, a); if (e) return e;
   }
   if (p->__pyx_v_i) {
@@ -21959,35 +27768,35 @@
   }
   if (p->__pyx_t_1) {
     e = (*v)(p->__pyx_t_1, a); if (e) return e;
   }
   return 0;
 }
 #if CYTHON_USE_TYPE_SPECS
-static PyType_Slot __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64_slots[] = {
-  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64},
-  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64},
-  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64},
+static PyType_Slot __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64_slots[] = {
+  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64},
+  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64},
+  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64},
   {0, 0},
 };
-static PyType_Spec __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64_spec = {
-  "rapidfuzz.process_cpp.__pyx_scope_struct_3_extract_iter_list_f64",
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64),
+static PyType_Spec __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64_spec = {
+  "rapidfuzz.process_cpp_impl.__pyx_scope_struct_3_extract_iter_list_f64",
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64),
   0,
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC,
-  __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64_slots,
+  __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64_slots,
 };
 #else
 
-static PyTypeObject __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 = {
+static PyTypeObject __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 = {
   PyVarObject_HEAD_INIT(0, 0)
-  "rapidfuzz.process_cpp.""__pyx_scope_struct_3_extract_iter_list_f64", /*tp_name*/
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64), /*tp_basicsize*/
+  "rapidfuzz.process_cpp_impl.""__pyx_scope_struct_3_extract_iter_list_f64", /*tp_name*/
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64, /*tp_dealloc*/
+  __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
@@ -22006,15 +27815,15 @@
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   0, /*tp_doc*/
-  __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64, /*tp_traverse*/
+  __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64, /*tp_traverse*/
   0, /*tp_clear*/
   0, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
   0, /*tp_iter*/
   0, /*tp_iternext*/
   0, /*tp_methods*/
   0, /*tp_members*/
@@ -22024,15 +27833,15 @@
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   #if !CYTHON_USE_TYPE_SPECS
   0, /*tp_dictoffset*/
   #endif
   0, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64, /*tp_new*/
+  __pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -22053,67 +27862,67 @@
   #endif
   #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
   0, /*tp_pypy_flags*/
   #endif
 };
 #endif
 
-static struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64[8];
-static int __pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 = 0;
+static struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64[8];
+static int __pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 = 0;
 
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *p;
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *p;
   PyObject *o;
   #if CYTHON_COMPILING_IN_LIMITED_API
   allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
   o = alloc_func(t, 0);
   #else
-  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64)))) {
-    o = (PyObject*)__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64[--__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64];
-    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64));
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64)))) {
+    o = (PyObject*)__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64[--__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64];
+    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64));
     (void) PyObject_INIT(o, t);
     PyObject_GC_Track(o);
   } else {
     o = (*t->tp_alloc)(t, 0);
     if (unlikely(!o)) return 0;
   }
   #endif
-  p = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *)o);
+  p = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *)o);
   new((void*)&(p->__pyx_v_ScorerFunc)) RF_ScorerWrapper();
   new((void*)&(p->__pyx_v_choice_proc)) RF_StringWrapper();
   new((void*)&(p->__pyx_v_proc_str)) RF_String();
   new((void*)&(p->__pyx_v_query_proc)) RF_StringWrapper();
   new((void*)&(p->__pyx_v_scorer_func)) RF_ScorerFunc();
   return o;
 }
 
-static void __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64(PyObject *o) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *)o;
+static void __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64(PyObject *o) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *)o;
   PyObject_GC_UnTrack(o);
   __Pyx_call_destructor(p->__pyx_v_ScorerFunc);
   __Pyx_call_destructor(p->__pyx_v_choice_proc);
   __Pyx_call_destructor(p->__pyx_v_proc_str);
   __Pyx_call_destructor(p->__pyx_v_query_proc);
   __Pyx_call_destructor(p->__pyx_v_scorer_func);
   Py_CLEAR(p->__pyx_outer_scope);
   Py_CLEAR(p->__pyx_v_choice);
   Py_CLEAR(p->__pyx_v_i);
   Py_CLEAR(p->__pyx_v_proc_choice);
   Py_CLEAR(p->__pyx_t_0);
   Py_CLEAR(p->__pyx_t_1);
-  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64)))) {
-    __pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64[__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64++] = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *)o);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64)))) {
+    __pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64[__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64++] = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *)o);
   } else {
     (*Py_TYPE(o)->tp_free)(o);
   }
 }
 
-static int __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64(PyObject *o, visitproc v, void *a) {
+static int __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64(PyObject *o, visitproc v, void *a) {
   int e;
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 *)o;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 *)o;
   if (p->__pyx_outer_scope) {
     e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
   }
   if (p->__pyx_v_choice) {
     e = (*v)(p->__pyx_v_choice, a); if (e) return e;
   }
   if (p->__pyx_v_i) {
@@ -22127,35 +27936,35 @@
   }
   if (p->__pyx_t_1) {
     e = (*v)(p->__pyx_t_1, a); if (e) return e;
   }
   return 0;
 }
 #if CYTHON_USE_TYPE_SPECS
-static PyType_Slot __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64_slots[] = {
-  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64},
-  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64},
-  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64},
+static PyType_Slot __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64_slots[] = {
+  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64},
+  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64},
+  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64},
   {0, 0},
 };
-static PyType_Spec __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64_spec = {
-  "rapidfuzz.process_cpp.__pyx_scope_struct_4_extract_iter_list_i64",
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64),
+static PyType_Spec __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64_spec = {
+  "rapidfuzz.process_cpp_impl.__pyx_scope_struct_4_extract_iter_list_i64",
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64),
   0,
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC,
-  __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64_slots,
+  __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64_slots,
 };
 #else
 
-static PyTypeObject __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 = {
+static PyTypeObject __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 = {
   PyVarObject_HEAD_INIT(0, 0)
-  "rapidfuzz.process_cpp.""__pyx_scope_struct_4_extract_iter_list_i64", /*tp_name*/
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64), /*tp_basicsize*/
+  "rapidfuzz.process_cpp_impl.""__pyx_scope_struct_4_extract_iter_list_i64", /*tp_name*/
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64, /*tp_dealloc*/
+  __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
@@ -22174,15 +27983,15 @@
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   0, /*tp_doc*/
-  __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64, /*tp_traverse*/
+  __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64, /*tp_traverse*/
   0, /*tp_clear*/
   0, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
   0, /*tp_iter*/
   0, /*tp_iternext*/
   0, /*tp_methods*/
   0, /*tp_members*/
@@ -22192,15 +28001,15 @@
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   #if !CYTHON_USE_TYPE_SPECS
   0, /*tp_dictoffset*/
   #endif
   0, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64, /*tp_new*/
+  __pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -22221,56 +28030,56 @@
   #endif
   #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
   0, /*tp_pypy_flags*/
   #endif
 };
 #endif
 
-static struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict[8];
-static int __pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict = 0;
+static struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict[8];
+static int __pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict = 0;
 
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
   #if CYTHON_COMPILING_IN_LIMITED_API
   allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
   o = alloc_func(t, 0);
   #else
-  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict)))) {
-    o = (PyObject*)__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict[--__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict];
-    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict));
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict)))) {
+    o = (PyObject*)__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict[--__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict];
+    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict));
     (void) PyObject_INIT(o, t);
     PyObject_GC_Track(o);
   } else {
     o = (*t->tp_alloc)(t, 0);
     if (unlikely(!o)) return 0;
   }
   #endif
   return o;
 }
 
-static void __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict(PyObject *o) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *)o;
+static void __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict(PyObject *o) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *)o;
   PyObject_GC_UnTrack(o);
   Py_CLEAR(p->__pyx_outer_scope);
   Py_CLEAR(p->__pyx_v_choice);
   Py_CLEAR(p->__pyx_v_choice_key);
   Py_CLEAR(p->__pyx_v_optimal_score);
   Py_CLEAR(p->__pyx_v_score);
   Py_CLEAR(p->__pyx_v_worst_score);
   Py_CLEAR(p->__pyx_t_0);
-  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict)))) {
-    __pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict[__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict++] = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *)o);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict)))) {
+    __pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict[__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict++] = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *)o);
   } else {
     (*Py_TYPE(o)->tp_free)(o);
   }
 }
 
-static int __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict(PyObject *o, visitproc v, void *a) {
+static int __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict(PyObject *o, visitproc v, void *a) {
   int e;
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict *)o;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict *)o;
   if (p->__pyx_outer_scope) {
     e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
   }
   if (p->__pyx_v_choice) {
     e = (*v)(p->__pyx_v_choice, a); if (e) return e;
   }
   if (p->__pyx_v_choice_key) {
@@ -22287,35 +28096,35 @@
   }
   if (p->__pyx_t_0) {
     e = (*v)(p->__pyx_t_0, a); if (e) return e;
   }
   return 0;
 }
 #if CYTHON_USE_TYPE_SPECS
-static PyType_Slot __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict_slots[] = {
-  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict},
-  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict},
-  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict},
+static PyType_Slot __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict_slots[] = {
+  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict},
+  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict},
+  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict},
   {0, 0},
 };
-static PyType_Spec __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict_spec = {
-  "rapidfuzz.process_cpp.__pyx_scope_struct_5_py_extract_iter_dict",
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict),
+static PyType_Spec __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict_spec = {
+  "rapidfuzz.process_cpp_impl.__pyx_scope_struct_5_py_extract_iter_dict",
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict),
   0,
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC,
-  __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict_slots,
+  __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict_slots,
 };
 #else
 
-static PyTypeObject __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict = {
+static PyTypeObject __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict = {
   PyVarObject_HEAD_INIT(0, 0)
-  "rapidfuzz.process_cpp.""__pyx_scope_struct_5_py_extract_iter_dict", /*tp_name*/
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict), /*tp_basicsize*/
+  "rapidfuzz.process_cpp_impl.""__pyx_scope_struct_5_py_extract_iter_dict", /*tp_name*/
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict, /*tp_dealloc*/
+  __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
@@ -22334,15 +28143,15 @@
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   0, /*tp_doc*/
-  __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict, /*tp_traverse*/
+  __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict, /*tp_traverse*/
   0, /*tp_clear*/
   0, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
   0, /*tp_iter*/
   0, /*tp_iternext*/
   0, /*tp_methods*/
   0, /*tp_members*/
@@ -22352,15 +28161,15 @@
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   #if !CYTHON_USE_TYPE_SPECS
   0, /*tp_dictoffset*/
   #endif
   0, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict, /*tp_new*/
+  __pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -22381,55 +28190,55 @@
   #endif
   #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
   0, /*tp_pypy_flags*/
   #endif
 };
 #endif
 
-static struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list[8];
-static int __pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list = 0;
+static struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list[8];
+static int __pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list = 0;
 
-static PyObject *__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
+static PyObject *__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
   #if CYTHON_COMPILING_IN_LIMITED_API
   allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
   o = alloc_func(t, 0);
   #else
-  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list)))) {
-    o = (PyObject*)__pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list[--__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list];
-    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list));
+  if (CYTHON_COMPILING_IN_CPYTHON && likely((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list > 0) & (t->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list)))) {
+    o = (PyObject*)__pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list[--__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list];
+    memset(o, 0, sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list));
     (void) PyObject_INIT(o, t);
     PyObject_GC_Track(o);
   } else {
     o = (*t->tp_alloc)(t, 0);
     if (unlikely(!o)) return 0;
   }
   #endif
   return o;
 }
 
-static void __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list(PyObject *o) {
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *)o;
+static void __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list(PyObject *o) {
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *)o;
   PyObject_GC_UnTrack(o);
   Py_CLEAR(p->__pyx_outer_scope);
   Py_CLEAR(p->__pyx_v_choice);
   Py_CLEAR(p->__pyx_v_optimal_score);
   Py_CLEAR(p->__pyx_v_score);
   Py_CLEAR(p->__pyx_v_worst_score);
   Py_CLEAR(p->__pyx_t_0);
-  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list)))) {
-    __pyx_freelist_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list[__pyx_freecount_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list++] = ((struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *)o);
+  if (CYTHON_COMPILING_IN_CPYTHON && ((__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list < 8) & (Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list)))) {
+    __pyx_freelist_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list[__pyx_freecount_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list++] = ((struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *)o);
   } else {
     (*Py_TYPE(o)->tp_free)(o);
   }
 }
 
-static int __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list(PyObject *o, visitproc v, void *a) {
+static int __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list(PyObject *o, visitproc v, void *a) {
   int e;
-  struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *p = (struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list *)o;
+  struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *p = (struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list *)o;
   if (p->__pyx_outer_scope) {
     e = (*v)(((PyObject *)p->__pyx_outer_scope), a); if (e) return e;
   }
   if (p->__pyx_v_choice) {
     e = (*v)(p->__pyx_v_choice, a); if (e) return e;
   }
   if (p->__pyx_v_optimal_score) {
@@ -22443,35 +28252,35 @@
   }
   if (p->__pyx_t_0) {
     e = (*v)(p->__pyx_t_0, a); if (e) return e;
   }
   return 0;
 }
 #if CYTHON_USE_TYPE_SPECS
-static PyType_Slot __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list_slots[] = {
-  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list},
-  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list},
-  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list},
+static PyType_Slot __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list_slots[] = {
+  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list},
+  {Py_tp_traverse, (void *)__pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list},
+  {Py_tp_new, (void *)__pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list},
   {0, 0},
 };
-static PyType_Spec __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list_spec = {
-  "rapidfuzz.process_cpp.__pyx_scope_struct_6_py_extract_iter_list",
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list),
+static PyType_Spec __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list_spec = {
+  "rapidfuzz.process_cpp_impl.__pyx_scope_struct_6_py_extract_iter_list",
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list),
   0,
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC,
-  __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list_slots,
+  __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list_slots,
 };
 #else
 
-static PyTypeObject __pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list = {
+static PyTypeObject __pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list = {
   PyVarObject_HEAD_INIT(0, 0)
-  "rapidfuzz.process_cpp.""__pyx_scope_struct_6_py_extract_iter_list", /*tp_name*/
-  sizeof(struct __pyx_obj_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list), /*tp_basicsize*/
+  "rapidfuzz.process_cpp_impl.""__pyx_scope_struct_6_py_extract_iter_list", /*tp_name*/
+  sizeof(struct __pyx_obj_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list), /*tp_basicsize*/
   0, /*tp_itemsize*/
-  __pyx_tp_dealloc_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list, /*tp_dealloc*/
+  __pyx_tp_dealloc_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list, /*tp_dealloc*/
   #if PY_VERSION_HEX < 0x030800b4
   0, /*tp_print*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4
   0, /*tp_vectorcall_offset*/
   #endif
   0, /*tp_getattr*/
@@ -22490,15 +28299,15 @@
   0, /*tp_call*/
   0, /*tp_str*/
   0, /*tp_getattro*/
   0, /*tp_setattro*/
   0, /*tp_as_buffer*/
   Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
   0, /*tp_doc*/
-  __pyx_tp_traverse_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list, /*tp_traverse*/
+  __pyx_tp_traverse_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list, /*tp_traverse*/
   0, /*tp_clear*/
   0, /*tp_richcompare*/
   0, /*tp_weaklistoffset*/
   0, /*tp_iter*/
   0, /*tp_iternext*/
   0, /*tp_methods*/
   0, /*tp_members*/
@@ -22508,15 +28317,156 @@
   0, /*tp_descr_get*/
   0, /*tp_descr_set*/
   #if !CYTHON_USE_TYPE_SPECS
   0, /*tp_dictoffset*/
   #endif
   0, /*tp_init*/
   0, /*tp_alloc*/
-  __pyx_tp_new_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list, /*tp_new*/
+  __pyx_tp_new_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list, /*tp_new*/
+  0, /*tp_free*/
+  0, /*tp_is_gc*/
+  0, /*tp_bases*/
+  0, /*tp_mro*/
+  0, /*tp_cache*/
+  0, /*tp_subclasses*/
+  0, /*tp_weaklist*/
+  0, /*tp_del*/
+  0, /*tp_version_tag*/
+  #if PY_VERSION_HEX >= 0x030400a1
+  #if CYTHON_USE_TP_FINALIZE
+  0, /*tp_finalize*/
+  #else
+  NULL, /*tp_finalize*/
+  #endif
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
+  0, /*tp_vectorcall*/
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
+  0, /*tp_print*/
+  #endif
+  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000
+  0, /*tp_pypy_flags*/
+  #endif
+};
+#endif
+
+static int __pyx_tp_traverse___Pyx_EnumMeta(PyObject *o, visitproc v, void *a) {
+  int e;
+  if (!(&PyType_Type)->tp_traverse); else { e = (&PyType_Type)->tp_traverse(o,v,a); if (e) return e; }
+  return 0;
+}
+
+static int __pyx_tp_clear___Pyx_EnumMeta(PyObject *o) {
+  if (!(&PyType_Type)->tp_clear); else (&PyType_Type)->tp_clear(o);
+  return 0;
+}
+static PyObject *__pyx_sq_item___Pyx_EnumMeta(PyObject *o, Py_ssize_t i) {
+  PyObject *r;
+  PyObject *x = PyInt_FromSsize_t(i); if(!x) return 0;
+  r = Py_TYPE(o)->tp_as_mapping->mp_subscript(o, x);
+  Py_DECREF(x);
+  return r;
+}
+
+static PyMethodDef __pyx_methods___Pyx_EnumMeta[] = {
+  {"__reduce_cython__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8EnumBase_14__Pyx_EnumMeta_7__reduce_cython__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0},
+  {"__setstate_cython__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8EnumBase_14__Pyx_EnumMeta_9__setstate_cython__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0},
+  {0, 0, 0, 0}
+};
+#if CYTHON_USE_TYPE_SPECS
+static PyType_Slot __Pyx_EnumMeta_slots[] = {
+  {Py_sq_item, (void *)__pyx_sq_item___Pyx_EnumMeta},
+  {Py_mp_subscript, (void *)__pyx_pw_8EnumBase_14__Pyx_EnumMeta_5__getitem__},
+  {Py_tp_traverse, (void *)__pyx_tp_traverse___Pyx_EnumMeta},
+  {Py_tp_clear, (void *)__pyx_tp_clear___Pyx_EnumMeta},
+  {Py_tp_iter, (void *)__pyx_pw_8EnumBase_14__Pyx_EnumMeta_3__iter__},
+  {Py_tp_methods, (void *)__pyx_methods___Pyx_EnumMeta},
+  {Py_tp_init, (void *)__pyx_pw_8EnumBase_14__Pyx_EnumMeta_1__init__},
+  {0, 0},
+};
+static PyType_Spec __Pyx_EnumMeta_spec = {
+  "rapidfuzz.process_cpp_impl.__Pyx_EnumMeta",
+  sizeof(struct __pyx_obj___Pyx_EnumMeta),
+  0,
+  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC,
+  __Pyx_EnumMeta_slots,
+};
+#else
+
+static PySequenceMethods __pyx_tp_as_sequence___Pyx_EnumMeta = {
+  0, /*sq_length*/
+  0, /*sq_concat*/
+  0, /*sq_repeat*/
+  __pyx_sq_item___Pyx_EnumMeta, /*sq_item*/
+  0, /*sq_slice*/
+  0, /*sq_ass_item*/
+  0, /*sq_ass_slice*/
+  0, /*sq_contains*/
+  0, /*sq_inplace_concat*/
+  0, /*sq_inplace_repeat*/
+};
+
+static PyMappingMethods __pyx_tp_as_mapping___Pyx_EnumMeta = {
+  0, /*mp_length*/
+  __pyx_pw_8EnumBase_14__Pyx_EnumMeta_5__getitem__, /*mp_subscript*/
+  0, /*mp_ass_subscript*/
+};
+
+static PyTypeObject __Pyx_EnumMeta = {
+  PyVarObject_HEAD_INIT(0, 0)
+  "rapidfuzz.process_cpp_impl.""__Pyx_EnumMeta", /*tp_name*/
+  sizeof(struct __pyx_obj___Pyx_EnumMeta), /*tp_basicsize*/
+  0, /*tp_itemsize*/
+  0, /*tp_dealloc*/
+  #if PY_VERSION_HEX < 0x030800b4
+  0, /*tp_print*/
+  #endif
+  #if PY_VERSION_HEX >= 0x030800b4
+  0, /*tp_vectorcall_offset*/
+  #endif
+  0, /*tp_getattr*/
+  0, /*tp_setattr*/
+  #if PY_MAJOR_VERSION < 3
+  0, /*tp_compare*/
+  #endif
+  #if PY_MAJOR_VERSION >= 3
+  0, /*tp_as_async*/
+  #endif
+  0, /*tp_repr*/
+  0, /*tp_as_number*/
+  &__pyx_tp_as_sequence___Pyx_EnumMeta, /*tp_as_sequence*/
+  &__pyx_tp_as_mapping___Pyx_EnumMeta, /*tp_as_mapping*/
+  0, /*tp_hash*/
+  0, /*tp_call*/
+  0, /*tp_str*/
+  0, /*tp_getattro*/
+  0, /*tp_setattro*/
+  0, /*tp_as_buffer*/
+  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_BASETYPE|Py_TPFLAGS_HAVE_GC, /*tp_flags*/
+  0, /*tp_doc*/
+  __pyx_tp_traverse___Pyx_EnumMeta, /*tp_traverse*/
+  __pyx_tp_clear___Pyx_EnumMeta, /*tp_clear*/
+  0, /*tp_richcompare*/
+  0, /*tp_weaklistoffset*/
+  __pyx_pw_8EnumBase_14__Pyx_EnumMeta_3__iter__, /*tp_iter*/
+  0, /*tp_iternext*/
+  __pyx_methods___Pyx_EnumMeta, /*tp_methods*/
+  0, /*tp_members*/
+  0, /*tp_getset*/
+  0, /*tp_base*/
+  0, /*tp_dict*/
+  0, /*tp_descr_get*/
+  0, /*tp_descr_set*/
+  #if !CYTHON_USE_TYPE_SPECS
+  0, /*tp_dictoffset*/
+  #endif
+  __pyx_pw_8EnumBase_14__Pyx_EnumMeta_1__init__, /*tp_init*/
+  0, /*tp_alloc*/
+  0, /*tp_new*/
   0, /*tp_free*/
   0, /*tp_is_gc*/
   0, /*tp_bases*/
   0, /*tp_mro*/
   0, /*tp_cache*/
   0, /*tp_subclasses*/
   0, /*tp_weaklist*/
@@ -22553,481 +28503,826 @@
     #define CYTHON_SMALL_CODE
 #endif
 #endif
 /* #### Code section: pystring_table ### */
 
 static __Pyx_StringTabEntry __pyx_string_tab[] = {
   #if CYTHON_USE_MODULE_STATE
-  {0, __pyx_k_Find_the_best_match_in_a_list_o, sizeof(__pyx_k_Find_the_best_match_in_a_list_o), 0, 1, 0, 0},
+  {0, __pyx_k_EnumBase, sizeof(__pyx_k_EnumBase), 0, 0, 1, 1},
+  {0, __pyx_k_FLOAT32, sizeof(__pyx_k_FLOAT32), 0, 0, 1, 1},
+  {0, __pyx_k_FLOAT64, sizeof(__pyx_k_FLOAT64), 0, 0, 1, 1},
   {0, __pyx_k_Got_unexpected_keyword_arguments, sizeof(__pyx_k_Got_unexpected_keyword_arguments), 0, 1, 0, 0},
+  {0, __pyx_k_INT16, sizeof(__pyx_k_INT16), 0, 0, 1, 1},
+  {0, __pyx_k_INT32, sizeof(__pyx_k_INT32), 0, 0, 1, 1},
+  {0, __pyx_k_INT64, sizeof(__pyx_k_INT64), 0, 0, 1, 1},
+  {0, __pyx_k_INT8, sizeof(__pyx_k_INT8), 0, 0, 1, 1},
+  {0, __pyx_k_Incompatible_checksums_0x_x_vs_0, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0), 0, 0, 1, 0},
+  {0, __pyx_k_IntEnum, sizeof(__pyx_k_IntEnum), 0, 0, 1, 1},
+  {0, __pyx_k_Matrix, sizeof(__pyx_k_Matrix), 0, 0, 1, 1},
+  {0, __pyx_k_MatrixType, sizeof(__pyx_k_MatrixType), 0, 0, 1, 1},
+  {0, __pyx_k_Matrix___reduce_cython, sizeof(__pyx_k_Matrix___reduce_cython), 0, 0, 1, 1},
+  {0, __pyx_k_Matrix___setstate_cython, sizeof(__pyx_k_Matrix___setstate_cython), 0, 0, 1, 1},
   {0, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
+  {0, __pyx_k_OrderedDict, sizeof(__pyx_k_OrderedDict), 0, 0, 1, 1},
+  {0, __pyx_k_PickleError, sizeof(__pyx_k_PickleError), 0, 0, 1, 1},
+  {0, __pyx_k_Pyx_EnumBase, sizeof(__pyx_k_Pyx_EnumBase), 0, 0, 1, 1},
+  {0, __pyx_k_Pyx_EnumBase___new, sizeof(__pyx_k_Pyx_EnumBase___new), 0, 0, 1, 1},
+  {0, __pyx_k_Pyx_EnumBase___repr, sizeof(__pyx_k_Pyx_EnumBase___repr), 0, 0, 1, 1},
+  {0, __pyx_k_Pyx_EnumBase___str, sizeof(__pyx_k_Pyx_EnumBase___str), 0, 0, 1, 1},
+  {0, __pyx_k_Pyx_EnumMeta___reduce_cython, sizeof(__pyx_k_Pyx_EnumMeta___reduce_cython), 0, 0, 1, 1},
+  {0, __pyx_k_Pyx_EnumMeta___setstate_cython, sizeof(__pyx_k_Pyx_EnumMeta___setstate_cython), 0, 0, 1, 1},
   {0, __pyx_k_RF_Preprocess, sizeof(__pyx_k_RF_Preprocess), 0, 1, 0, 1},
   {0, __pyx_k_RF_Scorer, sizeof(__pyx_k_RF_Scorer), 0, 0, 1, 1},
   {0, __pyx_k_RF_Scorer, sizeof(__pyx_k_RF_Scorer), 0, 1, 0, 1},
   {0, __pyx_k_RF_ScorerPy, sizeof(__pyx_k_RF_ScorerPy), 0, 0, 1, 1},
   {0, __pyx_k_RF_ScorerPy, sizeof(__pyx_k_RF_ScorerPy), 0, 1, 0, 1},
   {0, __pyx_k_ScorerFunc, sizeof(__pyx_k_ScorerFunc), 0, 0, 1, 1},
   {0, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
+  {0, __pyx_k_UINT16, sizeof(__pyx_k_UINT16), 0, 0, 1, 1},
+  {0, __pyx_k_UINT32, sizeof(__pyx_k_UINT32), 0, 0, 1, 1},
+  {0, __pyx_k_UINT64, sizeof(__pyx_k_UINT64), 0, 0, 1, 1},
+  {0, __pyx_k_UINT8, sizeof(__pyx_k_UINT8), 0, 0, 1, 1},
+  {0, __pyx_k_UNDEFINED, sizeof(__pyx_k_UNDEFINED), 0, 0, 1, 1},
+  {0, __pyx_k_Unknown_enum_value_s, sizeof(__pyx_k_Unknown_enum_value_s), 0, 0, 1, 0},
   {0, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
   {0, __pyx_k_WRatio, sizeof(__pyx_k_WRatio), 0, 0, 1, 1},
-  {0, __pyx_k__16, sizeof(__pyx_k__16), 0, 1, 0, 0},
-  {0, __pyx_k__17, sizeof(__pyx_k__17), 0, 1, 0, 0},
-  {0, __pyx_k__18, sizeof(__pyx_k__18), 0, 1, 0, 0},
-  {0, __pyx_k__19, sizeof(__pyx_k__19), 0, 0, 1, 1},
+  {0, __pyx_k__19, sizeof(__pyx_k__19), 0, 1, 0, 0},
+  {0, __pyx_k__20, sizeof(__pyx_k__20), 0, 1, 0, 0},
+  {0, __pyx_k__22, sizeof(__pyx_k__22), 0, 1, 0, 0},
   {0, __pyx_k__23, sizeof(__pyx_k__23), 0, 0, 1, 1},
+  {0, __pyx_k__40, sizeof(__pyx_k__40), 0, 0, 1, 1},
   {0, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
   {0, __pyx_k_array, sizeof(__pyx_k_array), 0, 0, 1, 1},
   {0, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
   {0, __pyx_k_c_score_cutoff, sizeof(__pyx_k_c_score_cutoff), 0, 0, 1, 1},
+  {0, __pyx_k_cdist, sizeof(__pyx_k_cdist), 0, 0, 1, 1},
   {0, __pyx_k_choice, sizeof(__pyx_k_choice), 0, 0, 1, 1},
   {0, __pyx_k_choice_key, sizeof(__pyx_k_choice_key), 0, 0, 1, 1},
   {0, __pyx_k_choice_proc, sizeof(__pyx_k_choice_proc), 0, 0, 1, 1},
   {0, __pyx_k_choices, sizeof(__pyx_k_choices), 0, 0, 1, 1},
+  {0, __pyx_k_class, sizeof(__pyx_k_class), 0, 0, 1, 1},
+  {0, __pyx_k_class_getitem, sizeof(__pyx_k_class_getitem), 0, 0, 1, 1},
   {0, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
   {0, __pyx_k_close, sizeof(__pyx_k_close), 0, 0, 1, 1},
+  {0, __pyx_k_cls, sizeof(__pyx_k_cls), 0, 0, 1, 1},
+  {0, __pyx_k_collections, sizeof(__pyx_k_collections), 0, 0, 1, 1},
+  {0, __pyx_k_dct, sizeof(__pyx_k_dct), 0, 0, 1, 1},
   {0, __pyx_k_default_process, sizeof(__pyx_k_default_process), 0, 0, 1, 1},
+  {0, __pyx_k_dict, sizeof(__pyx_k_dict), 0, 0, 1, 1},
+  {0, __pyx_k_dict_2, sizeof(__pyx_k_dict_2), 0, 0, 1, 1},
   {0, __pyx_k_disable, sizeof(__pyx_k_disable), 0, 1, 0, 0},
+  {0, __pyx_k_doc, sizeof(__pyx_k_doc), 0, 0, 1, 1},
+  {0, __pyx_k_dtype, sizeof(__pyx_k_dtype), 0, 0, 1, 1},
   {0, __pyx_k_enable, sizeof(__pyx_k_enable), 0, 1, 0, 0},
+  {0, __pyx_k_enum, sizeof(__pyx_k_enum), 0, 0, 1, 1},
   {0, __pyx_k_enumerate, sizeof(__pyx_k_enumerate), 0, 0, 1, 1},
   {0, __pyx_k_extract, sizeof(__pyx_k_extract), 0, 0, 1, 1},
   {0, __pyx_k_extractOne, sizeof(__pyx_k_extractOne), 0, 0, 1, 1},
-  {0, __pyx_k_extractOne_line_547, sizeof(__pyx_k_extractOne_line_547), 0, 1, 0, 0},
   {0, __pyx_k_extract_iter, sizeof(__pyx_k_extract_iter), 0, 0, 1, 1},
   {0, __pyx_k_extract_iter_dict_f64, sizeof(__pyx_k_extract_iter_dict_f64), 0, 0, 1, 1},
   {0, __pyx_k_extract_iter_dict_i64, sizeof(__pyx_k_extract_iter_dict_i64), 0, 0, 1, 1},
   {0, __pyx_k_extract_iter_list_f64, sizeof(__pyx_k_extract_iter_list_f64), 0, 0, 1, 1},
   {0, __pyx_k_extract_iter_list_i64, sizeof(__pyx_k_extract_iter_list_i64), 0, 0, 1, 1},
   {0, __pyx_k_extract_iter_locals_extract_iter, sizeof(__pyx_k_extract_iter_locals_extract_iter), 0, 0, 1, 1},
   {0, __pyx_k_extract_iter_locals_extract_iter_2, sizeof(__pyx_k_extract_iter_locals_extract_iter_2), 0, 0, 1, 1},
   {0, __pyx_k_extract_iter_locals_extract_iter_3, sizeof(__pyx_k_extract_iter_locals_extract_iter_3), 0, 0, 1, 1},
   {0, __pyx_k_extract_iter_locals_extract_iter_4, sizeof(__pyx_k_extract_iter_locals_extract_iter_4), 0, 0, 1, 1},
   {0, __pyx_k_extract_iter_locals_py_extract_i, sizeof(__pyx_k_extract_iter_locals_py_extract_i), 0, 0, 1, 1},
   {0, __pyx_k_extract_iter_locals_py_extract_i_2, sizeof(__pyx_k_extract_iter_locals_py_extract_i_2), 0, 0, 1, 1},
   {0, __pyx_k_gc, sizeof(__pyx_k_gc), 0, 1, 0, 0},
   {0, __pyx_k_get_scorer_flags, sizeof(__pyx_k_get_scorer_flags), 0, 1, 0, 1},
+  {0, __pyx_k_getstate, sizeof(__pyx_k_getstate), 0, 0, 1, 1},
   {0, __pyx_k_heapq, sizeof(__pyx_k_heapq), 0, 0, 1, 1},
   {0, __pyx_k_i, sizeof(__pyx_k_i), 0, 0, 1, 1},
   {0, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
+  {0, __pyx_k_init, sizeof(__pyx_k_init), 0, 0, 1, 1},
+  {0, __pyx_k_init_subclass, sizeof(__pyx_k_init_subclass), 0, 0, 1, 1},
   {0, __pyx_k_initializing, sizeof(__pyx_k_initializing), 0, 0, 1, 1},
   {0, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
   {0, __pyx_k_isenabled, sizeof(__pyx_k_isenabled), 0, 1, 0, 0},
   {0, __pyx_k_items, sizeof(__pyx_k_items), 0, 0, 1, 1},
   {0, __pyx_k_items, sizeof(__pyx_k_items), 0, 1, 0, 1},
   {0, __pyx_k_key, sizeof(__pyx_k_key), 0, 0, 1, 1},
   {0, __pyx_k_keys, sizeof(__pyx_k_keys), 0, 0, 1, 1},
   {0, __pyx_k_kwargs, sizeof(__pyx_k_kwargs), 0, 0, 1, 1},
   {0, __pyx_k_kwargs_context, sizeof(__pyx_k_kwargs_context), 0, 0, 1, 1},
   {0, __pyx_k_limit, sizeof(__pyx_k_limit), 0, 0, 1, 1},
   {0, __pyx_k_lowest_score_worst, sizeof(__pyx_k_lowest_score_worst), 0, 0, 1, 1},
   {0, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
+  {0, __pyx_k_members, sizeof(__pyx_k_members), 0, 0, 1, 1},
+  {0, __pyx_k_metaclass, sizeof(__pyx_k_metaclass), 0, 0, 1, 1},
+  {0, __pyx_k_module, sizeof(__pyx_k_module), 0, 0, 1, 1},
+  {0, __pyx_k_mro_entries, sizeof(__pyx_k_mro_entries), 0, 0, 1, 1},
   {0, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
+  {0, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 0, 1, 1},
+  {0, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
   {0, __pyx_k_nlargest, sizeof(__pyx_k_nlargest), 0, 0, 1, 1},
   {0, __pyx_k_nsmallest, sizeof(__pyx_k_nsmallest), 0, 0, 1, 1},
   {0, __pyx_k_optimal_score, sizeof(__pyx_k_optimal_score), 0, 0, 1, 1},
   {0, __pyx_k_optimal_score, sizeof(__pyx_k_optimal_score), 0, 1, 0, 1},
+  {0, __pyx_k_parents, sizeof(__pyx_k_parents), 0, 0, 1, 1},
+  {0, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
+  {0, __pyx_k_prepare, sizeof(__pyx_k_prepare), 0, 0, 1, 1},
   {0, __pyx_k_proc_choice, sizeof(__pyx_k_proc_choice), 0, 0, 1, 1},
   {0, __pyx_k_proc_str, sizeof(__pyx_k_proc_str), 0, 0, 1, 1},
   {0, __pyx_k_processor, sizeof(__pyx_k_processor), 0, 0, 1, 1},
   {0, __pyx_k_processor, sizeof(__pyx_k_processor), 0, 1, 0, 1},
   {0, __pyx_k_processor_capsule, sizeof(__pyx_k_processor_capsule), 0, 0, 1, 1},
   {0, __pyx_k_processor_context, sizeof(__pyx_k_processor_context), 0, 0, 1, 1},
   {0, __pyx_k_py_extract_dict_locals_lambda, sizeof(__pyx_k_py_extract_dict_locals_lambda), 0, 0, 1, 1},
   {0, __pyx_k_py_extract_iter_dict, sizeof(__pyx_k_py_extract_iter_dict), 0, 0, 1, 1},
   {0, __pyx_k_py_extract_iter_list, sizeof(__pyx_k_py_extract_iter_list), 0, 0, 1, 1},
   {0, __pyx_k_py_extract_list_locals_lambda, sizeof(__pyx_k_py_extract_list_locals_lambda), 0, 0, 1, 1},
+  {0, __pyx_k_pyx_PickleError, sizeof(__pyx_k_pyx_PickleError), 0, 0, 1, 1},
+  {0, __pyx_k_pyx_checksum, sizeof(__pyx_k_pyx_checksum), 0, 0, 1, 1},
+  {0, __pyx_k_pyx_result, sizeof(__pyx_k_pyx_result), 0, 0, 1, 1},
+  {0, __pyx_k_pyx_state, sizeof(__pyx_k_pyx_state), 0, 0, 1, 1},
+  {0, __pyx_k_pyx_type, sizeof(__pyx_k_pyx_type), 0, 0, 1, 1},
+  {0, __pyx_k_pyx_unpickle___Pyx_EnumMeta, sizeof(__pyx_k_pyx_unpickle___Pyx_EnumMeta), 0, 0, 1, 1},
+  {0, __pyx_k_qualname, sizeof(__pyx_k_qualname), 0, 0, 1, 1},
+  {0, __pyx_k_queries, sizeof(__pyx_k_queries), 0, 0, 1, 1},
   {0, __pyx_k_query, sizeof(__pyx_k_query), 0, 0, 1, 1},
   {0, __pyx_k_query_proc, sizeof(__pyx_k_query_proc), 0, 0, 1, 1},
   {0, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
   {0, __pyx_k_rapidfuzz_fuzz, sizeof(__pyx_k_rapidfuzz_fuzz), 0, 0, 1, 1},
-  {0, __pyx_k_rapidfuzz_process_cpp, sizeof(__pyx_k_rapidfuzz_process_cpp), 0, 0, 1, 1},
+  {0, __pyx_k_rapidfuzz_process_cpp_impl, sizeof(__pyx_k_rapidfuzz_process_cpp_impl), 0, 0, 1, 1},
   {0, __pyx_k_rapidfuzz_utils, sizeof(__pyx_k_rapidfuzz_utils), 0, 0, 1, 1},
+  {0, __pyx_k_ratio, sizeof(__pyx_k_ratio), 0, 0, 1, 1},
+  {0, __pyx_k_reduce, sizeof(__pyx_k_reduce), 0, 0, 1, 1},
+  {0, __pyx_k_reduce_cython, sizeof(__pyx_k_reduce_cython), 0, 0, 1, 1},
+  {0, __pyx_k_reduce_ex, sizeof(__pyx_k_reduce_ex), 0, 0, 1, 1},
+  {0, __pyx_k_repr, sizeof(__pyx_k_repr), 0, 0, 1, 1},
+  {0, __pyx_k_res, sizeof(__pyx_k_res), 0, 0, 1, 1},
+  {0, __pyx_k_s_s, sizeof(__pyx_k_s_s), 0, 0, 1, 0},
+  {0, __pyx_k_s_s_d, sizeof(__pyx_k_s_s_d), 0, 0, 1, 0},
   {0, __pyx_k_score, sizeof(__pyx_k_score), 0, 0, 1, 1},
   {0, __pyx_k_score_cutoff, sizeof(__pyx_k_score_cutoff), 0, 0, 1, 1},
   {0, __pyx_k_score_cutoff, sizeof(__pyx_k_score_cutoff), 0, 1, 0, 1},
   {0, __pyx_k_score_cutoff_has_to_be_in_the_ra, sizeof(__pyx_k_score_cutoff_has_to_be_in_the_ra), 0, 1, 0, 0},
   {0, __pyx_k_scorer, sizeof(__pyx_k_scorer), 0, 0, 1, 1},
   {0, __pyx_k_scorer_capsule, sizeof(__pyx_k_scorer_capsule), 0, 0, 1, 1},
   {0, __pyx_k_scorer_context, sizeof(__pyx_k_scorer_context), 0, 0, 1, 1},
   {0, __pyx_k_scorer_does_not_properly_use_the, sizeof(__pyx_k_scorer_does_not_properly_use_the), 0, 1, 0, 0},
   {0, __pyx_k_scorer_flags, sizeof(__pyx_k_scorer_flags), 0, 0, 1, 1},
   {0, __pyx_k_scorer_func, sizeof(__pyx_k_scorer_func), 0, 0, 1, 1},
+  {0, __pyx_k_self, sizeof(__pyx_k_self), 0, 0, 1, 1},
+  {0, __pyx_k_self_matrix_cannot_be_converted, sizeof(__pyx_k_self_matrix_cannot_be_converted), 0, 0, 1, 0},
   {0, __pyx_k_send, sizeof(__pyx_k_send), 0, 0, 1, 1},
+  {0, __pyx_k_set_name, sizeof(__pyx_k_set_name), 0, 0, 1, 1},
+  {0, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
+  {0, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
   {0, __pyx_k_spec, sizeof(__pyx_k_spec), 0, 0, 1, 1},
-  {0, __pyx_k_src_rapidfuzz_process_cpp_pyx, sizeof(__pyx_k_src_rapidfuzz_process_cpp_pyx), 0, 0, 1, 0},
+  {0, __pyx_k_src_rapidfuzz_process_cpp_impl_p, sizeof(__pyx_k_src_rapidfuzz_process_cpp_impl_p), 0, 0, 1, 0},
+  {0, __pyx_k_state, sizeof(__pyx_k_state), 0, 0, 1, 1},
+  {0, __pyx_k_str, sizeof(__pyx_k_str), 0, 0, 1, 1},
+  {0, __pyx_k_stringsource, sizeof(__pyx_k_stringsource), 0, 0, 1, 0},
+  {0, __pyx_k_super, sizeof(__pyx_k_super), 0, 0, 1, 1},
   {0, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
   {0, __pyx_k_throw, sizeof(__pyx_k_throw), 0, 0, 1, 1},
   {0, __pyx_k_typecode, sizeof(__pyx_k_typecode), 0, 0, 1, 1},
+  {0, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
+  {0, __pyx_k_use_setstate, sizeof(__pyx_k_use_setstate), 0, 0, 1, 1},
+  {0, __pyx_k_v, sizeof(__pyx_k_v), 0, 0, 1, 1},
+  {0, __pyx_k_value, sizeof(__pyx_k_value), 0, 0, 1, 1},
+  {0, __pyx_k_values, sizeof(__pyx_k_values), 0, 0, 1, 1},
+  {0, __pyx_k_workers, sizeof(__pyx_k_workers), 0, 0, 1, 1},
   {0, __pyx_k_worst_score, sizeof(__pyx_k_worst_score), 0, 0, 1, 1},
   {0, __pyx_k_worst_score, sizeof(__pyx_k_worst_score), 0, 1, 0, 1},
   #else
-  {&__pyx_kp_u_Find_the_best_match_in_a_list_o, __pyx_k_Find_the_best_match_in_a_list_o, sizeof(__pyx_k_Find_the_best_match_in_a_list_o), 0, 1, 0, 0},
+  {&__pyx_n_s_EnumBase, __pyx_k_EnumBase, sizeof(__pyx_k_EnumBase), 0, 0, 1, 1},
+  {&__pyx_n_s_FLOAT32, __pyx_k_FLOAT32, sizeof(__pyx_k_FLOAT32), 0, 0, 1, 1},
+  {&__pyx_n_s_FLOAT64, __pyx_k_FLOAT64, sizeof(__pyx_k_FLOAT64), 0, 0, 1, 1},
   {&__pyx_kp_u_Got_unexpected_keyword_arguments, __pyx_k_Got_unexpected_keyword_arguments, sizeof(__pyx_k_Got_unexpected_keyword_arguments), 0, 1, 0, 0},
+  {&__pyx_n_s_INT16, __pyx_k_INT16, sizeof(__pyx_k_INT16), 0, 0, 1, 1},
+  {&__pyx_n_s_INT32, __pyx_k_INT32, sizeof(__pyx_k_INT32), 0, 0, 1, 1},
+  {&__pyx_n_s_INT64, __pyx_k_INT64, sizeof(__pyx_k_INT64), 0, 0, 1, 1},
+  {&__pyx_n_s_INT8, __pyx_k_INT8, sizeof(__pyx_k_INT8), 0, 0, 1, 1},
+  {&__pyx_kp_s_Incompatible_checksums_0x_x_vs_0, __pyx_k_Incompatible_checksums_0x_x_vs_0, sizeof(__pyx_k_Incompatible_checksums_0x_x_vs_0), 0, 0, 1, 0},
+  {&__pyx_n_s_IntEnum, __pyx_k_IntEnum, sizeof(__pyx_k_IntEnum), 0, 0, 1, 1},
+  {&__pyx_n_s_Matrix, __pyx_k_Matrix, sizeof(__pyx_k_Matrix), 0, 0, 1, 1},
+  {&__pyx_n_s_MatrixType, __pyx_k_MatrixType, sizeof(__pyx_k_MatrixType), 0, 0, 1, 1},
+  {&__pyx_n_s_Matrix___reduce_cython, __pyx_k_Matrix___reduce_cython, sizeof(__pyx_k_Matrix___reduce_cython), 0, 0, 1, 1},
+  {&__pyx_n_s_Matrix___setstate_cython, __pyx_k_Matrix___setstate_cython, sizeof(__pyx_k_Matrix___setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_s_MemoryError, __pyx_k_MemoryError, sizeof(__pyx_k_MemoryError), 0, 0, 1, 1},
+  {&__pyx_n_s_OrderedDict, __pyx_k_OrderedDict, sizeof(__pyx_k_OrderedDict), 0, 0, 1, 1},
+  {&__pyx_n_s_PickleError, __pyx_k_PickleError, sizeof(__pyx_k_PickleError), 0, 0, 1, 1},
+  {&__pyx_n_s_Pyx_EnumBase, __pyx_k_Pyx_EnumBase, sizeof(__pyx_k_Pyx_EnumBase), 0, 0, 1, 1},
+  {&__pyx_n_s_Pyx_EnumBase___new, __pyx_k_Pyx_EnumBase___new, sizeof(__pyx_k_Pyx_EnumBase___new), 0, 0, 1, 1},
+  {&__pyx_n_s_Pyx_EnumBase___repr, __pyx_k_Pyx_EnumBase___repr, sizeof(__pyx_k_Pyx_EnumBase___repr), 0, 0, 1, 1},
+  {&__pyx_n_s_Pyx_EnumBase___str, __pyx_k_Pyx_EnumBase___str, sizeof(__pyx_k_Pyx_EnumBase___str), 0, 0, 1, 1},
+  {&__pyx_n_s_Pyx_EnumMeta___reduce_cython, __pyx_k_Pyx_EnumMeta___reduce_cython, sizeof(__pyx_k_Pyx_EnumMeta___reduce_cython), 0, 0, 1, 1},
+  {&__pyx_n_s_Pyx_EnumMeta___setstate_cython, __pyx_k_Pyx_EnumMeta___setstate_cython, sizeof(__pyx_k_Pyx_EnumMeta___setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_u_RF_Preprocess, __pyx_k_RF_Preprocess, sizeof(__pyx_k_RF_Preprocess), 0, 1, 0, 1},
   {&__pyx_n_s_RF_Scorer, __pyx_k_RF_Scorer, sizeof(__pyx_k_RF_Scorer), 0, 0, 1, 1},
   {&__pyx_n_u_RF_Scorer, __pyx_k_RF_Scorer, sizeof(__pyx_k_RF_Scorer), 0, 1, 0, 1},
   {&__pyx_n_s_RF_ScorerPy, __pyx_k_RF_ScorerPy, sizeof(__pyx_k_RF_ScorerPy), 0, 0, 1, 1},
   {&__pyx_n_u_RF_ScorerPy, __pyx_k_RF_ScorerPy, sizeof(__pyx_k_RF_ScorerPy), 0, 1, 0, 1},
   {&__pyx_n_s_ScorerFunc, __pyx_k_ScorerFunc, sizeof(__pyx_k_ScorerFunc), 0, 0, 1, 1},
   {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
+  {&__pyx_n_s_UINT16, __pyx_k_UINT16, sizeof(__pyx_k_UINT16), 0, 0, 1, 1},
+  {&__pyx_n_s_UINT32, __pyx_k_UINT32, sizeof(__pyx_k_UINT32), 0, 0, 1, 1},
+  {&__pyx_n_s_UINT64, __pyx_k_UINT64, sizeof(__pyx_k_UINT64), 0, 0, 1, 1},
+  {&__pyx_n_s_UINT8, __pyx_k_UINT8, sizeof(__pyx_k_UINT8), 0, 0, 1, 1},
+  {&__pyx_n_s_UNDEFINED, __pyx_k_UNDEFINED, sizeof(__pyx_k_UNDEFINED), 0, 0, 1, 1},
+  {&__pyx_kp_s_Unknown_enum_value_s, __pyx_k_Unknown_enum_value_s, sizeof(__pyx_k_Unknown_enum_value_s), 0, 0, 1, 0},
   {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
   {&__pyx_n_s_WRatio, __pyx_k_WRatio, sizeof(__pyx_k_WRatio), 0, 0, 1, 1},
-  {&__pyx_kp_u__16, __pyx_k__16, sizeof(__pyx_k__16), 0, 1, 0, 0},
-  {&__pyx_kp_u__17, __pyx_k__17, sizeof(__pyx_k__17), 0, 1, 0, 0},
-  {&__pyx_kp_u__18, __pyx_k__18, sizeof(__pyx_k__18), 0, 1, 0, 0},
-  {&__pyx_n_s__19, __pyx_k__19, sizeof(__pyx_k__19), 0, 0, 1, 1},
+  {&__pyx_kp_u__19, __pyx_k__19, sizeof(__pyx_k__19), 0, 1, 0, 0},
+  {&__pyx_kp_u__20, __pyx_k__20, sizeof(__pyx_k__20), 0, 1, 0, 0},
+  {&__pyx_kp_u__22, __pyx_k__22, sizeof(__pyx_k__22), 0, 1, 0, 0},
   {&__pyx_n_s__23, __pyx_k__23, sizeof(__pyx_k__23), 0, 0, 1, 1},
+  {&__pyx_n_s__40, __pyx_k__40, sizeof(__pyx_k__40), 0, 0, 1, 1},
   {&__pyx_n_s_args, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
   {&__pyx_n_s_array, __pyx_k_array, sizeof(__pyx_k_array), 0, 0, 1, 1},
   {&__pyx_n_s_asyncio_coroutines, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
   {&__pyx_n_s_c_score_cutoff, __pyx_k_c_score_cutoff, sizeof(__pyx_k_c_score_cutoff), 0, 0, 1, 1},
+  {&__pyx_n_s_cdist, __pyx_k_cdist, sizeof(__pyx_k_cdist), 0, 0, 1, 1},
   {&__pyx_n_s_choice, __pyx_k_choice, sizeof(__pyx_k_choice), 0, 0, 1, 1},
   {&__pyx_n_s_choice_key, __pyx_k_choice_key, sizeof(__pyx_k_choice_key), 0, 0, 1, 1},
   {&__pyx_n_s_choice_proc, __pyx_k_choice_proc, sizeof(__pyx_k_choice_proc), 0, 0, 1, 1},
   {&__pyx_n_s_choices, __pyx_k_choices, sizeof(__pyx_k_choices), 0, 0, 1, 1},
+  {&__pyx_n_s_class, __pyx_k_class, sizeof(__pyx_k_class), 0, 0, 1, 1},
+  {&__pyx_n_s_class_getitem, __pyx_k_class_getitem, sizeof(__pyx_k_class_getitem), 0, 0, 1, 1},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
   {&__pyx_n_s_close, __pyx_k_close, sizeof(__pyx_k_close), 0, 0, 1, 1},
+  {&__pyx_n_s_cls, __pyx_k_cls, sizeof(__pyx_k_cls), 0, 0, 1, 1},
+  {&__pyx_n_s_collections, __pyx_k_collections, sizeof(__pyx_k_collections), 0, 0, 1, 1},
+  {&__pyx_n_s_dct, __pyx_k_dct, sizeof(__pyx_k_dct), 0, 0, 1, 1},
   {&__pyx_n_s_default_process, __pyx_k_default_process, sizeof(__pyx_k_default_process), 0, 0, 1, 1},
+  {&__pyx_n_s_dict, __pyx_k_dict, sizeof(__pyx_k_dict), 0, 0, 1, 1},
+  {&__pyx_n_s_dict_2, __pyx_k_dict_2, sizeof(__pyx_k_dict_2), 0, 0, 1, 1},
   {&__pyx_kp_u_disable, __pyx_k_disable, sizeof(__pyx_k_disable), 0, 1, 0, 0},
+  {&__pyx_n_s_doc, __pyx_k_doc, sizeof(__pyx_k_doc), 0, 0, 1, 1},
+  {&__pyx_n_s_dtype, __pyx_k_dtype, sizeof(__pyx_k_dtype), 0, 0, 1, 1},
   {&__pyx_kp_u_enable, __pyx_k_enable, sizeof(__pyx_k_enable), 0, 1, 0, 0},
+  {&__pyx_n_s_enum, __pyx_k_enum, sizeof(__pyx_k_enum), 0, 0, 1, 1},
   {&__pyx_n_s_enumerate, __pyx_k_enumerate, sizeof(__pyx_k_enumerate), 0, 0, 1, 1},
   {&__pyx_n_s_extract, __pyx_k_extract, sizeof(__pyx_k_extract), 0, 0, 1, 1},
   {&__pyx_n_s_extractOne, __pyx_k_extractOne, sizeof(__pyx_k_extractOne), 0, 0, 1, 1},
-  {&__pyx_kp_u_extractOne_line_547, __pyx_k_extractOne_line_547, sizeof(__pyx_k_extractOne_line_547), 0, 1, 0, 0},
   {&__pyx_n_s_extract_iter, __pyx_k_extract_iter, sizeof(__pyx_k_extract_iter), 0, 0, 1, 1},
   {&__pyx_n_s_extract_iter_dict_f64, __pyx_k_extract_iter_dict_f64, sizeof(__pyx_k_extract_iter_dict_f64), 0, 0, 1, 1},
   {&__pyx_n_s_extract_iter_dict_i64, __pyx_k_extract_iter_dict_i64, sizeof(__pyx_k_extract_iter_dict_i64), 0, 0, 1, 1},
   {&__pyx_n_s_extract_iter_list_f64, __pyx_k_extract_iter_list_f64, sizeof(__pyx_k_extract_iter_list_f64), 0, 0, 1, 1},
   {&__pyx_n_s_extract_iter_list_i64, __pyx_k_extract_iter_list_i64, sizeof(__pyx_k_extract_iter_list_i64), 0, 0, 1, 1},
   {&__pyx_n_s_extract_iter_locals_extract_iter, __pyx_k_extract_iter_locals_extract_iter, sizeof(__pyx_k_extract_iter_locals_extract_iter), 0, 0, 1, 1},
   {&__pyx_n_s_extract_iter_locals_extract_iter_2, __pyx_k_extract_iter_locals_extract_iter_2, sizeof(__pyx_k_extract_iter_locals_extract_iter_2), 0, 0, 1, 1},
   {&__pyx_n_s_extract_iter_locals_extract_iter_3, __pyx_k_extract_iter_locals_extract_iter_3, sizeof(__pyx_k_extract_iter_locals_extract_iter_3), 0, 0, 1, 1},
   {&__pyx_n_s_extract_iter_locals_extract_iter_4, __pyx_k_extract_iter_locals_extract_iter_4, sizeof(__pyx_k_extract_iter_locals_extract_iter_4), 0, 0, 1, 1},
   {&__pyx_n_s_extract_iter_locals_py_extract_i, __pyx_k_extract_iter_locals_py_extract_i, sizeof(__pyx_k_extract_iter_locals_py_extract_i), 0, 0, 1, 1},
   {&__pyx_n_s_extract_iter_locals_py_extract_i_2, __pyx_k_extract_iter_locals_py_extract_i_2, sizeof(__pyx_k_extract_iter_locals_py_extract_i_2), 0, 0, 1, 1},
   {&__pyx_kp_u_gc, __pyx_k_gc, sizeof(__pyx_k_gc), 0, 1, 0, 0},
   {&__pyx_n_u_get_scorer_flags, __pyx_k_get_scorer_flags, sizeof(__pyx_k_get_scorer_flags), 0, 1, 0, 1},
+  {&__pyx_n_s_getstate, __pyx_k_getstate, sizeof(__pyx_k_getstate), 0, 0, 1, 1},
   {&__pyx_n_s_heapq, __pyx_k_heapq, sizeof(__pyx_k_heapq), 0, 0, 1, 1},
   {&__pyx_n_s_i, __pyx_k_i, sizeof(__pyx_k_i), 0, 0, 1, 1},
   {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
+  {&__pyx_n_s_init, __pyx_k_init, sizeof(__pyx_k_init), 0, 0, 1, 1},
+  {&__pyx_n_s_init_subclass, __pyx_k_init_subclass, sizeof(__pyx_k_init_subclass), 0, 0, 1, 1},
   {&__pyx_n_s_initializing, __pyx_k_initializing, sizeof(__pyx_k_initializing), 0, 0, 1, 1},
   {&__pyx_n_s_is_coroutine, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
   {&__pyx_kp_u_isenabled, __pyx_k_isenabled, sizeof(__pyx_k_isenabled), 0, 1, 0, 0},
   {&__pyx_n_s_items, __pyx_k_items, sizeof(__pyx_k_items), 0, 0, 1, 1},
   {&__pyx_n_u_items, __pyx_k_items, sizeof(__pyx_k_items), 0, 1, 0, 1},
   {&__pyx_n_s_key, __pyx_k_key, sizeof(__pyx_k_key), 0, 0, 1, 1},
   {&__pyx_n_s_keys, __pyx_k_keys, sizeof(__pyx_k_keys), 0, 0, 1, 1},
   {&__pyx_n_s_kwargs, __pyx_k_kwargs, sizeof(__pyx_k_kwargs), 0, 0, 1, 1},
   {&__pyx_n_s_kwargs_context, __pyx_k_kwargs_context, sizeof(__pyx_k_kwargs_context), 0, 0, 1, 1},
   {&__pyx_n_s_limit, __pyx_k_limit, sizeof(__pyx_k_limit), 0, 0, 1, 1},
   {&__pyx_n_s_lowest_score_worst, __pyx_k_lowest_score_worst, sizeof(__pyx_k_lowest_score_worst), 0, 0, 1, 1},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
+  {&__pyx_n_s_members, __pyx_k_members, sizeof(__pyx_k_members), 0, 0, 1, 1},
+  {&__pyx_n_s_metaclass, __pyx_k_metaclass, sizeof(__pyx_k_metaclass), 0, 0, 1, 1},
+  {&__pyx_n_s_module, __pyx_k_module, sizeof(__pyx_k_module), 0, 0, 1, 1},
+  {&__pyx_n_s_mro_entries, __pyx_k_mro_entries, sizeof(__pyx_k_mro_entries), 0, 0, 1, 1},
   {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
+  {&__pyx_n_s_name_2, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 0, 1, 1},
+  {&__pyx_n_s_new, __pyx_k_new, sizeof(__pyx_k_new), 0, 0, 1, 1},
   {&__pyx_n_s_nlargest, __pyx_k_nlargest, sizeof(__pyx_k_nlargest), 0, 0, 1, 1},
   {&__pyx_n_s_nsmallest, __pyx_k_nsmallest, sizeof(__pyx_k_nsmallest), 0, 0, 1, 1},
   {&__pyx_n_s_optimal_score, __pyx_k_optimal_score, sizeof(__pyx_k_optimal_score), 0, 0, 1, 1},
   {&__pyx_n_u_optimal_score, __pyx_k_optimal_score, sizeof(__pyx_k_optimal_score), 0, 1, 0, 1},
+  {&__pyx_n_s_parents, __pyx_k_parents, sizeof(__pyx_k_parents), 0, 0, 1, 1},
+  {&__pyx_n_s_pickle, __pyx_k_pickle, sizeof(__pyx_k_pickle), 0, 0, 1, 1},
+  {&__pyx_n_s_prepare, __pyx_k_prepare, sizeof(__pyx_k_prepare), 0, 0, 1, 1},
   {&__pyx_n_s_proc_choice, __pyx_k_proc_choice, sizeof(__pyx_k_proc_choice), 0, 0, 1, 1},
   {&__pyx_n_s_proc_str, __pyx_k_proc_str, sizeof(__pyx_k_proc_str), 0, 0, 1, 1},
   {&__pyx_n_s_processor, __pyx_k_processor, sizeof(__pyx_k_processor), 0, 0, 1, 1},
   {&__pyx_n_u_processor, __pyx_k_processor, sizeof(__pyx_k_processor), 0, 1, 0, 1},
   {&__pyx_n_s_processor_capsule, __pyx_k_processor_capsule, sizeof(__pyx_k_processor_capsule), 0, 0, 1, 1},
   {&__pyx_n_s_processor_context, __pyx_k_processor_context, sizeof(__pyx_k_processor_context), 0, 0, 1, 1},
   {&__pyx_n_s_py_extract_dict_locals_lambda, __pyx_k_py_extract_dict_locals_lambda, sizeof(__pyx_k_py_extract_dict_locals_lambda), 0, 0, 1, 1},
   {&__pyx_n_s_py_extract_iter_dict, __pyx_k_py_extract_iter_dict, sizeof(__pyx_k_py_extract_iter_dict), 0, 0, 1, 1},
   {&__pyx_n_s_py_extract_iter_list, __pyx_k_py_extract_iter_list, sizeof(__pyx_k_py_extract_iter_list), 0, 0, 1, 1},
   {&__pyx_n_s_py_extract_list_locals_lambda, __pyx_k_py_extract_list_locals_lambda, sizeof(__pyx_k_py_extract_list_locals_lambda), 0, 0, 1, 1},
+  {&__pyx_n_s_pyx_PickleError, __pyx_k_pyx_PickleError, sizeof(__pyx_k_pyx_PickleError), 0, 0, 1, 1},
+  {&__pyx_n_s_pyx_checksum, __pyx_k_pyx_checksum, sizeof(__pyx_k_pyx_checksum), 0, 0, 1, 1},
+  {&__pyx_n_s_pyx_result, __pyx_k_pyx_result, sizeof(__pyx_k_pyx_result), 0, 0, 1, 1},
+  {&__pyx_n_s_pyx_state, __pyx_k_pyx_state, sizeof(__pyx_k_pyx_state), 0, 0, 1, 1},
+  {&__pyx_n_s_pyx_type, __pyx_k_pyx_type, sizeof(__pyx_k_pyx_type), 0, 0, 1, 1},
+  {&__pyx_n_s_pyx_unpickle___Pyx_EnumMeta, __pyx_k_pyx_unpickle___Pyx_EnumMeta, sizeof(__pyx_k_pyx_unpickle___Pyx_EnumMeta), 0, 0, 1, 1},
+  {&__pyx_n_s_qualname, __pyx_k_qualname, sizeof(__pyx_k_qualname), 0, 0, 1, 1},
+  {&__pyx_n_s_queries, __pyx_k_queries, sizeof(__pyx_k_queries), 0, 0, 1, 1},
   {&__pyx_n_s_query, __pyx_k_query, sizeof(__pyx_k_query), 0, 0, 1, 1},
   {&__pyx_n_s_query_proc, __pyx_k_query_proc, sizeof(__pyx_k_query_proc), 0, 0, 1, 1},
   {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
   {&__pyx_n_s_rapidfuzz_fuzz, __pyx_k_rapidfuzz_fuzz, sizeof(__pyx_k_rapidfuzz_fuzz), 0, 0, 1, 1},
-  {&__pyx_n_s_rapidfuzz_process_cpp, __pyx_k_rapidfuzz_process_cpp, sizeof(__pyx_k_rapidfuzz_process_cpp), 0, 0, 1, 1},
+  {&__pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_k_rapidfuzz_process_cpp_impl, sizeof(__pyx_k_rapidfuzz_process_cpp_impl), 0, 0, 1, 1},
   {&__pyx_n_s_rapidfuzz_utils, __pyx_k_rapidfuzz_utils, sizeof(__pyx_k_rapidfuzz_utils), 0, 0, 1, 1},
+  {&__pyx_n_s_ratio, __pyx_k_ratio, sizeof(__pyx_k_ratio), 0, 0, 1, 1},
+  {&__pyx_n_s_reduce, __pyx_k_reduce, sizeof(__pyx_k_reduce), 0, 0, 1, 1},
+  {&__pyx_n_s_reduce_cython, __pyx_k_reduce_cython, sizeof(__pyx_k_reduce_cython), 0, 0, 1, 1},
+  {&__pyx_n_s_reduce_ex, __pyx_k_reduce_ex, sizeof(__pyx_k_reduce_ex), 0, 0, 1, 1},
+  {&__pyx_n_s_repr, __pyx_k_repr, sizeof(__pyx_k_repr), 0, 0, 1, 1},
+  {&__pyx_n_s_res, __pyx_k_res, sizeof(__pyx_k_res), 0, 0, 1, 1},
+  {&__pyx_kp_s_s_s, __pyx_k_s_s, sizeof(__pyx_k_s_s), 0, 0, 1, 0},
+  {&__pyx_kp_s_s_s_d, __pyx_k_s_s_d, sizeof(__pyx_k_s_s_d), 0, 0, 1, 0},
   {&__pyx_n_s_score, __pyx_k_score, sizeof(__pyx_k_score), 0, 0, 1, 1},
   {&__pyx_n_s_score_cutoff, __pyx_k_score_cutoff, sizeof(__pyx_k_score_cutoff), 0, 0, 1, 1},
   {&__pyx_n_u_score_cutoff, __pyx_k_score_cutoff, sizeof(__pyx_k_score_cutoff), 0, 1, 0, 1},
   {&__pyx_kp_u_score_cutoff_has_to_be_in_the_ra, __pyx_k_score_cutoff_has_to_be_in_the_ra, sizeof(__pyx_k_score_cutoff_has_to_be_in_the_ra), 0, 1, 0, 0},
   {&__pyx_n_s_scorer, __pyx_k_scorer, sizeof(__pyx_k_scorer), 0, 0, 1, 1},
   {&__pyx_n_s_scorer_capsule, __pyx_k_scorer_capsule, sizeof(__pyx_k_scorer_capsule), 0, 0, 1, 1},
   {&__pyx_n_s_scorer_context, __pyx_k_scorer_context, sizeof(__pyx_k_scorer_context), 0, 0, 1, 1},
   {&__pyx_kp_u_scorer_does_not_properly_use_the, __pyx_k_scorer_does_not_properly_use_the, sizeof(__pyx_k_scorer_does_not_properly_use_the), 0, 1, 0, 0},
   {&__pyx_n_s_scorer_flags, __pyx_k_scorer_flags, sizeof(__pyx_k_scorer_flags), 0, 0, 1, 1},
   {&__pyx_n_s_scorer_func, __pyx_k_scorer_func, sizeof(__pyx_k_scorer_func), 0, 0, 1, 1},
+  {&__pyx_n_s_self, __pyx_k_self, sizeof(__pyx_k_self), 0, 0, 1, 1},
+  {&__pyx_kp_s_self_matrix_cannot_be_converted, __pyx_k_self_matrix_cannot_be_converted, sizeof(__pyx_k_self_matrix_cannot_be_converted), 0, 0, 1, 0},
   {&__pyx_n_s_send, __pyx_k_send, sizeof(__pyx_k_send), 0, 0, 1, 1},
+  {&__pyx_n_s_set_name, __pyx_k_set_name, sizeof(__pyx_k_set_name), 0, 0, 1, 1},
+  {&__pyx_n_s_setstate, __pyx_k_setstate, sizeof(__pyx_k_setstate), 0, 0, 1, 1},
+  {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_s_spec, __pyx_k_spec, sizeof(__pyx_k_spec), 0, 0, 1, 1},
-  {&__pyx_kp_s_src_rapidfuzz_process_cpp_pyx, __pyx_k_src_rapidfuzz_process_cpp_pyx, sizeof(__pyx_k_src_rapidfuzz_process_cpp_pyx), 0, 0, 1, 0},
+  {&__pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_k_src_rapidfuzz_process_cpp_impl_p, sizeof(__pyx_k_src_rapidfuzz_process_cpp_impl_p), 0, 0, 1, 0},
+  {&__pyx_n_s_state, __pyx_k_state, sizeof(__pyx_k_state), 0, 0, 1, 1},
+  {&__pyx_n_s_str, __pyx_k_str, sizeof(__pyx_k_str), 0, 0, 1, 1},
+  {&__pyx_kp_s_stringsource, __pyx_k_stringsource, sizeof(__pyx_k_stringsource), 0, 0, 1, 0},
+  {&__pyx_n_s_super, __pyx_k_super, sizeof(__pyx_k_super), 0, 0, 1, 1},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
   {&__pyx_n_s_throw, __pyx_k_throw, sizeof(__pyx_k_throw), 0, 0, 1, 1},
   {&__pyx_n_s_typecode, __pyx_k_typecode, sizeof(__pyx_k_typecode), 0, 0, 1, 1},
+  {&__pyx_n_s_update, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
+  {&__pyx_n_s_use_setstate, __pyx_k_use_setstate, sizeof(__pyx_k_use_setstate), 0, 0, 1, 1},
+  {&__pyx_n_s_v, __pyx_k_v, sizeof(__pyx_k_v), 0, 0, 1, 1},
+  {&__pyx_n_s_value, __pyx_k_value, sizeof(__pyx_k_value), 0, 0, 1, 1},
+  {&__pyx_n_s_values, __pyx_k_values, sizeof(__pyx_k_values), 0, 0, 1, 1},
+  {&__pyx_n_s_workers, __pyx_k_workers, sizeof(__pyx_k_workers), 0, 0, 1, 1},
   {&__pyx_n_s_worst_score, __pyx_k_worst_score, sizeof(__pyx_k_worst_score), 0, 0, 1, 1},
   {&__pyx_n_u_worst_score, __pyx_k_worst_score, sizeof(__pyx_k_worst_score), 0, 1, 0, 1},
   #endif
   {0, 0, 0, 0, 0, 0, 0}
 };
 /* #### Code section: cached_builtins ### */
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(0, 97, __pyx_L1_error)
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 324, __pyx_L1_error)
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 732, __pyx_L1_error)
-  __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(1, 251, __pyx_L1_error)
-  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 338, __pyx_L1_error)
+  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(0, 132, __pyx_L1_error)
+  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 359, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 651, __pyx_L1_error)
+  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_builtin_MemoryError = __Pyx_GetBuiltinName(__pyx_n_s_MemoryError); if (!__pyx_builtin_MemoryError) __PYX_ERR(3, 251, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 /* #### Code section: cached_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "rapidfuzz/process_cpp.pyx":324
+  /* "rapidfuzz/process_cpp_impl.pyx":359
  *         )
  * 
  *     raise ValueError("scorer does not properly use the C-API")             # <<<<<<<<<<<<<<
  * 
  * cdef inline extractOne_list_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):
  */
-  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_scorer_does_not_properly_use_the); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 324, __pyx_L1_error)
+  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_scorer_does_not_properly_use_the); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 359, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple_);
   __Pyx_GIVEREF(__pyx_tuple_);
 
-  /* "rapidfuzz/process_cpp.pyx":466
+  /* "rapidfuzz/process_cpp_impl.pyx":501
  *         flags = params["get_scorer_flags"](**kwargs)
  *         return (flags["worst_score"], flags["optimal_score"])
  *     return (0, 100)             # <<<<<<<<<<<<<<
  * 
  * cdef inline py_extractOne_dict(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):
  */
-  __pyx_tuple__2 = PyTuple_Pack(2, __pyx_int_0, __pyx_int_100); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 466, __pyx_L1_error)
+  __pyx_tuple__2 = PyTuple_Pack(2, __pyx_int_0, __pyx_int_100); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 501, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__2);
   __Pyx_GIVEREF(__pyx_tuple__2);
 
-  /* "rapidfuzz/process_cpp.pyx":1077
+  /* "rapidfuzz/process_cpp_impl.pyx":884
  *     cdef RF_KwargsWrapper kwargs_context
  * 
  *     def extract_iter_dict_f64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type
  */
-  __pyx_tuple__6 = PyTuple_Pack(11, __pyx_n_s_proc_str, __pyx_n_s_c_score_cutoff, __pyx_n_s_query_proc, __pyx_n_s_scorer_func, __pyx_n_s_ScorerFunc, __pyx_n_s_lowest_score_worst, __pyx_n_s_score, __pyx_n_s_choice_key, __pyx_n_s_choice, __pyx_n_s_choice_proc, __pyx_n_s_proc_choice); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 1077, __pyx_L1_error)
+  __pyx_tuple__6 = PyTuple_Pack(11, __pyx_n_s_proc_str, __pyx_n_s_c_score_cutoff, __pyx_n_s_query_proc, __pyx_n_s_scorer_func, __pyx_n_s_ScorerFunc, __pyx_n_s_lowest_score_worst, __pyx_n_s_score, __pyx_n_s_choice_key, __pyx_n_s_choice, __pyx_n_s_choice_proc, __pyx_n_s_proc_choice); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 884, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__6);
   __Pyx_GIVEREF(__pyx_tuple__6);
-  __pyx_codeobj__7 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__6, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_pyx, __pyx_n_s_extract_iter_dict_f64, 1077, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 1077, __pyx_L1_error)
+  __pyx_codeobj__7 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__6, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_n_s_extract_iter_dict_f64, 884, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 884, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1119
+  /* "rapidfuzz/process_cpp_impl.pyx":926
  *                     yield (choice, score, choice_key)
  * 
  *     def extract_iter_dict_i64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for dict, scorer using RapidFuzz C-API with the result type
  */
-  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__6, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_pyx, __pyx_n_s_extract_iter_dict_i64, 1119, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 1119, __pyx_L1_error)
+  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__6, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_n_s_extract_iter_dict_i64, 926, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 926, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1161
+  /* "rapidfuzz/process_cpp_impl.pyx":968
  *                     yield (choice, score, choice_key)
  * 
  *     def extract_iter_list_f64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type
  */
-  __pyx_tuple__9 = PyTuple_Pack(11, __pyx_n_s_proc_str, __pyx_n_s_c_score_cutoff, __pyx_n_s_query_proc, __pyx_n_s_scorer_func, __pyx_n_s_ScorerFunc, __pyx_n_s_lowest_score_worst, __pyx_n_s_score, __pyx_n_s_i, __pyx_n_s_choice, __pyx_n_s_choice_proc, __pyx_n_s_proc_choice); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 1161, __pyx_L1_error)
+  __pyx_tuple__9 = PyTuple_Pack(11, __pyx_n_s_proc_str, __pyx_n_s_c_score_cutoff, __pyx_n_s_query_proc, __pyx_n_s_scorer_func, __pyx_n_s_ScorerFunc, __pyx_n_s_lowest_score_worst, __pyx_n_s_score, __pyx_n_s_i, __pyx_n_s_choice, __pyx_n_s_choice_proc, __pyx_n_s_proc_choice); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 968, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__9);
   __Pyx_GIVEREF(__pyx_tuple__9);
-  __pyx_codeobj__10 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__9, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_pyx, __pyx_n_s_extract_iter_list_f64, 1161, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__10)) __PYX_ERR(0, 1161, __pyx_L1_error)
+  __pyx_codeobj__10 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__9, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_n_s_extract_iter_list_f64, 968, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__10)) __PYX_ERR(0, 968, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1203
+  /* "rapidfuzz/process_cpp_impl.pyx":1010
  *                     yield (choice, score, i)
  * 
  *     def extract_iter_list_i64():             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for list, scorer using RapidFuzz C-API with the result type
  */
-  __pyx_codeobj__11 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__9, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_pyx, __pyx_n_s_extract_iter_list_i64, 1203, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 1203, __pyx_L1_error)
+  __pyx_codeobj__11 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__9, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_n_s_extract_iter_list_i64, 1010, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 1010, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1245
+  /* "rapidfuzz/process_cpp_impl.pyx":1052
  *                     yield (choice, score, i)
  * 
  *     def py_extract_iter_dict(worst_score, optimal_score):             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for:
  */
-  __pyx_tuple__12 = PyTuple_Pack(6, __pyx_n_s_worst_score, __pyx_n_s_optimal_score, __pyx_n_s_lowest_score_worst, __pyx_n_s_choice_key, __pyx_n_s_choice, __pyx_n_s_score); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 1245, __pyx_L1_error)
+  __pyx_tuple__12 = PyTuple_Pack(6, __pyx_n_s_worst_score, __pyx_n_s_optimal_score, __pyx_n_s_lowest_score_worst, __pyx_n_s_choice_key, __pyx_n_s_choice, __pyx_n_s_score); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 1052, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__12);
   __Pyx_GIVEREF(__pyx_tuple__12);
-  __pyx_codeobj__13 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__12, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_pyx, __pyx_n_s_py_extract_iter_dict, 1245, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__13)) __PYX_ERR(0, 1245, __pyx_L1_error)
+  __pyx_codeobj__13 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__12, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_n_s_py_extract_iter_dict, 1052, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__13)) __PYX_ERR(0, 1052, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1269
+  /* "rapidfuzz/process_cpp_impl.pyx":1076
  *                     yield (choice, score, choice_key)
  * 
  *     def py_extract_iter_list(worst_score, optimal_score):             # <<<<<<<<<<<<<<
  *         """
  *         implementation of extract_iter for:
  */
-  __pyx_tuple__14 = PyTuple_Pack(6, __pyx_n_s_worst_score, __pyx_n_s_optimal_score, __pyx_n_s_lowest_score_worst, __pyx_n_s_i, __pyx_n_s_choice, __pyx_n_s_score); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 1269, __pyx_L1_error)
+  __pyx_tuple__14 = PyTuple_Pack(6, __pyx_n_s_worst_score, __pyx_n_s_optimal_score, __pyx_n_s_lowest_score_worst, __pyx_n_s_i, __pyx_n_s_choice, __pyx_n_s_score); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 1076, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__14);
   __Pyx_GIVEREF(__pyx_tuple__14);
-  __pyx_codeobj__15 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_pyx, __pyx_n_s_py_extract_iter_list, 1269, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__15)) __PYX_ERR(0, 1269, __pyx_L1_error)
+  __pyx_codeobj__15 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_n_s_py_extract_iter_list, 1076, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__15)) __PYX_ERR(0, 1076, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":547
+  /* "(tree fragment)":4
+ *     cdef object __pyx_PickleError
+ *     cdef object __pyx_result
+ *     if __pyx_checksum not in (0xe3b0c44, 0xda39a3e, 0xd41d8cd):             # <<<<<<<<<<<<<<
+ *         from pickle import PickleError as __pyx_PickleError
+ *         raise __pyx_PickleError, "Incompatible checksums (0x%x vs (0xe3b0c44, 0xda39a3e, 0xd41d8cd) = ())" % __pyx_checksum
+ */
+  __pyx_tuple__21 = PyTuple_Pack(3, __pyx_int_238750788, __pyx_int_228825662, __pyx_int_222419149); if (unlikely(!__pyx_tuple__21)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__21);
+  __Pyx_GIVEREF(__pyx_tuple__21);
+
+  /* "rapidfuzz/process_cpp_impl.pyx":582
  * 
  * 
  * def extractOne(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best match in a list of choices. When multiple elements have the same similarity,
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
-  __pyx_tuple__20 = PyTuple_Pack(12, __pyx_n_s_query, __pyx_n_s_choices, __pyx_n_s_scorer, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_kwargs, __pyx_n_s_scorer_context, __pyx_n_s_scorer_flags, __pyx_n_s_scorer_capsule, __pyx_n_s_kwargs_context, __pyx_n_s_worst_score, __pyx_n_s_optimal_score); if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 547, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__20);
-  __Pyx_GIVEREF(__pyx_tuple__20);
-  __pyx_codeobj__3 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__20, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_pyx, __pyx_n_s_extractOne, 547, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__3)) __PYX_ERR(0, 547, __pyx_L1_error)
+  __pyx_tuple__24 = PyTuple_Pack(12, __pyx_n_s_query, __pyx_n_s_choices, __pyx_n_s_scorer, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_kwargs, __pyx_n_s_scorer_context, __pyx_n_s_scorer_flags, __pyx_n_s_scorer_capsule, __pyx_n_s_kwargs_context, __pyx_n_s_worst_score, __pyx_n_s_optimal_score); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(0, 582, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__24);
+  __Pyx_GIVEREF(__pyx_tuple__24);
+  __pyx_codeobj__3 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__24, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_n_s_extractOne, 582, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__3)) __PYX_ERR(0, 582, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":909
+  /* "rapidfuzz/process_cpp_impl.pyx":828
  * 
  * 
  * def extract(query, choices, *, scorer=WRatio, processor=default_process, limit=5, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best matches in a list of choices. The list is sorted by the similarity.
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
-  __pyx_tuple__21 = PyTuple_Pack(13, __pyx_n_s_query, __pyx_n_s_choices, __pyx_n_s_scorer, __pyx_n_s_processor, __pyx_n_s_limit, __pyx_n_s_score_cutoff, __pyx_n_s_kwargs, __pyx_n_s_scorer_context, __pyx_n_s_scorer_flags, __pyx_n_s_scorer_capsule, __pyx_n_s_kwargs_context, __pyx_n_s_worst_score, __pyx_n_s_optimal_score); if (unlikely(!__pyx_tuple__21)) __PYX_ERR(0, 909, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__21);
-  __Pyx_GIVEREF(__pyx_tuple__21);
-  __pyx_codeobj__4 = (PyObject*)__Pyx_PyCode_New(2, 0, 4, 13, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__21, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_pyx, __pyx_n_s_extract, 909, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 909, __pyx_L1_error)
+  __pyx_tuple__25 = PyTuple_Pack(13, __pyx_n_s_query, __pyx_n_s_choices, __pyx_n_s_scorer, __pyx_n_s_processor, __pyx_n_s_limit, __pyx_n_s_score_cutoff, __pyx_n_s_kwargs, __pyx_n_s_scorer_context, __pyx_n_s_scorer_flags, __pyx_n_s_scorer_capsule, __pyx_n_s_kwargs_context, __pyx_n_s_worst_score, __pyx_n_s_optimal_score); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(0, 828, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__25);
+  __Pyx_GIVEREF(__pyx_tuple__25);
+  __pyx_codeobj__4 = (PyObject*)__Pyx_PyCode_New(2, 0, 4, 13, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__25, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_n_s_extract, 828, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 828, __pyx_L1_error)
 
-  /* "rapidfuzz/process_cpp.pyx":1018
+  /* "rapidfuzz/process_cpp_impl.pyx":878
  * 
  * 
  * def extract_iter(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best match in a list of choices
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
+ */
+  __pyx_tuple__26 = PyTuple_Pack(26, __pyx_n_s_query, __pyx_n_s_choices, __pyx_n_s_scorer, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_kwargs, __pyx_n_s_scorer_context, __pyx_n_s_scorer_flags, __pyx_n_s_processor_context, __pyx_n_s_kwargs_context, __pyx_n_s_extract_iter_dict_f64, __pyx_n_s_extract_iter_dict_f64, __pyx_n_s_extract_iter_dict_i64, __pyx_n_s_extract_iter_dict_i64, __pyx_n_s_extract_iter_list_f64, __pyx_n_s_extract_iter_list_f64, __pyx_n_s_extract_iter_list_i64, __pyx_n_s_extract_iter_list_i64, __pyx_n_s_py_extract_iter_dict, __pyx_n_s_py_extract_iter_dict, __pyx_n_s_py_extract_iter_list, __pyx_n_s_py_extract_iter_list, __pyx_n_s_scorer_capsule, __pyx_n_s_processor_capsule, __pyx_n_s_worst_score, __pyx_n_s_optimal_score); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 878, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__26);
+  __Pyx_GIVEREF(__pyx_tuple__26);
+  __pyx_codeobj__5 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 26, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_n_s_extract_iter, 878, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 878, __pyx_L1_error)
+
+  /* "(tree fragment)":1
+ * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ * def __setstate_cython__(self, __pyx_state):
+ */
+  __pyx_tuple__27 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__27);
+  __Pyx_GIVEREF(__pyx_tuple__27);
+  __pyx_codeobj__16 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_reduce_cython, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__16)) __PYX_ERR(1, 1, __pyx_L1_error)
+
+  /* "(tree fragment)":3
+ * def __reduce_cython__(self):
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ */
+  __pyx_tuple__28 = PyTuple_Pack(2, __pyx_n_s_self, __pyx_n_s_pyx_state); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(1, 3, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__28);
+  __Pyx_GIVEREF(__pyx_tuple__28);
+  __pyx_codeobj__17 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_setstate_cython, 3, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__17)) __PYX_ERR(1, 3, __pyx_L1_error)
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1324
+ * 
+ * 
+ * def cdist(queries, choices, *, scorer=ratio, processor=None, score_cutoff=None, dtype=None, workers=1, **kwargs):             # <<<<<<<<<<<<<<
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
-  __pyx_tuple__22 = PyTuple_Pack(26, __pyx_n_s_query, __pyx_n_s_choices, __pyx_n_s_scorer, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_kwargs, __pyx_n_s_scorer_context, __pyx_n_s_scorer_flags, __pyx_n_s_processor_context, __pyx_n_s_kwargs_context, __pyx_n_s_extract_iter_dict_f64, __pyx_n_s_extract_iter_dict_f64, __pyx_n_s_extract_iter_dict_i64, __pyx_n_s_extract_iter_dict_i64, __pyx_n_s_extract_iter_list_f64, __pyx_n_s_extract_iter_list_f64, __pyx_n_s_extract_iter_list_i64, __pyx_n_s_extract_iter_list_i64, __pyx_n_s_py_extract_iter_dict, __pyx_n_s_py_extract_iter_dict, __pyx_n_s_py_extract_iter_list, __pyx_n_s_py_extract_iter_list, __pyx_n_s_scorer_capsule, __pyx_n_s_processor_capsule, __pyx_n_s_worst_score, __pyx_n_s_optimal_score); if (unlikely(!__pyx_tuple__22)) __PYX_ERR(0, 1018, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__22);
-  __Pyx_GIVEREF(__pyx_tuple__22);
-  __pyx_codeobj__5 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 26, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS|CO_GENERATOR, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__22, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_pyx, __pyx_n_s_extract_iter, 1018, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __pyx_tuple__29 = PyTuple_Pack(12, __pyx_n_s_queries, __pyx_n_s_choices, __pyx_n_s_scorer, __pyx_n_s_processor, __pyx_n_s_score_cutoff, __pyx_n_s_dtype, __pyx_n_s_workers, __pyx_n_s_kwargs, __pyx_n_s_scorer_context, __pyx_n_s_scorer_flags, __pyx_n_s_scorer_capsule, __pyx_n_s_kwargs_context); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 1324, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__29);
+  __Pyx_GIVEREF(__pyx_tuple__29);
+  __pyx_codeobj__18 = (PyObject*)__Pyx_PyCode_New(2, 0, 5, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__29, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_rapidfuzz_process_cpp_impl_p, __pyx_n_s_cdist, 1324, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__18)) __PYX_ERR(0, 1324, __pyx_L1_error)
+
+  /* "(tree fragment)":1
+ * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
+ *     cdef tuple state
+ *     cdef object _dict
+ */
+  __pyx_tuple__30 = PyTuple_Pack(4, __pyx_n_s_self, __pyx_n_s_state, __pyx_n_s_dict_2, __pyx_n_s_use_setstate); if (unlikely(!__pyx_tuple__30)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__30);
+  __Pyx_GIVEREF(__pyx_tuple__30);
+  __pyx_codeobj__31 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__30, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_reduce_cython, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__31)) __PYX_ERR(1, 1, __pyx_L1_error)
+
+  /* "(tree fragment)":16
+ *     else:
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, state)
+ * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
+ *     __pyx_unpickle___Pyx_EnumMeta__set_state(self, __pyx_state)
+ */
+  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_setstate_cython, 16, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(1, 16, __pyx_L1_error)
+
+  /* "EnumBase":24
+ * cdef object __Pyx_EnumBase
+ * class __Pyx_EnumBase(int, metaclass=__Pyx_EnumMeta):
+ *     def __new__(cls, value, name=None):             # <<<<<<<<<<<<<<
+ *         for v in cls:
+ *             if v == value:
+ */
+  __pyx_tuple__33 = PyTuple_Pack(5, __pyx_n_s_cls, __pyx_n_s_value, __pyx_n_s_name, __pyx_n_s_v, __pyx_n_s_res); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(1, 24, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__33);
+  __Pyx_GIVEREF(__pyx_tuple__33);
+  __pyx_codeobj__34 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_new, 24, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__34)) __PYX_ERR(1, 24, __pyx_L1_error)
+  __pyx_tuple__35 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__35)) __PYX_ERR(1, 24, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__35);
+  __Pyx_GIVEREF(__pyx_tuple__35);
+
+  /* "EnumBase":35
+ *         cls.__members__[name] = res
+ *         return res
+ *     def __repr__(self):             # <<<<<<<<<<<<<<
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
+ *     def __str__(self):
+ */
+  __pyx_codeobj__36 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_repr, 35, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__36)) __PYX_ERR(1, 35, __pyx_L1_error)
+
+  /* "EnumBase":37
+ *     def __repr__(self):
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
+ *     def __str__(self):             # <<<<<<<<<<<<<<
+ *         return "%s.%s" % (self.__class__.__name__, self.name)
+ * 
+ */
+  __pyx_codeobj__37 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__27, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_str, 37, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__37)) __PYX_ERR(1, 37, __pyx_L1_error)
+
+  /* "(tree fragment)":1
+ * def __pyx_unpickle___Pyx_EnumMeta(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
+ *     cdef object __pyx_PickleError
+ *     cdef object __pyx_result
+ */
+  __pyx_tuple__38 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__38);
+  __Pyx_GIVEREF(__pyx_tuple__38);
+  __pyx_codeobj__39 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle___Pyx_EnumMeta, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__39)) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 /* #### Code section: init_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitConstants(void) {
   __pyx_umethod_PyDict_Type_keys.type = (PyObject*)&PyDict_Type;
   __pyx_umethod_PyDict_Type_keys.method_name = &__pyx_n_s_keys;
   #if CYTHON_USE_MODULE_STATE
-  if (__Pyx_InitString(__pyx_string_tab[0], &__pyx_kp_u_Find_the_best_match_in_a_list_o) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[1], &__pyx_kp_u_Got_unexpected_keyword_arguments) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[2], &__pyx_n_s_MemoryError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[3], &__pyx_n_u_RF_Preprocess) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[4], &__pyx_n_s_RF_Scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[5], &__pyx_n_u_RF_Scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[6], &__pyx_n_s_RF_ScorerPy) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[7], &__pyx_n_u_RF_ScorerPy) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[8], &__pyx_n_s_ScorerFunc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[9], &__pyx_n_s_TypeError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[10], &__pyx_n_s_ValueError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[11], &__pyx_n_s_WRatio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[12], &__pyx_kp_u__16) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[13], &__pyx_kp_u__17) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[14], &__pyx_kp_u__18) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[15], &__pyx_n_s__19) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[16], &__pyx_n_s__23) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[17], &__pyx_n_s_args) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[18], &__pyx_n_s_array) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[19], &__pyx_n_s_asyncio_coroutines) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[20], &__pyx_n_s_c_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[21], &__pyx_n_s_choice) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[22], &__pyx_n_s_choice_key) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[23], &__pyx_n_s_choice_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[24], &__pyx_n_s_choices) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[25], &__pyx_n_s_cline_in_traceback) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[26], &__pyx_n_s_close) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[27], &__pyx_n_s_default_process) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[28], &__pyx_kp_u_disable) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[29], &__pyx_kp_u_enable) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[30], &__pyx_n_s_enumerate) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[31], &__pyx_n_s_extract) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[32], &__pyx_n_s_extractOne) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[33], &__pyx_kp_u_extractOne_line_547) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[34], &__pyx_n_s_extract_iter) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[35], &__pyx_n_s_extract_iter_dict_f64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[36], &__pyx_n_s_extract_iter_dict_i64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[37], &__pyx_n_s_extract_iter_list_f64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[38], &__pyx_n_s_extract_iter_list_i64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[39], &__pyx_n_s_extract_iter_locals_extract_iter) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[40], &__pyx_n_s_extract_iter_locals_extract_iter_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[41], &__pyx_n_s_extract_iter_locals_extract_iter_3) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[42], &__pyx_n_s_extract_iter_locals_extract_iter_4) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[43], &__pyx_n_s_extract_iter_locals_py_extract_i) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[44], &__pyx_n_s_extract_iter_locals_py_extract_i_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[45], &__pyx_kp_u_gc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[46], &__pyx_n_u_get_scorer_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[47], &__pyx_n_s_heapq) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[48], &__pyx_n_s_i) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[49], &__pyx_n_s_import) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[50], &__pyx_n_s_initializing) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[51], &__pyx_n_s_is_coroutine) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[52], &__pyx_kp_u_isenabled) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[53], &__pyx_n_s_items) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[54], &__pyx_n_u_items) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[55], &__pyx_n_s_key) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[56], &__pyx_n_s_keys) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[57], &__pyx_n_s_kwargs) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[58], &__pyx_n_s_kwargs_context) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[59], &__pyx_n_s_limit) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[60], &__pyx_n_s_lowest_score_worst) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[61], &__pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[62], &__pyx_n_s_name) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[63], &__pyx_n_s_nlargest) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[64], &__pyx_n_s_nsmallest) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[65], &__pyx_n_s_optimal_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[66], &__pyx_n_u_optimal_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[67], &__pyx_n_s_proc_choice) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[68], &__pyx_n_s_proc_str) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[69], &__pyx_n_s_processor) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[70], &__pyx_n_u_processor) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[71], &__pyx_n_s_processor_capsule) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[72], &__pyx_n_s_processor_context) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[73], &__pyx_n_s_py_extract_dict_locals_lambda) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[74], &__pyx_n_s_py_extract_iter_dict) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[75], &__pyx_n_s_py_extract_iter_list) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[76], &__pyx_n_s_py_extract_list_locals_lambda) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[77], &__pyx_n_s_query) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[78], &__pyx_n_s_query_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[79], &__pyx_n_s_range) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[80], &__pyx_n_s_rapidfuzz_fuzz) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[81], &__pyx_n_s_rapidfuzz_process_cpp) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[82], &__pyx_n_s_rapidfuzz_utils) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[83], &__pyx_n_s_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[84], &__pyx_n_s_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[85], &__pyx_n_u_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[86], &__pyx_kp_u_score_cutoff_has_to_be_in_the_ra) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[87], &__pyx_n_s_scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[88], &__pyx_n_s_scorer_capsule) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[89], &__pyx_n_s_scorer_context) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[90], &__pyx_kp_u_scorer_does_not_properly_use_the) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[91], &__pyx_n_s_scorer_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[92], &__pyx_n_s_scorer_func) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[93], &__pyx_n_s_send) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[94], &__pyx_n_s_spec) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[95], &__pyx_kp_s_src_rapidfuzz_process_cpp_pyx) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[96], &__pyx_n_s_test) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[97], &__pyx_n_s_throw) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[98], &__pyx_n_s_typecode) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[99], &__pyx_n_s_worst_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  if (__Pyx_InitString(__pyx_string_tab[100], &__pyx_n_u_worst_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[0], &__pyx_n_s_EnumBase) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[1], &__pyx_n_s_FLOAT32) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[2], &__pyx_n_s_FLOAT64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[3], &__pyx_kp_u_Got_unexpected_keyword_arguments) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[4], &__pyx_n_s_INT16) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[5], &__pyx_n_s_INT32) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[6], &__pyx_n_s_INT64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[7], &__pyx_n_s_INT8) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[8], &__pyx_kp_s_Incompatible_checksums_0x_x_vs_0) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[9], &__pyx_n_s_IntEnum) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[10], &__pyx_n_s_Matrix) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[11], &__pyx_n_s_MatrixType) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[12], &__pyx_n_s_Matrix___reduce_cython) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[13], &__pyx_n_s_Matrix___setstate_cython) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[14], &__pyx_n_s_MemoryError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[15], &__pyx_n_s_OrderedDict) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[16], &__pyx_n_s_PickleError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[17], &__pyx_n_s_Pyx_EnumBase) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[18], &__pyx_n_s_Pyx_EnumBase___new) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[19], &__pyx_n_s_Pyx_EnumBase___repr) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[20], &__pyx_n_s_Pyx_EnumBase___str) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[21], &__pyx_n_s_Pyx_EnumMeta___reduce_cython) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[22], &__pyx_n_s_Pyx_EnumMeta___setstate_cython) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[23], &__pyx_n_u_RF_Preprocess) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[24], &__pyx_n_s_RF_Scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[25], &__pyx_n_u_RF_Scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[26], &__pyx_n_s_RF_ScorerPy) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[27], &__pyx_n_u_RF_ScorerPy) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[28], &__pyx_n_s_ScorerFunc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[29], &__pyx_n_s_TypeError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[30], &__pyx_n_s_UINT16) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[31], &__pyx_n_s_UINT32) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[32], &__pyx_n_s_UINT64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[33], &__pyx_n_s_UINT8) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[34], &__pyx_n_s_UNDEFINED) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[35], &__pyx_kp_s_Unknown_enum_value_s) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[36], &__pyx_n_s_ValueError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[37], &__pyx_n_s_WRatio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[38], &__pyx_kp_u__19) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[39], &__pyx_kp_u__20) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[40], &__pyx_kp_u__22) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[41], &__pyx_n_s__23) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[42], &__pyx_n_s__40) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[43], &__pyx_n_s_args) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[44], &__pyx_n_s_array) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[45], &__pyx_n_s_asyncio_coroutines) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[46], &__pyx_n_s_c_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[47], &__pyx_n_s_cdist) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[48], &__pyx_n_s_choice) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[49], &__pyx_n_s_choice_key) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[50], &__pyx_n_s_choice_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[51], &__pyx_n_s_choices) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[52], &__pyx_n_s_class) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[53], &__pyx_n_s_class_getitem) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[54], &__pyx_n_s_cline_in_traceback) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[55], &__pyx_n_s_close) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[56], &__pyx_n_s_cls) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[57], &__pyx_n_s_collections) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[58], &__pyx_n_s_dct) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[59], &__pyx_n_s_default_process) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[60], &__pyx_n_s_dict) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[61], &__pyx_n_s_dict_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[62], &__pyx_kp_u_disable) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[63], &__pyx_n_s_doc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[64], &__pyx_n_s_dtype) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[65], &__pyx_kp_u_enable) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[66], &__pyx_n_s_enum) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[67], &__pyx_n_s_enumerate) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[68], &__pyx_n_s_extract) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[69], &__pyx_n_s_extractOne) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[70], &__pyx_n_s_extract_iter) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[71], &__pyx_n_s_extract_iter_dict_f64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[72], &__pyx_n_s_extract_iter_dict_i64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[73], &__pyx_n_s_extract_iter_list_f64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[74], &__pyx_n_s_extract_iter_list_i64) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[75], &__pyx_n_s_extract_iter_locals_extract_iter) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[76], &__pyx_n_s_extract_iter_locals_extract_iter_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[77], &__pyx_n_s_extract_iter_locals_extract_iter_3) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[78], &__pyx_n_s_extract_iter_locals_extract_iter_4) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[79], &__pyx_n_s_extract_iter_locals_py_extract_i) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[80], &__pyx_n_s_extract_iter_locals_py_extract_i_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[81], &__pyx_kp_u_gc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[82], &__pyx_n_u_get_scorer_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[83], &__pyx_n_s_getstate) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[84], &__pyx_n_s_heapq) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[85], &__pyx_n_s_i) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[86], &__pyx_n_s_import) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[87], &__pyx_n_s_init) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[88], &__pyx_n_s_init_subclass) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[89], &__pyx_n_s_initializing) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[90], &__pyx_n_s_is_coroutine) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[91], &__pyx_kp_u_isenabled) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[92], &__pyx_n_s_items) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[93], &__pyx_n_u_items) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[94], &__pyx_n_s_key) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[95], &__pyx_n_s_keys) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[96], &__pyx_n_s_kwargs) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[97], &__pyx_n_s_kwargs_context) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[98], &__pyx_n_s_limit) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[99], &__pyx_n_s_lowest_score_worst) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[100], &__pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[101], &__pyx_n_s_members) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[102], &__pyx_n_s_metaclass) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[103], &__pyx_n_s_module) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[104], &__pyx_n_s_mro_entries) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[105], &__pyx_n_s_name) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[106], &__pyx_n_s_name_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[107], &__pyx_n_s_new) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[108], &__pyx_n_s_nlargest) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[109], &__pyx_n_s_nsmallest) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[110], &__pyx_n_s_optimal_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[111], &__pyx_n_u_optimal_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[112], &__pyx_n_s_parents) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[113], &__pyx_n_s_pickle) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[114], &__pyx_n_s_prepare) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[115], &__pyx_n_s_proc_choice) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[116], &__pyx_n_s_proc_str) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[117], &__pyx_n_s_processor) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[118], &__pyx_n_u_processor) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[119], &__pyx_n_s_processor_capsule) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[120], &__pyx_n_s_processor_context) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[121], &__pyx_n_s_py_extract_dict_locals_lambda) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[122], &__pyx_n_s_py_extract_iter_dict) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[123], &__pyx_n_s_py_extract_iter_list) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[124], &__pyx_n_s_py_extract_list_locals_lambda) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[125], &__pyx_n_s_pyx_PickleError) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[126], &__pyx_n_s_pyx_checksum) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[127], &__pyx_n_s_pyx_result) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[128], &__pyx_n_s_pyx_state) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[129], &__pyx_n_s_pyx_type) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[130], &__pyx_n_s_pyx_unpickle___Pyx_EnumMeta) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[131], &__pyx_n_s_qualname) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[132], &__pyx_n_s_queries) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[133], &__pyx_n_s_query) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[134], &__pyx_n_s_query_proc) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[135], &__pyx_n_s_range) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[136], &__pyx_n_s_rapidfuzz_fuzz) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[137], &__pyx_n_s_rapidfuzz_process_cpp_impl) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[138], &__pyx_n_s_rapidfuzz_utils) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[139], &__pyx_n_s_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[140], &__pyx_n_s_reduce) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[141], &__pyx_n_s_reduce_cython) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[142], &__pyx_n_s_reduce_ex) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[143], &__pyx_n_s_repr) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[144], &__pyx_n_s_res) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[145], &__pyx_kp_s_s_s) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[146], &__pyx_kp_s_s_s_d) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[147], &__pyx_n_s_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[148], &__pyx_n_s_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[149], &__pyx_n_u_score_cutoff) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[150], &__pyx_kp_u_score_cutoff_has_to_be_in_the_ra) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[151], &__pyx_n_s_scorer) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[152], &__pyx_n_s_scorer_capsule) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[153], &__pyx_n_s_scorer_context) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[154], &__pyx_kp_u_scorer_does_not_properly_use_the) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[155], &__pyx_n_s_scorer_flags) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[156], &__pyx_n_s_scorer_func) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[157], &__pyx_n_s_self) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[158], &__pyx_kp_s_self_matrix_cannot_be_converted) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[159], &__pyx_n_s_send) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[160], &__pyx_n_s_set_name) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[161], &__pyx_n_s_setstate) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[162], &__pyx_n_s_setstate_cython) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[163], &__pyx_n_s_spec) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[164], &__pyx_kp_s_src_rapidfuzz_process_cpp_impl_p) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[165], &__pyx_n_s_state) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[166], &__pyx_n_s_str) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[167], &__pyx_kp_s_stringsource) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[168], &__pyx_n_s_super) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[169], &__pyx_n_s_test) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[170], &__pyx_n_s_throw) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[171], &__pyx_n_s_typecode) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[172], &__pyx_n_s_update) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[173], &__pyx_n_s_use_setstate) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[174], &__pyx_n_s_v) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[175], &__pyx_n_s_value) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[176], &__pyx_n_s_values) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[177], &__pyx_n_s_workers) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[178], &__pyx_n_s_worst_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+  if (__Pyx_InitString(__pyx_string_tab[179], &__pyx_n_u_worst_score) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   #endif
   #if !CYTHON_USE_MODULE_STATE
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   #endif
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_5 = PyInt_FromLong(5); if (unlikely(!__pyx_int_5)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_100 = PyInt_FromLong(100); if (unlikely(!__pyx_int_100)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_int_222419149 = PyInt_FromLong(222419149L); if (unlikely(!__pyx_int_222419149)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_int_228825662 = PyInt_FromLong(228825662L); if (unlikely(!__pyx_int_228825662)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_int_238750788 = PyInt_FromLong(238750788L); if (unlikely(!__pyx_int_238750788)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 /* #### Code section: init_globals ### */
 
@@ -23044,14 +29339,17 @@
 static CYTHON_SMALL_CODE int __Pyx_modinit_variable_import_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_function_import_code(void); /*proto*/
 
 static int __Pyx_modinit_global_init_code(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_modinit_global_init_code", 0);
   /*--- Global init code ---*/
+  __Pyx_OrderedDict = Py_None; Py_INCREF(Py_None);
+  __Pyx_EnumBase = Py_None; Py_INCREF(Py_None);
+  __Pyx_globals = ((PyObject*)Py_None); Py_INCREF(Py_None);
   __Pyx_RefNannyFinishContext();
   return 0;
 }
 
 static int __Pyx_modinit_variable_export_code(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_modinit_variable_export_code", 0);
@@ -23066,179 +29364,252 @@
   /*--- Function export code ---*/
   __Pyx_RefNannyFinishContext();
   return 0;
 }
 
 static int __Pyx_modinit_type_init_code(void) {
   __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_init_code", 0);
   /*--- Type init code ---*/
   #if CYTHON_USE_TYPE_SPECS
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter)) __PYX_ERR(0, 1018, __pyx_L1_error)
-  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter_spec, __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter) < 0) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_16process_cpp_impl_Matrix_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix)) __PYX_ERR(0, 1229, __pyx_L1_error)
+  #if !CYTHON_COMPILING_IN_LIMITED_API
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix->tp_as_buffer = &__pyx_tp_as_buffer_Matrix;
+  #elif defined(_MSC_VER)
+  #pragma message ("The buffer protocol is not supported in the Limited C-API.")
+  #else
+  #warning "The buffer protocol is not supported in the Limited C-API."
+  #endif
+  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_16process_cpp_impl_Matrix_spec, __pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix) < 0) __PYX_ERR(0, 1229, __pyx_L1_error)
   #else
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter = &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix = &__pyx_type_9rapidfuzz_16process_cpp_impl_Matrix;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
   #endif
   #if !CYTHON_USE_TYPE_SPECS
-  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter) < 0) __PYX_ERR(0, 1018, __pyx_L1_error)
+  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix) < 0) __PYX_ERR(0, 1229, __pyx_L1_error)
   #endif
   #if PY_MAJOR_VERSION < 3
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter->tp_print = 0;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix->tp_print = 0;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter->tp_dictoffset && __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter->tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct__extract_iter->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix->tp_dictoffset && __pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix->tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix->tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
   #endif
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_Matrix, (PyObject *) __pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix) < 0) __PYX_ERR(0, 1229, __pyx_L1_error)
+  #if !CYTHON_COMPILING_IN_LIMITED_API
+  if (__Pyx_setup_reduce((PyObject *) __pyx_ptype_9rapidfuzz_16process_cpp_impl_Matrix) < 0) __PYX_ERR(0, 1229, __pyx_L1_error)
+  #endif
   #if CYTHON_USE_TYPE_SPECS
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64)) __PYX_ERR(0, 1077, __pyx_L1_error)
-  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64_spec, __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64) < 0) __PYX_ERR(0, 1077, __pyx_L1_error)
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter)) __PYX_ERR(0, 878, __pyx_L1_error)
+  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter_spec, __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter) < 0) __PYX_ERR(0, 878, __pyx_L1_error)
   #else
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64 = &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter = &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
   #endif
   #if !CYTHON_USE_TYPE_SPECS
-  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64) < 0) __PYX_ERR(0, 1077, __pyx_L1_error)
+  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter) < 0) __PYX_ERR(0, 878, __pyx_L1_error)
   #endif
   #if PY_MAJOR_VERSION < 3
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64->tp_print = 0;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter->tp_print = 0;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64->tp_dictoffset && __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64->tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_1_extract_iter_dict_f64->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter->tp_dictoffset && __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter->tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct__extract_iter->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   #endif
   #if CYTHON_USE_TYPE_SPECS
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64)) __PYX_ERR(0, 1119, __pyx_L1_error)
-  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64_spec, __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64) < 0) __PYX_ERR(0, 1119, __pyx_L1_error)
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64)) __PYX_ERR(0, 884, __pyx_L1_error)
+  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64_spec, __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64) < 0) __PYX_ERR(0, 884, __pyx_L1_error)
   #else
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64 = &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64 = &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
   #endif
   #if !CYTHON_USE_TYPE_SPECS
-  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64) < 0) __PYX_ERR(0, 1119, __pyx_L1_error)
+  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64) < 0) __PYX_ERR(0, 884, __pyx_L1_error)
   #endif
   #if PY_MAJOR_VERSION < 3
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64->tp_print = 0;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64->tp_print = 0;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64->tp_dictoffset && __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64->tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_2_extract_iter_dict_i64->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64->tp_dictoffset && __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64->tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_1_extract_iter_dict_f64->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   #endif
   #if CYTHON_USE_TYPE_SPECS
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64)) __PYX_ERR(0, 1161, __pyx_L1_error)
-  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64_spec, __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64) < 0) __PYX_ERR(0, 1161, __pyx_L1_error)
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64)) __PYX_ERR(0, 926, __pyx_L1_error)
+  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64_spec, __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64) < 0) __PYX_ERR(0, 926, __pyx_L1_error)
   #else
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64 = &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64 = &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
   #endif
   #if !CYTHON_USE_TYPE_SPECS
-  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64) < 0) __PYX_ERR(0, 1161, __pyx_L1_error)
+  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64) < 0) __PYX_ERR(0, 926, __pyx_L1_error)
   #endif
   #if PY_MAJOR_VERSION < 3
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64->tp_print = 0;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64->tp_print = 0;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64->tp_dictoffset && __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64->tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_3_extract_iter_list_f64->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64->tp_dictoffset && __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64->tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_2_extract_iter_dict_i64->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   #endif
   #if CYTHON_USE_TYPE_SPECS
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64)) __PYX_ERR(0, 1203, __pyx_L1_error)
-  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64_spec, __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64) < 0) __PYX_ERR(0, 1203, __pyx_L1_error)
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64)) __PYX_ERR(0, 968, __pyx_L1_error)
+  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64_spec, __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64) < 0) __PYX_ERR(0, 968, __pyx_L1_error)
   #else
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64 = &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64 = &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
   #endif
   #if !CYTHON_USE_TYPE_SPECS
-  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64) < 0) __PYX_ERR(0, 1203, __pyx_L1_error)
+  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64) < 0) __PYX_ERR(0, 968, __pyx_L1_error)
   #endif
   #if PY_MAJOR_VERSION < 3
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64->tp_print = 0;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64->tp_print = 0;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64->tp_dictoffset && __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64->tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_4_extract_iter_list_i64->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64->tp_dictoffset && __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64->tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_3_extract_iter_list_f64->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   #endif
   #if CYTHON_USE_TYPE_SPECS
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict)) __PYX_ERR(0, 1245, __pyx_L1_error)
-  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict_spec, __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict) < 0) __PYX_ERR(0, 1245, __pyx_L1_error)
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64)) __PYX_ERR(0, 1010, __pyx_L1_error)
+  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64_spec, __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64) < 0) __PYX_ERR(0, 1010, __pyx_L1_error)
   #else
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict = &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64 = &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
   #endif
   #if !CYTHON_USE_TYPE_SPECS
-  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict) < 0) __PYX_ERR(0, 1245, __pyx_L1_error)
+  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64) < 0) __PYX_ERR(0, 1010, __pyx_L1_error)
   #endif
   #if PY_MAJOR_VERSION < 3
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict->tp_print = 0;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64->tp_print = 0;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict->tp_dictoffset && __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict->tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_5_py_extract_iter_dict->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64->tp_dictoffset && __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64->tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_4_extract_iter_list_i64->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   #endif
   #if CYTHON_USE_TYPE_SPECS
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list)) __PYX_ERR(0, 1269, __pyx_L1_error)
-  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list_spec, __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list) < 0) __PYX_ERR(0, 1269, __pyx_L1_error)
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict)) __PYX_ERR(0, 1052, __pyx_L1_error)
+  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict_spec, __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict) < 0) __PYX_ERR(0, 1052, __pyx_L1_error)
   #else
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list = &__pyx_type_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict = &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
   #endif
   #if !CYTHON_USE_TYPE_SPECS
-  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list) < 0) __PYX_ERR(0, 1269, __pyx_L1_error)
+  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict) < 0) __PYX_ERR(0, 1052, __pyx_L1_error)
   #endif
   #if PY_MAJOR_VERSION < 3
-  __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list->tp_print = 0;
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict->tp_print = 0;
   #endif
   #if !CYTHON_COMPILING_IN_LIMITED_API
-  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list->tp_dictoffset && __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list->tp_getattro == PyObject_GenericGetAttr)) {
-    __pyx_ptype_9rapidfuzz_11process_cpp___pyx_scope_struct_6_py_extract_iter_list->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict->tp_dictoffset && __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict->tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_5_py_extract_iter_dict->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   #endif
+  #if CYTHON_USE_TYPE_SPECS
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list_spec, NULL); if (unlikely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list)) __PYX_ERR(0, 1076, __pyx_L1_error)
+  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list_spec, __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list) < 0) __PYX_ERR(0, 1076, __pyx_L1_error)
+  #else
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list = &__pyx_type_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list;
+  #endif
+  #if !CYTHON_COMPILING_IN_LIMITED_API
+  #endif
+  #if !CYTHON_USE_TYPE_SPECS
+  if (__Pyx_PyType_Ready(__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list) < 0) __PYX_ERR(0, 1076, __pyx_L1_error)
+  #endif
+  #if PY_MAJOR_VERSION < 3
+  __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list->tp_print = 0;
+  #endif
+  #if !CYTHON_COMPILING_IN_LIMITED_API
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list->tp_dictoffset && __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list->tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_ptype_9rapidfuzz_16process_cpp_impl___pyx_scope_struct_6_py_extract_iter_list->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
+  }
+  #endif
+  #if CYTHON_USE_TYPE_SPECS
+  __pyx_t_1 = PyTuple_Pack(1, (PyObject *)(&PyType_Type)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 12, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_ptype___Pyx_EnumMeta = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__Pyx_EnumMeta_spec, __pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (unlikely(!__pyx_ptype___Pyx_EnumMeta)) __PYX_ERR(1, 12, __pyx_L1_error)
+  if (__Pyx_fix_up_extension_type_from_spec(&__Pyx_EnumMeta_spec, __pyx_ptype___Pyx_EnumMeta) < 0) __PYX_ERR(1, 12, __pyx_L1_error)
+  #else
+  __pyx_ptype___Pyx_EnumMeta = &__Pyx_EnumMeta;
+  #endif
+  #if !CYTHON_COMPILING_IN_LIMITED_API
+  __pyx_ptype___Pyx_EnumMeta->tp_dealloc = (&PyType_Type)->tp_dealloc;
+  __pyx_ptype___Pyx_EnumMeta->tp_base = (&PyType_Type);
+  __pyx_ptype___Pyx_EnumMeta->tp_new = (&PyType_Type)->tp_new;
+  #endif
+  #if !CYTHON_USE_TYPE_SPECS
+  if (__Pyx_PyType_Ready(__pyx_ptype___Pyx_EnumMeta) < 0) __PYX_ERR(1, 12, __pyx_L1_error)
+  #endif
+  #if PY_MAJOR_VERSION < 3
+  __pyx_ptype___Pyx_EnumMeta->tp_print = 0;
+  #endif
+  #if !CYTHON_COMPILING_IN_LIMITED_API
+  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype___Pyx_EnumMeta->tp_dictoffset && __pyx_ptype___Pyx_EnumMeta->tp_getattro == PyObject_GenericGetAttr)) {
+    __pyx_ptype___Pyx_EnumMeta->tp_getattro = __Pyx_PyObject_GenericGetAttr;
+  }
+  #endif
+  #if !CYTHON_COMPILING_IN_LIMITED_API
+  if (__Pyx_setup_reduce((PyObject *) __pyx_ptype___Pyx_EnumMeta) < 0) __PYX_ERR(1, 12, __pyx_L1_error)
+  #endif
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static int __Pyx_modinit_type_import_code(void) {
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
-  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 9, __pyx_L1_error)
+  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(4, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
   sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyTypeObject),
   #elif CYTHON_COMPILING_IN_LIMITED_API
   sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyTypeObject),
   #else
   sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT(PyHeapTypeObject),
   #endif
   __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(2, 9, __pyx_L1_error)
+   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(4, 9, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(5, 8, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_ptype_7cpython_4bool_bool = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "bool", sizeof(PyBoolObject), __PYX_GET_STRUCT_ALIGNMENT(PyBoolObject),
+  __Pyx_ImportType_CheckSize_Warn);
+   if (!__pyx_ptype_7cpython_4bool_bool) __PYX_ERR(5, 8, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(6, 15, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_ptype_7cpython_7complex_complex = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "complex", sizeof(PyComplexObject), __PYX_GET_STRUCT_ALIGNMENT(PyComplexObject),
+  __Pyx_ImportType_CheckSize_Warn);
+   if (!__pyx_ptype_7cpython_7complex_complex) __PYX_ERR(6, 15, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -23260,31 +29631,31 @@
   return 0;
 }
 
 
 #if PY_MAJOR_VERSION >= 3
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
-static int __pyx_pymod_exec_process_cpp(PyObject* module); /*proto*/
+static int __pyx_pymod_exec_process_cpp_impl(PyObject* module); /*proto*/
 static PyModuleDef_Slot __pyx_moduledef_slots[] = {
   {Py_mod_create, (void*)__pyx_pymod_create},
-  {Py_mod_exec, (void*)__pyx_pymod_exec_process_cpp},
+  {Py_mod_exec, (void*)__pyx_pymod_exec_process_cpp_impl},
   {0, NULL}
 };
 #endif
 
 #ifdef __cplusplus
 namespace {
   struct PyModuleDef __pyx_moduledef =
   #else
   static struct PyModuleDef __pyx_moduledef =
   #endif
   {
       PyModuleDef_HEAD_INIT,
-      "process_cpp",
+      "process_cpp_impl",
       0, /* m_doc */
     #if CYTHON_PEP489_MULTI_PHASE_INIT
       0, /* m_size */
     #elif CYTHON_USE_MODULE_STATE
       sizeof(__pyx_mstate), /* m_size */
     #else
       -1, /* m_size */
@@ -23324,19 +29695,19 @@
 #else
 #define __Pyx_PyMODINIT_FUNC PyObject *
 #endif
 #endif
 
 
 #if PY_MAJOR_VERSION < 3
-__Pyx_PyMODINIT_FUNC initprocess_cpp(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC initprocess_cpp(void)
+__Pyx_PyMODINIT_FUNC initprocess_cpp_impl(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC initprocess_cpp_impl(void)
 #else
-__Pyx_PyMODINIT_FUNC PyInit_process_cpp(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC PyInit_process_cpp(void)
+__Pyx_PyMODINIT_FUNC PyInit_process_cpp_impl(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC PyInit_process_cpp_impl(void)
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 {
   return PyModuleDef_Init(&__pyx_moduledef);
 }
 static CYTHON_SMALL_CODE int __Pyx_check_single_interpreter(void) {
     #if PY_VERSION_HEX >= 0x030700A1
     static PY_INT64_T main_interpreter_id = -1;
@@ -23409,43 +29780,54 @@
     return module;
 bad:
     Py_XDECREF(module);
     return NULL;
 }
 
 
-static CYTHON_SMALL_CODE int __pyx_pymod_exec_process_cpp(PyObject *__pyx_pyinit_module)
+static CYTHON_SMALL_CODE int __pyx_pymod_exec_process_cpp_impl(PyObject *__pyx_pyinit_module)
 #endif
 #endif
 {
   int stringtab_initialized = 0;
   __Pyx_TraceDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  int __pyx_t_6;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
+  PyObject *__pyx_t_9 = NULL;
+  PyObject *__pyx_t_10 = NULL;
+  PyObject *__pyx_t_11 = NULL;
+  PyObject *__pyx_t_12 = NULL;
+  PyObject *__pyx_t_13 = NULL;
+  PyObject *__pyx_t_14 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   if (__pyx_m) {
     if (__pyx_m == __pyx_pyinit_module) return 0;
-    PyErr_SetString(PyExc_RuntimeError, "Module 'process_cpp' has already been imported. Re-initialisation is not supported.");
+    PyErr_SetString(PyExc_RuntimeError, "Module 'process_cpp_impl' has already been imported. Re-initialisation is not supported.");
     return -1;
   }
   #elif PY_MAJOR_VERSION >= 3
   if (__pyx_m) return __Pyx_NewRef(__pyx_m);
   #endif
   /*--- Module creation code ---*/
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   __pyx_m = __pyx_pyinit_module;
   Py_INCREF(__pyx_m);
   #else
   #if PY_MAJOR_VERSION < 3
-  __pyx_m = Py_InitModule4("process_cpp", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
+  __pyx_m = Py_InitModule4("process_cpp_impl", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
   if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
   #elif CYTHON_COMPILING_IN_LIMITED_API
   __pyx_t_1 = PyModule_Create(&__pyx_moduledef); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
   {
     int add_module_result = PyState_AddModule(__pyx_t_1, &__pyx_moduledef);
     Py_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (unlikely((add_module_result < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -23468,15 +29850,15 @@
 if (!__Pyx_RefNanny) {
   PyErr_Clear();
   __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
   if (!__Pyx_RefNanny)
       Py_FatalError("failed to import 'refnanny' module");
 }
 #endif
-  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_process_cpp(void)", 0);
+  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_process_cpp_impl(void)", 0);
   if (__Pyx_check_binary_version() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #ifdef __Pxy_PyFrame_Initialize_Offsets
   __Pxy_PyFrame_Initialize_Offsets();
   #endif
   __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -23506,22 +29888,22 @@
   /*--- Initialize various global constants etc. ---*/
   if (__Pyx_InitConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   stringtab_initialized = 1;
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  if (__pyx_module_is_main_rapidfuzz__process_cpp) {
-    if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_module_is_main_rapidfuzz__process_cpp_impl) {
+    if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name_2, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   }
   #if PY_MAJOR_VERSION >= 3
   {
     PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
-    if (!PyDict_GetItemString(modules, "rapidfuzz.process_cpp")) {
-      if (unlikely((PyDict_SetItemString(modules, "rapidfuzz.process_cpp", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
+    if (!PyDict_GetItemString(modules, "rapidfuzz.process_cpp_impl")) {
+      if (unlikely((PyDict_SetItemString(modules, "rapidfuzz.process_cpp_impl", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
     }
   }
   #endif
   /*--- Builtin init code ---*/
   if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Constants init code ---*/
   if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -23533,21 +29915,21 @@
   if (unlikely((__Pyx_modinit_type_import_code() < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  __Pyx_TraceCall("__Pyx_PyMODINIT_FUNC PyInit_process_cpp(void)", __pyx_f[0], 1, 0, __PYX_ERR(0, 1, __pyx_L1_error));
+  __Pyx_TraceCall("__Pyx_PyMODINIT_FUNC PyInit_process_cpp_impl(void)", __pyx_f[0], 1, 0, __PYX_ERR(0, 1, __pyx_L1_error));
 
-  /* "rapidfuzz/process_cpp.pyx":4
+  /* "rapidfuzz/process_cpp_impl.pyx":4
  * # cython: language_level=3, binding=True, linetrace=True
  * 
  * from rapidfuzz.utils import default_process             # <<<<<<<<<<<<<<
- * from rapidfuzz.fuzz import WRatio
+ * from rapidfuzz.fuzz import WRatio, ratio
  * 
  */
   __Pyx_TraceLine(4,0,__PYX_ERR(0, 4, __pyx_L1_error))
   __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_n_s_default_process);
   __Pyx_GIVEREF(__pyx_n_s_default_process);
@@ -23557,464 +29939,1551 @@
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_default_process, __pyx_t_2) < 0) __PYX_ERR(0, 4, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":5
+  /* "rapidfuzz/process_cpp_impl.pyx":5
  * 
  * from rapidfuzz.utils import default_process
- * from rapidfuzz.fuzz import WRatio             # <<<<<<<<<<<<<<
+ * from rapidfuzz.fuzz import WRatio, ratio             # <<<<<<<<<<<<<<
  * 
  * from libcpp cimport bool
  */
   __Pyx_TraceLine(5,0,__PYX_ERR(0, 5, __pyx_L1_error))
-  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5, __pyx_L1_error)
+  __pyx_t_3 = PyList_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_INCREF(__pyx_n_s_WRatio);
   __Pyx_GIVEREF(__pyx_n_s_WRatio);
   PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_WRatio);
+  __Pyx_INCREF(__pyx_n_s_ratio);
+  __Pyx_GIVEREF(__pyx_n_s_ratio);
+  PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_s_ratio);
   __pyx_t_2 = __Pyx_Import(__pyx_n_s_rapidfuzz_fuzz, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_WRatio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_WRatio, __pyx_t_3) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_ratio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 5, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":24
+  /* "rapidfuzz/process_cpp_impl.pyx":28
  * )
  * 
  * import heapq             # <<<<<<<<<<<<<<
  * from array import array
  * 
  */
-  __Pyx_TraceLine(24,0,__PYX_ERR(0, 24, __pyx_L1_error))
-  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_heapq, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __Pyx_TraceLine(28,0,__PYX_ERR(0, 28, __pyx_L1_error))
+  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_heapq, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 28, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_heapq, __pyx_t_2) < 0) __PYX_ERR(0, 24, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_heapq, __pyx_t_2) < 0) __PYX_ERR(0, 28, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":25
+  /* "rapidfuzz/process_cpp_impl.pyx":29
  * 
  * import heapq
  * from array import array             # <<<<<<<<<<<<<<
  * 
  * from rapidfuzz_capi cimport (
  */
-  __Pyx_TraceLine(25,0,__PYX_ERR(0, 25, __pyx_L1_error))
-  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __Pyx_TraceLine(29,0,__PYX_ERR(0, 29, __pyx_L1_error))
+  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_INCREF(__pyx_n_s_array);
   __Pyx_GIVEREF(__pyx_n_s_array);
   PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_array);
-  __pyx_t_3 = __Pyx_Import(__pyx_n_s_array, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_Import(__pyx_n_s_array, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_array); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_2) < 0) __PYX_ERR(0, 25, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_array, __pyx_t_2) < 0) __PYX_ERR(0, 29, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":87
- *     cdef T get_optimal_score[T](const RF_ScorerFlags* scorer_flags)
+  /* "rapidfuzz/process_cpp_impl.pyx":122
+ *         const vector[RF_StringWrapper]&, const vector[RF_StringWrapper]&, MatrixType, int, T) except +
  * 
  * cdef inline vector[DictStringElem] preprocess_dict(queries, processor) except *:             # <<<<<<<<<<<<<<
  *     cdef vector[DictStringElem] proc_queries
  *     cdef int64_t queries_len = <int64_t>len(queries)
  */
-  __Pyx_TraceLine(87,0,__PYX_ERR(0, 87, __pyx_L1_error))
+  __Pyx_TraceLine(122,0,__PYX_ERR(0, 122, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":139
+  /* "rapidfuzz/process_cpp_impl.pyx":174
  *     return move(proc_queries)
  * 
  * cdef inline vector[ListStringElem] preprocess_list(queries, processor) except *:             # <<<<<<<<<<<<<<
  *     cdef vector[ListStringElem] proc_queries
  *     cdef int64_t queries_len = <int64_t>len(queries)
  */
-  __Pyx_TraceLine(139,0,__PYX_ERR(0, 139, __pyx_L1_error))
+  __Pyx_TraceLine(174,0,__PYX_ERR(0, 174, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":188
+  /* "rapidfuzz/process_cpp_impl.pyx":223
  *     return move(proc_queries)
  * 
  * cdef inline extractOne_dict_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef double score
  */
-  __Pyx_TraceLine(188,0,__PYX_ERR(0, 188, __pyx_L1_error))
+  __Pyx_TraceLine(223,0,__PYX_ERR(0, 223, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":250
+  /* "rapidfuzz/process_cpp_impl.pyx":285
  * 
  * 
  * cdef inline extractOne_dict_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef int64_t score
  */
-  __Pyx_TraceLine(250,0,__PYX_ERR(0, 250, __pyx_L1_error))
+  __Pyx_TraceLine(285,0,__PYX_ERR(0, 285, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":312
+  /* "rapidfuzz/process_cpp_impl.pyx":347
  * 
  * 
  * cdef inline extractOne_dict(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
-  __Pyx_TraceLine(312,0,__PYX_ERR(0, 312, __pyx_L1_error))
+  __Pyx_TraceLine(347,0,__PYX_ERR(0, 347, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":326
+  /* "rapidfuzz/process_cpp_impl.pyx":361
  *     raise ValueError("scorer does not properly use the C-API")
  * 
  * cdef inline extractOne_list_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef double score
  */
-  __Pyx_TraceLine(326,0,__PYX_ERR(0, 326, __pyx_L1_error))
+  __Pyx_TraceLine(361,0,__PYX_ERR(0, 361, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":386
+  /* "rapidfuzz/process_cpp_impl.pyx":421
  *     return (result_choice, result_score, result_index) if result_found else None
  * 
  * cdef inline extractOne_list_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     cdef RF_String proc_str
  *     cdef int64_t score
  */
-  __Pyx_TraceLine(386,0,__PYX_ERR(0, 386, __pyx_L1_error))
+  __Pyx_TraceLine(421,0,__PYX_ERR(0, 421, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":446
+  /* "rapidfuzz/process_cpp_impl.pyx":481
  *     return (result_choice, result_score, result_index) if result_found else None
  * 
  * cdef inline extractOne_list(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
-  __Pyx_TraceLine(446,0,__PYX_ERR(0, 446, __pyx_L1_error))
+  __Pyx_TraceLine(481,0,__PYX_ERR(0, 481, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":461
+  /* "rapidfuzz/process_cpp_impl.pyx":496
  * 
  * 
  * cdef inline get_scorer_flags_py(scorer, dict kwargs):             # <<<<<<<<<<<<<<
  *     params = getattr(scorer, '_RF_ScorerPy', None)
  *     if params is not None:
  */
-  __Pyx_TraceLine(461,0,__PYX_ERR(0, 461, __pyx_L1_error))
+  __Pyx_TraceLine(496,0,__PYX_ERR(0, 496, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":468
+  /* "rapidfuzz/process_cpp_impl.pyx":503
  *     return (0, 100)
  * 
  * cdef inline py_extractOne_dict(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef bool result_found = False
  */
-  __Pyx_TraceLine(468,0,__PYX_ERR(0, 468, __pyx_L1_error))
+  __Pyx_TraceLine(503,0,__PYX_ERR(0, 503, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":507
+  /* "rapidfuzz/process_cpp_impl.pyx":542
  * 
  * 
  * cdef inline py_extractOne_list(query, choices, scorer, processor, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef bool result_found = False
  */
-  __Pyx_TraceLine(507,0,__PYX_ERR(0, 507, __pyx_L1_error))
+  __Pyx_TraceLine(542,0,__PYX_ERR(0, 542, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":547
+  /* "rapidfuzz/process_cpp_impl.pyx":582
  * 
  * 
  * def extractOne(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best match in a list of choices. When multiple elements have the same similarity,
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
-  __Pyx_TraceLine(547,0,__PYX_ERR(0, 547, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_1extractOne, 0, __pyx_n_s_extractOne, NULL, __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__3)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 547, __pyx_L1_error)
+  __Pyx_TraceLine(582,0,__PYX_ERR(0, 582, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_1extractOne, 0, __pyx_n_s_extractOne, NULL, __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__3)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 582, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults), 2)) __PYX_ERR(0, 547, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_WRatio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 547, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults), 2)) __PYX_ERR(0, 582, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_WRatio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 582, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_t_3)->__pyx_arg_scorer = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 547, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 582, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_11process_cpp_7__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_extractOne, __pyx_t_3) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_16process_cpp_impl_9__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_extractOne, __pyx_t_3) < 0) __PYX_ERR(0, 582, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":712
+  /* "rapidfuzz/process_cpp_impl.pyx":631
  * 
  * 
  * cdef inline extract_dict_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_dict(choices, processor)
  */
-  __Pyx_TraceLine(712,0,__PYX_ERR(0, 712, __pyx_L1_error))
+  __Pyx_TraceLine(631,0,__PYX_ERR(0, 631, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":740
+  /* "rapidfuzz/process_cpp_impl.pyx":659
  * 
  * 
  * cdef inline extract_dict_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_dict(choices, processor)
  */
-  __Pyx_TraceLine(740,0,__PYX_ERR(0, 740, __pyx_L1_error))
+  __Pyx_TraceLine(659,0,__PYX_ERR(0, 659, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":768
+  /* "rapidfuzz/process_cpp_impl.pyx":687
  * 
  * 
  * cdef inline extract_dict(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
-  __Pyx_TraceLine(768,0,__PYX_ERR(0, 768, __pyx_L1_error))
+  __Pyx_TraceLine(687,0,__PYX_ERR(0, 687, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":783
+  /* "rapidfuzz/process_cpp_impl.pyx":702
  * 
  * 
  * cdef inline extract_list_f64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_list(choices, processor)
  */
-  __Pyx_TraceLine(783,0,__PYX_ERR(0, 783, __pyx_L1_error))
+  __Pyx_TraceLine(702,0,__PYX_ERR(0, 702, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":811
+  /* "rapidfuzz/process_cpp_impl.pyx":730
  * 
  * 
  * cdef inline extract_list_i64(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     proc_query = move(RF_StringWrapper(conv_sequence(query)))
  *     proc_choices = preprocess_list(choices, processor)
  */
-  __Pyx_TraceLine(811,0,__PYX_ERR(0, 811, __pyx_L1_error))
+  __Pyx_TraceLine(730,0,__PYX_ERR(0, 730, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":839
+  /* "rapidfuzz/process_cpp_impl.pyx":758
  * 
  * 
  * cdef inline extract_list(query, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, int64_t limit, score_cutoff, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
  *     flags = dereference(scorer_flags).flags
  * 
  */
-  __Pyx_TraceLine(839,0,__PYX_ERR(0, 839, __pyx_L1_error))
+  __Pyx_TraceLine(758,0,__PYX_ERR(0, 758, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":854
+  /* "rapidfuzz/process_cpp_impl.pyx":773
  * 
  * 
  * cdef inline py_extract_dict(query, choices, scorer, processor, int64_t limit, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef object score = None
  */
-  __Pyx_TraceLine(854,0,__PYX_ERR(0, 854, __pyx_L1_error))
+  __Pyx_TraceLine(773,0,__PYX_ERR(0, 773, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":881
+  /* "rapidfuzz/process_cpp_impl.pyx":800
  * 
  * 
  * cdef inline py_extract_list(query, choices, scorer, processor, int64_t limit, double score_cutoff, worst_score, optimal_score, dict kwargs):             # <<<<<<<<<<<<<<
  *     cdef bool lowest_score_worst = optimal_score > worst_score
  *     cdef object score = None
  */
-  __Pyx_TraceLine(881,0,__PYX_ERR(0, 881, __pyx_L1_error))
+  __Pyx_TraceLine(800,0,__PYX_ERR(0, 800, __pyx_L1_error))
 
 
-  /* "rapidfuzz/process_cpp.pyx":909
+  /* "rapidfuzz/process_cpp_impl.pyx":828
  * 
  * 
  * def extract(query, choices, *, scorer=WRatio, processor=default_process, limit=5, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best matches in a list of choices. The list is sorted by the similarity.
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
-  __Pyx_TraceLine(909,0,__PYX_ERR(0, 909, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_3extract, 0, __pyx_n_s_extract, NULL, __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__4)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 909, __pyx_L1_error)
+  __Pyx_TraceLine(828,0,__PYX_ERR(0, 828, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_3extract, 0, __pyx_n_s_extract, NULL, __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__4)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 828, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults1), 2)) __PYX_ERR(0, 909, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_WRatio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 909, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults1), 2)) __PYX_ERR(0, 828, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_WRatio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 828, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_t_3)->__pyx_arg_scorer = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 909, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 828, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_11process_cpp_9__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_extract, __pyx_t_3) < 0) __PYX_ERR(0, 909, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_16process_cpp_impl_11__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_extract, __pyx_t_3) < 0) __PYX_ERR(0, 828, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1018
+  /* "rapidfuzz/process_cpp_impl.pyx":878
  * 
  * 
  * def extract_iter(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):             # <<<<<<<<<<<<<<
- *     """
- *     Find the best match in a list of choices
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
  */
-  __Pyx_TraceLine(1018,0,__PYX_ERR(0, 1018, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_11process_cpp_5extract_iter, 0, __pyx_n_s_extract_iter, NULL, __pyx_n_s_rapidfuzz_process_cpp, __pyx_d, ((PyObject *)__pyx_codeobj__5)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __Pyx_TraceLine(878,0,__PYX_ERR(0, 878, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_5extract_iter, 0, __pyx_n_s_extract_iter, NULL, __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__5)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 878, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults2), 2)) __PYX_ERR(0, 1018, __pyx_L1_error)
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_WRatio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults2), 2)) __PYX_ERR(0, 878, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_WRatio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 878, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_t_3)->__pyx_arg_scorer = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_default_process); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 878, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_t_3)->__pyx_arg_processor = __pyx_t_2;
   __Pyx_GIVEREF(__pyx_t_2);
   __pyx_t_2 = 0;
-  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_11process_cpp_11__defaults__);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_extract_iter, __pyx_t_3) < 0) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_16process_cpp_impl_13__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_extract_iter, __pyx_t_3) < 0) __PYX_ERR(0, 878, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1158
+ * 
+ * 
+ * FLOAT32 = MatrixType.FLOAT32             # <<<<<<<<<<<<<<
+ * FLOAT64 = MatrixType.FLOAT64
+ * INT8 = MatrixType.INT8
+ */
+  __Pyx_TraceLine(1158,0,__PYX_ERR(0, 1158, __pyx_L1_error))
+  __pyx_t_3 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(MatrixType::FLOAT32); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1158, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FLOAT32, __pyx_t_3) < 0) __PYX_ERR(0, 1158, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1159
+ * 
+ * FLOAT32 = MatrixType.FLOAT32
+ * FLOAT64 = MatrixType.FLOAT64             # <<<<<<<<<<<<<<
+ * INT8 = MatrixType.INT8
+ * INT16 = MatrixType.INT16
+ */
+  __Pyx_TraceLine(1159,0,__PYX_ERR(0, 1159, __pyx_L1_error))
+  __pyx_t_3 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(MatrixType::FLOAT64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1159, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_FLOAT64, __pyx_t_3) < 0) __PYX_ERR(0, 1159, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1160
+ * FLOAT32 = MatrixType.FLOAT32
+ * FLOAT64 = MatrixType.FLOAT64
+ * INT8 = MatrixType.INT8             # <<<<<<<<<<<<<<
+ * INT16 = MatrixType.INT16
+ * INT32 = MatrixType.INT32
+ */
+  __Pyx_TraceLine(1160,0,__PYX_ERR(0, 1160, __pyx_L1_error))
+  __pyx_t_3 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(MatrixType::INT8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1160, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_INT8, __pyx_t_3) < 0) __PYX_ERR(0, 1160, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1161
+ * FLOAT64 = MatrixType.FLOAT64
+ * INT8 = MatrixType.INT8
+ * INT16 = MatrixType.INT16             # <<<<<<<<<<<<<<
+ * INT32 = MatrixType.INT32
+ * INT64 = MatrixType.INT64
+ */
+  __Pyx_TraceLine(1161,0,__PYX_ERR(0, 1161, __pyx_L1_error))
+  __pyx_t_3 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(MatrixType::INT16); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1161, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_INT16, __pyx_t_3) < 0) __PYX_ERR(0, 1161, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1162
+ * INT8 = MatrixType.INT8
+ * INT16 = MatrixType.INT16
+ * INT32 = MatrixType.INT32             # <<<<<<<<<<<<<<
+ * INT64 = MatrixType.INT64
+ * UINT8 = MatrixType.UINT8
+ */
+  __Pyx_TraceLine(1162,0,__PYX_ERR(0, 1162, __pyx_L1_error))
+  __pyx_t_3 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(MatrixType::INT32); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1162, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_INT32, __pyx_t_3) < 0) __PYX_ERR(0, 1162, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1163
+ * INT16 = MatrixType.INT16
+ * INT32 = MatrixType.INT32
+ * INT64 = MatrixType.INT64             # <<<<<<<<<<<<<<
+ * UINT8 = MatrixType.UINT8
+ * UINT16 = MatrixType.UINT16
+ */
+  __Pyx_TraceLine(1163,0,__PYX_ERR(0, 1163, __pyx_L1_error))
+  __pyx_t_3 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(MatrixType::INT64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1163, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_INT64, __pyx_t_3) < 0) __PYX_ERR(0, 1163, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1164
+ * INT32 = MatrixType.INT32
+ * INT64 = MatrixType.INT64
+ * UINT8 = MatrixType.UINT8             # <<<<<<<<<<<<<<
+ * UINT16 = MatrixType.UINT16
+ * UINT32 = MatrixType.UINT32
+ */
+  __Pyx_TraceLine(1164,0,__PYX_ERR(0, 1164, __pyx_L1_error))
+  __pyx_t_3 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(MatrixType::UINT8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1164, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_UINT8, __pyx_t_3) < 0) __PYX_ERR(0, 1164, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1165
+ * INT64 = MatrixType.INT64
+ * UINT8 = MatrixType.UINT8
+ * UINT16 = MatrixType.UINT16             # <<<<<<<<<<<<<<
+ * UINT32 = MatrixType.UINT32
+ * UINT64 = MatrixType.UINT64
+ */
+  __Pyx_TraceLine(1165,0,__PYX_ERR(0, 1165, __pyx_L1_error))
+  __pyx_t_3 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(MatrixType::UINT16); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1165, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_UINT16, __pyx_t_3) < 0) __PYX_ERR(0, 1165, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1166
+ * UINT8 = MatrixType.UINT8
+ * UINT16 = MatrixType.UINT16
+ * UINT32 = MatrixType.UINT32             # <<<<<<<<<<<<<<
+ * UINT64 = MatrixType.UINT64
+ * 
+ */
+  __Pyx_TraceLine(1166,0,__PYX_ERR(0, 1166, __pyx_L1_error))
+  __pyx_t_3 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(MatrixType::UINT32); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1166, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_UINT32, __pyx_t_3) < 0) __PYX_ERR(0, 1166, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1167
+ * UINT16 = MatrixType.UINT16
+ * UINT32 = MatrixType.UINT32
+ * UINT64 = MatrixType.UINT64             # <<<<<<<<<<<<<<
+ * 
+ * cdef inline vector[PyObjectWrapper] preprocess_py(queries, processor) except *:
+ */
+  __Pyx_TraceLine(1167,0,__PYX_ERR(0, 1167, __pyx_L1_error))
+  __pyx_t_3 = [](const MatrixType& x){return __Pyx_PyInt_From_int((int)x);}(MatrixType::UINT64); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1167, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_UINT64, __pyx_t_3) < 0) __PYX_ERR(0, 1167, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1169
+ * UINT64 = MatrixType.UINT64
+ * 
+ * cdef inline vector[PyObjectWrapper] preprocess_py(queries, processor) except *:             # <<<<<<<<<<<<<<
+ *     cdef vector[PyObjectWrapper] proc_queries
+ *     cdef int64_t queries_len = <int64_t>len(queries)
+ */
+  __Pyx_TraceLine(1169,0,__PYX_ERR(0, 1169, __pyx_L1_error))
+
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1186
+ *     return move(proc_queries)
+ * 
+ * cdef inline vector[RF_StringWrapper] preprocess(queries, processor) except *:             # <<<<<<<<<<<<<<
+ *     cdef vector[RF_StringWrapper] proc_queries
+ *     cdef int64_t queries_len = <int64_t>len(queries)
+ */
+  __Pyx_TraceLine(1186,0,__PYX_ERR(0, 1186, __pyx_L1_error))
+
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1216
+ *     return move(proc_queries)
+ * 
+ * cdef inline MatrixType dtype_to_type_num_f64(dtype) except MatrixType.UNDEFINED:             # <<<<<<<<<<<<<<
+ *     if dtype is None:
+ *         return MatrixType.FLOAT32
+ */
+  __Pyx_TraceLine(1216,0,__PYX_ERR(0, 1216, __pyx_L1_error))
+
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1221
+ *     return <MatrixType>dtype
+ * 
+ * cdef inline MatrixType dtype_to_type_num_i64(dtype) except MatrixType.UNDEFINED:             # <<<<<<<<<<<<<<
+ *     if dtype is None:
+ *         return MatrixType.INT32
+ */
+  __Pyx_TraceLine(1221,0,__PYX_ERR(0, 1221, __pyx_L1_error))
+
+
+  /* "(tree fragment)":1
+ * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ * def __setstate_cython__(self, __pyx_state):
+ */
+  __Pyx_TraceLine(1,0,__PYX_ERR(1, 1, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_6Matrix_5__reduce_cython__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Matrix___reduce_cython, NULL, __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__16)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_reduce_cython, __pyx_t_3) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "(tree fragment)":3
+ * def __reduce_cython__(self):
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
+ *     raise TypeError, "self.matrix cannot be converted to a Python object for pickling"
+ */
+  __Pyx_TraceLine(3,0,__PYX_ERR(1, 3, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_6Matrix_7__setstate_cython__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Matrix___setstate_cython, NULL, __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__17)); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 3, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_setstate_cython, __pyx_t_3) < 0) __PYX_ERR(1, 3, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1255
+ *         pass
+ * 
+ * cdef cdist_two_lists(queries, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
+ *     proc_queries = preprocess(queries, processor)
+ *     proc_choices = preprocess(choices, processor)
+ */
+  __Pyx_TraceLine(1255,0,__PYX_ERR(0, 1255, __pyx_L1_error))
+
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1279
+ *     return matrix
+ * 
+ * cdef Matrix cdist_single_list(queries, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):             # <<<<<<<<<<<<<<
+ *     proc_queries = preprocess(queries, processor)
+ *     flags = dereference(scorer_flags).flags
+ */
+  __Pyx_TraceLine(1279,0,__PYX_ERR(0, 1279, __pyx_L1_error))
+
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1305
+ * @cython.boundscheck(False)
+ * @cython.wraparound(False)
+ * cdef cdist_py(queries, choices, scorer, processor, score_cutoff, dtype, workers, dict kwargs):             # <<<<<<<<<<<<<<
+ *     proc_queries = preprocess_py(queries, processor)
+ *     proc_choices = preprocess_py(choices, processor)
+ */
+  __Pyx_TraceLine(1305,0,__PYX_ERR(0, 1305, __pyx_L1_error))
+
+
+  /* "rapidfuzz/process_cpp_impl.pyx":1324
+ * 
+ * 
+ * def cdist(queries, choices, *, scorer=ratio, processor=None, score_cutoff=None, dtype=None, workers=1, **kwargs):             # <<<<<<<<<<<<<<
+ *     cdef RF_Scorer* scorer_context = NULL
+ *     cdef RF_ScorerFlags scorer_flags
+ */
+  __Pyx_TraceLine(1324,0,__PYX_ERR(0, 1324, __pyx_L1_error))
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_9rapidfuzz_16process_cpp_impl_8cdist, 0, __pyx_n_s_cdist, NULL, __pyx_n_s_rapidfuzz_process_cpp_impl, __pyx_d, ((PyObject *)__pyx_codeobj__18)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1324, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults3), 1)) __PYX_ERR(0, 1324, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_ratio); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1324, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_t_3)->__pyx_arg_scorer = __pyx_t_2;
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_9rapidfuzz_16process_cpp_impl_15__defaults__);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_cdist, __pyx_t_3) < 0) __PYX_ERR(0, 1324, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "rapidfuzz/process_cpp.pyx":1
+  /* "rapidfuzz/process_cpp_impl.pyx":1
  * # distutils: language=c++             # <<<<<<<<<<<<<<
  * # cython: language_level=3, binding=True, linetrace=True
  * 
  */
   __Pyx_TraceLine(1,0,__PYX_ERR(0, 1, __pyx_L1_error))
-  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_t_3, __pyx_kp_u_extractOne_line_547, __pyx_kp_u_Find_the_best_match_in_a_list_o) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_3) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
   /* "cpp_common.pxd":242
  *     void validate_string(object py_str, const char* err) except +
  * 
  * cdef inline RF_String hash_array(arr) except *:             # <<<<<<<<<<<<<<
  *     # TODO on Cpython this does not require any copies
  *     cdef RF_String s_proc
  */
-  __Pyx_TraceLine(242,0,__PYX_ERR(1, 242, __pyx_L1_error))
+  __Pyx_TraceLine(242,0,__PYX_ERR(3, 242, __pyx_L1_error))
 
 
   /* "cpp_common.pxd":292
  * 
  * 
  * cdef inline RF_String hash_sequence(seq) except *:             # <<<<<<<<<<<<<<
  *     cdef RF_String s_proc
  *     s_proc.length = <int64_t>len(seq)
  */
-  __Pyx_TraceLine(292,0,__PYX_ERR(1, 292, __pyx_L1_error))
+  __Pyx_TraceLine(292,0,__PYX_ERR(3, 292, __pyx_L1_error))
 
 
   /* "cpp_common.pxd":320
  *     return s_proc
  * 
  * cdef inline RF_String conv_sequence(seq) except *:             # <<<<<<<<<<<<<<
  *     if is_valid_string(seq):
  *         return move(convert_string(seq))
  */
-  __Pyx_TraceLine(320,0,__PYX_ERR(1, 320, __pyx_L1_error))
+  __Pyx_TraceLine(320,0,__PYX_ERR(3, 320, __pyx_L1_error))
 
 
   /* "cpp_common.pxd":328
  *         return move(hash_sequence(seq))
  * 
  * cdef inline double get_score_cutoff_f64(score_cutoff, const RF_ScorerFlags* scorer_flags) except *:             # <<<<<<<<<<<<<<
  *     worst_score = dereference(scorer_flags).worst_score.f64
  *     optimal_score = dereference(scorer_flags).optimal_score.f64
  */
-  __Pyx_TraceLine(328,0,__PYX_ERR(1, 328, __pyx_L1_error))
+  __Pyx_TraceLine(328,0,__PYX_ERR(3, 328, __pyx_L1_error))
 
 
   /* "cpp_common.pxd":346
  *     return c_score_cutoff
  * 
  * cdef inline int64_t get_score_cutoff_i64(score_cutoff, const RF_ScorerFlags* scorer_flags) except *:             # <<<<<<<<<<<<<<
  *     worst_score = dereference(scorer_flags).worst_score.i64
  *     optimal_score = dereference(scorer_flags).optimal_score.i64
  */
-  __Pyx_TraceLine(346,0,__PYX_ERR(1, 346, __pyx_L1_error))
+  __Pyx_TraceLine(346,0,__PYX_ERR(3, 346, __pyx_L1_error))
 
 
   /* "cpp_common.pxd":364
  *     return c_score_cutoff
  * 
  * cdef inline void preprocess_strings(s1, s2, processor, RF_StringWrapper* s1_proc, RF_StringWrapper* s2_proc, object default) except *:             # <<<<<<<<<<<<<<
  *     cdef RF_Preprocessor* preprocess_context = NULL
  * 
  */
-  __Pyx_TraceLine(364,0,__PYX_ERR(1, 364, __pyx_L1_error))
+  __Pyx_TraceLine(364,0,__PYX_ERR(3, 364, __pyx_L1_error))
 
 
   /* "cpp_common.pxd":388
  *             s2_proc[0] = RF_StringWrapper(conv_sequence(s2), s2)
  * 
  * cdef inline bool NoKwargsInit(RF_Kwargs* self, dict kwargs) except False:             # <<<<<<<<<<<<<<
  *     if len(kwargs):
  *         raise TypeError("Got unexpected keyword arguments: ", ", ".join(kwargs.keys()))
  */
-  __Pyx_TraceLine(388,0,__PYX_ERR(1, 388, __pyx_L1_error))
+  __Pyx_TraceLine(388,0,__PYX_ERR(3, 388, __pyx_L1_error))
 
 
   /* "cpp_common.pxd":396
  *     return True
  * 
  * cdef inline RF_Scorer CreateScorerContext(RF_KwargsInit kwargs_init, RF_GetScorerFlags get_scorer_flags, RF_ScorerFuncInit scorer_func_init):             # <<<<<<<<<<<<<<
  *     cdef RF_Scorer context
  *     context.version = SCORER_STRUCT_VERSION
  */
-  __Pyx_TraceLine(396,0,__PYX_ERR(1, 396, __pyx_L1_error))
+  __Pyx_TraceLine(396,0,__PYX_ERR(3, 396, __pyx_L1_error))
 
 
   /* "cpp_common.pxd":404
  *     return context
  * 
  * cdef inline dict CreateScorerContextPy(get_scorer_flags):             # <<<<<<<<<<<<<<
  *     return {"get_scorer_flags": get_scorer_flags}
  * 
  */
-  __Pyx_TraceLine(404,0,__PYX_ERR(1, 404, __pyx_L1_error))
+  __Pyx_TraceLine(404,0,__PYX_ERR(3, 404, __pyx_L1_error))
 
 
   /* "cpp_common.pxd":407
  *     return {"get_scorer_flags": get_scorer_flags}
  * 
  * cdef inline bool AddScorerContext(func, py_context, RF_Scorer* c_context) except False:             # <<<<<<<<<<<<<<
  *     func._RF_Scorer = PyCapsule_New(c_context, NULL, NULL)
  *     func._RF_ScorerPy = py_context
  */
-  __Pyx_TraceLine(407,0,__PYX_ERR(1, 407, __pyx_L1_error))
+  __Pyx_TraceLine(407,0,__PYX_ERR(3, 407, __pyx_L1_error))
+
+
+  /* "EnumBase":9
+ * 
+ * cdef object __Pyx_OrderedDict
+ * from collections import OrderedDict as __Pyx_OrderedDict             # <<<<<<<<<<<<<<
+ * 
+ * @cython.internal
+ */
+  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 9, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_INCREF(__pyx_n_s_OrderedDict);
+  __Pyx_GIVEREF(__pyx_n_s_OrderedDict);
+  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_OrderedDict);
+  __pyx_t_2 = __Pyx_Import(__pyx_n_s_collections, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 9, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_OrderedDict); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 9, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_INCREF(__pyx_t_3);
+  __Pyx_XGOTREF(__Pyx_OrderedDict);
+  __Pyx_DECREF_SET(__Pyx_OrderedDict, __pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "(tree fragment)":1
+ * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
+ *     cdef tuple state
+ *     cdef object _dict
+ */
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumMeta_7__reduce_cython__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Pyx_EnumMeta___reduce_cython, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__31)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem((PyObject *)__pyx_ptype___Pyx_EnumMeta->tp_dict, __pyx_n_s_reduce_cython, __pyx_t_2) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  PyType_Modified(__pyx_ptype___Pyx_EnumMeta);
+
+  /* "(tree fragment)":16
+ *     else:
+ *         return __pyx_unpickle___Pyx_EnumMeta, (type(self), 0xe3b0c44, state)
+ * def __setstate_cython__(self, __pyx_state):             # <<<<<<<<<<<<<<
+ *     __pyx_unpickle___Pyx_EnumMeta__set_state(self, __pyx_state)
+ */
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumMeta_9__setstate_cython__, __Pyx_CYFUNCTION_CCLASS, __pyx_n_s_Pyx_EnumMeta___setstate_cython, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 16, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem((PyObject *)__pyx_ptype___Pyx_EnumMeta->tp_dict, __pyx_n_s_setstate_cython, __pyx_t_2) < 0) __PYX_ERR(1, 16, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  PyType_Modified(__pyx_ptype___Pyx_EnumMeta);
+
+  /* "EnumBase":23
+ * 
+ * cdef object __Pyx_EnumBase
+ * class __Pyx_EnumBase(int, metaclass=__Pyx_EnumMeta):             # <<<<<<<<<<<<<<
+ *     def __new__(cls, value, name=None):
+ *         for v in cls:
+ */
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 23, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_INCREF((PyObject *)(&PyInt_Type));
+  __Pyx_GIVEREF((PyObject *)(&PyInt_Type));
+  PyTuple_SET_ITEM(__pyx_t_2, 0, ((PyObject *)(&PyInt_Type)));
+  __pyx_t_3 = __Pyx_PEP560_update_bases(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 23, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 23, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_5 = __Pyx_Py3MetaclassPrepare(((PyObject *)__pyx_ptype___Pyx_EnumMeta), __pyx_t_3, __pyx_n_s_Pyx_EnumBase, __pyx_n_s_Pyx_EnumBase, __pyx_t_4, __pyx_n_s_EnumBase, (PyObject *) NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 23, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  if (__pyx_t_3 != __pyx_t_2) {
+    if (unlikely((PyDict_SetItemString(__pyx_t_5, "__orig_bases__", __pyx_t_2) < 0))) __PYX_ERR(1, 23, __pyx_L1_error)
+  }
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "EnumBase":24
+ * cdef object __Pyx_EnumBase
+ * class __Pyx_EnumBase(int, metaclass=__Pyx_EnumMeta):
+ *     def __new__(cls, value, name=None):             # <<<<<<<<<<<<<<
+ *         for v in cls:
+ *             if v == value:
+ */
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumBase_1__new__, __Pyx_CYFUNCTION_STATICMETHOD, __pyx_n_s_Pyx_EnumBase___new, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__34)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 24, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__35);
+  if (__Pyx_SetNewInClass(__pyx_t_5, __pyx_n_s_new, __pyx_t_2) < 0) __PYX_ERR(1, 24, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "EnumBase":35
+ *         cls.__members__[name] = res
+ *         return res
+ *     def __repr__(self):             # <<<<<<<<<<<<<<
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
+ *     def __str__(self):
+ */
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumBase_3__repr__, 0, __pyx_n_s_Pyx_EnumBase___repr, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__36)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 35, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_SetNameInClass(__pyx_t_5, __pyx_n_s_repr, __pyx_t_2) < 0) __PYX_ERR(1, 35, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "EnumBase":37
+ *     def __repr__(self):
+ *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
+ *     def __str__(self):             # <<<<<<<<<<<<<<
+ *         return "%s.%s" % (self.__class__.__name__, self.name)
+ * 
+ */
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumBase_5__str__, 0, __pyx_n_s_Pyx_EnumBase___str, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 37, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (__Pyx_SetNameInClass(__pyx_t_5, __pyx_n_s_str, __pyx_t_2) < 0) __PYX_ERR(1, 37, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "EnumBase":23
+ * 
+ * cdef object __Pyx_EnumBase
+ * class __Pyx_EnumBase(int, metaclass=__Pyx_EnumMeta):             # <<<<<<<<<<<<<<
+ *     def __new__(cls, value, name=None):
+ *         for v in cls:
+ */
+  __pyx_t_2 = __Pyx_Py3ClassCreate(((PyObject *)__pyx_ptype___Pyx_EnumMeta), __pyx_n_s_Pyx_EnumBase, __pyx_t_3, __pyx_t_5, __pyx_t_4, 1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 23, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_XGOTREF(__Pyx_EnumBase);
+  __Pyx_DECREF_SET(__Pyx_EnumBase, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_2);
+  __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "EnumBase":40
+ *         return "%s.%s" % (self.__class__.__name__, self.name)
+ * 
+ * if PY_VERSION_HEX >= 0x03040000:             # <<<<<<<<<<<<<<
+ *     from enum import IntEnum as __Pyx_EnumBase
+ * 
+ */
+  __pyx_t_6 = (PY_VERSION_HEX >= 0x03040000);
+  if (__pyx_t_6) {
+
+    /* "EnumBase":41
+ * 
+ * if PY_VERSION_HEX >= 0x03040000:
+ *     from enum import IntEnum as __Pyx_EnumBase             # <<<<<<<<<<<<<<
+ * 
+ */
+    __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 41, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_INCREF(__pyx_n_s_IntEnum);
+    __Pyx_GIVEREF(__pyx_n_s_IntEnum);
+    PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_IntEnum);
+    __pyx_t_4 = __Pyx_Import(__pyx_n_s_enum, __pyx_t_3, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 41, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_4, __pyx_n_s_IntEnum); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 41, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_INCREF(__pyx_t_3);
+    __Pyx_XGOTREF(__Pyx_EnumBase);
+    __Pyx_DECREF_SET(__Pyx_EnumBase, __pyx_t_3);
+    __Pyx_GIVEREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "EnumBase":40
+ *         return "%s.%s" % (self.__class__.__name__, self.name)
+ * 
+ * if PY_VERSION_HEX >= 0x03040000:             # <<<<<<<<<<<<<<
+ *     from enum import IntEnum as __Pyx_EnumBase
+ * 
+ */
+  }
+
+  /* "(tree fragment)":1
+ * def __pyx_unpickle___Pyx_EnumMeta(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
+ *     cdef object __pyx_PickleError
+ *     cdef object __pyx_result
+ */
+  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_1__pyx_unpickle___Pyx_EnumMeta, 0, __pyx_n_s_pyx_unpickle___Pyx_EnumMeta, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__39)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pyx_unpickle___Pyx_EnumMeta, __pyx_t_4) < 0) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+  /* "CppScopedEnumType":70
+ * 
+ * 
+ * cdef dict __Pyx_globals = globals()             # <<<<<<<<<<<<<<
+ * 
+ * if PY_VERSION_HEX >= 0x03040000:
+ */
+  __pyx_t_4 = __Pyx_Globals(); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 70, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  if (!(likely(PyDict_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None) || __Pyx_RaiseUnexpectedTypeError("dict", __pyx_t_4))) __PYX_ERR(1, 70, __pyx_L1_error)
+  __Pyx_XGOTREF(__Pyx_globals);
+  __Pyx_DECREF_SET(__Pyx_globals, ((PyObject*)__pyx_t_4));
+  __Pyx_GIVEREF(__pyx_t_4);
+  __pyx_t_4 = 0;
+
+  /* "CppScopedEnumType":72
+ * cdef dict __Pyx_globals = globals()
+ * 
+ * if PY_VERSION_HEX >= 0x03040000:             # <<<<<<<<<<<<<<
+ * 
+ *     __Pyx_globals["MatrixType"] = __Pyx_EnumBase('MatrixType', __Pyx_OrderedDict([
+ */
+  __pyx_t_6 = (PY_VERSION_HEX >= 0x03040000);
+  if (__pyx_t_6) {
+
+    /* "CppScopedEnumType":75
+ * 
+ *     __Pyx_globals["MatrixType"] = __Pyx_EnumBase('MatrixType', __Pyx_OrderedDict([
+ *         ('UNDEFINED', <int>(MatrixType.UNDEFINED)),             # <<<<<<<<<<<<<<
+ *         ('FLOAT32', <int>(MatrixType.FLOAT32)),
+ *         ('FLOAT64', <int>(MatrixType.FLOAT64)),
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::UNDEFINED)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 75, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(1, 75, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_INCREF(__pyx_n_s_UNDEFINED);
+    __Pyx_GIVEREF(__pyx_n_s_UNDEFINED);
+    PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_UNDEFINED);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":76
+ *     __Pyx_globals["MatrixType"] = __Pyx_EnumBase('MatrixType', __Pyx_OrderedDict([
+ *         ('UNDEFINED', <int>(MatrixType.UNDEFINED)),
+ *         ('FLOAT32', <int>(MatrixType.FLOAT32)),             # <<<<<<<<<<<<<<
+ *         ('FLOAT64', <int>(MatrixType.FLOAT64)),
+ *         ('INT8', <int>(MatrixType.INT8)),
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::FLOAT32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 76, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 76, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_INCREF(__pyx_n_s_FLOAT32);
+    __Pyx_GIVEREF(__pyx_n_s_FLOAT32);
+    PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_n_s_FLOAT32);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":77
+ *         ('UNDEFINED', <int>(MatrixType.UNDEFINED)),
+ *         ('FLOAT32', <int>(MatrixType.FLOAT32)),
+ *         ('FLOAT64', <int>(MatrixType.FLOAT64)),             # <<<<<<<<<<<<<<
+ *         ('INT8', <int>(MatrixType.INT8)),
+ *         ('INT16', <int>(MatrixType.INT16)),
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::FLOAT64)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 77, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(1, 77, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_INCREF(__pyx_n_s_FLOAT64);
+    __Pyx_GIVEREF(__pyx_n_s_FLOAT64);
+    PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_FLOAT64);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":78
+ *         ('FLOAT32', <int>(MatrixType.FLOAT32)),
+ *         ('FLOAT64', <int>(MatrixType.FLOAT64)),
+ *         ('INT8', <int>(MatrixType.INT8)),             # <<<<<<<<<<<<<<
+ *         ('INT16', <int>(MatrixType.INT16)),
+ *         ('INT32', <int>(MatrixType.INT32)),
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::INT8)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 78, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(1, 78, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __Pyx_INCREF(__pyx_n_s_INT8);
+    __Pyx_GIVEREF(__pyx_n_s_INT8);
+    PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_n_s_INT8);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":79
+ *         ('FLOAT64', <int>(MatrixType.FLOAT64)),
+ *         ('INT8', <int>(MatrixType.INT8)),
+ *         ('INT16', <int>(MatrixType.INT16)),             # <<<<<<<<<<<<<<
+ *         ('INT32', <int>(MatrixType.INT32)),
+ *         ('INT64', <int>(MatrixType.INT64)),
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::INT16)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 79, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 79, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_8);
+    __Pyx_INCREF(__pyx_n_s_INT16);
+    __Pyx_GIVEREF(__pyx_n_s_INT16);
+    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_n_s_INT16);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":80
+ *         ('INT8', <int>(MatrixType.INT8)),
+ *         ('INT16', <int>(MatrixType.INT16)),
+ *         ('INT32', <int>(MatrixType.INT32)),             # <<<<<<<<<<<<<<
+ *         ('INT64', <int>(MatrixType.INT64)),
+ *         ('UINT8', <int>(MatrixType.UINT8)),
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::INT32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 80, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(1, 80, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_9);
+    __Pyx_INCREF(__pyx_n_s_INT32);
+    __Pyx_GIVEREF(__pyx_n_s_INT32);
+    PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_n_s_INT32);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":81
+ *         ('INT16', <int>(MatrixType.INT16)),
+ *         ('INT32', <int>(MatrixType.INT32)),
+ *         ('INT64', <int>(MatrixType.INT64)),             # <<<<<<<<<<<<<<
+ *         ('UINT8', <int>(MatrixType.UINT8)),
+ *         ('UINT16', <int>(MatrixType.UINT16)),
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::INT64)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 81, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(1, 81, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_10);
+    __Pyx_INCREF(__pyx_n_s_INT64);
+    __Pyx_GIVEREF(__pyx_n_s_INT64);
+    PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_n_s_INT64);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":82
+ *         ('INT32', <int>(MatrixType.INT32)),
+ *         ('INT64', <int>(MatrixType.INT64)),
+ *         ('UINT8', <int>(MatrixType.UINT8)),             # <<<<<<<<<<<<<<
+ *         ('UINT16', <int>(MatrixType.UINT16)),
+ *         ('UINT32', <int>(MatrixType.UINT32)),
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::UINT8)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 82, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(1, 82, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_11);
+    __Pyx_INCREF(__pyx_n_s_UINT8);
+    __Pyx_GIVEREF(__pyx_n_s_UINT8);
+    PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_n_s_UINT8);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":83
+ *         ('INT64', <int>(MatrixType.INT64)),
+ *         ('UINT8', <int>(MatrixType.UINT8)),
+ *         ('UINT16', <int>(MatrixType.UINT16)),             # <<<<<<<<<<<<<<
+ *         ('UINT32', <int>(MatrixType.UINT32)),
+ *         ('UINT64', <int>(MatrixType.UINT64)),
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::UINT16)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 83, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_12 = PyTuple_New(2); if (unlikely(!__pyx_t_12)) __PYX_ERR(1, 83, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_12);
+    __Pyx_INCREF(__pyx_n_s_UINT16);
+    __Pyx_GIVEREF(__pyx_n_s_UINT16);
+    PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_n_s_UINT16);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":84
+ *         ('UINT8', <int>(MatrixType.UINT8)),
+ *         ('UINT16', <int>(MatrixType.UINT16)),
+ *         ('UINT32', <int>(MatrixType.UINT32)),             # <<<<<<<<<<<<<<
+ *         ('UINT64', <int>(MatrixType.UINT64)),
+ *     ]))
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::UINT32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 84, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 84, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_INCREF(__pyx_n_s_UINT32);
+    __Pyx_GIVEREF(__pyx_n_s_UINT32);
+    PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_n_s_UINT32);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":85
+ *         ('UINT16', <int>(MatrixType.UINT16)),
+ *         ('UINT32', <int>(MatrixType.UINT32)),
+ *         ('UINT64', <int>(MatrixType.UINT64)),             # <<<<<<<<<<<<<<
+ *     ]))
+ * 
+ */
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::UINT64)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 85, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 85, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_INCREF(__pyx_n_s_UINT64);
+    __Pyx_GIVEREF(__pyx_n_s_UINT64);
+    PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_n_s_UINT64);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_t_4);
+    __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":74
+ * if PY_VERSION_HEX >= 0x03040000:
+ * 
+ *     __Pyx_globals["MatrixType"] = __Pyx_EnumBase('MatrixType', __Pyx_OrderedDict([             # <<<<<<<<<<<<<<
+ *         ('UNDEFINED', <int>(MatrixType.UNDEFINED)),
+ *         ('FLOAT32', <int>(MatrixType.FLOAT32)),
+ */
+    __pyx_t_4 = PyList_New(11); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 74, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_3);
+    PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_3);
+    __Pyx_GIVEREF(__pyx_t_5);
+    PyList_SET_ITEM(__pyx_t_4, 1, __pyx_t_5);
+    __Pyx_GIVEREF(__pyx_t_2);
+    PyList_SET_ITEM(__pyx_t_4, 2, __pyx_t_2);
+    __Pyx_GIVEREF(__pyx_t_7);
+    PyList_SET_ITEM(__pyx_t_4, 3, __pyx_t_7);
+    __Pyx_GIVEREF(__pyx_t_8);
+    PyList_SET_ITEM(__pyx_t_4, 4, __pyx_t_8);
+    __Pyx_GIVEREF(__pyx_t_9);
+    PyList_SET_ITEM(__pyx_t_4, 5, __pyx_t_9);
+    __Pyx_GIVEREF(__pyx_t_10);
+    PyList_SET_ITEM(__pyx_t_4, 6, __pyx_t_10);
+    __Pyx_GIVEREF(__pyx_t_11);
+    PyList_SET_ITEM(__pyx_t_4, 7, __pyx_t_11);
+    __Pyx_GIVEREF(__pyx_t_12);
+    PyList_SET_ITEM(__pyx_t_4, 8, __pyx_t_12);
+    __Pyx_GIVEREF(__pyx_t_13);
+    PyList_SET_ITEM(__pyx_t_4, 9, __pyx_t_13);
+    __Pyx_GIVEREF(__pyx_t_14);
+    PyList_SET_ITEM(__pyx_t_4, 10, __pyx_t_14);
+    __pyx_t_3 = 0;
+    __pyx_t_5 = 0;
+    __pyx_t_2 = 0;
+    __pyx_t_7 = 0;
+    __pyx_t_8 = 0;
+    __pyx_t_9 = 0;
+    __pyx_t_10 = 0;
+    __pyx_t_11 = 0;
+    __pyx_t_12 = 0;
+    __pyx_t_13 = 0;
+    __pyx_t_14 = 0;
+    __pyx_t_14 = __Pyx_PyObject_CallOneArg(__Pyx_OrderedDict, __pyx_t_4); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 74, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 74, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_INCREF(__pyx_n_s_MatrixType);
+    __Pyx_GIVEREF(__pyx_n_s_MatrixType);
+    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_n_s_MatrixType);
+    __Pyx_GIVEREF(__pyx_t_14);
+    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_14);
+    __pyx_t_14 = 0;
+    __pyx_t_14 = __Pyx_PyObject_Call(__Pyx_EnumBase, __pyx_t_4, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 74, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 74, __pyx_L1_error)
+    }
+    if (unlikely((PyDict_SetItem(__Pyx_globals, __pyx_n_s_MatrixType, __pyx_t_14) < 0))) __PYX_ERR(1, 74, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+
+    /* "CppScopedEnumType":72
+ * cdef dict __Pyx_globals = globals()
+ * 
+ * if PY_VERSION_HEX >= 0x03040000:             # <<<<<<<<<<<<<<
+ * 
+ *     __Pyx_globals["MatrixType"] = __Pyx_EnumBase('MatrixType', __Pyx_OrderedDict([
+ */
+    goto __pyx_L3;
+  }
+
+  /* "CppScopedEnumType":89
+ * 
+ * else:
+ *     __Pyx_globals["MatrixType"] = type('MatrixType', (__Pyx_EnumBase,), {})             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UNDEFINED), 'UNDEFINED')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.FLOAT32), 'FLOAT32')
+ */
+  /*else*/ {
+    __pyx_t_14 = PyTuple_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 89, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_INCREF(__Pyx_EnumBase);
+    __Pyx_GIVEREF(__Pyx_EnumBase);
+    PyTuple_SET_ITEM(__pyx_t_14, 0, __Pyx_EnumBase);
+    __pyx_t_4 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 89, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = PyTuple_New(3); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 89, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_INCREF(__pyx_n_s_MatrixType);
+    __Pyx_GIVEREF(__pyx_n_s_MatrixType);
+    PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_n_s_MatrixType);
+    __Pyx_GIVEREF(__pyx_t_14);
+    PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_t_14);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_13, 2, __pyx_t_4);
+    __pyx_t_14 = 0;
+    __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyObject_Call(((PyObject *)(&PyType_Type)), __pyx_t_13, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 89, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 89, __pyx_L1_error)
+    }
+    if (unlikely((PyDict_SetItem(__Pyx_globals, __pyx_n_s_MatrixType, __pyx_t_4) < 0))) __PYX_ERR(1, 89, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":90
+ * else:
+ *     __Pyx_globals["MatrixType"] = type('MatrixType', (__Pyx_EnumBase,), {})
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UNDEFINED), 'UNDEFINED')             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.FLOAT32), 'FLOAT32')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.FLOAT64), 'FLOAT64')
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 90, __pyx_L1_error)
+    }
+    __pyx_t_4 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 90, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = __Pyx_PyInt_From_int(((int)MatrixType::UNDEFINED)); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 90, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 90, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_GIVEREF(__pyx_t_13);
+    PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_13);
+    __Pyx_INCREF(__pyx_n_s_UNDEFINED);
+    __Pyx_GIVEREF(__pyx_n_s_UNDEFINED);
+    PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_n_s_UNDEFINED);
+    __pyx_t_13 = 0;
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_14, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 90, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+
+    /* "CppScopedEnumType":91
+ *     __Pyx_globals["MatrixType"] = type('MatrixType', (__Pyx_EnumBase,), {})
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UNDEFINED), 'UNDEFINED')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.FLOAT32), 'FLOAT32')             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.FLOAT64), 'FLOAT64')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT8), 'INT8')
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 91, __pyx_L1_error)
+    }
+    __pyx_t_13 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 91, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __pyx_t_14 = __Pyx_PyInt_From_int(((int)MatrixType::FLOAT32)); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 91, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 91, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_14);
+    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_14);
+    __Pyx_INCREF(__pyx_n_s_FLOAT32);
+    __Pyx_GIVEREF(__pyx_n_s_FLOAT32);
+    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_n_s_FLOAT32);
+    __pyx_t_14 = 0;
+    __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_4, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 91, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+
+    /* "CppScopedEnumType":92
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UNDEFINED), 'UNDEFINED')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.FLOAT32), 'FLOAT32')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.FLOAT64), 'FLOAT64')             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT8), 'INT8')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT16), 'INT16')
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 92, __pyx_L1_error)
+    }
+    __pyx_t_14 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 92, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::FLOAT64)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 92, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 92, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_4);
+    __Pyx_INCREF(__pyx_n_s_FLOAT64);
+    __Pyx_GIVEREF(__pyx_n_s_FLOAT64);
+    PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_n_s_FLOAT64);
+    __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_t_13, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 92, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":93
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.FLOAT32), 'FLOAT32')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.FLOAT64), 'FLOAT64')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT8), 'INT8')             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT16), 'INT16')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT32), 'INT32')
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 93, __pyx_L1_error)
+    }
+    __pyx_t_4 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 93, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = __Pyx_PyInt_From_int(((int)MatrixType::INT8)); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 93, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 93, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_GIVEREF(__pyx_t_13);
+    PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_13);
+    __Pyx_INCREF(__pyx_n_s_INT8);
+    __Pyx_GIVEREF(__pyx_n_s_INT8);
+    PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_n_s_INT8);
+    __pyx_t_13 = 0;
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_14, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 93, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+
+    /* "CppScopedEnumType":94
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.FLOAT64), 'FLOAT64')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT8), 'INT8')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT16), 'INT16')             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT32), 'INT32')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT64), 'INT64')
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 94, __pyx_L1_error)
+    }
+    __pyx_t_13 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 94, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __pyx_t_14 = __Pyx_PyInt_From_int(((int)MatrixType::INT16)); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 94, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 94, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_14);
+    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_14);
+    __Pyx_INCREF(__pyx_n_s_INT16);
+    __Pyx_GIVEREF(__pyx_n_s_INT16);
+    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_n_s_INT16);
+    __pyx_t_14 = 0;
+    __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_4, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 94, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+
+    /* "CppScopedEnumType":95
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT8), 'INT8')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT16), 'INT16')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT32), 'INT32')             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT64), 'INT64')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT8), 'UINT8')
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 95, __pyx_L1_error)
+    }
+    __pyx_t_14 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 95, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::INT32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 95, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 95, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_4);
+    __Pyx_INCREF(__pyx_n_s_INT32);
+    __Pyx_GIVEREF(__pyx_n_s_INT32);
+    PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_n_s_INT32);
+    __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_t_13, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 95, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":96
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT16), 'INT16')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT32), 'INT32')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT64), 'INT64')             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT8), 'UINT8')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT16), 'UINT16')
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 96, __pyx_L1_error)
+    }
+    __pyx_t_4 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 96, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = __Pyx_PyInt_From_int(((int)MatrixType::INT64)); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 96, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 96, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_GIVEREF(__pyx_t_13);
+    PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_13);
+    __Pyx_INCREF(__pyx_n_s_INT64);
+    __Pyx_GIVEREF(__pyx_n_s_INT64);
+    PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_n_s_INT64);
+    __pyx_t_13 = 0;
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_14, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 96, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+
+    /* "CppScopedEnumType":97
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT32), 'INT32')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT64), 'INT64')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT8), 'UINT8')             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT16), 'UINT16')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT32), 'UINT32')
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 97, __pyx_L1_error)
+    }
+    __pyx_t_13 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 97, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __pyx_t_14 = __Pyx_PyInt_From_int(((int)MatrixType::UINT8)); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 97, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 97, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_14);
+    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_14);
+    __Pyx_INCREF(__pyx_n_s_UINT8);
+    __Pyx_GIVEREF(__pyx_n_s_UINT8);
+    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_n_s_UINT8);
+    __pyx_t_14 = 0;
+    __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_4, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 97, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+
+    /* "CppScopedEnumType":98
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.INT64), 'INT64')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT8), 'UINT8')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT16), 'UINT16')             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT32), 'UINT32')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT64), 'UINT64')
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 98, __pyx_L1_error)
+    }
+    __pyx_t_14 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 98, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __pyx_t_4 = __Pyx_PyInt_From_int(((int)MatrixType::UINT16)); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 98, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = PyTuple_New(2); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 98, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_GIVEREF(__pyx_t_4);
+    PyTuple_SET_ITEM(__pyx_t_13, 0, __pyx_t_4);
+    __Pyx_INCREF(__pyx_n_s_UINT16);
+    __Pyx_GIVEREF(__pyx_n_s_UINT16);
+    PyTuple_SET_ITEM(__pyx_t_13, 1, __pyx_n_s_UINT16);
+    __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_t_13, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 98, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "CppScopedEnumType":99
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT8), 'UINT8')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT16), 'UINT16')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT32), 'UINT32')             # <<<<<<<<<<<<<<
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT64), 'UINT64')
+ * 
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 99, __pyx_L1_error)
+    }
+    __pyx_t_4 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 99, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_13 = __Pyx_PyInt_From_int(((int)MatrixType::UINT32)); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 99, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __pyx_t_14 = PyTuple_New(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 99, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_GIVEREF(__pyx_t_13);
+    PyTuple_SET_ITEM(__pyx_t_14, 0, __pyx_t_13);
+    __Pyx_INCREF(__pyx_n_s_UINT32);
+    __Pyx_GIVEREF(__pyx_n_s_UINT32);
+    PyTuple_SET_ITEM(__pyx_t_14, 1, __pyx_n_s_UINT32);
+    __pyx_t_13 = 0;
+    __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_14, NULL); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 99, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
 
+    /* "CppScopedEnumType":100
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT16), 'UINT16')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT32), 'UINT32')
+ *     __Pyx_globals["MatrixType"](<int>(MatrixType.UINT64), 'UINT64')             # <<<<<<<<<<<<<<
+ * 
+ */
+    if (unlikely(__Pyx_globals == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
+      __PYX_ERR(1, 100, __pyx_L1_error)
+    }
+    __pyx_t_13 = __Pyx_PyDict_GetItem(__Pyx_globals, __pyx_n_s_MatrixType); if (unlikely(!__pyx_t_13)) __PYX_ERR(1, 100, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_13);
+    __pyx_t_14 = __Pyx_PyInt_From_int(((int)MatrixType::UINT64)); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 100, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(1, 100, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_GIVEREF(__pyx_t_14);
+    PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_14);
+    __Pyx_INCREF(__pyx_n_s_UINT64);
+    __Pyx_GIVEREF(__pyx_n_s_UINT64);
+    PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_n_s_UINT64);
+    __pyx_t_14 = 0;
+    __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_13, __pyx_t_4, NULL); if (unlikely(!__pyx_t_14)) __PYX_ERR(1, 100, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_14);
+    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
+  }
+  __pyx_L3:;
   __Pyx_TraceReturn(Py_None, 0);
 
   /*--- Wrapped vars code ---*/
 
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_XDECREF(__pyx_t_9);
+  __Pyx_XDECREF(__pyx_t_10);
+  __Pyx_XDECREF(__pyx_t_11);
+  __Pyx_XDECREF(__pyx_t_12);
+  __Pyx_XDECREF(__pyx_t_13);
+  __Pyx_XDECREF(__pyx_t_14);
   if (__pyx_m) {
     if (__pyx_d && stringtab_initialized) {
-      __Pyx_AddTraceback("init rapidfuzz.process_cpp", __pyx_clineno, __pyx_lineno, __pyx_filename);
+      __Pyx_AddTraceback("init rapidfuzz.process_cpp_impl", __pyx_clineno, __pyx_lineno, __pyx_filename);
     }
     #if !CYTHON_USE_MODULE_STATE
     Py_CLEAR(__pyx_m);
     #endif
   } else if (!PyErr_Occurred()) {
-    PyErr_SetString(PyExc_ImportError, "init rapidfuzz.process_cpp");
+    PyErr_SetString(PyExc_ImportError, "init rapidfuzz.process_cpp_impl");
   }
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   return (__pyx_m != NULL) ? 0 : -1;
   #elif PY_MAJOR_VERSION >= 3
   return __pyx_m;
@@ -28287,14 +35756,115 @@
         gen->yieldfrom = source_gen;
         return retval;
     }
     Py_DECREF(source_gen);
     return NULL;
 }
 
+/* WriteUnraisableException */
+static void __Pyx_WriteUnraisable(const char *name, int clineno,
+                                  int lineno, const char *filename,
+                                  int full_traceback, int nogil) {
+    PyObject *old_exc, *old_val, *old_tb;
+    PyObject *ctx;
+    __Pyx_PyThreadState_declare
+#ifdef WITH_THREAD
+    PyGILState_STATE state;
+    if (nogil)
+        state = PyGILState_Ensure();
+    else state = (PyGILState_STATE)-1;
+#endif
+    CYTHON_UNUSED_VAR(clineno);
+    CYTHON_UNUSED_VAR(lineno);
+    CYTHON_UNUSED_VAR(filename);
+    CYTHON_MAYBE_UNUSED_VAR(nogil);
+    __Pyx_PyThreadState_assign
+    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
+    if (full_traceback) {
+        Py_XINCREF(old_exc);
+        Py_XINCREF(old_val);
+        Py_XINCREF(old_tb);
+        __Pyx_ErrRestore(old_exc, old_val, old_tb);
+        PyErr_PrintEx(1);
+    }
+    #if PY_MAJOR_VERSION < 3
+    ctx = PyString_FromString(name);
+    #else
+    ctx = PyUnicode_FromString(name);
+    #endif
+    __Pyx_ErrRestore(old_exc, old_val, old_tb);
+    if (!ctx) {
+        PyErr_WriteUnraisable(Py_None);
+    } else {
+        PyErr_WriteUnraisable(ctx);
+        Py_DECREF(ctx);
+    }
+#ifdef WITH_THREAD
+    if (nogil)
+        PyGILState_Release(state);
+#endif
+}
+
+/* KeywordStringCheck */
+static int __Pyx_CheckKeywordStrings(
+    PyObject *kw,
+    const char* function_name,
+    int kw_allowed)
+{
+    PyObject* key = 0;
+    Py_ssize_t pos = 0;
+#if CYTHON_COMPILING_IN_PYPY
+    if (!kw_allowed && PyDict_Next(kw, &pos, &key, 0))
+        goto invalid_keyword;
+    return 1;
+#else
+    if (CYTHON_METH_FASTCALL && likely(PyTuple_Check(kw))) {
+        if (unlikely(PyTuple_GET_SIZE(kw) == 0))
+            return 1;
+        if (!kw_allowed) {
+            key = PyTuple_GET_ITEM(kw, 0);
+            goto invalid_keyword;
+        }
+#if PY_VERSION_HEX < 0x03090000
+        for (pos = 0; pos < PyTuple_GET_SIZE(kw); pos++) {
+            key = PyTuple_GET_ITEM(kw, pos);
+            if (unlikely(!PyUnicode_Check(key)))
+                goto invalid_keyword_type;
+        }
+#endif
+        return 1;
+    }
+    while (PyDict_Next(kw, &pos, &key, 0)) {
+        #if PY_MAJOR_VERSION < 3
+        if (unlikely(!PyString_Check(key)))
+        #endif
+            if (unlikely(!PyUnicode_Check(key)))
+                goto invalid_keyword_type;
+    }
+    if (!kw_allowed && unlikely(key))
+        goto invalid_keyword;
+    return 1;
+invalid_keyword_type:
+    PyErr_Format(PyExc_TypeError,
+        "%.200s() keywords must be strings", function_name);
+    return 0;
+#endif
+invalid_keyword:
+    #if PY_MAJOR_VERSION < 3
+    PyErr_Format(PyExc_TypeError,
+        "%.200s() got an unexpected keyword argument '%.200s'",
+        function_name, PyString_AsString(key));
+    #else
+    PyErr_Format(PyExc_TypeError,
+        "%s() got an unexpected keyword argument '%U'",
+        function_name, key);
+    #endif
+    return 0;
+}
+
 /* PyIntCompare */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace) {
     CYTHON_MAYBE_UNUSED_VAR(intval);
     CYTHON_UNUSED_VAR(inplace);
     if (op1 == op2) {
         Py_RETURN_TRUE;
     }
@@ -28474,72 +36044,198 @@
 static CYTHON_INLINE PyObject* __Pyx_PyDict_Keys(PyObject* d) {
     if (PY_MAJOR_VERSION >= 3)
         return __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyDict_Type_keys, d);
     else
         return PyDict_Keys(d);
 }
 
-/* WriteUnraisableException */
-static void __Pyx_WriteUnraisable(const char *name, int clineno,
-                                  int lineno, const char *filename,
-                                  int full_traceback, int nogil) {
-    PyObject *old_exc, *old_val, *old_tb;
-    PyObject *ctx;
-    __Pyx_PyThreadState_declare
-#ifdef WITH_THREAD
-    PyGILState_STATE state;
-    if (nogil)
-        state = PyGILState_Ensure();
-    else state = (PyGILState_STATE)-1;
-#endif
-    CYTHON_UNUSED_VAR(clineno);
-    CYTHON_UNUSED_VAR(lineno);
-    CYTHON_UNUSED_VAR(filename);
-    CYTHON_MAYBE_UNUSED_VAR(nogil);
-    __Pyx_PyThreadState_assign
-    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
-    if (full_traceback) {
-        Py_XINCREF(old_exc);
-        Py_XINCREF(old_val);
-        Py_XINCREF(old_tb);
-        __Pyx_ErrRestore(old_exc, old_val, old_tb);
-        PyErr_PrintEx(1);
-    }
-    #if PY_MAJOR_VERSION < 3
-    ctx = PyString_FromString(name);
-    #else
-    ctx = PyUnicode_FromString(name);
-    #endif
-    __Pyx_ErrRestore(old_exc, old_val, old_tb);
-    if (!ctx) {
-        PyErr_WriteUnraisable(Py_None);
-    } else {
-        PyErr_WriteUnraisable(ctx);
-        Py_DECREF(ctx);
-    }
-#ifdef WITH_THREAD
-    if (nogil)
-        PyGILState_Release(state);
-#endif
-}
-
 /* PyObjectSetAttrStr */
 #if CYTHON_USE_TYPE_SLOTS
 static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value) {
     PyTypeObject* tp = Py_TYPE(obj);
     if (likely(tp->tp_setattro))
         return tp->tp_setattro(obj, attr_name, value);
 #if PY_MAJOR_VERSION < 3
     if (likely(tp->tp_setattr))
         return tp->tp_setattr(obj, PyString_AS_STRING(attr_name), value);
 #endif
     return PyObject_SetAttr(obj, attr_name, value);
 }
 #endif
 
+/* ObjectGetItem */
+#if CYTHON_USE_TYPE_SLOTS
+static PyObject *__Pyx_PyObject_GetIndex(PyObject *obj, PyObject *index) {
+    PyObject *runerr;
+    Py_ssize_t key_value;
+    key_value = __Pyx_PyIndex_AsSsize_t(index);
+    if (likely(key_value != -1 || !(runerr = PyErr_Occurred()))) {
+        return __Pyx_GetItemInt_Fast(obj, key_value, 0, 1, 1);
+    }
+    if (PyErr_GivenExceptionMatches(runerr, PyExc_OverflowError)) {
+        __Pyx_TypeName index_type_name = __Pyx_PyType_GetName(Py_TYPE(index));
+        PyErr_Clear();
+        PyErr_Format(PyExc_IndexError,
+            "cannot fit '" __Pyx_FMT_TYPENAME "' into an index-sized integer", index_type_name);
+        __Pyx_DECREF_TypeName(index_type_name);
+    }
+    return NULL;
+}
+static PyObject *__Pyx_PyObject_GetItem_Slow(PyObject *obj, PyObject *key) {
+    __Pyx_TypeName obj_type_name;
+    if (likely(PyType_Check(obj))) {
+        PyObject *meth = __Pyx_PyObject_GetAttrStrNoError(obj, __pyx_n_s_class_getitem);
+        if (meth) {
+            PyObject *result = __Pyx_PyObject_CallOneArg(meth, key);
+            Py_DECREF(meth);
+            return result;
+        }
+    }
+    obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
+    PyErr_Format(PyExc_TypeError,
+        "'" __Pyx_FMT_TYPENAME "' object is not subscriptable", obj_type_name);
+    __Pyx_DECREF_TypeName(obj_type_name);
+    return NULL;
+}
+static PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject *key) {
+    PyTypeObject *tp = Py_TYPE(obj);
+    PyMappingMethods *mm = tp->tp_as_mapping;
+    PySequenceMethods *sm = tp->tp_as_sequence;
+    if (likely(mm && mm->mp_subscript)) {
+        return mm->mp_subscript(obj, key);
+    }
+    if (likely(sm && sm->sq_item)) {
+        return __Pyx_PyObject_GetIndex(obj, key);
+    }
+    return __Pyx_PyObject_GetItem_Slow(obj, key);
+}
+#endif
+
+/* RaiseUnexpectedTypeError */
+static int
+__Pyx_RaiseUnexpectedTypeError(const char *expected, PyObject *obj)
+{
+    __Pyx_TypeName obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
+    PyErr_Format(PyExc_TypeError, "Expected %s, got " __Pyx_FMT_TYPENAME,
+                 expected, obj_type_name);
+    __Pyx_DECREF_TypeName(obj_type_name);
+    return 0;
+}
+
+/* Import */
+static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
+    PyObject *module = 0;
+    PyObject *empty_dict = 0;
+    PyObject *empty_list = 0;
+    #if PY_MAJOR_VERSION < 3
+    PyObject *py_import;
+    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
+    if (unlikely(!py_import))
+        goto bad;
+    if (!from_list) {
+        empty_list = PyList_New(0);
+        if (unlikely(!empty_list))
+            goto bad;
+        from_list = empty_list;
+    }
+    #endif
+    empty_dict = PyDict_New();
+    if (unlikely(!empty_dict))
+        goto bad;
+    {
+        #if PY_MAJOR_VERSION >= 3
+        if (level == -1) {
+            if ((1) && (strchr(__Pyx_MODULE_NAME, '.'))) {
+                #if CYTHON_COMPILING_IN_LIMITED_API
+                module = PyImport_ImportModuleLevelObject(
+                    name, empty_dict, empty_dict, from_list, 1);
+                #else
+                module = PyImport_ImportModuleLevelObject(
+                    name, __pyx_d, empty_dict, from_list, 1);
+                #endif
+                if (unlikely(!module)) {
+                    if (unlikely(!PyErr_ExceptionMatches(PyExc_ImportError)))
+                        goto bad;
+                    PyErr_Clear();
+                }
+            }
+            level = 0;
+        }
+        #endif
+        if (!module) {
+            #if PY_MAJOR_VERSION < 3
+            PyObject *py_level = PyInt_FromLong(level);
+            if (unlikely(!py_level))
+                goto bad;
+            module = PyObject_CallFunctionObjArgs(py_import,
+                name, __pyx_d, empty_dict, from_list, py_level, (PyObject *)NULL);
+            Py_DECREF(py_level);
+            #else
+            #if CYTHON_COMPILING_IN_LIMITED_API
+            module = PyImport_ImportModuleLevelObject(
+                name, empty_dict, empty_dict, from_list, level);
+            #else
+            module = PyImport_ImportModuleLevelObject(
+                name, __pyx_d, empty_dict, from_list, level);
+            #endif
+            #endif
+        }
+    }
+bad:
+    Py_XDECREF(empty_dict);
+    Py_XDECREF(empty_list);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_import);
+    #endif
+    return module;
+}
+
+/* ImportFrom */
+static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
+    PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
+    if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
+        const char* module_name_str = 0;
+        PyObject* module_name = 0;
+        PyObject* module_dot = 0;
+        PyObject* full_name = 0;
+        PyErr_Clear();
+        module_name_str = PyModule_GetName(module);
+        if (unlikely(!module_name_str)) { goto modbad; }
+        module_name = PyUnicode_FromString(module_name_str);
+        if (unlikely(!module_name)) { goto modbad; }
+        module_dot = PyUnicode_Concat(module_name, __pyx_kp_u__22);
+        if (unlikely(!module_dot)) { goto modbad; }
+        full_name = PyUnicode_Concat(module_dot, name);
+        if (unlikely(!full_name)) { goto modbad; }
+        #if PY_VERSION_HEX < 0x030700A1 || (CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM  < 0x07030400)
+        {
+            PyObject *modules = PyImport_GetModuleDict();
+            if (unlikely(!modules))
+                goto modbad;
+            value = PyObject_GetItem(modules, full_name);
+        }
+        #else
+        value = PyImport_GetModule(full_name);
+        #endif
+      modbad:
+        Py_XDECREF(full_name);
+        Py_XDECREF(module_dot);
+        Py_XDECREF(module_name);
+    }
+    if (unlikely(!value)) {
+        PyErr_Format(PyExc_ImportError,
+        #if PY_MAJOR_VERSION < 3
+            "cannot import name %.230s", PyString_AS_STRING(name));
+        #else
+            "cannot import name %S", name);
+        #endif
+    }
+    return value;
+}
+
 /* ValidateBasesTuple */
 #if CYTHON_COMPILING_IN_CPYTHON || CYTHON_COMPILING_IN_LIMITED_API || CYTHON_USE_TYPE_SPECS
 static int __Pyx_validate_bases_tuple(const char *type_name, Py_ssize_t dictoffset, PyObject *bases) {
     Py_ssize_t i, n = PyTuple_GET_SIZE(bases);
     for (i = 1; i < n; i++)
     {
         PyObject *b0 = PyTuple_GET_ITEM(bases, i);
@@ -28653,14 +36349,135 @@
     #endif
     }
 #endif
     return r;
 #endif
 }
 
+/* PyObject_GenericGetAttr */
+#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
+static PyObject* __Pyx_PyObject_GenericGetAttr(PyObject* obj, PyObject* attr_name) {
+    if (unlikely(Py_TYPE(obj)->tp_dictoffset)) {
+        return PyObject_GenericGetAttr(obj, attr_name);
+    }
+    return __Pyx_PyObject_GenericGetAttrNoDict(obj, attr_name);
+}
+#endif
+
+/* SetupReduce */
+#if !CYTHON_COMPILING_IN_LIMITED_API
+static int __Pyx_setup_reduce_is_named(PyObject* meth, PyObject* name) {
+  int ret;
+  PyObject *name_attr;
+  name_attr = __Pyx_PyObject_GetAttrStrNoError(meth, __pyx_n_s_name_2);
+  if (likely(name_attr)) {
+      ret = PyObject_RichCompareBool(name_attr, name, Py_EQ);
+  } else {
+      ret = -1;
+  }
+  if (unlikely(ret < 0)) {
+      PyErr_Clear();
+      ret = 0;
+  }
+  Py_XDECREF(name_attr);
+  return ret;
+}
+static int __Pyx_setup_reduce(PyObject* type_obj) {
+    int ret = 0;
+    PyObject *object_reduce = NULL;
+    PyObject *object_getstate = NULL;
+    PyObject *object_reduce_ex = NULL;
+    PyObject *reduce = NULL;
+    PyObject *reduce_ex = NULL;
+    PyObject *reduce_cython = NULL;
+    PyObject *setstate = NULL;
+    PyObject *setstate_cython = NULL;
+    PyObject *getstate = NULL;
+#if CYTHON_USE_PYTYPE_LOOKUP
+    getstate = _PyType_Lookup((PyTypeObject*)type_obj, __pyx_n_s_getstate);
+#else
+    getstate = __Pyx_PyObject_GetAttrStrNoError(type_obj, __pyx_n_s_getstate);
+    if (!getstate && PyErr_Occurred()) {
+        goto __PYX_BAD;
+    }
+#endif
+    if (getstate) {
+#if CYTHON_USE_PYTYPE_LOOKUP
+        object_getstate = _PyType_Lookup(&PyBaseObject_Type, __pyx_n_s_getstate);
+#else
+        object_getstate = __Pyx_PyObject_GetAttrStrNoError((PyObject*)&PyBaseObject_Type, __pyx_n_s_getstate);
+        if (!object_getstate && PyErr_Occurred()) {
+            goto __PYX_BAD;
+        }
+#endif
+        if (object_getstate != getstate) {
+            goto __PYX_GOOD;
+        }
+    }
+#if CYTHON_USE_PYTYPE_LOOKUP
+    object_reduce_ex = _PyType_Lookup(&PyBaseObject_Type, __pyx_n_s_reduce_ex); if (!object_reduce_ex) goto __PYX_BAD;
+#else
+    object_reduce_ex = __Pyx_PyObject_GetAttrStr((PyObject*)&PyBaseObject_Type, __pyx_n_s_reduce_ex); if (!object_reduce_ex) goto __PYX_BAD;
+#endif
+    reduce_ex = __Pyx_PyObject_GetAttrStr(type_obj, __pyx_n_s_reduce_ex); if (unlikely(!reduce_ex)) goto __PYX_BAD;
+    if (reduce_ex == object_reduce_ex) {
+#if CYTHON_USE_PYTYPE_LOOKUP
+        object_reduce = _PyType_Lookup(&PyBaseObject_Type, __pyx_n_s_reduce); if (!object_reduce) goto __PYX_BAD;
+#else
+        object_reduce = __Pyx_PyObject_GetAttrStr((PyObject*)&PyBaseObject_Type, __pyx_n_s_reduce); if (!object_reduce) goto __PYX_BAD;
+#endif
+        reduce = __Pyx_PyObject_GetAttrStr(type_obj, __pyx_n_s_reduce); if (unlikely(!reduce)) goto __PYX_BAD;
+        if (reduce == object_reduce || __Pyx_setup_reduce_is_named(reduce, __pyx_n_s_reduce_cython)) {
+            reduce_cython = __Pyx_PyObject_GetAttrStrNoError(type_obj, __pyx_n_s_reduce_cython);
+            if (likely(reduce_cython)) {
+                ret = PyDict_SetItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_reduce, reduce_cython); if (unlikely(ret < 0)) goto __PYX_BAD;
+                ret = PyDict_DelItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_reduce_cython); if (unlikely(ret < 0)) goto __PYX_BAD;
+            } else if (reduce == object_reduce || PyErr_Occurred()) {
+                goto __PYX_BAD;
+            }
+            setstate = __Pyx_PyObject_GetAttrStrNoError(type_obj, __pyx_n_s_setstate);
+            if (!setstate) PyErr_Clear();
+            if (!setstate || __Pyx_setup_reduce_is_named(setstate, __pyx_n_s_setstate_cython)) {
+                setstate_cython = __Pyx_PyObject_GetAttrStrNoError(type_obj, __pyx_n_s_setstate_cython);
+                if (likely(setstate_cython)) {
+                    ret = PyDict_SetItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_setstate, setstate_cython); if (unlikely(ret < 0)) goto __PYX_BAD;
+                    ret = PyDict_DelItem(((PyTypeObject*)type_obj)->tp_dict, __pyx_n_s_setstate_cython); if (unlikely(ret < 0)) goto __PYX_BAD;
+                } else if (!setstate || PyErr_Occurred()) {
+                    goto __PYX_BAD;
+                }
+            }
+            PyType_Modified((PyTypeObject*)type_obj);
+        }
+    }
+    goto __PYX_GOOD;
+__PYX_BAD:
+    if (!PyErr_Occurred()) {
+        __Pyx_TypeName type_obj_name =
+            __Pyx_PyType_GetName((PyTypeObject*)type_obj);
+        PyErr_Format(PyExc_RuntimeError,
+            "Unable to initialize pickling for " __Pyx_FMT_TYPENAME, type_obj_name);
+        __Pyx_DECREF_TypeName(type_obj_name);
+    }
+    ret = -1;
+__PYX_GOOD:
+#if !CYTHON_USE_PYTYPE_LOOKUP
+    Py_XDECREF(object_reduce);
+    Py_XDECREF(object_reduce_ex);
+    Py_XDECREF(object_getstate);
+    Py_XDECREF(getstate);
+#endif
+    Py_XDECREF(reduce);
+    Py_XDECREF(reduce_ex);
+    Py_XDECREF(reduce_cython);
+    Py_XDECREF(setstate);
+    Py_XDECREF(setstate_cython);
+    return ret;
+}
+#endif
+
 /* TypeImport */
 #ifndef __PYX_HAVE_RT_ImportType
 #define __PYX_HAVE_RT_ImportType
 static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
     size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize check_size)
 {
     PyObject *result = 0;
@@ -28733,125 +36550,14 @@
     return (PyTypeObject *)result;
 bad:
     Py_XDECREF(result);
     return NULL;
 }
 #endif
 
-/* Import */
-static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
-    PyObject *module = 0;
-    PyObject *empty_dict = 0;
-    PyObject *empty_list = 0;
-    #if PY_MAJOR_VERSION < 3
-    PyObject *py_import;
-    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
-    if (unlikely(!py_import))
-        goto bad;
-    if (!from_list) {
-        empty_list = PyList_New(0);
-        if (unlikely(!empty_list))
-            goto bad;
-        from_list = empty_list;
-    }
-    #endif
-    empty_dict = PyDict_New();
-    if (unlikely(!empty_dict))
-        goto bad;
-    {
-        #if PY_MAJOR_VERSION >= 3
-        if (level == -1) {
-            if ((1) && (strchr(__Pyx_MODULE_NAME, '.'))) {
-                #if CYTHON_COMPILING_IN_LIMITED_API
-                module = PyImport_ImportModuleLevelObject(
-                    name, empty_dict, empty_dict, from_list, 1);
-                #else
-                module = PyImport_ImportModuleLevelObject(
-                    name, __pyx_d, empty_dict, from_list, 1);
-                #endif
-                if (unlikely(!module)) {
-                    if (unlikely(!PyErr_ExceptionMatches(PyExc_ImportError)))
-                        goto bad;
-                    PyErr_Clear();
-                }
-            }
-            level = 0;
-        }
-        #endif
-        if (!module) {
-            #if PY_MAJOR_VERSION < 3
-            PyObject *py_level = PyInt_FromLong(level);
-            if (unlikely(!py_level))
-                goto bad;
-            module = PyObject_CallFunctionObjArgs(py_import,
-                name, __pyx_d, empty_dict, from_list, py_level, (PyObject *)NULL);
-            Py_DECREF(py_level);
-            #else
-            #if CYTHON_COMPILING_IN_LIMITED_API
-            module = PyImport_ImportModuleLevelObject(
-                name, empty_dict, empty_dict, from_list, level);
-            #else
-            module = PyImport_ImportModuleLevelObject(
-                name, __pyx_d, empty_dict, from_list, level);
-            #endif
-            #endif
-        }
-    }
-bad:
-    Py_XDECREF(empty_dict);
-    Py_XDECREF(empty_list);
-    #if PY_MAJOR_VERSION < 3
-    Py_XDECREF(py_import);
-    #endif
-    return module;
-}
-
-/* ImportFrom */
-static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
-    PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
-    if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
-        const char* module_name_str = 0;
-        PyObject* module_name = 0;
-        PyObject* module_dot = 0;
-        PyObject* full_name = 0;
-        PyErr_Clear();
-        module_name_str = PyModule_GetName(module);
-        if (unlikely(!module_name_str)) { goto modbad; }
-        module_name = PyUnicode_FromString(module_name_str);
-        if (unlikely(!module_name)) { goto modbad; }
-        module_dot = PyUnicode_Concat(module_name, __pyx_kp_u__18);
-        if (unlikely(!module_dot)) { goto modbad; }
-        full_name = PyUnicode_Concat(module_dot, name);
-        if (unlikely(!full_name)) { goto modbad; }
-        #if PY_VERSION_HEX < 0x030700A1 || (CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM  < 0x07030400)
-        {
-            PyObject *modules = PyImport_GetModuleDict();
-            if (unlikely(!modules))
-                goto modbad;
-            value = PyObject_GetItem(modules, full_name);
-        }
-        #else
-        value = PyImport_GetModule(full_name);
-        #endif
-      modbad:
-        Py_XDECREF(full_name);
-        Py_XDECREF(module_dot);
-        Py_XDECREF(module_name);
-    }
-    if (unlikely(!value)) {
-        PyErr_Format(PyExc_ImportError,
-        #if PY_MAJOR_VERSION < 3
-            "cannot import name %.230s", PyString_AS_STRING(name));
-        #else
-            "cannot import name %S", name);
-        #endif
-    }
-    return value;
-}
-
 /* ImportDottedModule */
 #if PY_MAJOR_VERSION >= 3
 static PyObject *__Pyx__ImportDottedModule_Error(PyObject *name, PyObject *parts_tuple, Py_ssize_t count) {
     PyObject *partial_name = NULL, *slice = NULL, *sep = NULL;
     if (unlikely(PyErr_Occurred())) {
         PyErr_Clear();
     }
@@ -28898,15 +36604,15 @@
     imported_module = PyImport_GetModule(name);
 #endif
     return imported_module;
 }
 #endif
 static PyObject *__Pyx__ImportDottedModule(PyObject *name, PyObject *parts_tuple) {
 #if PY_MAJOR_VERSION < 3
-    PyObject *module, *from_list, *star = __pyx_n_s__19;
+    PyObject *module, *from_list, *star = __pyx_n_s__23;
     CYTHON_UNUSED_VAR(parts_tuple);
     from_list = PyList_New(1);
     if (unlikely(!from_list))
         return NULL;
     Py_INCREF(star);
     PyList_SET_ITEM(from_list, 0, star);
     module = __Pyx_Import(name, from_list, 0);
@@ -28966,14 +36672,372 @@
     } else if (PyErr_Occurred()) {
         PyErr_Clear();
     }
 #endif
     return __Pyx__ImportDottedModule(name, parts_tuple);
 }
 
+/* Py3UpdateBases */
+static PyObject*
+__Pyx_PEP560_update_bases(PyObject *bases)
+{
+    Py_ssize_t i, j, size_bases;
+    PyObject *base, *meth, *new_base, *result, *new_bases = NULL;
+    size_bases = PyTuple_GET_SIZE(bases);
+    for (i = 0; i < size_bases; i++) {
+        base  = PyTuple_GET_ITEM(bases, i);
+        if (PyType_Check(base)) {
+            if (new_bases) {
+                if (PyList_Append(new_bases, base) < 0) {
+                    goto error;
+                }
+            }
+            continue;
+        }
+        meth = __Pyx_PyObject_GetAttrStrNoError(base, __pyx_n_s_mro_entries);
+        if (!meth && PyErr_Occurred()) {
+            goto error;
+        }
+        if (!meth) {
+            if (new_bases) {
+                if (PyList_Append(new_bases, base) < 0) {
+                    goto error;
+                }
+            }
+            continue;
+        }
+        new_base = __Pyx_PyObject_CallOneArg(meth, bases);
+        Py_DECREF(meth);
+        if (!new_base) {
+            goto error;
+        }
+        if (!PyTuple_Check(new_base)) {
+            PyErr_SetString(PyExc_TypeError,
+                            "__mro_entries__ must return a tuple");
+            Py_DECREF(new_base);
+            goto error;
+        }
+        if (!new_bases) {
+            if (!(new_bases = PyList_New(i))) {
+                goto error;
+            }
+            for (j = 0; j < i; j++) {
+                base = PyTuple_GET_ITEM(bases, j);
+                PyList_SET_ITEM(new_bases, j, base);
+                Py_INCREF(base);
+            }
+        }
+        j = PyList_GET_SIZE(new_bases);
+        if (PyList_SetSlice(new_bases, j, j, new_base) < 0) {
+            goto error;
+        }
+        Py_DECREF(new_base);
+    }
+    if (!new_bases) {
+        Py_INCREF(bases);
+        return bases;
+    }
+    result = PyList_AsTuple(new_bases);
+    Py_DECREF(new_bases);
+    return result;
+error:
+    Py_XDECREF(new_bases);
+    return NULL;
+}
+
+/* SetNewInClass */
+static int __Pyx_SetNewInClass(PyObject *ns, PyObject *name, PyObject *value) {
+#ifdef __Pyx_CyFunction_USED
+    int ret;
+    if (__Pyx_CyFunction_Check(value)) {
+        PyObject *staticnew = PyStaticMethod_New(value);
+        if (unlikely(!staticnew)) return -1;
+        ret = __Pyx_SetNameInClass(ns, name, staticnew);
+        Py_DECREF(staticnew);
+        return ret;
+    }
+#endif
+    return __Pyx_SetNameInClass(ns, name, value);
+}
+
+/* CalculateMetaclass */
+static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases) {
+    Py_ssize_t i, nbases = PyTuple_GET_SIZE(bases);
+    for (i=0; i < nbases; i++) {
+        PyTypeObject *tmptype;
+        PyObject *tmp = PyTuple_GET_ITEM(bases, i);
+        tmptype = Py_TYPE(tmp);
+#if PY_MAJOR_VERSION < 3
+        if (tmptype == &PyClass_Type)
+            continue;
+#endif
+        if (!metaclass) {
+            metaclass = tmptype;
+            continue;
+        }
+        if (PyType_IsSubtype(metaclass, tmptype))
+            continue;
+        if (PyType_IsSubtype(tmptype, metaclass)) {
+            metaclass = tmptype;
+            continue;
+        }
+        PyErr_SetString(PyExc_TypeError,
+                        "metaclass conflict: "
+                        "the metaclass of a derived class "
+                        "must be a (non-strict) subclass "
+                        "of the metaclasses of all its bases");
+        return NULL;
+    }
+    if (!metaclass) {
+#if PY_MAJOR_VERSION < 3
+        metaclass = &PyClass_Type;
+#else
+        metaclass = &PyType_Type;
+#endif
+    }
+    Py_INCREF((PyObject*) metaclass);
+    return (PyObject*) metaclass;
+}
+
+/* PyObjectLookupSpecial */
+#if CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx__PyObject_LookupSpecial(PyObject* obj, PyObject* attr_name, int with_error) {
+    PyObject *res;
+    PyTypeObject *tp = Py_TYPE(obj);
+#if PY_MAJOR_VERSION < 3
+    if (unlikely(PyInstance_Check(obj)))
+        return with_error ? __Pyx_PyObject_GetAttrStr(obj, attr_name) : __Pyx_PyObject_GetAttrStrNoError(obj, attr_name);
+#endif
+    res = _PyType_Lookup(tp, attr_name);
+    if (likely(res)) {
+        descrgetfunc f = Py_TYPE(res)->tp_descr_get;
+        if (!f) {
+            Py_INCREF(res);
+        } else {
+            res = f(res, obj, (PyObject *)tp);
+        }
+    } else if (with_error) {
+        PyErr_SetObject(PyExc_AttributeError, attr_name);
+    }
+    return res;
+}
+#endif
+
+/* Py3ClassCreate */
+static PyObject *__Pyx_Py3MetaclassPrepare(PyObject *metaclass, PyObject *bases, PyObject *name,
+                                           PyObject *qualname, PyObject *mkw, PyObject *modname, PyObject *doc) {
+    PyObject *ns;
+    if (metaclass) {
+        PyObject *prep = __Pyx_PyObject_GetAttrStrNoError(metaclass, __pyx_n_s_prepare);
+        if (prep) {
+            PyObject *pargs[3] = {NULL, name, bases};
+            ns = __Pyx_PyObject_FastCallDict(prep, pargs+1, 2 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET, mkw);
+            Py_DECREF(prep);
+        } else {
+            if (unlikely(PyErr_Occurred()))
+                return NULL;
+            ns = PyDict_New();
+        }
+    } else {
+        ns = PyDict_New();
+    }
+    if (unlikely(!ns))
+        return NULL;
+    if (unlikely(PyObject_SetItem(ns, __pyx_n_s_module, modname) < 0)) goto bad;
+#if PY_VERSION_HEX >= 0x03030000
+    if (unlikely(PyObject_SetItem(ns, __pyx_n_s_qualname, qualname) < 0)) goto bad;
+#else
+    CYTHON_MAYBE_UNUSED_VAR(qualname);
+#endif
+    if (unlikely(doc && PyObject_SetItem(ns, __pyx_n_s_doc, doc) < 0)) goto bad;
+    return ns;
+bad:
+    Py_DECREF(ns);
+    return NULL;
+}
+#if PY_VERSION_HEX < 0x030600A4 && CYTHON_PEP487_INIT_SUBCLASS
+static int __Pyx_SetNamesPEP487(PyObject *type_obj) {
+    PyTypeObject *type = (PyTypeObject*) type_obj;
+    PyObject *names_to_set, *key, *value, *set_name, *tmp;
+    Py_ssize_t i = 0;
+#if CYTHON_USE_TYPE_SLOTS
+    names_to_set = PyDict_Copy(type->tp_dict);
+#else
+    {
+        PyObject *d = PyObject_GetAttr(type_obj, __pyx_n_s_dict);
+        names_to_set = NULL;
+        if (likely(d)) {
+            PyObject *names_to_set = PyDict_New();
+            int ret = likely(names_to_set) ? PyDict_Update(names_to_set, d) : -1;
+            Py_DECREF(d);
+            if (unlikely(ret < 0))
+                Py_CLEAR(names_to_set);
+        }
+    }
+#endif
+    if (unlikely(names_to_set == NULL))
+        goto bad;
+    while (PyDict_Next(names_to_set, &i, &key, &value)) {
+        set_name = __Pyx_PyObject_LookupSpecialNoError(value, __pyx_n_s_set_name);
+        if (unlikely(set_name != NULL)) {
+            tmp = __Pyx_PyObject_Call2Args(set_name, type_obj, key);
+            Py_DECREF(set_name);
+            if (unlikely(tmp == NULL)) {
+                __Pyx_TypeName value_type_name =
+                    __Pyx_PyType_GetName(Py_TYPE(value));
+                __Pyx_TypeName type_name = __Pyx_PyType_GetName(type);
+                PyErr_Format(PyExc_RuntimeError,
+#if PY_MAJOR_VERSION >= 3
+                    "Error calling __set_name__ on '" __Pyx_FMT_TYPENAME "' instance %R " "in '" __Pyx_FMT_TYPENAME "'",
+                    value_type_name, key, type_name);
+#else
+                    "Error calling __set_name__ on '" __Pyx_FMT_TYPENAME "' instance %.100s in '" __Pyx_FMT_TYPENAME "'",
+                    value_type_name,
+                    PyString_Check(key) ? PyString_AS_STRING(key) : "?",
+                    type_name);
+#endif
+                goto bad;
+            } else {
+                Py_DECREF(tmp);
+            }
+        }
+        else if (unlikely(PyErr_Occurred())) {
+            goto bad;
+        }
+    }
+    Py_DECREF(names_to_set);
+    return 0;
+bad:
+    Py_XDECREF(names_to_set);
+    return -1;
+}
+static PyObject *__Pyx_InitSubclassPEP487(PyObject *type_obj, PyObject *mkw) {
+#if CYTHON_USE_TYPE_SLOTS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    PyTypeObject *type = (PyTypeObject*) type_obj;
+    PyObject *mro = type->tp_mro;
+    Py_ssize_t i, nbases;
+    if (unlikely(!mro)) goto done;
+    (void) &__Pyx_GetBuiltinName;
+    Py_INCREF(mro);
+    nbases = PyTuple_GET_SIZE(mro);
+    assert(PyTuple_GET_ITEM(mro, 0) == type_obj);
+    for (i = 1; i < nbases-1; i++) {
+        PyObject *base, *dict, *meth;
+        base = PyTuple_GET_ITEM(mro, i);
+        dict = ((PyTypeObject *)base)->tp_dict;
+        meth = __Pyx_PyDict_GetItemStrWithError(dict, __pyx_n_s_init_subclass);
+        if (unlikely(meth)) {
+            descrgetfunc f = Py_TYPE(meth)->tp_descr_get;
+            PyObject *res;
+            Py_INCREF(meth);
+            if (likely(f)) {
+                res = f(meth, NULL, type_obj);
+                Py_DECREF(meth);
+                if (unlikely(!res)) goto bad;
+                meth = res;
+            }
+            res = __Pyx_PyObject_FastCallDict(meth, NULL, 0, mkw);
+            Py_DECREF(meth);
+            if (unlikely(!res)) goto bad;
+            Py_DECREF(res);
+            goto done;
+        } else if (unlikely(PyErr_Occurred())) {
+            goto bad;
+        }
+    }
+done:
+    Py_XDECREF(mro);
+    return type_obj;
+bad:
+    Py_XDECREF(mro);
+    Py_DECREF(type_obj);
+    return NULL;
+#else
+    PyObject *super_type, *super, *func, *res;
+#if CYTHON_COMPILING_IN_PYPY && !defined(PySuper_Type)
+    super_type = __Pyx_GetBuiltinName(__pyx_n_s_super);
+#else
+    super_type = (PyObject*) &PySuper_Type;
+    (void) &__Pyx_GetBuiltinName;
+#endif
+    super = likely(super_type) ? __Pyx_PyObject_Call2Args(super_type, type_obj, type_obj) : NULL;
+#if CYTHON_COMPILING_IN_PYPY && !defined(PySuper_Type)
+    Py_XDECREF(super_type);
+#endif
+    if (unlikely(!super)) {
+        Py_CLEAR(type_obj);
+        goto done;
+    }
+    func = __Pyx_PyObject_GetAttrStrNoError(super, __pyx_n_s_init_subclass);
+    Py_DECREF(super);
+    if (likely(!func)) {
+        if (unlikely(PyErr_Occurred()))
+            Py_CLEAR(type_obj);
+        goto done;
+    }
+    res = __Pyx_PyObject_FastCallDict(func, NULL, 0, mkw);
+    Py_DECREF(func);
+    if (unlikely(!res))
+        Py_CLEAR(type_obj);
+    Py_XDECREF(res);
+done:
+    return type_obj;
+#endif
+}
+#endif
+static PyObject *__Pyx_Py3ClassCreate(PyObject *metaclass, PyObject *name, PyObject *bases,
+                                      PyObject *dict, PyObject *mkw,
+                                      int calculate_metaclass, int allow_py2_metaclass) {
+    PyObject *result;
+    PyObject *owned_metaclass = NULL;
+    PyObject *margs[4] = {NULL, name, bases, dict};
+    if (allow_py2_metaclass) {
+        owned_metaclass = PyObject_GetItem(dict, __pyx_n_s_metaclass);
+        if (owned_metaclass) {
+            metaclass = owned_metaclass;
+        } else if (likely(PyErr_ExceptionMatches(PyExc_KeyError))) {
+            PyErr_Clear();
+        } else {
+            return NULL;
+        }
+    }
+    if (calculate_metaclass && (!metaclass || PyType_Check(metaclass))) {
+        metaclass = __Pyx_CalculateMetaclass((PyTypeObject*) metaclass, bases);
+        Py_XDECREF(owned_metaclass);
+        if (unlikely(!metaclass))
+            return NULL;
+        owned_metaclass = metaclass;
+    }
+    result = __Pyx_PyObject_FastCallDict(metaclass, margs+1, 3 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET,
+#if PY_VERSION_HEX < 0x030600A4
+        (metaclass == (PyObject*)&PyType_Type) ? NULL : mkw
+#else
+        mkw
+#endif
+    );
+    Py_XDECREF(owned_metaclass);
+#if PY_VERSION_HEX < 0x030600A4 && CYTHON_PEP487_INIT_SUBCLASS
+    if (likely(result) && likely(PyType_Check(result))) {
+        if (unlikely(__Pyx_SetNamesPEP487(result) < 0)) {
+            Py_CLEAR(result);
+        } else {
+            result = __Pyx_InitSubclassPEP487(result, mkw);
+        }
+    }
+#else
+    (void) &__Pyx_GetBuiltinName;
+#endif
+    return result;
+}
+
+/* Globals */
+static PyObject* __Pyx_Globals(void) {
+    return __Pyx_NewRef(__pyx_d);
+}
+
 /* CLineInTraceback */
 #ifndef CYTHON_CLINE_IN_TRACEBACK
 static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
@@ -29262,14 +37326,248 @@
    #endif
    PyErr_Format(PyExc_ValueError,
                 "only single character unicode strings can be converted to Py_UCS4, "
                 "got length %" CYTHON_FORMAT_SSIZE_T "d", length);
    return (Py_UCS4)-1;
 }
 
+/* CIntToPy */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const int neg_one = (int) -1, const_zero = (int) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
+    const int is_unsigned = neg_one > const_zero;
+    if (is_unsigned) {
+        if (sizeof(int) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(int) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
+#endif
+        }
+    } else {
+        if (sizeof(int) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
+#endif
+        }
+    }
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(int),
+                                     little, !is_unsigned);
+    }
+}
+
+/* CIntFromPy */
+static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const int neg_one = (int) -1, const_zero = (int) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
+    const int is_unsigned = neg_one > const_zero;
+#if PY_MAJOR_VERSION < 3
+    if (likely(PyInt_Check(x))) {
+        if ((sizeof(int) < sizeof(long))) {
+            __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
+        } else {
+            long val = PyInt_AS_LONG(x);
+            if (is_unsigned && unlikely(val < 0)) {
+                goto raise_neg_overflow;
+            }
+            return (int) val;
+        }
+    } else
+#endif
+    if (likely(PyLong_Check(x))) {
+        if (is_unsigned) {
+#if CYTHON_USE_PYLONG_INTERNALS
+            const digit* digits = ((PyLongObject*)x)->ob_digit;
+            switch (Py_SIZE(x)) {
+                case  0: return (int) 0;
+                case  1: __PYX_VERIFY_RETURN_INT(int, digit, digits[0])
+                case 2:
+                    if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(int) >= 2 * PyLong_SHIFT)) {
+                            return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                        }
+                    }
+                    break;
+                case 3:
+                    if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(int) >= 3 * PyLong_SHIFT)) {
+                            return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                        }
+                    }
+                    break;
+                case 4:
+                    if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(int) >= 4 * PyLong_SHIFT)) {
+                            return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                        }
+                    }
+                    break;
+            }
+#endif
+#if CYTHON_COMPILING_IN_CPYTHON
+            if (unlikely(Py_SIZE(x) < 0)) {
+                goto raise_neg_overflow;
+            }
+#else
+            {
+                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                if (unlikely(result < 0))
+                    return (int) -1;
+                if (unlikely(result == 1))
+                    goto raise_neg_overflow;
+            }
+#endif
+            if ((sizeof(int) <= sizeof(unsigned long))) {
+                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned long, PyLong_AsUnsignedLong(x))
+#ifdef HAVE_LONG_LONG
+            } else if ((sizeof(int) <= sizeof(unsigned PY_LONG_LONG))) {
+                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
+#endif
+            }
+        } else {
+#if CYTHON_USE_PYLONG_INTERNALS
+            const digit* digits = ((PyLongObject*)x)->ob_digit;
+            switch (Py_SIZE(x)) {
+                case  0: return (int) 0;
+                case -1: __PYX_VERIFY_RETURN_INT(int, sdigit, (sdigit) (-(sdigit)digits[0]))
+                case  1: __PYX_VERIFY_RETURN_INT(int,  digit, +digits[0])
+                case -2:
+                    if ((8 * sizeof(int) - 1 > 1 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                            return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        }
+                    }
+                    break;
+                case 2:
+                    if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                            return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        }
+                    }
+                    break;
+                case -3:
+                    if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                            return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        }
+                    }
+                    break;
+                case 3:
+                    if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                            return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        }
+                    }
+                    break;
+                case -4:
+                    if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
+                            return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        }
+                    }
+                    break;
+                case 4:
+                    if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
+                            return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        }
+                    }
+                    break;
+            }
+#endif
+            if ((sizeof(int) <= sizeof(long))) {
+                __PYX_VERIFY_RETURN_INT_EXC(int, long, PyLong_AsLong(x))
+#ifdef HAVE_LONG_LONG
+            } else if ((sizeof(int) <= sizeof(PY_LONG_LONG))) {
+                __PYX_VERIFY_RETURN_INT_EXC(int, PY_LONG_LONG, PyLong_AsLongLong(x))
+#endif
+            }
+        }
+        {
+#if (CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) && !defined(_PyLong_AsByteArray)
+            PyErr_SetString(PyExc_RuntimeError,
+                            "_PyLong_AsByteArray() not available, cannot convert large numbers");
+#else
+            int val;
+            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
+ #if PY_MAJOR_VERSION < 3
+            if (likely(v) && !PyLong_Check(v)) {
+                PyObject *tmp = v;
+                v = PyNumber_Long(tmp);
+                Py_DECREF(tmp);
+            }
+ #endif
+            if (likely(v)) {
+                int one = 1; int is_little = (int)*(unsigned char *)&one;
+                unsigned char *bytes = (unsigned char *)&val;
+                int ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                              bytes, sizeof(val),
+                                              is_little, !is_unsigned);
+                Py_DECREF(v);
+                if (likely(!ret))
+                    return val;
+            }
+#endif
+            return (int) -1;
+        }
+    } else {
+        int val;
+        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
+        if (!tmp) return (int) -1;
+        val = __Pyx_PyInt_As_int(tmp);
+        Py_DECREF(tmp);
+        return val;
+    }
+raise_overflow:
+    PyErr_SetString(PyExc_OverflowError,
+        "value too large to convert to int");
+    return (int) -1;
+raise_neg_overflow:
+    PyErr_SetString(PyExc_OverflowError,
+        "can't convert negative value to int");
+    return (int) -1;
+}
+
 /* CIntFromPy */
 static CYTHON_INLINE int64_t __Pyx_PyInt_As_int64_t(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const int64_t neg_one = (int64_t) -1, const_zero = (int64_t) 0;
@@ -29535,14 +37833,248 @@
         unsigned char *bytes = (unsigned char *)&value;
         return _PyLong_FromByteArray(bytes, sizeof(long),
                                      little, !is_unsigned);
     }
 }
 
 /* CIntFromPy */
+static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *x) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const size_t neg_one = (size_t) -1, const_zero = (size_t) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
+    const int is_unsigned = neg_one > const_zero;
+#if PY_MAJOR_VERSION < 3
+    if (likely(PyInt_Check(x))) {
+        if ((sizeof(size_t) < sizeof(long))) {
+            __PYX_VERIFY_RETURN_INT(size_t, long, PyInt_AS_LONG(x))
+        } else {
+            long val = PyInt_AS_LONG(x);
+            if (is_unsigned && unlikely(val < 0)) {
+                goto raise_neg_overflow;
+            }
+            return (size_t) val;
+        }
+    } else
+#endif
+    if (likely(PyLong_Check(x))) {
+        if (is_unsigned) {
+#if CYTHON_USE_PYLONG_INTERNALS
+            const digit* digits = ((PyLongObject*)x)->ob_digit;
+            switch (Py_SIZE(x)) {
+                case  0: return (size_t) 0;
+                case  1: __PYX_VERIFY_RETURN_INT(size_t, digit, digits[0])
+                case 2:
+                    if ((8 * sizeof(size_t) > 1 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(size_t) >= 2 * PyLong_SHIFT)) {
+                            return (size_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                        }
+                    }
+                    break;
+                case 3:
+                    if ((8 * sizeof(size_t) > 2 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(size_t) >= 3 * PyLong_SHIFT)) {
+                            return (size_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                        }
+                    }
+                    break;
+                case 4:
+                    if ((8 * sizeof(size_t) > 3 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(size_t) >= 4 * PyLong_SHIFT)) {
+                            return (size_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                        }
+                    }
+                    break;
+            }
+#endif
+#if CYTHON_COMPILING_IN_CPYTHON
+            if (unlikely(Py_SIZE(x) < 0)) {
+                goto raise_neg_overflow;
+            }
+#else
+            {
+                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                if (unlikely(result < 0))
+                    return (size_t) -1;
+                if (unlikely(result == 1))
+                    goto raise_neg_overflow;
+            }
+#endif
+            if ((sizeof(size_t) <= sizeof(unsigned long))) {
+                __PYX_VERIFY_RETURN_INT_EXC(size_t, unsigned long, PyLong_AsUnsignedLong(x))
+#ifdef HAVE_LONG_LONG
+            } else if ((sizeof(size_t) <= sizeof(unsigned PY_LONG_LONG))) {
+                __PYX_VERIFY_RETURN_INT_EXC(size_t, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
+#endif
+            }
+        } else {
+#if CYTHON_USE_PYLONG_INTERNALS
+            const digit* digits = ((PyLongObject*)x)->ob_digit;
+            switch (Py_SIZE(x)) {
+                case  0: return (size_t) 0;
+                case -1: __PYX_VERIFY_RETURN_INT(size_t, sdigit, (sdigit) (-(sdigit)digits[0]))
+                case  1: __PYX_VERIFY_RETURN_INT(size_t,  digit, +digits[0])
+                case -2:
+                    if ((8 * sizeof(size_t) - 1 > 1 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT)) {
+                            return (size_t) (((size_t)-1)*(((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        }
+                    }
+                    break;
+                case 2:
+                    if ((8 * sizeof(size_t) > 1 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT)) {
+                            return (size_t) ((((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        }
+                    }
+                    break;
+                case -3:
+                    if ((8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT)) {
+                            return (size_t) (((size_t)-1)*(((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        }
+                    }
+                    break;
+                case 3:
+                    if ((8 * sizeof(size_t) > 2 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT)) {
+                            return (size_t) ((((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        }
+                    }
+                    break;
+                case -4:
+                    if ((8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT)) {
+                            return (size_t) (((size_t)-1)*(((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        }
+                    }
+                    break;
+                case 4:
+                    if ((8 * sizeof(size_t) > 3 * PyLong_SHIFT)) {
+                        if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                        } else if ((8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT)) {
+                            return (size_t) ((((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        }
+                    }
+                    break;
+            }
+#endif
+            if ((sizeof(size_t) <= sizeof(long))) {
+                __PYX_VERIFY_RETURN_INT_EXC(size_t, long, PyLong_AsLong(x))
+#ifdef HAVE_LONG_LONG
+            } else if ((sizeof(size_t) <= sizeof(PY_LONG_LONG))) {
+                __PYX_VERIFY_RETURN_INT_EXC(size_t, PY_LONG_LONG, PyLong_AsLongLong(x))
+#endif
+            }
+        }
+        {
+#if (CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) && !defined(_PyLong_AsByteArray)
+            PyErr_SetString(PyExc_RuntimeError,
+                            "_PyLong_AsByteArray() not available, cannot convert large numbers");
+#else
+            size_t val;
+            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
+ #if PY_MAJOR_VERSION < 3
+            if (likely(v) && !PyLong_Check(v)) {
+                PyObject *tmp = v;
+                v = PyNumber_Long(tmp);
+                Py_DECREF(tmp);
+            }
+ #endif
+            if (likely(v)) {
+                int one = 1; int is_little = (int)*(unsigned char *)&one;
+                unsigned char *bytes = (unsigned char *)&val;
+                int ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                              bytes, sizeof(val),
+                                              is_little, !is_unsigned);
+                Py_DECREF(v);
+                if (likely(!ret))
+                    return val;
+            }
+#endif
+            return (size_t) -1;
+        }
+    } else {
+        size_t val;
+        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
+        if (!tmp) return (size_t) -1;
+        val = __Pyx_PyInt_As_size_t(tmp);
+        Py_DECREF(tmp);
+        return val;
+    }
+raise_overflow:
+    PyErr_SetString(PyExc_OverflowError,
+        "value too large to convert to size_t");
+    return (size_t) -1;
+raise_neg_overflow:
+    PyErr_SetString(PyExc_OverflowError,
+        "can't convert negative value to size_t");
+    return (size_t) -1;
+}
+
+/* CIntToPy */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_uint32_t(uint32_t value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const uint32_t neg_one = (uint32_t) -1, const_zero = (uint32_t) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
+    const int is_unsigned = neg_one > const_zero;
+    if (is_unsigned) {
+        if (sizeof(uint32_t) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(uint32_t) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(uint32_t) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
+#endif
+        }
+    } else {
+        if (sizeof(uint32_t) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(uint32_t) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
+#endif
+        }
+    }
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(uint32_t),
+                                     little, !is_unsigned);
+    }
+}
+
+/* CIntFromPy */
 static CYTHON_INLINE uint64_t __Pyx_PyInt_As_uint64_t(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const uint64_t neg_one = (uint64_t) -1, const_zero = (uint64_t) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
@@ -29751,29 +38283,14 @@
    ival = __Pyx_PyInt_As_long(x);
    if (unlikely(!__Pyx_is_valid_index(ival, 1114111 + 1))) {
        return __Pyx__PyObject_AsPy_UCS4_raise_error(ival);
    }
    return (Py_UCS4)ival;
 }
 
-/* FormatTypeName */
-#if CYTHON_COMPILING_IN_LIMITED_API
-static __Pyx_TypeName
-__Pyx_PyType_GetName(PyTypeObject* tp)
-{
-    PyObject *name = __Pyx_PyObject_GetAttrStr((PyObject *)tp,
-                                               __pyx_n_s_name);
-    if (unlikely(name == NULL) || unlikely(!PyUnicode_Check(name))) {
-        PyErr_Clear();
-        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__23));
-    }
-    return name;
-}
-#endif
-
 /* CIntFromPy */
 static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const long neg_one = (long) -1, const_zero = (long) 0;
@@ -29962,209 +38479,28 @@
     return (long) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to long");
     return (long) -1;
 }
 
-/* CIntFromPy */
-static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic push
-#pragma GCC diagnostic ignored "-Wconversion"
-#endif
-    const int neg_one = (int) -1, const_zero = (int) 0;
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic pop
-#endif
-    const int is_unsigned = neg_one > const_zero;
-#if PY_MAJOR_VERSION < 3
-    if (likely(PyInt_Check(x))) {
-        if ((sizeof(int) < sizeof(long))) {
-            __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
-        } else {
-            long val = PyInt_AS_LONG(x);
-            if (is_unsigned && unlikely(val < 0)) {
-                goto raise_neg_overflow;
-            }
-            return (int) val;
-        }
-    } else
-#endif
-    if (likely(PyLong_Check(x))) {
-        if (is_unsigned) {
-#if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (int) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(int, digit, digits[0])
-                case 2:
-                    if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
-                        if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if ((8 * sizeof(int) >= 2 * PyLong_SHIFT)) {
-                            return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
-                        }
-                    }
-                    break;
-                case 3:
-                    if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
-                        if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if ((8 * sizeof(int) >= 3 * PyLong_SHIFT)) {
-                            return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
-                        }
-                    }
-                    break;
-                case 4:
-                    if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
-                        if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if ((8 * sizeof(int) >= 4 * PyLong_SHIFT)) {
-                            return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
-                        }
-                    }
-                    break;
-            }
-#endif
-#if CYTHON_COMPILING_IN_CPYTHON
-            if (unlikely(Py_SIZE(x) < 0)) {
-                goto raise_neg_overflow;
-            }
-#else
-            {
-                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
-                if (unlikely(result < 0))
-                    return (int) -1;
-                if (unlikely(result == 1))
-                    goto raise_neg_overflow;
-            }
-#endif
-            if ((sizeof(int) <= sizeof(unsigned long))) {
-                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned long, PyLong_AsUnsignedLong(x))
-#ifdef HAVE_LONG_LONG
-            } else if ((sizeof(int) <= sizeof(unsigned PY_LONG_LONG))) {
-                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
-#endif
-            }
-        } else {
-#if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (int) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(int, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(int,  digit, +digits[0])
-                case -2:
-                    if ((8 * sizeof(int) - 1 > 1 * PyLong_SHIFT)) {
-                        if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
-                            return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-                case 2:
-                    if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
-                        if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
-                            return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-                case -3:
-                    if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
-                        if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
-                            return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-                case 3:
-                    if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
-                        if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
-                            return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-                case -4:
-                    if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
-                        if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
-                            return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-                case 4:
-                    if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
-                        if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
-                            return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-            }
-#endif
-            if ((sizeof(int) <= sizeof(long))) {
-                __PYX_VERIFY_RETURN_INT_EXC(int, long, PyLong_AsLong(x))
-#ifdef HAVE_LONG_LONG
-            } else if ((sizeof(int) <= sizeof(PY_LONG_LONG))) {
-                __PYX_VERIFY_RETURN_INT_EXC(int, PY_LONG_LONG, PyLong_AsLongLong(x))
-#endif
-            }
-        }
-        {
-#if (CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available, cannot convert large numbers");
-#else
-            int val;
-            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
-            if (likely(v) && !PyLong_Check(v)) {
-                PyObject *tmp = v;
-                v = PyNumber_Long(tmp);
-                Py_DECREF(tmp);
-            }
- #endif
-            if (likely(v)) {
-                int one = 1; int is_little = (int)*(unsigned char *)&one;
-                unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
-                Py_DECREF(v);
-                if (likely(!ret))
-                    return val;
-            }
-#endif
-            return (int) -1;
-        }
-    } else {
-        int val;
-        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
-        if (!tmp) return (int) -1;
-        val = __Pyx_PyInt_As_int(tmp);
-        Py_DECREF(tmp);
-        return val;
+/* FormatTypeName */
+#if CYTHON_COMPILING_IN_LIMITED_API
+static __Pyx_TypeName
+__Pyx_PyType_GetName(PyTypeObject* tp)
+{
+    PyObject *name = __Pyx_PyObject_GetAttrStr((PyObject *)tp,
+                                               __pyx_n_s_name_2);
+    if (unlikely(name == NULL) || unlikely(!PyUnicode_Check(name))) {
+        PyErr_Clear();
+        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__40));
     }
-raise_overflow:
-    PyErr_SetString(PyExc_OverflowError,
-        "value too large to convert to int");
-    return (int) -1;
-raise_neg_overflow:
-    PyErr_SetString(PyExc_OverflowError,
-        "can't convert negative value to int");
-    return (int) -1;
+    return name;
 }
+#endif
 
 /* FastTypeChecks */
 #if CYTHON_COMPILING_IN_CPYTHON
 static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
     while (a) {
         a = __Pyx_PyType_GetSlot(a, tp_base, PyTypeObject*);
         if (a == b)
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/process_cpp.pyx` & `rapidfuzz-2.9.0/src/rapidfuzz/process_cpp_impl.pyx`

 * *Files 19% similar despite different names*

```diff
@@ -1,37 +1,42 @@
 # distutils: language=c++
 # cython: language_level=3, binding=True, linetrace=True
 
 from rapidfuzz.utils import default_process
-from rapidfuzz.fuzz import WRatio
+from rapidfuzz.fuzz import WRatio, ratio
 
 from libcpp cimport bool
 from libcpp.vector cimport vector
 from libcpp cimport algorithm
 from libcpp.utility cimport move
 from libc.stdint cimport uint8_t, int32_t, uint64_t, int64_t
 from libc.math cimport floor
 
 from cpython.list cimport PyList_New, PyList_SET_ITEM
 from cpython.ref cimport Py_INCREF
+cimport cython
 from cython.operator cimport dereference
 from cpython.exc cimport PyErr_CheckSignals
+from cpython cimport Py_buffer
+from cpython.buffer cimport PyBUF_ND, PyBUF_SIMPLE, PyBUF_F_CONTIGUOUS
+from cpython.object cimport PyObject
 
 from cpp_common cimport (
     PyObjectWrapper, RF_StringWrapper, RF_KwargsWrapper,
     conv_sequence, get_score_cutoff_f64, get_score_cutoff_i64
 )
 
 import heapq
 from array import array
 
 from rapidfuzz_capi cimport (
-    RF_Kwargs, RF_String, RF_Scorer, RF_ScorerFunc,
+    RF_Preprocess, RF_Kwargs, RF_String, RF_Scorer, RF_ScorerFunc,
     RF_Preprocessor, RF_ScorerFlags,
-    RF_SCORER_FLAG_RESULT_F64, RF_SCORER_FLAG_RESULT_I64
+    RF_SCORER_FLAG_RESULT_F64, RF_SCORER_FLAG_RESULT_I64,
+    RF_SCORER_FLAG_SYMMETRIC
 )
 from cpython.pycapsule cimport PyCapsule_IsValid, PyCapsule_GetPointer
 
 cdef extern from "process_cpp.hpp":
     cdef cppclass ExtractComp:
         ExtractComp()
         ExtractComp(const RF_ScorerFlags* scorer_flags)
@@ -80,14 +85,44 @@
     cdef vector[ListMatchElem[T]] extract_list_impl[T](
         const RF_Kwargs*, const RF_ScorerFlags*, RF_Scorer*,
         const RF_StringWrapper&, const vector[ListStringElem]&, T) except +
 
     cdef bool is_lowest_score_worst[T](const RF_ScorerFlags* scorer_flags)
     cdef T get_optimal_score[T](const RF_ScorerFlags* scorer_flags)
 
+    cpdef enum class MatrixType:
+        UNDEFINED = 0
+        FLOAT32 = 1
+        FLOAT64 = 2
+        INT8 = 3
+        INT16 = 4
+        INT32 = 5
+        INT64 = 6
+        UINT8 = 7
+        UINT16 = 8
+        UINT32 = 9
+        UINT64 = 10
+
+    cdef cppclass RfMatrix "Matrix":
+        RfMatrix() except +
+        RfMatrix(MatrixType, size_t, size_t) except +
+        int get_dtype_size() except +
+        const char* get_format() except +
+        void set[T](size_t, size_t, T) except +
+
+        MatrixType m_dtype
+        size_t m_rows
+        size_t m_cols
+        void* m_matrix
+
+    RfMatrix cdist_single_list_impl[T](  const RF_Kwargs*, RF_Scorer*,
+        const vector[RF_StringWrapper]&, MatrixType, int, T) except +
+    RfMatrix cdist_two_lists_impl[T](    const RF_Kwargs*, RF_Scorer*,
+        const vector[RF_StringWrapper]&, const vector[RF_StringWrapper]&, MatrixType, int, T) except +
+
 cdef inline vector[DictStringElem] preprocess_dict(queries, processor) except *:
     cdef vector[DictStringElem] proc_queries
     cdef int64_t queries_len = <int64_t>len(queries)
     cdef RF_String proc_str
     cdef RF_Preprocessor* processor_context = NULL
     proc_queries.reserve(queries_len)
     cdef int64_t i
@@ -541,130 +576,14 @@
         if score == optimal_score:
             break
 
     return (result_choice, result_score, result_index) if result_choice is not None else None
 
 
 def extractOne(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):
-    """
-    Find the best match in a list of choices. When multiple elements have the same similarity,
-    the first element is returned.
-
-    Parameters
-    ----------
-    query : Sequence[Hashable]
-        string we want to find
-    choices : Iterable[Sequence[Hashable]] | Mapping[Sequence[Hashable]]
-        list of all strings the query should be compared with or dict with a mapping
-        {<result>: <string to compare>}
-    scorer : Callable, optional
-        Optional callable that is used to calculate the matching score between
-        the query and each choice. This can be any of the scorers included in RapidFuzz
-        (both scorers that calculate the edit distance or the normalized edit distance), or
-        a custom function, which returns a normalized edit distance.
-        fuzz.WRatio is used by default.
-    processor : Callable, optional
-        Optional callable that reformats the strings.
-        utils.default_process is used by default, which lowercases the strings and trims whitespace
-    score_cutoff : Any, optional
-        Optional argument for a score threshold. When an edit distance is used this represents the maximum
-        edit distance and matches with a `distance <= score_cutoff` are ignored. When a
-        normalized edit distance is used this represents the minimal similarity
-        and matches with a `similarity >= score_cutoff` are ignored. Default is None, which deactivates this behaviour.
-    **kwargs : Any, optional
-        any other named parameters are passed to the scorer. This can be used to pass
-        e.g. weights to string_metric.levenshtein
-
-    Returns
-    -------
-    Tuple[Sequence[Hashable], Any, Any]
-        Returns the best match in form of a Tuple with 3 elements. The values stored in the
-        tuple depend on the types of the input arguments.
-
-        * The first element is always the `choice`, which is the value thats compared to the query.
-
-        * The second value represents the similarity calculated by the scorer. This can be:
-
-          * An edit distance (distance is 0 for a perfect match and > 0 for non perfect matches).
-            In this case only choices which have a `distance <= score_cutoff` are returned.
-            An example of a scorer with this behavior is `string_metric.levenshtein`.
-          * A normalized edit distance (similarity is a score between 0 and 100, with 100 being a perfect match).
-            In this case only choices which have a `similarity >= score_cutoff` are returned.
-            An example of a scorer with this behavior is `string_metric.normalized_levenshtein`.
-
-          Note, that for all scorers, which are not provided by RapidFuzz, only normalized edit distances are supported.
-
-        * The third parameter depends on the type of the `choices` argument it is:
-
-          * The `index of choice` when choices is a simple iterable like a list
-          * The `key of choice` when choices is a mapping like a dict, or a pandas Series
-
-    None
-        When no choice has a `similarity >= score_cutoff`/`distance <= score_cutoff` None is returned
-
-    Examples
-    --------
-
-    >>> from rapidfuzz.process import extractOne
-    >>> from rapidfuzz.string_metric import levenshtein, normalized_levenshtein
-    >>> from rapidfuzz.fuzz import ratio
-
-    extractOne can be used with normalized edit distances.
-
-    >>> extractOne("abcd", ["abce"], scorer=ratio)
-    ("abcd", 75.0, 1)
-    >>> extractOne("abcd", ["abce"], scorer=normalized_levenshtein)
-    ("abcd", 75.0, 1)
-
-    extractOne can be used with edit distances as well.
-
-    >>> extractOne("abcd", ["abce"], scorer=levenshtein)
-    ("abce", 1, 0)
-
-    additional settings of the scorer can be passed as keyword arguments to extractOne
-
-    >>> extractOne("abcd", ["abce"], scorer=levenshtein, weights=(1,1,2))
-    ("abcde", 2, 1)
-
-    when a mapping is used for the choices the key of the choice is returned instead of the List index
-
-    >>> extractOne("abcd", {"key": "abce"}, scorer=ratio)
-    ("abcd", 75.0, "key")
-
-    By default each string is preprocessed using `utils.default_process`, which lowercases the strings,
-    replaces non alphanumeric characters with whitespaces and trims whitespaces from start and end of them.
-    This behavior can be changed by passing a custom function, or None to disable the behavior. Preprocessing
-    can take a significant part of the runtime, so it makes sense to disable it, when it is not required.
-
-
-    >>> extractOne("abcd", ["abdD"], scorer=ratio)
-    ("abcD", 100.0, 0)
-    >>> extractOne("abcd", ["abdD"], scorer=ratio, processor=None)
-    ("abcD", 75.0, 0)
-    >>> extractOne("abcd", ["abdD"], scorer=ratio, processor=lambda s: s.upper())
-    ("abcD", 100.0, 0)
-
-    When only results with a similarity above a certain threshold are relevant, the parameter score_cutoff can be
-    used to filter out results with a lower similarity. This threshold is used by some of the scorers to exit early,
-    when they are sure, that the similarity is below the threshold.
-    For normalized edit distances all results with a similarity below score_cutoff are filtered out
-
-    >>> extractOne("abcd", ["abce"], scorer=ratio)
-    ("abce", 75.0, 0)
-    >>> extractOne("abcd", ["abce"], scorer=ratio, score_cutoff=80)
-    None
-
-    For edit distances all results with an edit distance above the score_cutoff are filtered out
-
-    >>> extractOne("abcd", ["abce"], scorer=levenshtein, weights=(1,1,2))
-    ("abce", 2, 0)
-    >>> extractOne("abcd", ["abce"], scorer=levenshtein, weights=(1,1,2), score_cutoff=1)
-    None
-
-    """
     cdef RF_Scorer* scorer_context = NULL
     cdef RF_ScorerFlags scorer_flags
 
     if query is None:
         return None
 
     if processor is True:
@@ -903,73 +822,14 @@
     if lowest_score_worst:
         return heapq.nlargest(limit, result_list, key=lambda i: i[1])
     else:
         return heapq.nsmallest(limit, result_list, key=lambda i: i[1])
 
 
 def extract(query, choices, *, scorer=WRatio, processor=default_process, limit=5, score_cutoff=None, **kwargs):
-    """
-    Find the best matches in a list of choices. The list is sorted by the similarity.
-    When multiple choices have the same similarity, they are sorted by their index
-
-    Parameters
-    ----------
-    query : Sequence[Hashable]
-        string we want to find
-    choices : Collection[Sequence[Hashable]] | Mapping[Sequence[Hashable]]
-        list of all strings the query should be compared with or dict with a mapping
-        {<result>: <string to compare>}
-    scorer : Callable, optional
-        Optional callable that is used to calculate the matching score between
-        the query and each choice. This can be any of the scorers included in RapidFuzz
-        (both scorers that calculate the edit distance or the normalized edit distance), or
-        a custom function, which returns a normalized edit distance.
-        fuzz.WRatio is used by default.
-    processor : Callable, optional
-        Optional callable that reformats the strings.
-        utils.default_process is used by default, which lowercases the strings and trims whitespace
-    limit : int
-        maximum amount of results to return
-    score_cutoff : Any, optional
-        Optional argument for a score threshold. When an edit distance is used this represents the maximum
-        edit distance and matches with a `distance <= score_cutoff` are ignored. When a
-        normalized edit distance is used this represents the minimal similarity
-        and matches with a `similarity >= score_cutoff` are ignored. Default is None, which deactivates this behaviour.
-    **kwargs : Any, optional
-        any other named parameters are passed to the scorer. This can be used to pass
-        e.g. weights to string_metric.levenshtein
-
-    Returns
-    -------
-    List[Tuple[Sequence[Hashable], Any, Any]]
-        The return type is always a List of Tuples with 3 elements. However the values stored in the
-        tuple depend on the types of the input arguments.
-
-        * The first element is always the `choice`, which is the value thats compared to the query.
-
-        * The second value represents the similarity calculated by the scorer. This can be:
-
-          * An edit distance (distance is 0 for a perfect match and > 0 for non perfect matches).
-            In this case only choices which have a `distance <= max` are returned.
-            An example of a scorer with this behavior is `string_metric.levenshtein`.
-          * A normalized edit distance (similarity is a score between 0 and 100, with 100 being a perfect match).
-            In this case only choices which have a `similarity >= score_cutoff` are returned.
-            An example of a scorer with this behavior is `string_metric.normalized_levenshtein`.
-
-          Note, that for all scorers, which are not provided by RapidFuzz, only normalized edit distances are supported.
-
-        * The third parameter depends on the type of the `choices` argument it is:
-
-          * The `index of choice` when choices is a simple iterable like a list
-          * The `key of choice` when choices is a mapping like a dict, or a pandas Series
-
-        The list is sorted by `score_cutoff` or `max` depending on the scorer used. The first element in the list
-        has the `highest similarity`/`smallest distance`.
-
-    """
     cdef RF_Scorer* scorer_context = NULL
     cdef RF_ScorerFlags scorer_flags
 
     if query is None:
         return []
 
     if processor is True:
@@ -1012,67 +872,14 @@
     if hasattr(choices, "items"):
         return py_extract_dict(query, choices, scorer, processor, limit, score_cutoff, worst_score, optimal_score, kwargs)
     else:
         return py_extract_list(query, choices, scorer, processor, limit, score_cutoff, worst_score, optimal_score, kwargs)
 
 
 def extract_iter(query, choices, *, scorer=WRatio, processor=default_process, score_cutoff=None, **kwargs):
-    """
-    Find the best match in a list of choices
-
-    Parameters
-    ----------
-    query : Sequence[Hashable]
-        string we want to find
-    choices : Iterable[Sequence[Hashable]] | Mapping[Sequence[Hashable]]
-        list of all strings the query should be compared with or dict with a mapping
-        {<result>: <string to compare>}
-    scorer : Callable, optional
-        Optional callable that is used to calculate the matching score between
-        the query and each choice. This can be any of the scorers included in RapidFuzz
-        (both scorers that calculate the edit distance or the normalized edit distance), or
-        a custom function, which returns a normalized edit distance.
-        fuzz.WRatio is used by default.
-    processor : Callable, optional
-        Optional callable that reformats the strings.
-        utils.default_process is used by default, which lowercases the strings and trims whitespace
-    score_cutoff : Any, optional
-        Optional argument for a score threshold. When an edit distance is used this represents the maximum
-        edit distance and matches with a `distance <= score_cutoff` are ignored. When a
-        normalized edit distance is used this represents the minimal similarity
-        and matches with a `similarity >= score_cutoff` are ignored. Default is None, which deactivates this behaviour.
-    **kwargs : Any, optional
-        any other named parameters are passed to the scorer. This can be used to pass
-        e.g. weights to string_metric.levenshtein
-
-    Yields
-    -------
-    Tuple[Sequence[Hashable], Any, Any]
-        Yields similarity between the query and each choice in form of a Tuple with 3 elements.
-        The values stored in the tuple depend on the types of the input arguments.
-
-        * The first element is always the current `choice`, which is the value thats compared to the query.
-
-        * The second value represents the similarity calculated by the scorer. This can be:
-
-          * An edit distance (distance is 0 for a perfect match and > 0 for non perfect matches).
-            In this case only choices which have a `distance <= max` are yielded.
-            An example of a scorer with this behavior is `string_metric.levenshtein`.
-          * A normalized edit distance (similarity is a score between 0 and 100, with 100 being a perfect match).
-            In this case only choices which have a `similarity >= score_cutoff` are yielded.
-            An example of a scorer with this behavior is `string_metric.normalized_levenshtein`.
-
-          Note, that for all scorers, which are not provided by RapidFuzz, only normalized edit distances are supported.
-
-        * The third parameter depends on the type of the `choices` argument it is:
-
-          * The `index of choice` when choices is a simple iterable like a list
-          * The `key of choice` when choices is a mapping like a dict, or a pandas Series
-
-    """
     cdef RF_Scorer* scorer_context = NULL
     cdef RF_ScorerFlags scorer_flags
     cdef RF_Preprocessor* processor_context = NULL
     cdef RF_KwargsWrapper kwargs_context
 
     def extract_iter_dict_f64():
         """
@@ -1342,7 +1149,206 @@
     kwargs["processor"] = None
     kwargs["score_cutoff"] = score_cutoff
 
     if hasattr(choices, "items"):
         yield from py_extract_iter_dict(worst_score, optimal_score)
     else:
         yield from py_extract_iter_list(worst_score, optimal_score)
+
+
+FLOAT32 = MatrixType.FLOAT32
+FLOAT64 = MatrixType.FLOAT64
+INT8 = MatrixType.INT8
+INT16 = MatrixType.INT16
+INT32 = MatrixType.INT32
+INT64 = MatrixType.INT64
+UINT8 = MatrixType.UINT8
+UINT16 = MatrixType.UINT16
+UINT32 = MatrixType.UINT32
+UINT64 = MatrixType.UINT64
+
+cdef inline vector[PyObjectWrapper] preprocess_py(queries, processor) except *:
+    cdef vector[PyObjectWrapper] proc_queries
+    cdef int64_t queries_len = <int64_t>len(queries)
+    proc_queries.reserve(queries_len)
+
+    # processor None/False
+    if not processor:
+        for query in queries:
+            proc_queries.emplace_back(<PyObject*>query)
+    # processor has to be called through python
+    else:
+        for query in queries:
+            proc_query = processor(query)
+            proc_queries.emplace_back(<PyObject*>proc_query)
+
+    return move(proc_queries)
+
+cdef inline vector[RF_StringWrapper] preprocess(queries, processor) except *:
+    cdef vector[RF_StringWrapper] proc_queries
+    cdef int64_t queries_len = <int64_t>len(queries)
+    cdef RF_String proc_str
+    cdef RF_Preprocessor* processor_context = NULL
+    proc_queries.reserve(queries_len)
+
+    # No processor
+    if not processor:
+        for query in queries:
+            proc_queries.emplace_back(conv_sequence(query))
+    else:
+        processor_capsule = getattr(processor, '_RF_Preprocess', processor)
+        if PyCapsule_IsValid(processor_capsule, NULL):
+            processor_context = <RF_Preprocessor*>PyCapsule_GetPointer(processor_capsule, NULL)
+
+        # use RapidFuzz C-Api
+        if processor_context != NULL and processor_context.version == 1:
+            for query in queries:
+                processor_context.preprocess(query, &proc_str)
+                proc_queries.emplace_back(proc_str)
+
+        # Call Processor through Python
+        else:
+            for query in queries:
+                proc_query = processor(query)
+                proc_queries.emplace_back(conv_sequence(proc_query), <PyObject*>proc_query)
+
+    return move(proc_queries)
+
+cdef inline MatrixType dtype_to_type_num_f64(dtype) except MatrixType.UNDEFINED:
+    if dtype is None:
+        return MatrixType.FLOAT32
+    return <MatrixType>dtype
+
+cdef inline MatrixType dtype_to_type_num_i64(dtype) except MatrixType.UNDEFINED:
+    if dtype is None:
+        return MatrixType.INT32
+    return <MatrixType>dtype
+
+from cpython cimport Py_buffer
+from libcpp.vector cimport vector
+
+cdef class Matrix:
+    cdef Py_ssize_t shape[2]
+    cdef Py_ssize_t strides[2]
+    cdef RfMatrix matrix
+
+    def __getbuffer__(self, Py_buffer *buffer, int flags):
+        self.shape[0] = self.matrix.m_rows
+        self.shape[1] = self.matrix.m_cols
+        self.strides[1] = self.matrix.get_dtype_size()
+        self.strides[0] = self.matrix.m_cols * self.strides[1]
+
+        buffer.buf = <char *>self.matrix.m_matrix
+        buffer.format = <char *>self.matrix.get_format()
+        buffer.internal = NULL
+        buffer.itemsize = self.matrix.get_dtype_size()
+        buffer.len = self.matrix.m_rows * self.matrix.m_cols * self.matrix.get_dtype_size()
+        buffer.ndim = 2
+        buffer.obj = self
+        buffer.readonly = 0
+        buffer.shape = self.shape
+        buffer.strides = self.strides
+        buffer.suboffsets = NULL
+
+    def __releasebuffer__(self, Py_buffer *buffer):
+        pass
+
+cdef cdist_two_lists(queries, choices, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):
+    proc_queries = preprocess(queries, processor)
+    proc_choices = preprocess(choices, processor)
+    flags = dereference(scorer_flags).flags
+    cdef Matrix matrix = Matrix()
+
+    if flags & RF_SCORER_FLAG_RESULT_F64:
+        matrix.matrix = cdist_two_lists_impl(
+            kwargs, scorer, proc_queries, proc_choices,
+            dtype_to_type_num_f64(dtype),
+            c_workers,
+            get_score_cutoff_f64(score_cutoff, scorer_flags))
+
+    elif flags & RF_SCORER_FLAG_RESULT_I64:
+        matrix.matrix = cdist_two_lists_impl(
+            kwargs, scorer, proc_queries, proc_choices,
+            dtype_to_type_num_i64(dtype),
+            c_workers,
+            get_score_cutoff_i64(score_cutoff, scorer_flags))
+    else:
+        raise ValueError("scorer does not properly use the C-API")
+
+    return matrix
+
+cdef Matrix cdist_single_list(queries, RF_Scorer* scorer, const RF_ScorerFlags* scorer_flags, processor, score_cutoff, dtype, int c_workers, const RF_Kwargs* kwargs):
+    proc_queries = preprocess(queries, processor)
+    flags = dereference(scorer_flags).flags
+    cdef Matrix matrix = Matrix()
+
+    if flags & RF_SCORER_FLAG_RESULT_F64:
+        matrix.matrix = cdist_single_list_impl(
+            kwargs, scorer, proc_queries,
+            dtype_to_type_num_f64(dtype),
+            c_workers,
+            get_score_cutoff_f64(score_cutoff, scorer_flags))
+
+    elif flags & RF_SCORER_FLAG_RESULT_I64:
+        matrix.matrix = cdist_single_list_impl(
+            kwargs, scorer, proc_queries,
+            dtype_to_type_num_i64(dtype),
+            c_workers,
+            get_score_cutoff_i64(score_cutoff, scorer_flags))
+    else:
+        raise ValueError("scorer does not properly use the C-API")
+
+    return matrix
+
+
+@cython.boundscheck(False)
+@cython.wraparound(False)
+cdef cdist_py(queries, choices, scorer, processor, score_cutoff, dtype, workers, dict kwargs):
+    proc_queries = preprocess_py(queries, processor)
+    proc_choices = preprocess_py(choices, processor)
+    cdef double score
+    cdef Matrix matrix = Matrix()
+    c_dtype = dtype_to_type_num_f64(dtype)
+    matrix.matrix = RfMatrix(c_dtype, proc_queries.size(), proc_choices.size())
+
+    kwargs["processor"] = None
+    kwargs["score_cutoff"] = score_cutoff
+
+    for i in range(proc_queries.size()):
+        for j in range(proc_choices.size()):
+            score = scorer(<object>proc_queries[i].obj, <object>proc_choices[j].obj,**kwargs)
+            matrix.matrix.set(i, j, score)
+
+    return matrix
+
+
+def cdist(queries, choices, *, scorer=ratio, processor=None, score_cutoff=None, dtype=None, workers=1, **kwargs):
+    cdef RF_Scorer* scorer_context = NULL
+    cdef RF_ScorerFlags scorer_flags
+
+    if processor is True:
+        # todo: deprecate this
+        processor = default_process
+    elif processor is False:
+        processor = None
+
+    scorer_capsule = getattr(scorer, '_RF_Scorer', scorer)
+    if PyCapsule_IsValid(scorer_capsule, NULL):
+        scorer_context = <RF_Scorer*>PyCapsule_GetPointer(scorer_capsule, NULL)
+
+    if scorer_context:
+        if dereference(scorer_context).version == 1:
+            kwargs_context = RF_KwargsWrapper()
+            dereference(scorer_context).kwargs_init(&kwargs_context.kwargs, kwargs)
+            dereference(scorer_context).get_scorer_flags(&kwargs_context.kwargs, &scorer_flags)
+
+            # scorer(queries[i], choices[j]) == scorer(queries[j], choices[i])
+            if scorer_flags.flags & RF_SCORER_FLAG_SYMMETRIC and queries is choices:
+                return cdist_single_list(
+                    queries, scorer_context, &scorer_flags, processor,
+                    score_cutoff, dtype, workers, &kwargs_context.kwargs)
+            else:
+                return cdist_two_lists(
+                    queries, choices, scorer_context, &scorer_flags, processor,
+                    score_cutoff, dtype, workers, &kwargs_context.kwargs)
+
+    return cdist_py(queries, choices, scorer, processor, score_cutoff, dtype, workers, kwargs)
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/process_py.py` & `rapidfuzz-2.9.0/src/rapidfuzz/process_py.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,12 +1,12 @@
 # SPDX-License-Identifier: MIT
 # Copyright (C) 2022 Max Bachmann
 
 from rapidfuzz.utils import default_process
-from rapidfuzz.fuzz import WRatio
+from rapidfuzz.fuzz import WRatio, ratio
 import heapq
 
 
 def _get_scorer_flags_py(scorer, kwargs):
     params = getattr(scorer, "_RF_ScorerPy", None)
     if params is not None:
         flags = params["get_scorer_flags"](**kwargs)
@@ -376,7 +376,126 @@
     result_iter = extract_iter(
         query, choices, processor=processor, scorer=scorer, score_cutoff=score_cutoff
     )
     if lowest_score_worst:
         return heapq.nlargest(limit, result_iter, key=lambda i: i[1])
     else:
         return heapq.nsmallest(limit, result_iter, key=lambda i: i[1])
+
+
+def _dtype_to_type_num(dtype, scorer, **kwargs):
+    import numpy as np
+
+    if dtype is not None:
+        return dtype
+
+    params = getattr(scorer, "_RF_ScorerPy", None)
+    if params is not None:
+        flags = params["get_scorer_flags"](**kwargs)
+        if flags["flags"] & (1 << 6):
+            return np.int32
+        else:
+            return np.float32
+
+    return np.float32
+
+
+def cdist(
+    queries,
+    choices,
+    *,
+    scorer=ratio,
+    processor=None,
+    score_cutoff=None,
+    dtype=None,
+    workers=1,
+    **kwargs
+):
+    """
+    Compute distance/similarity between each pair of the two collections of inputs.
+
+    Parameters
+    ----------
+    queries : Collection[Sequence[Hashable]]
+        list of all strings the queries
+    choices : Collection[Sequence[Hashable]]
+        list of all strings the query should be compared
+    scorer : Callable, optional
+        Optional callable that is used to calculate the matching score between
+        the query and each choice. This can be:
+
+        - a scorer using the RapidFuzz C-API like the builtin scorers in RapidFuzz,
+          which can return a distance or similarity between two strings. Further details can be found here.
+        - a Python function which returns a similarity between two strings in the range 0-100. This is not
+          recommended, since it is far slower than a scorer using the RapidFuzz C-API.
+
+        fuzz.ratio is used by default.
+    processor : Callable, optional
+        Optional callable that is used to preprocess the strings before
+        comparing them. Default is None, which deactivates this behaviour.
+    score_cutoff : Any, optional
+        Optional argument for a score threshold to be passed to the scorer.
+        Default is None, which deactivates this behaviour.
+    dtype : data-type, optional
+        The desired data-type for the result array.Depending on the scorer type the following
+        dtypes are supported:
+
+        - similarity:
+          - np.float32, np.float64
+          - np.uint8 -> stores fixed point representation of the result scaled to a range 0-100
+        - distance:
+          - np.int8, np.int16, np.int32, np.int64
+
+        If not given, then the type will be np.float32 for similarities and np.int32 for distances.
+    workers : int, optional
+        The calculation is subdivided into workers sections and evaluated in parallel.
+        Supply -1 to use all available CPU cores.
+        This argument is only available for scorers using the RapidFuzz C-API so far, since it
+        releases the Python GIL.
+    **kwargs : Any, optional
+        any other named parameters are passed to the scorer. This can be used to pass
+        e.g. weights to string_metric.levenshtein
+
+    Returns
+    -------
+    ndarray
+        Returns a matrix of dtype with the distance/similarity between each pair
+        of the two collections of inputs.
+    """
+    import numpy as np
+
+    dtype = _dtype_to_type_num(dtype, scorer, **kwargs)
+    results = np.zeros((len(queries), len(choices)), dtype=dtype)
+
+    if queries is choices:
+        if processor is None:
+            proc_queries = queries
+        else:
+            proc_queries = [processor(x) for x in queries]
+
+        for i, query in enumerate(proc_queries):
+            results[i, i] = scorer(
+                query, query, processor=None, score_cutoff=score_cutoff, **kwargs
+            )
+            for j in range(i + 1, len(proc_queries)):
+                results[i, j] = results[j, i] = scorer(
+                    query,
+                    proc_queries[j],
+                    processor=None,
+                    score_cutoff=score_cutoff,
+                    **kwargs
+                )
+    else:
+        if processor is None:
+            proc_queries = queries
+            proc_choices = choices
+        else:
+            proc_queries = [processor(x) for x in queries]
+            proc_choices = [processor(x) for x in choices]
+
+        for i, query in enumerate(proc_queries):
+            for j, choice in enumerate(proc_choices):
+                results[i, j] = scorer(
+                    query, choice, processor=None, score_cutoff=score_cutoff, **kwargs
+                )
+
+    return results
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/string_metric.pyi` & `rapidfuzz-2.9.0/src/rapidfuzz/string_metric.pyi`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/unicodetype_db.h` & `rapidfuzz-2.9.0/src/rapidfuzz/unicodetype_db.h`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/utils.cpp` & `rapidfuzz-2.9.0/src/rapidfuzz/utils.cpp`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/utils.hpp` & `rapidfuzz-2.9.0/src/rapidfuzz/utils.hpp`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/utils_cpp.hpp` & `rapidfuzz-2.9.0/src/rapidfuzz/utils_cpp.hpp`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/utils_cpp.pyx` & `rapidfuzz-2.9.0/src/rapidfuzz/utils_cpp.pyx`

 * *Files 16% similar despite different names*

```diff
@@ -13,33 +13,14 @@
 
 cdef extern from "utils_cpp.hpp":
     object default_process_impl(object) nogil except +
     void validate_string(object py_str, const char* err) except +
     RF_String default_process_func(RF_String sentence) except +
 
 def default_process(sentence):
-    """
-    This function preprocesses a string by:
-
-    * removing all non alphanumeric characters
-
-    * trimming whitespaces
-    
-    * converting all characters to lower case
-
-    Parameters
-    ----------
-    sentence : str
-        String to preprocess
-
-    Returns
-    -------
-    processed_string : str
-        processed string
-    """
     validate_string(sentence, "sentence must be a String")
     return default_process_impl(sentence)
 
 
 cdef bool default_process_capi(sentence, RF_String* str_) except False:
     proc_str = conv_sequence(sentence)
     try:
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz/utils_py.py` & `rapidfuzz-2.9.0/src/rapidfuzz/utils_py.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz.egg-info/PKG-INFO` & `rapidfuzz-2.9.0/src/rapidfuzz.egg-info/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: rapidfuzz
-Version: 2.8.0
+Version: 2.9.0
 Summary: rapid fuzzy string matching
 Home-page: https://github.com/maxbachmann/RapidFuzz
 Author: Max Bachmann
 Author-email: pypi@maxbachmann.de
 License: MIT
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.6
```

#### html2text {}

```diff
@@ -1,8 +1,8 @@
-Metadata-Version: 2.1 Name: rapidfuzz Version: 2.8.0 Summary: rapid fuzzy
+Metadata-Version: 2.1 Name: rapidfuzz Version: 2.9.0 Summary: rapid fuzzy
 string matching Home-page: https://github.com/maxbachmann/RapidFuzz Author: Max
 Bachmann Author-email: pypi@maxbachmann.de License: MIT Classifier: Programming
 Language :: Python :: 3 Classifier: Programming Language :: Python :: 3.6
 Classifier: Programming Language :: Python :: 3.7 Classifier: Programming
 Language :: Python :: 3.8 Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python :: 3.10 Classifier: Programming
 Language :: Python :: 3.11 Classifier: License :: OSI Approved :: MIT License
```

### Comparing `rapidfuzz-2.8.0/src/rapidfuzz.egg-info/SOURCES.txt` & `rapidfuzz-2.9.0/src/rapidfuzz.egg-info/SOURCES.txt`

 * *Files 13% similar despite different names*

```diff
@@ -29,63 +29,71 @@
 extern/rapidfuzz-cpp/rapidfuzz/distance/Hamming_impl.hpp
 extern/rapidfuzz-cpp/rapidfuzz/distance/Indel.hpp
 extern/rapidfuzz-cpp/rapidfuzz/distance/Indel_impl.hpp
 extern/rapidfuzz-cpp/rapidfuzz/distance/LCSseq.hpp
 extern/rapidfuzz-cpp/rapidfuzz/distance/LCSseq_impl.hpp
 extern/rapidfuzz-cpp/rapidfuzz/distance/Levenshtein.hpp
 extern/rapidfuzz-cpp/rapidfuzz/distance/Levenshtein_impl.hpp
+extern/rapidfuzz-cpp/rapidfuzz/distance/OSA.hpp
+extern/rapidfuzz-cpp/rapidfuzz/distance/OSA_impl.hpp
 extern/taskflow/CMakeLists.txt
 extern/taskflow/LICENSE
 extern/taskflow/TaskflowConfig.cmake.in
-extern/taskflow/taskflow/declarations.hpp
 extern/taskflow/taskflow/taskflow.hpp
+extern/taskflow/taskflow/algorithm/critical.hpp
 extern/taskflow/taskflow/algorithm/for_each.hpp
+extern/taskflow/taskflow/algorithm/pipeline.hpp
 extern/taskflow/taskflow/algorithm/reduce.hpp
+extern/taskflow/taskflow/algorithm/sort.hpp
+extern/taskflow/taskflow/algorithm/transform.hpp
+extern/taskflow/taskflow/core/declarations.hpp
+extern/taskflow/taskflow/core/environment.hpp
 extern/taskflow/taskflow/core/error.hpp
+extern/taskflow/taskflow/core/executor-module-opt.hpp
 extern/taskflow/taskflow/core/executor.hpp
 extern/taskflow/taskflow/core/flow_builder.hpp
 extern/taskflow/taskflow/core/graph.hpp
 extern/taskflow/taskflow/core/notifier.hpp
 extern/taskflow/taskflow/core/observer.hpp
+extern/taskflow/taskflow/core/semaphore.hpp
 extern/taskflow/taskflow/core/task.hpp
 extern/taskflow/taskflow/core/taskflow.hpp
 extern/taskflow/taskflow/core/topology.hpp
 extern/taskflow/taskflow/core/tsq.hpp
-extern/taskflow/taskflow/nstd/variant.hpp
+extern/taskflow/taskflow/core/worker.hpp
 extern/taskflow/taskflow/utility/iterator.hpp
+extern/taskflow/taskflow/utility/math.hpp
 extern/taskflow/taskflow/utility/object_pool.hpp
 extern/taskflow/taskflow/utility/os.hpp
-extern/taskflow/taskflow/utility/passive_vector.hpp
 extern/taskflow/taskflow/utility/singleton.hpp
-extern/taskflow/taskflow/utility/stringify.hpp
+extern/taskflow/taskflow/utility/small_vector.hpp
+extern/taskflow/taskflow/utility/stream.hpp
 extern/taskflow/taskflow/utility/traits.hpp
 extern/taskflow/taskflow/utility/uuid.hpp
 src/rapidfuzz/CMakeLists.txt
 src/rapidfuzz/__init__.py
 src/rapidfuzz/__init__.pyi
+src/rapidfuzz/_utils.py
+src/rapidfuzz/_utils.pyi
 src/rapidfuzz/cpp_common.hpp
 src/rapidfuzz/cpp_common.pxd
 src/rapidfuzz/fuzz.py
 src/rapidfuzz/fuzz.pyi
 src/rapidfuzz/fuzz_cpp.cxx
 src/rapidfuzz/fuzz_cpp.hpp
 src/rapidfuzz/fuzz_cpp.pyx
 src/rapidfuzz/fuzz_py.py
 src/rapidfuzz/fuzz_py.pyi
 src/rapidfuzz/process.py
 src/rapidfuzz/process.pyi
-src/rapidfuzz/process_cdist_cpp.hpp
-src/rapidfuzz/process_cdist_cpp.py
-src/rapidfuzz/process_cdist_cpp_impl.cxx
-src/rapidfuzz/process_cdist_cpp_impl.pyi
-src/rapidfuzz/process_cdist_cpp_impl.pyx
-src/rapidfuzz/process_cdist_py.py
-src/rapidfuzz/process_cpp.cxx
 src/rapidfuzz/process_cpp.hpp
-src/rapidfuzz/process_cpp.pyx
+src/rapidfuzz/process_cpp.py
+src/rapidfuzz/process_cpp_impl.cxx
+src/rapidfuzz/process_cpp_impl.pyi
+src/rapidfuzz/process_cpp_impl.pyx
 src/rapidfuzz/process_py.py
 src/rapidfuzz/py.typed
 src/rapidfuzz/string_metric.py
 src/rapidfuzz/string_metric.pyi
 src/rapidfuzz/unicodetype_db.h
 src/rapidfuzz/utils.cpp
 src/rapidfuzz/utils.hpp
@@ -99,59 +107,63 @@
 src/rapidfuzz.egg-info/SOURCES.txt
 src/rapidfuzz.egg-info/dependency_links.txt
 src/rapidfuzz.egg-info/requires.txt
 src/rapidfuzz.egg-info/top_level.txt
 src/rapidfuzz/distance/CMakeLists.txt
 src/rapidfuzz/distance/DamerauLevenshtein.py
 src/rapidfuzz/distance/DamerauLevenshtein.pyi
-src/rapidfuzz/distance/DamerauLevenshtein_cpp.cxx
-src/rapidfuzz/distance/DamerauLevenshtein_cpp.pyx
+src/rapidfuzz/distance/DamerauLevenshtein_cpp.py
 src/rapidfuzz/distance/DamerauLevenshtein_py.py
 src/rapidfuzz/distance/DamerauLevenshtein_py.pyi
 src/rapidfuzz/distance/Hamming.py
 src/rapidfuzz/distance/Hamming.pyi
-src/rapidfuzz/distance/Hamming_cpp.cxx
-src/rapidfuzz/distance/Hamming_cpp.pyx
+src/rapidfuzz/distance/Hamming_cpp.py
 src/rapidfuzz/distance/Hamming_py.py
 src/rapidfuzz/distance/Hamming_py.pyi
 src/rapidfuzz/distance/Indel.py
 src/rapidfuzz/distance/Indel.pyi
-src/rapidfuzz/distance/Indel_cpp.cxx
-src/rapidfuzz/distance/Indel_cpp.pyx
+src/rapidfuzz/distance/Indel_cpp.py
 src/rapidfuzz/distance/Indel_py.py
 src/rapidfuzz/distance/Indel_py.pyi
 src/rapidfuzz/distance/Jaro.py
 src/rapidfuzz/distance/Jaro.pyi
 src/rapidfuzz/distance/JaroWinkler.py
 src/rapidfuzz/distance/JaroWinkler.pyi
 src/rapidfuzz/distance/LCSseq.py
 src/rapidfuzz/distance/LCSseq.pyi
-src/rapidfuzz/distance/LCSseq_cpp.cxx
-src/rapidfuzz/distance/LCSseq_cpp.pyx
+src/rapidfuzz/distance/LCSseq_cpp.py
 src/rapidfuzz/distance/LCSseq_py.py
 src/rapidfuzz/distance/LCSseq_py.pyi
 src/rapidfuzz/distance/Levenshtein.py
 src/rapidfuzz/distance/Levenshtein.pyi
-src/rapidfuzz/distance/Levenshtein_cpp.cxx
-src/rapidfuzz/distance/Levenshtein_cpp.pyx
+src/rapidfuzz/distance/Levenshtein_cpp.py
 src/rapidfuzz/distance/Levenshtein_py.py
 src/rapidfuzz/distance/Levenshtein_py.pyi
+src/rapidfuzz/distance/OSA.py
+src/rapidfuzz/distance/OSA.pyi
+src/rapidfuzz/distance/OSA_cpp.py
+src/rapidfuzz/distance/OSA_py.py
+src/rapidfuzz/distance/OSA_py.pyi
 src/rapidfuzz/distance/__init__.py
 src/rapidfuzz/distance/__init__.pyi
 src/rapidfuzz/distance/_initialize_cpp.cxx
 src/rapidfuzz/distance/_initialize_cpp.pxd
 src/rapidfuzz/distance/_initialize_cpp.pyx
 src/rapidfuzz/distance/_initialize_py.py
-src/rapidfuzz/distance/edit_based.hpp
+src/rapidfuzz/distance/metrics.hpp
+src/rapidfuzz/distance/metrics_cpp.cxx
+src/rapidfuzz/distance/metrics_cpp.pyi
+src/rapidfuzz/distance/metrics_cpp.pyx
 tests/test_cpp_fallback.py
 tests/test_fuzz.py
 tests/test_hypothesis.py
 tests/test_process.py
 tests/test_pure_python_fallback.py
 tests/test_string_metric.py
 tests/test_utils.py
 tests/distance/test_DamerauLevenshtein.py
 tests/distance/test_Hamming.py
 tests/distance/test_Indel.py
 tests/distance/test_LCSseq.py
 tests/distance/test_Levenshtein.py
+tests/distance/test_OSA.py
 tests/distance/test_init.py
```

### Comparing `rapidfuzz-2.8.0/tests/distance/test_DamerauLevenshtein.py` & `rapidfuzz-2.9.0/tests/distance/test_DamerauLevenshtein.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/tests/distance/test_Hamming.py` & `rapidfuzz-2.9.0/tests/distance/test_Hamming.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/tests/distance/test_Indel.py` & `rapidfuzz-2.9.0/tests/distance/test_Indel.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/tests/distance/test_LCSseq.py` & `rapidfuzz-2.9.0/tests/distance/test_LCSseq.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/tests/distance/test_Levenshtein.py` & `rapidfuzz-2.9.0/tests/distance/test_Levenshtein.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,14 +1,37 @@
 #!/usr/bin/env python
 # -*- coding: utf-8 -*-
 
 import unittest
 
 from rapidfuzz import process
-from rapidfuzz.distance import Opcodes, Opcode, Levenshtein_cpp, Levenshtein_py
+from rapidfuzz.distance import (
+    Opcodes,
+    Opcode,
+    Levenshtein_cpp,
+    Levenshtein_py,
+    Levenshtein as _Levenshtein,
+)
+
+Levenshtein_cpp.distance._RF_ScorerPy = _Levenshtein.distance._RF_ScorerPy
+Levenshtein_cpp.normalized_distance._RF_ScorerPy = (
+    _Levenshtein.normalized_distance._RF_ScorerPy
+)
+Levenshtein_cpp.similarity._RF_ScorerPy = _Levenshtein.similarity._RF_ScorerPy
+Levenshtein_cpp.normalized_similarity._RF_ScorerPy = (
+    _Levenshtein.normalized_similarity._RF_ScorerPy
+)
+Levenshtein_py.distance._RF_ScorerPy = _Levenshtein.distance._RF_ScorerPy
+Levenshtein_py.normalized_distance._RF_ScorerPy = (
+    _Levenshtein.normalized_distance._RF_ScorerPy
+)
+Levenshtein_py.similarity._RF_ScorerPy = _Levenshtein.similarity._RF_ScorerPy
+Levenshtein_py.normalized_similarity._RF_ScorerPy = (
+    _Levenshtein.normalized_similarity._RF_ScorerPy
+)
 
 
 def isclose(a, b, rel_tol=1e-09, abs_tol=0.0):
     return abs(a - b) <= max(rel_tol * max(abs(a), abs(b)), abs_tol)
 
 
 class CustomHashable:
```

### Comparing `rapidfuzz-2.8.0/tests/distance/test_init.py` & `rapidfuzz-2.9.0/tests/distance/test_init.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/tests/test_fuzz.py` & `rapidfuzz-2.9.0/tests/test_fuzz.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/tests/test_hypothesis.py` & `rapidfuzz-2.9.0/tests/test_hypothesis.py`

 * *Files 6% similar despite different names*

```diff
@@ -3,18 +3,51 @@
 from string import ascii_letters, digits, punctuation
 
 from hypothesis import given, assume, settings
 import hypothesis.strategies as st
 import pytest
 
 from rapidfuzz import fuzz, process, utils, string_metric
-from rapidfuzz.distance import Levenshtein_cpp, Levenshtein_py, Indel_cpp, Indel_py
+from rapidfuzz.distance import (
+    Levenshtein_cpp,
+    Levenshtein_py,
+    Levenshtein as _Levenshtein,
+    Indel_cpp,
+    Indel_py,
+    Indel as _Indel,
+)
 import random
 import numpy as np
 
+Levenshtein_cpp.distance._RF_ScorerPy = _Levenshtein.distance._RF_ScorerPy
+Levenshtein_cpp.normalized_distance._RF_ScorerPy = (
+    _Levenshtein.normalized_distance._RF_ScorerPy
+)
+Levenshtein_cpp.similarity._RF_ScorerPy = _Levenshtein.similarity._RF_ScorerPy
+Levenshtein_cpp.normalized_similarity._RF_ScorerPy = (
+    _Levenshtein.normalized_similarity._RF_ScorerPy
+)
+Levenshtein_py.distance._RF_ScorerPy = _Levenshtein.distance._RF_ScorerPy
+Levenshtein_py.normalized_distance._RF_ScorerPy = (
+    _Levenshtein.normalized_distance._RF_ScorerPy
+)
+Levenshtein_py.similarity._RF_ScorerPy = _Levenshtein.similarity._RF_ScorerPy
+Levenshtein_py.normalized_similarity._RF_ScorerPy = (
+    _Levenshtein.normalized_similarity._RF_ScorerPy
+)
+
+Indel_cpp.distance._RF_ScorerPy = _Indel.distance._RF_ScorerPy
+Indel_cpp.normalized_distance._RF_ScorerPy = _Indel.normalized_distance._RF_ScorerPy
+Indel_cpp.similarity._RF_ScorerPy = _Indel.similarity._RF_ScorerPy
+Indel_cpp.normalized_similarity._RF_ScorerPy = _Indel.normalized_similarity._RF_ScorerPy
+Indel_py.distance._RF_ScorerPy = _Indel.distance._RF_ScorerPy
+Indel_py.normalized_distance._RF_ScorerPy = _Indel.normalized_distance._RF_ScorerPy
+Indel_py.similarity._RF_ScorerPy = _Indel.similarity._RF_ScorerPy
+Indel_py.normalized_similarity._RF_ScorerPy = _Indel.normalized_similarity._RF_ScorerPy
+
 
 def isclose(a, b, rel_tol=1e-09, abs_tol=0.0):
     return abs(a - b) <= max(rel_tol * max(abs(a), abs(b)), abs_tol)
 
 
 def levenshtein(s1, s2, weights=(1, 1, 1)):
     """
```

### Comparing `rapidfuzz-2.8.0/tests/test_process.py` & `rapidfuzz-2.9.0/tests/test_process.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/tests/test_string_metric.py` & `rapidfuzz-2.9.0/tests/test_string_metric.py`

 * *Files identical despite different names*

### Comparing `rapidfuzz-2.8.0/tests/test_utils.py` & `rapidfuzz-2.9.0/tests/test_utils.py`

 * *Files identical despite different names*


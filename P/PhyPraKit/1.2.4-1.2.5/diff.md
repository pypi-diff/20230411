# Comparing `tmp/PhyPraKit-1.2.4.tar.gz` & `tmp/PhyPraKit-1.2.5.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "PhyPraKit-1.2.4.tar", last modified: Mon Oct 31 07:50:25 2022, max compression
+gzip compressed data, was "PhyPraKit-1.2.5.tar", last modified: Tue Apr 11 16:58:07 2023, max compression
```

## Comparing `PhyPraKit-1.2.4.tar` & `PhyPraKit-1.2.5.tar`

### file list

```diff
@@ -1,23 +1,26 @@
-drwxr-xr-x   0 root         (0) root         (0)        0 2022-10-31 07:50:25.580122 PhyPraKit-1.2.4/
--rw-r--r--   0 root         (0) root         (0)     2690 2022-10-31 07:50:25.580122 PhyPraKit-1.2.4/PKG-INFO
-drwxr-xr-x   0 root         (0) root         (0)        0 2022-10-31 07:50:25.580122 PhyPraKit-1.2.4/PhyPraKit/
--rw-r--r--   0 root         (0) root         (0)    74677 2022-10-15 19:29:02.000000 PhyPraKit-1.2.4/PhyPraKit/PhyPraKit.py
--rw-r--r--   0 root         (0) root         (0)      676 2022-10-31 07:49:44.000000 PhyPraKit-1.2.4/PhyPraKit/__init__.py
--rw-r--r--   0 root         (0) root         (0)      397 2022-10-31 07:50:03.000000 PhyPraKit-1.2.4/PhyPraKit/_version_info.py
--rwxr-xr-x   0 root         (0) root         (0)     2490 2022-08-29 09:08:01.000000 PhyPraKit-1.2.4/PhyPraKit/csv2yml.py
--rwxr-xr-x   0 root         (0) root         (0)   144488 2022-10-30 07:44:15.000000 PhyPraKit-1.2.4/PhyPraKit/phyFit.py
--rwxr-xr-x   0 root         (0) root         (0)     4551 2022-07-25 17:17:40.000000 PhyPraKit-1.2.4/PhyPraKit/plotData.py
--rwxr-xr-x   0 root         (0) root         (0)     8307 2022-07-25 17:17:40.000000 PhyPraKit-1.2.4/PhyPraKit/run_phyFit.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2022-10-31 07:50:25.580122 PhyPraKit-1.2.4/PhyPraKit.egg-info/
--rw-r--r--   0 root         (0) root         (0)     2690 2022-10-31 07:50:25.000000 PhyPraKit-1.2.4/PhyPraKit.egg-info/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)      381 2022-10-31 07:50:25.000000 PhyPraKit-1.2.4/PhyPraKit.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0) root         (0)        1 2022-10-31 07:50:25.000000 PhyPraKit-1.2.4/PhyPraKit.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0) root         (0)       10 2022-10-31 07:50:25.000000 PhyPraKit-1.2.4/PhyPraKit.egg-info/top_level.txt
--rw-r--r--   0 root         (0) root         (0)     1781 2022-04-03 08:51:42.000000 PhyPraKit-1.2.4/README.md
--rw-r--r--   0 root         (0) root         (0)       38 2022-10-31 07:50:25.580122 PhyPraKit-1.2.4/setup.cfg
--rw-r--r--   0 root         (0) root         (0)     1207 2022-10-30 07:44:15.000000 PhyPraKit-1.2.4/setup.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2022-10-31 07:50:25.580122 PhyPraKit-1.2.4/tools/
--rwxr-xr-x   0 root         (0) root         (0)     2490 2022-08-29 09:08:01.000000 PhyPraKit-1.2.4/tools/csv2yml.py
--rwxr-xr-x   0 root         (0) root         (0)     2753 2022-10-30 07:44:15.000000 PhyPraKit-1.2.4/tools/plotCSV.py
--rwxr-xr-x   0 root         (0) root         (0)     4551 2022-07-25 17:17:40.000000 PhyPraKit-1.2.4/tools/plotData.py
--rwxr-xr-x   0 root         (0) root         (0)     8371 2022-10-31 05:44:43.000000 PhyPraKit-1.2.4/tools/run_phyFit.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-11 16:58:07.466959 PhyPraKit-1.2.5/
+-rw-rw-r--   0 root         (0) root         (0)      194 2022-12-02 21:58:05.000000 PhyPraKit-1.2.5/AUTHORS
+-rw-rw-r--   0 root         (0) root         (0)    35141 2022-12-02 21:58:05.000000 PhyPraKit-1.2.5/LICENSE
+-rw-r--r--   0 root         (0) root         (0)     2255 2023-04-11 16:58:07.466959 PhyPraKit-1.2.5/PKG-INFO
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-11 16:58:07.466959 PhyPraKit-1.2.5/PhyPraKit/
+-rw-rw-r--   0 root         (0) root         (0)    76116 2023-04-11 16:18:32.000000 PhyPraKit-1.2.5/PhyPraKit/PhyPraKit.py
+-rw-rw-r--   0 root         (0) root         (0)      620 2023-04-11 16:20:06.000000 PhyPraKit-1.2.5/PhyPraKit/__init__.py
+-rw-rw-r--   0 root         (0) root         (0)      396 2023-04-11 16:21:37.000000 PhyPraKit-1.2.5/PhyPraKit/_version_info.py
+-rwxrwxr-x   0 root         (0) root         (0)     2666 2023-03-11 14:12:18.000000 PhyPraKit-1.2.5/PhyPraKit/csv2yml.py
+-rwxrwxr-x   0 root         (0) root         (0)   144462 2023-04-11 16:54:49.000000 PhyPraKit-1.2.5/PhyPraKit/phyFit.py
+-rwxrwxr-x   0 root         (0) root         (0)     4551 2022-12-02 21:58:05.000000 PhyPraKit-1.2.5/PhyPraKit/plotData.py
+-rwxrwxr-x   0 root         (0) root         (0)     8423 2022-12-02 21:58:05.000000 PhyPraKit-1.2.5/PhyPraKit/run_phyFit.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-11 16:58:07.466959 PhyPraKit-1.2.5/PhyPraKit.egg-info/
+-rw-r--r--   0 root         (0) root         (0)     2255 2023-04-11 16:58:07.000000 PhyPraKit-1.2.5/PhyPraKit.egg-info/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)      416 2023-04-11 16:58:07.000000 PhyPraKit-1.2.5/PhyPraKit.egg-info/SOURCES.txt
+-rw-r--r--   0 root         (0) root         (0)        1 2023-04-11 16:58:07.000000 PhyPraKit-1.2.5/PhyPraKit.egg-info/dependency_links.txt
+-rw-r--r--   0 root         (0) root         (0)       10 2023-04-11 16:58:07.000000 PhyPraKit-1.2.5/PhyPraKit.egg-info/top_level.txt
+-rw-rw-r--   0 root         (0) root         (0)     1777 2023-01-07 22:49:11.000000 PhyPraKit-1.2.5/README.md
+-rw-r--r--   0 root         (0) root         (0)       38 2023-04-11 16:58:07.466959 PhyPraKit-1.2.5/setup.cfg
+-rw-rw-r--   0 root         (0) root         (0)     1229 2022-12-02 21:58:05.000000 PhyPraKit-1.2.5/setup.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-11 16:58:07.466959 PhyPraKit-1.2.5/tools/
+-rwxrwxr-x   0 root         (0) root         (0)     2666 2023-03-11 14:12:18.000000 PhyPraKit-1.2.5/tools/csv2yml.py
+-rwxrwxr-x   0 root         (0) root         (0)     2753 2022-12-02 21:58:05.000000 PhyPraKit-1.2.5/tools/plotCSV.py
+-rwxrwxr-x   0 root         (0) root         (0)     4551 2022-12-02 21:58:05.000000 PhyPraKit-1.2.5/tools/plotData.py
+-rwxrwxr-x   0 root         (0) root         (0)     8423 2022-12-02 21:58:05.000000 PhyPraKit-1.2.5/tools/run_phyFit.py
+-rwxrwxr-x   0 root         (0) root         (0)     4099 2022-12-02 21:58:05.000000 PhyPraKit-1.2.5/tools/smoothCSV.py
```

### Comparing `PhyPraKit-1.2.4/PKG-INFO` & `PhyPraKit-1.2.5/PKG-INFO`

 * *Files 17% similar despite different names*

```diff
@@ -1,71 +1,75 @@
-Metadata-Version: 1.1
+Metadata-Version: 2.1
 Name: PhyPraKit
-Version: 1.2.4
+Version: 1.2.5
 Summary: Tools for data visualisation and analysis in Physics Lab Courses
 Home-page: http://www.etp.kit.edu/~quast/
 Author: Guenter Quast
 Author-email: Guenter.Quast@online.de
 License: GNU Public Licence
-Description: *************
-        **PhyPraKit**
-        *************
-        
-        About
-        -----
-        
-        PhyPraKit is a collection of python modules `(supporting python 2.7
-        (deprecated) and python >=3.6)` for data visualization and analysis
-        in experimental laboratory courses in physics, developed at the
-        faculty of physics at Karlsruhe Institute of Technology (KIT).
-        As the modules are intended primarily for use by undergraduate
-        students in Karlsruhe, the documentation is partly in German
-        language, in particular the description of the examples.
-        
-        Created by: 
-        
-        * Guenter Quast <guenter (dot) quast (at) online (dot) de>
-        
-          
-        Installation:
-        -------------
-        
-        To use PhyPraKit, it is sufficient to place the the directory
-        `PhyPraKit` and all the files in it in the same directory as the
-        python scripts importing it.
-        
-        Installation via `pip` is also supported. After downloading, execute: 
-        
-        ``pip install --user .`` 
-        
-        in the main directory of the *PhyPraKit* package (where *setup.py*
-        is located) to install in user space.  
-        
-        The installation using the *whl*-package provided in the subdirectory
-        `dist` may also be used:
-        
-           ``pip install --user --no-cache PhyPraKit<version>.whl``
-        
-        Installation via the PyPi Python Package Index is also available, simply
-        execute:
-           
-           ``pip install --user PhyPraKit``
-        
-        [Documentaion on "Read the Docs"](https://readthedocs.org/projects/phyprakit/)
-        
-        
-        Übersicht:
-        ----------
-        
-        PhyPraKit ist eine Sammlung nützlicher Funktionen in der Sprache 
-        `Python (vers. >=3.6, 2.7 noch für manche Module lauffähig)`
-        zum Aufnehmen, zur Bearbeitung, Visualisierung  und  Auswertung
-        von Daten in den physikalischen Praktika.
-        Die Anwendung der verschiedenen Funktionen des Pakets
-        werden jeweils durch konkrete Beispiele illustriert.
-        
-        [Dokumentation auf "Read the Docs"](https://readthedocs.org/projects/phyprakit/)
-        
 Platform: UNKNOWN
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Programming Language :: Python :: 2.7
 Classifier: Programming Language :: Python :: 3.6
+License-File: LICENSE
+License-File: AUTHORS
+
+*************
+**PhyPraKit**
+*************
+
+About
+-----
+
+PhyPraKit is a collection of python modules `(supporting python 2.7
+(deprecated) and python >=3.6)` for data visualization and analysis
+in experimental laboratory courses in physics, developed at the
+faculty of physics at Karlsruhe Institute of Technology (KIT).
+As the modules are intended primarily for use by undergraduate
+students in Karlsruhe, the documentation is partly in German
+language, in particular the description of the examples.
+
+Created by: 
+
+* Guenter Quast <guenter (dot) quast (at) online (dot) de>
+
+  
+Installation:
+-------------
+
+To use PhyPraKit, it is sufficient to place the directory
+`PhyPraKit` and all the files in it in the same directory as the
+python scripts importing it.
+
+Installation via `pip` is also supported. After downloading, execute: 
+
+``pip install --user .`` 
+
+in the main directory of the *PhyPraKit* package (where *setup.py*
+is located) to install in user space.  
+
+The installation using the *whl*-package provided in the subdirectory
+`dist` may also be used:
+
+   ``pip install --user --no-cache PhyPraKit<version>.whl``
+
+Installation via the PyPi Python Package Index is also available, simply
+execute:
+   
+   ``pip install --user PhyPraKit``
+
+[Documentaion on "Read the Docs"](https://readthedocs.org/projects/phyprakit/)
+
+
+Übersicht:
+----------
+
+PhyPraKit ist eine Sammlung nützlicher Funktionen in der Sprache 
+`Python (vers. >=3.6, 2.7 noch für manche Module lauffähig)`
+zum Aufnehmen, zur Bearbeitung, Visualisierung  und  Auswertung
+von Daten in den physikalischen Praktika.
+Die Anwendung der verschiedenen Funktionen des Pakets
+werden jeweils durch konkrete Beispiele illustriert.
+
+[Dokumentation auf "Read the Docs"](https://readthedocs.org/projects/phyprakit/)
+
+
```

### Comparing `PhyPraKit-1.2.4/PhyPraKit/PhyPraKit.py` & `PhyPraKit-1.2.5/PhyPraKit/PhyPraKit.py`

 * *Files 1% similar despite different names*

```diff
@@ -126,15 +126,22 @@
 #   08-Jul-19    GQ  fixed ' ' as deliminter in readtxt()
 #   27-Jul-19    GQ  added caption to writeTexTable and f.close to writeCSV()
 #   01-Nov-19    GQ  fixed extraction of file extension in readPicoScope
 #   05-Nov-20    GQ  changed to GNU GPL, automatic handling of missing uncertainties
 #                      in odFit, kFit and k2Fit
 #   08-Jan-21    GQ  added fit example with iminuit
 #   06-May-21    GQ  new version 1.2.0dev; removed kafe and old iminuit
-# ---------------------------------------------------------------------------
+#   02-Oct-21    GQ  v1.2.0: phyFit functions xyFit, hFit, mFit and xFit fully integrated 
+#   05-Jan-22    GQ  examples for parameter transformation using phyFit/xFit()
+#   13-Apr-22    GQ  drop python2 support 
+#   10-Nov-22    GQ  added stand-alone tools in sub-dir tools/
+#   13-Dec-22    GQ  added delim option to readPicoscope(); also replace decimal ','
+#   27-Dec-22    GQ  fixed border problem for indices <w and >l-w) in meanFilter()
+#                    changed to faster algorithm using numpy.cumsum()
+# ----------------------------------------------------------------------------------
 
 import numpy as np, matplotlib.pyplot as plt
 from scipy import stats
 
 ## ------- section 1: input from text files ------------------------
 
 def readColumnData(fname, cchar='#', delimiter=None, pr=True):
@@ -290,55 +297,54 @@
   # read float data with loadtxt()
   if delim ==' ' or delim =='\t':
     delim = None   # loadtext takes care of white spaces by default
   data = np.loadtxt(lfilt, dtype=np.float32, delimiter=delim, unpack=True)
   return hlines, data
 
 
-def readPicoScope(file, prlevel=0):
+def readPicoScope(file, delim=',', prlevel=0):
   """
   read Data exported from PicoScope in .txt or .csv format
+  use readtxt() to replace ',' in Geman decimal format 
   
   Args:
     * file: string, file name 
     * prlevel: printout level, 0 means silent
 
   Returns:
     * units: list of strings, channel units  
     * data: tuple of arrays, channel data
 
   """
 # --------------------------------------------------------------------
 #        special treatment to skip/analyze first three lines
-  f = open(file, 'r')
-  line1=f.readline().strip() # remove leading and trailing white space chars
-  line2=f.readline().strip()
-  units=line2         # contains the units
-  line3=f.readline()  # this is an empty line in PicoScope data
-
   if file.split('.')[-1]=="csv":
-    delim=','
+    delim = delim
   else:  
     delim='\t'
 
-  units=units.split(delim)
-  nc=len(units)
-  data = np.loadtxt(f, dtype=np.float32, delimiter=delim, unpack=True)
+  # read from file with filter for German decimal ','  
+  with open(file, 'r') as f:
+    hlines, data = readtxt(f, nlhead=3, delim=delim)
+
+  # extract units from 2nd header line (specific for PicoScope)  
+  units=hlines[1].strip().split(delim)
+  nc = len(units)
+
   if prlevel: 
     print("*==* readPicoScope: %i columns found:"%nc)
     if prlevel>1:
       for i, d in enumerate(data):
         print("     channel %i,  %i values found, unit %s"%(i, len(d), units[i]))
      
   if len(data) != nc:
     print("  !!! number of data columns inconsistent with number of units")
     exit(1)
   else:  
     return units, data
-
   
 def readCassy(file, prlevel=0):
   """read Data exported from Cassy in .txt format
   
   Args:
     * file: string, file name 
     * prlevel: printout level, 0 means silent
@@ -796,32 +802,46 @@
   return a-a.mean()
 
 def meanFilter(a, width=5):
   ''' 
   apply a sliding average to smoothen data, 
 
   method:
-    value at index i and int(width/2) neighbours are averaged
-    to from the new value at index i
+    value at index i and w=int(width/2) neighbours are averaged
+    to from the new value at index i; averages over smaller 
+    ranges are taken at borders for indices <w or >l-w-1 
 
-    Args:
-      * a: np-array of values
-      * width: int, number of points to average over
-        (if width is an even number, width+1 is used)
+  Args:
+    * a: np-array of values
+    * width: int, number of points to average over
+      (if width is an even number, width+1 is used)
  
-    Returns:
-      * av  smoothed signal curve
+  Returns:
+    * av  smoothed signal curve
   '''
 # -----------------------------------------------
   l=len(a)
-  av = np.zeros(l) 
-  k=int(width/2)
-  for i in range(k, l-k+1):
-    av[i]= sum(a[i-k:i+k+1])/(2*k+1)
+  w=int(width/2)
 
+  # slow (explicit) algorithm using inernal loop
+  #av0 = np.empty(l) 
+  #for i in range(0, l):
+  #  km = min(i, w)
+  #  kp = min(l-i-1, w)
+  #  av0[i]= sum(a[i-km:i+kp+1])/(km+kp+1)
+    
+  # fast (vectorized) approach using cumulative sum
+  cs = np.empty(l+1) # cumulative sum of array with leading zero
+  cs[1:] = np.cumsum(a)
+  cs[0] = 0.
+  av = np.empty(l) 
+  for i in range(0, l):
+    km = min(i, w)
+    kp = min(l-i-1, w)
+    av[i] = (cs[i+kp+1] - cs[i-km]) / (km+kp+1)
   return av
 
 def resample(a, t=None, n=11):
   ''' 
   perform average over n data points of array a, 
   return reduced array, eventually with corresponding time values 
 
@@ -1755,30 +1775,37 @@
                   density=fit_density )
   # text for labeling       
   hfit.assign_model_function_latex_name(model_name)
   hfit.assign_model_function_latex_expression(model_expression)
   hfit.model_label = model_legend
 
   # - provide text for labeling ...      
-  hdat.label = data_legend
-  hdat.axis_labels = axis_labels
+  #! hdat.label = data_legend # !! this does not work for HistContainer
+  #! hdat.axis_labels = axis_labels # !! this does not work for HistContainer
 
   # initialize and run fit
   if p0 is not None:
     hfit.set_all_parameter_values(p0)
 
   if dp0 is not None:
     hfit.parameter_errors = dp0
 
   if constraints is not None:
     if not (isinstance(constraints[0], tuple) or isinstance(constraints[0], list)):
       constraints = (constraints,)
     for c in constraints:
       hfit.add_parameter_constraint(*c)
 
+  if fixPars is not None:
+    if isinstance(fixPars[1], list):
+      for fx in fixPars:
+        hfit.fix_parameter(fx[0], fx[1])          
+    else: 
+      hfit.limit_parameter(fixPars[0], fixPars[1])          
+          
   if limits is not None:
     if isinstance(limits[1], list):
       for l in limits:
         hfit.limit_parameter(l[0], l[1], l[2])          
     else: 
       hfit.limit_parameter(limits[0], limits[1], limits[2])          
 
@@ -1793,36 +1820,39 @@
   gof = hfit.goodness_of_fit
   if asym_parerrs:
     parae = np.array(hfit.asymmetric_parameter_errors)
   else:
     parae = np.array(list(zip(-pare, pare)))
 
   if not quiet:
-    hfit.report(asymmetric_parameter_errors=True)
+    hfit.report(asymmetric_parameter_errors=asym_parerrs)
 
   if plot:
    # plot data, uncertainties, model line and model uncertainties
     kplot=Plot(hfit)
     # set some 'nice' options
+    kplot.x_label = axis_labels[0]   
+    kplot.y_label = axis_labels[1]   
     kplot.customize('data', 'marker', ['o'])
     kplot.customize('data', 'markersize', [6])
     kplot.customize('data', 'color', ['darkblue'])
+    kplot.customize('data', 'label', data_legend)
 ## the following not (yet) defined for kafe2 Histogram Fit     
 ##    kplot.customize('model_line', 'color', ['darkorange'])
 ##    kplot.customize('model_line', 'linestyle', ['--'])
 ##    if not plot_band:
 ##      kplot.customize('model_error_band', 'hide', [True])
 ##    else:
 ##      kplot.customize('model_error_band', 'color', ['green'])
 ##      kplot.customize('model_error_band', 'label', [model_band])
 ##      kplot.customize('model_error_band', 'alpha', [0.1])
 
     # plot with defined options
     kplot.plot(fit_info=fit_info, residual=plot_residual,
-               asymmetric_parameter_errors=True)
+               asymmetric_parameter_errors=asym_parerrs)
 
     if plot_cor:
       cpf = ContoursProfiler(hfit)
       cpf.plot_profiles_contours_matrix() # plot profile likelihood and contours
 
     if showplots: plt.show()    
       
@@ -1975,15 +2005,15 @@
   function_name=''  
   words_in_code = code_string.split()
   for i, w in enumerate(words_in_code):
     if w == 'def':
       fn = words_in_code[i+1]
       function_name=fn[0:fn.find( '(' )]
       break
-  if function_name is '':
+  if function_name == '':
       raise ValueError(
         "No function name in user entered code.")         
   return function_name, code_string 
 
 def plot_xy_from_yaml(d):
   """plot (xy) data from yaml file
 
@@ -2106,27 +2136,27 @@
       code_str = d['model_function']['python_code']
     except:
       try:
         code_str = d['model_function']
       except:
         pass      
     if code_str is not None:
-      # check and execute provide model code
+      # check and execute provided model code
       functionName, code = check_function_code(code_str)
       scope = dict()
       header= 'import numpy as np\n' + 'import scipy\n' 
       exec(header + code, scope)
       # plot function 
       xp = np.linspace(min(x_dat), max(x_dat), 113)
       plt.plot(xp, scope[functionName](xp) , '-', label=model_label)
 
 # finally, plot legend of all shown graphs      
   plt.legend(loc='best')
 
-def csv2yaml(file, nlhead=1, delim='\t'):
+def csv2yaml(file, nlhead=1, delim='\t', keyline=0):
   """read floating point data in general csv format and convert to yaml  
 
   skip header lines, replace decimal comma, remove special characters,
   and ouput as yaml data block
   
   Args:
     * file: file name or open file handler
@@ -2193,15 +2223,15 @@
     
   Nlin = len(dlines)
   Ncol = len(dlines[0])
   #print(" --> number of columns", Ncol)
   #print(" --> number of data points", Nlin)
 
   # interpret strings in header[0] as keys
-  keys = hlines[0].split(delim)
+  keys = hlines[keyline].split(delim)
   Nkey = len(keys)
   if Nkey != Ncol:
     print('Nkey=', Nkey, ' Ncol=', Ncol)
     raise ValueError(
       "!!! number of keys{} not equal number of columns - exit")
 
   # construct string in yaml format
```

### Comparing `PhyPraKit-1.2.4/PhyPraKit/__init__.py` & `PhyPraKit-1.2.5/PhyPraKit/__init__.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,21 +1,16 @@
-"""
-
-.. moduleauthor:: Guenter Quast <guenter.quast@online.de>
+"""**PhyPraKit**  
+   a collection of tools for data handling, visualisation and analysis 
+   in Physics Lab Courses, recommended for "Physikalisches Praktikum am KIT"
 
 .. module PhyPraKit   
    :synopsis: a collection of tools for data analysis
      recommended for "Physikalisches Praktikum am KIT"
 
-.. moduleauthor:: Guenter Quast <g.quast@kit.edu>
-
-**PhyPraKit**  
-    a collection of tools for data handling, visualisation and analysis 
-    in Physics Lab Courses, recommended for "Physikalisches Praktikum am KIT"
-
+.. moduleauthor:: Guenter Quast <guenter.quast@online.de>
 """
 
 
 # Import version info
 from . import _version_info
 
 # Import main components
```

### Comparing `PhyPraKit-1.2.4/PhyPraKit/csv2yml.py` & `PhyPraKit-1.2.5/PhyPraKit/csv2yml.py`

 * *Files 6% similar despite different names*

```diff
@@ -47,34 +47,38 @@
       help="quiet - no output to screen")
   parser.add_argument('-d','--delimiter', 
                       type=str, default=',',
            help="delimiter, default=','")
   parser.add_argument('-n','--header_lines', 
                       type=int, default=1,
            help="numer of header lines, default=1")
+  parser.add_argument('-k','--key_line', 
+                      type=int, default=0,
+           help="header line containing keys, default=0")
   
   if len(sys.argv)==1:  # print help message if no input given
     parser.print_help()
     raise ValueError('!!! not input given -exit !')
 
   # collect input from ArgumentParser
   args = parser.parse_args()
   fnam = args.filename
 
   nlhead = args.header_lines
+  l_key = args.key_line  
   delim = args.delimiter
   showHeader = args.Header
   sav_flg = args.save
   quiet = args.quiet
   if quiet: sav_flg = True
 
   # ---- end argument parsing -------------------
   
   f = open(fnam, 'r') 
-  hlines, ylines = csv2yaml(f, nlhead, delim)
+  hlines, ylines = csv2yaml(f, nlhead, delim, l_key)
 
   if not quiet:
     print('-->', fnam, 'to yaml', end='')
 
   if showHeader:
     print('  csv header:')
     for l in hlines:
```

### Comparing `PhyPraKit-1.2.4/PhyPraKit/phyFit.py` & `PhyPraKit-1.2.5/PhyPraKit/phyFit.py`

 * *Files 2% similar despite different names*

```diff
@@ -1198,7834 +1198,7832 @@
 00004ad0: 7072 696e 7428 2725 7327 2025 2863 6f64  print('%s' %(cod
 00004ae0: 6529 2029 2020 2020 0a0a 2020 7363 6f70  e) )    ..  scop
 00004af0: 6520 3d20 6469 6374 2829 0a20 2068 6561  e = dict().  hea
 00004b00: 6465 723d 2027 696d 706f 7274 206e 756d  der= 'import num
 00004b10: 7079 2061 7320 6e70 5c6e 2720 2b20 2769  py as np\n' + 'i
 00004b20: 6d70 6f72 7420 7363 6970 795c 6e27 200a  mport scipy\n' .
 00004b30: 2020 6578 6563 2868 6561 6465 7220 2b20    exec(header + 
-00004b40: 636f 6465 2c20 7363 6f70 6529 0a20 200a  code, scope).  .
-00004b50: 2320 7065 7266 6f72 6d20 6669 7420 746f  # perform fit to
-00004b60: 2064 6174 6120 7769 7468 2066 756e 6374   data with funct
-00004b70: 696f 6e20 7879 4669 7420 0a20 2072 6469  ion xyFit .  rdi
-00004b80: 6374 203d 2078 7946 6974 2873 636f 7065  ct = xyFit(scope
-00004b90: 5b66 6974 665f 6e61 6d65 5d2c 0a20 2020  [fitf_name],.   
-00004ba0: 2020 2064 6174 615f 782c 2064 6174 615f     data_x, data_
-00004bb0: 792c 2020 2020 2020 2320 6461 7461 2078  y,      # data x
-00004bc0: 2061 6e64 2079 2063 6f6f 7264 696e 6174   and y coordinat
-00004bd0: 6573 0a20 2020 2020 2073 783d 7378 2c20  es.      sx=sx, 
-00004be0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00004bf0: 696e 6465 7020 780a 2020 2020 2020 7379  indep x.      sy
-00004c00: 3d73 792c 2020 2020 2020 2020 2020 2020  =sy,            
-00004c10: 2020 2023 2069 6e64 6570 2079 0a20 2020     # indep y.   
-00004c20: 2020 2073 7265 6c78 3d73 7265 6c78 2c20     srelx=srelx, 
-00004c30: 2020 2020 2020 2020 2320 696e 6465 702e          # indep.
-00004c40: 2072 656c 2e20 780a 2020 2020 2020 7372   rel. x.      sr
-00004c50: 656c 793d 7372 656c 792c 2020 2020 2020  ely=srely,      
-00004c60: 2020 2023 2069 6e64 6570 2e20 7265 6c2e     # indep. rel.
-00004c70: 2079 0a20 2020 2020 2078 6162 7363 6f72   y.      xabscor
-00004c80: 3d73 6162 7363 6f72 782c 2020 2020 2320  =sabscorx,    # 
-00004c90: 636f 7272 656c 6174 6564 2078 0a20 2020  correlated x.   
-00004ca0: 2020 2078 7265 6c63 6f72 3d73 7265 6c63     xrelcor=srelc
-00004cb0: 6f72 782c 2020 2020 2320 636f 7272 656c  orx,    # correl
-00004cc0: 6174 6564 2072 656c 2e20 780a 2020 2020  ated rel. x.    
-00004cd0: 2020 7961 6273 636f 723d 7361 6273 636f    yabscor=sabsco
-00004ce0: 7279 2c20 2020 2023 2063 6f72 7265 6c61  ry,    # correla
-00004cf0: 7465 6420 790a 2020 2020 2020 7972 656c  ted y.      yrel
-00004d00: 636f 723d 7372 656c 636f 7279 2c20 2020  cor=srelcory,   
-00004d10: 2023 2063 6f72 7265 6c61 7465 6420 7265   # correlated re
-00004d20: 6c2e 2079 0a20 2020 2020 2063 6f6e 7374  l. y.      const
-00004d30: 7261 696e 7473 203d 2063 6f6e 7374 7261  raints = constra
-00004d40: 696e 7473 2c20 2320 7061 7261 6d65 7465  ints, # paramete
-00004d50: 7220 636f 6e73 7472 6169 6e74 730a 2020  r constraints.  
-00004d60: 2020 2020 6669 7850 6172 7320 3d20 6669      fixPars = fi
-00004d70: 7865 6450 6172 732c 2023 2066 6978 6564  xedPars, # fixed
-00004d80: 2070 6172 616d 6574 6572 730a 2020 2020   parameters.    
-00004d90: 2020 6178 6973 5f6c 6162 656c 733d 5b78    axis_labels=[x
-00004da0: 5f6c 6162 656c 2c20 795f 6c61 6265 6c5d  _label, y_label]
-00004db0: 2c20 0a20 2020 2020 2064 6174 615f 6c65  , .      data_le
-00004dc0: 6765 6e64 203d 2020 6461 7461 5f6c 6162  gend =  data_lab
-00004dd0: 656c 2c20 2020 200a 2020 2020 2020 6d6f  el,    .      mo
-00004de0: 6465 6c5f 6c65 6765 6e64 203d 206d 6f64  del_legend = mod
-00004df0: 656c 5f6c 6162 656c 2c20 0a20 2020 2020  el_label, .     
-00004e00: 2070 6c6f 743d 706c 6f74 2c20 2020 2020   plot=plot,     
-00004e10: 2020 2020 2020 2020 2320 706c 6f74 2064          # plot d
-00004e20: 6174 6120 616e 6420 6d6f 6465 6c0a 2020  ata and model.  
-00004e30: 2020 2020 706c 6f74 5f62 616e 643d 706c      plot_band=pl
-00004e40: 6f74 5f62 616e 642c 2020 2023 2070 6c6f  ot_band,   # plo
-00004e50: 7420 6d6f 6465 6c20 636f 6e66 6964 656e  t model confiden
-00004e60: 6365 2d62 616e 640a 2020 2020 2020 706c  ce-band.      pl
-00004e70: 6f74 5f63 6f72 3d70 6c6f 745f 636f 722c  ot_cor=plot_cor,
-00004e80: 2020 2020 2023 2070 6c6f 7420 7072 6f66       # plot prof
-00004e90: 696c 6573 206c 696b 656c 6968 6f6f 6420  iles likelihood 
-00004ea0: 616e 6420 636f 6e74 6f75 7273 0a20 2020  and contours.   
-00004eb0: 2020 2073 686f 7770 6c6f 7473 3d73 686f     showplots=sho
-00004ec0: 7770 6c6f 7473 2c20 2020 2320 706c 6f74  wplots,   # plot
-00004ed0: 7320 746f 2073 6372 6565 6e0a 2020 2020  s to screen.    
-00004ee0: 2020 7361 6d65 5f70 6c6f 7420 3d20 7361    same_plot = sa
-00004ef0: 6d65 5f70 6c6f 742c 2023 206f 7665 726c  me_plot, # overl
-00004f00: 6179 2066 6974 2069 6e66 6f20 6672 6f6d  ay fit info from
-00004f10: 2070 7265 7669 6f69 7573 2063 616c 6c28   previoius call(
-00004f20: 7329 0a20 2020 2020 2071 7569 6574 3d71  s).      quiet=q
-00004f30: 7569 6574 2c20 2020 2020 2020 2020 2020  uiet,           
-00004f40: 2320 7375 7070 7265 7373 2069 6e66 6f72  # suppress infor
-00004f50: 6d61 7469 7665 2070 7269 6e74 6f75 740a  mative printout.
-00004f60: 2020 2020 2020 7265 7475 726e 5f66 6974        return_fit
-00004f70: 4f62 6a65 6374 3d72 6574 7572 6e5f 6669  Object=return_fi
-00004f80: 744f 626a 6563 740a 2020 2020 2020 290a  tObject.      ).
-00004f90: 2020 7265 7475 726e 2072 6469 6374 0a20    return rdict. 
-00004fa0: 2020 0a64 6566 2078 4669 7428 6669 7466    .def xFit(fitf
-00004fb0: 2c20 782c 2073 203d 204e 6f6e 652c 2073  , x, s = None, s
-00004fc0: 7265 6c20 3d20 4e6f 6e65 2c20 0a20 2020  rel = None, .   
-00004fd0: 2020 2020 7361 6273 636f 7220 3d20 4e6f      sabscor = No
-00004fe0: 6e65 2c20 7372 656c 636f 7220 3d20 4e6f  ne, srelcor = No
-00004ff0: 6e65 2c20 2020 2020 2020 2020 2020 2020  ne,             
-00005000: 2020 0a20 2020 2020 2020 7265 665f 746f    .       ref_to
-00005010: 5f6d 6f64 656c 203d 2054 7275 652c 0a20  _model = True,. 
-00005020: 2020 2020 2020 6e61 6d65 7320 3d20 4e6f        names = No
-00005030: 6e65 2c0a 2020 2020 2020 206d 6f64 656c  ne,.       model
-00005040: 5f6b 7761 7267 7320 3d20 4e6f 6e65 2c0a  _kwargs = None,.
-00005050: 2020 2020 2020 2070 3020 3d20 4e6f 6e65         p0 = None
-00005060: 2c20 6470 3020 3d20 4e6f 6e65 2c20 636f  , dp0 = None, co
-00005070: 6e73 7472 6169 6e74 7320 3d20 4e6f 6e65  nstraints = None
-00005080: 2c0a 2020 2020 2020 2066 6978 5061 7273  ,.       fixPars
-00005090: 3d4e 6f6e 652c 206c 696d 6974 733d 4e6f  =None, limits=No
-000050a0: 6e65 2c0a 2020 2020 2020 2075 7365 5f6e  ne,.       use_n
-000050b0: 6567 4c6f 674c 3d54 7275 652c 200a 2020  egLogL=True, .  
-000050c0: 2020 2020 2070 6c6f 7420 3d20 5472 7565       plot = True
-000050d0: 2c20 706c 6f74 5f63 6f72 203d 2046 616c  , plot_cor = Fal
-000050e0: 7365 2c0a 2020 2020 2020 2073 686f 7770  se,.       showp
-000050f0: 6c6f 7473 203d 2054 7275 652c 200a 2020  lots = True, .  
-00005100: 2020 2020 2070 6c6f 745f 6261 6e64 3d54       plot_band=T
-00005110: 7275 652c 2070 6c6f 745f 7265 7369 6475  rue, plot_residu
-00005120: 616c 3d46 616c 7365 2c20 7175 6965 7420  al=False, quiet 
-00005130: 3d20 5472 7565 2c0a 2020 2020 2020 2073  = True,.       s
-00005140: 616d 655f 706c 6f74 203d 2046 616c 7365  ame_plot = False
-00005150: 2c20 2020 2023 206f 7665 726c 6179 2066  ,    # overlay f
-00005160: 6974 2069 6e66 6f20 6672 6f6d 2070 7265  it info from pre
-00005170: 7669 6f69 7573 2063 616c 6c28 7329 0a20  vioius call(s). 
-00005180: 2020 2020 2020 6178 6973 5f6c 6162 656c        axis_label
-00005190: 733d 5b27 496e 6465 7827 2c20 2766 282a  s=['Index', 'f(*
-000051a0: 782c 202a 7061 7229 275d 2c0a 2020 2020  x, *par)'],.    
-000051b0: 2020 2064 6174 615f 6c65 6765 6e64 203d     data_legend =
-000051c0: 2027 6461 7461 272c 2020 2020 0a20 2020   'data',    .   
-000051d0: 2020 2020 6d6f 6465 6c5f 6c65 6765 6e64      model_legend
-000051e0: 203d 2027 6d6f 6465 6c27 2c0a 2020 2020   = 'model',.    
-000051f0: 2020 2072 6574 7572 6e5f 6669 744f 626a     return_fitObj
-00005200: 6563 7420 3d20 4661 6c73 6520 293a 0a20  ect = False ):. 
-00005210: 200a 2020 2222 2257 7261 7070 6572 2066   .  """Wrapper f
-00005220: 756e 6374 696f 6e20 746f 2066 6974 2061  unction to fit a
-00005230: 6e20 6172 6269 7472 6172 7920 6675 6e63  n arbitrary func
-00005240: 7469 6f6e 2074 6f20 6461 7461 2077 6974  tion to data wit
-00005250: 680a 2020 696e 6465 7065 6e64 656e 7420  h.  independent 
-00005260: 616e 642f 6f72 2063 6f72 7265 6c61 7465  and/or correlate
-00005270: 6420 6162 736f 6c75 7465 2061 6e64 2f6f  d absolute and/o
-00005280: 7220 7265 6c61 7469 7665 2075 6e63 6572  r relative uncer
-00005290: 7461 696e 7469 6573 200a 2020 7769 7468  tainties .  with
-000052a0: 2063 6c61 7373 206d 6e46 6974 2e20 556e   class mnFit. Un
-000052b0: 6365 7274 6169 6e74 6965 7320 6172 6520  certainties are 
-000052c0: 6173 7375 6d65 6420 746f 2062 6520 6465  assumed to be de
-000052d0: 7372 6962 6564 2062 790a 2020 6120 6d75  sribed by.  a mu
-000052e0: 6c74 6976 6172 6961 7465 2047 6175 7373  ltivariate Gauss
-000052f0: 6961 6e20 6469 7374 7269 6275 7469 6f6e  ian distribution
-00005300: 2c20 692e 652e 2074 6865 2063 6f76 6172  , i.e. the covar
-00005310: 6961 6e63 6520 6d61 7472 6978 206f 6620  iance matrix of 
-00005320: 0a20 2074 6865 2064 6174 6120 7b78 5f69  .  the data {x_i
-00005330: 7d20 6973 2074 616b 656e 2069 6e74 6f20  } is taken into 
-00005340: 6163 636f 756e 7420 696e 2074 6865 2063  account in the c
-00005350: 6f73 7420 6675 6e63 7469 6f6e 2e0a 0a20  ost function... 
-00005360: 2043 6f72 7265 6c61 7465 6420 6162 736f   Correlated abso
-00005370: 6c75 7465 2061 6e64 2f6f 7220 7265 6c61  lute and/or rela
-00005380: 7469 7665 2075 6e63 6572 7461 696e 7469  tive uncertainti
-00005390: 6573 206f 6620 696e 7075 7420 6461 7461  es of input data
-000053a0: 200a 2020 6172 6520 7370 6563 6966 6965   .  are specifie
-000053b0: 6420 6173 2066 6c6f 6174 7320 2869 6620  d as floats (if 
-000053c0: 616c 6c20 756e 6365 7274 6169 6e74 6965  all uncertaintie
-000053d0: 7320 6172 6520 6571 7561 6c29 206f 7220  s are equal) or 
-000053e0: 6173 200a 2020 6e75 6d70 792d 6172 7261  as .  numpy-arra
-000053f0: 7973 206f 6620 666c 6f61 7473 2e20 5468  ys of floats. Th
-00005400: 6520 636f 6e63 6570 7420 6f66 2069 6e64  e concept of ind
-00005410: 6570 656e 6465 6e74 206f 7220 636f 6d6d  ependent or comm
-00005420: 6f6e 200a 2020 756e 6365 7274 6169 6e74  on .  uncertaint
-00005430: 6965 7320 6f66 2028 6772 6f75 7073 2920  ies of (groups) 
-00005440: 6f66 2076 616c 7565 7320 6973 2075 7365  of values is use
-00005450: 6420 746f 2063 6f6e 7374 7275 6374 2074  d to construct t
-00005460: 6865 200a 2020 6675 6c6c 2063 6f76 6172  he .  full covar
-00005470: 6961 6e63 6520 6d61 7472 6978 2066 726f  iance matrix fro
-00005480: 6d20 6469 6666 6572 656e 7420 756e 6365  m different unce
-00005490: 7274 6169 6e74 7920 636f 6d70 6f6e 656e  rtainty componen
-000054a0: 7473 2e0a 0a20 2041 7267 733a 0a20 2020  ts...  Args:.   
-000054b0: 202a 2066 6974 663a 206d 6f64 656c 2066   * fitf: model f
-000054c0: 756e 6374 696f 6e20 746f 2066 6974 2c20  unction to fit, 
-000054d0: 6172 6775 6d65 6e74 7320 2866 6c6f 6174  arguments (float
-000054e0: 3a78 2c20 666c 6f61 743a 205c 2a61 7267  :x, float: \*arg
-000054f0: 7329 0a20 2020 202a 2078 3a20 206e 702d  s).    * x:  np-
-00005500: 6172 7261 7920 6f66 2064 6174 6120 7661  array of data va
-00005510: 6c75 6573 0a20 2020 202a 2073 3a20 7363  lues.    * s: sc
-00005520: 616c 6172 206f 7220 3164 206f 7220 3264  alar or 1d or 2d
-00005530: 206e 702d 6172 7261 7920 7769 7468 2075   np-array with u
-00005540: 6e63 6572 7461 696e 7469 6573 0a20 2020  ncertainties.   
-00005550: 202a 2073 7265 6c3a 2073 6361 6c61 7220   * srel: scalar 
-00005560: 6f72 206e 702d 6172 7261 793b 2072 656c  or np-array; rel
-00005570: 6174 6976 6520 756e 6365 7274 6169 6e74  ative uncertaint
-00005580: 6965 7320 0a20 2020 202a 2073 6162 7363  ies .    * sabsc
-00005590: 6f72 3a20 7363 616c 6172 206f 7220 6e70  or: scalar or np
-000055a0: 2d61 7272 6179 3b20 6162 736f 6c75 7465  -array; absolute
-000055b0: 2c20 636f 7272 656c 6174 6564 2065 7272  , correlated err
-000055c0: 6f72 2873 2920 0a20 2020 202a 2073 7265  or(s) .    * sre
-000055d0: 6c63 6f72 3a20 7363 616c 6172 206f 7220  lcor: scalar or 
-000055e0: 6e70 2d61 7272 6179 3b20 7265 6c61 7469  np-array; relati
-000055f0: 7665 2c20 636f 7272 656c 6174 6564 2065  ve, correlated e
-00005600: 7272 6f72 2873 2920 0a20 2020 202a 2072  rror(s) .    * r
-00005610: 6566 5f74 6f5f 6d6f 6465 6c3a 2072 656c  ef_to_model: rel
-00005620: 6174 6976 6520 6572 726f 7273 2077 2e72  ative errors w.r
-00005630: 2e74 2e20 6d6f 6465 6c20 6966 2054 7275  .t. model if Tru
-00005640: 650a 2020 2020 2a20 6e61 6d65 733a 206f  e.    * names: o
-00005650: 7074 696f 6e61 6c20 6e61 6d65 7320 666f  ptional names fo
-00005660: 7220 6561 6368 2069 6e70 7574 2076 616c  r each input val
-00005670: 7565 0a20 2020 202a 206d 6f64 656c 5f6b  ue.    * model_k
-00005680: 7761 7267 733a 206f 7074 696f 6e61 6c2c  wargs: optional,
-00005690: 2066 6974 2070 6172 616d 6574 6572 7320   fit parameters 
-000056a0: 6966 206e 6f74 2066 726f 6d20 6d6f 6465  if not from mode
-000056b0: 6c20 7369 676e 6174 7572 6520 0a20 2020  l signature .   
-000056c0: 202a 2070 303a 2061 7272 6179 2d6c 696b   * p0: array-lik
-000056d0: 652c 2069 6e69 7469 616c 2067 7565 7373  e, initial guess
-000056e0: 206f 6620 7061 7261 6d65 7465 7273 0a20   of parameters. 
-000056f0: 2020 202a 2064 7030 3a20 6172 7261 792d     * dp0: array-
-00005700: 6c69 6b65 2c20 696e 6974 6961 6c20 6775  like, initial gu
-00005710: 6573 7320 6f66 2070 6172 616d 6574 6572  ess of parameter
-00005720: 2075 6e63 6572 7461 696e 7469 6573 2028   uncertainties (
-00005730: 6f70 7469 6f6e 616c 290a 2020 2020 2a20  optional).    * 
-00005740: 7573 655f 6e65 674c 6f67 4c3a 2020 7573  use_negLogL:  us
-00005750: 6520 6675 6c6c 202d 326c 6e28 4c29 2020  e full -2ln(L)  
-00005760: 0a20 2020 202a 2063 6f6e 7374 7261 696e  .    * constrain
-00005770: 7473 3a20 286e 6573 7465 6429 206c 6973  ts: (nested) lis
-00005780: 7428 7329 205b 6e61 6d65 206f 7220 6964  t(s) [name or id
-00005790: 2c20 7661 6c75 652c 2065 7272 6f72 5d0a  , value, error].
-000057a0: 2020 2020 2a20 6669 7820 7061 7261 6d65      * fix parame
-000057b0: 7465 7228 7329 2069 6e20 6669 743a 206c  ter(s) in fit: l
-000057c0: 6973 7420 6f66 2070 6172 616d 6574 6572  ist of parameter
-000057d0: 206e 616d 6573 206f 7220 696e 6469 6365   names or indice
-000057e0: 730a 2020 2020 2a20 6c69 6d69 7473 3a20  s.    * limits: 
-000057f0: 286e 6573 7465 6429 206c 6973 7428 7329  (nested) list(s)
-00005800: 205b 6e61 6d65 206f 7220 6964 2c20 6d69   [name or id, mi
-00005810: 6e2c 206d 6178 5d20 0a20 2020 202a 2070  n, max] .    * p
-00005820: 6c6f 743a 2073 686f 7720 6461 7461 2070  lot: show data p
-00005830: 6f69 6e74 7320 616e 6420 6d6f 6465 6c20  oints and model 
-00005840: 7072 6564 6963 7469 6f6e 2069 6620 5472  prediction if Tr
-00005850: 7565 0a20 2020 202a 2070 6c6f 745f 636f  ue.    * plot_co
-00005860: 723a 2073 686f 7720 7072 6f66 696c 6520  r: show profile 
-00005870: 6c69 6b65 6c69 686f 6f64 7320 616e 6420  likelihoods and 
-00005880: 636f 6e66 6964 656e 6365 2063 6f6e 746f  confidence conto
-00005890: 7572 730a 2020 2020 2a20 706c 6f74 5f62  urs.    * plot_b
-000058a0: 616e 643a 2070 6c6f 7420 756e 6365 7274  and: plot uncert
-000058b0: 6169 6e74 7920 6261 6e64 2061 726f 756e  ainty band aroun
-000058c0: 6420 6d6f 6465 6c20 7072 6564 6963 7469  d model predicti
-000058d0: 6f6e 0a20 2020 202a 2070 6c6f 745f 7265  on.    * plot_re
-000058e0: 7369 6475 616c 3a20 706c 6f74 2072 6573  sidual: plot res
-000058f0: 6964 7561 6c73 2077 2e72 2e74 2e20 6d6f  iduals w.r.t. mo
-00005900: 6465 6c20 696e 7374 6561 6420 6f66 206d  del instead of m
-00005910: 6f64 656c 2070 7265 6469 6374 696f 6e0a  odel prediction.
-00005920: 2020 2020 2a20 7368 6f77 706c 6f74 733a      * showplots:
-00005930: 2073 686f 7720 706c 6f74 7320 6f6e 2073   show plots on s
-00005940: 6372 6565 6e0a 2020 2020 2a20 7361 6d65  creen.    * same
-00005950: 5f70 6c6f 743a 206f 7665 726c 6179 2066  _plot: overlay f
-00005960: 6974 2069 6e66 6f20 6672 6f6d 2070 7265  it info from pre
-00005970: 7669 6f75 7320 6361 6c6c 2873 290a 2020  vious call(s).  
-00005980: 2020 2a20 7175 6965 743a 2073 7570 7072    * quiet: suppr
-00005990: 6573 7320 7072 696e 746f 7574 0a20 2020  ess printout.   
-000059a0: 202a 206c 6973 7420 6f66 2073 7472 3a20   * list of str: 
-000059b0: 6178 6973 206c 6162 656c 730a 2020 2020  axis labels.    
-000059c0: 2a20 7374 723a 206c 6567 656e 6420 666f  * str: legend fo
-000059d0: 7220 6461 7461 0a20 2020 202a 2073 7472  r data.    * str
-000059e0: 3a20 6c65 6765 6e64 2066 6f72 206d 6f64  : legend for mod
-000059f0: 656c 200a 2020 2020 2a20 626f 6f6c 3a20  el .    * bool: 
-00005a00: 666f 7220 6578 7065 7274 7320 6f6e 6c79  for experts only
-00005a10: 2c20 7265 7475 726e 2069 6e73 7461 6e63  , return instanc
-00005a20: 6520 6f66 2063 6c61 7373 206d 6e46 6974  e of class mnFit
-00005a30: 2074 6f20 0a20 2020 2020 2067 6976 6520   to .      give 
-00005a40: 6163 6365 7373 2074 6f20 6461 7461 206d  access to data m
-00005a50: 656d 6265 7273 2061 6e64 206d 6574 686f  embers and metho
-00005a60: 6473 0a0a 2020 5265 7475 726e 733a 0a20  ds..  Returns:. 
-00005a70: 2020 202a 206e 702d 6172 7261 7920 6f66     * np-array of
-00005a80: 2066 6c6f 6174 3a20 7061 7261 6d65 7465   float: paramete
-00005a90: 7220 7661 6c75 6573 0a20 2020 202a 2032  r values.    * 2
-00005aa0: 6420 6e70 2d61 7272 6179 206f 6620 666c  d np-array of fl
-00005ab0: 6f61 743a 2070 6172 616d 6574 6572 2075  oat: parameter u
-00005ac0: 6e63 6572 7461 696e 7469 6573 205b 305d  ncertainties [0]
-00005ad0: 3a20 6e65 672e 2061 6e64 205b 315d 3a20  : neg. and [1]: 
-00005ae0: 706f 732e 200a 2020 2020 2a20 6e70 2d61  pos. .    * np-a
-00005af0: 7272 6179 3a20 636f 7272 656c 6174 696f  rray: correlatio
-00005b00: 6e20 6d61 7472 6978 200a 2020 2020 2a20  n matrix .    * 
-00005b10: 666c 6f61 743a 2032 2a6e 6567 4c6f 6720  float: 2*negLog 
-00005b20: 4c2c 2063 6f72 7265 7370 6f6e 6469 6e67  L, corresponding
-00005b30: 2074 6f20 5c63 6869 2d73 7175 6172 6520   to \chi-square 
-00005b40: 6f66 2066 6974 2061 206d 696e 696d 756d  of fit a minimum
-00005b50: 0a0a 2020 2020 6f72 2c20 6f70 7469 6f6e  ..    or, option
-00005b60: 616c 6c79 2c20 7468 6520 6d6e 4669 7420  ally, the mnFit 
-00005b70: 696e 7374 616e 6365 2e0a 2020 2222 220a  instance..  """.
-00005b80: 0a20 2023 2320 6672 6f6d 202e 7068 7946  .  ## from .phyF
-00005b90: 6974 2069 6d70 6f72 7420 6d6e 4669 7420  it import mnFit 
-00005ba0: 2321 2061 6c72 6561 6479 2063 6f6e 7461  #! already conta
-00005bb0: 696e 6564 2069 6e20 7468 6973 2066 696c  ined in this fil
-00005bc0: 650a 0a20 2023 202e 2e2e 2063 6865 636b  e..  # ... check
-00005bd0: 2069 6620 6572 726f 7273 2061 7265 2070   if errors are p
-00005be0: 726f 7669 6465 6420 2e2e 2e0a 2020 6966  rovided ....  if
-00005bf0: 2073 2069 7320 4e6f 6e65 3a0a 2020 2020   s is None:.    
-00005c00: 7379 203d 206e 702e 6f6e 6573 286c 656e  sy = np.ones(len
-00005c10: 2878 2929 0a20 2020 2070 7269 6e74 2827  (x)).    print('
-00005c20: 5c6e 212a 2a21 204e 6f20 792d 6572 726f  \n!**! No y-erro
-00005c30: 7273 2067 6976 656e 2c20 616c 6c20 6173  rs given, all as
-00005c40: 7375 6d65 6420 746f 2062 6520 312e 305c  sumed to be 1.0\
-00005c50: 6e27 2c0a 2020 2020 2020 2020 2020 272d  n',.          '-
-00005c60: 3e20 636f 6e73 6964 6572 2073 6361 6c69  > consider scali
-00005c70: 6e67 206f 6620 7061 7261 6d65 7465 7220  ng of parameter 
-00005c80: 6572 726f 7273 2077 6974 6820 7371 7274  errors with sqrt
-00005c90: 2863 6869 5e32 2f4e 6466 295c 6e27 290a  (chi^2/Ndf)\n').
-00005ca0: 2020 0a20 2023 2073 6574 2075 7020 6120    .  # set up a 
-00005cb0: 6669 7420 6f62 6a65 6374 0a20 2069 6e64  fit object.  ind
-00005cc0: 6578 6564 4669 7420 3d20 6d6e 4669 7428  exedFit = mnFit(
-00005cd0: 2769 6e64 6578 6564 2729 0a0a 2020 2320  'indexed')..  # 
-00005ce0: 7365 7420 736f 6d65 206f 7074 696f 6e73  set some options
-00005cf0: 0a20 2069 6e64 6578 6564 4669 742e 7365  .  indexedFit.se
-00005d00: 744f 7074 696f 6e73 2872 756e 5f6d 696e  tOptions(run_min
-00005d10: 6f73 3d54 7275 652c 0a20 2020 2020 2020  os=True,.       
-00005d20: 2020 2020 2020 2020 2020 2072 656c 6174             relat
-00005d30: 6976 655f 7265 6665 7273 5f74 6f5f 6d6f  ive_refers_to_mo
-00005d40: 6465 6c3d 7265 665f 746f 5f6d 6f64 656c  del=ref_to_model
-00005d50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00005d60: 2020 2020 7573 655f 6e65 674c 6f67 4c3d      use_negLogL=
-00005d70: 7573 655f 6e65 674c 6f67 4c2c 0a20 2020  use_negLogL,.   
-00005d80: 2020 2020 2020 2020 2020 2020 2020 2071                 q
-00005d90: 7569 6574 3d71 7569 6574 290a 0a20 2023  uiet=quiet)..  #
-00005da0: 2070 6173 7320 6461 7461 2061 6e64 2075   pass data and u
-00005db0: 6e63 6572 7461 696e 7469 6573 2074 6f20  ncertainties to 
-00005dc0: 6669 7420 6f62 6a65 6374 0a20 2069 6e64  fit object.  ind
-00005dd0: 6578 6564 4669 742e 696e 6974 5f64 6174  exedFit.init_dat
-00005de0: 6128 782c 2065 203d 2073 2c20 0a20 2020  a(x, e = s, .   
-00005df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005e00: 2020 2020 6572 656c 203d 2073 7265 6c2c      erel = srel,
-00005e10: 2063 6162 7320 3d20 7361 6273 636f 722c   cabs = sabscor,
-00005e20: 2063 7265 6c20 3d20 7372 656c 636f 722c   crel = srelcor,
-00005e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005e40: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
-00005e50: 6e61 6d65 7329 0a20 2020 2320 7061 7373  names).   # pass
-00005e60: 206d 6f64 656c 2066 756e 6374 696f 6e2c   model function,
-00005e70: 2073 7461 7274 2070 6172 616d 6574 6572   start parameter
-00005e80: 2061 6e64 2070 6f73 7369 626c 6520 636f   and possible co
-00005e90: 6e73 7472 6169 6e74 730a 2020 696e 6465  nstraints.  inde
-00005ea0: 7865 6446 6974 2e69 6e69 745f 6669 7428  xedFit.init_fit(
-00005eb0: 6669 7466 2c20 6d6f 6465 6c5f 6b77 6172  fitf, model_kwar
-00005ec0: 6773 3d6d 6f64 656c 5f6b 7761 7267 732c  gs=model_kwargs,
-00005ed0: 2070 303d 7030 2c20 6470 303d 6470 302c   p0=p0, dp0=dp0,
-00005ee0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00005ef0: 2063 6f6e 7374 7261 696e 7473 3d63 6f6e   constraints=con
-00005f00: 7374 7261 696e 7473 2c0a 2020 2020 2020  straints,.      
-00005f10: 2020 2020 2020 2020 2066 6978 5061 7273           fixPars
-00005f20: 3d66 6978 5061 7273 2c0a 2020 2020 2020  =fixPars,.      
-00005f30: 2020 2020 2020 2020 206c 696d 6974 733d           limits=
-00005f40: 6c69 6d69 7473 290a 2020 2023 2070 6572  limits).   # per
-00005f50: 666f 726d 2074 6865 2066 6974 0a20 2066  form the fit.  f
-00005f60: 6974 5265 7375 6c74 203d 2069 6e64 6578  itResult = index
-00005f70: 6564 4669 742e 646f 5f66 6974 2829 0a20  edFit.do_fit(). 
-00005f80: 2023 2070 7269 6e74 2066 6974 2072 6573   # print fit res
-00005f90: 756c 7428 6469 6374 696f 6e61 7279 2066  ult(dictionary f
-00005fa0: 726f 6d20 6d69 6772 6164 2f6d 696e 6f73  rom migrad/minos
-00005fb0: 280a 2020 6966 206e 6f74 2071 7569 6574  (.  if not quiet
-00005fc0: 3a0a 2020 2020 7072 696e 7428 225c 6e46  :.    print("\nF
-00005fd0: 6974 2052 6573 756c 7420 6672 6f6d 206d  it Result from m
-00005fe0: 6967 7261 643a 2229 0a20 2020 2070 7269  igrad:").    pri
-00005ff0: 6e74 2866 6974 5265 7375 6c74 5b30 5d29  nt(fitResult[0])
-00006000: 0a20 2020 2069 6620 6669 7452 6573 756c  .    if fitResul
-00006010: 745b 315d 2069 7320 6e6f 7420 4e6f 6e65  t[1] is not None
-00006020: 3a0a 2020 2020 2020 7072 696e 7428 225c  :.      print("\
-00006030: 6e52 6573 756c 7420 6f66 206d 696e 6f73  nResult of minos
-00006040: 2065 7272 6f72 2061 6e61 6c79 7369 733a   error analysis:
-00006050: 2229 0a20 2020 2020 2070 7269 6e74 2866  ").      print(f
-00006060: 6974 5265 7375 6c74 5b31 5d29 0a20 2020  itResult[1]).   
-00006070: 200a 2020 2320 7072 6f64 7563 6520 6669   .  # produce fi
-00006080: 6775 7265 2077 6974 6820 6461 7461 2061  gure with data a
-00006090: 6e64 206d 6f64 656c 0a20 2069 6620 706c  nd model.  if pl
-000060a0: 6f74 3a0a 2020 2020 6669 6720 3d20 696e  ot:.    fig = in
-000060b0: 6465 7865 6446 6974 2e70 6c6f 744d 6f64  dexedFit.plotMod
-000060c0: 656c 2861 7869 735f 6c61 6265 6c73 3d61  el(axis_labels=a
-000060d0: 7869 735f 6c61 6265 6c73 2c0a 2020 2020  xis_labels,.    
-000060e0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-000060f0: 615f 6c65 6765 6e64 3d64 6174 615f 6c65  a_legend=data_le
-00006100: 6765 6e64 2c0a 2020 2020 2020 2020 2020  gend,.          
-00006110: 2020 2020 2020 206d 6f64 656c 5f6c 6567         model_leg
-00006120: 656e 643d 6d6f 6465 6c5f 6c65 6765 6e64  end=model_legend
-00006130: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006140: 2020 2070 6c6f 745f 6261 6e64 3d70 6c6f     plot_band=plo
-00006150: 745f 6261 6e64 2c0a 2020 2020 2020 2020  t_band,.        
-00006160: 2020 2020 2020 2020 2073 616d 655f 706c           same_pl
-00006170: 6f74 203d 2073 616d 655f 706c 6f74 2c0a  ot = same_plot,.
-00006180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006190: 2070 6c6f 745f 7265 7369 6475 616c 3d70   plot_residual=p
-000061a0: 6c6f 745f 7265 7369 6475 616c 290a 0a20  lot_residual).. 
-000061b0: 2023 2066 6967 7572 6520 7769 7468 2076   # figure with v
-000061c0: 6973 7561 6c20 7265 7072 6573 656e 7461  isual representa
-000061d0: 7469 6f6e 206f 6620 636f 7661 7269 616e  tion of covarian
-000061e0: 6365 730a 2020 2320 2020 7072 6f66 696c  ces.  #   profil
-000061f0: 6520 6c69 6b65 6c69 686f 6f64 2073 6361  e likelihood sca
-00006200: 6e20 616e 6420 636f 6e66 6964 656e 6365  n and confidence
-00006210: 2063 6f6e 746f 7572 730a 2020 6966 2070   contours.  if p
-00006220: 6c6f 745f 636f 723a 0a20 2020 2066 6967  lot_cor:.    fig
-00006230: 5f63 6f72 203d 2069 6e64 6578 6564 4669  _cor = indexedFi
-00006240: 742e 706c 6f74 436f 6e74 6f75 7273 2866  t.plotContours(f
-00006250: 6967 6e61 6d65 3d22 7879 4669 743a 2050  igname="xyFit: P
-00006260: 726f 6669 6c65 7320 616e 6420 436f 6e74  rofiles and Cont
-00006270: 6f75 7273 2229 0a0a 2020 2320 7368 6f77  ours")..  # show
-00006280: 2070 6c6f 7473 206f 6e20 7363 7265 656e   plots on screen
-00006290: 0a20 2069 6620 7368 6f77 706c 6f74 7320  .  if showplots 
-000062a0: 616e 6420 2870 6c6f 7420 6f72 2070 6c6f  and (plot or plo
-000062b0: 745f 636f 7229 3a0a 2020 2020 706c 742e  t_cor):.    plt.
-000062c0: 7368 6f77 2829 0a0a 2020 6966 2072 6574  show()..  if ret
-000062d0: 7572 6e5f 6669 744f 626a 6563 743a 0a20  urn_fitObject:. 
-000062e0: 2020 2072 6574 7572 6e20 696e 6465 7865     return indexe
-000062f0: 6446 6974 0a20 2065 6c73 653a 0a20 2020  dFit.  else:.   
-00006300: 2023 2072 6574 7572 6e0a 2020 2020 2320   # return.    # 
-00006310: 2020 6e75 6d70 7920 6172 7261 7973 2077    numpy arrays w
-00006320: 6974 6820 6669 7420 7265 7375 6c74 3a20  ith fit result: 
-00006330: 7061 7261 6d65 7465 7220 7661 6c75 6573  parameter values
-00006340: 2c0a 2020 2020 2320 2020 6e65 6761 7469  ,.    #   negati
-00006350: 7665 2061 6e64 2070 6f73 6974 6976 6520  ve and positive 
-00006360: 7061 7261 6d65 7465 7220 756e 6365 7274  parameter uncert
-00006370: 6169 6e74 6965 732c 0a20 2020 2023 2020  ainties,.    #  
-00006380: 2063 6f72 7265 6c61 7469 6f6e 206d 6174   correlation mat
-00006390: 7269 780a 2020 2020 2320 2020 676f 660a  rix.    #   gof.
-000063a0: 2020 2020 2320 2020 7061 7261 6d65 7465      #   paramete
-000063b0: 7220 6e61 6d65 730a 2020 2020 7265 7475  r names.    retu
-000063c0: 726e 2069 6e64 6578 6564 4669 742e 6765  rn indexedFit.ge
-000063d0: 7452 6573 756c 7428 290a 0a64 6566 2068  tResult()..def h
-000063e0: 4669 7428 6669 7466 2c20 6269 6e5f 636f  Fit(fitf, bin_co
-000063f0: 6e74 656e 7473 2c20 6269 6e5f 6564 6765  ntents, bin_edge
-00006400: 732c 2044 656c 7461 4d75 3d4e 6f6e 652c  s, DeltaMu=None,
-00006410: 0a20 2020 2020 2020 2020 6d6f 6465 6c5f  .         model_
-00006420: 6b77 6172 6773 203d 204e 6f6e 652c 0a20  kwargs = None,. 
-00006430: 2020 2020 2020 2020 7030 203d 204e 6f6e          p0 = Non
-00006440: 652c 2064 7030 203d 204e 6f6e 652c 2063  e, dp0 = None, c
-00006450: 6f6e 7374 7261 696e 7473 203d 204e 6f6e  onstraints = Non
-00006460: 652c 0a20 2020 2020 2020 2020 6669 7850  e,.         fixP
-00006470: 6172 733d 4e6f 6e65 2c20 6c69 6d69 7473  ars=None, limits
-00006480: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-00006490: 7573 655f 4761 7573 7341 7070 726f 7820  use_GaussApprox 
-000064a0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-000064b0: 2020 6669 745f 6465 6e73 6974 7920 3d20    fit_density = 
-000064c0: 5472 7565 2c0a 2020 2020 2020 2020 2070  True,.         p
-000064d0: 6c6f 7420 3d20 5472 7565 2c20 706c 6f74  lot = True, plot
-000064e0: 5f63 6f72 203d 2046 616c 7365 2c0a 2020  _cor = False,.  
-000064f0: 2020 2020 2020 2073 686f 7770 6c6f 7473         showplots
-00006500: 203d 2054 7275 652c 2070 6c6f 745f 6261   = True, plot_ba
-00006510: 6e64 3d54 7275 652c 2070 6c6f 745f 7265  nd=True, plot_re
-00006520: 7369 6475 616c 3d46 616c 7365 2c0a 2020  sidual=False,.  
-00006530: 2020 2020 2020 2073 616d 655f 706c 6f74         same_plot
-00006540: 203d 2046 616c 7365 2c20 2020 2023 206f   = False,    # o
-00006550: 7665 726c 6179 2066 6974 2069 6e66 6f20  verlay fit info 
-00006560: 6672 6f6d 2070 7265 7669 6f69 7573 2063  from previoius c
-00006570: 616c 6c28 7329 0a20 2020 2020 2020 2020  all(s).         
-00006580: 7175 6965 7420 3d20 5472 7565 2c0a 2020  quiet = True,.  
-00006590: 2020 2020 2020 2061 7869 735f 6c61 6265         axis_labe
-000065a0: 6c73 3d5b 2778 272c 2027 636f 756e 7473  ls=['x', 'counts
-000065b0: 2f62 696e 203d 2066 2878 2c20 2a70 6172  /bin = f(x, *par
-000065c0: 2927 5d2c 0a20 2020 2020 2020 2020 6461  )'],.         da
-000065d0: 7461 5f6c 6567 656e 6420 3d20 2748 6973  ta_legend = 'His
-000065e0: 746f 6772 616d 2044 6174 6127 2c20 2020  togram Data',   
-000065f0: 200a 2020 2020 2020 2020 206d 6f64 656c   .         model
-00006600: 5f6c 6567 656e 6420 3d20 274d 6f64 656c  _legend = 'Model
-00006610: 272c 0a20 2020 2020 2020 2020 7265 7475  ',.         retu
-00006620: 726e 5f66 6974 4f62 6a65 6374 3d46 616c  rn_fitObject=Fal
-00006630: 7365 2029 203a 0a20 200a 2020 2222 2257  se ) :.  .  """W
-00006640: 7261 7070 6572 2066 756e 6374 696f 6e20  rapper function 
-00006650: 746f 2066 6974 2061 2064 656e 7369 7479  to fit a density
-00006660: 2064 6973 7472 6962 7574 696f 6e20 6628   distribution f(
-00006670: 782c 205c 2a70 6172 2920 0a20 2074 6f20  x, \*par) .  to 
-00006680: 6269 6e6e 6564 2064 6174 6120 2868 6973  binned data (his
-00006690: 746f 6772 616d 2920 7769 7468 2063 6c61  togram) with cla
-000066a0: 7373 206d 6e46 6974 200a 2020 0a20 2054  ss mnFit .  .  T
-000066b0: 6865 2063 6f73 7420 6675 6e63 7469 6f6e  he cost function
-000066c0: 2069 7320 7477 6f20 7469 6d65 7320 7468   is two times th
-000066d0: 6520 6e65 6761 7469 7665 206c 6f67 2d6c  e negative log-l
-000066e0: 696b 656c 6968 6f6f 6420 6f66 2074 6865  ikelihood of the
-000066f0: 2050 6f69 7373 6f6e 200a 2020 6469 7374   Poisson .  dist
-00006700: 7269 6275 7469 6f6e 2c20 6f72 202d 206f  ribution, or - o
-00006710: 7074 696f 6e61 6c6c 7920 2d20 6f66 2074  ptionally - of t
-00006720: 6865 2047 6175 7373 6961 6e20 6170 7072  he Gaussian appr
-00006730: 6f78 696d 6174 696f 6e2e 0a0a 2020 556e  oximation...  Un
-00006740: 6365 7274 6169 6e74 6965 7320 6172 6520  certainties are 
-00006750: 6465 7465 726d 696e 6564 2066 726f 6d20  determined from 
-00006760: 7468 6520 6d6f 6465 6c20 7661 6c75 6573  the model values
-00006770: 2069 6e20 6f72 6465 7220 746f 2061 766f   in order to avo
-00006780: 6964 2062 6961 7365 7320 0a20 2061 6e64  id biases .  and
-00006790: 2074 6f20 7461 6b65 2061 6363 6f75 6e74   to take account
-000067a0: 206f 6620 656d 7074 7920 6269 6e73 206f   of empty bins o
-000067b0: 6620 616e 2068 6973 746f 6772 616d 2e20  f an histogram. 
-000067c0: 5468 6520 6465 6661 756c 7420 6265 6861  The default beha
-000067d0: 7669 6f75 7220 6973 200a 2020 746f 2066  viour is .  to f
-000067e0: 6974 2061 206e 6f72 6d61 6c69 7365 6420  it a normalised 
-000067f0: 6465 6e73 6974 793b 206f 7074 696f 6e61  density; optiona
-00006800: 6c6c 792c 2069 7420 6973 2061 6c73 6f20  lly, it is also 
-00006810: 706f 7373 6962 6c65 2074 6f20 6669 7420  possible to fit 
-00006820: 7468 6520 0a20 206e 756d 6265 7220 6f66  the .  number of
-00006830: 2062 696e 2065 6e74 7269 6573 2e0a 0a20   bin entries... 
-00006840: 2041 7267 733a 0a20 2020 202a 2066 6974   Args:.    * fit
-00006850: 663a 206d 6f64 656c 2066 756e 6374 696f  f: model functio
-00006860: 6e20 746f 2066 6974 2c20 6172 6775 6d65  n to fit, argume
-00006870: 6e74 7320 2866 6c6f 6174 3a78 2c20 666c  nts (float:x, fl
-00006880: 6f61 743a 205c 2a61 7267 7329 0a20 2020  oat: \*args).   
-00006890: 202a 2062 696e 5f63 6f6e 7465 6e74 733a   * bin_contents:
-000068a0: 2020 0a20 2020 202a 2062 696e 5f65 6467    .    * bin_edg
-000068b0: 6573 3a20 0a20 2020 202a 2044 656c 7461  es: .    * Delta
-000068c0: 4d75 3a20 7368 6966 7420 6d65 616e 2028  Mu: shift mean (
-000068d0: 3d6d 7529 2076 732e 2076 6172 6961 6e63  =mu) vs. varianc
-000068e0: 6520 283d 6c61 6d29 2c20 666f 7220 506f  e (=lam), for Po
-000068f0: 6973 736f 6e3a 206d 753d 6c61 6d0a 2020  isson: mu=lam.  
-00006900: 2020 2a20 6d6f 6465 6c5f 6b77 6172 6773    * model_kwargs
-00006910: 3a20 6f70 7469 6f6e 616c 2c20 6669 7420  : optional, fit 
-00006920: 7061 7261 6d65 7465 7273 2069 6620 6e6f  parameters if no
-00006930: 7420 6672 6f6d 206d 6f64 656c 2073 6967  t from model sig
-00006940: 6e61 7475 7265 200a 2020 2020 2a20 7030  nature .    * p0
-00006950: 3a20 6172 7261 792d 6c69 6b65 2c20 696e  : array-like, in
-00006960: 6974 6961 6c20 6775 6573 7320 6f66 2070  itial guess of p
-00006970: 6172 616d 6574 6572 730a 2020 2020 2a20  arameters.    * 
-00006980: 6470 303a 2061 7272 6179 2d6c 696b 652c  dp0: array-like,
-00006990: 2069 6e69 7469 616c 2067 7565 7373 206f   initial guess o
-000069a0: 6620 7061 7261 6d65 7465 7220 756e 6365  f parameter unce
-000069b0: 7274 6169 6e74 6965 7320 286f 7074 696f  rtainties (optio
-000069c0: 6e61 6c29 0a20 2020 202a 2063 6f6e 7374  nal).    * const
-000069d0: 7261 696e 7473 3a20 286e 6573 7465 6429  raints: (nested)
-000069e0: 206c 6973 7428 7329 205b 6e61 6d65 206f   list(s) [name o
-000069f0: 7220 6964 2c20 7661 6c75 652c 2065 7272  r id, value, err
-00006a00: 6f72 5d20 0a20 2020 202a 206c 696d 6974  or] .    * limit
-00006a10: 733a 2028 6e65 7374 6564 2920 6c69 7374  s: (nested) list
-00006a20: 2873 2920 5b6e 616d 6520 6f72 2069 642c  (s) [name or id,
-00006a30: 206d 696e 2c20 6d61 785d 200a 2020 2020   min, max] .    
-00006a40: 2a20 7573 655f 4761 7573 7341 7070 726f  * use_GaussAppro
-00006a50: 783a 2047 6175 7373 6961 6e20 6170 7072  x: Gaussian appr
-00006a60: 6f78 696d 6174 696f 6e20 696e 7374 6561  oximation instea
-00006a70: 6420 6f66 2050 6f69 7373 6f6e 200a 2020  d of Poisson .  
-00006a80: 2020 2a20 6465 6e73 6974 793a 2066 6974    * density: fit
-00006a90: 2064 656e 7369 7479 2028 6e6f 7420 6e75   density (not nu
-00006aa0: 6d62 6572 206f 6620 6576 656e 7473 290a  mber of events).
-00006ab0: 2020 2020 2a20 706c 6f74 3a20 7368 6f77      * plot: show
-00006ac0: 2064 6174 6120 616e 6420 6d6f 6465 6c20   data and model 
-00006ad0: 6966 2054 7275 650a 2020 2020 2a20 706c  if True.    * pl
-00006ae0: 6f74 5f63 6f72 3a20 7368 6f77 2070 726f  ot_cor: show pro
-00006af0: 6669 6c65 206c 696b 656c 6968 6f6f 6473  file likelihoods
-00006b00: 2061 6e64 2063 6f6e 6669 6465 6e63 6520   and confidence 
-00006b10: 636f 6e74 6f75 7273 0a20 2020 202a 2070  contours.    * p
-00006b20: 6c6f 745f 6261 6e64 3a20 706c 6f74 2075  lot_band: plot u
-00006b30: 6e63 6572 7461 696e 7479 2062 616e 6420  ncertainty band 
-00006b40: 6172 6f75 6e64 206d 6f64 656c 2066 756e  around model fun
-00006b50: 6374 696f 6e0a 2020 2020 2a20 7361 6d65  ction.    * same
-00006b60: 5f70 6c6f 743a 206f 7665 726c 6179 2066  _plot: overlay f
-00006b70: 6974 2069 6e66 6f20 6672 6f6d 2070 7265  it info from pre
-00006b80: 7669 6f75 7320 6361 6c6c 2873 290a 2020  vious call(s).  
-00006b90: 2020 2a20 706c 6f74 5f72 6573 6964 7561    * plot_residua
-00006ba0: 6c3a 2070 6c6f 7420 7265 7369 6475 616c  l: plot residual
-00006bb0: 7320 772e 722e 742e 206d 6f64 656c 2069  s w.r.t. model i
-00006bc0: 6e73 7465 6164 206f 6620 6d6f 6465 6c20  nstead of model 
-00006bd0: 6675 6e63 7469 6f6e 0a20 2020 202a 2073  function.    * s
-00006be0: 686f 7770 6c6f 7473 3a20 7368 6f77 2070  howplots: show p
-00006bf0: 6c6f 7473 206f 6e20 7363 7265 656e 0a20  lots on screen. 
-00006c00: 2020 202a 2071 7569 6574 3a20 7375 7070     * quiet: supp
-00006c10: 7265 7373 2070 7269 6e74 6f75 740a 2020  ress printout.  
-00006c20: 2020 2a20 6178 6973 5f6c 6162 6573 3a20    * axis_labes: 
-00006c30: 6c69 7374 206f 6620 746f 7720 7374 7269  list of tow stri
-00006c40: 6e67 732c 2061 7869 7320 6c61 6265 6c73  ngs, axis labels
-00006c50: 0a20 2020 202a 2064 6174 615f 6c65 6765  .    * data_lege
-00006c60: 6e64 3a20 6c65 6765 6e64 2065 6e74 7279  nd: legend entry
-00006c70: 2066 6f72 2064 6174 610a 2020 2020 2a20   for data.    * 
-00006c80: 6d6f 6465 6c5f 6c65 6765 6e64 3a20 6c65  model_legend: le
-00006c90: 6765 6e64 2065 6e74 7279 2066 6f72 206d  gend entry for m
-00006ca0: 6f64 656c 200a 2020 2020 2a20 626f 6f6c  odel .    * bool
-00006cb0: 3a20 666f 7220 6578 7065 7274 7320 6f6e  : for experts on
-00006cc0: 6c79 2c20 7265 7475 726e 2069 6e73 7461  ly, return insta
-00006cd0: 6e63 6520 6f66 2063 6c61 7373 206d 6e46  nce of class mnF
-00006ce0: 6974 2074 6f20 6769 7665 2061 6363 6573  it to give acces
-00006cf0: 7320 0a20 2020 2020 2074 6f20 6461 7461  s .      to data
-00006d00: 206d 656d 6265 7273 2061 6e64 206d 6574   members and met
-00006d10: 686f 6473 0a0a 2020 5265 7475 726e 733a  hods..  Returns:
-00006d20: 0a20 2020 202a 206e 702d 6172 7261 7920  .    * np-array 
-00006d30: 6f66 2066 6c6f 6174 3a20 7061 7261 6d65  of float: parame
-00006d40: 7465 7220 7661 6c75 6573 0a20 2020 202a  ter values.    *
-00006d50: 2032 6420 6e70 2d61 7272 6179 206f 6620   2d np-array of 
-00006d60: 666c 6f61 743a 2070 6172 616d 6574 6572  float: parameter
-00006d70: 2075 6e63 6572 7461 696e 7469 6573 205b   uncertainties [
-00006d80: 305d 3a20 6e65 672e 2061 6e64 205b 315d  0]: neg. and [1]
-00006d90: 3a20 706f 732e 200a 2020 2020 2a20 6e70  : pos. .    * np
-00006da0: 2d61 7272 6179 3a20 636f 7272 656c 6174  -array: correlat
-00006db0: 696f 6e20 6d61 7472 6978 200a 2020 2020  ion matrix .    
-00006dc0: 2a20 666c 6f61 743a 2032 2a6e 6567 4c6f  * float: 2*negLo
-00006dd0: 6720 4c2c 2063 6f72 7265 7370 6f6e 6469  g L, correspondi
-00006de0: 6e67 2074 6f20 5c63 6869 2d73 7175 6172  ng to \chi-squar
-00006df0: 6520 6f66 2066 6974 2061 206d 696e 696d  e of fit a minim
-00006e00: 756d 0a20 2022 2222 0a0a 2020 2323 2066  um.  """..  ## f
-00006e10: 726f 6d20 2e70 6879 4669 7420 696d 706f  rom .phyFit impo
-00006e20: 7274 206d 6e46 6974 2023 2120 616c 7265  rt mnFit #! alre
-00006e30: 6164 7920 636f 6e74 6169 6e65 6420 696e  ady contained in
-00006e40: 2074 6869 7320 6669 6c65 0a0a 2020 2320   this file..  # 
-00006e50: 7365 7420 7570 2061 2066 6974 206f 626a  set up a fit obj
-00006e60: 6563 7420 666f 7220 6869 7374 6f67 7261  ect for histogra
-00006e70: 6d20 6669 7473 0a20 2046 6974 203d 206d  m fits.  Fit = m
-00006e80: 6e46 6974 2827 6869 7374 2729 0a0a 2020  nFit('hist')..  
-00006e90: 2320 7365 7420 6465 6661 756c 7420 6f70  # set default op
-00006ea0: 7469 6f6e 730a 2020 4669 742e 7365 744f  tions.  Fit.setO
-00006eb0: 7074 696f 6e73 2872 756e 5f6d 696e 6f73  ptions(run_minos
-00006ec0: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
-00006ed0: 2020 2020 2020 2020 2020 7573 655f 4761            use_Ga
-00006ee0: 7573 7341 7070 726f 7820 3d20 7573 655f  ussApprox = use_
-00006ef0: 4761 7573 7341 7070 726f 782c 0a20 2020  GaussApprox,.   
-00006f00: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-00006f10: 745f 6465 6e73 6974 7920 3d20 6669 745f  t_density = fit_
-00006f20: 6465 6e73 6974 792c 0a20 2020 2020 2020  density,.       
-00006f30: 2020 2020 2020 2020 2020 7175 6965 7420            quiet 
-00006f40: 3d20 7175 6965 7429 0a0a 2020 2320 7061  = quiet)..  # pa
-00006f50: 7373 2064 6174 6120 616e 6420 756e 6365  ss data and unce
-00006f60: 7274 6169 6e74 6965 7320 746f 2066 6974  rtainties to fit
-00006f70: 206f 626a 6563 740a 2020 4669 742e 696e   object.  Fit.in
-00006f80: 6974 5f64 6174 6128 6269 6e5f 636f 6e74  it_data(bin_cont
-00006f90: 656e 7473 2c20 6269 6e5f 6564 6765 732c  ents, bin_edges,
-00006fa0: 2044 656c 7461 4d75 290a 2020 2023 2070   DeltaMu).   # p
-00006fb0: 6173 7320 6d6f 6465 6c20 6675 6374 696f  ass model fuctio
-00006fc0: 6e2c 2073 7461 7274 2070 6172 616d 6574  n, start paramet
-00006fd0: 6572 2061 6e64 2070 6f73 7369 6265 2063  er and possibe c
-00006fe0: 6f6e 7374 7261 696e 7473 0a20 2046 6974  onstraints.  Fit
-00006ff0: 2e69 6e69 745f 6669 7428 6669 7466 2c20  .init_fit(fitf, 
-00007000: 6d6f 6465 6c5f 6b77 6172 6773 3d6d 6f64  model_kwargs=mod
-00007010: 656c 5f6b 7761 7267 732c 2070 303d 7030  el_kwargs, p0=p0
-00007020: 2c20 6470 303d 6470 302c 0a20 2020 2020  , dp0=dp0,.     
-00007030: 2020 2020 2020 2020 2020 636f 6e73 7472            constr
-00007040: 6169 6e74 733d 636f 6e73 7472 6169 6e74  aints=constraint
-00007050: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00007060: 2020 6669 7850 6172 733d 6669 7850 6172    fixPars=fixPar
-00007070: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00007080: 2020 6c69 6d69 7473 3d6c 696d 6974 7329    limits=limits)
-00007090: 0a20 2023 2070 6572 666f 726d 2074 6865  .  # perform the
-000070a0: 2066 6974 0a20 2066 6974 5265 7375 6c74   fit.  fitResult
-000070b0: 203d 2046 6974 2e64 6f5f 6669 7428 290a   = Fit.do_fit().
-000070c0: 2020 2320 7072 696e 7420 6669 7420 7265    # print fit re
-000070d0: 7375 6c74 2028 6469 6374 696f 6e61 7279  sult (dictionary
-000070e0: 2066 726f 6d20 6d69 6772 6164 2f6d 696e   from migrad/min
-000070f0: 6f73 280a 2020 6966 206e 6f74 2071 7569  os(.  if not qui
-00007100: 6574 3a0a 2020 2020 7072 696e 7428 225c  et:.    print("\
-00007110: 6e46 6974 2052 6573 756c 7420 6672 6f6d  nFit Result from
-00007120: 206d 6967 7261 643a 2229 0a20 2020 2070   migrad:").    p
-00007130: 7269 6e74 2866 6974 5265 7375 6c74 5b30  rint(fitResult[0
-00007140: 5d29 0a20 2020 2069 6620 6669 7452 6573  ]).    if fitRes
-00007150: 756c 745b 315d 2069 7320 6e6f 7420 4e6f  ult[1] is not No
-00007160: 6e65 3a0a 2020 2020 2020 7072 696e 7428  ne:.      print(
-00007170: 225c 6e52 6573 756c 7420 6f66 206d 696e  "\nResult of min
-00007180: 6f73 2065 7272 6f72 2061 6e61 6c79 7369  os error analysi
-00007190: 733a 2229 0a20 2020 2020 2070 7269 6e74  s:").      print
-000071a0: 2866 6974 5265 7375 6c74 5b31 5d29 0a20  (fitResult[1]). 
-000071b0: 2020 200a 2020 2320 7072 6f64 7563 6520     .  # produce 
-000071c0: 6669 6775 7265 2077 6974 6820 6461 7461  figure with data
-000071d0: 2061 6e64 206d 6f64 656c 0a20 2069 6620   and model.  if 
-000071e0: 706c 6f74 3a0a 2020 2020 6669 6720 3d20  plot:.    fig = 
-000071f0: 4669 742e 706c 6f74 4d6f 6465 6c28 6178  Fit.plotModel(ax
-00007200: 6973 5f6c 6162 656c 733d 6178 6973 5f6c  is_labels=axis_l
-00007210: 6162 656c 732c 0a20 2020 2020 2020 2020  abels,.         
-00007220: 2020 2020 2020 2020 6461 7461 5f6c 6567          data_leg
-00007230: 656e 643d 6461 7461 5f6c 6567 656e 642c  end=data_legend,
-00007240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007250: 2020 6d6f 6465 6c5f 6c65 6765 6e64 3d6d    model_legend=m
-00007260: 6f64 656c 5f6c 6567 656e 642c 0a20 2020  odel_legend,.   
-00007270: 2020 2020 2020 2020 2020 2020 2020 706c                pl
-00007280: 6f74 5f62 616e 643d 706c 6f74 5f62 616e  ot_band=plot_ban
-00007290: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-000072a0: 2020 2020 7361 6d65 5f70 6c6f 7420 3d20      same_plot = 
-000072b0: 7361 6d65 5f70 6c6f 742c 0a20 2020 2020  same_plot,.     
-000072c0: 2020 2020 2020 2020 2020 2020 706c 6f74              plot
-000072d0: 5f72 6573 6964 7561 6c3d 706c 6f74 5f72  _residual=plot_r
-000072e0: 6573 6964 7561 6c29 0a0a 2020 2320 6669  esidual)..  # fi
-000072f0: 6775 7265 2077 6974 6820 7669 7375 616c  gure with visual
-00007300: 2072 6570 7265 7365 6e74 6174 696f 6e20   representation 
-00007310: 6f66 2063 6f76 6172 6961 6e63 6573 0a20  of covariances. 
-00007320: 2023 2020 2070 726f 6669 6c65 206c 696b   #   profile lik
-00007330: 656c 6968 6f6f 6420 7363 616e 2061 6e64  elihood scan and
-00007340: 2063 6f6e 6669 6465 6e63 6520 636f 6e74   confidence cont
-00007350: 6f75 7273 0a20 2069 6620 706c 6f74 5f63  ours.  if plot_c
-00007360: 6f72 3a0a 2020 2020 6669 675f 636f 7220  or:.    fig_cor 
-00007370: 3d20 4669 742e 706c 6f74 436f 6e74 6f75  = Fit.plotContou
-00007380: 7273 2866 6967 6e61 6d65 3d22 6869 7374  rs(figname="hist
-00007390: 4669 743a 2050 726f 6669 6c65 7320 616e  Fit: Profiles an
-000073a0: 6420 436f 6e74 6f75 7273 2229 0a0a 2020  d Contours")..  
-000073b0: 2320 7368 6f77 2070 6c6f 7473 206f 6e20  # show plots on 
-000073c0: 7363 7265 656e 0a20 2069 6620 7368 6f77  screen.  if show
-000073d0: 706c 6f74 7320 616e 6420 2870 6c6f 7420  plots and (plot 
-000073e0: 6f72 2070 6c6f 745f 636f 7229 3a0a 2020  or plot_cor):.  
-000073f0: 2020 706c 742e 7368 6f77 2829 0a0a 2020    plt.show()..  
-00007400: 6966 2072 6574 7572 6e5f 6669 744f 626a  if return_fitObj
-00007410: 6563 743a 0a20 2020 2072 6574 7572 6e20  ect:.    return 
-00007420: 4669 740a 2020 656c 7365 3a0a 2020 2020  Fit.  else:.    
-00007430: 2320 7265 7475 726e 0a20 2020 2023 2020  # return.    #  
-00007440: 206e 756d 7079 2061 7272 6179 7320 7769   numpy arrays wi
-00007450: 7468 2066 6974 2072 6573 756c 743a 2070  th fit result: p
-00007460: 6172 616d 6574 6572 2076 616c 7565 732c  arameter values,
-00007470: 0a20 2020 2023 2020 206e 6567 6174 6976  .    #   negativ
-00007480: 6520 616e 6420 706f 7369 7469 7665 2070  e and positive p
-00007490: 6172 616d 6574 6572 2075 6e63 6572 7461  arameter uncerta
-000074a0: 696e 7469 6573 2c0a 2020 2020 2320 2020  inties,.    #   
-000074b0: 636f 7272 656c 6174 696f 6e20 6d61 7472  correlation matr
-000074c0: 6978 0a20 2020 2023 2020 2067 6f66 0a20  ix.    #   gof. 
-000074d0: 2020 2023 2020 2070 6172 616d 6574 6572     #   parameter
-000074e0: 206e 616d 6573 0a20 2020 2072 6574 7572   names.    retur
-000074f0: 6e20 4669 742e 6765 7452 6573 756c 7428  n Fit.getResult(
-00007500: 290a 0a64 6566 2068 4669 745f 6672 6f6d  )..def hFit_from
-00007510: 5f79 616d 6c28 6664 2c20 2020 2020 2020  _yaml(fd,       
-00007520: 2020 2020 2320 6469 6374 696f 6e61 7279      # dictionary
-00007530: 2064 6566 696e 696e 6720 6669 7420 696e   defining fit in
-00007540: 7075 740a 2020 2020 2020 2020 2020 2020  put.            
-00007550: 2070 6c6f 743d 5472 7565 2c20 2020 2020   plot=True,     
-00007560: 2020 2020 2023 2070 6c6f 7420 6461 7461       # plot data
-00007570: 2061 6e64 206d 6f64 656c 0a20 2020 2020   and model.     
-00007580: 2020 2020 2020 2020 706c 6f74 5f62 616e          plot_ban
-00007590: 643d 5472 7565 2c20 2020 2020 2320 706c  d=True,     # pl
-000075a0: 6f74 206d 6f64 656c 2063 6f6e 6669 6465  ot model confide
-000075b0: 6e63 652d 6261 6e64 0a20 2020 2020 2020  nce-band.       
-000075c0: 2020 2020 2020 706c 6f74 5f63 6f72 3d46        plot_cor=F
-000075d0: 616c 7365 2c20 2020 2020 2320 706c 6f74  alse,     # plot
-000075e0: 2070 726f 6669 6c65 7320 6c69 6b65 6c69   profiles likeli
-000075f0: 686f 6f64 2061 6e64 2063 6f6e 746f 7572  hood and contour
-00007600: 730a 2020 2020 2020 2020 2020 2020 2073  s.             s
-00007610: 686f 7770 6c6f 7473 203d 2054 7275 652c  howplots = True,
-00007620: 2020 2023 2073 686f 7720 706c 6f74 7320     # show plots 
-00007630: 6f6e 2073 6372 6565 6e0a 2020 2020 2020  on screen.      
-00007640: 2020 2020 2020 2073 616d 655f 706c 6f74         same_plot
-00007650: 203d 2054 7275 652c 2020 2023 206f 7665   = True,   # ove
-00007660: 726c 6179 2066 6974 2069 6e66 6f20 6672  rlay fit info fr
-00007670: 6f6d 2070 7265 7669 6f69 7573 2063 616c  om previoius cal
-00007680: 6c28 7329 0a20 2020 2020 2020 2020 2020  l(s).           
-00007690: 2020 7175 6965 743d 5472 7565 2c20 2020    quiet=True,   
-000076a0: 2020 2020 2020 2320 7375 7070 7265 7373        # suppress
-000076b0: 2069 6e66 6f72 6d61 7469 7665 2070 7269   informative pri
-000076c0: 6e74 6f75 740a 2020 2020 2020 2020 2020  ntout.          
-000076d0: 2020 2072 6574 7572 6e5f 6669 744f 626a     return_fitObj
-000076e0: 6563 743d 4661 6c73 6520 2320 0a20 2020  ect=False # .   
-000076f0: 2020 2020 2020 2020 293a 0a0a 2020 2222          ):..  ""
-00007700: 2242 696e 6e65 6420 6c6f 672d 6c69 6b65  "Binned log-like
-00007710: 6c69 686f 6f64 2066 6974 2074 6f20 6869  lihood fit to hi
-00007720: 7374 6f67 7261 6d20 6461 7461 2077 6974  stogram data wit
-00007730: 6820 696e 7075 7420 6672 6f6d 2079 616d  h input from yam
-00007740: 6c20 6669 6c65 2077 6974 6820 7068 7966  l file with phyf
-00007750: 6974 2e68 4669 7428 290a 0a20 2041 7267  it.hFit()..  Arg
-00007760: 733a 0a20 2020 202a 2066 643a 2066 6974  s:.    * fd: fit
-00007770: 2069 6e70 7574 2061 7320 6120 6469 6374   input as a dict
-00007780: 696f 6e61 7279 2c20 6578 7472 6163 7465  ionary, extracte
-00007790: 6420 6672 6f6d 2061 2066 696c 6520 696e  d from a file in
-000077a0: 2079 616d 6c20 666f 726d 6174 0a20 2020   yaml format.   
-000077b0: 202a 2070 6c6f 743a 2073 686f 7720 6461   * plot: show da
-000077c0: 7461 2061 6e64 206d 6f64 656c 2069 6620  ta and model if 
-000077d0: 5472 7565 0a20 2020 202a 2070 6c6f 745f  True.    * plot_
-000077e0: 636f 723a 2073 686f 7720 7072 6f66 696c  cor: show profil
-000077f0: 6520 6c69 6b65 6c69 686f 6f64 7320 616e  e likelihoods an
-00007800: 6420 636f 6e66 6964 656e 6365 2063 6f6e  d confidence con
-00007810: 746f 7572 730a 2020 2020 2a20 706c 6f74  tours.    * plot
-00007820: 5f62 616e 643a 2070 6c6f 7420 756e 6365  _band: plot unce
-00007830: 7274 6169 6e74 7920 6261 6e64 2061 726f  rtainty band aro
-00007840: 756e 6420 6d6f 6465 6c20 6675 6e63 7469  und model functi
-00007850: 6f6e 0a20 2020 202a 2070 6c6f 745f 7265  on.    * plot_re
-00007860: 7369 6475 616c 3a20 706c 6f74 2072 6573  sidual: plot res
-00007870: 6964 7561 6c73 2077 2e72 2e74 2e20 6d6f  iduals w.r.t. mo
-00007880: 6465 6c20 696e 7374 6561 6420 6f66 206d  del instead of m
-00007890: 6f64 656c 2066 756e 6374 696f 6e0a 2020  odel function.  
-000078a0: 2020 2a20 7368 6f77 706c 6f74 733a 2073    * showplots: s
-000078b0: 686f 7720 706c 6f74 7320 6f6e 2073 6372  how plots on scr
-000078c0: 6565 6e20 2d20 7377 6974 6368 206f 6666  een - switch off
-000078d0: 2069 6620 6861 6e64 6c65 6420 6279 2063   if handled by c
-000078e0: 616c 6c69 6e67 2070 726f 6365 7373 0a20  alling process. 
-000078f0: 2020 202a 2071 7569 6574 3a20 7375 7070     * quiet: supp
-00007900: 7265 7373 2069 6e66 6f72 6d61 7469 7665  ress informative
-00007910: 2070 7269 6e74 6f75 740a 0a20 2052 6574   printout..  Ret
-00007920: 7572 6e73 3a0a 2020 2020 2a20 7265 7375  urns:.    * resu
-00007930: 6c74 2064 6963 7469 6f6e 6172 790a 2020  lt dictionary.  
-00007940: 2020 2a20 6f70 7469 6f6e 616c 6c79 3a20    * optionally: 
-00007950: 7072 6f64 7563 6573 2072 6573 756c 7420  produces result 
-00007960: 706c 6f74 7320 0a0a 2020 7369 6d70 6c65  plots ..  simple
-00007970: 2065 7861 6d70 6c65 206f 6620 2a79 616d   example of *yam
-00007980: 6c2a 2069 6e70 7574 3a0a 0a20 202e 2e20  l* input:..  .. 
-00007990: 636f 6465 2d62 6c6f 636b 3a3a 2079 616d  code-block:: yam
-000079a0: 6c0a 0a20 2020 2023 2045 7861 6d70 6c65  l..    # Example
-000079b0: 206f 6620 6120 6669 7420 746f 2068 6973   of a fit to his
-000079c0: 746f 6772 616d 2064 6174 610a 2020 2020  togram data.    
-000079d0: 7479 7065 3a20 6869 7374 6f67 7261 6d0a  type: histogram.
-000079e0: 0a20 2020 206c 6162 656c 3a20 6578 616d  .    label: exam
-000079f0: 706c 6520 6461 7461 0a20 2020 2078 5f6c  ple data.    x_l
-00007a00: 6162 656c 3a20 2768 2720 0a20 2020 2079  abel: 'h' .    y
-00007a10: 5f6c 6162 656c 3a20 2770 6466 2868 2927  _label: 'pdf(h)'
-00007a20: 0a0a 2020 2020 2320 6461 7461 3a0a 2020  ..    # data:.  
-00007a30: 2020 7261 775f 6461 7461 3a20 5b20 3739    raw_data: [ 79
-00007a40: 2e38 332c 3739 2e36 332c 3739 2e36 382c  .83,79.63,79.68,
-00007a50: 3739 2e38 322c 3830 2e38 312c 3739 2e39  79.82,80.81,79.9
-00007a60: 372c 3739 2e36 382c 3830 2e33 322c 3739  7,79.68,80.32,79
-00007a70: 2e36 392c 3739 2e31 382c 0a20 2020 2020  .69,79.18,.     
-00007a80: 2020 2020 2020 2038 302e 3034 2c37 392e         80.04,79.
-00007a90: 3830 2c37 392e 3938 2c38 302e 3135 2c37  80,79.98,80.15,7
-00007aa0: 392e 3737 2c38 302e 3330 2c38 302e 3138  9.77,80.30,80.18
-00007ab0: 2c38 302e 3235 2c37 392e 3838 2c38 302e  ,80.25,79.88,80.
-00007ac0: 3032 205d 0a0a 2020 2020 6e5f 6269 6e73  02 ]..    n_bins
-00007ad0: 3a20 3135 0a20 2020 2062 696e 5f72 616e  : 15.    bin_ran
-00007ae0: 6765 3a20 5b37 392e 2c20 3831 2e5d 0a20  ge: [79., 81.]. 
-00007af0: 2020 2023 2061 6c74 6572 6e61 7469 7665     # alternative
-00007b00: 6c79 2061 6e20 6172 7261 7920 666f 7220  ly an array for 
-00007b10: 7468 6520 6269 6e20 6564 6765 7320 6361  the bin edges ca
-00007b20: 6e20 6265 2073 7065 6369 6669 6564 0a20  n be specified. 
-00007b30: 2020 2023 6269 6e5f 6564 6765 733a 205b     #bin_edges: [
-00007b40: 3739 2e2c 2037 392e 352c 2038 302c 2038  79., 79.5, 80, 8
-00007b50: 302e 352c 2038 312e 5d0a 0a20 2020 206d  0.5, 81.]..    m
-00007b60: 6f64 656c 5f64 656e 7369 7479 5f66 756e  odel_density_fun
-00007b70: 6374 696f 6e3a 207c 0a20 2020 2020 2064  ction: |.      d
-00007b80: 6566 206e 6f72 6d61 6c5f 6469 7374 7269  ef normal_distri
-00007b90: 6275 7469 6f6e 2878 2c20 6d75 3d38 302e  bution(x, mu=80.
-00007ba0: 2c20 7369 676d 613d 312e 293a 0a20 2020  , sigma=1.):.   
-00007bb0: 2020 2020 2072 6574 7572 6e20 6e70 2e65       return np.e
-00007bc0: 7870 282d 302e 352a 2828 7820 2d20 6d75  xp(-0.5*((x - mu
-00007bd0: 292f 7369 676d 6129 2a2a 2032 292f 6e70  )/sigma)** 2)/np
-00007be0: 2e73 7172 7428 322e 2a6e 702e 7069 2a73  .sqrt(2.*np.pi*s
-00007bf0: 6967 6d61 2a2a 2032 290a 0a20 202e 2e20  igma** 2)..  .. 
-00007c00: 6d6f 6475 6c65 6175 7468 6f72 3a3a 2047  moduleauthor:: G
-00007c10: 7565 6e74 6572 2051 7561 7374 203c 672e  uenter Quast <g.
-00007c20: 7175 6173 7440 6b69 742e 6564 753e 0a20  quast@kit.edu>. 
-00007c30: 2022 2222 0a0a 2020 6672 6f6d 2050 6879   """..  from Phy
-00007c40: 5072 614b 6974 2069 6d70 6f72 7420 6368  PraKit import ch
-00007c50: 6563 6b5f 6675 6e63 7469 6f6e 5f63 6f64  eck_function_cod
-00007c60: 650a 2020 2323 2066 726f 6d20 2e70 6879  e.  ## from .phy
-00007c70: 4669 7420 696d 706f 7274 2068 4669 7420  Fit import hFit 
-00007c80: 2321 2061 6c72 6561 6479 2063 6f6e 7461  #! already conta
-00007c90: 696e 6564 2069 6e20 7468 6973 2066 696c  ined in this fil
-00007ca0: 650a 0a20 2023 2045 7874 7261 6374 2069  e..  # Extract i
-00007cb0: 6e66 6f72 6d61 7469 6f6e 2066 726f 6d20  nformation from 
-00007cc0: 696e 7075 7420 6469 6374 696f 6e61 7279  input dictionary
-00007cd0: 2020 200a 2020 6966 2027 6c61 6265 6c27     .  if 'label'
-00007ce0: 2069 6e20 6664 3a0a 2020 2020 6461 7461   in fd:.    data
-00007cf0: 5f6c 6162 656c 203d 2066 645b 276c 6162  _label = fd['lab
-00007d00: 656c 275d 0a20 2065 6c73 653a 0a20 2020  el'].  else:.   
-00007d10: 2064 6174 615f 6c61 6265 6c20 3d20 2764   data_label = 'd
-00007d20: 6174 6127 0a0a 2320 2d20 6461 7461 0a20  ata'..# - data. 
-00007d30: 2068 6461 7461 203d 206c 6973 7428 6d61   hdata = list(ma
-00007d40: 7028 666c 6f61 742c 2066 645b 2772 6177  p(float, fd['raw
-00007d50: 5f64 6174 6127 5d29 290a 2020 6269 6e73  _data'])).  bins
-00007d60: 203d 2031 300a 2020 6966 2027 6e5f 6269   = 10.  if 'n_bi
-00007d70: 6e73 2720 696e 2066 643a 0a20 2020 2062  ns' in fd:.    b
-00007d80: 696e 7320 3d20 6664 5b27 6e5f 6269 6e73  ins = fd['n_bins
-00007d90: 275d 0a20 2069 6620 2762 696e 5f65 6467  '].  if 'bin_edg
-00007da0: 6573 2720 696e 2066 643a 0a20 2020 2062  es' in fd:.    b
-00007db0: 696e 7320 3d20 6664 5b27 6269 6e5f 6564  ins = fd['bin_ed
-00007dc0: 6765 7327 5d0a 2020 6269 6e5f 7261 6e67  ges'].  bin_rang
-00007dd0: 6520 3d20 4e6f 6e65 0a20 2069 6620 2762  e = None.  if 'b
-00007de0: 696e 5f72 616e 6765 2720 696e 2066 643a  in_range' in fd:
-00007df0: 0a20 2020 2062 696e 5f72 616e 6765 203d  .    bin_range =
-00007e00: 2066 645b 2762 696e 5f72 616e 6765 275d   fd['bin_range']
-00007e10: 0a0a 2020 6966 2027 785f 6c61 6265 6c27  ..  if 'x_label'
-00007e20: 2069 6e20 6664 3a0a 2020 2020 785f 6c61   in fd:.    x_la
-00007e30: 6265 6c20 3d20 6664 5b27 785f 6c61 6265  bel = fd['x_labe
-00007e40: 6c27 5d0a 2020 656c 7365 3a0a 2020 2020  l'].  else:.    
-00007e50: 785f 6c61 6265 6c20 3d20 2778 270a 2020  x_label = 'x'.  
-00007e60: 6966 2027 795f 6c61 6265 6c27 2069 6e20  if 'y_label' in 
-00007e70: 6664 3a0a 2020 2020 795f 6c61 6265 6c20  fd:.    y_label 
-00007e80: 3d20 6664 5b27 795f 6c61 6265 6c27 5d0a  = fd['y_label'].
-00007e90: 2020 656c 7365 3a0a 2020 2020 795f 6c61    else:.    y_la
-00007ea0: 6265 6c20 3d20 2779 270a 0a23 2066 6978  bel = 'y'..# fix
-00007eb0: 2070 6172 616d 6572 7465 7273 0a20 2066   paramerters.  f
-00007ec0: 6978 6564 5061 7273 203d 204e 6f6e 650a  ixedPars = None.
-00007ed0: 2020 6966 2027 6669 785f 7061 7261 6d65    if 'fix_parame
-00007ee0: 7465 7273 2720 696e 2066 643a 0a20 2020  ters' in fd:.   
-00007ef0: 2066 6978 6564 5061 7273 203d 205b 5d0a   fixedPars = [].
-00007f00: 2020 2020 666f 7220 706e 616d 2069 6e20      for pnam in 
-00007f10: 6664 5b27 6669 785f 7061 7261 6d65 7465  fd['fix_paramete
-00007f20: 7273 275d 3a0a 2020 2020 2020 6669 7865  rs']:.      fixe
-00007f30: 6450 6172 732e 6170 7065 6e64 2870 6e61  dPars.append(pna
-00007f40: 6d29 0a20 200a 2320 636f 6e73 7472 6169  m).  .# constrai
-00007f50: 6e74 730a 2020 636f 6e73 7472 6169 6e74  nts.  constraint
-00007f60: 7320 3d20 4e6f 6e65 0a20 2069 6620 2770  s = None.  if 'p
-00007f70: 6172 616d 6574 6572 5f63 6f6e 7374 7261  arameter_constra
-00007f80: 696e 7473 2720 696e 2066 643a 0a20 2020  ints' in fd:.   
-00007f90: 2063 6f6e 7374 7261 696e 7473 203d 2020   constraints =  
-00007fa0: 5b5d 0a20 2020 2066 6f72 2070 6e61 6d20  [].    for pnam 
-00007fb0: 696e 2066 645b 2770 6172 616d 6574 6572  in fd['parameter
-00007fc0: 5f63 6f6e 7374 7261 696e 7473 275d 3a0a  _constraints']:.
-00007fd0: 2020 2020 2020 7675 5f64 6963 7420 3d20        vu_dict = 
-00007fe0: 6664 5b27 7061 7261 6d65 7465 725f 636f  fd['parameter_co
-00007ff0: 6e73 7472 6169 6e74 7327 5d5b 706e 616d  nstraints'][pnam
-00008000: 5d0a 2020 2020 2020 7620 3d20 7675 5f64  ].      v = vu_d
-00008010: 6963 745b 2776 616c 7565 275d 0a20 2020  ict['value'].   
-00008020: 2020 2075 203d 2076 755f 6469 6374 5b27     u = vu_dict['
-00008030: 756e 6365 7274 6169 6e74 7927 5d0a 2020  uncertainty'].  
-00008040: 2020 2020 636f 6e73 7472 6169 6e74 732e      constraints.
-00008050: 6170 7065 6e64 285b 706e 616d 2c20 762c  append([pnam, v,
-00008060: 2075 205d 290a 2020 2020 2020 2020 0a23   u ]).        .#
-00008070: 202d 206d 6f64 656c 206e 616d 6520 616e   - model name an
-00008080: 6420 7079 7468 6f6e 2063 6f64 650a 2020  d python code.  
-00008090: 6966 2027 6d6f 6465 6c5f 6c61 6265 6c27  if 'model_label'
-000080a0: 2069 6e20 6664 3a0a 2020 2020 6d6f 6465   in fd:.    mode
-000080b0: 6c5f 6c61 6265 6c20 3d20 6664 5b27 6d6f  l_label = fd['mo
-000080c0: 6465 6c5f 6c61 6265 6c27 5d0a 2020 656c  del_label'].  el
-000080d0: 7365 3a0a 2020 2020 6d6f 6465 6c5f 6c61  se:.    model_la
-000080e0: 6265 6c20 3d20 276d 6f64 656c 270a 2020  bel = 'model'.  
-000080f0: 7472 793a 0a20 2020 2063 6f64 655f 7374  try:.    code_st
-00008100: 7220 3d20 6664 5b27 6d6f 6465 6c5f 6465  r = fd['model_de
-00008110: 6e73 6974 795f 6675 6e63 7469 6f6e 275d  nsity_function']
-00008120: 5b27 7079 7468 6f6e 5f63 6f64 6527 5d0a  ['python_code'].
-00008130: 2020 6578 6365 7074 3a0a 2020 2020 7472    except:.    tr
-00008140: 793a 0a20 2020 2020 2063 6f64 655f 7374  y:.      code_st
-00008150: 7220 3d20 6664 5b27 6d6f 6465 6c5f 6465  r = fd['model_de
-00008160: 6e73 6974 795f 6675 6e63 7469 6f6e 275d  nsity_function']
-00008170: 0a20 2020 2065 7863 6570 743a 0a20 2020  .    except:.   
-00008180: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00008190: 636f 6465 5f73 7472 203d 2066 645b 276d  code_str = fd['m
-000081a0: 6f64 656c 5f66 756e 6374 696f 6e27 5d0a  odel_function'].
-000081b0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-000081c0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000081d0: 6545 7272 6f72 2822 2121 2120 6e6f 2063  eError("!!! no c
-000081e0: 6f64 6520 746f 2066 6974 2066 6f75 6e64  ode to fit found
-000081f0: 2021 2229 200a 2020 6669 7466 5f6e 616d   !") .  fitf_nam
-00008200: 652c 2063 6f64 6520 3d20 6368 6563 6b5f  e, code = check_
-00008210: 6675 6e63 7469 6f6e 5f63 6f64 6528 636f  function_code(co
-00008220: 6465 5f73 7472 2920 2020 200a 0a20 2062  de_str)    ..  b
-00008230: 696e 5f63 6f6e 7465 6e74 732c 2062 696e  in_contents, bin
-00008240: 5f65 6467 6573 203d 206e 702e 6869 7374  _edges = np.hist
-00008250: 6f67 7261 6d28 6864 6174 612c 2062 696e  ogram(hdata, bin
-00008260: 733d 6269 6e73 2c20 2072 616e 6765 3d62  s=bins,  range=b
-00008270: 696e 5f72 616e 6765 290a 2020 0a20 2023  in_range).  .  #
-00008280: 2065 7865 6375 7465 2064 6566 696e 6974   execute definit
-00008290: 696f 6e20 6f66 206d 6f64 656c 2066 756e  ion of model fun
-000082a0: 6374 696f 6e0a 2020 7363 6f70 6520 3d20  ction.  scope = 
-000082b0: 6469 6374 2829 0a20 2068 6561 6465 723d  dict().  header=
-000082c0: 2027 696d 706f 7274 206e 756d 7079 2061   'import numpy a
-000082d0: 7320 6e70 5c6e 2720 2b20 2769 6d70 6f72  s np\n' + 'impor
-000082e0: 7420 7363 6970 795c 6e27 200a 2020 6578  t scipy\n' .  ex
-000082f0: 6563 2868 6561 6465 7220 2b20 636f 6465  ec(header + code
-00008300: 2c20 7363 6f70 6529 0a0a 2020 2320 7065  , scope)..  # pe
-00008310: 7266 6f72 6d20 6669 7420 746f 2064 6174  rform fit to dat
-00008320: 6120 7769 7468 2066 756e 6374 696f 6e20  a with function 
-00008330: 6846 6974 200a 2020 7264 6963 7420 3d20  hFit .  rdict = 
-00008340: 6846 6974 2873 636f 7065 5b66 6974 665f  hFit(scope[fitf_
-00008350: 6e61 6d65 5d2c 0a20 2020 2020 2020 2020  name],.         
-00008360: 6269 6e5f 636f 6e74 656e 7473 2c20 6269  bin_contents, bi
-00008370: 6e5f 6564 6765 732c 0a20 2020 2020 2020  n_edges,.       
-00008380: 2020 6669 7850 6172 7320 3d20 6669 7865    fixPars = fixe
-00008390: 6450 6172 732c 0a20 2020 2020 2020 2020  dPars,.         
-000083a0: 636f 6e73 7472 6169 6e74 7320 3d20 636f  constraints = co
-000083b0: 6e73 7472 6169 6e74 732c 2020 2020 2020  nstraints,      
-000083c0: 0a20 2020 2020 2020 2020 706c 6f74 203d  .         plot =
-000083d0: 2070 6c6f 742c 0a20 2020 2020 2020 2020   plot,.         
-000083e0: 706c 6f74 5f63 6f72 203d 2070 6c6f 745f  plot_cor = plot_
-000083f0: 636f 722c 0a20 2020 2020 2020 2020 706c  cor,.         pl
-00008400: 6f74 5f62 616e 643d 706c 6f74 5f62 616e  ot_band=plot_ban
-00008410: 642c 0a20 2020 2020 2020 2020 7361 6d65  d,.         same
-00008420: 5f70 6c6f 7420 3d20 7361 6d65 5f70 6c6f  _plot = same_plo
-00008430: 742c 0a20 2020 2020 2020 2020 7175 6965  t,.         quie
-00008440: 7420 3d20 7175 6965 742c 0a20 2020 2020  t = quiet,.     
-00008450: 2020 2020 7368 6f77 706c 6f74 7320 3d20      showplots = 
-00008460: 7368 6f77 706c 6f74 732c 0a20 2020 2020  showplots,.     
-00008470: 2020 2020 6178 6973 5f6c 6162 656c 733d      axis_labels=
-00008480: 5b78 5f6c 6162 656c 2c20 795f 6c61 6265  [x_label, y_labe
-00008490: 6c5d 2c0a 2020 2020 2020 2020 2064 6174  l],.         dat
-000084a0: 615f 6c65 6765 6e64 203d 2064 6174 615f  a_legend = data_
-000084b0: 6c61 6265 6c2c 2020 2020 0a20 2020 2020  label,    .     
-000084c0: 2020 2020 6d6f 6465 6c5f 6c65 6765 6e64      model_legend
-000084d0: 203d 206d 6f64 656c 5f6c 6162 656c 2c0a   = model_label,.
-000084e0: 2020 2020 2020 2020 2072 6574 7572 6e5f           return_
-000084f0: 6669 744f 626a 6563 743d 7265 7475 726e  fitObject=return
-00008500: 5f66 6974 4f62 6a65 6374 0a20 2020 2020  _fitObject.     
-00008510: 2020 2020 2920 0a20 2072 6574 7572 6e20      ) .  return 
-00008520: 7264 6963 740a 0a20 200a 6465 6620 6d46  rdict..  .def mF
-00008530: 6974 2875 6663 6e2c 2064 6174 6120 3d20  it(ufcn, data = 
-00008540: 4e6f 6e65 2c0a 2020 2020 2020 2020 206d  None,.         m
-00008550: 6f64 656c 5f6b 7761 7267 7320 3d20 4e6f  odel_kwargs = No
-00008560: 6e65 2c0a 2020 2020 2020 2020 2070 3020  ne,.         p0 
-00008570: 3d20 4e6f 6e65 2c20 6470 3020 3d20 4e6f  = None, dp0 = No
-00008580: 6e65 2c20 0a20 2020 2020 2020 2020 636f  ne, .         co
-00008590: 6e73 7472 6169 6e74 7320 3d20 4e6f 6e65  nstraints = None
-000085a0: 2c20 6c69 6d69 7473 3d4e 6f6e 652c 2066  , limits=None, f
-000085b0: 6978 5061 7273 3d4e 6f6e 652c 0a20 2020  ixPars=None,.   
-000085c0: 2020 2020 2020 6e65 6732 6c6f 674c 203d        neg2logL =
-000085d0: 2054 7275 652c 0a20 2020 2020 2020 2020   True,.         
-000085e0: 706c 6f74 203d 2046 616c 7365 2c20 706c  plot = False, pl
-000085f0: 6f74 5f62 616e 6420 3d20 5472 7565 2c0a  ot_band = True,.
-00008600: 2020 2020 2020 2020 2070 6c6f 745f 636f           plot_co
-00008610: 7220 3d20 4661 6c73 652c 0a20 2020 2020  r = False,.     
-00008620: 2020 2020 7368 6f77 706c 6f74 7320 3d20      showplots = 
-00008630: 5472 7565 2c20 7175 6965 7420 3d20 5472  True, quiet = Tr
-00008640: 7565 2c0a 2020 2020 2020 2020 2073 616d  ue,.         sam
-00008650: 655f 706c 6f74 203d 2046 616c 7365 2c0a  e_plot = False,.
-00008660: 2020 2020 2020 2020 2061 7869 735f 6c61           axis_la
-00008670: 6265 6c73 3d5b 2778 272c 2027 4465 6e73  bels=['x', 'Dens
-00008680: 6974 7920 3d20 6628 782c 202a 7061 7229  ity = f(x, *par)
-00008690: 275d 2c0a 2020 2020 2020 2020 2064 6174  '],.         dat
-000086a0: 615f 6c65 6765 6e64 203d 2027 6461 7461  a_legend = 'data
-000086b0: 272c 2020 2020 0a20 2020 2020 2020 2020  ',    .         
-000086c0: 6d6f 6465 6c5f 6c65 6765 6e64 203d 2027  model_legend = '
-000086d0: 6d6f 6465 6c27 2c0a 2020 2020 2020 2020  model',.        
-000086e0: 2072 6574 7572 6e5f 6669 744f 626a 6563   return_fitObjec
-000086f0: 743d 4661 6c73 6520 2920 3a0a 0a20 2022  t=False ) :..  "
-00008700: 2222 5772 6170 7065 7220 6675 6e63 7469  ""Wrapper functi
-00008710: 6f6e 2074 6f20 6469 7265 6374 6c79 2066  on to directly f
-00008720: 6974 2061 2075 7365 722d 6465 6669 6e65  it a user-define
-00008730: 6420 636f 7374 2066 756e 7469 6f6e 0a0a  d cost funtion..
-00008740: 2020 5468 6973 2069 7320 7468 6520 7369    This is the si
-00008750: 6d70 6c65 7374 2066 6974 2070 6f73 7369  mplest fit possi
-00008760: 626c 6520 7769 7468 2074 6865 2063 6c61  ble with the cla
-00008770: 7373 206d 6e46 6974 2e20 4966 206e 6f20  ss mnFit. If no 
-00008780: 6461 7461 2069 730a 2020 7370 6563 6966  data is.  specif
-00008790: 6965 6420 2864 6174 613d 4e6f 6e65 292c  ied (data=None),
-000087a0: 2061 2075 7365 722d 7375 7070 6c69 6564   a user-supplied
-000087b0: 2063 6f73 7420 6675 6e63 7469 6f6e 2028   cost function (
-000087c0: 7566 636e 2920 6973 206d 696e 696d 697a  ufcn) is minimiz
-000087d0: 6564 200a 2020 616e 6420 616e 2065 7374  ed .  and an est
-000087e0: 696d 6174 696f 6e20 6f66 2074 6865 2070  imation of the p
-000087f0: 6172 616d 6574 6572 2075 6e63 6572 7461  arameter uncerta
-00008800: 696e 7469 6573 2070 6572 666f 726d 6564  inties performed
-00008810: 2c20 6173 7375 6d69 6e67 0a20 2074 6865  , assuming.  the
-00008820: 2063 6f73 7420 6675 6e63 7469 6f6e 2069   cost function i
-00008830: 7320 6120 6e65 6761 7469 7665 206c 6f67  s a negative log
-00008840: 2d6c 696b 656c 6968 6f6f 6420 6675 6e63  -likelihood func
-00008850: 7469 6f6e 2028 6e6c 4c20 6f66 2032 6e4c  tion (nlL of 2nL
-00008860: 4c29 2e0a 2020 0a20 2049 6e20 6361 7365  L)..  .  In case
-00008870: 2064 6174 6120 6973 2070 726f 7669 6465   data is provide
-00008880: 642c 2074 6865 2075 7365 7220 6675 6e63  d, the user func
-00008890: 7469 6f6e 2060 7566 636e 2864 6174 612c  tion `ufcn(data,
-000088a0: 202a 7061 7229 6020 6973 200a 2020 696e   *par)` is .  in
-000088b0: 7465 7270 7265 7465 6420 6173 2061 2070  terpreted as a p
-000088c0: 6172 616d 6574 6572 2d64 6570 656e 6465  arameter-depende
-000088d0: 6e74 2070 726f 6261 6269 6c69 7479 2064  nt probability d
-000088e0: 656e 7369 7479 2066 756e 6374 696f 6e2c  ensity function,
-000088f0: 2061 6e64 0a20 2074 6865 2070 6172 616d   and.  the param
-00008900: 6574 6572 7320 6172 6520 6465 7465 726d  eters are determ
-00008910: 696e 6564 2069 6e20 616e 2075 6e62 696e  ined in an unbin
-00008920: 6e65 6420 6c6f 672d 6c69 6b65 6c69 686f  ned log-likeliho
-00008930: 6f64 2061 7070 726f 6163 682e 200a 0a20  od approach. .. 
-00008940: 2041 7267 733a 0a20 2020 202a 2075 6663   Args:.    * ufc
-00008950: 6e3a 2075 7365 722d 6465 6669 6e65 6420  n: user-defined 
-00008960: 636f 7374 2066 756e 6374 696f 6e20 6f72  cost function or
-00008970: 2070 6466 2074 6f20 6265 206d 696e 696d   pdf to be minim
-00008980: 697a 6564 3b20 0a0a 2020 2020 2020 2d20  ized; ..      - 
-00008990: 7566 636e 285c 2a70 6172 293a 2074 6865  ufcn(\*par): the
-000089a0: 2075 6e63 6572 7461 696e 7479 2065 7374   uncertainty est
-000089b0: 696d 6174 696f 6e20 7265 6c69 6573 206f  imation relies o
-000089c0: 6e20 7468 6973 2062 6569 6e67 2061 200a  n this being a .
-000089d0: 2020 2020 2020 2020 6e65 6761 7469 7665          negative
-000089e0: 206c 6f67 2d6c 696b 656c 6968 6f6f 6420   log-likelihood 
-000089f0: 6675 6e63 7469 6f6e 2028 276e 6c4c 2729  function ('nlL')
-00008a00: 3b20 696e 2074 6869 7320 6361 7365 2c20  ; in this case, 
-00008a10: 6e6f 2064 6174 610a 2020 2020 2020 2020  no data.        
-00008a20: 6973 2074 6f20 6265 2070 726f 7669 6465  is to be provide
-00008a30: 642c 2069 2e65 2e20 6064 6174 613d 4e6f  d, i.e. `data=No
-00008a40: 6e65 602e 200a 0a20 2020 2020 202d 2075  ne`. ..      - u
-00008a50: 6663 6e28 782c 205c 2a70 6172 293a 2061  fcn(x, \*par): a
-00008a60: 2070 726f 6261 6269 6c69 7479 2064 656e   probability den
-00008a70: 7369 7479 206f 6620 7468 6520 6461 7461  sity of the data
-00008a80: 2060 7860 2064 6570 656e 6469 6e67 206f   `x` depending o
-00008a90: 6e0a 2020 2020 2020 2020 7468 6520 7365  n.        the se
-00008aa0: 7420 6f66 2070 6172 616d 6574 6572 7320  t of parameters 
-00008ab0: 6070 6172 602e 200a 0a20 2020 202a 2064  `par`. ..    * d
-00008ac0: 6174 612c 206f 7074 696f 6e61 6c2c 2061  ata, optional, a
-00008ad0: 7272 6179 206f 6620 666c 6f61 7473 3a20  rray of floats: 
-00008ae0: 6f70 7469 6f6e 616c 2069 6e70 7574 2064  optional input d
-00008af0: 6174 610a 2020 2020 2a20 6d6f 6465 6c5f  ata.    * model_
-00008b00: 6b77 6172 6773 3a20 6f70 7469 6f6e 616c  kwargs: optional
-00008b10: 2c20 6669 7420 7061 7261 6d65 7465 7273  , fit parameters
-00008b20: 2069 6620 6e6f 7420 6672 6f6d 206d 6f64   if not from mod
-00008b30: 656c 2073 6967 6e61 7475 7265 200a 2020  el signature .  
-00008b40: 2020 2a20 7030 3a20 6172 7261 792d 6c69    * p0: array-li
-00008b50: 6b65 2c20 696e 6974 6961 6c20 6775 6573  ke, initial gues
-00008b60: 7320 6f66 2070 6172 616d 6574 6572 730a  s of parameters.
-00008b70: 2020 2020 2a20 6470 303a 2061 7272 6179      * dp0: array
-00008b80: 2d6c 696b 652c 2069 6e69 7469 616c 2067  -like, initial g
-00008b90: 7565 7373 206f 6620 7061 7261 6d65 7465  uess of paramete
-00008ba0: 7220 756e 6365 7274 6169 6e74 6965 7320  r uncertainties 
-00008bb0: 286f 7074 696f 6e61 6c29 0a20 2020 202a  (optional).    *
-00008bc0: 2063 6f6e 7374 7261 696e 7473 3a20 286e   constraints: (n
-00008bd0: 6573 7465 6429 206c 6973 7428 7329 205b  ested) list(s) [
-00008be0: 6e61 6d65 206f 7220 6964 2c20 7661 6c75  name or id, valu
-00008bf0: 652c 2065 7272 6f72 5d20 0a20 2020 202a  e, error] .    *
-00008c00: 206c 696d 6974 733a 2028 6e65 7374 6564   limits: (nested
-00008c10: 2920 6c69 7374 2873 2920 5b6e 616d 6520  ) list(s) [name 
-00008c20: 6f72 2069 642c 206d 696e 2c20 6d61 785d  or id, min, max]
-00008c30: 200a 2020 2020 2a20 6e65 6732 6c6f 674c   .    * neg2logL
-00008c40: 3a20 7573 6520 3220 2a20 6e6c 4c20 2863  : use 2 * nlL (c
-00008c50: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
-00008c60: 6120 6c65 6173 742d 7371 7561 7265 732d  a least-squares-
-00008c70: 7479 7065 2063 6f73 7429 0a20 2020 202a  type cost).    *
-00008c80: 2070 6c6f 743a 2073 686f 7720 6461 7461   plot: show data
-00008c90: 2061 6e64 206d 6f64 656c 2069 6620 5472   and model if Tr
-00008ca0: 7565 0a20 2020 202a 2070 6c6f 745f 6261  ue.    * plot_ba
-00008cb0: 6e64 3a20 706c 6f74 2075 6e63 6572 7461  nd: plot uncerta
-00008cc0: 696e 7479 2062 616e 6420 6172 6f75 6e64  inty band around
-00008cd0: 206d 6f64 656c 2066 756e 6374 696f 6e0a   model function.
-00008ce0: 2020 2020 2a20 706c 6f74 5f63 6f72 3a20      * plot_cor: 
-00008cf0: 706c 6f74 206c 696b 656c 6968 6f6f 6420  plot likelihood 
-00008d00: 7072 6f66 696c 6573 2061 6e64 2063 6f6e  profiles and con
-00008d10: 6669 6465 6e63 6520 636f 6e74 6f75 7273  fidence contours
-00008d20: 206f 6620 7061 7261 6d65 7465 7273 0a20   of parameters. 
-00008d30: 2020 202a 2073 686f 7770 6c6f 7473 3a20     * showplots: 
-00008d40: 7368 6f77 2070 6c6f 7473 206f 6e20 7363  show plots on sc
-00008d50: 7265 656e 2028 6361 6e20 616c 736f 2062  reen (can also b
-00008d60: 6520 646f 6e65 2062 7920 6361 6c6c 696e  e done by callin
-00008d70: 6720 7363 7269 7074 290a 2020 2020 2a20  g script).    * 
-00008d80: 7175 6965 743a 2063 6f6e 7472 6f6c 7320  quiet: controls 
-00008d90: 7665 7262 6f73 6520 6f75 7470 7574 0a20  verbose output. 
-00008da0: 2020 202a 2062 6f6f 6c3a 2066 6f72 2065     * bool: for e
-00008db0: 7870 6572 7473 206f 6e6c 792c 2072 6574  xperts only, ret
-00008dc0: 7572 6e20 696e 7374 616e 6365 206f 6620  urn instance of 
-00008dd0: 636c 6173 7320 6d6e 4669 7420 746f 200a  class mnFit to .
-00008de0: 2020 2020 2020 6769 7665 2061 6363 6573        give acces
-00008df0: 7320 746f 2064 6174 6120 6d65 6d62 6572  s to data member
-00008e00: 7320 616e 6420 6d65 7468 6f64 730a 2020  s and methods.  
-00008e10: 2020 2222 220a 0a20 2023 2066 726f 6d20    """..  # from 
-00008e20: 2e70 6879 4669 7420 696d 706f 7274 206d  .phyFit import m
-00008e30: 6e46 6974 2023 2061 6c72 6561 6479 2063  nFit # already c
-00008e40: 6f6e 7461 696e 6564 2069 6e20 7068 7946  ontained in phyF
-00008e50: 6974 2070 6163 6b61 6765 0a0a 2020 6966  it package..  if
-00008e60: 2064 6174 6120 6973 204e 6f6e 653a 0a20   data is None:. 
-00008e70: 2020 2066 6974 5f74 7970 653d 2275 7365     fit_type="use
-00008e80: 7222 0a20 2065 6c73 653a 0a20 2020 2066  r".  else:.    f
-00008e90: 6974 5f74 7970 6520 3d20 226d 6c22 0a20  it_type = "ml". 
-00008ea0: 2075 4669 7420 3d20 6d6e 4669 7428 6669   uFit = mnFit(fi
-00008eb0: 745f 7479 7065 290a 0a20 2023 2073 6574  t_type)..  # set
-00008ec0: 206f 7074 696f 6e73 0a20 2075 4669 742e   options.  uFit.
-00008ed0: 7365 744f 7074 696f 6e73 2872 756e 5f6d  setOptions(run_m
-00008ee0: 696e 6f73 203d 2054 7275 652c 0a20 2020  inos = True,.   
-00008ef0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00008f00: 6732 6c6f 674c 203d 206e 6567 326c 6f67  g2logL = neg2log
-00008f10: 4c2c 0a20 2020 2020 2020 2020 2020 2020  L,.             
-00008f20: 2020 2020 7175 6965 7420 3d20 7175 6965      quiet = quie
-00008f30: 7429 0a0a 2020 2320 696e 6974 6961 6c69  t)..  # initiali
-00008f40: 7a65 2064 6174 6120 636f 6e74 6169 6e65  ze data containe
-00008f50: 7220 6966 2064 6174 6120 6973 2070 726f  r if data is pro
-00008f60: 7669 6465 640a 2020 2320 2021 2121 2069  vided.  #  !!! i
-00008f70: 6620 6e6f 2064 6174 6120 6769 7665 6e2c  f no data given,
-00008f80: 2074 6865 2075 7365 722d 7375 7070 6c69   the user-suppli
-00008f90: 6564 2063 6f73 7420 6675 6e63 7469 6f6e  ed cost function
-00008fa0: 206d 7573 740a 2020 2320 2020 2020 2068   must.  #      h
-00008fb0: 616e 646c 6520 676f 7420 6361 6c75 6c61  andle got calula
-00008fc0: 7469 6f6e 206f 6620 7468 6520 636f 7374  tion of the cost
-00008fd0: 2066 756e 6374 696f 6e20 0a20 2069 6620   function .  if 
-00008fe0: 6461 7461 2069 7320 6e6f 7420 4e6f 6e65  data is not None
-00008ff0: 3a0a 2020 2020 7546 6974 2e69 6e69 745f  :.    uFit.init_
-00009000: 6461 7461 2864 6174 6129 0a0a 2020 2320  data(data)..  # 
-00009010: 696e 6974 6961 6c7a 6520 6669 740a 2020  initialze fit.  
-00009020: 2320 202d 2077 6974 6820 7468 6520 7573  #  - with the us
-00009030: 6572 2d73 7570 706c 6965 6420 636f 7374  er-supplied cost
-00009040: 2066 756e 6374 696f 6e20 636f 7374 282a   function cost(*
-00009050: 7061 7273 2920 6966 206e 6f20 6461 7461  pars) if no data
-00009060: 2067 6976 656e 0a20 2023 2020 2d20 7769   given.  #  - wi
-00009070: 7468 2070 726f 6261 6269 6c69 7479 2064  th probability d
-00009080: 656e 7369 7479 2070 6466 2878 3b20 2a70  ensity pdf(x; *p
-00009090: 6172 7329 2069 6620 6461 7461 2028 3d78  ars) if data (=x
-000090a0: 2920 7072 6f76 6964 6564 200a 2020 7546  ) provided .  uF
-000090b0: 6974 2e69 6e69 745f 6669 7428 7566 636e  it.init_fit(ufcn
-000090c0: 2c20 6d6f 6465 6c5f 6b77 6172 6773 3d6d  , model_kwargs=m
-000090d0: 6f64 656c 5f6b 7761 7267 732c 2070 303d  odel_kwargs, p0=
-000090e0: 7030 2c20 6470 303d 6470 302c 200a 2020  p0, dp0=dp0, .  
-000090f0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00009100: 6e73 7472 6169 6e74 7320 3d20 636f 6e73  nstraints = cons
-00009110: 7472 6169 6e74 732c 0a20 2020 2020 2020  traints,.       
-00009120: 2020 2020 2020 2020 2066 6978 5061 7273           fixPars
-00009130: 203d 2066 6978 5061 7273 2c0a 2020 2020   = fixPars,.    
-00009140: 2020 2020 2020 2020 2020 2020 6c69 6d69              limi
-00009150: 7473 203d 206c 696d 6974 7329 0a20 2023  ts = limits).  #
-00009160: 2070 6572 666f 726d 2074 6865 2066 6974   perform the fit
-00009170: 0a20 2066 6974 5265 7375 6c74 203d 2075  .  fitResult = u
-00009180: 4669 742e 646f 5f66 6974 2829 0a20 2023  Fit.do_fit().  #
-00009190: 2070 7269 6e74 2066 6974 2072 6573 756c   print fit resul
-000091a0: 7420 2864 6963 7469 6f6e 6172 7920 6672  t (dictionary fr
-000091b0: 6f6d 206d 6967 7261 642f 6d69 6e6f 7328  om migrad/minos(
-000091c0: 0a20 2069 6620 6e6f 7420 7175 6965 743a  .  if not quiet:
-000091d0: 0a20 2020 2070 7269 6e74 2822 5c6e 4669  .    print("\nFi
-000091e0: 7420 5265 7375 6c74 2066 726f 6d20 6d69  t Result from mi
-000091f0: 6772 6164 3a22 290a 2020 2020 7072 696e  grad:").    prin
-00009200: 7428 6669 7452 6573 756c 745b 305d 290a  t(fitResult[0]).
-00009210: 2020 2020 6966 2066 6974 5265 7375 6c74      if fitResult
-00009220: 5b31 5d20 6973 206e 6f74 204e 6f6e 653a  [1] is not None:
-00009230: 0a20 2020 2020 2070 7269 6e74 2822 5c6e  .      print("\n
-00009240: 5265 7375 6c74 206f 6620 6d69 6e6f 7320  Result of minos 
-00009250: 6572 726f 7220 616e 616c 7973 6973 3a22  error analysis:"
-00009260: 290a 2020 2020 2020 7072 696e 7428 6669  ).      print(fi
-00009270: 7452 6573 756c 745b 315d 290a 2020 2020  tResult[1]).    
-00009280: 0a20 2023 2070 726f 6475 6365 2066 6967  .  # produce fig
-00009290: 7572 6520 7769 7468 2064 6174 6120 616e  ure with data an
-000092a0: 6420 6d6f 6465 6c0a 2020 6966 2070 6c6f  d model.  if plo
-000092b0: 743a 0a20 2020 2066 6967 203d 2075 4669  t:.    fig = uFi
-000092c0: 742e 706c 6f74 4d6f 6465 6c28 6178 6973  t.plotModel(axis
-000092d0: 5f6c 6162 656c 733d 6178 6973 5f6c 6162  _labels=axis_lab
-000092e0: 656c 732c 0a20 2020 2020 2020 2020 2020  els,.           
-000092f0: 2020 2020 2020 6461 7461 5f6c 6567 656e        data_legen
-00009300: 643d 6461 7461 5f6c 6567 656e 642c 0a20  d=data_legend,. 
-00009310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009320: 6d6f 6465 6c5f 6c65 6765 6e64 3d6d 6f64  model_legend=mod
-00009330: 656c 5f6c 6567 656e 642c 0a20 2020 2020  el_legend,.     
-00009340: 2020 2020 2020 2020 2020 2020 706c 6f74              plot
-00009350: 5f62 616e 643d 706c 6f74 5f62 616e 642c  _band=plot_band,
-00009360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009370: 2020 7361 6d65 5f70 6c6f 743d 7361 6d65    same_plot=same
-00009380: 5f70 6c6f 7429 0a20 2023 2066 6967 7572  _plot).  # figur
-00009390: 6520 7769 7468 2076 6973 7561 6c20 7265  e with visual re
-000093a0: 7072 6573 656e 7461 7469 6f6e 206f 6620  presentation of 
-000093b0: 636f 7661 7269 616e 6365 730a 2020 2320  covariances.  # 
-000093c0: 2020 2070 726f 6669 6c65 206c 696b 656c     profile likel
-000093d0: 6968 6f6f 6420 7363 616e 2061 6e64 2063  ihood scan and c
-000093e0: 6f6e 6669 6465 6e63 6520 636f 6e74 6f75  onfidence contou
-000093f0: 7273 0a20 2069 6620 706c 6f74 5f63 6f72  rs.  if plot_cor
-00009400: 3a0a 2020 2020 6669 675f 636f 7220 3d20  :.    fig_cor = 
-00009410: 7546 6974 2e70 6c6f 7443 6f6e 746f 7572  uFit.plotContour
-00009420: 7328 6669 676e 616d 653d 2275 7365 7246  s(figname="userF
-00009430: 6974 3a20 5072 6f66 696c 6573 2061 6e64  it: Profiles and
-00009440: 2043 6f6e 746f 7572 7322 290a 0a20 2023   Contours")..  #
-00009450: 2073 686f 7720 706c 6f74 7320 6f6e 2073   show plots on s
-00009460: 6372 6565 6e0a 2020 6966 2073 686f 7770  creen.  if showp
-00009470: 6c6f 7473 2061 6e64 2028 706c 6f74 206f  lots and (plot o
-00009480: 7220 706c 6f74 5f63 6f72 293a 0a20 2020  r plot_cor):.   
-00009490: 2070 6c74 2e73 686f 7728 290a 0a20 2069   plt.show()..  i
-000094a0: 6620 7265 7475 726e 5f66 6974 4f62 6a65  f return_fitObje
-000094b0: 6374 3a0a 2020 2020 7265 7475 726e 2075  ct:.    return u
-000094c0: 4669 740a 2020 656c 7365 3a0a 2020 2020  Fit.  else:.    
-000094d0: 2320 7265 7475 726e 0a20 2020 2023 2020  # return.    #  
-000094e0: 206e 756d 7079 2061 7272 6179 7320 7769   numpy arrays wi
-000094f0: 7468 2066 6974 2072 6573 756c 743a 2070  th fit result: p
-00009500: 6172 616d 6574 6572 2076 616c 7565 732c  arameter values,
-00009510: 0a20 2020 2023 2020 206e 6567 6174 6976  .    #   negativ
-00009520: 6520 616e 6420 706f 7369 7469 7665 2070  e and positive p
-00009530: 6172 616d 6574 6572 2075 6e63 6572 7461  arameter uncerta
-00009540: 696e 7469 6573 2c0a 2020 2020 2320 2020  inties,.    #   
-00009550: 636f 7272 656c 6174 696f 6e20 6d61 7472  correlation matr
-00009560: 6978 0a20 2020 2023 2020 2067 6f66 0a20  ix.    #   gof. 
-00009570: 2020 2023 2020 2070 6172 616d 6574 6572     #   parameter
-00009580: 206e 616d 6573 0a20 2020 2072 6574 7572   names.    retur
-00009590: 6e20 7546 6974 2e67 6574 5265 7375 6c74  n uFit.getResult
-000095a0: 2829 0a0a 230a 2320 2d2d 2d20 6865 6c70  ()..#.# --- help
-000095b0: 6572 2066 756e 6374 696f 6e73 0a23 0a64  er functions.#.d
-000095c0: 6566 2067 6574 5f66 756e 6374 696f 6e53  ef get_functionS
-000095d0: 6967 6e61 7475 7265 2866 293a 0a20 2022  ignature(f):.  "
-000095e0: 2222 6765 7420 6172 6775 6d65 6e74 7320  ""get arguments 
-000095f0: 616e 6420 6b65 7977 6f72 6420 6172 6775  and keyword argu
-00009600: 6d65 6e74 7320 7061 7373 6564 2074 6f20  ments passed to 
-00009610: 6120 6675 6e63 7469 6f6e 0a20 2022 2222  a function.  """
-00009620: 0a20 2070 6172 7320 3d20 7369 676e 6174  .  pars = signat
-00009630: 7572 6528 6629 2e70 6172 616d 6574 6572  ure(f).parameter
-00009640: 730a 2020 6172 6773 203d 205b 5d0a 2020  s.  args = [].  
-00009650: 6b77 6172 6773 203d 207b 7d0a 2020 666f  kwargs = {}.  fo
-00009660: 7220 7020 696e 2070 6172 732e 7661 6c75  r p in pars.valu
-00009670: 6573 2829 3a0a 2020 2020 6966 2070 2e64  es():.    if p.d
-00009680: 6566 6175 6c74 2069 7320 702e 656d 7074  efault is p.empt
-00009690: 793a 0a20 2020 2020 2061 7267 732e 6170  y:.      args.ap
-000096a0: 7065 6e64 2870 2e6e 616d 6529 0a20 2020  pend(p.name).   
-000096b0: 2065 6c73 653a 0a20 2020 2020 206b 7761   else:.      kwa
-000096c0: 7267 735b 702e 6e61 6d65 5d3d 702e 6465  rgs[p.name]=p.de
-000096d0: 6661 756c 740a 2020 7265 7475 726e 2061  fault.  return a
-000096e0: 7267 732c 206b 7761 7267 730a 0a64 6566  rgs, kwargs..def
-000096f0: 2072 6f75 6e64 5f74 6f5f 6572 726f 7228   round_to_error(
-00009700: 7661 6c2c 2065 7272 2c20 6e73 645f 653d  val, err, nsd_e=
-00009710: 3229 3a0a 2020 2222 2272 6f75 6e64 2066  2):.  """round f
-00009720: 6c6f 6174 202a 7661 6c2a 2074 6f20 7361  loat *val* to sa
-00009730: 6d65 206e 756d 6265 7220 6f66 2073 6967  me number of sig
-00009740: 6e69 6669 6361 6e74 2064 6967 6974 7320  nificant digits 
-00009750: 6173 2075 6e63 6572 7461 696e 7479 202a  as uncertainty *
-00009760: 6572 722a 0a20 200a 2020 5265 7475 726e  err*.  .  Return
-00009770: 733a 0a20 2020 202a 2069 6e74 3a20 2020  s:.    * int:   
-00009780: 6e75 6d62 6572 206f 6620 7369 676e 6966  number of signif
-00009790: 6963 616e 7420 6469 6769 7473 2066 6f72  icant digits for
-000097a0: 2076 0a20 2020 202a 2066 6c6f 6174 3a20   v.    * float: 
-000097b0: 7661 6c20 726f 756e 6465 6420 746f 2070  val rounded to p
-000097c0: 7265 6369 7369 6f6e 206f 6620 6572 720a  recision of err.
-000097d0: 2020 2020 2a20 666c 6f61 743a 2065 7272      * float: err
-000097e0: 2072 6f75 6e64 6564 2074 6f20 7072 6563   rounded to prec
-000097f0: 6973 696f 6e20 6e73 645f 650a 2020 2222  ision nsd_e.  ""
-00009800: 220a 2020 7620 3d20 6162 7328 7661 6c29  ".  v = abs(val)
-00009810: 0a20 2023 2072 6f75 6e64 2075 6e63 6572  .  # round uncer
-00009820: 7461 696e 7479 2074 6f20 6e64 3020 7369  tainty to nd0 si
-00009830: 676e 6966 6963 616e 7420 6469 6769 7473  gnificant digits
-00009840: 0a20 2065 203d 2066 6c6f 6174 2822 7b3a  .  e = float("{:
-00009850: 2e7b 707d 677d 222e 666f 726d 6174 2861  .{p}g}".format(a
-00009860: 6273 2865 7272 292c 2070 3d6e 7364 5f65  bs(err), p=nsd_e
-00009870: 2929 0a20 205f 7620 3d20 7620 6966 2076  )).  _v = v if v
-00009880: 3e65 2065 6c73 6520 650a 2020 6c31 3065  >e else e.  l10e
-00009890: 3d6e 702e 666c 6f6f 7228 6e70 2e6c 6f67  =np.floor(np.log
-000098a0: 3130 2865 2929 0a20 2023 2064 6574 6572  10(e)).  # deter
-000098b0: 6d69 6e65 2023 206f 6620 7369 676e 6966  mine # of signif
-000098c0: 6963 616e 7420 6469 6769 7473 2066 6f72  icant digits for
-000098d0: 2076 0a20 205f 6e64 203d 2069 6e74 2820   v.  _nd = int( 
-000098e0: 6e70 2e66 6c6f 6f72 286e 702e 6c6f 6731  np.floor(np.log1
-000098f0: 3028 5f76 2920 2d20 6c31 3065 2029 2029  0(_v) - l10e ) )
-00009900: 202b 206e 7364 5f65 0a20 2023 2074 616b   + nsd_e.  # tak
-00009910: 6520 696e 746f 2061 6363 6f75 6e74 2070  e into account p
-00009920: 6f73 7369 626c 6520 726f 756e 6469 6e67  ossible rounding
-00009930: 206f 6620 7620 2e2e 2e0a 2020 7620 3d20   of v ....  v = 
-00009940: 666c 6f61 7428 227b 3a2e 7b70 7d67 7d22  float("{:.{p}g}"
-00009950: 2e66 6f72 6d61 7428 762c 2070 3d5f 6e64  .format(v, p=_nd
-00009960: 2929 0a20 2023 202e 2e2e 2061 6e64 2064  )).  # ... and d
-00009970: 6574 6572 6d69 6e65 2066 696e 616c 2023  etermine final #
-00009980: 206f 6620 7369 672e 2064 6967 6974 730a   of sig. digits.
-00009990: 2020 5f76 203d 2076 2069 6620 763e 6520    _v = v if v>e 
-000099a0: 656c 7365 2065 0a20 206e 7364 5f76 203d  else e.  nsd_v =
-000099b0: 2069 6e74 2820 6e70 2e66 6c6f 6f72 286e   int( np.floor(n
-000099c0: 702e 6c6f 6731 3028 5f76 2920 2d20 6c31  p.log10(_v) - l1
-000099d0: 3065 2029 2029 202b 206e 7364 5f65 0a20  0e ) ) + nsd_e. 
-000099e0: 2076 203d 2066 6c6f 6174 2822 7b3a 2e7b   v = float("{:.{
-000099f0: 707d 677d 222e 666f 726d 6174 2876 2c20  p}g}".format(v, 
-00009a00: 703d 6e73 645f 7629 2920 6966 2076 3e3d  p=nsd_v)) if v>=
-00009a10: 3130 2a2a 286c 3130 652d 3129 2065 6c73  10**(l10e-1) els
-00009a20: 6520 300a 2020 7265 7475 726e 206e 7364  e 0.  return nsd
-00009a30: 5f76 2c20 6e70 2e73 6967 6e28 7661 6c29  _v, np.sign(val)
-00009a40: 2a76 2c20 6520 2020 2020 2020 2020 2020  *v, e           
-00009a50: 2020 2020 0a0a 0a64 6566 205f 6275 696c      ...def _buil
-00009a60: 645f 4572 7232 2865 3d4e 6f6e 652c 2065  d_Err2(e=None, e
-00009a70: 7265 6c3d 4e6f 6e65 2c20 6461 7461 3d4e  rel=None, data=N
-00009a80: 6f6e 6529 3a0a 2020 2222 220a 2020 4275  one):.  """.  Bu
-00009a90: 696c 6420 7371 7561 7265 6420 7375 6d20  ild squared sum 
-00009aa0: 6f66 2069 6e64 6570 656e 6465 6e74 2061  of independent a
-00009ab0: 6273 6f6c 7574 6520 616e 642f 6f72 200a  bsolute and/or .
-00009ac0: 2020 7265 6c61 7469 7665 2065 7272 6f72    relative error
-00009ad0: 2063 6f6d 706f 6e65 6e74 730a 0a20 2041   components..  A
-00009ae0: 7267 733a 0a20 2020 202a 2065 3a20 7363  rgs:.    * e: sc
-00009af0: 616c 6172 206f 7220 3164 206e 702d 6172  alar or 1d np-ar
-00009b00: 7261 7920 6f66 2066 6c6f 6174 3a20 696e  ray of float: in
-00009b10: 6465 7065 6e64 656e 7420 756e 6365 7274  dependent uncert
-00009b20: 6169 6e74 6965 7320 0a20 2020 202a 2065  ainties .    * e
-00009b30: 7265 6c3a 2073 6361 6c61 7220 6f72 2031  rel: scalar or 1
-00009b40: 6420 6e70 2d61 7272 6179 206f 6620 666c  d np-array of fl
-00009b50: 6f61 743a 2069 6e64 6570 656e 6465 6e74  oat: independent
-00009b60: 2072 656c 6174 6976 6520 0a20 2020 2020   relative .     
-00009b70: 2075 6e63 6572 7461 696e 7469 6573 0a20   uncertainties. 
-00009b80: 2022 2222 0a20 2020 2020 200a 2020 6572   """.      .  er
-00009b90: 7232 203d 2030 2e0a 2020 6966 2065 2069  r2 = 0..  if e i
-00009ba0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00009bb0: 6572 7232 203d 2065 202a 2065 0a20 2069  err2 = e * e.  i
-00009bc0: 6620 6572 656c 2069 7320 6e6f 7420 4e6f  f erel is not No
-00009bd0: 6e65 3a0a 2020 2020 5f65 7220 3d20 6572  ne:.    _er = er
-00009be0: 656c 202a 2064 6174 610a 2020 2020 6572  el * data.    er
-00009bf0: 7232 202b 3d20 5f65 7220 2a20 5f65 720a  r2 += _er * _er.
-00009c00: 2020 7265 7475 726e 2065 7272 320a 2020    return err2.  
-00009c10: 2020 2020 0a64 6566 205f 6275 696c 645f      .def _build_
-00009c20: 436f 764d 6174 286e 642c 2065 3d4e 6f6e  CovMat(nd, e=Non
-00009c30: 652c 2065 7265 6c3d 4e6f 6e65 2c0a 2020  e, erel=None,.  
-00009c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c50: 2020 2020 6561 6273 636f 723d 4e6f 6e65      eabscor=None
-00009c60: 2c20 6572 656c 636f 723d 4e6f 6e65 2c20  , erelcor=None, 
-00009c70: 6461 7461 3d4e 6f6e 6529 3a0a 2020 2222  data=None):.  ""
-00009c80: 220a 2020 4275 696c 6420 6120 636f 7661  ".  Build a cova
-00009c90: 7269 616e 6365 206d 6174 7269 7820 6672  riance matrix fr
-00009ca0: 6f6d 2069 6e64 6570 656e 6465 6e74 2061  om independent a
-00009cb0: 6e64 2063 6f72 7265 6c61 7465 6420 0a20  nd correlated . 
-00009cc0: 2061 6273 6f6c 7574 6520 616e 642f 6f72   absolute and/or
-00009cd0: 2072 656c 6174 6976 6520 6572 726f 7220   relative error 
-00009ce0: 636f 6d70 6f6e 656e 7473 0a0a 2020 436f  components..  Co
-00009cf0: 7272 656c 6174 6564 2061 6273 6f6c 7574  rrelated absolut
-00009d00: 6520 616e 642f 6f72 2072 656c 6174 6976  e and/or relativ
-00009d10: 6520 756e 6365 7274 6169 6e74 6965 7320  e uncertainties 
-00009d20: 6f66 2069 6e70 7574 2064 6174 6120 0a20  of input data . 
-00009d30: 2061 7265 2074 6f20 6265 2073 7065 6369   are to be speci
-00009d40: 6669 6564 2061 7320 6e75 6d70 792d 6172  fied as numpy-ar
-00009d50: 7261 7973 206f 6620 666c 6f61 7473 3b20  rays of floats; 
-00009d60: 7468 6579 2065 6e74 6572 2069 6e20 7468  they enter in th
-00009d70: 6520 0a20 2064 6961 676f 6e61 6c20 616e  e .  diagonal an
-00009d80: 6420 6f66 662d 6469 6167 6f6e 616c 2065  d off-diagonal e
-00009d90: 6c65 6d65 6e74 7320 6f66 2074 6865 2063  lements of the c
-00009da0: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
-00009db0: 2e20 0a20 2056 616c 7565 7320 6f66 2030  . .  Values of 0
-00009dc0: 2e20 6d61 7920 6265 2073 7065 6369 6669  . may be specifi
-00009dd0: 6564 2066 6f72 2064 6174 6120 706f 696e  ed for data poin
-00009de0: 7473 206e 6f74 2061 6666 6563 7465 640a  ts not affected.
-00009df0: 2020 6279 2061 2063 6f72 7265 6c61 7465    by a correlate
-00009e00: 6420 756e 6365 7274 6169 6e74 792e 2045  d uncertainty. E
-00009e10: 2e67 2e20 7468 6520 6172 7261 7920 5b30  .g. the array [0
-00009e20: 2e2c 2030 2e2c 2030 2e35 2e2c 2030 2e35  ., 0., 0.5., 0.5
-00009e30: 5d0a 2020 7265 7375 6c74 7320 696e 2061  ].  results in a
-00009e40: 2063 6f72 7265 6c61 7465 6420 756e 6365   correlated unce
-00009e50: 7274 6169 6e74 7920 6f66 2030 2e35 206f  rtainty of 0.5 o
-00009e60: 6620 7468 6520 3372 6420 616e 6420 3474  f the 3rd and 4t
-00009e70: 6820 0a20 2064 6174 6120 706f 696e 7473  h .  data points
-00009e80: 2e0a 0a20 2043 6f76 6172 6961 6e63 6520  ...  Covariance 
-00009e90: 6d61 7472 6978 2065 6c65 6d65 6e74 7320  matrix elements 
-00009ea0: 6f66 2074 6865 2069 6e64 6976 6964 7561  of the individua
-00009eb0: 6c20 636f 6d70 6f6e 656e 7473 2061 7265  l components are
-00009ec0: 2061 6464 6564 200a 2020 746f 2066 6f72   added .  to for
-00009ed0: 6d20 7468 6520 636f 6d70 6c65 7465 2043  m the complete C
-00009ee0: 6f76 6172 6961 6e63 6520 4d61 7472 6978  ovariance Matrix
-00009ef0: 2e0a 2020 2020 2020 0a20 2041 7267 733a  ..      .  Args:
-00009f00: 0a20 2020 202a 206e 643a 206e 756d 6265  .    * nd: numbe
-00009f10: 7220 6f66 2064 6174 6120 706f 696e 7473  r of data points
-00009f20: 0a20 2020 202a 2065 3a20 3164 206f 7220  .    * e: 1d or 
-00009f30: 3264 206e 702d 6172 7261 7920 6f66 2066  2d np-array of f
-00009f40: 6c6f 6174 3a20 0a20 2020 2020 2069 6e64  loat: .      ind
-00009f50: 6570 656e 6465 6e74 2075 6e63 6572 7461  ependent uncerta
-00009f60: 696e 7469 6573 206f 7220 6120 6675 6c6c  inties or a full
-00009f70: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
-00009f80: 6978 0a20 2020 202a 2065 7265 6c3a 2031  ix.    * erel: 1
-00009f90: 6420 6f72 2032 6420 6e70 2d61 7272 6179  d or 2d np-array
-00009fa0: 206f 6620 666c 6f61 743a 0a20 2020 2020   of float:.     
-00009fb0: 2069 6e64 6570 656e 6465 6e74 2072 656c   independent rel
-00009fc0: 6174 6976 6520 756e 6365 7274 6169 6e74  ative uncertaint
-00009fd0: 6965 7320 6f72 2061 2066 756c 6c20 636f  ies or a full co
-00009fe0: 7661 7269 616e 6365 206d 6174 7269 780a  variance matrix.
-00009ff0: 0a20 2063 6f72 7265 6c61 7465 6420 636f  .  correlated co
-0000a000: 6d70 6f6e 656e 7473 206f 6620 756e 6365  mponents of unce
-0000a010: 7274 6169 6e74 6965 730a 2020 2020 2a20  rtainties.    * 
-0000a020: 6561 6273 636f 723a 2031 6420 6e70 2d61  eabscor: 1d np-a
-0000a030: 7272 6179 206f 6620 666c 6f61 7473 206f  rray of floats o
-0000a040: 7220 6c69 7374 206f 6620 6e70 2d61 7272  r list of np-arr
-0000a050: 6179 733a 0a20 2020 2061 6273 6f6c 7574  ays:.    absolut
-0000a060: 6520 636f 7272 656c 6174 6564 2075 6e63  e correlated unc
-0000a070: 6572 7461 696e 7469 6573 0a20 2020 202a  ertainties.    *
-0000a080: 2065 7265 6c63 6f72 3a20 3164 206e 702d   erelcor: 1d np-
-0000a090: 6172 7261 7920 6f66 2066 6c6f 6174 7320  array of floats 
-0000a0a0: 6f72 206c 6973 7420 6f66 206e 702d 6172  or list of np-ar
-0000a0b0: 7261 7973 3a0a 2020 2020 7265 6c61 7469  rays:.    relati
-0000a0c0: 7665 2063 6f72 7265 6c61 7465 6420 756e  ve correlated un
-0000a0d0: 6365 7274 6169 6e74 6965 730a 2020 2020  certainties.    
-0000a0e0: 2a20 6461 7461 3a20 6e70 2d61 7272 6179  * data: np-array
-0000a0f0: 206f 6620 666c 6f61 743a 2064 6174 612c   of float: data,
-0000a100: 206e 6565 6465 6420 286f 6e6c 7929 2066   needed (only) f
-0000a110: 6f72 2072 656c 6174 6976 6520 756e 6365  or relative unce
-0000a120: 7274 6169 6e74 6965 730a 0a20 2052 6574  rtainties..  Ret
-0000a130: 7572 6e73 3a0a 2020 2020 2a20 6e70 2d61  urns:.    * np-a
-0000a140: 7272 6179 206f 6620 666c 6f61 743a 2063  rray of float: c
-0000a150: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
-0000a160: 200a 2020 2222 220a 0a20 2023 2031 2e20   .  """..  # 1. 
-0000a170: 696e 6465 7065 6e64 656e 7420 6572 726f  independent erro
-0000a180: 7273 0a20 2069 6620 6520 6973 206e 6f74  rs.  if e is not
-0000a190: 204e 6f6e 653a 0a20 2020 2069 6620 652e   None:.    if e.
-0000a1a0: 6e64 696d 203d 3d20 323a 2023 2061 6c72  ndim == 2: # alr
-0000a1b0: 6561 6479 2067 6f74 2061 206d 6174 7269  eady got a matri
-0000a1c0: 782c 2074 616b 6520 6173 2063 6f76 6172  x, take as covar
-0000a1d0: 6961 6e63 6520 6d61 7472 6978 0a20 2020  iance matrix.   
-0000a1e0: 2020 2063 6f76 203d 206e 702e 6172 7261     cov = np.arra
-0000a1f0: 7928 652c 2063 6f70 793d 5472 7565 290a  y(e, copy=True).
-0000a200: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000a210: 636f 7620 3d20 6e70 2e64 6961 6728 6520  cov = np.diag(e 
-0000a220: 2a20 6529 2023 2073 6574 2064 6961 676f  * e) # set diago
-0000a230: 6e61 6c20 656c 656d 656e 7473 206f 6620  nal elements of 
-0000a240: 636f 7661 7269 616e 6365 206d 6174 7269  covariance matri
-0000a250: 780a 2020 656c 7365 3a0a 2020 2020 636f  x.  else:.    co
-0000a260: 7620 3d20 6e70 2e7a 6572 6f73 2820 286e  v = np.zeros( (n
-0000a270: 642c 206e 6429 2029 0a20 2020 200a 2020  d, nd) ).    .  
-0000a280: 2320 322e 2061 6464 2072 656c 6174 6976  # 2. add relativ
-0000a290: 6520 6572 726f 7273 0a20 2069 6620 6572  e errors.  if er
-0000a2a0: 656c 2069 7320 6e6f 7420 4e6f 6e65 3a0a  el is not None:.
-0000a2b0: 2020 2020 6966 2065 7265 6c2e 6e64 696d      if erel.ndim
-0000a2c0: 203d 3d20 323a 2023 2067 6f74 2061 206d   == 2: # got a m
-0000a2d0: 6174 7269 780a 2020 2020 2020 636f 7620  atrix.      cov 
-0000a2e0: 2b3d 2065 7220 2a20 6e70 2e6f 7574 6572  += er * np.outer
-0000a2f0: 2864 6174 612c 2064 6174 6129 0a20 2020  (data, data).   
-0000a300: 2065 6c73 653a 0a20 2020 2020 2065 725f   else:.      er_
-0000a310: 203d 206e 702e 6172 7261 7928 6572 656c   = np.array(erel
-0000a320: 2920 2a20 6461 7461 0a20 2020 2020 2063  ) * data.      c
-0000a330: 6f76 202b 3d20 6e70 2e64 6961 6728 6572  ov += np.diag(er
-0000a340: 5f20 2a20 6572 5f29 2020 2023 2064 6961  _ * er_)   # dia
-0000a350: 676f 6e61 6c20 656c 656d 656e 7473 206f  gonal elements o
-0000a360: 6620 636f 7661 7269 616e 6365 206d 6174  f covariance mat
-0000a370: 7269 780a 2020 0a20 2023 2033 2e20 6164  rix.  .  # 3. ad
-0000a380: 6420 6162 736f 6c75 7465 2c20 636f 7272  d absolute, corr
-0000a390: 656c 6174 6564 2065 7272 6f72 2063 6f6d  elated error com
-0000a3a0: 706f 6e65 6e74 7320 200a 2020 6966 2065  ponents  .  if e
-0000a3b0: 6162 7363 6f72 2069 7320 6e6f 7420 4e6f  abscor is not No
-0000a3c0: 6e65 3a0a 2020 2020 6966 206c 656e 286e  ne:.    if len(n
-0000a3d0: 702e 7368 6170 6528 6561 6273 636f 7220  p.shape(eabscor 
-0000a3e0: 2929 203c 2032 3a20 2320 6861 7320 6f6e  )) < 2: # has on
-0000a3f0: 6520 656e 7472 790a 2020 2020 2020 636f  e entry.      co
-0000a400: 7620 2b3d 206e 702e 6f75 7465 7228 6561  v += np.outer(ea
-0000a410: 6273 636f 722c 2065 6162 7363 6f72 2920  bscor, eabscor) 
-0000a420: 0a20 2020 2065 6c73 653a 2020 2020 2020  .    else:      
-0000a430: 2020 2020 2020 2320 676f 7420 6120 6c69        # got a li
-0000a440: 7374 2c20 6164 6420 6561 6368 2063 6f6d  st, add each com
-0000a450: 706f 6e65 6e74 0a20 2020 2020 2066 6f72  ponent.      for
-0000a460: 2063 2069 6e20 6561 6273 636f 723a 0a20   c in eabscor:. 
-0000a470: 2020 2020 2020 2063 6f76 202b 3d20 6e70         cov += np
-0000a480: 2e6f 7574 6572 2863 2c20 6329 0a20 2020  .outer(c, c).   
-0000a490: 2020 2020 200a 2020 2320 342e 2061 6464       .  # 4. add
-0000a4a0: 2072 656c 6174 6976 652c 2063 6f72 7265   relative, corre
-0000a4b0: 6c61 7465 6420 6572 726f 7220 636f 6d70  lated error comp
-0000a4c0: 6f6e 656e 7473 0a20 2069 6620 6572 656c  onents.  if erel
-0000a4d0: 636f 7220 6973 206e 6f74 204e 6f6e 653a  cor is not None:
-0000a4e0: 0a20 2020 2069 6620 6c65 6e28 6e70 2e73  .    if len(np.s
-0000a4f0: 6861 7065 2865 7265 6c63 6f72 2920 2920  hape(erelcor) ) 
-0000a500: 3c20 323a 2023 2068 6173 206f 6e65 2065  < 2: # has one e
-0000a510: 6e74 7279 0a20 2020 2020 2063 5f20 3d20  ntry.      c_ = 
-0000a520: 6572 656c 636f 7220 2a20 6461 7461 0a20  erelcor * data. 
-0000a530: 2020 2020 2063 6f76 202b 3d20 6e70 2e6f       cov += np.o
-0000a540: 7574 6572 2863 5f2c 2063 5f29 200a 2020  uter(c_, c_) .  
-0000a550: 2020 656c 7365 3a20 2020 2020 2020 2020    else:         
-0000a560: 2020 2023 2067 6f74 2061 206c 6973 742c     # got a list,
-0000a570: 2061 6464 2065 6163 6820 636f 6d70 6f6e   add each compon
-0000a580: 656e 740a 2020 2020 2020 666f 7220 6320  ent.      for c 
-0000a590: 696e 2065 7265 6c63 6f72 3a0a 2020 2020  in erelcor:.    
-0000a5a0: 2020 2020 635f 203d 206e 702e 6172 7261      c_ = np.arra
-0000a5b0: 7928 6329 202a 2064 6174 610a 2020 2020  y(c) * data.    
-0000a5c0: 2020 2020 636f 7620 2b3d 206e 702e 6f75      cov += np.ou
-0000a5d0: 7465 7228 635f 2c20 635f 2920 0a20 2023  ter(c_, c_) .  #
-0000a5e0: 2072 6574 7572 6e20 636f 6d70 6c65 7465   return complete
-0000a5f0: 206d 6174 7269 780a 2020 7265 7475 726e   matrix.  return
-0000a600: 2063 6f76 0a0a 230a 2320 2d2d 2d20 636c   cov..#.# --- cl
-0000a610: 6173 7365 7320 616e 6420 6675 6e63 7469  asses and functi
-0000a620: 6f6e 730a 230a 0a63 6c61 7373 206d 6e46  ons.#..class mnF
-0000a630: 6974 2829 3a0a 2020 2222 222a 2a46 6974  it():.  """**Fit
-0000a640: 2061 6e20 6172 6269 7472 6172 7920 6675   an arbitrary fu
-0000a650: 6e63 7469 6f6e 2066 2878 2c20 2a70 6172  nction f(x, *par
-0000a660: 2920 746f 2064 6174 612a 2a20 200a 2020  ) to data**  .  
-0000a670: 7769 7468 2069 6e64 6570 656e 6465 6e74  with independent
-0000a680: 2061 6e64 2f6f 7220 636f 7272 656c 6174   and/or correlat
-0000a690: 6564 2061 6273 6f6c 7574 6520 616e 642f  ed absolute and/
-0000a6a0: 6f72 2072 656c 6174 6976 6520 756e 6365  or relative unce
-0000a6b0: 7274 6169 6e74 6965 730a 0a20 2054 6869  rtainties..  Thi
-0000a6c0: 7320 696d 706c 656d 656e 7461 7469 6f6e  s implementation
-0000a6d0: 2064 6570 656e 6473 206f 6e20 616e 6420   depends on and 
-0000a6e0: 6865 6176 696c 7920 7573 6573 2066 6561  heavily uses fea
-0000a6f0: 7475 7265 7320 6f66 200a 2020 7468 6520  tures of .  the 
-0000a700: 6d69 6e69 6d69 7a65 7220 616e 6420 756e  minimizer and un
-0000a710: 6365 7274 6169 6e74 792d 6573 7469 6d61  certainty-estima
-0000a720: 746f 7220 2a2a 696d 696e 7569 742a 2a2e  tor **iminuit**.
-0000a730: 0a20 2020 0a20 2050 7562 6c69 6320 4461  .   .  Public Da
-0000a740: 7461 206d 656d 6265 720a 0a20 202d 2066  ta member..  - f
-0000a750: 6974 5f74 7970 653a 2027 7879 2720 2864  it_type: 'xy' (d
-0000a760: 6566 6175 6c74 292c 2027 6869 7374 272c  efault), 'hist',
-0000a770: 2027 7573 6572 2720 6f72 2027 6d6c 272c   'user' or 'ml',
-0000a780: 2063 6f6e 7472 6f6c 7320 7479 7065 206f   controls type o
-0000a790: 6620 6669 7420 0a0a 2020 5075 626c 6963  f fit ..  Public
-0000a7a0: 206d 6574 686f 6473 3a0a 0a20 202d 2069   methods:..  - i
-0000a7b0: 6e69 745f 6461 7461 2829 3a20 2020 2020  nit_data():     
-0000a7c0: 2020 2067 656e 6572 6963 2077 7261 7070     generic wrapp
-0000a7d0: 6572 2066 6f72 2069 6e69 745f 2a44 6174  er for init_*Dat
-0000a7e0: 6128 2920 6d65 7468 6f64 730a 2020 2d20  a() methods.  - 
-0000a7f0: 696e 6974 5f66 6974 2829 3a20 2020 2020  init_fit():     
-0000a800: 2020 2020 6765 6e65 7269 6320 7772 6170      generic wrap
-0000a810: 7065 7220 666f 7220 696e 6974 5f2a 4669  per for init_*Fi
-0000a820: 7428 2920 6d65 7468 6f64 730a 2020 2d20  t() methods.  - 
-0000a830: 7365 744f 7074 696f 6e73 2829 3a20 2020  setOptions():   
-0000a840: 2020 2020 6765 6e65 7269 6320 7772 6170      generic wrap
-0000a850: 7065 7220 666f 7220 7365 745f 2a4f 7074  per for set_*Opt
-0000a860: 696f 6e73 2829 206d 6574 686f 6473 0a20  ions() methods. 
-0000a870: 202d 2064 6f5f 6669 7428 293a 2020 2020   - do_fit():    
-0000a880: 2020 2020 2020 2067 656e 6572 6963 2077         generic w
-0000a890: 7261 7070 6572 2066 6f72 2064 6f5f 2a46  rapper for do_*F
-0000a8a0: 6974 2829 206d 6574 686f 6473 0a20 202d  it() methods.  -
-0000a8b0: 2070 6c6f 744d 6f64 656c 2829 3a20 2020   plotModel():   
-0000a8c0: 2020 2020 2070 6c6f 7420 6d6f 6465 6c20       plot model 
-0000a8d0: 6675 6e63 7469 6f6e 2061 6e64 2064 6174  function and dat
-0000a8e0: 610a 2020 2d20 706c 6f74 436f 6e74 6f75  a.  - plotContou
-0000a8f0: 7273 2829 3a20 2020 2020 706c 6f74 2070  rs():     plot p
-0000a900: 726f 6669 6c65 206c 696b 656c 6968 6f6f  rofile likelihoo
-0000a910: 6473 2061 6e64 2063 6f6e 6669 6465 6e63  ds and confidenc
-0000a920: 6520 636f 6e74 6f75 7273 200a 2020 2d20  e contours .  - 
-0000a930: 6765 7452 6573 756c 7428 293a 2020 2020  getResult():    
-0000a940: 2020 2020 6163 6365 7373 2074 6f20 6669      access to fi
-0000a950: 6e61 6c20 6669 7420 7265 7375 6c74 7320  nal fit results 
-0000a960: 0a20 202d 2067 6574 4675 6e63 7469 6f6e  .  - getFunction
-0000a970: 4572 726f 7228 293a 2075 6e63 6572 7461  Error(): uncerta
-0000a980: 696e 7479 206f 6620 6d6f 6465 6c20 6174  inty of model at
-0000a990: 2070 6f69 6e74 2873 2920 7820 666f 7220   point(s) x for 
-0000a9a0: 7061 7261 6d65 7465 7273 2070 0a20 202d  parameters p.  -
-0000a9b0: 2070 6c6f 745f 5072 6f66 696c 6528 293a   plot_Profile():
-0000a9c0: 2020 2020 2070 6c6f 7420 7072 6f66 696c       plot profil
-0000a9d0: 6520 4c69 6b65 6c69 686f 6f64 2066 6f72  e Likelihood for
-0000a9e0: 2070 6172 616d 6574 6572 0a20 202d 2070   parameter.  - p
-0000a9f0: 6c6f 745f 636c 436f 6e74 6f75 7228 293a  lot_clContour():
-0000aa00: 2020 2070 6c6f 7420 636f 6e66 6964 656e     plot confiden
-0000aa10: 6365 206c 6576 656c 2063 6f6e 746f 7572  ce level contour
-0000aa20: 2066 6f72 2070 6169 7220 6f66 2070 6172   for pair of par
-0000aa30: 616d 6574 6572 7320 200a 2020 2d20 706c  ameters  .  - pl
-0000aa40: 6f74 5f6e 7369 6743 6f6e 746f 7572 2829  ot_nsigContour()
-0000aa50: 3a20 706c 6f74 206e 2d73 6967 6d61 2063  : plot n-sigma c
-0000aa60: 6f6e 746f 7572 7320 666f 7220 7061 6972  ontours for pair
-0000aa70: 206f 6620 7061 7261 6d65 7465 7273 2020   of parameters  
-0000aa80: 0a20 202d 2067 6574 5072 6f66 696c 6528  .  - getProfile(
-0000aa90: 293a 2020 2020 2020 2072 6574 7572 6e20  ):       return 
-0000aaa0: 7072 6f66 696c 6520 6c69 6b65 6c69 686f  profile likeliho
-0000aab0: 6f64 206f 6620 7061 7261 6d65 7465 7220  od of parameter 
-0000aac0: 706e 616d 0a20 202d 2067 6574 436f 6e74  pnam.  - getCont
-0000aad0: 6f75 7228 293a 2020 2020 2020 2072 6574  our():       ret
-0000aae0: 7572 6e20 636f 6e74 6f75 7220 706f 696e  urn contour poin
-0000aaf0: 7473 206f 6620 7061 6972 206f 6620 7061  ts of pair of pa
-0000ab00: 7261 6d65 7465 7273 0a0a 2020 5375 622d  rameters..  Sub-
-0000ab10: 436c 6173 7365 733a 0a0a 2020 2d20 7879  Classes:..  - xy
-0000ab20: 4461 7461 436f 6e74 6169 6e65 723a 2020  DataContainer:  
-0000ab30: 2020 4461 7461 2061 6e64 2075 6e63 6572    Data and uncer
-0000ab40: 7461 696e 7469 6573 2066 6f72 2078 2d79  tainties for x-y
-0000ab50: 2064 6174 610a 2020 2d20 6869 7374 4461   data.  - histDa
-0000ab60: 7461 436f 6e74 6169 6e65 723a 2020 436f  taContainer:  Co
-0000ab70: 6e74 6169 6e65 7220 666f 7220 6869 7374  ntainer for hist
-0000ab80: 6f67 7261 6d20 6461 7461 0a20 202d 206d  ogram data.  - m
-0000ab90: 6c44 6174 6143 6f6e 7461 696e 7465 723a  lDataContainter:
-0000aba0: 2020 2043 6f6e 7461 696e 6572 2066 6f72     Container for
-0000abb0: 2067 656e 6572 616c 2028 696e 6465 7865   general (indexe
-0000abc0: 6429 2064 6174 610a 0a20 202d 2078 4c53  d) data..  - xLS
-0000abd0: 7143 6f73 743a 2020 2020 2020 2020 2020  qCost:          
-0000abe0: 2045 7874 656e 6465 6420 6368 695e 3220   Extended chi^2 
-0000abf0: 636f 7374 2066 756e 6374 696f 6e20 666f  cost function fo
-0000ac00: 7220 6669 7473 2074 6f20 782d 7920 6461  r fits to x-y da
-0000ac10: 7461 0a20 202d 2068 436f 7374 3a20 2020  ta.  - hCost:   
-0000ac20: 2020 2020 2020 2020 2020 2043 6f73 7420             Cost 
-0000ac30: 6675 6e63 7469 6f6e 2066 6f72 2028 6269  function for (bi
-0000ac40: 6e6e 6564 2920 6869 7374 6f67 7261 6d20  nned) histogram 
-0000ac50: 6461 7461 200a 2020 2020 2832 2a6e 6567  data .    (2*neg
-0000ac60: 6c2e 206c 6f67 2e20 4c69 6b65 6c69 686f  l. log. Likeliho
-0000ac70: 6f64 206f 6620 506f 6973 736f 6e20 6469  od of Poisson di
-0000ac80: 7374 7269 6275 7469 6f6e 290a 2020 2d20  stribution).  - 
-0000ac90: 6d6e 436f 7374 3a20 2020 2020 2020 2020  mnCost:         
-0000aca0: 2020 2020 7573 6572 2d73 7570 706c 6965      user-supplie
-0000acb0: 6420 636f 7374 2066 756e 6374 696f 6e20  d cost function 
-0000acc0: 6f72 206e 6567 6174 6976 6520 6c6f 672d  or negative log-
-0000acd0: 6c69 6b65 6c69 686f 6f64 200a 2020 2020  likelihood .    
-0000ace0: 6f66 2075 7365 722d 7375 7070 6c69 6564  of user-supplied
-0000acf0: 2070 726f 6261 6269 6c69 7479 2064 6973   probability dis
-0000ad00: 7472 6962 7574 696f 6e0a 0a20 204d 6574  tribution..  Met
-0000ad10: 686f 6473 3a0a 0a20 202d 2069 6e69 745f  hods:..  - init_
-0000ad20: 7879 4461 7461 2829 3a20 2020 2020 2020  xyData():       
-0000ad30: 696e 6974 6961 6c69 7a65 2078 7920 6461  initialize xy da
-0000ad40: 7461 2061 6e64 2075 6e63 6572 7461 696e  ta and uncertain
-0000ad50: 7469 6573 0a20 202d 2069 6e69 745f 6844  ties.  - init_hD
-0000ad60: 6174 6128 293a 2020 2020 2020 2020 696e  ata():        in
-0000ad70: 6974 6961 6c69 7a65 2068 6973 746f 6772  itialize histogr
-0000ad80: 616d 2064 6174 6120 616e 6420 756e 6365  am data and unce
-0000ad90: 7274 6169 6e74 6965 730a 2020 2d20 696e  rtainties.  - in
-0000ada0: 6974 5f6d 6c44 6174 6128 293a 2020 2020  it_mlData():    
-0000adb0: 2020 2073 746f 7265 2064 6174 6120 666f     store data fo
-0000adc0: 7220 756e 6269 6e6e 6564 206c 696b 656c  r unbinned likel
-0000add0: 6968 6f6f 642d 6669 740a 2020 2d20 696e  ihood-fit.  - in
-0000ade0: 6974 5f78 7946 6974 2829 3a20 2020 2020  it_xyFit():     
-0000adf0: 2020 2069 6e69 7469 616c 697a 6520 7879     initialize xy
-0000ae00: 2066 6974 3a20 6461 7461 2c20 6d6f 6465   fit: data, mode
-0000ae10: 6c20 616e 6420 636f 6e73 7472 6169 6e74  l and constraint
-0000ae20: 730a 2020 2d20 696e 6974 5f68 4669 7428  s.  - init_hFit(
-0000ae30: 293a 2020 2020 2020 2020 2069 6e69 7469  ):         initi
-0000ae40: 616c 697a 6520 6869 7374 6f67 7261 6d20  alize histogram 
-0000ae50: 6669 743a 2064 6174 612c 206d 6f64 656c  fit: data, model
-0000ae60: 2061 6e64 2063 6f6e 7374 7261 696e 7473   and constraints
-0000ae70: 0a20 202d 2069 6e69 745f 6d6e 4669 7428  .  - init_mnFit(
-0000ae80: 293a 2020 2020 2020 2020 696e 6974 6961  ):        initia
-0000ae90: 6c69 7a65 2068 6973 746f 6772 616d 2073  lize histogram s
-0000aea0: 696d 706c 6520 6d69 6e75 6974 2066 6974  imple minuit fit
-0000aeb0: 0a20 202d 2073 6574 5f78 794f 7074 696f  .  - set_xyOptio
-0000aec0: 6e73 2829 3a20 2020 2020 7365 7420 6f70  ns():     set op
-0000aed0: 7469 6f6e 7320 666f 7220 7879 2046 6974  tions for xy Fit
-0000aee0: 0a20 202d 2073 6574 5f68 4f70 7469 6f6e  .  - set_hOption
-0000aef0: 7328 293a 2020 2020 2020 7365 7420 6f70  s():      set op
-0000af00: 7469 6f6e 7320 666f 7220 6869 7374 6f67  tions for histog
-0000af10: 7261 6d20 4669 740a 2020 2d20 7365 745f  ram Fit.  - set_
-0000af20: 6d6e 4f70 7469 6f6e 7328 293a 2020 2020  mnOptions():    
-0000af30: 2073 6574 206f 7074 696f 6e73 2066 6f72   set options for
-0000af40: 2073 696d 706c 6520 6d69 6e75 6974 2066   simple minuit f
-0000af50: 6974 2077 6974 6820 6578 7465 726e 616c  it with external
-0000af60: 2063 6f73 7420 6675 6e63 7469 6f6e 0a20   cost function. 
-0000af70: 202d 2064 6f5f 7879 4669 7428 293a 2020   - do_xyFit():  
-0000af80: 2020 2020 2020 2020 7065 7266 6f72 6d20          perform 
-0000af90: 7879 2066 6974 0a20 202d 2064 6f5f 6846  xy fit.  - do_hF
-0000afa0: 6974 2829 3a20 2020 2020 2020 2020 2020  it():           
-0000afb0: 7065 7266 6f72 6d20 6869 7374 6f67 7261  perform histogra
-0000afc0: 6d20 6669 740a 2020 2d20 646f 5f6d 6e46  m fit.  - do_mnF
-0000afd0: 6974 2829 3a20 2020 2020 2020 2020 2073  it():          s
-0000afe0: 696d 706c 6520 6d69 6e75 6974 2066 6974  imple minuit fit
-0000aff0: 2077 6974 6820 6578 7465 726e 616c 2c20   with external, 
-0000b000: 7573 6572 2d64 6566 696e 6564 2063 6f73  user-defined cos
-0000b010: 7420 6675 6e63 7469 6f6e 0a20 0a20 2044  t function. .  D
-0000b020: 6174 6120 6d65 6d62 6572 733a 0a20 200a  ata members:.  .
-0000b030: 2020 2d20 696d 696e 7569 745f 7665 7273    - iminuit_vers
-0000b040: 696f 6e20 2020 2020 7665 7273 696f 6e20  ion     version 
-0000b050: 6f66 2069 6d69 6e75 6974 200a 2020 2d20  of iminuit .  - 
-0000b060: 6f70 7469 6f6e 732c 2064 6963 743a 2020  options, dict:  
-0000b070: 2020 2020 6c69 7374 206f 6620 6f70 7469      list of opti
-0000b080: 6f6e 7320 0a20 202d 2050 6172 616d 6574  ons .  - Paramet
-0000b090: 6572 4e61 6d65 733a 2020 2020 206e 616d  erNames:     nam
-0000b0a0: 6573 206f 6620 7061 7261 6d65 7465 7273  es of parameters
-0000b0b0: 2028 6173 2073 7065 6369 6669 6564 2069   (as specified i
-0000b0c0: 6e20 6d6f 6465 6c20 6675 6e63 7469 6f6e  n model function
-0000b0d0: 290a 2020 2d20 6e63 6f6e 7374 7261 696e  ).  - nconstrain
-0000b0e0: 7473 2020 2020 2020 2020 6e75 6d62 6572  ts        number
-0000b0f0: 206f 6620 636f 6e73 7472 6169 6e65 6420   of constrained 
-0000b100: 7061 7261 6d65 7465 7273 2020 2020 0a20  parameters    . 
-0000b110: 202d 206e 6669 7865 6420 2020 2020 2020   - nfixed       
-0000b120: 2020 2020 2020 206e 756d 6265 7220 6f66         number of
-0000b130: 2066 6978 6564 2070 6172 616d 6574 6572   fixed parameter
-0000b140: 730a 2020 2d20 6672 6565 5061 724e 616d  s.  - freeParNam
-0000b150: 733a 2020 2020 2020 2020 6e61 6d65 7320  s:        names 
-0000b160: 6f66 2066 7265 6520 7061 7261 6d65 7465  of free paramete
-0000b170: 7273 200a 2020 2d20 476f 463a 2020 2020  rs .  - GoF:    
-0000b180: 2020 2020 2020 2020 2020 2020 676f 6f64              good
-0000b190: 6e65 7373 2d6f 662d 6669 742c 2069 2e65  ness-of-fit, i.e
-0000b1a0: 2e20 6368 6932 2061 7420 6265 7374 2d66  . chi2 at best-f
-0000b1b0: 6974 2070 6f69 6e74 0a20 202d 204e 446f  it point.  - NDo
-0000b1c0: 463a 2020 2020 2020 2020 2020 2020 2020  F:              
-0000b1d0: 206e 756d 6265 7220 6f66 2064 6567 7265   number of degre
-0000b1e0: 6573 206f 6620 6672 6565 646f 6d0a 2020  es of freedom.  
-0000b1f0: 2d20 5061 7261 6d65 7465 7256 616c 7565  - ParameterValue
-0000b200: 733a 2020 2020 7061 7261 6d65 7465 7220  s:    parameter 
-0000b210: 7661 6c75 6573 2061 7420 6265 7374 2d66  values at best-f
-0000b220: 6974 2070 6f69 6e74 0a20 202d 204d 6967  it point.  - Mig
-0000b230: 7261 6445 7272 6f72 733a 2020 2020 2020  radErrors:      
-0000b240: 2073 796d 6d65 7472 6963 2075 6e63 6572   symmetric uncer
-0000b250: 7461 696e 7469 6573 0a20 202d 2043 6f76  tainties.  - Cov
-0000b260: 6172 6961 6e63 654d 6174 7269 783a 2020  arianceMatrix:  
-0000b270: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
-0000b280: 6978 0a20 202d 2043 6f72 7265 6c61 7469  ix.  - Correlati
-0000b290: 6f6e 4d61 7472 6978 3a20 2063 6f72 7265  onMatrix:  corre
-0000b2a0: 6c61 7469 6f6e 206d 6174 7269 780a 2020  lation matrix.  
-0000b2b0: 2d20 4f6e 6553 6967 496e 7465 7276 616c  - OneSigInterval
-0000b2c0: 3a20 2020 2020 6f6e 652d 7369 676d 6120  :     one-sigma 
-0000b2d0: 2836 3825 2043 4c29 2072 616e 6765 7320  (68% CL) ranges 
-0000b2e0: 6f66 2070 6172 616d 6574 6572 2076 616c  of parameter val
-0000b2f0: 7565 7320 6672 6f6d 204d 494e 4f53 2020  ues from MINOS  
-0000b300: 2d20 5265 7375 6c74 4469 6374 696f 6e61  - ResultDictiona
-0000b310: 7279 3a20 2020 6469 6374 696f 6e61 7279  ry:   dictionary
-0000b320: 2077 6968 2073 756d 6d61 7279 206f 6620   wih summary of 
-0000b330: 6669 7420 7265 7375 6c74 730a 200a 2020  fit results. .  
-0000b340: 2d20 666f 7220 7879 4669 743a 0a20 200a  - for xyFit:.  .
-0000b350: 2020 2020 2d20 636f 7678 3a20 2020 2020      - covx:     
-0000b360: 636f 7661 7269 616e 6365 206d 6174 7269  covariance matri
-0000b370: 7820 6f66 2078 2d64 6174 610a 2020 2020  x of x-data.    
-0000b380: 2d20 636f 7679 3a20 2020 2020 636f 7661  - covy:     cova
-0000b390: 7269 616e 6365 206d 6174 7269 7820 6f66  riance matrix of
-0000b3a0: 2079 2d64 6174 6120 0a20 2020 202d 2063   y-data .    - c
-0000b3b0: 6f76 3a20 2020 2020 2063 6f6d 6269 6e65  ov:      combine
-0000b3c0: 6420 636f 7661 7269 616e 6365 206d 6174  d covariance mat
-0000b3d0: 7269 782c 2069 6e63 6c75 6469 6e67 2070  rix, including p
-0000b3e0: 726f 6a65 6374 6564 2078 2d75 6e63 6572  rojected x-uncer
-0000b3f0: 7461 696e 7469 6573 0a0a 2020 496e 7374  tainties..  Inst
-0000b400: 616e 6365 7320 6f66 2028 7375 622d 2963  ances of (sub-)c
-0000b410: 6c61 7373 6573 3a0a 0a20 202d 206d 696e  lasses:..  - min
-0000b420: 7569 742e 5c2a 3a20 6d65 7468 6f64 7320  uit.\*: methods 
-0000b430: 616e 6420 6d65 6d62 6572 7320 6f66 204d  and members of M
-0000b440: 696e 7569 7420 6f62 6a65 6374 200a 2020  inuit object .  
-0000b450: 2d20 6461 7461 2e5c 2a3a 2020 206d 6574  - data.\*:   met
-0000b460: 686f 6473 2061 6e64 206d 656d 6265 7273  hods and members
-0000b470: 206f 6620 6461 7461 2073 7562 2d63 6c61   of data sub-cla
-0000b480: 7373 2c20 6765 6e65 7269 630a 2020 2d20  ss, generic.  - 
-0000b490: 636f 7374 662e 5c2a 3a20 206d 6574 686f  costf.\*:  metho
-0000b4a0: 6473 2061 6e64 206d 656d 6265 7273 206f  ds and members o
-0000b4b0: 6620 636f 7374 2073 7562 2d63 6c61 7373  f cost sub-class
-0000b4c0: 2c20 6765 6e65 7269 6320 0a20 2022 2222  , generic .  """
-0000b4d0: 0a0a 2020 6465 6620 5f5f 696e 6974 5f5f  ..  def __init__
-0000b4e0: 2873 656c 662c 2066 6974 5f74 7970 653d  (self, fit_type=
-0000b4f0: 2778 7927 293a 0a20 2020 2022 2222 0a20  'xy'):.    """. 
-0000b500: 2020 2054 7970 6520 6f66 2066 6974 3a0a     Type of fit:.
-0000b510: 0a20 2020 202d 2027 7879 2720 2020 3a20  .    - 'xy'   : 
-0000b520: 6669 7420 6d6f 6465 6c20 6d6f 6465 6c20  fit model model 
-0000b530: 7928 6628 783b 2070 6172 2920 746f 2064  y(f(x; par) to d
-0000b540: 6174 6120 0a20 2020 202d 2027 6869 7374  ata .    - 'hist
-0000b550: 2720 3a20 6669 7420 6465 6e73 6974 6979  ' : fit densitiy
-0000b560: 2074 6f20 6269 6e6e 6564 2064 6174 6120   to binned data 
-0000b570: 2869 2e65 2e20 6869 7374 6f67 7261 6d29  (i.e. histogram)
-0000b580: 200a 2020 2020 2d20 2775 7365 7227 3a20   .    - 'user': 
-0000b590: 7573 6572 2d73 7570 706c 6965 6420 636f  user-supplied co
-0000b5a0: 7374 2d66 756e 6374 696f 6e20 2869 2e65  st-function (i.e
-0000b5b0: 2e20 6e65 672e 206c 6f67 2d6c 696b 656c  . neg. log-likel
-0000b5c0: 6968 6f6f 6429 0a20 2020 2022 2222 0a0a  ihood).    """..
-0000b5d0: 2020 2020 6966 2066 6974 5f74 7970 6520      if fit_type 
-0000b5e0: 6e6f 7420 696e 205b 2778 7927 2c20 2769  not in ['xy', 'i
-0000b5f0: 6e64 6578 6564 272c 2027 6869 7374 272c  ndexed', 'hist',
-0000b600: 2027 7573 6572 272c 2027 6d6c 275d 3a0a   'user', 'ml']:.
-0000b610: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000b620: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0000b630: 2721 2a2a 2120 6d6e 4669 743a 2069 6e76  '!**! mnFit: inv
-0000b640: 616c 6964 2066 6974 2074 7970 6520 2720  alid fit type ' 
-0000b650: 2b20 6669 745f 7479 7065 202b 2027 202d  + fit_type + ' -
-0000b660: 2065 7869 7469 6e67 2127 2920 0a20 2020   exiting!') .   
-0000b670: 2073 656c 662e 6669 745f 7479 7065 203d   self.fit_type =
-0000b680: 2066 6974 5f74 7970 650a 0a20 2020 2073   fit_type..    s
-0000b690: 656c 662e 696d 696e 7569 745f 7665 7273  elf.iminuit_vers
-0000b6a0: 696f 6e20 3d20 7374 7228 696d 696e 7569  ion = str(iminui
-0000b6b0: 745f 7665 7273 696f 6e29 0a0a 2020 2020  t_version)..    
-0000b6c0: 2320 636f 756e 7465 7220 666f 7220 6e75  # counter for nu
-0000b6d0: 6d62 6572 206f 6620 6578 7465 726e 616c  mber of external
-0000b6e0: 2063 6f6e 7374 7261 696e 7473 200a 2020   constraints .  
-0000b6f0: 2020 7365 6c66 2e6e 636f 6e73 7472 6169    self.nconstrai
-0000b700: 6e74 7320 3d20 300a 2020 2020 2320 636f  nts = 0.    # co
-0000b710: 756e 7465 7220 666f 7220 6e75 6d62 6572  unter for number
-0000b720: 206f 6620 6669 7865 6420 7061 7261 6d65   of fixed parame
-0000b730: 7465 7273 0a20 2020 2073 656c 662e 6e66  ters.    self.nf
-0000b740: 6978 6564 203d 2030 200a 0a20 2020 2023  ixed = 0 ..    #
-0000b750: 2073 6574 2064 6566 6175 6c74 206f 6620   set default of 
-0000b760: 616c 6c20 6f70 7469 6f6e 730a 2020 2020  all options.    
-0000b770: 230a 2020 2020 2320 2020 6e6f 2064 6174  #.    #   no dat
-0000b780: 6120 6f72 206d 6f64 656c 2070 726f 7669  a or model provi
-0000b790: 6465 6420 7965 740a 2020 2020 7365 6c66  ded yet.    self
-0000b7a0: 2e78 7944 6174 6120 3d20 4e6f 6e65 0a20  .xyData = None. 
-0000b7b0: 2020 2073 656c 662e 6844 6174 6120 3d20     self.hData = 
-0000b7c0: 4e6f 6e65 0a20 2020 2073 656c 662e 6d6c  None.    self.ml
-0000b7d0: 4461 7461 203d 204e 6f6e 650a 2020 2020  Data = None.    
-0000b7e0: 7365 6c66 2e78 4461 7461 203d 204e 6f6e  self.xData = Non
-0000b7f0: 650a 2020 2020 2320 6765 6e65 7269 632c  e.    # generic,
-0000b800: 2068 6f6c 6473 2061 6374 6976 6520 696e   holds active in
-0000b810: 7374 616e 6365 206f 6620 7375 622d 636c  stance of sub-cl
-0000b820: 6173 7320 7878 4461 7461 0a20 2020 2073  ass xxData.    s
-0000b830: 656c 662e 6461 7461 203d 204e 6f6e 650a  elf.data = None.
-0000b840: 2020 2020 2320 6765 6e65 7269 632c 2068      # generic, h
-0000b850: 6f6c 6473 2061 6374 6976 6520 696e 7374  olds active inst
-0000b860: 616e 6320 6f66 2073 7562 2d63 6c61 7373  anc of sub-class
-0000b870: 2078 7843 6f73 740a 2020 2020 7365 6c66   xxCost.    self
-0000b880: 2e63 6f73 7466 203d 204e 6f6e 650a 2020  .costf = None.  
-0000b890: 2020 2320 6e6f 2066 6974 2064 6f6e 6520    # no fit done 
-0000b8a0: 7965 740a 2020 2020 7365 6c66 2e6d 6967  yet.    self.mig
-0000b8b0: 7261 6452 6573 756c 7420 3d20 4e6f 6e65  radResult = None
-0000b8c0: 0a20 2020 2073 656c 662e 6d69 6e6f 7352  .    self.minosR
-0000b8d0: 6573 756c 7420 3d20 4e6f 6e65 0a20 2020  esult = None.   
-0000b8e0: 2073 656c 662e 6d69 6772 6164 5f6f 6b20   self.migrad_ok 
-0000b8f0: 3d20 4661 6c73 650a 2020 2020 7365 6c66  = False.    self
-0000b900: 2e6d 696e 6f73 5f6f 6b20 3d20 4661 6c73  .minos_ok = Fals
-0000b910: 650a 0a20 2020 2073 656c 662e 5265 7375  e..    self.Resu
-0000b920: 6c74 4469 6374 696f 6e61 7279 203d 204e  ltDictionary = N
-0000b930: 6f6e 650a 2020 2020 0a20 2020 2023 2064  one.    .    # d
-0000b940: 6566 6175 6c74 206f 7074 696f 6e73 0a20  efault options. 
-0000b950: 2020 2073 656c 662e 7275 6e5f 6d69 6e6f     self.run_mino
-0000b960: 7320 3d20 5472 7565 0a20 2020 2073 656c  s = True.    sel
-0000b970: 662e 7175 6965 7420 3d20 5472 7565 0a20  f.quiet = True. 
-0000b980: 2020 2023 2066 6f72 2078 7920 616e 6420     # for xy and 
-0000b990: 696e 6465 7865 6420 4669 740a 2020 2020  indexed Fit.    
-0000b9a0: 7365 6c66 2e72 6566 4d6f 6465 6c3d 5472  self.refModel=Tr
-0000b9b0: 7565 0a20 2020 2073 656c 662e 7573 655f  ue.    self.use_
-0000b9c0: 6e65 674c 6f67 4c20 3d20 5472 7565 0a20  negLogL = True. 
-0000b9d0: 2020 2073 656c 662e 6974 6572 6174 6546     self.iterateF
-0000b9e0: 6974 203d 2046 616c 7365 0a20 2020 2023  it = False.    #
-0000b9f0: 2066 6f72 2068 6973 746f 6772 616d 2066   for histogram f
-0000ba00: 6974 0a20 2020 2073 656c 662e 7573 655f  it.    self.use_
-0000ba10: 4761 7573 7341 7070 726f 7820 3d20 4661  GaussApprox = Fa
-0000ba20: 6c73 650a 2020 2020 7365 6c66 2e66 6974  lse.    self.fit
-0000ba30: 5f64 656e 7369 7479 203d 2054 7275 650a  _density = True.
-0000ba40: 2020 2020 2320 666f 7220 6669 7420 7769      # for fit wi
-0000ba50: 7468 2065 7874 6572 6e61 6c20 636f 7374  th external cost
-0000ba60: 0a20 2020 2073 656c 662e 6e65 6732 6c6f  .    self.neg2lo
-0000ba70: 674c 203d 2054 7275 650a 2020 2020 7365  gL = True.    se
-0000ba80: 6c66 2e45 7272 4465 6620 3d20 312e 0a20  lf.ErrDef = 1.. 
-0000ba90: 2020 2023 206c 6567 656e 6420 666f 7220     # legend for 
-0000baa0: 706f 7373 6962 6c65 206f 7074 696f 6e73  possible options
-0000bab0: 0a20 2020 2073 656c 662e 6f70 7469 6f6e  .    self.option
-0000bac0: 7320 3d20 7b7d 0a20 2020 2073 656c 662e  s = {}.    self.
-0000bad0: 6f70 7469 6f6e 735b 2272 756e 5f6d 696e  options["run_min
-0000bae0: 6f73 225d 203d 205b 312c 2022 616c 6c22  os"] = [1, "all"
-0000baf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000bb00: 2020 2020 226e 6f20 6c69 6b65 6c69 686f      "no likeliho
-0000bb10: 6f64 2073 6361 6e22 2c0a 2020 2020 2020  od scan",.      
-0000bb20: 2020 2020 2020 2020 2020 2020 224d 494e              "MIN
-0000bb30: 4f53 2070 726f 6669 6c65 206c 696b 656c  OS profile likel
-0000bb40: 6968 6f6f 6420 7363 616e 225d 0a20 2020  ihood scan"].   
-0000bb50: 2073 656c 662e 6f70 7469 6f6e 735b 2272   self.options["r
-0000bb60: 6566 4d6f 6465 6c22 5d3d 5b31 2c20 5b22  efModel"]=[1, ["
-0000bb70: 7879 222c 2022 696e 6465 7865 6422 5d2c  xy", "indexed"],
-0000bb80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bb90: 2020 2020 2020 2020 2020 2020 2022 7265               "re
-0000bba0: 6c61 7469 7665 2075 6e63 6572 7461 696e  lative uncertain
-0000bbb0: 7469 6573 2072 6566 6572 2074 6f20 6461  ties refer to da
-0000bbc0: 7461 222c 0a20 2020 2020 2020 2020 2020  ta",.           
-0000bbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbe0: 2022 7265 6c61 7469 7665 2075 6e63 6572   "relative uncer
-0000bbf0: 7461 696e 7469 6573 2072 6566 6572 2074  tainties refer t
-0000bc00: 6f20 6d6f 6465 6c22 5d0a 2020 2020 7365  o model"].    se
-0000bc10: 6c66 2e6f 7074 696f 6e73 5b22 7573 655f  lf.options["use_
-0000bc20: 6e65 674c 6f67 4c22 5d20 3d20 5b31 2c20  negLogL"] = [1, 
-0000bc30: 5b22 7879 222c 2022 696e 6465 7865 6422  ["xy", "indexed"
-0000bc40: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0000bc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc60: 2020 2020 2275 7369 6e67 2073 696d 706c      "using simpl
-0000bc70: 6520 6368 695e 3220 636f 7374 2d66 756e  e chi^2 cost-fun
-0000bc80: 6374 696f 6e22 2c0a 2020 2020 2020 2020  ction",.        
-0000bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bca0: 2020 2020 2020 2020 2022 7573 696e 6720           "using 
-0000bcb0: 6675 6c6c 206e 6567 6174 6976 6520 6c6f  full negative lo
-0000bcc0: 672d 6c69 6b65 6c69 686f 6f64 225d 0a0a  g-likelihood"]..
-0000bcd0: 2020 2020 7365 6c66 2e6f 7074 696f 6e73      self.options
-0000bce0: 5b22 7573 655f 4761 7573 7341 7070 726f  ["use_GaussAppro
-0000bcf0: 7822 5d20 3d20 5b30 2c20 2268 6973 7422  x"] = [0, "hist"
-0000bd00: 2c0a 2020 2020 2020 2020 2020 2020 2275  ,.            "u
-0000bd10: 7369 6e67 2050 6f69 7373 6f6e 206c 696b  sing Poisson lik
-0000bd20: 656c 6968 6f6f 6422 2c0a 2020 2020 2020  elihood",.      
-0000bd30: 2020 2020 2020 2275 7369 6e67 2047 6175        "using Gau
-0000bd40: 7373 6961 6e20 6170 7072 6f78 696d 6174  ssian approximat
-0000bd50: 696f 6e20 6f66 2050 6f69 7373 6f6e 2064  ion of Poisson d
-0000bd60: 6973 7469 6275 7469 6f6e 225d 0a20 2020  istibution"].   
-0000bd70: 2073 656c 662e 6f70 7469 6f6e 735b 2266   self.options["f
-0000bd80: 6974 5f64 656e 7369 7479 225d 203d 205b  it_density"] = [
-0000bd90: 312c 2022 6869 7374 222c 0a20 2020 2020  1, "hist",.     
-0000bda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdb0: 2020 2020 2020 2020 2020 2020 2266 6974              "fit
-0000bdc0: 2066 6f72 206e 756d 6265 7220 6f66 2065   for number of e
-0000bdd0: 6e74 7269 6573 2f62 696e 222c 0a20 2020  ntries/bin",.   
-0000bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bdf0: 2020 2020 2020 2020 2020 2020 2020 2266                "f
-0000be00: 6974 2064 656e 7369 7479 2064 6973 7472  it density distr
-0000be10: 6962 7574 696f 6e22 5d0a 2020 2020 7365  ibution"].    se
-0000be20: 6c66 2e6f 7074 696f 6e73 5b22 6e65 6732  lf.options["neg2
-0000be30: 6c6f 674c 225d 203d 205b 312c 205b 2275  logL"] = [1, ["u
-0000be40: 7365 7222 2c20 226d 6c22 5d2c 0a20 2020  ser", "ml"],.   
-0000be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000be60: 2020 2020 2020 2020 2020 2022 7573 696e             "usin
-0000be70: 6720 7374 616e 6461 7264 206c 696b 656c  g standard likel
-0000be80: 6968 6f6f 6420 2d3e 2065 7272 6465 6620  ihood -> errdef 
-0000be90: 3d20 302e 3522 2c0a 2020 2020 2020 2020  = 0.5",.        
-0000bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000beb0: 2020 2020 2020 2275 7369 6e67 202d 3220        "using -2 
-0000bec0: 2a20 6e65 672e 206c 6f67 2e20 6c69 6b65  * neg. log. like
-0000bed0: 6c69 686f 6f64 202d 3e20 6572 7264 6566  lihood -> errdef
-0000bee0: 3d31 2e22 5d0a 0a20 2020 2023 2073 6574  =1."]..    # set
-0000bef0: 206f 7074 696f 6e73 2066 6f72 2028 6e69   options for (ni
-0000bf00: 6365 7229 2070 6c6f 7474 696e 670a 2020  cer) plotting.  
-0000bf10: 2020 7365 6c66 2e73 6574 506c 6f74 4f70    self.setPlotOp
-0000bf20: 7469 6f6e 7328 290a 2020 2020 0a20 2064  tions().    .  d
-0000bf30: 6566 2069 6e69 745f 6461 7461 2873 656c  ef init_data(sel
-0000bf40: 662c 202a 6172 6773 2c20 2a2a 6b77 6172  f, *args, **kwar
-0000bf50: 6773 293a 0a20 2020 2069 6620 7365 6c66  gs):.    if self
-0000bf60: 2e66 6974 5f74 7970 6520 3d3d 2027 7879  .fit_type == 'xy
-0000bf70: 273a 0a20 2020 2020 2073 656c 662e 696e  ':.      self.in
-0000bf80: 6974 5f78 7944 6174 6128 2a61 7267 732c  it_xyData(*args,
-0000bf90: 202a 2a6b 7761 7267 7329 0a20 2020 2065   **kwargs).    e
-0000bfa0: 6c69 6620 7365 6c66 2e66 6974 5f74 7970  lif self.fit_typ
-0000bfb0: 6520 3d3d 2027 696e 6465 7865 6427 3a0a  e == 'indexed':.
-0000bfc0: 2020 2020 2020 7365 6c66 2e69 6e69 745f        self.init_
-0000bfd0: 7844 6174 6128 2a61 7267 732c 202a 2a6b  xData(*args, **k
-0000bfe0: 7761 7267 7329 0a20 2020 2065 6c69 6620  wargs).    elif 
-0000bff0: 7365 6c66 2e66 6974 5f74 7970 6520 3d3d  self.fit_type ==
-0000c000: 2027 6869 7374 273a 0a20 2020 2020 2073   'hist':.      s
-0000c010: 656c 662e 696e 6974 5f68 4461 7461 282a  elf.init_hData(*
-0000c020: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
-0000c030: 2020 2020 656c 6966 2073 656c 662e 6669      elif self.fi
-0000c040: 745f 7479 7065 203d 3d20 276d 6c27 3a0a  t_type == 'ml':.
-0000c050: 2020 2020 2020 7365 6c66 2e69 6e69 745f        self.init_
-0000c060: 6d6c 4461 7461 282a 6172 6773 2c20 2a2a  mlData(*args, **
-0000c070: 6b77 6172 6773 290a 2020 2020 656c 6966  kwargs).    elif
-0000c080: 2073 656c 662e 6669 745f 7479 7065 203d   self.fit_type =
-0000c090: 3d20 2775 7365 7227 3a0a 2020 2020 2020  = 'user':.      
-0000c0a0: 7072 696e 7428 2221 2a2a 2120 6d6e 4669  print("!**! mnFi
-0000c0b0: 743a 206e 6f74 2064 6174 6120 6f62 6a65  t: not data obje
-0000c0c0: 6374 2074 6f20 6265 2064 6566 696e 6465  ct to be definde
-0000c0d0: 6420 666f 7220 6669 745f 7479 7065 2027  d for fit_type '
-0000c0e0: 7573 6572 2722 2029 0a20 2020 2065 6c73  user'" ).    els
-0000c0f0: 653a 0a20 2020 2020 2072 6169 7365 2056  e:.      raise V
-0000c100: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-0000c110: 2020 2022 212a 2a21 2075 6e6b 6e6f 776e     "!**! unknown
-0000c120: 2074 7970 6520 6f66 2046 6974 2022 202b   type of Fit " +
-0000c130: 2073 656c 662e 6669 745f 7479 7065 290a   self.fit_type).
-0000c140: 2020 2020 0a20 2064 6566 2073 6574 4f70      .  def setOp
-0000c150: 7469 6f6e 7328 7365 6c66 2c20 2a61 7267  tions(self, *arg
-0000c160: 732c 202a 2a6b 7761 7267 7329 3a0a 2020  s, **kwargs):.  
-0000c170: 2020 6966 2073 656c 662e 6669 745f 7479    if self.fit_ty
-0000c180: 7065 203d 3d20 2778 7927 3a0a 2020 2020  pe == 'xy':.    
-0000c190: 2020 7365 6c66 2e73 6574 5f78 794f 7074    self.set_xyOpt
-0000c1a0: 696f 6e73 282a 6172 6773 2c20 2a2a 6b77  ions(*args, **kw
-0000c1b0: 6172 6773 290a 2020 2020 656c 6966 2073  args).    elif s
-0000c1c0: 656c 662e 6669 745f 7479 7065 203d 3d20  elf.fit_type == 
-0000c1d0: 2769 6e64 6578 6564 273a 0a20 2020 2020  'indexed':.     
-0000c1e0: 2073 656c 662e 7365 745f 784f 7074 696f   self.set_xOptio
-0000c1f0: 6e73 282a 6172 6773 2c20 2a2a 6b77 6172  ns(*args, **kwar
-0000c200: 6773 290a 2020 2020 656c 6966 2073 656c  gs).    elif sel
-0000c210: 662e 6669 745f 7479 7065 203d 3d20 2768  f.fit_type == 'h
-0000c220: 6973 7427 3a0a 2020 2020 2020 7365 6c66  ist':.      self
-0000c230: 2e73 6574 5f68 4f70 7469 6f6e 7328 2a61  .set_hOptions(*a
-0000c240: 7267 732c 202a 2a6b 7761 7267 7329 0a20  rgs, **kwargs). 
-0000c250: 2020 2065 6c69 6620 7365 6c66 2e66 6974     elif self.fit
-0000c260: 5f74 7970 6520 3d3d 2027 7573 6572 2720  _type == 'user' 
-0000c270: 6f72 2073 656c 662e 6669 745f 7479 7065  or self.fit_type
-0000c280: 203d 3d20 276d 6c27 3a0a 2020 2020 2020   == 'ml':.      
-0000c290: 7365 6c66 2e73 6574 5f6d 6e4f 7074 696f  self.set_mnOptio
-0000c2a0: 6e73 282a 6172 6773 2c20 2a2a 6b77 6172  ns(*args, **kwar
-0000c2b0: 6773 290a 2020 2020 656c 7365 3a0a 2020  gs).    else:.  
-0000c2c0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000c2d0: 7272 6f72 280a 2020 2020 2020 2020 2221  rror(.        "!
-0000c2e0: 2a2a 2120 756e 6b6e 6f77 6e20 7479 7065  **! unknown type
-0000c2f0: 206f 6620 4669 7420 2220 2b20 7365 6c66   of Fit " + self
-0000c300: 2e66 6974 5f74 7970 6529 0a0a 2020 6465  .fit_type)..  de
-0000c310: 6620 696e 6974 5f66 6974 2873 656c 662c  f init_fit(self,
-0000c320: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-0000c330: 293a 0a20 2020 2069 6620 7365 6c66 2e66  ):.    if self.f
-0000c340: 6974 5f74 7970 6520 3d3d 2027 7879 273a  it_type == 'xy':
-0000c350: 0a20 2020 2020 2073 656c 662e 696e 6974  .      self.init
-0000c360: 5f78 7946 6974 282a 6172 6773 2c20 2a2a  _xyFit(*args, **
-0000c370: 6b77 6172 6773 290a 2020 2020 656c 6966  kwargs).    elif
-0000c380: 2073 656c 662e 6669 745f 7479 7065 203d   self.fit_type =
-0000c390: 3d20 2769 6e64 6578 6564 273a 0a20 2020  = 'indexed':.   
-0000c3a0: 2020 2073 656c 662e 696e 6974 5f78 4669     self.init_xFi
-0000c3b0: 7428 2a61 7267 732c 202a 2a6b 7761 7267  t(*args, **kwarg
-0000c3c0: 7329 0a20 2020 2065 6c69 6620 7365 6c66  s).    elif self
-0000c3d0: 2e66 6974 5f74 7970 6520 3d3d 2027 6869  .fit_type == 'hi
-0000c3e0: 7374 273a 0a20 2020 2020 2073 656c 662e  st':.      self.
-0000c3f0: 696e 6974 5f68 4669 7428 2a61 7267 732c  init_hFit(*args,
-0000c400: 202a 2a6b 7761 7267 7329 0a20 2020 2065   **kwargs).    e
-0000c410: 6c69 6620 7365 6c66 2e66 6974 5f74 7970  lif self.fit_typ
-0000c420: 6520 3d3d 2027 7573 6572 2720 6f72 2073  e == 'user' or s
-0000c430: 656c 662e 6669 745f 7479 7065 203d 3d20  elf.fit_type == 
-0000c440: 276d 6c27 3a0a 2020 2020 2020 7365 6c66  'ml':.      self
-0000c450: 2e69 6e69 745f 6d6e 4669 7428 2a61 7267  .init_mnFit(*arg
-0000c460: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
-0000c470: 2065 6c73 653a 0a20 2020 2020 2072 6169   else:.      rai
-0000c480: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-0000c490: 2020 2020 2020 2022 212a 2a21 2075 6e6b         "!**! unk
-0000c4a0: 6e6f 776e 2074 7970 6520 6f66 2046 6974  nown type of Fit
-0000c4b0: 2022 202b 2073 656c 662e 6669 745f 7479   " + self.fit_ty
-0000c4c0: 7065 290a 0a20 2023 0a20 2023 202d 2d2d  pe)..  #.  # ---
-0000c4d0: 2073 7065 6369 616c 2063 6f64 6520 666f   special code fo
-0000c4e0: 7220 7879 2046 6974 0a20 2023 2020 2020  r xy Fit.  #    
-0000c4f0: 2020 0a0a 2020 6465 6620 7365 745f 7879    ..  def set_xy
-0000c500: 4f70 7469 6f6e 7328 7365 6c66 2c0a 2020  Options(self,.  
-0000c510: 2020 2020 2020 2020 2020 2020 7265 6c61              rela
-0000c520: 7469 7665 5f72 6566 6572 735f 746f 5f6d  tive_refers_to_m
-0000c530: 6f64 656c 3d4e 6f6e 652c 0a20 2020 2020  odel=None,.     
-0000c540: 2020 2020 2020 2020 2072 756e 5f6d 696e           run_min
-0000c550: 6f73 3d4e 6f6e 652c 0a20 2020 2020 2020  os=None,.       
-0000c560: 2020 2020 2020 2075 7365 5f6e 6567 4c6f         use_negLo
-0000c570: 674c 3d4e 6f6e 652c 0a20 2020 2020 2020  gL=None,.       
-0000c580: 2020 2020 2020 2071 7569 6574 3d4e 6f6e         quiet=Non
-0000c590: 6529 3a0a 0a20 2020 2022 2222 4465 6669  e):..    """Defi
-0000c5a0: 6e65 206f 7074 696f 6e73 2066 6f72 2078  ne options for x
-0000c5b0: 7920 6669 740a 0a20 2020 2020 2020 4172  y fit..       Ar
-0000c5c0: 6773 3a0a 2020 2020 2020 2020 2d20 7265  gs:.        - re
-0000c5d0: 6c2e 2065 7272 6f72 7320 7265 6665 7220  l. errors refer 
-0000c5e0: 746f 206d 6f64 656c 2065 6c73 6520 6461  to model else da
-0000c5f0: 7461 0a20 2020 2020 2020 202d 2072 756e  ta.        - run
-0000c600: 206d 696e 6f73 2065 6c73 6520 646f 6e2a   minos else don*
-0000c610: 7420 7275 6e20 6d69 6e6f 730a 2020 2020  t run minos.    
-0000c620: 2020 2020 2d20 7573 6520 6675 6c6c 206e      - use full n
-0000c630: 6567 326c 6f67 4c0a 2020 2020 2020 2020  eg2logL.        
-0000c640: 2d20 646f 6e2a 7420 7072 6f76 6964 6520  - don*t provide 
-0000c650: 7072 696e 746f 7574 2065 6c73 6520 7665  printout else ve
-0000c660: 7262 6f73 6520 7072 696e 746f 7574 200a  rbose printout .
-0000c670: 2020 2020 2222 220a 2020 2020 6966 2072      """.    if r
-0000c680: 656c 6174 6976 655f 7265 6665 7273 5f74  elative_refers_t
-0000c690: 6f5f 6d6f 6465 6c20 6973 206e 6f74 204e  o_model is not N
-0000c6a0: 6f6e 653a 0a20 2020 2020 2073 656c 662e  one:.      self.
-0000c6b0: 7265 664d 6f64 656c 203d 2072 656c 6174  refModel = relat
-0000c6c0: 6976 655f 7265 6665 7273 5f74 6f5f 6d6f  ive_refers_to_mo
-0000c6d0: 6465 6c0a 2020 2020 2020 7365 6c66 2e6f  del.      self.o
-0000c6e0: 7074 696f 6e73 5b22 7265 664d 6f64 656c  ptions["refModel
-0000c6f0: 225d 5b30 5d20 3d20 696e 7428 7265 6c61  "][0] = int(rela
-0000c700: 7469 7665 5f72 6566 6572 735f 746f 5f6d  tive_refers_to_m
-0000c710: 6f64 656c 290a 2020 2020 6966 2072 756e  odel).    if run
-0000c720: 5f6d 696e 6f73 2069 7320 6e6f 7420 4e6f  _minos is not No
-0000c730: 6e65 3a20 2020 0a20 2020 2020 2073 656c  ne:   .      sel
-0000c740: 662e 7275 6e5f 6d69 6e6f 7320 3d20 7275  f.run_minos = ru
-0000c750: 6e5f 6d69 6e6f 730a 2020 2020 2020 7365  n_minos.      se
-0000c760: 6c66 2e6f 7074 696f 6e73 5b22 7275 6e5f  lf.options["run_
-0000c770: 6d69 6e6f 7322 5d5b 305d 203d 2069 6e74  minos"][0] = int
-0000c780: 2872 756e 5f6d 696e 6f73 290a 2020 2020  (run_minos).    
-0000c790: 6966 2075 7365 5f6e 6567 4c6f 674c 2069  if use_negLogL i
-0000c7a0: 7320 6e6f 7420 4e6f 6e65 3a20 2020 0a20  s not None:   . 
-0000c7b0: 2020 2020 2073 656c 662e 7573 655f 6e65       self.use_ne
-0000c7c0: 674c 6f67 4c20 3d20 7573 655f 6e65 674c  gLogL = use_negL
-0000c7d0: 6f67 4c0a 2020 2020 2020 7365 6c66 2e6f  ogL.      self.o
-0000c7e0: 7074 696f 6e73 5b22 7573 655f 6e65 674c  ptions["use_negL
-0000c7f0: 6f67 4c22 5d5b 305d 203d 2069 6e74 2875  ogL"][0] = int(u
-0000c800: 7365 5f6e 6567 4c6f 674c 290a 2020 2020  se_negLogL).    
-0000c810: 6966 2071 7569 6574 2069 7320 6e6f 7420  if quiet is not 
-0000c820: 4e6f 6e65 3a0a 2020 2020 2020 7365 6c66  None:.      self
-0000c830: 2e71 7569 6574 203d 2071 7569 6574 0a20  .quiet = quiet. 
-0000c840: 2020 200a 2020 6465 6620 696e 6974 5f78     .  def init_x
-0000c850: 7944 6174 6128 7365 6c66 2c0a 2020 2020  yData(self,.    
-0000c860: 2020 2020 2020 2020 2020 2020 782c 2079              x, y
-0000c870: 2c20 2020 2020 2020 2020 2020 2020 0a20  ,             . 
-0000c880: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000c890: 783d 4e6f 6e65 2c20 6579 3d31 2e2c 0a20  x=None, ey=1.,. 
-0000c8a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000c8b0: 7265 6c78 3d4e 6f6e 652c 2065 7265 6c79  relx=None, erely
-0000c8c0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-0000c8d0: 2020 2020 2020 2063 6162 7378 3d4e 6f6e         cabsx=Non
-0000c8e0: 652c 2063 7265 6c78 3d4e 6f6e 652c 0a20  e, crelx=None,. 
-0000c8f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000c900: 6162 7379 3d4e 6f6e 652c 2063 7265 6c79  absy=None, crely
-0000c910: 3d4e 6f6e 6529 3a0a 0a20 2020 2022 2222  =None):..    """
-0000c920: 696e 6974 6961 6c69 7a65 2064 6174 6120  initialize data 
-0000c930: 6f62 6a65 6374 0a0a 2020 2020 4172 6773  object..    Args
-0000c940: 3a0a 2020 2020 2020 2d20 2078 3a20 2020  :.      -  x:   
-0000c950: 2020 2020 6162 7363 6973 7361 206f 6620      abscissa of 
-0000c960: 6461 7461 2070 6f69 6e74 7320 2822 7820  data points ("x 
-0000c970: 7661 6c75 6573 2229 0a20 2020 2020 202d  values").      -
-0000c980: 2020 793a 2020 2020 2020 206f 7264 696e    y:       ordin
-0000c990: 6174 6520 6f66 2064 6174 6120 706f 696e  ate of data poin
-0000c9a0: 7473 2028 2279 2076 616c 7565 7322 290a  ts ("y values").
-0000c9b0: 2020 2020 2020 2d20 2065 783a 2020 2020        -  ex:    
-0000c9c0: 2020 696e 6465 7065 6e64 656e 7420 756e    independent un
-0000c9d0: 6365 7274 6169 6e74 6965 7320 780a 2020  certainties x.  
-0000c9e0: 2020 2020 2d20 2065 793a 2020 2020 2020      -  ey:      
-0000c9f0: 696e 6465 7065 6e64 656e 7420 756e 6365  independent unce
-0000ca00: 7274 6169 6e74 6965 7320 790a 2020 2020  rtainties y.    
-0000ca10: 2020 2d20 2065 7265 6c78 3a20 2020 696e    -  erelx:   in
-0000ca20: 6465 7065 6e64 656e 7420 7265 6c61 7469  dependent relati
-0000ca30: 7665 2075 6e63 6572 7461 696e 7469 6573  ve uncertainties
-0000ca40: 2078 0a20 2020 2020 202d 2020 6572 656c   x.      -  erel
-0000ca50: 793a 2020 2069 6e64 6570 656e 6465 6e74  y:   independent
-0000ca60: 2072 656c 6174 6976 6520 756e 6365 7274   relative uncert
-0000ca70: 6169 6e74 6965 7320 790a 2020 2020 2020  ainties y.      
-0000ca80: 2d20 2063 6162 7378 3a20 2020 636f 7272  -  cabsx:   corr
-0000ca90: 656c 6174 6564 2061 626f 6c75 7465 2075  elated abolute u
-0000caa0: 6e63 6572 7461 696e 7469 6573 2078 0a20  ncertainties x. 
-0000cab0: 2020 2020 202d 2020 6372 656c 783a 2020       -  crelx:  
-0000cac0: 2063 6f72 7265 6c61 7465 6420 7265 6c61   correlated rela
-0000cad0: 7469 7665 2075 6e63 6572 7461 696e 7469  tive uncertainti
-0000cae0: 6573 2078 0a20 2020 2020 202d 2020 6361  es x.      -  ca
-0000caf0: 6273 793a 2020 2063 6f72 7265 6c61 7465  bsy:   correlate
-0000cb00: 6420 6162 736f 6c75 7465 2075 6e63 6572  d absolute uncer
-0000cb10: 7461 696e 7469 6573 2079 0a20 2020 2020  tainties y.     
-0000cb20: 202d 2020 6372 656c 793a 2020 2063 6f72   -  crely:   cor
-0000cb30: 7265 6c61 7465 6420 7265 6c61 7469 7665  related relative
-0000cb40: 2075 6e63 6572 7461 696e 7469 6573 2079   uncertainties y
-0000cb50: 0a20 2020 2020 202d 2020 7175 6965 743a  .      -  quiet:
-0000cb60: 2020 206e 6f20 696e 666f 726d 6174 6976     no informativ
-0000cb70: 6520 7072 696e 746f 7574 2069 6620 5472  e printout if Tr
-0000cb80: 7565 0a20 2020 2022 2222 0a20 2020 200a  ue.    """.    .
-0000cb90: 2020 2020 2320 6372 6561 7465 2064 6174      # create dat
-0000cba0: 6120 6f62 6a65 6374 2061 6e64 2070 6173  a object and pas
-0000cbb0: 7320 616c 6c20 696e 7075 7420 6172 6775  s all input argu
-0000cbc0: 6d65 6e74 730a 2020 2020 7365 6c66 2e78  ments.    self.x
-0000cbd0: 7944 6174 6120 3d20 7365 6c66 2e78 7944  yData = self.xyD
-0000cbe0: 6174 6143 6f6e 7461 696e 6572 2873 656c  ataContainer(sel
-0000cbf0: 662c 2078 2c20 792c 2065 782c 2065 792c  f, x, y, ex, ey,
-0000cc00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cc10: 2020 2020 2065 7265 6c78 2c20 6572 656c       erelx, erel
-0000cc20: 792c 2063 6162 7378 2c20 6372 656c 782c  y, cabsx, crelx,
-0000cc30: 2063 6162 7379 2c20 6372 656c 792c 0a20   cabsy, crely,. 
-0000cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc50: 2020 2071 7569 6574 3d73 656c 662e 7175     quiet=self.qu
-0000cc60: 6965 7429 0a20 2020 2073 656c 662e 6461  iet).    self.da
-0000cc70: 7461 203d 2073 656c 662e 7879 4461 7461  ta = self.xyData
-0000cc80: 0a20 2020 2023 2073 6574 2066 6c61 6773  .    # set flags
-0000cc90: 2066 6f72 2073 7465 6572 696e 6720 6f66   for steering of
-0000cca0: 2066 6974 2070 726f 6365 7373 2069 6e20   fit process in 
-0000ccb0: 646f 5f66 6974 2829 0a20 2020 2073 656c  do_fit().    sel
-0000ccc0: 662e 6974 6572 6174 6546 6974 203d 2073  f.iterateFit = s
-0000ccd0: 656c 662e 7879 4461 7461 2e68 6173 5f78  elf.xyData.has_x
-0000cce0: 4572 726f 7273 206f 7228 0a20 2020 2020  Errors or(.     
-0000ccf0: 2020 2020 7365 6c66 2e78 7944 6174 612e      self.xyData.
-0000cd00: 6861 735f 7265 6c5f 7945 7272 6f72 7320  has_rel_yErrors 
-0000cd10: 616e 6420 7365 6c66 2e72 6566 4d6f 6465  and self.refMode
-0000cd20: 6c29 0a0a 0a20 2064 6566 2069 6e69 745f  l)...  def init_
-0000cd30: 7879 4669 7428 7365 6c66 2c20 6d6f 6465  xyFit(self, mode
-0000cd40: 6c2c 206d 6f64 656c 5f6b 7761 7267 733d  l, model_kwargs=
-0000cd50: 4e6f 6e65 2c20 7030 3d4e 6f6e 652c 2064  None, p0=None, d
-0000cd60: 7030 3d4e 6f6e 652c 200a 2020 2020 2020  p0=None, .      
-0000cd70: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
-0000cd80: 7261 696e 7473 3d4e 6f6e 652c 0a20 2020  raints=None,.   
-0000cd90: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000cda0: 7850 6172 733d 4e6f 6e65 2c0a 2020 2020  xPars=None,.    
-0000cdb0: 2020 2020 2020 2020 2020 2020 206c 696d               lim
-0000cdc0: 6974 733d 4e6f 6e65 293a 0a20 2020 2022  its=None):.    "
-0000cdd0: 2222 696e 6974 6961 6c69 7a65 2066 6974  ""initialize fit
-0000cde0: 206f 626a 6563 740a 0a20 2020 2041 7267   object..    Arg
-0000cdf0: 733a 0a20 2020 2020 202d 206d 6f64 656c  s:.      - model
-0000ce00: 3a20 6d6f 6465 6c20 6675 6e63 7469 6f6e  : model function
-0000ce10: 2066 2878 3b20 5c2a 7061 7229 0a20 2020   f(x; \*par).   
-0000ce20: 2020 202d 206d 6f64 656c 5f6b 7761 7267     - model_kwarg
-0000ce30: 733a 206f 7074 696f 6e61 6c2c 2066 6974  s: optional, fit
-0000ce40: 2070 6172 616d 6574 6572 7320 6966 206e   parameters if n
-0000ce50: 6f74 2066 726f 6d20 6d6f 6465 6c20 7369  ot from model si
-0000ce60: 676e 6174 7572 6520 0a20 2020 2020 202d  gnature .      -
-0000ce70: 2070 303a 206e 702d 6172 7261 7920 6f66   p0: np-array of
-0000ce80: 2066 6c6f 6174 732c 2069 6e69 7469 616c   floats, initial
-0000ce90: 2070 6172 616d 6574 6572 2076 616c 7565   parameter value
-0000cea0: 7320 0a20 2020 2020 202d 2064 7030 3a20  s .      - dp0: 
-0000ceb0: 6172 7261 792d 6c69 6b65 2c20 696e 6974  array-like, init
-0000cec0: 6961 6c20 6775 6573 7320 6f66 2070 6172  ial guess of par
-0000ced0: 616d 6574 6572 2075 6e63 6572 7461 696e  ameter uncertain
-0000cee0: 7469 6573 2028 6f70 7469 6f6e 616c 290a  ties (optional).
-0000cef0: 2020 2020 2020 2d20 636f 6e73 7472 6169        - constrai
-0000cf00: 6e74 733a 2028 6e65 7374 6564 2920 6c69  nts: (nested) li
-0000cf10: 7374 2873 293a 205b 7061 7261 6d65 7465  st(s): [paramete
-0000cf20: 7220 6e61 6d65 2c20 7661 6c75 652c 2075  r name, value, u
-0000cf30: 6e63 6572 7461 696e 7479 5d20 0a20 2020  ncertainty] .   
-0000cf40: 2020 2020 206f 7220 5b70 6172 616d 6574       or [paramet
-0000cf50: 6572 2069 6e64 6578 2c20 7661 6c75 652c  er index, value,
-0000cf60: 2075 6e63 6572 7461 696e 7479 5d0a 2020   uncertainty].  
-0000cf70: 2020 2020 2d20 6c69 6d69 7473 3a20 286e      - limits: (n
-0000cf80: 6573 7465 6429 206c 6973 7428 7329 3a20  ested) list(s): 
-0000cf90: 5b70 6172 616d 6574 6572 206e 616d 652c  [parameter name,
-0000cfa0: 206d 696e 2c20 6d61 785d 200a 2020 2020   min, max] .    
-0000cfb0: 2020 2020 6f72 205b 7061 7261 6d65 7465      or [paramete
-0000cfc0: 7220 696e 6465 782c 206d 696e 2c20 6d61  r index, min, ma
-0000cfd0: 785d 0a20 2020 2022 2222 0a0a 2020 2020  x].    """..    
-0000cfe0: 6966 2073 656c 662e 7879 4461 7461 2069  if self.xyData i
-0000cff0: 7320 4e6f 6e65 3a0a 2020 2020 2020 7261  s None:.      ra
-0000d000: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
-0000d010: 2020 2020 2020 2020 2720 2121 2120 6d6e          ' !!! mn
-0000d020: 4669 742e 696e 6974 5f78 7946 6974 3a20  Fit.init_xyFit: 
-0000d030: 6e6f 2064 6174 6120 6f62 6a65 6374 2064  no data object d
-0000d040: 6566 696e 6564 202d 2063 616c 6c20 696e  efined - call in
-0000d050: 6974 5f64 6174 6128 2927 290a 0a20 2020  it_data()')..   
-0000d060: 2023 2067 6574 2070 6172 616d 6574 6572   # get parameter
-0000d070: 7320 6f66 206d 6f64 656c 2066 756e 6374  s of model funct
-0000d080: 696f 6e20 746f 2073 6574 2073 7461 7274  ion to set start
-0000d090: 2076 616c 7565 7320 666f 7220 6669 740a   values for fit.
-0000d0a0: 2020 2020 6966 206d 6f64 656c 5f6b 7761      if model_kwa
-0000d0b0: 7267 7320 6973 204e 6f6e 653a 0a20 2020  rgs is None:.   
-0000d0c0: 2020 2061 7267 732c 206d 6f64 656c 5f6b     args, model_k
-0000d0d0: 7761 7267 7320 3d20 6765 745f 6675 6e63  wargs = get_func
-0000d0e0: 7469 6f6e 5369 676e 6174 7572 6528 6d6f  tionSignature(mo
-0000d0f0: 6465 6c29 0a0a 2020 2020 7061 7220 3d20  del)..    par = 
-0000d100: 286d 6f64 656c 5f6b 7761 7267 732c 2070  (model_kwargs, p
-0000d110: 302c 2064 7030 2c20 636f 6e73 7472 6169  0, dp0, constrai
-0000d120: 6e74 732c 2066 6978 5061 7273 2c20 6c69  nts, fixPars, li
-0000d130: 6d69 7473 290a 2020 2020 7365 6c66 2e5f  mits).    self._
-0000d140: 7365 7475 7046 6974 5061 7261 6d65 7465  setupFitParamete
-0000d150: 7273 282a 7061 7229 200a 0a20 2020 2023  rs(*par) ..    #
-0000d160: 2063 7265 6174 6520 636f 7374 2066 756e   create cost fun
-0000d170: 6374 696f 6e0a 2020 2020 7365 6c66 2e63  ction.    self.c
-0000d180: 6f73 7466 203d 2073 656c 662e 784c 5371  ostf = self.xLSq
-0000d190: 436f 7374 2873 656c 662c 0a20 2020 2020  Cost(self,.     
-0000d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1b0: 2020 2020 2020 6d6f 6465 6c2c 0a20 2020        model,.   
-0000d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1d0: 2020 2020 2020 2020 7573 655f 6e65 6732          use_neg2
-0000d1e0: 6c6f 674c 3d20 7365 6c66 2e75 7365 5f6e  logL= self.use_n
-0000d1f0: 6567 4c6f 674c 290a 2020 2020 7365 6c66  egLogL).    self
-0000d200: 2e5f 7365 7475 704d 696e 7569 7428 6d6f  ._setupMinuit(mo
-0000d210: 6465 6c5f 6b77 6172 6773 2920 0a0a 2020  del_kwargs) ..  
-0000d220: 2020 2020 0a20 2063 6c61 7373 2078 7944      .  class xyD
-0000d230: 6174 6143 6f6e 7461 696e 6572 3a0a 2020  ataContainer:.  
-0000d240: 2020 2222 220a 2020 2020 4861 6e64 6c65    """.    Handle
-0000d250: 2064 6174 6120 616e 6420 756e 6365 7274   data and uncert
-0000d260: 6169 6e74 6965 7320 616e 6420 200a 2020  ainties and  .  
-0000d270: 2020 6275 696c 6420 636f 7661 7269 616e    build covarian
-0000d280: 6365 206d 6174 7269 6365 7320 6672 6f6d  ce matrices from
-0000d290: 2063 6f6d 706f 6e65 6e74 730a 0a20 2020   components..   
-0000d2a0: 2041 7267 733a 0a20 2020 2020 202d 206f   Args:.      - o
-0000d2b0: 7574 6572 3a20 2020 706f 696e 7465 7220  uter:   pointer 
-0000d2c0: 746f 2069 6e73 7461 6e63 6520 6f66 2063  to instance of c
-0000d2d0: 616c 6c69 6e67 206f 626a 6563 740a 2020  alling object.  
-0000d2e0: 2020 2020 2d20 783a 2020 2020 2020 2061      - x:       a
-0000d2f0: 6273 6369 7373 6120 6f66 2064 6174 6120  bscissa of data 
-0000d300: 706f 696e 7473 2028 2278 2076 616c 7565  points ("x value
-0000d310: 7322 290a 2020 2020 2020 2d20 793a 2020  s").      - y:  
-0000d320: 2020 2020 206f 7264 696e 6174 6520 6f66       ordinate of
-0000d330: 2064 6174 6120 706f 696e 7473 2028 2279   data points ("y
-0000d340: 2076 616c 7565 7322 290a 2020 2020 2020   values").      
-0000d350: 2d20 6578 3a20 2020 2020 2069 6e64 6570  - ex:      indep
-0000d360: 656e 6465 6e74 2075 6e63 6572 7461 696e  endent uncertain
-0000d370: 7469 6573 2078 0a20 2020 2020 202d 2065  ties x.      - e
-0000d380: 793a 2020 2020 2020 696e 6465 7065 6e64  y:      independ
-0000d390: 656e 7420 756e 6365 7274 6169 6e74 6965  ent uncertaintie
-0000d3a0: 7320 790a 2020 2020 2020 2d20 6572 656c  s y.      - erel
-0000d3b0: 783a 2020 2069 6e64 6570 656e 6465 6e74  x:   independent
-0000d3c0: 2072 656c 6174 6976 6520 756e 6365 7274   relative uncert
-0000d3d0: 6169 6e74 6965 7320 780a 2020 2020 2020  ainties x.      
-0000d3e0: 2d20 6572 656c 793a 2020 2069 6e64 6570  - erely:   indep
-0000d3f0: 656e 6465 6e74 2072 656c 6174 6976 6520  endent relative 
-0000d400: 756e 6365 7274 6169 6e74 6965 7320 790a  uncertainties y.
-0000d410: 2020 2020 2020 2d20 6361 6273 783a 2020        - cabsx:  
-0000d420: 2063 6f72 7265 6c61 7465 6420 6162 6f6c   correlated abol
-0000d430: 7574 6520 756e 6365 7274 6169 6e74 6965  ute uncertaintie
-0000d440: 7320 780a 2020 2020 2020 2d20 6372 656c  s x.      - crel
-0000d450: 783a 2020 2063 6f72 7265 6c61 7465 6420  x:   correlated 
-0000d460: 7265 6c61 7469 7665 2075 6e63 6572 7461  relative uncerta
-0000d470: 696e 7469 6573 2078 0a20 2020 2020 202d  inties x.      -
-0000d480: 2063 6162 7379 3a20 2020 636f 7272 656c   cabsy:   correl
-0000d490: 6174 6564 2061 6273 6f6c 7574 6520 756e  ated absolute un
-0000d4a0: 6365 7274 6169 6e74 6965 7320 790a 2020  certainties y.  
-0000d4b0: 2020 2020 2d20 6372 656c 793a 2020 2063      - crely:   c
-0000d4c0: 6f72 7265 6c61 7465 6420 7265 6c61 7469  orrelated relati
-0000d4d0: 7665 2075 6e63 6572 7461 696e 7469 6573  ve uncertainties
-0000d4e0: 2079 0a20 2020 2020 202d 2071 7569 6574   y.      - quiet
-0000d4f0: 3a20 2020 6e6f 2069 6e66 6f72 6d61 7469  :   no informati
-0000d500: 7665 2070 7269 6e74 6f75 7420 6966 2054  ve printout if T
-0000d510: 7275 650a 0a20 2020 2050 7562 6c69 6320  rue..    Public 
-0000d520: 6d65 7468 6f64 733a 0a20 2020 2020 202d  methods:.      -
-0000d530: 2069 6e69 745f 6479 6e61 6d69 6345 7272   init_dynamicErr
-0000d540: 6f72 7328 293a 0a20 2020 2020 202d 2067  ors():.      - g
-0000d550: 6574 5f43 6f76 2829 3a20 6669 6e61 6c20  et_Cov(): final 
-0000d560: 636f 7661 7269 616e 6365 206d 6174 7269  covariance matri
-0000d570: 7820 2869 6e63 6c2e 2070 726f 6a2e 2078  x (incl. proj. x
-0000d580: 2920 200a 2020 2020 2020 2d20 6765 745f  )  .      - get_
-0000d590: 7843 6f76 2829 3a20 636f 7661 7269 616e  xCov(): covarian
-0000d5a0: 6365 206f 6620 782d 7661 6c75 6573 0a20  ce of x-values. 
-0000d5b0: 2020 2020 202d 2067 6574 5f79 436f 7628       - get_yCov(
-0000d5c0: 293a 2063 6f76 6172 6961 6e63 6520 6f66  ): covariance of
-0000d5d0: 2079 2d76 616c 7565 730a 2020 2020 2020   y-values.      
-0000d5e0: 2d20 6765 745f 6943 6f76 2829 3a20 696e  - get_iCov(): in
-0000d5f0: 7665 7273 6520 636f 7661 7269 616e 6365  verse covariance
-0000d600: 206d 6174 7269 780a 2020 2020 2020 2d20   matrix.      - 
-0000d610: 706c 6f74 2829 3a20 7072 6f76 6964 6520  plot(): provide 
-0000d620: 6120 6669 6775 7265 2077 6974 6820 7265  a figure with re
-0000d630: 7072 6573 656e 7461 7469 6f6e 206f 6620  presentation of 
-0000d640: 6461 7461 0a20 0a20 2020 2044 6174 6120  data. .    Data 
-0000d650: 6d65 6d62 6572 733a 2020 0a20 2020 2020  members:  .     
-0000d660: 202a 2063 6f70 7920 6f66 2061 6c6c 2069   * copy of all i
-0000d670: 6e70 7574 2061 7267 756d 656e 7473 0a20  nput arguments. 
-0000d680: 2020 2020 202a 2063 6f76 783a 2063 6f76       * covx: cov
-0000d690: 6172 6961 6e63 6520 6d61 7472 6978 206f  ariance matrix o
-0000d6a0: 6620 780a 2020 2020 2020 2a20 636f 7679  f x.      * covy
-0000d6b0: 3a20 636f 7661 7269 616e 6365 206d 6174  : covariance mat
-0000d6c0: 7269 7820 6f66 2079 2075 6e63 6572 7461  rix of y uncerta
-0000d6d0: 696e 7469 6573 0a20 2020 2020 202a 2063  inties.      * c
-0000d6e0: 6f76 3a20 6675 6c6c 2063 6f76 6172 6961  ov: full covaria
-0000d6f0: 6e63 6520 6d61 7472 6978 2069 6e63 6c2e  nce matrix incl.
-0000d700: 2070 726f 6a65 6374 6564 2078 0a20 2020   projected x.   
-0000d710: 2020 202a 2069 436f 763a 2069 6e76 6572     * iCov: inver
-0000d720: 7365 206f 6620 636f 7661 7269 616e 6365  se of covariance
-0000d730: 206d 6174 7269 780a 2020 2020 2222 220a   matrix.    """.
-0000d740: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-0000d750: 2873 656c 662c 206f 7574 6572 2c0a 2020  (self, outer,.  
-0000d760: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0000d770: 2c20 792c 2065 782c 2065 792c 0a20 2020  , y, ex, ey,.   
-0000d780: 2020 2020 2020 2020 2020 2020 2020 6572                er
-0000d790: 656c 782c 2065 7265 6c79 2c20 6361 6273  elx, erely, cabs
-0000d7a0: 782c 2063 7265 6c78 2c20 6361 6273 792c  x, crelx, cabsy,
-0000d7b0: 2063 7265 6c79 2c0a 2020 2020 2020 2020   crely,.        
-0000d7c0: 2020 2020 2020 2020 2071 7569 6574 3d54           quiet=T
-0000d7d0: 7275 6529 3a0a 2020 2020 2020 2320 7361  rue):.      # sa
-0000d7e0: 7665 2070 6f69 6e65 7220 746f 2063 616c  ve poiner to cal
-0000d7f0: 6c69 6e67 2063 6c61 7373 0a20 2020 2020  ling class.     
-0000d800: 2073 656c 662e 6f75 7465 7220 3d20 6f75   self.outer = ou
-0000d810: 7465 720a 0a20 2020 2020 2023 2061 7373  ter..      # ass
-0000d820: 756d 6520 7369 6d70 6c65 2063 6173 6520  ume simple case 
-0000d830: 772e 6f2e 2063 6f76 2e6d 6174 2e0a 2020  w.o. cov.mat..  
-0000d840: 2020 2020 7365 6c66 2e6e 6565 6473 5f63      self.needs_c
-0000d850: 6f76 6172 6961 6e63 6520 3d20 4661 6c73  ovariance = Fals
-0000d860: 6520 0a0a 2020 2020 2020 6e64 203d 206c  e ..      nd = l
-0000d870: 656e 2878 2920 2020 2020 200a 2020 2020  en(x)      .    
-0000d880: 2020 2320 7374 6f72 6520 696e 7075 7420    # store input 
-0000d890: 6461 7461 2061 7320 6e75 6d70 7920 666c  data as numpy fl
-0000d8a0: 6f61 7420 6172 7261 7973 2c20 656e 7375  oat arrays, ensu
-0000d8b0: 7265 206c 656e 6774 6820 6e64 2069 6620  re length nd if 
-0000d8c0: 6e65 6564 6564 0a20 2020 2020 2073 656c  needed.      sel
-0000d8d0: 662e 646c 656e 6774 6820 3d20 6e64 0a20  f.dlength = nd. 
-0000d8e0: 2020 2020 2073 656c 662e 7820 3d20 6e70       self.x = np
-0000d8f0: 2e61 7366 6172 7261 7928 7829 2020 2020  .asfarray(x)    
-0000d900: 2020 2020 2023 2061 6273 6369 7373 6120       # abscissa 
-0000d910: 2d20 2278 2076 616c 7565 7322 0a20 2020  - "x values".   
-0000d920: 2020 2073 656c 662e 7920 3d20 6e70 2e61     self.y = np.a
-0000d930: 7366 6172 7261 7928 7929 2020 2020 2020  sfarray(y)      
-0000d940: 2020 2023 206f 7264 696e 6174 6520 2d20     # ordinate - 
-0000d950: 2279 2076 616c 7565 7322 0a20 2020 2020  "y values".     
-0000d960: 2069 6620 6578 2069 7320 6e6f 7420 4e6f   if ex is not No
-0000d970: 6e65 3a0a 2020 2020 2020 2020 7365 6c66  ne:.        self
-0000d980: 2e65 7820 3d20 6e70 2e61 7366 6172 7261  .ex = np.asfarra
-0000d990: 7928 6578 2920 2020 2020 2020 2320 696e  y(ex)       # in
-0000d9a0: 6465 7065 6e64 656e 7420 756e 6365 7274  dependent uncert
-0000d9b0: 6169 6e74 6965 7320 780a 2020 2020 2020  ainties x.      
-0000d9c0: 2020 6966 2073 656c 662e 6578 2e6e 6469    if self.ex.ndi
-0000d9d0: 6d20 3d3d 2030 3a0a 2020 2020 2020 2020  m == 0:.        
-0000d9e0: 2020 7365 6c66 2e65 7820 3d20 7365 6c66    self.ex = self
-0000d9f0: 2e65 7820 2a20 6e70 2e6f 6e65 7328 6e64  .ex * np.ones(nd
-0000da00: 290a 2020 2020 2020 2020 656c 6966 2073  ).        elif s
-0000da10: 656c 662e 6578 2e6e 6469 6d20 3d3d 2032  elf.ex.ndim == 2
-0000da20: 3a0a 2020 2020 2020 2020 2020 7365 6c66  :.          self
-0000da30: 2e6e 6565 6473 5f63 6f76 6172 6961 6e63  .needs_covarianc
-0000da40: 653d 5472 7565 0a20 2020 2020 2065 6c73  e=True.      els
-0000da50: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
-0000da60: 6578 203d 204e 6f6e 650a 2020 2020 2020  ex = None.      
-0000da70: 6966 2065 7920 6973 206e 6f74 204e 6f6e  if ey is not Non
-0000da80: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
-0000da90: 6579 203d 206e 702e 6173 6661 7272 6179  ey = np.asfarray
-0000daa0: 2865 7929 2020 2020 2020 2023 2069 6e64  (ey)       # ind
-0000dab0: 6570 656e 6465 6e74 2075 6e63 6572 7461  ependent uncerta
-0000dac0: 696e 7469 6573 2079 0a20 2020 2020 2020  inties y.       
-0000dad0: 2069 6620 7365 6c66 2e65 792e 6e64 696d   if self.ey.ndim
-0000dae0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000daf0: 2073 656c 662e 6579 203d 2073 656c 662e   self.ey = self.
-0000db00: 6579 202a 206e 702e 6f6e 6573 286e 6429  ey * np.ones(nd)
-0000db10: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
-0000db20: 6c66 2e65 792e 6e64 696d 203d 3d20 323a  lf.ey.ndim == 2:
-0000db30: 0a20 2020 2020 2020 2020 2073 656c 662e  .          self.
-0000db40: 6e65 6564 735f 636f 7661 7269 616e 6365  needs_covariance
-0000db50: 3d54 7275 650a 2020 2020 2020 656c 7365  =True.      else
-0000db60: 3a0a 2020 2020 2020 2020 7365 6c66 2e65  :.        self.e
-0000db70: 7920 3d20 4e6f 6e65 0a20 2020 2020 2069  y = None.      i
-0000db80: 6620 6572 656c 7820 6973 206e 6f74 204e  f erelx is not N
-0000db90: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
-0000dba0: 662e 6572 656c 7820 3d20 6e70 2e61 7366  f.erelx = np.asf
-0000dbb0: 6172 7261 7928 6572 656c 7829 2023 2069  array(erelx) # i
-0000dbc0: 6e64 6570 656e 6465 6e74 2072 656c 6174  ndependent relat
-0000dbd0: 6976 6520 756e 6365 7274 6169 6e74 6965  ive uncertaintie
-0000dbe0: 7320 780a 2020 2020 2020 656c 7365 3a0a  s x.      else:.
-0000dbf0: 2020 2020 2020 2020 7365 6c66 2e65 7265          self.ere
-0000dc00: 6c78 203d 204e 6f6e 650a 2020 2020 2020  lx = None.      
-0000dc10: 6966 2065 7265 6c79 2069 7320 6e6f 7420  if erely is not 
-0000dc20: 4e6f 6e65 3a0a 2020 2020 2020 2020 7365  None:.        se
-0000dc30: 6c66 2e65 7265 6c79 203d 206e 702e 6173  lf.erely = np.as
-0000dc40: 6661 7272 6179 2865 7265 6c79 2920 2320  farray(erely) # 
-0000dc50: 696e 6465 7065 6e64 656e 7420 7265 6c61  independent rela
-0000dc60: 7469 7665 2075 6e63 6572 7461 696e 7469  tive uncertainti
-0000dc70: 6573 2079 0a20 2020 2020 2065 6c73 653a  es y.      else:
-0000dc80: 0a20 2020 2020 2020 2073 656c 662e 6572  .        self.er
-0000dc90: 656c 7920 3d20 4e6f 6e65 0a20 2020 2020  ely = None.     
-0000dca0: 2069 6620 6361 6273 7820 6973 206e 6f74   if cabsx is not
-0000dcb0: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
-0000dcc0: 656c 662e 6361 6273 7820 3d20 6e70 2e61  elf.cabsx = np.a
-0000dcd0: 7366 6172 7261 7928 6361 6273 7829 2023  sfarray(cabsx) #
-0000dce0: 2063 6f72 7265 6c61 7465 6420 6162 6f6c   correlated abol
-0000dcf0: 7574 6520 756e 6365 7274 6169 6e74 6965  ute uncertaintie
-0000dd00: 7320 780a 2020 2020 2020 2020 6966 2073  s x.        if s
-0000dd10: 656c 662e 6361 6273 782e 6e64 696d 203d  elf.cabsx.ndim =
-0000dd20: 3d20 303a 0a20 2020 2020 2020 2020 2073  = 0:.          s
-0000dd30: 656c 662e 6361 6273 7820 3d20 7365 6c66  elf.cabsx = self
-0000dd40: 2e63 6162 7378 202a 206e 702e 6f6e 6573  .cabsx * np.ones
-0000dd50: 286e 6429 0a20 2020 2020 2065 6c73 653a  (nd).      else:
-0000dd60: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
-0000dd70: 6273 7820 3d20 4e6f 6e65 0a20 2020 2020  bsx = None.     
-0000dd80: 2069 6620 6372 656c 7820 6973 206e 6f74   if crelx is not
-0000dd90: 204e 6f6e 653a 2020 200a 2020 2020 2020   None:   .      
-0000dda0: 2020 7365 6c66 2e63 7265 6c78 203d 206e    self.crelx = n
-0000ddb0: 702e 6173 6661 7272 6179 2863 7265 6c78  p.asfarray(crelx
-0000ddc0: 2920 2320 636f 7272 656c 6174 6564 2072  ) # correlated r
-0000ddd0: 656c 6174 6976 6520 756e 6365 7274 6169  elative uncertai
-0000dde0: 6e74 6965 7320 780a 2020 2020 2020 656c  nties x.      el
-0000ddf0: 7365 3a0a 2020 2020 2020 2020 7365 6c66  se:.        self
-0000de00: 2e63 7265 6c78 203d 204e 6f6e 650a 2020  .crelx = None.  
-0000de10: 2020 2020 6966 2063 6162 7379 2069 7320      if cabsy is 
-0000de20: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000de30: 2020 7365 6c66 2e63 6162 7379 203d 206e    self.cabsy = n
-0000de40: 702e 6173 6661 7272 6179 2863 6162 7379  p.asfarray(cabsy
-0000de50: 2920 2320 636f 7272 656c 6174 6564 2061  ) # correlated a
-0000de60: 6273 6f6c 7574 6520 756e 6365 7274 6169  bsolute uncertai
-0000de70: 6e74 6965 7320 790a 2020 2020 2020 2020  nties y.        
-0000de80: 6966 2073 656c 662e 6361 6273 792e 6e64  if self.cabsy.nd
-0000de90: 696d 203d 3d20 303a 0a20 2020 2020 2020  im == 0:.       
-0000dea0: 2020 2073 656c 662e 6361 6273 7920 3d20     self.cabsy = 
-0000deb0: 7365 6c66 2e63 6162 7379 202a 206e 702e  self.cabsy * np.
-0000dec0: 6f6e 6573 286e 6429 0a20 2020 2020 2065  ones(nd).      e
-0000ded0: 6c73 653a 0a20 2020 2020 2020 2073 656c  lse:.        sel
-0000dee0: 662e 6361 6273 7920 3d20 4e6f 6e65 0a20  f.cabsy = None. 
-0000def0: 2020 2020 2069 6620 6372 656c 7920 6973       if crely is
-0000df00: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000df10: 2020 2073 656c 662e 6372 656c 7920 3d20     self.crely = 
-0000df20: 6e70 2e61 7366 6172 7261 7928 6372 656c  np.asfarray(crel
-0000df30: 7929 2023 2063 6f72 7265 6c61 7465 6420  y) # correlated 
-0000df40: 7265 6c61 7469 7665 2075 6e63 6572 7461  relative uncerta
-0000df50: 696e 7469 6573 2079 0a20 2020 2020 2065  inties y.      e
-0000df60: 6c73 653a 0a20 2020 2020 2020 2073 656c  lse:.        sel
-0000df70: 662e 6372 656c 7920 3d20 4e6f 6e65 0a20  f.crely = None. 
-0000df80: 2020 2020 2073 656c 662e 7175 6965 7420       self.quiet 
-0000df90: 3d20 7175 6965 7420 2020 2020 2023 206e  = quiet      # n
-0000dfa0: 6f20 696e 666f 726d 6174 6976 6520 7072  o informative pr
-0000dfb0: 696e 746f 7574 2069 6620 5472 7565 0a0a  intout if True..
-0000dfc0: 2020 2020 2020 7365 6c66 2e6e 6420 3d20        self.nd = 
-0000dfd0: 6e64 0a20 2020 2020 2073 656c 662e 6d6f  nd.      self.mo
-0000dfe0: 6465 6c20 3d20 4e6f 6e65 2023 206e 6f20  del = None # no 
-0000dff0: 6d6f 6465 6c20 6465 6669 6e65 6420 7965  model defined ye
-0000e000: 740a 2020 2020 2020 7365 6c66 2e6d 6f64  t.      self.mod
-0000e010: 656c 5f76 616c 7565 7320 3d20 4e6f 6e65  el_values = None
-0000e020: 0a0a 2020 2020 2020 2320 7365 7420 666c  ..      # set fl
-0000e030: 6167 7320 666f 7220 7374 6565 7269 6e67  ags for steering
-0000e040: 206f 6620 6669 7420 7072 6f63 6573 7320   of fit process 
-0000e050: 696e 2064 6f5f 6669 7428 290a 2020 2020  in do_fit().    
-0000e060: 2020 7365 6c66 2e72 6562 756c 696c 6443    self.rebulildC
-0000e070: 6f76 203d 204e 6f6e 650a 2020 2020 2020  ov = None.      
-0000e080: 7365 6c66 2e68 6173 5f78 4572 726f 7273  self.has_xErrors
-0000e090: 203d 2065 7820 6973 206e 6f74 204e 6f6e   = ex is not Non
-0000e0a0: 6520 6f72 2065 7265 6c78 2069 7320 6e6f  e or erelx is no
-0000e0b0: 7420 4e6f 6e65 205c 0a20 2020 2020 2020  t None \.       
-0000e0c0: 206f 7220 6361 6273 7820 6973 206e 6f74   or cabsx is not
-0000e0d0: 204e 6f6e 6520 6f72 2063 7265 6c78 2069   None or crelx i
-0000e0e0: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
-0000e0f0: 2073 656c 662e 6861 735f 7265 6c5f 7945   self.has_rel_yE
-0000e100: 7272 6f72 7320 3d20 6572 656c 7920 6973  rrors = erely is
-0000e110: 206e 6f74 204e 6f6e 6520 6f72 2063 7265   not None or cre
-0000e120: 6c79 2069 7320 6e6f 7420 4e6f 6e65 0a20  ly is not None. 
-0000e130: 2020 2020 2073 656c 662e 6e65 6564 735f       self.needs_
-0000e140: 636f 7661 7269 616e 6365 203d 2073 656c  covariance = sel
-0000e150: 662e 6e65 6564 735f 636f 7661 7269 616e  f.needs_covarian
-0000e160: 6365 206f 7220 5c0a 2020 2020 2020 2020  ce or \.        
-0000e170: 7365 6c66 2e63 6162 7378 2069 7320 6e6f  self.cabsx is no
-0000e180: 7420 4e6f 6e65 206f 7220 7365 6c66 2e63  t None or self.c
-0000e190: 7265 6c78 2069 7320 6e6f 7420 4e6f 6e65  relx is not None
-0000e1a0: 206f 7220 5c0a 2020 2020 2020 2020 7365   or \.        se
-0000e1b0: 6c66 2e63 6162 7379 2069 7320 6e6f 7420  lf.cabsy is not 
-0000e1c0: 4e6f 6e65 206f 7220 7365 6c66 2e63 7265  None or self.cre
-0000e1d0: 6c79 2069 7320 6e6f 7420 4e6f 6e65 200a  ly is not None .
-0000e1e0: 0a20 2020 2020 2023 2062 7569 6c64 2028  .      # build (
-0000e1f0: 696e 6974 6961 6c29 2063 6f76 6172 6961  initial) covaria
-0000e200: 6e63 6520 6d61 7472 6978 2028 7769 7468  nce matrix (with
-0000e210: 6f75 7420 782d 6572 726f 7273 290a 2020  out x-errors).  
-0000e220: 2020 2020 6966 2073 656c 662e 6e65 6564      if self.need
-0000e230: 735f 636f 7661 7269 616e 6365 3a0a 2020  s_covariance:.  
-0000e240: 2020 2020 2020 6572 7232 203d 205f 6275        err2 = _bu
-0000e250: 696c 645f 436f 764d 6174 2873 656c 662e  ild_CovMat(self.
-0000e260: 6e64 2c0a 2020 2020 2020 2020 2020 2020  nd,.            
-0000e270: 2020 2020 2020 2020 7365 6c66 2e65 792c          self.ey,
-0000e280: 2073 656c 662e 6572 656c 792c 2073 656c   self.erely, sel
-0000e290: 662e 6361 6273 792c 2073 656c 662e 6372  f.cabsy, self.cr
-0000e2a0: 656c 792c 2073 656c 662e 7929 0a20 2020  ely, self.y).   
-0000e2b0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000e2c0: 2065 7272 3220 3d20 5f62 7569 6c64 5f45   err2 = _build_E
-0000e2d0: 7272 3228 7365 6c66 2e65 792c 2073 656c  rr2(self.ey, sel
-0000e2e0: 662e 6572 656c 792c 2073 656c 662e 7929  f.erely, self.y)
-0000e2f0: 0a0a 2020 2020 2020 2320 696e 6974 6961  ..      # initia
-0000e300: 6c69 7a65 2075 6e63 6572 7461 696e 7469  lize uncertainti
-0000e310: 6573 2061 6e64 2063 6f76 6172 6961 6e63  es and covarianc
-0000e320: 6520 6d61 7472 6978 2c0a 2020 2020 2020  e matrix,.      
-0000e330: 7365 6c66 2e5f 696e 6974 6961 6c43 6f76  self._initialCov
-0000e340: 2865 7272 3229 0a20 2020 2020 2023 2073  (err2).      # s
-0000e350: 6574 733a 200a 2020 2020 2020 2320 2020  ets: .      #   
-0000e360: 7365 6c66 2e63 6f76 783a 2063 6f76 6172  self.covx: covar
-0000e370: 6961 6e63 6520 6d61 7472 6978 206f 6620  iance matrix of 
-0000e380: 780a 2020 2020 2020 2320 2020 7365 6c66  x.      #   self
-0000e390: 2e63 6f76 793a 2063 6f76 6172 6961 6e63  .covy: covarianc
-0000e3a0: 6520 6d61 7472 6978 206f 6620 7920 756e  e matrix of y un
-0000e3b0: 6365 7274 6169 6e74 6965 730a 2020 2020  certainties.    
-0000e3c0: 2020 2320 2020 7365 6c66 2e63 6f76 3a20    #   self.cov: 
-0000e3d0: 6675 6c6c 2063 6f76 6172 6961 6e63 6520  full covariance 
-0000e3e0: 6d61 7472 6978 2069 6e63 6c2e 2070 726f  matrix incl. pro
-0000e3f0: 6a65 6374 6564 2078 0a20 2020 2020 2023  jected x.      #
-0000e400: 2020 2073 656c 662e 6943 6f76 3a20 696e     self.iCov: in
-0000e410: 7665 7273 6520 6f66 2063 6f76 6172 6961  verse of covaria
-0000e420: 6e63 6520 6d61 7472 6978 0a20 2020 2020  nce matrix.     
-0000e430: 2023 2020 2073 656c 662e 6572 7232 3a20   #   self.err2: 
-0000e440: 6172 7261 7920 6f66 2073 7175 6172 6564  array of squared
-0000e450: 2075 6e63 6572 7461 696e 7469 6573 0a20   uncertainties. 
-0000e460: 2020 2020 2023 2020 2073 656c 662e 6945       #   self.iE
-0000e470: 7272 323a 2031 2e2f 7365 6c66 2e65 7272  rr2: 1./self.err
-0000e480: 320a 2020 2020 2020 0a20 2020 2064 6566  2.      .    def
-0000e490: 205f 696e 6974 6961 6c43 6f76 2873 656c   _initialCov(sel
-0000e4a0: 662c 2065 7272 3229 3a0a 2020 2020 2020  f, err2):.      
-0000e4b0: 2222 2242 7569 6c64 2069 6e69 7469 616c  """Build initial
-0000e4c0: 2028 7374 6174 6963 2920 636f 7661 7269   (static) covari
-0000e4d0: 616e 6365 206d 6174 7269 7820 666f 7220  ance matrix for 
-0000e4e0: 792d 6572 726f 7273 0a20 2020 2020 2028  y-errors.      (
-0000e4f0: 666f 7220 7072 652d 6669 7429 2061 6e64  for pre-fit) and
-0000e500: 2063 616c 6375 6c61 7465 2069 6e76 6572   calculate inver
-0000e510: 7365 206d 6174 7269 780a 2020 2020 2020  se matrix.      
-0000e520: 2222 220a 2020 2020 2020 6966 2065 7272  """.      if err
-0000e530: 322e 6e64 696d 203d 3d20 323a 0a20 2020  2.ndim == 2:.   
-0000e540: 2020 2020 2320 676f 7420 6120 636f 7661      # got a cova
-0000e550: 7269 616e 6365 206d 6174 7269 782c 206e  riance matrix, n
-0000e560: 6565 6420 696e 7665 7273 650a 2020 2020  eed inverse.    
-0000e570: 2020 2020 7365 6c66 2e6e 6565 6473 5f63      self.needs_c
-0000e580: 6f76 6172 6961 6e63 6520 3d20 5472 7565  ovariance = True
-0000e590: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-0000e5a0: 7679 203d 2065 7272 320a 2020 2020 2020  vy = err2.      
-0000e5b0: 2020 7365 6c66 2e69 436f 7620 3d20 6c69    self.iCov = li
-0000e5c0: 6e61 6c67 2e69 6e76 2865 7272 3229 0a20  nalg.inv(err2). 
-0000e5d0: 2020 2020 2020 2073 656c 662e 6572 7232         self.err2
-0000e5e0: 203d 206e 702e 6469 6167 6f6e 616c 2865   = np.diagonal(e
-0000e5f0: 7272 3229 2023 2073 7175 6172 6564 2064  rr2) # squared d
-0000e600: 6961 676f 6e61 6c20 656c 656d 656e 7473  iagonal elements
-0000e610: 0a20 2020 2020 2065 6c73 653a 0a20 2020  .      else:.   
-0000e620: 2020 2023 2067 6f74 2069 6e64 6570 656e     # got indepen
-0000e630: 6465 6e74 2075 6e63 6572 7461 696e 7469  dent uncertainti
-0000e640: 6573 0a20 2020 2020 2020 2073 656c 662e  es.        self.
-0000e650: 6572 7232 203d 2065 7272 320a 2020 2020  err2 = err2.    
-0000e660: 2020 2020 7365 6c66 2e65 7272 3279 203d      self.err2y =
-0000e670: 2065 7272 320a 2020 2020 2020 2020 7365   err2.        se
-0000e680: 6c66 2e69 4572 7232 203d 2031 2e2f 6572  lf.iErr2 = 1./er
-0000e690: 7232 0a20 2020 2020 2020 2073 656c 662e  r2.        self.
-0000e6a0: 636f 7679 203d 206e 702e 6469 6167 2865  covy = np.diag(e
-0000e6b0: 7272 3229 0a20 2020 2020 2020 2073 656c  rr2).        sel
-0000e6c0: 662e 6943 6f76 203d 206e 702e 6469 6167  f.iCov = np.diag
-0000e6d0: 2831 2e2f 7365 6c66 2e65 7272 3229 0a20  (1./self.err2). 
-0000e6e0: 2020 2020 2023 2064 6f20 6e6f 7420 7265       # do not re
-0000e6f0: 6275 696c 6420 636f 7661 7269 616e 6365  build covariance
-0000e700: 206d 6174 7269 7820 696e 2063 6f73 7420   matrix in cost 
-0000e710: 6675 6e63 7469 6f6e 0a20 2020 2020 2073  function.      s
-0000e720: 656c 662e 6e65 6564 735f 6479 6e61 6d69  elf.needs_dynami
-0000e730: 6345 7272 6f72 7320 3d20 4661 6c73 6520  cErrors = False 
-0000e740: 0a0a 2020 2020 2020 2320 6e6f 2063 6f76  ..      # no cov
-0000e750: 6172 6961 6e63 6520 6f66 2078 2d65 7272  ariance of x-err
-0000e760: 6f72 730a 2020 2020 2020 7365 6c66 2e63  ors.      self.c
-0000e770: 6f76 7820 3d20 4e6f 6e65 0a20 2020 2020  ovx = None.     
-0000e780: 2073 656c 662e 6572 7232 7820 3d20 4e6f   self.err2x = No
-0000e790: 6e65 0a20 2020 2020 2023 2074 6f74 616c  ne.      # total
-0000e7a0: 2063 6f76 6172 6961 6e63 6520 6973 2074   covariance is t
-0000e7b0: 6861 7420 6f66 2079 2d65 7272 6f72 730a  hat of y-errors.
-0000e7c0: 2020 2020 2020 7365 6c66 2e63 6f76 203d        self.cov =
-0000e7d0: 2073 656c 662e 636f 7679 2020 2020 2020   self.covy      
-0000e7e0: 0a20 2020 2020 200a 2020 2020 6465 6620  .      .    def 
-0000e7f0: 696e 6974 5f64 796e 616d 6963 4572 726f  init_dynamicErro
-0000e800: 7273 2873 656c 6629 3a0a 2020 2020 2020  rs(self):.      
-0000e810: 2320 6d65 7468 6f64 2074 6f20 7377 6974  # method to swit
-0000e820: 6368 206f 6e20 6479 6e61 6d69 6320 7265  ch on dynamic re
-0000e830: 2d63 616c 6375 6c61 7469 6f6e 206f 6620  -calculation of 
-0000e840: 636f 7661 7269 616e 6365 206d 6174 7269  covariance matri
-0000e850: 7820 0a20 2020 2020 2073 656c 662e 7265  x .      self.re
-0000e860: 665f 746f 4d6f 6465 6c20 3d20 7365 6c66  f_toModel = self
-0000e870: 2e6f 7574 6572 2e72 6566 4d6f 6465 6c0a  .outer.refModel.
-0000e880: 2020 2020 2020 7365 6c66 2e6d 6f64 656c        self.model
-0000e890: 203d 2073 656c 662e 6f75 7465 722e 636f   = self.outer.co
-0000e8a0: 7374 662e 6d6f 6465 6c0a 2020 2020 200a  stf.model.     .
-0000e8b0: 2020 2020 2020 7365 6c66 2e5f 7374 6174        self._stat
-0000e8c0: 6963 436f 7620 3d20 4e6f 6e65 0a20 2020  icCov = None.   
-0000e8d0: 2020 2073 656c 662e 5f73 7461 7469 6345     self._staticE
-0000e8e0: 7272 3220 3d20 4e6f 6e65 0a20 2020 2020  rr2 = None.     
-0000e8f0: 2073 656c 662e 6943 6f76 203d 204e 6f6e   self.iCov = Non
-0000e900: 650a 2020 2020 2020 7365 6c66 2e69 4572  e.      self.iEr
-0000e910: 7232 203d 204e 6f6e 650a 0a20 2020 2020  r2 = None..     
-0000e920: 2023 2072 6562 7569 6c64 2063 6f76 6172   # rebuild covar
-0000e930: 6961 6e63 6520 6d61 7472 6978 2064 7572  iance matrix dur
-0000e940: 696e 6720 6669 7474 696e 6720 7072 6f63  ing fitting proc
-0000e950: 6564 7572 650a 2020 2020 2020 7365 6c66  edure.      self
-0000e960: 2e6e 6565 6473 5f64 796e 616d 6963 4572  .needs_dynamicEr
-0000e970: 726f 7273 203d 2054 7275 6520 2020 2023  rors = True    #
-0000e980: 2066 6c61 6720 666f 7220 636f 7374 2066   flag for cost f
-0000e990: 756e 6374 696f 6e0a 2020 2020 2020 7365  unction.      se
-0000e9a0: 6c66 2e66 696e 616c 5f63 616c 6c20 3d20  lf.final_call = 
-0000e9b0: 4661 6c73 6520 2320 666c 6167 2066 6f72  False # flag for
-0000e9c0: 205f 7265 6275 696c 645f 436f 763a 206e   _rebuild_Cov: n
-0000e9d0: 6f20 7374 6f72 6167 6520 6f66 2079 636f  o storage of yco
-0000e9e0: 7620 0a20 2020 2020 200a 2020 2020 2020  v .      .      
-0000e9f0: 6966 2073 656c 662e 6e65 6564 735f 636f  if self.needs_co
-0000ea00: 7661 7269 616e 6365 3a0a 2020 2020 2020  variance:.      
-0000ea10: 2020 2320 6275 696c 6420 7374 6174 6963    # build static
-0000ea20: 2028 3d70 6172 616d 6574 6572 2d69 6e64   (=parameter-ind
-0000ea30: 6570 656e 6465 6e74 2920 7061 7274 206f  ependent) part o
-0000ea40: 6620 636f 7661 7269 616e 6365 206d 6174  f covariance mat
-0000ea50: 7269 7820 2020 2020 200a 2020 2020 2020  rix      .      
-0000ea60: 2020 6966 2073 656c 662e 6861 735f 7265    if self.has_re
-0000ea70: 6c5f 7945 7272 6f72 7320 616e 6420 7365  l_yErrors and se
-0000ea80: 6c66 2e72 6566 5f74 6f4d 6f64 656c 3a0a  lf.ref_toModel:.
-0000ea90: 2020 2020 2020 2020 2020 2320 736f 6d65            # some
-0000eaa0: 2079 2d65 7272 6f72 7320 6172 6520 7061   y-errors are pa
-0000eab0: 7261 6d65 7465 722d 696e 6465 7065 6e64  rameter-independ
-0000eac0: 656e 740a 2020 2020 2020 2020 2020 7365  ent.          se
-0000ead0: 6c66 2e5f 7374 6174 6963 436f 7620 3d20  lf._staticCov = 
-0000eae0: 5f62 7569 6c64 5f43 6f76 4d61 7428 7365  _build_CovMat(se
-0000eaf0: 6c66 2e6e 642c 0a20 2020 2020 2020 2020  lf.nd,.         
-0000eb00: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000eb10: 6c66 2e65 792c 2065 6162 7363 6f72 203d  lf.ey, eabscor =
-0000eb20: 2073 656c 662e 6361 6273 7929 0a20 2020   self.cabsy).   
-0000eb30: 2020 2020 2065 6c73 653a 200a 2020 2020       else: .    
-0000eb40: 2020 2020 2020 2320 616c 6c20 792d 6572        # all y-er
-0000eb50: 726f 7273 2061 7265 2070 6172 616d 6574  rors are paramet
-0000eb60: 6572 2d69 6e64 6570 656e 6465 6e74 0a20  er-independent. 
-0000eb70: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
-0000eb80: 7461 7469 6343 6f76 203d 205f 6275 696c  taticCov = _buil
-0000eb90: 645f 436f 764d 6174 2873 656c 662e 6e64  d_CovMat(self.nd
-0000eba0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ebb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebc0: 7365 6c66 2e65 792c 2065 7265 6c3d 7365  self.ey, erel=se
-0000ebd0: 6c66 2e65 7265 6c79 2c0a 2020 2020 2020  lf.erely,.      
-0000ebe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebf0: 2020 2020 2020 2020 6561 6273 636f 7220          eabscor 
-0000ec00: 3d20 7365 6c66 2e63 6162 7379 2c20 6572  = self.cabsy, er
-0000ec10: 656c 636f 723d 7365 6c66 2e63 7265 6c79  elcor=self.crely
-0000ec20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec40: 2020 2020 2020 2020 2020 2020 2020 6461                da
-0000ec50: 7461 3d73 656c 662e 7929 0a20 2020 2020  ta=self.y).     
-0000ec60: 2020 2023 2062 7569 6c64 206d 6174 7269     # build matri
-0000ec70: 7820 6f66 2072 656c 6174 6976 6520 6572  x of relative er
-0000ec80: 726f 7273 0a20 2020 2020 2020 2069 6620  rors.        if 
-0000ec90: 7365 6c66 2e72 6566 5f74 6f4d 6f64 656c  self.ref_toModel
-0000eca0: 2061 6e64 2073 656c 662e 6861 735f 7265   and self.has_re
-0000ecb0: 6c5f 7945 7272 6f72 733a 0a20 2020 2020  l_yErrors:.     
-0000ecc0: 2020 2020 2073 656c 662e 5f63 6f76 7930       self._covy0
-0000ecd0: 203d 205f 6275 696c 645f 436f 764d 6174   = _build_CovMat
-0000ece0: 2873 656c 662e 6e64 2c0a 2020 2020 2020  (self.nd,.      
-0000ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed00: 2020 2020 2020 2065 7265 6c3d 7365 6c66         erel=self
-0000ed10: 2e65 7265 6c79 2c0a 2020 2020 2020 2020  .erely,.        
-0000ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed30: 2020 2020 2065 7265 6c63 6f72 3d73 656c       erelcor=sel
-0000ed40: 662e 6372 656c 792c 0a20 2020 2020 2020  f.crely,.       
+00004b40: 636f 6465 2c20 7363 6f70 6529 0a20 2066  code, scope).  f
+00004b50: 6974 6620 3d20 7363 6f70 655b 6669 7466  itf = scope[fitf
+00004b60: 5f6e 616d 655d 0a20 2023 2063 6865 636b  _name].  # check
+00004b70: 2075 7365 722d 7072 6f76 6964 6564 2063   user-provided c
+00004b80: 6f64 650a 2020 7472 793a 0a20 2020 2079  ode.  try:.    y
+00004b90: 203d 2066 6974 6628 6e70 2e61 7361 7272   = fitf(np.asarr
+00004ba0: 6179 2864 6174 615f 7829 290a 2020 6578  ay(data_x)).  ex
+00004bb0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+00004bc0: 7320 653a 0a20 2020 2072 6169 7365 2056  s e:.    raise V
+00004bd0: 616c 7565 4572 726f 7228 2221 2121 206d  alueError("!!! m
+00004be0: 6f64 656c 2063 6f64 6520 6e6f 7420 7661  odel code not va
+00004bf0: 6c69 6420 2120 5c6e 2220 2b20 7374 7228  lid ! \n" + str(
+00004c00: 6529 2920 0a0a 2320 7065 7266 6f72 6d20  e)) ..# perform 
+00004c10: 6669 7420 746f 2064 6174 6120 7769 7468  fit to data with
+00004c20: 2066 756e 6374 696f 6e20 7879 4669 7420   function xyFit 
+00004c30: 0a20 2072 6469 6374 203d 2078 7946 6974  .  rdict = xyFit
+00004c40: 2866 6974 662c 0a20 2020 2020 2064 6174  (fitf,.      dat
+00004c50: 615f 782c 2064 6174 615f 792c 2020 2020  a_x, data_y,    
+00004c60: 2020 2320 6461 7461 2078 2061 6e64 2079    # data x and y
+00004c70: 2063 6f6f 7264 696e 6174 6573 0a20 2020   coordinates.   
+00004c80: 2020 2073 783d 7378 2c20 2020 2020 2020     sx=sx,       
+00004c90: 2020 2020 2020 2020 2320 696e 6465 7020          # indep 
+00004ca0: 780a 2020 2020 2020 7379 3d73 792c 2020  x.      sy=sy,  
+00004cb0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00004cc0: 6e64 6570 2079 0a20 2020 2020 2073 7265  ndep y.      sre
+00004cd0: 6c78 3d73 7265 6c78 2c20 2020 2020 2020  lx=srelx,       
+00004ce0: 2020 2320 696e 6465 702e 2072 656c 2e20    # indep. rel. 
+00004cf0: 780a 2020 2020 2020 7372 656c 793d 7372  x.      srely=sr
+00004d00: 656c 792c 2020 2020 2020 2020 2023 2069  ely,         # i
+00004d10: 6e64 6570 2e20 7265 6c2e 2079 0a20 2020  ndep. rel. y.   
+00004d20: 2020 2078 6162 7363 6f72 3d73 6162 7363     xabscor=sabsc
+00004d30: 6f72 782c 2020 2020 2320 636f 7272 656c  orx,    # correl
+00004d40: 6174 6564 2078 0a20 2020 2020 2078 7265  ated x.      xre
+00004d50: 6c63 6f72 3d73 7265 6c63 6f72 782c 2020  lcor=srelcorx,  
+00004d60: 2020 2320 636f 7272 656c 6174 6564 2072    # correlated r
+00004d70: 656c 2e20 780a 2020 2020 2020 7961 6273  el. x.      yabs
+00004d80: 636f 723d 7361 6273 636f 7279 2c20 2020  cor=sabscory,   
+00004d90: 2023 2063 6f72 7265 6c61 7465 6420 790a   # correlated y.
+00004da0: 2020 2020 2020 7972 656c 636f 723d 7372        yrelcor=sr
+00004db0: 656c 636f 7279 2c20 2020 2023 2063 6f72  elcory,    # cor
+00004dc0: 7265 6c61 7465 6420 7265 6c2e 2079 0a20  related rel. y. 
+00004dd0: 2020 2020 2063 6f6e 7374 7261 696e 7473       constraints
+00004de0: 203d 2063 6f6e 7374 7261 696e 7473 2c20   = constraints, 
+00004df0: 2320 7061 7261 6d65 7465 7220 636f 6e73  # parameter cons
+00004e00: 7472 6169 6e74 730a 2020 2020 2020 6669  traints.      fi
+00004e10: 7850 6172 7320 3d20 6669 7865 6450 6172  xPars = fixedPar
+00004e20: 732c 2023 2066 6978 6564 2070 6172 616d  s, # fixed param
+00004e30: 6574 6572 730a 2020 2020 2020 6178 6973  eters.      axis
+00004e40: 5f6c 6162 656c 733d 5b78 5f6c 6162 656c  _labels=[x_label
+00004e50: 2c20 795f 6c61 6265 6c5d 2c20 0a20 2020  , y_label], .   
+00004e60: 2020 2064 6174 615f 6c65 6765 6e64 203d     data_legend =
+00004e70: 2020 6461 7461 5f6c 6162 656c 2c20 2020    data_label,   
+00004e80: 200a 2020 2020 2020 6d6f 6465 6c5f 6c65   .      model_le
+00004e90: 6765 6e64 203d 206d 6f64 656c 5f6c 6162  gend = model_lab
+00004ea0: 656c 2c20 0a20 2020 2020 2070 6c6f 743d  el, .      plot=
+00004eb0: 706c 6f74 2c20 2020 2020 2020 2020 2020  plot,           
+00004ec0: 2020 2320 706c 6f74 2064 6174 6120 616e    # plot data an
+00004ed0: 6420 6d6f 6465 6c0a 2020 2020 2020 706c  d model.      pl
+00004ee0: 6f74 5f62 616e 643d 706c 6f74 5f62 616e  ot_band=plot_ban
+00004ef0: 642c 2020 2023 2070 6c6f 7420 6d6f 6465  d,   # plot mode
+00004f00: 6c20 636f 6e66 6964 656e 6365 2d62 616e  l confidence-ban
+00004f10: 640a 2020 2020 2020 706c 6f74 5f63 6f72  d.      plot_cor
+00004f20: 3d70 6c6f 745f 636f 722c 2020 2020 2023  =plot_cor,     #
+00004f30: 2070 6c6f 7420 7072 6f66 696c 6573 206c   plot profiles l
+00004f40: 696b 656c 6968 6f6f 6420 616e 6420 636f  ikelihood and co
+00004f50: 6e74 6f75 7273 0a20 2020 2020 2073 686f  ntours.      sho
+00004f60: 7770 6c6f 7473 3d73 686f 7770 6c6f 7473  wplots=showplots
+00004f70: 2c20 2020 2320 706c 6f74 7320 746f 2073  ,   # plots to s
+00004f80: 6372 6565 6e0a 2020 2020 2020 7361 6d65  creen.      same
+00004f90: 5f70 6c6f 7420 3d20 7361 6d65 5f70 6c6f  _plot = same_plo
+00004fa0: 742c 2023 206f 7665 726c 6179 2066 6974  t, # overlay fit
+00004fb0: 2069 6e66 6f20 6672 6f6d 2070 7265 7669   info from previ
+00004fc0: 6f69 7573 2063 616c 6c28 7329 0a20 2020  oius call(s).   
+00004fd0: 2020 2071 7569 6574 3d71 7569 6574 2c20     quiet=quiet, 
+00004fe0: 2020 2020 2020 2020 2020 2320 7375 7070            # supp
+00004ff0: 7265 7373 2069 6e66 6f72 6d61 7469 7665  ress informative
+00005000: 2070 7269 6e74 6f75 740a 2020 2020 2020   printout.      
+00005010: 7265 7475 726e 5f66 6974 4f62 6a65 6374  return_fitObject
+00005020: 3d72 6574 7572 6e5f 6669 744f 626a 6563  =return_fitObjec
+00005030: 740a 2020 2020 2020 290a 2020 7265 7475  t.      ).  retu
+00005040: 726e 2072 6469 6374 0a20 2020 0a64 6566  rn rdict.   .def
+00005050: 2078 4669 7428 6669 7466 2c20 782c 2073   xFit(fitf, x, s
+00005060: 203d 204e 6f6e 652c 2073 7265 6c20 3d20   = None, srel = 
+00005070: 4e6f 6e65 2c20 0a20 2020 2020 2020 7361  None, .       sa
+00005080: 6273 636f 7220 3d20 4e6f 6e65 2c20 7372  bscor = None, sr
+00005090: 656c 636f 7220 3d20 4e6f 6e65 2c20 2020  elcor = None,   
+000050a0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+000050b0: 2020 2020 7265 665f 746f 5f6d 6f64 656c      ref_to_model
+000050c0: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
+000050d0: 6e61 6d65 7320 3d20 4e6f 6e65 2c0a 2020  names = None,.  
+000050e0: 2020 2020 206d 6f64 656c 5f6b 7761 7267       model_kwarg
+000050f0: 7320 3d20 4e6f 6e65 2c0a 2020 2020 2020  s = None,.      
+00005100: 2070 3020 3d20 4e6f 6e65 2c20 6470 3020   p0 = None, dp0 
+00005110: 3d20 4e6f 6e65 2c20 636f 6e73 7472 6169  = None, constrai
+00005120: 6e74 7320 3d20 4e6f 6e65 2c0a 2020 2020  nts = None,.    
+00005130: 2020 2066 6978 5061 7273 3d4e 6f6e 652c     fixPars=None,
+00005140: 206c 696d 6974 733d 4e6f 6e65 2c0a 2020   limits=None,.  
+00005150: 2020 2020 2075 7365 5f6e 6567 4c6f 674c       use_negLogL
+00005160: 3d54 7275 652c 200a 2020 2020 2020 2070  =True, .       p
+00005170: 6c6f 7420 3d20 5472 7565 2c20 706c 6f74  lot = True, plot
+00005180: 5f63 6f72 203d 2046 616c 7365 2c0a 2020  _cor = False,.  
+00005190: 2020 2020 2073 686f 7770 6c6f 7473 203d       showplots =
+000051a0: 2054 7275 652c 200a 2020 2020 2020 2070   True, .       p
+000051b0: 6c6f 745f 6261 6e64 3d54 7275 652c 2070  lot_band=True, p
+000051c0: 6c6f 745f 7265 7369 6475 616c 3d46 616c  lot_residual=Fal
+000051d0: 7365 2c20 7175 6965 7420 3d20 5472 7565  se, quiet = True
+000051e0: 2c0a 2020 2020 2020 2073 616d 655f 706c  ,.       same_pl
+000051f0: 6f74 203d 2046 616c 7365 2c20 2020 2023  ot = False,    #
+00005200: 206f 7665 726c 6179 2066 6974 2069 6e66   overlay fit inf
+00005210: 6f20 6672 6f6d 2070 7265 7669 6f69 7573  o from previoius
+00005220: 2063 616c 6c28 7329 0a20 2020 2020 2020   call(s).       
+00005230: 6178 6973 5f6c 6162 656c 733d 5b27 496e  axis_labels=['In
+00005240: 6465 7827 2c20 2766 282a 782c 202a 7061  dex', 'f(*x, *pa
+00005250: 7229 275d 2c0a 2020 2020 2020 2064 6174  r)'],.       dat
+00005260: 615f 6c65 6765 6e64 203d 2027 6461 7461  a_legend = 'data
+00005270: 272c 2020 2020 0a20 2020 2020 2020 6d6f  ',    .       mo
+00005280: 6465 6c5f 6c65 6765 6e64 203d 2027 6d6f  del_legend = 'mo
+00005290: 6465 6c27 2c0a 2020 2020 2020 2072 6574  del',.       ret
+000052a0: 7572 6e5f 6669 744f 626a 6563 7420 3d20  urn_fitObject = 
+000052b0: 4661 6c73 6520 293a 0a20 200a 2020 2222  False ):.  .  ""
+000052c0: 2257 7261 7070 6572 2066 756e 6374 696f  "Wrapper functio
+000052d0: 6e20 746f 2066 6974 2061 6e20 6172 6269  n to fit an arbi
+000052e0: 7472 6172 7920 6675 6e63 7469 6f6e 2074  trary function t
+000052f0: 6f20 6461 7461 2077 6974 680a 2020 696e  o data with.  in
+00005300: 6465 7065 6e64 656e 7420 616e 642f 6f72  dependent and/or
+00005310: 2063 6f72 7265 6c61 7465 6420 6162 736f   correlated abso
+00005320: 6c75 7465 2061 6e64 2f6f 7220 7265 6c61  lute and/or rela
+00005330: 7469 7665 2075 6e63 6572 7461 696e 7469  tive uncertainti
+00005340: 6573 200a 2020 7769 7468 2063 6c61 7373  es .  with class
+00005350: 206d 6e46 6974 2e20 556e 6365 7274 6169   mnFit. Uncertai
+00005360: 6e74 6965 7320 6172 6520 6173 7375 6d65  nties are assume
+00005370: 6420 746f 2062 6520 6465 7372 6962 6564  d to be desribed
+00005380: 2062 790a 2020 6120 6d75 6c74 6976 6172   by.  a multivar
+00005390: 6961 7465 2047 6175 7373 6961 6e20 6469  iate Gaussian di
+000053a0: 7374 7269 6275 7469 6f6e 2c20 692e 652e  stribution, i.e.
+000053b0: 2074 6865 2063 6f76 6172 6961 6e63 6520   the covariance 
+000053c0: 6d61 7472 6978 206f 6620 0a20 2074 6865  matrix of .  the
+000053d0: 2064 6174 6120 7b78 5f69 7d20 6973 2074   data {x_i} is t
+000053e0: 616b 656e 2069 6e74 6f20 6163 636f 756e  aken into accoun
+000053f0: 7420 696e 2074 6865 2063 6f73 7420 6675  t in the cost fu
+00005400: 6e63 7469 6f6e 2e0a 0a20 2043 6f72 7265  nction...  Corre
+00005410: 6c61 7465 6420 6162 736f 6c75 7465 2061  lated absolute a
+00005420: 6e64 2f6f 7220 7265 6c61 7469 7665 2075  nd/or relative u
+00005430: 6e63 6572 7461 696e 7469 6573 206f 6620  ncertainties of 
+00005440: 696e 7075 7420 6461 7461 200a 2020 6172  input data .  ar
+00005450: 6520 7370 6563 6966 6965 6420 6173 2066  e specified as f
+00005460: 6c6f 6174 7320 2869 6620 616c 6c20 756e  loats (if all un
+00005470: 6365 7274 6169 6e74 6965 7320 6172 6520  certainties are 
+00005480: 6571 7561 6c29 206f 7220 6173 200a 2020  equal) or as .  
+00005490: 6e75 6d70 792d 6172 7261 7973 206f 6620  numpy-arrays of 
+000054a0: 666c 6f61 7473 2e20 5468 6520 636f 6e63  floats. The conc
+000054b0: 6570 7420 6f66 2069 6e64 6570 656e 6465  ept of independe
+000054c0: 6e74 206f 7220 636f 6d6d 6f6e 200a 2020  nt or common .  
+000054d0: 756e 6365 7274 6169 6e74 6965 7320 6f66  uncertainties of
+000054e0: 2028 6772 6f75 7073 2920 6f66 2076 616c   (groups) of val
+000054f0: 7565 7320 6973 2075 7365 6420 746f 2063  ues is used to c
+00005500: 6f6e 7374 7275 6374 2074 6865 200a 2020  onstruct the .  
+00005510: 6675 6c6c 2063 6f76 6172 6961 6e63 6520  full covariance 
+00005520: 6d61 7472 6978 2066 726f 6d20 6469 6666  matrix from diff
+00005530: 6572 656e 7420 756e 6365 7274 6169 6e74  erent uncertaint
+00005540: 7920 636f 6d70 6f6e 656e 7473 2e0a 0a20  y components... 
+00005550: 2041 7267 733a 0a20 2020 202a 2066 6974   Args:.    * fit
+00005560: 663a 206d 6f64 656c 2066 756e 6374 696f  f: model functio
+00005570: 6e20 746f 2066 6974 2c20 6172 6775 6d65  n to fit, argume
+00005580: 6e74 7320 2866 6c6f 6174 3a78 2c20 666c  nts (float:x, fl
+00005590: 6f61 743a 205c 2a61 7267 7329 0a20 2020  oat: \*args).   
+000055a0: 202a 2078 3a20 206e 702d 6172 7261 7920   * x:  np-array 
+000055b0: 6f66 2064 6174 6120 7661 6c75 6573 0a20  of data values. 
+000055c0: 2020 202a 2073 3a20 7363 616c 6172 206f     * s: scalar o
+000055d0: 7220 3164 206f 7220 3264 206e 702d 6172  r 1d or 2d np-ar
+000055e0: 7261 7920 7769 7468 2075 6e63 6572 7461  ray with uncerta
+000055f0: 696e 7469 6573 0a20 2020 202a 2073 7265  inties.    * sre
+00005600: 6c3a 2073 6361 6c61 7220 6f72 206e 702d  l: scalar or np-
+00005610: 6172 7261 793b 2072 656c 6174 6976 6520  array; relative 
+00005620: 756e 6365 7274 6169 6e74 6965 7320 0a20  uncertainties . 
+00005630: 2020 202a 2073 6162 7363 6f72 3a20 7363     * sabscor: sc
+00005640: 616c 6172 206f 7220 6e70 2d61 7272 6179  alar or np-array
+00005650: 3b20 6162 736f 6c75 7465 2c20 636f 7272  ; absolute, corr
+00005660: 656c 6174 6564 2065 7272 6f72 2873 2920  elated error(s) 
+00005670: 0a20 2020 202a 2073 7265 6c63 6f72 3a20  .    * srelcor: 
+00005680: 7363 616c 6172 206f 7220 6e70 2d61 7272  scalar or np-arr
+00005690: 6179 3b20 7265 6c61 7469 7665 2c20 636f  ay; relative, co
+000056a0: 7272 656c 6174 6564 2065 7272 6f72 2873  rrelated error(s
+000056b0: 2920 0a20 2020 202a 2072 6566 5f74 6f5f  ) .    * ref_to_
+000056c0: 6d6f 6465 6c3a 2072 656c 6174 6976 6520  model: relative 
+000056d0: 6572 726f 7273 2077 2e72 2e74 2e20 6d6f  errors w.r.t. mo
+000056e0: 6465 6c20 6966 2054 7275 650a 2020 2020  del if True.    
+000056f0: 2a20 6e61 6d65 733a 206f 7074 696f 6e61  * names: optiona
+00005700: 6c20 6e61 6d65 7320 666f 7220 6561 6368  l names for each
+00005710: 2069 6e70 7574 2076 616c 7565 0a20 2020   input value.   
+00005720: 202a 206d 6f64 656c 5f6b 7761 7267 733a   * model_kwargs:
+00005730: 206f 7074 696f 6e61 6c2c 2066 6974 2070   optional, fit p
+00005740: 6172 616d 6574 6572 7320 6966 206e 6f74  arameters if not
+00005750: 2066 726f 6d20 6d6f 6465 6c20 7369 676e   from model sign
+00005760: 6174 7572 6520 0a20 2020 202a 2070 303a  ature .    * p0:
+00005770: 2061 7272 6179 2d6c 696b 652c 2069 6e69   array-like, ini
+00005780: 7469 616c 2067 7565 7373 206f 6620 7061  tial guess of pa
+00005790: 7261 6d65 7465 7273 0a20 2020 202a 2064  rameters.    * d
+000057a0: 7030 3a20 6172 7261 792d 6c69 6b65 2c20  p0: array-like, 
+000057b0: 696e 6974 6961 6c20 6775 6573 7320 6f66  initial guess of
+000057c0: 2070 6172 616d 6574 6572 2075 6e63 6572   parameter uncer
+000057d0: 7461 696e 7469 6573 2028 6f70 7469 6f6e  tainties (option
+000057e0: 616c 290a 2020 2020 2a20 7573 655f 6e65  al).    * use_ne
+000057f0: 674c 6f67 4c3a 2020 7573 6520 6675 6c6c  gLogL:  use full
+00005800: 202d 326c 6e28 4c29 2020 0a20 2020 202a   -2ln(L)  .    *
+00005810: 2063 6f6e 7374 7261 696e 7473 3a20 286e   constraints: (n
+00005820: 6573 7465 6429 206c 6973 7428 7329 205b  ested) list(s) [
+00005830: 6e61 6d65 206f 7220 6964 2c20 7661 6c75  name or id, valu
+00005840: 652c 2065 7272 6f72 5d0a 2020 2020 2a20  e, error].    * 
+00005850: 6669 7820 7061 7261 6d65 7465 7228 7329  fix parameter(s)
+00005860: 2069 6e20 6669 743a 206c 6973 7420 6f66   in fit: list of
+00005870: 2070 6172 616d 6574 6572 206e 616d 6573   parameter names
+00005880: 206f 7220 696e 6469 6365 730a 2020 2020   or indices.    
+00005890: 2a20 6c69 6d69 7473 3a20 286e 6573 7465  * limits: (neste
+000058a0: 6429 206c 6973 7428 7329 205b 6e61 6d65  d) list(s) [name
+000058b0: 206f 7220 6964 2c20 6d69 6e2c 206d 6178   or id, min, max
+000058c0: 5d20 0a20 2020 202a 2070 6c6f 743a 2073  ] .    * plot: s
+000058d0: 686f 7720 6461 7461 2070 6f69 6e74 7320  how data points 
+000058e0: 616e 6420 6d6f 6465 6c20 7072 6564 6963  and model predic
+000058f0: 7469 6f6e 2069 6620 5472 7565 0a20 2020  tion if True.   
+00005900: 202a 2070 6c6f 745f 636f 723a 2073 686f   * plot_cor: sho
+00005910: 7720 7072 6f66 696c 6520 6c69 6b65 6c69  w profile likeli
+00005920: 686f 6f64 7320 616e 6420 636f 6e66 6964  hoods and confid
+00005930: 656e 6365 2063 6f6e 746f 7572 730a 2020  ence contours.  
+00005940: 2020 2a20 706c 6f74 5f62 616e 643a 2070    * plot_band: p
+00005950: 6c6f 7420 756e 6365 7274 6169 6e74 7920  lot uncertainty 
+00005960: 6261 6e64 2061 726f 756e 6420 6d6f 6465  band around mode
+00005970: 6c20 7072 6564 6963 7469 6f6e 0a20 2020  l prediction.   
+00005980: 202a 2070 6c6f 745f 7265 7369 6475 616c   * plot_residual
+00005990: 3a20 706c 6f74 2072 6573 6964 7561 6c73  : plot residuals
+000059a0: 2077 2e72 2e74 2e20 6d6f 6465 6c20 696e   w.r.t. model in
+000059b0: 7374 6561 6420 6f66 206d 6f64 656c 2070  stead of model p
+000059c0: 7265 6469 6374 696f 6e0a 2020 2020 2a20  rediction.    * 
+000059d0: 7368 6f77 706c 6f74 733a 2073 686f 7720  showplots: show 
+000059e0: 706c 6f74 7320 6f6e 2073 6372 6565 6e0a  plots on screen.
+000059f0: 2020 2020 2a20 7361 6d65 5f70 6c6f 743a      * same_plot:
+00005a00: 206f 7665 726c 6179 2066 6974 2069 6e66   overlay fit inf
+00005a10: 6f20 6672 6f6d 2070 7265 7669 6f75 7320  o from previous 
+00005a20: 6361 6c6c 2873 290a 2020 2020 2a20 7175  call(s).    * qu
+00005a30: 6965 743a 2073 7570 7072 6573 7320 7072  iet: suppress pr
+00005a40: 696e 746f 7574 0a20 2020 202a 206c 6973  intout.    * lis
+00005a50: 7420 6f66 2073 7472 3a20 6178 6973 206c  t of str: axis l
+00005a60: 6162 656c 730a 2020 2020 2a20 7374 723a  abels.    * str:
+00005a70: 206c 6567 656e 6420 666f 7220 6461 7461   legend for data
+00005a80: 0a20 2020 202a 2073 7472 3a20 6c65 6765  .    * str: lege
+00005a90: 6e64 2066 6f72 206d 6f64 656c 200a 2020  nd for model .  
+00005aa0: 2020 2a20 626f 6f6c 3a20 666f 7220 6578    * bool: for ex
+00005ab0: 7065 7274 7320 6f6e 6c79 2c20 7265 7475  perts only, retu
+00005ac0: 726e 2069 6e73 7461 6e63 6520 6f66 2063  rn instance of c
+00005ad0: 6c61 7373 206d 6e46 6974 2074 6f20 0a20  lass mnFit to . 
+00005ae0: 2020 2020 2067 6976 6520 6163 6365 7373       give access
+00005af0: 2074 6f20 6461 7461 206d 656d 6265 7273   to data members
+00005b00: 2061 6e64 206d 6574 686f 6473 0a0a 2020   and methods..  
+00005b10: 5265 7475 726e 733a 0a20 2020 202a 206e  Returns:.    * n
+00005b20: 702d 6172 7261 7920 6f66 2066 6c6f 6174  p-array of float
+00005b30: 3a20 7061 7261 6d65 7465 7220 7661 6c75  : parameter valu
+00005b40: 6573 0a20 2020 202a 2032 6420 6e70 2d61  es.    * 2d np-a
+00005b50: 7272 6179 206f 6620 666c 6f61 743a 2070  rray of float: p
+00005b60: 6172 616d 6574 6572 2075 6e63 6572 7461  arameter uncerta
+00005b70: 696e 7469 6573 205b 305d 3a20 6e65 672e  inties [0]: neg.
+00005b80: 2061 6e64 205b 315d 3a20 706f 732e 200a   and [1]: pos. .
+00005b90: 2020 2020 2a20 6e70 2d61 7272 6179 3a20      * np-array: 
+00005ba0: 636f 7272 656c 6174 696f 6e20 6d61 7472  correlation matr
+00005bb0: 6978 200a 2020 2020 2a20 666c 6f61 743a  ix .    * float:
+00005bc0: 2032 2a6e 6567 4c6f 6720 4c2c 2063 6f72   2*negLog L, cor
+00005bd0: 7265 7370 6f6e 6469 6e67 2074 6f20 5c63  responding to \c
+00005be0: 6869 2d73 7175 6172 6520 6f66 2066 6974  hi-square of fit
+00005bf0: 2061 206d 696e 696d 756d 0a0a 2020 2020   a minimum..    
+00005c00: 6f72 2c20 6f70 7469 6f6e 616c 6c79 2c20  or, optionally, 
+00005c10: 7468 6520 6d6e 4669 7420 696e 7374 616e  the mnFit instan
+00005c20: 6365 2e0a 2020 2222 220a 0a20 2023 2320  ce..  """..  ## 
+00005c30: 6672 6f6d 202e 7068 7946 6974 2069 6d70  from .phyFit imp
+00005c40: 6f72 7420 6d6e 4669 7420 2321 2061 6c72  ort mnFit #! alr
+00005c50: 6561 6479 2063 6f6e 7461 696e 6564 2069  eady contained i
+00005c60: 6e20 7468 6973 2066 696c 650a 0a20 2023  n this file..  #
+00005c70: 202e 2e2e 2063 6865 636b 2069 6620 6572   ... check if er
+00005c80: 726f 7273 2061 7265 2070 726f 7669 6465  rors are provide
+00005c90: 6420 2e2e 2e0a 2020 6966 2073 2069 7320  d ....  if s is 
+00005ca0: 4e6f 6e65 3a0a 2020 2020 7379 203d 206e  None:.    sy = n
+00005cb0: 702e 6f6e 6573 286c 656e 2878 2929 0a20  p.ones(len(x)). 
+00005cc0: 2020 2070 7269 6e74 2827 5c6e 212a 2a21     print('\n!**!
+00005cd0: 204e 6f20 792d 6572 726f 7273 2067 6976   No y-errors giv
+00005ce0: 656e 2c20 616c 6c20 6173 7375 6d65 6420  en, all assumed 
+00005cf0: 746f 2062 6520 312e 305c 6e27 2c0a 2020  to be 1.0\n',.  
+00005d00: 2020 2020 2020 2020 272d 3e20 636f 6e73          '-> cons
+00005d10: 6964 6572 2073 6361 6c69 6e67 206f 6620  ider scaling of 
+00005d20: 7061 7261 6d65 7465 7220 6572 726f 7273  parameter errors
+00005d30: 2077 6974 6820 7371 7274 2863 6869 5e32   with sqrt(chi^2
+00005d40: 2f4e 6466 295c 6e27 290a 2020 0a20 2023  /Ndf)\n').  .  #
+00005d50: 2073 6574 2075 7020 6120 6669 7420 6f62   set up a fit ob
+00005d60: 6a65 6374 0a20 2069 6e64 6578 6564 4669  ject.  indexedFi
+00005d70: 7420 3d20 6d6e 4669 7428 2769 6e64 6578  t = mnFit('index
+00005d80: 6564 2729 0a0a 2020 2320 7365 7420 736f  ed')..  # set so
+00005d90: 6d65 206f 7074 696f 6e73 0a20 2069 6e64  me options.  ind
+00005da0: 6578 6564 4669 742e 7365 744f 7074 696f  exedFit.setOptio
+00005db0: 6e73 2872 756e 5f6d 696e 6f73 3d54 7275  ns(run_minos=Tru
+00005dc0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00005dd0: 2020 2020 2072 656c 6174 6976 655f 7265       relative_re
+00005de0: 6665 7273 5f74 6f5f 6d6f 6465 6c3d 7265  fers_to_model=re
+00005df0: 665f 746f 5f6d 6f64 656c 2c0a 2020 2020  f_to_model,.    
+00005e00: 2020 2020 2020 2020 2020 2020 2020 7573                us
+00005e10: 655f 6e65 674c 6f67 4c3d 7573 655f 6e65  e_negLogL=use_ne
+00005e20: 674c 6f67 4c2c 0a20 2020 2020 2020 2020  gLogL,.         
+00005e30: 2020 2020 2020 2020 2071 7569 6574 3d71           quiet=q
+00005e40: 7569 6574 290a 0a20 2023 2070 6173 7320  uiet)..  # pass 
+00005e50: 6461 7461 2061 6e64 2075 6e63 6572 7461  data and uncerta
+00005e60: 696e 7469 6573 2074 6f20 6669 7420 6f62  inties to fit ob
+00005e70: 6a65 6374 0a20 2069 6e64 6578 6564 4669  ject.  indexedFi
+00005e80: 742e 696e 6974 5f64 6174 6128 782c 2065  t.init_data(x, e
+00005e90: 203d 2073 2c20 0a20 2020 2020 2020 2020   = s, .         
+00005ea0: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00005eb0: 656c 203d 2073 7265 6c2c 2063 6162 7320  el = srel, cabs 
+00005ec0: 3d20 7361 6273 636f 722c 2063 7265 6c20  = sabscor, crel 
+00005ed0: 3d20 7372 656c 636f 722c 0a20 2020 2020  = srelcor,.     
+00005ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ef0: 2020 6e61 6d65 7320 3d20 6e61 6d65 7329    names = names)
+00005f00: 0a20 2020 2320 7061 7373 206d 6f64 656c  .   # pass model
+00005f10: 2066 756e 6374 696f 6e2c 2073 7461 7274   function, start
+00005f20: 2070 6172 616d 6574 6572 2061 6e64 2070   parameter and p
+00005f30: 6f73 7369 626c 6520 636f 6e73 7472 6169  ossible constrai
+00005f40: 6e74 730a 2020 696e 6465 7865 6446 6974  nts.  indexedFit
+00005f50: 2e69 6e69 745f 6669 7428 6669 7466 2c20  .init_fit(fitf, 
+00005f60: 6d6f 6465 6c5f 6b77 6172 6773 3d6d 6f64  model_kwargs=mod
+00005f70: 656c 5f6b 7761 7267 732c 2070 303d 7030  el_kwargs, p0=p0
+00005f80: 2c20 6470 303d 6470 302c 200a 2020 2020  , dp0=dp0, .    
+00005f90: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
+00005fa0: 7261 696e 7473 3d63 6f6e 7374 7261 696e  raints=constrain
+00005fb0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00005fc0: 2020 2066 6978 5061 7273 3d66 6978 5061     fixPars=fixPa
+00005fd0: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
+00005fe0: 2020 206c 696d 6974 733d 6c69 6d69 7473     limits=limits
+00005ff0: 290a 2020 2023 2070 6572 666f 726d 2074  ).   # perform t
+00006000: 6865 2066 6974 0a20 2066 6974 5265 7375  he fit.  fitResu
+00006010: 6c74 203d 2069 6e64 6578 6564 4669 742e  lt = indexedFit.
+00006020: 646f 5f66 6974 2829 0a20 2023 2070 7269  do_fit().  # pri
+00006030: 6e74 2066 6974 2072 6573 756c 7428 6469  nt fit result(di
+00006040: 6374 696f 6e61 7279 2066 726f 6d20 6d69  ctionary from mi
+00006050: 6772 6164 2f6d 696e 6f73 280a 2020 6966  grad/minos(.  if
+00006060: 206e 6f74 2071 7569 6574 3a0a 2020 2020   not quiet:.    
+00006070: 7072 696e 7428 225c 6e46 6974 2052 6573  print("\nFit Res
+00006080: 756c 7420 6672 6f6d 206d 6967 7261 643a  ult from migrad:
+00006090: 2229 0a20 2020 2070 7269 6e74 2866 6974  ").    print(fit
+000060a0: 5265 7375 6c74 5b30 5d29 0a20 2020 2069  Result[0]).    i
+000060b0: 6620 6669 7452 6573 756c 745b 315d 2069  f fitResult[1] i
+000060c0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000060d0: 2020 7072 696e 7428 225c 6e52 6573 756c    print("\nResul
+000060e0: 7420 6f66 206d 696e 6f73 2065 7272 6f72  t of minos error
+000060f0: 2061 6e61 6c79 7369 733a 2229 0a20 2020   analysis:").   
+00006100: 2020 2070 7269 6e74 2866 6974 5265 7375     print(fitResu
+00006110: 6c74 5b31 5d29 0a20 2020 200a 2020 2320  lt[1]).    .  # 
+00006120: 7072 6f64 7563 6520 6669 6775 7265 2077  produce figure w
+00006130: 6974 6820 6461 7461 2061 6e64 206d 6f64  ith data and mod
+00006140: 656c 0a20 2069 6620 706c 6f74 3a0a 2020  el.  if plot:.  
+00006150: 2020 6669 6720 3d20 696e 6465 7865 6446    fig = indexedF
+00006160: 6974 2e70 6c6f 744d 6f64 656c 2861 7869  it.plotModel(axi
+00006170: 735f 6c61 6265 6c73 3d61 7869 735f 6c61  s_labels=axis_la
+00006180: 6265 6c73 2c0a 2020 2020 2020 2020 2020  bels,.          
+00006190: 2020 2020 2020 2064 6174 615f 6c65 6765         data_lege
+000061a0: 6e64 3d64 6174 615f 6c65 6765 6e64 2c0a  nd=data_legend,.
+000061b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061c0: 206d 6f64 656c 5f6c 6567 656e 643d 6d6f   model_legend=mo
+000061d0: 6465 6c5f 6c65 6765 6e64 2c0a 2020 2020  del_legend,.    
+000061e0: 2020 2020 2020 2020 2020 2020 2070 6c6f               plo
+000061f0: 745f 6261 6e64 3d70 6c6f 745f 6261 6e64  t_band=plot_band
+00006200: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006210: 2020 2073 616d 655f 706c 6f74 203d 2073     same_plot = s
+00006220: 616d 655f 706c 6f74 2c0a 2020 2020 2020  ame_plot,.      
+00006230: 2020 2020 2020 2020 2020 2070 6c6f 745f             plot_
+00006240: 7265 7369 6475 616c 3d70 6c6f 745f 7265  residual=plot_re
+00006250: 7369 6475 616c 290a 0a20 2023 2066 6967  sidual)..  # fig
+00006260: 7572 6520 7769 7468 2076 6973 7561 6c20  ure with visual 
+00006270: 7265 7072 6573 656e 7461 7469 6f6e 206f  representation o
+00006280: 6620 636f 7661 7269 616e 6365 730a 2020  f covariances.  
+00006290: 2320 2020 7072 6f66 696c 6520 6c69 6b65  #   profile like
+000062a0: 6c69 686f 6f64 2073 6361 6e20 616e 6420  lihood scan and 
+000062b0: 636f 6e66 6964 656e 6365 2063 6f6e 746f  confidence conto
+000062c0: 7572 730a 2020 6966 2070 6c6f 745f 636f  urs.  if plot_co
+000062d0: 723a 0a20 2020 2066 6967 5f63 6f72 203d  r:.    fig_cor =
+000062e0: 2069 6e64 6578 6564 4669 742e 706c 6f74   indexedFit.plot
+000062f0: 436f 6e74 6f75 7273 2866 6967 6e61 6d65  Contours(figname
+00006300: 3d22 7879 4669 743a 2050 726f 6669 6c65  ="xyFit: Profile
+00006310: 7320 616e 6420 436f 6e74 6f75 7273 2229  s and Contours")
+00006320: 0a0a 2020 2320 7368 6f77 2070 6c6f 7473  ..  # show plots
+00006330: 206f 6e20 7363 7265 656e 0a20 2069 6620   on screen.  if 
+00006340: 7368 6f77 706c 6f74 7320 616e 6420 2870  showplots and (p
+00006350: 6c6f 7420 6f72 2070 6c6f 745f 636f 7229  lot or plot_cor)
+00006360: 3a0a 2020 2020 706c 742e 7368 6f77 2829  :.    plt.show()
+00006370: 0a0a 2020 6966 2072 6574 7572 6e5f 6669  ..  if return_fi
+00006380: 744f 626a 6563 743a 0a20 2020 2072 6574  tObject:.    ret
+00006390: 7572 6e20 696e 6465 7865 6446 6974 0a20  urn indexedFit. 
+000063a0: 2065 6c73 653a 0a20 2020 2023 2072 6574   else:.    # ret
+000063b0: 7572 6e0a 2020 2020 2320 2020 6e75 6d70  urn.    #   nump
+000063c0: 7920 6172 7261 7973 2077 6974 6820 6669  y arrays with fi
+000063d0: 7420 7265 7375 6c74 3a20 7061 7261 6d65  t result: parame
+000063e0: 7465 7220 7661 6c75 6573 2c0a 2020 2020  ter values,.    
+000063f0: 2320 2020 6e65 6761 7469 7665 2061 6e64  #   negative and
+00006400: 2070 6f73 6974 6976 6520 7061 7261 6d65   positive parame
+00006410: 7465 7220 756e 6365 7274 6169 6e74 6965  ter uncertaintie
+00006420: 732c 0a20 2020 2023 2020 2063 6f72 7265  s,.    #   corre
+00006430: 6c61 7469 6f6e 206d 6174 7269 780a 2020  lation matrix.  
+00006440: 2020 2320 2020 676f 660a 2020 2020 2320    #   gof.    # 
+00006450: 2020 7061 7261 6d65 7465 7220 6e61 6d65    parameter name
+00006460: 730a 2020 2020 7265 7475 726e 2069 6e64  s.    return ind
+00006470: 6578 6564 4669 742e 6765 7452 6573 756c  exedFit.getResul
+00006480: 7428 290a 0a64 6566 2068 4669 7428 6669  t()..def hFit(fi
+00006490: 7466 2c20 6269 6e5f 636f 6e74 656e 7473  tf, bin_contents
+000064a0: 2c20 6269 6e5f 6564 6765 732c 2044 656c  , bin_edges, Del
+000064b0: 7461 4d75 3d4e 6f6e 652c 0a20 2020 2020  taMu=None,.     
+000064c0: 2020 2020 6d6f 6465 6c5f 6b77 6172 6773      model_kwargs
+000064d0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+000064e0: 2020 7030 203d 204e 6f6e 652c 2064 7030    p0 = None, dp0
+000064f0: 203d 204e 6f6e 652c 2063 6f6e 7374 7261   = None, constra
+00006500: 696e 7473 203d 204e 6f6e 652c 0a20 2020  ints = None,.   
+00006510: 2020 2020 2020 6669 7850 6172 733d 4e6f        fixPars=No
+00006520: 6e65 2c20 6c69 6d69 7473 3d4e 6f6e 652c  ne, limits=None,
+00006530: 0a20 2020 2020 2020 2020 7573 655f 4761  .         use_Ga
+00006540: 7573 7341 7070 726f 7820 3d20 4661 6c73  ussApprox = Fals
+00006550: 652c 0a20 2020 2020 2020 2020 6669 745f  e,.         fit_
+00006560: 6465 6e73 6974 7920 3d20 5472 7565 2c0a  density = True,.
+00006570: 2020 2020 2020 2020 2070 6c6f 7420 3d20           plot = 
+00006580: 5472 7565 2c20 706c 6f74 5f63 6f72 203d  True, plot_cor =
+00006590: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+000065a0: 2073 686f 7770 6c6f 7473 203d 2054 7275   showplots = Tru
+000065b0: 652c 2070 6c6f 745f 6261 6e64 3d54 7275  e, plot_band=Tru
+000065c0: 652c 2070 6c6f 745f 7265 7369 6475 616c  e, plot_residual
+000065d0: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+000065e0: 2073 616d 655f 706c 6f74 203d 2046 616c   same_plot = Fal
+000065f0: 7365 2c20 2020 2023 206f 7665 726c 6179  se,    # overlay
+00006600: 2066 6974 2069 6e66 6f20 6672 6f6d 2070   fit info from p
+00006610: 7265 7669 6f69 7573 2063 616c 6c28 7329  revioius call(s)
+00006620: 0a20 2020 2020 2020 2020 7175 6965 7420  .         quiet 
+00006630: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00006640: 2061 7869 735f 6c61 6265 6c73 3d5b 2778   axis_labels=['x
+00006650: 272c 2027 636f 756e 7473 2f62 696e 203d  ', 'counts/bin =
+00006660: 2066 2878 2c20 2a70 6172 2927 5d2c 0a20   f(x, *par)'],. 
+00006670: 2020 2020 2020 2020 6461 7461 5f6c 6567          data_leg
+00006680: 656e 6420 3d20 2748 6973 746f 6772 616d  end = 'Histogram
+00006690: 2044 6174 6127 2c20 2020 200a 2020 2020   Data',    .    
+000066a0: 2020 2020 206d 6f64 656c 5f6c 6567 656e       model_legen
+000066b0: 6420 3d20 274d 6f64 656c 272c 0a20 2020  d = 'Model',.   
+000066c0: 2020 2020 2020 7265 7475 726e 5f66 6974        return_fit
+000066d0: 4f62 6a65 6374 3d46 616c 7365 2029 203a  Object=False ) :
+000066e0: 0a20 200a 2020 2222 2257 7261 7070 6572  .  .  """Wrapper
+000066f0: 2066 756e 6374 696f 6e20 746f 2066 6974   function to fit
+00006700: 2061 2064 656e 7369 7479 2064 6973 7472   a density distr
+00006710: 6962 7574 696f 6e20 6628 782c 205c 2a70  ibution f(x, \*p
+00006720: 6172 2920 0a20 2074 6f20 6269 6e6e 6564  ar) .  to binned
+00006730: 2064 6174 6120 2868 6973 746f 6772 616d   data (histogram
+00006740: 2920 7769 7468 2063 6c61 7373 206d 6e46  ) with class mnF
+00006750: 6974 200a 2020 0a20 2054 6865 2063 6f73  it .  .  The cos
+00006760: 7420 6675 6e63 7469 6f6e 2069 7320 7477  t function is tw
+00006770: 6f20 7469 6d65 7320 7468 6520 6e65 6761  o times the nega
+00006780: 7469 7665 206c 6f67 2d6c 696b 656c 6968  tive log-likelih
+00006790: 6f6f 6420 6f66 2074 6865 2050 6f69 7373  ood of the Poiss
+000067a0: 6f6e 200a 2020 6469 7374 7269 6275 7469  on .  distributi
+000067b0: 6f6e 2c20 6f72 202d 206f 7074 696f 6e61  on, or - optiona
+000067c0: 6c6c 7920 2d20 6f66 2074 6865 2047 6175  lly - of the Gau
+000067d0: 7373 6961 6e20 6170 7072 6f78 696d 6174  ssian approximat
+000067e0: 696f 6e2e 0a0a 2020 556e 6365 7274 6169  ion...  Uncertai
+000067f0: 6e74 6965 7320 6172 6520 6465 7465 726d  nties are determ
+00006800: 696e 6564 2066 726f 6d20 7468 6520 6d6f  ined from the mo
+00006810: 6465 6c20 7661 6c75 6573 2069 6e20 6f72  del values in or
+00006820: 6465 7220 746f 2061 766f 6964 2062 6961  der to avoid bia
+00006830: 7365 7320 0a20 2061 6e64 2074 6f20 7461  ses .  and to ta
+00006840: 6b65 2061 6363 6f75 6e74 206f 6620 656d  ke account of em
+00006850: 7074 7920 6269 6e73 206f 6620 616e 2068  pty bins of an h
+00006860: 6973 746f 6772 616d 2e20 5468 6520 6465  istogram. The de
+00006870: 6661 756c 7420 6265 6861 7669 6f75 7220  fault behaviour 
+00006880: 6973 200a 2020 746f 2066 6974 2061 206e  is .  to fit a n
+00006890: 6f72 6d61 6c69 7365 6420 6465 6e73 6974  ormalised densit
+000068a0: 793b 206f 7074 696f 6e61 6c6c 792c 2069  y; optionally, i
+000068b0: 7420 6973 2061 6c73 6f20 706f 7373 6962  t is also possib
+000068c0: 6c65 2074 6f20 6669 7420 7468 6520 0a20  le to fit the . 
+000068d0: 206e 756d 6265 7220 6f66 2062 696e 2065   number of bin e
+000068e0: 6e74 7269 6573 2e0a 0a20 2041 7267 733a  ntries...  Args:
+000068f0: 0a20 2020 202a 2066 6974 663a 206d 6f64  .    * fitf: mod
+00006900: 656c 2066 756e 6374 696f 6e20 746f 2066  el function to f
+00006910: 6974 2c20 6172 6775 6d65 6e74 7320 2866  it, arguments (f
+00006920: 6c6f 6174 3a78 2c20 666c 6f61 743a 205c  loat:x, float: \
+00006930: 2a61 7267 7329 0a20 2020 202a 2062 696e  *args).    * bin
+00006940: 5f63 6f6e 7465 6e74 733a 2020 0a20 2020  _contents:  .   
+00006950: 202a 2062 696e 5f65 6467 6573 3a20 0a20   * bin_edges: . 
+00006960: 2020 202a 2044 656c 7461 4d75 3a20 7368     * DeltaMu: sh
+00006970: 6966 7420 6d65 616e 2028 3d6d 7529 2076  ift mean (=mu) v
+00006980: 732e 2076 6172 6961 6e63 6520 283d 6c61  s. variance (=la
+00006990: 6d29 2c20 666f 7220 506f 6973 736f 6e3a  m), for Poisson:
+000069a0: 206d 753d 6c61 6d0a 2020 2020 2a20 6d6f   mu=lam.    * mo
+000069b0: 6465 6c5f 6b77 6172 6773 3a20 6f70 7469  del_kwargs: opti
+000069c0: 6f6e 616c 2c20 6669 7420 7061 7261 6d65  onal, fit parame
+000069d0: 7465 7273 2069 6620 6e6f 7420 6672 6f6d  ters if not from
+000069e0: 206d 6f64 656c 2073 6967 6e61 7475 7265   model signature
+000069f0: 200a 2020 2020 2a20 7030 3a20 6172 7261   .    * p0: arra
+00006a00: 792d 6c69 6b65 2c20 696e 6974 6961 6c20  y-like, initial 
+00006a10: 6775 6573 7320 6f66 2070 6172 616d 6574  guess of paramet
+00006a20: 6572 730a 2020 2020 2a20 6470 303a 2061  ers.    * dp0: a
+00006a30: 7272 6179 2d6c 696b 652c 2069 6e69 7469  rray-like, initi
+00006a40: 616c 2067 7565 7373 206f 6620 7061 7261  al guess of para
+00006a50: 6d65 7465 7220 756e 6365 7274 6169 6e74  meter uncertaint
+00006a60: 6965 7320 286f 7074 696f 6e61 6c29 0a20  ies (optional). 
+00006a70: 2020 202a 2063 6f6e 7374 7261 696e 7473     * constraints
+00006a80: 3a20 286e 6573 7465 6429 206c 6973 7428  : (nested) list(
+00006a90: 7329 205b 6e61 6d65 206f 7220 6964 2c20  s) [name or id, 
+00006aa0: 7661 6c75 652c 2065 7272 6f72 5d20 0a20  value, error] . 
+00006ab0: 2020 202a 206c 696d 6974 733a 2028 6e65     * limits: (ne
+00006ac0: 7374 6564 2920 6c69 7374 2873 2920 5b6e  sted) list(s) [n
+00006ad0: 616d 6520 6f72 2069 642c 206d 696e 2c20  ame or id, min, 
+00006ae0: 6d61 785d 200a 2020 2020 2a20 7573 655f  max] .    * use_
+00006af0: 4761 7573 7341 7070 726f 783a 2047 6175  GaussApprox: Gau
+00006b00: 7373 6961 6e20 6170 7072 6f78 696d 6174  ssian approximat
+00006b10: 696f 6e20 696e 7374 6561 6420 6f66 2050  ion instead of P
+00006b20: 6f69 7373 6f6e 200a 2020 2020 2a20 6465  oisson .    * de
+00006b30: 6e73 6974 793a 2066 6974 2064 656e 7369  nsity: fit densi
+00006b40: 7479 2028 6e6f 7420 6e75 6d62 6572 206f  ty (not number o
+00006b50: 6620 6576 656e 7473 290a 2020 2020 2a20  f events).    * 
+00006b60: 706c 6f74 3a20 7368 6f77 2064 6174 6120  plot: show data 
+00006b70: 616e 6420 6d6f 6465 6c20 6966 2054 7275  and model if Tru
+00006b80: 650a 2020 2020 2a20 706c 6f74 5f63 6f72  e.    * plot_cor
+00006b90: 3a20 7368 6f77 2070 726f 6669 6c65 206c  : show profile l
+00006ba0: 696b 656c 6968 6f6f 6473 2061 6e64 2063  ikelihoods and c
+00006bb0: 6f6e 6669 6465 6e63 6520 636f 6e74 6f75  onfidence contou
+00006bc0: 7273 0a20 2020 202a 2070 6c6f 745f 6261  rs.    * plot_ba
+00006bd0: 6e64 3a20 706c 6f74 2075 6e63 6572 7461  nd: plot uncerta
+00006be0: 696e 7479 2062 616e 6420 6172 6f75 6e64  inty band around
+00006bf0: 206d 6f64 656c 2066 756e 6374 696f 6e0a   model function.
+00006c00: 2020 2020 2a20 7361 6d65 5f70 6c6f 743a      * same_plot:
+00006c10: 206f 7665 726c 6179 2066 6974 2069 6e66   overlay fit inf
+00006c20: 6f20 6672 6f6d 2070 7265 7669 6f75 7320  o from previous 
+00006c30: 6361 6c6c 2873 290a 2020 2020 2a20 706c  call(s).    * pl
+00006c40: 6f74 5f72 6573 6964 7561 6c3a 2070 6c6f  ot_residual: plo
+00006c50: 7420 7265 7369 6475 616c 7320 772e 722e  t residuals w.r.
+00006c60: 742e 206d 6f64 656c 2069 6e73 7465 6164  t. model instead
+00006c70: 206f 6620 6d6f 6465 6c20 6675 6e63 7469   of model functi
+00006c80: 6f6e 0a20 2020 202a 2073 686f 7770 6c6f  on.    * showplo
+00006c90: 7473 3a20 7368 6f77 2070 6c6f 7473 206f  ts: show plots o
+00006ca0: 6e20 7363 7265 656e 0a20 2020 202a 2071  n screen.    * q
+00006cb0: 7569 6574 3a20 7375 7070 7265 7373 2070  uiet: suppress p
+00006cc0: 7269 6e74 6f75 740a 2020 2020 2a20 6178  rintout.    * ax
+00006cd0: 6973 5f6c 6162 6573 3a20 6c69 7374 206f  is_labes: list o
+00006ce0: 6620 746f 7720 7374 7269 6e67 732c 2061  f tow strings, a
+00006cf0: 7869 7320 6c61 6265 6c73 0a20 2020 202a  xis labels.    *
+00006d00: 2064 6174 615f 6c65 6765 6e64 3a20 6c65   data_legend: le
+00006d10: 6765 6e64 2065 6e74 7279 2066 6f72 2064  gend entry for d
+00006d20: 6174 610a 2020 2020 2a20 6d6f 6465 6c5f  ata.    * model_
+00006d30: 6c65 6765 6e64 3a20 6c65 6765 6e64 2065  legend: legend e
+00006d40: 6e74 7279 2066 6f72 206d 6f64 656c 200a  ntry for model .
+00006d50: 2020 2020 2a20 626f 6f6c 3a20 666f 7220      * bool: for 
+00006d60: 6578 7065 7274 7320 6f6e 6c79 2c20 7265  experts only, re
+00006d70: 7475 726e 2069 6e73 7461 6e63 6520 6f66  turn instance of
+00006d80: 2063 6c61 7373 206d 6e46 6974 2074 6f20   class mnFit to 
+00006d90: 6769 7665 2061 6363 6573 7320 0a20 2020  give access .   
+00006da0: 2020 2074 6f20 6461 7461 206d 656d 6265     to data membe
+00006db0: 7273 2061 6e64 206d 6574 686f 6473 0a0a  rs and methods..
+00006dc0: 2020 5265 7475 726e 733a 0a20 2020 202a    Returns:.    *
+00006dd0: 206e 702d 6172 7261 7920 6f66 2066 6c6f   np-array of flo
+00006de0: 6174 3a20 7061 7261 6d65 7465 7220 7661  at: parameter va
+00006df0: 6c75 6573 0a20 2020 202a 2032 6420 6e70  lues.    * 2d np
+00006e00: 2d61 7272 6179 206f 6620 666c 6f61 743a  -array of float:
+00006e10: 2070 6172 616d 6574 6572 2075 6e63 6572   parameter uncer
+00006e20: 7461 696e 7469 6573 205b 305d 3a20 6e65  tainties [0]: ne
+00006e30: 672e 2061 6e64 205b 315d 3a20 706f 732e  g. and [1]: pos.
+00006e40: 200a 2020 2020 2a20 6e70 2d61 7272 6179   .    * np-array
+00006e50: 3a20 636f 7272 656c 6174 696f 6e20 6d61  : correlation ma
+00006e60: 7472 6978 200a 2020 2020 2a20 666c 6f61  trix .    * floa
+00006e70: 743a 2032 2a6e 6567 4c6f 6720 4c2c 2063  t: 2*negLog L, c
+00006e80: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
+00006e90: 5c63 6869 2d73 7175 6172 6520 6f66 2066  \chi-square of f
+00006ea0: 6974 2061 206d 696e 696d 756d 0a20 2022  it a minimum.  "
+00006eb0: 2222 0a0a 2020 2323 2066 726f 6d20 2e70  ""..  ## from .p
+00006ec0: 6879 4669 7420 696d 706f 7274 206d 6e46  hyFit import mnF
+00006ed0: 6974 2023 2120 616c 7265 6164 7920 636f  it #! already co
+00006ee0: 6e74 6169 6e65 6420 696e 2074 6869 7320  ntained in this 
+00006ef0: 6669 6c65 0a0a 2020 2320 7365 7420 7570  file..  # set up
+00006f00: 2061 2066 6974 206f 626a 6563 7420 666f   a fit object fo
+00006f10: 7220 6869 7374 6f67 7261 6d20 6669 7473  r histogram fits
+00006f20: 0a20 2046 6974 203d 206d 6e46 6974 2827  .  Fit = mnFit('
+00006f30: 6869 7374 2729 0a0a 2020 2320 7365 7420  hist')..  # set 
+00006f40: 6465 6661 756c 7420 6f70 7469 6f6e 730a  default options.
+00006f50: 2020 4669 742e 7365 744f 7074 696f 6e73    Fit.setOptions
+00006f60: 2872 756e 5f6d 696e 6f73 203d 2054 7275  (run_minos = Tru
+00006f70: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00006f80: 2020 2020 7573 655f 4761 7573 7341 7070      use_GaussApp
+00006f90: 726f 7820 3d20 7573 655f 4761 7573 7341  rox = use_GaussA
+00006fa0: 7070 726f 782c 0a20 2020 2020 2020 2020  pprox,.         
+00006fb0: 2020 2020 2020 2020 6669 745f 6465 6e73          fit_dens
+00006fc0: 6974 7920 3d20 6669 745f 6465 6e73 6974  ity = fit_densit
+00006fd0: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00006fe0: 2020 2020 7175 6965 7420 3d20 7175 6965      quiet = quie
+00006ff0: 7429 0a0a 2020 2320 7061 7373 2064 6174  t)..  # pass dat
+00007000: 6120 616e 6420 756e 6365 7274 6169 6e74  a and uncertaint
+00007010: 6965 7320 746f 2066 6974 206f 626a 6563  ies to fit objec
+00007020: 740a 2020 4669 742e 696e 6974 5f64 6174  t.  Fit.init_dat
+00007030: 6128 6269 6e5f 636f 6e74 656e 7473 2c20  a(bin_contents, 
+00007040: 6269 6e5f 6564 6765 732c 2044 656c 7461  bin_edges, Delta
+00007050: 4d75 290a 2020 2023 2070 6173 7320 6d6f  Mu).   # pass mo
+00007060: 6465 6c20 6675 6374 696f 6e2c 2073 7461  del fuction, sta
+00007070: 7274 2070 6172 616d 6574 6572 2061 6e64  rt parameter and
+00007080: 2070 6f73 7369 6265 2063 6f6e 7374 7261   possibe constra
+00007090: 696e 7473 0a20 2046 6974 2e69 6e69 745f  ints.  Fit.init_
+000070a0: 6669 7428 6669 7466 2c20 6d6f 6465 6c5f  fit(fitf, model_
+000070b0: 6b77 6172 6773 3d6d 6f64 656c 5f6b 7761  kwargs=model_kwa
+000070c0: 7267 732c 2070 303d 7030 2c20 6470 303d  rgs, p0=p0, dp0=
+000070d0: 6470 302c 0a20 2020 2020 2020 2020 2020  dp0,.           
+000070e0: 2020 2020 636f 6e73 7472 6169 6e74 733d      constraints=
+000070f0: 636f 6e73 7472 6169 6e74 732c 0a20 2020  constraints,.   
+00007100: 2020 2020 2020 2020 2020 2020 6669 7850              fixP
+00007110: 6172 733d 6669 7850 6172 732c 0a20 2020  ars=fixPars,.   
+00007120: 2020 2020 2020 2020 2020 2020 6c69 6d69              limi
+00007130: 7473 3d6c 696d 6974 7329 0a20 2023 2070  ts=limits).  # p
+00007140: 6572 666f 726d 2074 6865 2066 6974 0a20  erform the fit. 
+00007150: 2066 6974 5265 7375 6c74 203d 2046 6974   fitResult = Fit
+00007160: 2e64 6f5f 6669 7428 290a 2020 2320 7072  .do_fit().  # pr
+00007170: 696e 7420 6669 7420 7265 7375 6c74 2028  int fit result (
+00007180: 6469 6374 696f 6e61 7279 2066 726f 6d20  dictionary from 
+00007190: 6d69 6772 6164 2f6d 696e 6f73 280a 2020  migrad/minos(.  
+000071a0: 6966 206e 6f74 2071 7569 6574 3a0a 2020  if not quiet:.  
+000071b0: 2020 7072 696e 7428 225c 6e46 6974 2052    print("\nFit R
+000071c0: 6573 756c 7420 6672 6f6d 206d 6967 7261  esult from migra
+000071d0: 643a 2229 0a20 2020 2070 7269 6e74 2866  d:").    print(f
+000071e0: 6974 5265 7375 6c74 5b30 5d29 0a20 2020  itResult[0]).   
+000071f0: 2069 6620 6669 7452 6573 756c 745b 315d   if fitResult[1]
+00007200: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00007210: 2020 2020 7072 696e 7428 225c 6e52 6573      print("\nRes
+00007220: 756c 7420 6f66 206d 696e 6f73 2065 7272  ult of minos err
+00007230: 6f72 2061 6e61 6c79 7369 733a 2229 0a20  or analysis:"). 
+00007240: 2020 2020 2070 7269 6e74 2866 6974 5265       print(fitRe
+00007250: 7375 6c74 5b31 5d29 0a20 2020 200a 2020  sult[1]).    .  
+00007260: 2320 7072 6f64 7563 6520 6669 6775 7265  # produce figure
+00007270: 2077 6974 6820 6461 7461 2061 6e64 206d   with data and m
+00007280: 6f64 656c 0a20 2069 6620 706c 6f74 3a0a  odel.  if plot:.
+00007290: 2020 2020 6669 6720 3d20 4669 742e 706c      fig = Fit.pl
+000072a0: 6f74 4d6f 6465 6c28 6178 6973 5f6c 6162  otModel(axis_lab
+000072b0: 656c 733d 6178 6973 5f6c 6162 656c 732c  els=axis_labels,
+000072c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000072d0: 2020 6461 7461 5f6c 6567 656e 643d 6461    data_legend=da
+000072e0: 7461 5f6c 6567 656e 642c 0a20 2020 2020  ta_legend,.     
+000072f0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+00007300: 6c5f 6c65 6765 6e64 3d6d 6f64 656c 5f6c  l_legend=model_l
+00007310: 6567 656e 642c 0a20 2020 2020 2020 2020  egend,.         
+00007320: 2020 2020 2020 2020 706c 6f74 5f62 616e          plot_ban
+00007330: 643d 706c 6f74 5f62 616e 642c 0a20 2020  d=plot_band,.   
+00007340: 2020 2020 2020 2020 2020 2020 2020 7361                sa
+00007350: 6d65 5f70 6c6f 7420 3d20 7361 6d65 5f70  me_plot = same_p
+00007360: 6c6f 742c 0a20 2020 2020 2020 2020 2020  lot,.           
+00007370: 2020 2020 2020 706c 6f74 5f72 6573 6964        plot_resid
+00007380: 7561 6c3d 706c 6f74 5f72 6573 6964 7561  ual=plot_residua
+00007390: 6c29 0a0a 2020 2320 6669 6775 7265 2077  l)..  # figure w
+000073a0: 6974 6820 7669 7375 616c 2072 6570 7265  ith visual repre
+000073b0: 7365 6e74 6174 696f 6e20 6f66 2063 6f76  sentation of cov
+000073c0: 6172 6961 6e63 6573 0a20 2023 2020 2070  ariances.  #   p
+000073d0: 726f 6669 6c65 206c 696b 656c 6968 6f6f  rofile likelihoo
+000073e0: 6420 7363 616e 2061 6e64 2063 6f6e 6669  d scan and confi
+000073f0: 6465 6e63 6520 636f 6e74 6f75 7273 0a20  dence contours. 
+00007400: 2069 6620 706c 6f74 5f63 6f72 3a0a 2020   if plot_cor:.  
+00007410: 2020 6669 675f 636f 7220 3d20 4669 742e    fig_cor = Fit.
+00007420: 706c 6f74 436f 6e74 6f75 7273 2866 6967  plotContours(fig
+00007430: 6e61 6d65 3d22 6869 7374 4669 743a 2050  name="histFit: P
+00007440: 726f 6669 6c65 7320 616e 6420 436f 6e74  rofiles and Cont
+00007450: 6f75 7273 2229 0a0a 2020 2320 7368 6f77  ours")..  # show
+00007460: 2070 6c6f 7473 206f 6e20 7363 7265 656e   plots on screen
+00007470: 0a20 2069 6620 7368 6f77 706c 6f74 7320  .  if showplots 
+00007480: 616e 6420 2870 6c6f 7420 6f72 2070 6c6f  and (plot or plo
+00007490: 745f 636f 7229 3a0a 2020 2020 706c 742e  t_cor):.    plt.
+000074a0: 7368 6f77 2829 0a0a 2020 6966 2072 6574  show()..  if ret
+000074b0: 7572 6e5f 6669 744f 626a 6563 743a 0a20  urn_fitObject:. 
+000074c0: 2020 2072 6574 7572 6e20 4669 740a 2020     return Fit.  
+000074d0: 656c 7365 3a0a 2020 2020 2320 7265 7475  else:.    # retu
+000074e0: 726e 0a20 2020 2023 2020 206e 756d 7079  rn.    #   numpy
+000074f0: 2061 7272 6179 7320 7769 7468 2066 6974   arrays with fit
+00007500: 2072 6573 756c 743a 2070 6172 616d 6574   result: paramet
+00007510: 6572 2076 616c 7565 732c 0a20 2020 2023  er values,.    #
+00007520: 2020 206e 6567 6174 6976 6520 616e 6420     negative and 
+00007530: 706f 7369 7469 7665 2070 6172 616d 6574  positive paramet
+00007540: 6572 2075 6e63 6572 7461 696e 7469 6573  er uncertainties
+00007550: 2c0a 2020 2020 2320 2020 636f 7272 656c  ,.    #   correl
+00007560: 6174 696f 6e20 6d61 7472 6978 0a20 2020  ation matrix.   
+00007570: 2023 2020 2067 6f66 0a20 2020 2023 2020   #   gof.    #  
+00007580: 2070 6172 616d 6574 6572 206e 616d 6573   parameter names
+00007590: 0a20 2020 2072 6574 7572 6e20 4669 742e  .    return Fit.
+000075a0: 6765 7452 6573 756c 7428 290a 0a64 6566  getResult()..def
+000075b0: 2068 4669 745f 6672 6f6d 5f79 616d 6c28   hFit_from_yaml(
+000075c0: 6664 2c20 2020 2020 2020 2020 2020 2320  fd,           # 
+000075d0: 6469 6374 696f 6e61 7279 2064 6566 696e  dictionary defin
+000075e0: 696e 6720 6669 7420 696e 7075 740a 2020  ing fit input.  
+000075f0: 2020 2020 2020 2020 2020 2070 6c6f 743d             plot=
+00007600: 5472 7565 2c20 2020 2020 2020 2020 2023  True,          #
+00007610: 2070 6c6f 7420 6461 7461 2061 6e64 206d   plot data and m
+00007620: 6f64 656c 0a20 2020 2020 2020 2020 2020  odel.           
+00007630: 2020 706c 6f74 5f62 616e 643d 5472 7565    plot_band=True
+00007640: 2c20 2020 2020 2320 706c 6f74 206d 6f64  ,     # plot mod
+00007650: 656c 2063 6f6e 6669 6465 6e63 652d 6261  el confidence-ba
+00007660: 6e64 0a20 2020 2020 2020 2020 2020 2020  nd.             
+00007670: 706c 6f74 5f63 6f72 3d46 616c 7365 2c20  plot_cor=False, 
+00007680: 2020 2020 2320 706c 6f74 2070 726f 6669      # plot profi
+00007690: 6c65 7320 6c69 6b65 6c69 686f 6f64 2061  les likelihood a
+000076a0: 6e64 2063 6f6e 746f 7572 730a 2020 2020  nd contours.    
+000076b0: 2020 2020 2020 2020 2073 686f 7770 6c6f           showplo
+000076c0: 7473 203d 2054 7275 652c 2020 2023 2073  ts = True,   # s
+000076d0: 686f 7720 706c 6f74 7320 6f6e 2073 6372  how plots on scr
+000076e0: 6565 6e0a 2020 2020 2020 2020 2020 2020  een.            
+000076f0: 2073 616d 655f 706c 6f74 203d 2054 7275   same_plot = Tru
+00007700: 652c 2020 2023 206f 7665 726c 6179 2066  e,   # overlay f
+00007710: 6974 2069 6e66 6f20 6672 6f6d 2070 7265  it info from pre
+00007720: 7669 6f69 7573 2063 616c 6c28 7329 0a20  vioius call(s). 
+00007730: 2020 2020 2020 2020 2020 2020 7175 6965              quie
+00007740: 743d 5472 7565 2c20 2020 2020 2020 2020  t=True,         
+00007750: 2320 7375 7070 7265 7373 2069 6e66 6f72  # suppress infor
+00007760: 6d61 7469 7665 2070 7269 6e74 6f75 740a  mative printout.
+00007770: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00007780: 7572 6e5f 6669 744f 626a 6563 743d 4661  urn_fitObject=Fa
+00007790: 6c73 6520 2320 0a20 2020 2020 2020 2020  lse # .         
+000077a0: 2020 293a 0a0a 2020 2222 2242 696e 6e65    ):..  """Binne
+000077b0: 6420 6c6f 672d 6c69 6b65 6c69 686f 6f64  d log-likelihood
+000077c0: 2066 6974 2074 6f20 6869 7374 6f67 7261   fit to histogra
+000077d0: 6d20 6461 7461 2077 6974 6820 696e 7075  m data with inpu
+000077e0: 7420 6672 6f6d 2079 616d 6c20 6669 6c65  t from yaml file
+000077f0: 2077 6974 6820 7068 7966 6974 2e68 4669   with phyfit.hFi
+00007800: 7428 290a 0a20 2041 7267 733a 0a20 2020  t()..  Args:.   
+00007810: 202a 2066 643a 2066 6974 2069 6e70 7574   * fd: fit input
+00007820: 2061 7320 6120 6469 6374 696f 6e61 7279   as a dictionary
+00007830: 2c20 6578 7472 6163 7465 6420 6672 6f6d  , extracted from
+00007840: 2061 2066 696c 6520 696e 2079 616d 6c20   a file in yaml 
+00007850: 666f 726d 6174 0a20 2020 202a 2070 6c6f  format.    * plo
+00007860: 743a 2073 686f 7720 6461 7461 2061 6e64  t: show data and
+00007870: 206d 6f64 656c 2069 6620 5472 7565 0a20   model if True. 
+00007880: 2020 202a 2070 6c6f 745f 636f 723a 2073     * plot_cor: s
+00007890: 686f 7720 7072 6f66 696c 6520 6c69 6b65  how profile like
+000078a0: 6c69 686f 6f64 7320 616e 6420 636f 6e66  lihoods and conf
+000078b0: 6964 656e 6365 2063 6f6e 746f 7572 730a  idence contours.
+000078c0: 2020 2020 2a20 706c 6f74 5f62 616e 643a      * plot_band:
+000078d0: 2070 6c6f 7420 756e 6365 7274 6169 6e74   plot uncertaint
+000078e0: 7920 6261 6e64 2061 726f 756e 6420 6d6f  y band around mo
+000078f0: 6465 6c20 6675 6e63 7469 6f6e 0a20 2020  del function.   
+00007900: 202a 2070 6c6f 745f 7265 7369 6475 616c   * plot_residual
+00007910: 3a20 706c 6f74 2072 6573 6964 7561 6c73  : plot residuals
+00007920: 2077 2e72 2e74 2e20 6d6f 6465 6c20 696e   w.r.t. model in
+00007930: 7374 6561 6420 6f66 206d 6f64 656c 2066  stead of model f
+00007940: 756e 6374 696f 6e0a 2020 2020 2a20 7368  unction.    * sh
+00007950: 6f77 706c 6f74 733a 2073 686f 7720 706c  owplots: show pl
+00007960: 6f74 7320 6f6e 2073 6372 6565 6e20 2d20  ots on screen - 
+00007970: 7377 6974 6368 206f 6666 2069 6620 6861  switch off if ha
+00007980: 6e64 6c65 6420 6279 2063 616c 6c69 6e67  ndled by calling
+00007990: 2070 726f 6365 7373 0a20 2020 202a 2071   process.    * q
+000079a0: 7569 6574 3a20 7375 7070 7265 7373 2069  uiet: suppress i
+000079b0: 6e66 6f72 6d61 7469 7665 2070 7269 6e74  nformative print
+000079c0: 6f75 740a 0a20 2052 6574 7572 6e73 3a0a  out..  Returns:.
+000079d0: 2020 2020 2a20 7265 7375 6c74 2064 6963      * result dic
+000079e0: 7469 6f6e 6172 790a 2020 2020 2a20 6f70  tionary.    * op
+000079f0: 7469 6f6e 616c 6c79 3a20 7072 6f64 7563  tionally: produc
+00007a00: 6573 2072 6573 756c 7420 706c 6f74 7320  es result plots 
+00007a10: 0a0a 2020 7369 6d70 6c65 2065 7861 6d70  ..  simple examp
+00007a20: 6c65 206f 6620 2a79 616d 6c2a 2069 6e70  le of *yaml* inp
+00007a30: 7574 3a0a 0a20 202e 2e20 636f 6465 2d62  ut:..  .. code-b
+00007a40: 6c6f 636b 3a3a 2079 616d 6c0a 0a20 2020  lock:: yaml..   
+00007a50: 2023 2045 7861 6d70 6c65 206f 6620 6120   # Example of a 
+00007a60: 6669 7420 746f 2068 6973 746f 6772 616d  fit to histogram
+00007a70: 2064 6174 610a 2020 2020 7479 7065 3a20   data.    type: 
+00007a80: 6869 7374 6f67 7261 6d0a 0a20 2020 206c  histogram..    l
+00007a90: 6162 656c 3a20 6578 616d 706c 6520 6461  abel: example da
+00007aa0: 7461 0a20 2020 2078 5f6c 6162 656c 3a20  ta.    x_label: 
+00007ab0: 2768 2720 0a20 2020 2079 5f6c 6162 656c  'h' .    y_label
+00007ac0: 3a20 2770 6466 2868 2927 0a0a 2020 2020  : 'pdf(h)'..    
+00007ad0: 2320 6461 7461 3a0a 2020 2020 7261 775f  # data:.    raw_
+00007ae0: 6461 7461 3a20 5b20 3739 2e38 332c 3739  data: [ 79.83,79
+00007af0: 2e36 332c 3739 2e36 382c 3739 2e38 322c  .63,79.68,79.82,
+00007b00: 3830 2e38 312c 3739 2e39 372c 3739 2e36  80.81,79.97,79.6
+00007b10: 382c 3830 2e33 322c 3739 2e36 392c 3739  8,80.32,79.69,79
+00007b20: 2e31 382c 0a20 2020 2020 2020 2020 2020  .18,.           
+00007b30: 2038 302e 3034 2c37 392e 3830 2c37 392e   80.04,79.80,79.
+00007b40: 3938 2c38 302e 3135 2c37 392e 3737 2c38  98,80.15,79.77,8
+00007b50: 302e 3330 2c38 302e 3138 2c38 302e 3235  0.30,80.18,80.25
+00007b60: 2c37 392e 3838 2c38 302e 3032 205d 0a0a  ,79.88,80.02 ]..
+00007b70: 2020 2020 6e5f 6269 6e73 3a20 3135 0a20      n_bins: 15. 
+00007b80: 2020 2062 696e 5f72 616e 6765 3a20 5b37     bin_range: [7
+00007b90: 392e 2c20 3831 2e5d 0a20 2020 2023 2061  9., 81.].    # a
+00007ba0: 6c74 6572 6e61 7469 7665 6c79 2061 6e20  lternatively an 
+00007bb0: 6172 7261 7920 666f 7220 7468 6520 6269  array for the bi
+00007bc0: 6e20 6564 6765 7320 6361 6e20 6265 2073  n edges can be s
+00007bd0: 7065 6369 6669 6564 0a20 2020 2023 6269  pecified.    #bi
+00007be0: 6e5f 6564 6765 733a 205b 3739 2e2c 2037  n_edges: [79., 7
+00007bf0: 392e 352c 2038 302c 2038 302e 352c 2038  9.5, 80, 80.5, 8
+00007c00: 312e 5d0a 0a20 2020 206d 6f64 656c 5f64  1.]..    model_d
+00007c10: 656e 7369 7479 5f66 756e 6374 696f 6e3a  ensity_function:
+00007c20: 207c 0a20 2020 2020 2064 6566 206e 6f72   |.      def nor
+00007c30: 6d61 6c5f 6469 7374 7269 6275 7469 6f6e  mal_distribution
+00007c40: 2878 2c20 6d75 3d38 302e 2c20 7369 676d  (x, mu=80., sigm
+00007c50: 613d 312e 293a 0a20 2020 2020 2020 2072  a=1.):.        r
+00007c60: 6574 7572 6e20 6e70 2e65 7870 282d 302e  eturn np.exp(-0.
+00007c70: 352a 2828 7820 2d20 6d75 292f 7369 676d  5*((x - mu)/sigm
+00007c80: 6129 2a2a 2032 292f 6e70 2e73 7172 7428  a)** 2)/np.sqrt(
+00007c90: 322e 2a6e 702e 7069 2a73 6967 6d61 2a2a  2.*np.pi*sigma**
+00007ca0: 2032 290a 0a20 202e 2e20 6d6f 6475 6c65   2)..  .. module
+00007cb0: 6175 7468 6f72 3a3a 2047 7565 6e74 6572  author:: Guenter
+00007cc0: 2051 7561 7374 203c 672e 7175 6173 7440   Quast <g.quast@
+00007cd0: 6b69 742e 6564 753e 0a20 2022 2222 0a0a  kit.edu>.  """..
+00007ce0: 2020 6672 6f6d 2050 6879 5072 614b 6974    from PhyPraKit
+00007cf0: 2069 6d70 6f72 7420 6368 6563 6b5f 6675   import check_fu
+00007d00: 6e63 7469 6f6e 5f63 6f64 650a 2020 2323  nction_code.  ##
+00007d10: 2066 726f 6d20 2e70 6879 4669 7420 696d   from .phyFit im
+00007d20: 706f 7274 2068 4669 7420 2321 2061 6c72  port hFit #! alr
+00007d30: 6561 6479 2063 6f6e 7461 696e 6564 2069  eady contained i
+00007d40: 6e20 7468 6973 2066 696c 650a 0a20 2023  n this file..  #
+00007d50: 2045 7874 7261 6374 2069 6e66 6f72 6d61   Extract informa
+00007d60: 7469 6f6e 2066 726f 6d20 696e 7075 7420  tion from input 
+00007d70: 6469 6374 696f 6e61 7279 2020 200a 2020  dictionary   .  
+00007d80: 6966 2027 6c61 6265 6c27 2069 6e20 6664  if 'label' in fd
+00007d90: 3a0a 2020 2020 6461 7461 5f6c 6162 656c  :.    data_label
+00007da0: 203d 2066 645b 276c 6162 656c 275d 0a20   = fd['label']. 
+00007db0: 2065 6c73 653a 0a20 2020 2064 6174 615f   else:.    data_
+00007dc0: 6c61 6265 6c20 3d20 2764 6174 6127 0a0a  label = 'data'..
+00007dd0: 2320 2d20 6461 7461 0a20 2068 6461 7461  # - data.  hdata
+00007de0: 203d 206c 6973 7428 6d61 7028 666c 6f61   = list(map(floa
+00007df0: 742c 2066 645b 2772 6177 5f64 6174 6127  t, fd['raw_data'
+00007e00: 5d29 290a 2020 6269 6e73 203d 2031 300a  ])).  bins = 10.
+00007e10: 2020 6966 2027 6e5f 6269 6e73 2720 696e    if 'n_bins' in
+00007e20: 2066 643a 0a20 2020 2062 696e 7320 3d20   fd:.    bins = 
+00007e30: 6664 5b27 6e5f 6269 6e73 275d 0a20 2069  fd['n_bins'].  i
+00007e40: 6620 2762 696e 5f65 6467 6573 2720 696e  f 'bin_edges' in
+00007e50: 2066 643a 0a20 2020 2062 696e 7320 3d20   fd:.    bins = 
+00007e60: 6664 5b27 6269 6e5f 6564 6765 7327 5d0a  fd['bin_edges'].
+00007e70: 2020 6269 6e5f 7261 6e67 6520 3d20 4e6f    bin_range = No
+00007e80: 6e65 0a20 2069 6620 2762 696e 5f72 616e  ne.  if 'bin_ran
+00007e90: 6765 2720 696e 2066 643a 0a20 2020 2062  ge' in fd:.    b
+00007ea0: 696e 5f72 616e 6765 203d 2066 645b 2762  in_range = fd['b
+00007eb0: 696e 5f72 616e 6765 275d 0a0a 2020 6966  in_range']..  if
+00007ec0: 2027 785f 6c61 6265 6c27 2069 6e20 6664   'x_label' in fd
+00007ed0: 3a0a 2020 2020 785f 6c61 6265 6c20 3d20  :.    x_label = 
+00007ee0: 6664 5b27 785f 6c61 6265 6c27 5d0a 2020  fd['x_label'].  
+00007ef0: 656c 7365 3a0a 2020 2020 785f 6c61 6265  else:.    x_labe
+00007f00: 6c20 3d20 2778 270a 2020 6966 2027 795f  l = 'x'.  if 'y_
+00007f10: 6c61 6265 6c27 2069 6e20 6664 3a0a 2020  label' in fd:.  
+00007f20: 2020 795f 6c61 6265 6c20 3d20 6664 5b27    y_label = fd['
+00007f30: 795f 6c61 6265 6c27 5d0a 2020 656c 7365  y_label'].  else
+00007f40: 3a0a 2020 2020 795f 6c61 6265 6c20 3d20  :.    y_label = 
+00007f50: 2779 270a 0a23 2066 6978 2070 6172 616d  'y'..# fix param
+00007f60: 6572 7465 7273 0a20 2066 6978 6564 5061  erters.  fixedPa
+00007f70: 7273 203d 204e 6f6e 650a 2020 6966 2027  rs = None.  if '
+00007f80: 6669 785f 7061 7261 6d65 7465 7273 2720  fix_parameters' 
+00007f90: 696e 2066 643a 0a20 2020 2066 6978 6564  in fd:.    fixed
+00007fa0: 5061 7273 203d 205b 5d0a 2020 2020 666f  Pars = [].    fo
+00007fb0: 7220 706e 616d 2069 6e20 6664 5b27 6669  r pnam in fd['fi
+00007fc0: 785f 7061 7261 6d65 7465 7273 275d 3a0a  x_parameters']:.
+00007fd0: 2020 2020 2020 6669 7865 6450 6172 732e        fixedPars.
+00007fe0: 6170 7065 6e64 2870 6e61 6d29 0a20 200a  append(pnam).  .
+00007ff0: 2320 636f 6e73 7472 6169 6e74 730a 2020  # constraints.  
+00008000: 636f 6e73 7472 6169 6e74 7320 3d20 4e6f  constraints = No
+00008010: 6e65 0a20 2069 6620 2770 6172 616d 6574  ne.  if 'paramet
+00008020: 6572 5f63 6f6e 7374 7261 696e 7473 2720  er_constraints' 
+00008030: 696e 2066 643a 0a20 2020 2063 6f6e 7374  in fd:.    const
+00008040: 7261 696e 7473 203d 2020 5b5d 0a20 2020  raints =  [].   
+00008050: 2066 6f72 2070 6e61 6d20 696e 2066 645b   for pnam in fd[
+00008060: 2770 6172 616d 6574 6572 5f63 6f6e 7374  'parameter_const
+00008070: 7261 696e 7473 275d 3a0a 2020 2020 2020  raints']:.      
+00008080: 7675 5f64 6963 7420 3d20 6664 5b27 7061  vu_dict = fd['pa
+00008090: 7261 6d65 7465 725f 636f 6e73 7472 6169  rameter_constrai
+000080a0: 6e74 7327 5d5b 706e 616d 5d0a 2020 2020  nts'][pnam].    
+000080b0: 2020 7620 3d20 7675 5f64 6963 745b 2776    v = vu_dict['v
+000080c0: 616c 7565 275d 0a20 2020 2020 2075 203d  alue'].      u =
+000080d0: 2076 755f 6469 6374 5b27 756e 6365 7274   vu_dict['uncert
+000080e0: 6169 6e74 7927 5d0a 2020 2020 2020 636f  ainty'].      co
+000080f0: 6e73 7472 6169 6e74 732e 6170 7065 6e64  nstraints.append
+00008100: 285b 706e 616d 2c20 762c 2075 205d 290a  ([pnam, v, u ]).
+00008110: 2020 2020 2020 2020 0a23 202d 206d 6f64          .# - mod
+00008120: 656c 206e 616d 6520 616e 6420 7079 7468  el name and pyth
+00008130: 6f6e 2063 6f64 650a 2020 6966 2027 6d6f  on code.  if 'mo
+00008140: 6465 6c5f 6c61 6265 6c27 2069 6e20 6664  del_label' in fd
+00008150: 3a0a 2020 2020 6d6f 6465 6c5f 6c61 6265  :.    model_labe
+00008160: 6c20 3d20 6664 5b27 6d6f 6465 6c5f 6c61  l = fd['model_la
+00008170: 6265 6c27 5d0a 2020 656c 7365 3a0a 2020  bel'].  else:.  
+00008180: 2020 6d6f 6465 6c5f 6c61 6265 6c20 3d20    model_label = 
+00008190: 276d 6f64 656c 270a 2020 7472 793a 0a20  'model'.  try:. 
+000081a0: 2020 2063 6f64 655f 7374 7220 3d20 6664     code_str = fd
+000081b0: 5b27 6d6f 6465 6c5f 6465 6e73 6974 795f  ['model_density_
+000081c0: 6675 6e63 7469 6f6e 275d 5b27 7079 7468  function']['pyth
+000081d0: 6f6e 5f63 6f64 6527 5d0a 2020 6578 6365  on_code'].  exce
+000081e0: 7074 3a0a 2020 2020 7472 793a 0a20 2020  pt:.    try:.   
+000081f0: 2020 2063 6f64 655f 7374 7220 3d20 6664     code_str = fd
+00008200: 5b27 6d6f 6465 6c5f 6465 6e73 6974 795f  ['model_density_
+00008210: 6675 6e63 7469 6f6e 275d 0a20 2020 2065  function'].    e
+00008220: 7863 6570 743a 0a20 2020 2020 2074 7279  xcept:.      try
+00008230: 3a0a 2020 2020 2020 2020 636f 6465 5f73  :.        code_s
+00008240: 7472 203d 2066 645b 276d 6f64 656c 5f66  tr = fd['model_f
+00008250: 756e 6374 696f 6e27 5d0a 2020 2020 2020  unction'].      
+00008260: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+00008270: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00008280: 2822 2121 2120 6e6f 2063 6f64 6520 746f  ("!!! no code to
+00008290: 2066 6974 2066 6f75 6e64 2021 2229 200a   fit found !") .
+000082a0: 2020 6669 7466 5f6e 616d 652c 2063 6f64    fitf_name, cod
+000082b0: 6520 3d20 6368 6563 6b5f 6675 6e63 7469  e = check_functi
+000082c0: 6f6e 5f63 6f64 6528 636f 6465 5f73 7472  on_code(code_str
+000082d0: 2920 2020 200a 0a20 2062 696e 5f63 6f6e  )    ..  bin_con
+000082e0: 7465 6e74 732c 2062 696e 5f65 6467 6573  tents, bin_edges
+000082f0: 203d 206e 702e 6869 7374 6f67 7261 6d28   = np.histogram(
+00008300: 6864 6174 612c 2062 696e 733d 6269 6e73  hdata, bins=bins
+00008310: 2c20 2072 616e 6765 3d62 696e 5f72 616e  ,  range=bin_ran
+00008320: 6765 290a 2020 0a20 2023 2065 7865 6375  ge).  .  # execu
+00008330: 7465 2064 6566 696e 6974 696f 6e20 6f66  te definition of
+00008340: 206d 6f64 656c 2066 756e 6374 696f 6e0a   model function.
+00008350: 2020 7363 6f70 6520 3d20 6469 6374 2829    scope = dict()
+00008360: 0a20 2068 6561 6465 723d 2027 696d 706f  .  header= 'impo
+00008370: 7274 206e 756d 7079 2061 7320 6e70 5c6e  rt numpy as np\n
+00008380: 2720 2b20 2769 6d70 6f72 7420 7363 6970  ' + 'import scip
+00008390: 795c 6e27 200a 2020 6578 6563 2868 6561  y\n' .  exec(hea
+000083a0: 6465 7220 2b20 636f 6465 2c20 7363 6f70  der + code, scop
+000083b0: 6529 0a20 2066 6974 6620 3d20 7363 6f70  e).  fitf = scop
+000083c0: 655b 6669 7466 5f6e 616d 655d 0a20 2023  e[fitf_name].  #
+000083d0: 2063 6865 636b 2075 7365 722d 7072 6f76   check user-prov
+000083e0: 6964 6564 2063 6f64 650a 2020 7472 793a  ided code.  try:
+000083f0: 0a20 2020 2079 203d 2066 6974 6628 6e70  .    y = fitf(np
+00008400: 2e61 7361 7272 6179 2862 696e 5f65 6467  .asarray(bin_edg
+00008410: 6573 2929 0a20 2065 7863 6570 7420 4578  es)).  except Ex
+00008420: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
+00008430: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00008440: 6f72 2822 2121 2120 6d6f 6465 6c20 636f  or("!!! model co
+00008450: 6465 206e 6f74 2076 616c 6964 2021 205c  de not valid ! \
+00008460: 6e22 202b 2073 7472 2865 2929 200a 2020  n" + str(e)) .  
+00008470: 0a20 2023 2070 6572 666f 726d 2066 6974  .  # perform fit
+00008480: 2074 6f20 6461 7461 2077 6974 6820 6675   to data with fu
+00008490: 6e63 7469 6f6e 2068 4669 7420 0a20 2072  nction hFit .  r
+000084a0: 6469 6374 203d 2068 4669 7428 6669 7466  dict = hFit(fitf
+000084b0: 2c0a 2020 2020 2020 2020 2020 6269 6e5f  ,.          bin_
+000084c0: 636f 6e74 656e 7473 2c20 6269 6e5f 6564  contents, bin_ed
+000084d0: 6765 732c 0a20 2020 2020 2020 2020 2066  ges,.          f
+000084e0: 6978 5061 7273 203d 2066 6978 6564 5061  ixPars = fixedPa
+000084f0: 7273 2c0a 2020 2020 2020 2020 2020 636f  rs,.          co
+00008500: 6e73 7472 6169 6e74 7320 3d20 636f 6e73  nstraints = cons
+00008510: 7472 6169 6e74 732c 2020 2020 2020 0a20  traints,      . 
+00008520: 2020 2020 2020 2020 2070 6c6f 7420 3d20           plot = 
+00008530: 706c 6f74 2c0a 2020 2020 2020 2020 2020  plot,.          
+00008540: 706c 6f74 5f63 6f72 203d 2070 6c6f 745f  plot_cor = plot_
+00008550: 636f 722c 0a20 2020 2020 2020 2020 2070  cor,.          p
+00008560: 6c6f 745f 6261 6e64 3d70 6c6f 745f 6261  lot_band=plot_ba
+00008570: 6e64 2c0a 2020 2020 2020 2020 2020 7361  nd,.          sa
+00008580: 6d65 5f70 6c6f 7420 3d20 7361 6d65 5f70  me_plot = same_p
+00008590: 6c6f 742c 0a20 2020 2020 2020 2020 2071  lot,.          q
+000085a0: 7569 6574 203d 2071 7569 6574 2c0a 2020  uiet = quiet,.  
+000085b0: 2020 2020 2020 2020 7368 6f77 706c 6f74          showplot
+000085c0: 7320 3d20 7368 6f77 706c 6f74 732c 0a20  s = showplots,. 
+000085d0: 2020 2020 2020 2020 2061 7869 735f 6c61           axis_la
+000085e0: 6265 6c73 3d5b 785f 6c61 6265 6c2c 2079  bels=[x_label, y
+000085f0: 5f6c 6162 656c 5d2c 0a20 2020 2020 2020  _label],.       
+00008600: 2020 2064 6174 615f 6c65 6765 6e64 203d     data_legend =
+00008610: 2064 6174 615f 6c61 6265 6c2c 2020 2020   data_label,    
+00008620: 0a20 2020 2020 2020 2020 206d 6f64 656c  .          model
+00008630: 5f6c 6567 656e 6420 3d20 6d6f 6465 6c5f  _legend = model_
+00008640: 6c61 6265 6c2c 0a20 2020 2020 2020 2020  label,.         
+00008650: 2072 6574 7572 6e5f 6669 744f 626a 6563   return_fitObjec
+00008660: 743d 7265 7475 726e 5f66 6974 4f62 6a65  t=return_fitObje
+00008670: 6374 0a20 2020 2020 2020 2020 2920 0a20  ct.         ) . 
+00008680: 2072 6574 7572 6e20 7264 6963 740a 0a20   return rdict.. 
+00008690: 200a 6465 6620 6d46 6974 2875 6663 6e2c   .def mFit(ufcn,
+000086a0: 2064 6174 6120 3d20 4e6f 6e65 2c0a 2020   data = None,.  
+000086b0: 2020 2020 2020 206d 6f64 656c 5f6b 7761         model_kwa
+000086c0: 7267 7320 3d20 4e6f 6e65 2c0a 2020 2020  rgs = None,.    
+000086d0: 2020 2020 2070 3020 3d20 4e6f 6e65 2c20       p0 = None, 
+000086e0: 6470 3020 3d20 4e6f 6e65 2c20 0a20 2020  dp0 = None, .   
+000086f0: 2020 2020 2020 636f 6e73 7472 6169 6e74        constraint
+00008700: 7320 3d20 4e6f 6e65 2c20 6c69 6d69 7473  s = None, limits
+00008710: 3d4e 6f6e 652c 2066 6978 5061 7273 3d4e  =None, fixPars=N
+00008720: 6f6e 652c 0a20 2020 2020 2020 2020 6e65  one,.         ne
+00008730: 6732 6c6f 674c 203d 2054 7275 652c 0a20  g2logL = True,. 
+00008740: 2020 2020 2020 2020 706c 6f74 203d 2046          plot = F
+00008750: 616c 7365 2c20 706c 6f74 5f62 616e 6420  alse, plot_band 
+00008760: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00008770: 2070 6c6f 745f 636f 7220 3d20 4661 6c73   plot_cor = Fals
+00008780: 652c 0a20 2020 2020 2020 2020 7368 6f77  e,.         show
+00008790: 706c 6f74 7320 3d20 5472 7565 2c20 7175  plots = True, qu
+000087a0: 6965 7420 3d20 5472 7565 2c0a 2020 2020  iet = True,.    
+000087b0: 2020 2020 2073 616d 655f 706c 6f74 203d       same_plot =
+000087c0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+000087d0: 2061 7869 735f 6c61 6265 6c73 3d5b 2778   axis_labels=['x
+000087e0: 272c 2027 4465 6e73 6974 7920 3d20 6628  ', 'Density = f(
+000087f0: 782c 202a 7061 7229 275d 2c0a 2020 2020  x, *par)'],.    
+00008800: 2020 2020 2064 6174 615f 6c65 6765 6e64       data_legend
+00008810: 203d 2027 6461 7461 272c 2020 2020 0a20   = 'data',    . 
+00008820: 2020 2020 2020 2020 6d6f 6465 6c5f 6c65          model_le
+00008830: 6765 6e64 203d 2027 6d6f 6465 6c27 2c0a  gend = 'model',.
+00008840: 2020 2020 2020 2020 2072 6574 7572 6e5f           return_
+00008850: 6669 744f 626a 6563 743d 4661 6c73 6520  fitObject=False 
+00008860: 2920 3a0a 0a20 2022 2222 5772 6170 7065  ) :..  """Wrappe
+00008870: 7220 6675 6e63 7469 6f6e 2074 6f20 6469  r function to di
+00008880: 7265 6374 6c79 2066 6974 2061 2075 7365  rectly fit a use
+00008890: 722d 6465 6669 6e65 6420 636f 7374 2066  r-defined cost f
+000088a0: 756e 7469 6f6e 0a0a 2020 5468 6973 2069  untion..  This i
+000088b0: 7320 7468 6520 7369 6d70 6c65 7374 2066  s the simplest f
+000088c0: 6974 2070 6f73 7369 626c 6520 7769 7468  it possible with
+000088d0: 2074 6865 2063 6c61 7373 206d 6e46 6974   the class mnFit
+000088e0: 2e20 4966 206e 6f20 6461 7461 2069 730a  . If no data is.
+000088f0: 2020 7370 6563 6966 6965 6420 2864 6174    specified (dat
+00008900: 613d 4e6f 6e65 292c 2061 2075 7365 722d  a=None), a user-
+00008910: 7375 7070 6c69 6564 2063 6f73 7420 6675  supplied cost fu
+00008920: 6e63 7469 6f6e 2028 7566 636e 2920 6973  nction (ufcn) is
+00008930: 206d 696e 696d 697a 6564 200a 2020 616e   minimized .  an
+00008940: 6420 616e 2065 7374 696d 6174 696f 6e20  d an estimation 
+00008950: 6f66 2074 6865 2070 6172 616d 6574 6572  of the parameter
+00008960: 2075 6e63 6572 7461 696e 7469 6573 2070   uncertainties p
+00008970: 6572 666f 726d 6564 2c20 6173 7375 6d69  erformed, assumi
+00008980: 6e67 0a20 2074 6865 2063 6f73 7420 6675  ng.  the cost fu
+00008990: 6e63 7469 6f6e 2069 7320 6120 6e65 6761  nction is a nega
+000089a0: 7469 7665 206c 6f67 2d6c 696b 656c 6968  tive log-likelih
+000089b0: 6f6f 6420 6675 6e63 7469 6f6e 2028 6e6c  ood function (nl
+000089c0: 4c20 6f72 2032 6e4c 4c29 2e0a 2020 0a20  L or 2nLL)..  . 
+000089d0: 2049 6e20 6361 7365 2064 6174 6120 6973   In case data is
+000089e0: 2070 726f 7669 6465 642c 2074 6865 2075   provided, the u
+000089f0: 7365 7220 6675 6e63 7469 6f6e 2060 7566  ser function `uf
+00008a00: 636e 2864 6174 612c 202a 7061 7229 6020  cn(data, *par)` 
+00008a10: 6973 200a 2020 696e 7465 7270 7265 7465  is .  interprete
+00008a20: 6420 6173 2061 2070 6172 616d 6574 6572  d as a parameter
+00008a30: 2d64 6570 656e 6465 6e74 2070 726f 6261  -dependent proba
+00008a40: 6269 6c69 7479 2064 656e 7369 7479 2066  bility density f
+00008a50: 756e 6374 696f 6e2c 2061 6e64 0a20 2074  unction, and.  t
+00008a60: 6865 2070 6172 616d 6574 6572 7320 6172  he parameters ar
+00008a70: 6520 6465 7465 726d 696e 6564 2069 6e20  e determined in 
+00008a80: 616e 2075 6e62 696e 6e65 6420 6c6f 672d  an unbinned log-
+00008a90: 6c69 6b65 6c69 686f 6f64 2061 7070 726f  likelihood appro
+00008aa0: 6163 682e 200a 0a20 2041 7267 733a 0a20  ach. ..  Args:. 
+00008ab0: 2020 202a 2075 6663 6e3a 2075 7365 722d     * ufcn: user-
+00008ac0: 6465 6669 6e65 6420 636f 7374 2066 756e  defined cost fun
+00008ad0: 6374 696f 6e20 6f72 2070 6466 2074 6f20  ction or pdf to 
+00008ae0: 6265 206d 696e 696d 697a 6564 3b20 0a0a  be minimized; ..
+00008af0: 2020 2020 2020 2d20 7566 636e 285c 2a70        - ufcn(\*p
+00008b00: 6172 293a 2074 6865 2075 6e63 6572 7461  ar): the uncerta
+00008b10: 696e 7479 2065 7374 696d 6174 696f 6e20  inty estimation 
+00008b20: 7265 6c69 6573 206f 6e20 7468 6973 2062  relies on this b
+00008b30: 6569 6e67 2061 200a 2020 2020 2020 2020  eing a .        
+00008b40: 6e65 6761 7469 7665 206c 6f67 2d6c 696b  negative log-lik
+00008b50: 656c 6968 6f6f 6420 6675 6e63 7469 6f6e  elihood function
+00008b60: 2028 276e 6c4c 2729 3b20 696e 2074 6869   ('nlL'); in thi
+00008b70: 7320 6361 7365 2c20 6e6f 2064 6174 610a  s case, no data.
+00008b80: 2020 2020 2020 2020 6973 2074 6f20 6265          is to be
+00008b90: 2070 726f 7669 6465 642c 2069 2e65 2e20   provided, i.e. 
+00008ba0: 6064 6174 613d 4e6f 6e65 602e 200a 0a20  `data=None`. .. 
+00008bb0: 2020 2020 202d 2075 6663 6e28 782c 205c       - ufcn(x, \
+00008bc0: 2a70 6172 293a 2061 2070 726f 6261 6269  *par): a probabi
+00008bd0: 6c69 7479 2064 656e 7369 7479 206f 6620  lity density of 
+00008be0: 7468 6520 6461 7461 2060 7860 2064 6570  the data `x` dep
+00008bf0: 656e 6469 6e67 206f 6e0a 2020 2020 2020  ending on.      
+00008c00: 2020 7468 6520 7365 7420 6f66 2070 6172    the set of par
+00008c10: 616d 6574 6572 7320 6070 6172 602e 200a  ameters `par`. .
+00008c20: 0a20 2020 202a 2064 6174 612c 206f 7074  .    * data, opt
+00008c30: 696f 6e61 6c2c 2061 7272 6179 206f 6620  ional, array of 
+00008c40: 666c 6f61 7473 3a20 6f70 7469 6f6e 616c  floats: optional
+00008c50: 2069 6e70 7574 2064 6174 610a 2020 2020   input data.    
+00008c60: 2a20 6d6f 6465 6c5f 6b77 6172 6773 3a20  * model_kwargs: 
+00008c70: 6f70 7469 6f6e 616c 2c20 6669 7420 7061  optional, fit pa
+00008c80: 7261 6d65 7465 7273 2069 6620 6e6f 7420  rameters if not 
+00008c90: 6672 6f6d 206d 6f64 656c 2073 6967 6e61  from model signa
+00008ca0: 7475 7265 200a 2020 2020 2a20 7030 3a20  ture .    * p0: 
+00008cb0: 6172 7261 792d 6c69 6b65 2c20 696e 6974  array-like, init
+00008cc0: 6961 6c20 6775 6573 7320 6f66 2070 6172  ial guess of par
+00008cd0: 616d 6574 6572 730a 2020 2020 2a20 6470  ameters.    * dp
+00008ce0: 303a 2061 7272 6179 2d6c 696b 652c 2069  0: array-like, i
+00008cf0: 6e69 7469 616c 2067 7565 7373 206f 6620  nitial guess of 
+00008d00: 7061 7261 6d65 7465 7220 756e 6365 7274  parameter uncert
+00008d10: 6169 6e74 6965 7320 286f 7074 696f 6e61  ainties (optiona
+00008d20: 6c29 0a20 2020 202a 2063 6f6e 7374 7261  l).    * constra
+00008d30: 696e 7473 3a20 286e 6573 7465 6429 206c  ints: (nested) l
+00008d40: 6973 7428 7329 205b 6e61 6d65 206f 7220  ist(s) [name or 
+00008d50: 6964 2c20 7661 6c75 652c 2065 7272 6f72  id, value, error
+00008d60: 5d20 0a20 2020 202a 206c 696d 6974 733a  ] .    * limits:
+00008d70: 2028 6e65 7374 6564 2920 6c69 7374 2873   (nested) list(s
+00008d80: 2920 5b6e 616d 6520 6f72 2069 642c 206d  ) [name or id, m
+00008d90: 696e 2c20 6d61 785d 200a 2020 2020 2a20  in, max] .    * 
+00008da0: 6e65 6732 6c6f 674c 3a20 7573 6520 3220  neg2logL: use 2 
+00008db0: 2a20 6e6c 4c20 2863 6f72 7265 7370 6f6e  * nlL (correspon
+00008dc0: 6469 6e67 2074 6f20 6120 6c65 6173 742d  ding to a least-
+00008dd0: 7371 7561 7265 732d 7479 7065 2063 6f73  squares-type cos
+00008de0: 7429 0a20 2020 202a 2070 6c6f 743a 2073  t).    * plot: s
+00008df0: 686f 7720 6461 7461 2061 6e64 206d 6f64  how data and mod
+00008e00: 656c 2069 6620 5472 7565 0a20 2020 202a  el if True.    *
+00008e10: 2070 6c6f 745f 6261 6e64 3a20 706c 6f74   plot_band: plot
+00008e20: 2075 6e63 6572 7461 696e 7479 2062 616e   uncertainty ban
+00008e30: 6420 6172 6f75 6e64 206d 6f64 656c 2066  d around model f
+00008e40: 756e 6374 696f 6e0a 2020 2020 2a20 706c  unction.    * pl
+00008e50: 6f74 5f63 6f72 3a20 706c 6f74 206c 696b  ot_cor: plot lik
+00008e60: 656c 6968 6f6f 6420 7072 6f66 696c 6573  elihood profiles
+00008e70: 2061 6e64 2063 6f6e 6669 6465 6e63 6520   and confidence 
+00008e80: 636f 6e74 6f75 7273 206f 6620 7061 7261  contours of para
+00008e90: 6d65 7465 7273 0a20 2020 202a 2073 686f  meters.    * sho
+00008ea0: 7770 6c6f 7473 3a20 7368 6f77 2070 6c6f  wplots: show plo
+00008eb0: 7473 206f 6e20 7363 7265 656e 2028 6361  ts on screen (ca
+00008ec0: 6e20 616c 736f 2062 6520 646f 6e65 2062  n also be done b
+00008ed0: 7920 6361 6c6c 696e 6720 7363 7269 7074  y calling script
+00008ee0: 290a 2020 2020 2a20 7175 6965 743a 2063  ).    * quiet: c
+00008ef0: 6f6e 7472 6f6c 7320 7665 7262 6f73 6520  ontrols verbose 
+00008f00: 6f75 7470 7574 0a20 2020 202a 2062 6f6f  output.    * boo
+00008f10: 6c3a 2066 6f72 2065 7870 6572 7473 206f  l: for experts o
+00008f20: 6e6c 792c 2072 6574 7572 6e20 696e 7374  nly, return inst
+00008f30: 616e 6365 206f 6620 636c 6173 7320 6d6e  ance of class mn
+00008f40: 4669 7420 746f 200a 2020 2020 2020 6769  Fit to .      gi
+00008f50: 7665 2061 6363 6573 7320 746f 2064 6174  ve access to dat
+00008f60: 6120 6d65 6d62 6572 7320 616e 6420 6d65  a members and me
+00008f70: 7468 6f64 730a 2020 2020 2222 220a 0a20  thods.    """.. 
+00008f80: 2023 2066 726f 6d20 2e70 6879 4669 7420   # from .phyFit 
+00008f90: 696d 706f 7274 206d 6e46 6974 2023 2061  import mnFit # a
+00008fa0: 6c72 6561 6479 2063 6f6e 7461 696e 6564  lready contained
+00008fb0: 2069 6e20 7068 7946 6974 2070 6163 6b61   in phyFit packa
+00008fc0: 6765 0a0a 2020 6966 2064 6174 6120 6973  ge..  if data is
+00008fd0: 204e 6f6e 653a 0a20 2020 2066 6974 5f74   None:.    fit_t
+00008fe0: 7970 653d 2275 7365 7222 0a20 2065 6c73  ype="user".  els
+00008ff0: 653a 0a20 2020 2066 6974 5f74 7970 6520  e:.    fit_type 
+00009000: 3d20 226d 6c22 0a20 2075 4669 7420 3d20  = "ml".  uFit = 
+00009010: 6d6e 4669 7428 6669 745f 7479 7065 290a  mnFit(fit_type).
+00009020: 0a20 2023 2073 6574 206f 7074 696f 6e73  .  # set options
+00009030: 0a20 2075 4669 742e 7365 744f 7074 696f  .  uFit.setOptio
+00009040: 6e73 2872 756e 5f6d 696e 6f73 203d 2054  ns(run_minos = T
+00009050: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+00009060: 2020 2020 2020 6e65 6732 6c6f 674c 203d        neg2logL =
+00009070: 206e 6567 326c 6f67 4c2c 0a20 2020 2020   neg2logL,.     
+00009080: 2020 2020 2020 2020 2020 2020 7175 6965              quie
+00009090: 7420 3d20 7175 6965 7429 0a0a 2020 2320  t = quiet)..  # 
+000090a0: 696e 6974 6961 6c69 7a65 2064 6174 6120  initialize data 
+000090b0: 636f 6e74 6169 6e65 7220 6966 2064 6174  container if dat
+000090c0: 6120 6973 2070 726f 7669 6465 640a 2020  a is provided.  
+000090d0: 2320 2021 2121 2069 6620 6e6f 2064 6174  #  !!! if no dat
+000090e0: 6120 6769 7665 6e2c 2074 6865 2075 7365  a given, the use
+000090f0: 722d 7375 7070 6c69 6564 2063 6f73 7420  r-supplied cost 
+00009100: 6675 6e63 7469 6f6e 206d 7573 740a 2020  function must.  
+00009110: 2320 2020 2020 2068 616e 646c 6520 676f  #      handle go
+00009120: 7420 6361 6c75 6c61 7469 6f6e 206f 6620  t calulation of 
+00009130: 7468 6520 636f 7374 2066 756e 6374 696f  the cost functio
+00009140: 6e20 0a20 2069 6620 6461 7461 2069 7320  n .  if data is 
+00009150: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 7546  not None:.    uF
+00009160: 6974 2e69 6e69 745f 6461 7461 2864 6174  it.init_data(dat
+00009170: 6129 0a0a 2020 2320 696e 6974 6961 6c7a  a)..  # initialz
+00009180: 6520 6669 740a 2020 2320 202d 2077 6974  e fit.  #  - wit
+00009190: 6820 7468 6520 7573 6572 2d73 7570 706c  h the user-suppl
+000091a0: 6965 6420 636f 7374 2066 756e 6374 696f  ied cost functio
+000091b0: 6e20 636f 7374 282a 7061 7273 2920 6966  n cost(*pars) if
+000091c0: 206e 6f20 6461 7461 2067 6976 656e 0a20   no data given. 
+000091d0: 2023 2020 2d20 7769 7468 2070 726f 6261   #  - with proba
+000091e0: 6269 6c69 7479 2064 656e 7369 7479 2070  bility density p
+000091f0: 6466 2878 3b20 2a70 6172 7329 2069 6620  df(x; *pars) if 
+00009200: 6461 7461 2028 3d78 2920 7072 6f76 6964  data (=x) provid
+00009210: 6564 200a 2020 7546 6974 2e69 6e69 745f  ed .  uFit.init_
+00009220: 6669 7428 7566 636e 2c20 6d6f 6465 6c5f  fit(ufcn, model_
+00009230: 6b77 6172 6773 3d6d 6f64 656c 5f6b 7761  kwargs=model_kwa
+00009240: 7267 732c 2070 303d 7030 2c20 6470 303d  rgs, p0=p0, dp0=
+00009250: 6470 302c 200a 2020 2020 2020 2020 2020  dp0, .          
+00009260: 2020 2020 2020 636f 6e73 7472 6169 6e74        constraint
+00009270: 7320 3d20 636f 6e73 7472 6169 6e74 732c  s = constraints,
+00009280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009290: 2066 6978 5061 7273 203d 2066 6978 5061   fixPars = fixPa
+000092a0: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
+000092b0: 2020 2020 6c69 6d69 7473 203d 206c 696d      limits = lim
+000092c0: 6974 7329 0a20 2023 2070 6572 666f 726d  its).  # perform
+000092d0: 2074 6865 2066 6974 0a20 2066 6974 5265   the fit.  fitRe
+000092e0: 7375 6c74 203d 2075 4669 742e 646f 5f66  sult = uFit.do_f
+000092f0: 6974 2829 0a20 2023 2070 7269 6e74 2066  it().  # print f
+00009300: 6974 2072 6573 756c 7420 2864 6963 7469  it result (dicti
+00009310: 6f6e 6172 7920 6672 6f6d 206d 6967 7261  onary from migra
+00009320: 642f 6d69 6e6f 7328 0a20 2069 6620 6e6f  d/minos(.  if no
+00009330: 7420 7175 6965 743a 0a20 2020 2070 7269  t quiet:.    pri
+00009340: 6e74 2822 5c6e 4669 7420 5265 7375 6c74  nt("\nFit Result
+00009350: 2066 726f 6d20 6d69 6772 6164 3a22 290a   from migrad:").
+00009360: 2020 2020 7072 696e 7428 6669 7452 6573      print(fitRes
+00009370: 756c 745b 305d 290a 2020 2020 6966 2066  ult[0]).    if f
+00009380: 6974 5265 7375 6c74 5b31 5d20 6973 206e  itResult[1] is n
+00009390: 6f74 204e 6f6e 653a 0a20 2020 2020 2070  ot None:.      p
+000093a0: 7269 6e74 2822 5c6e 5265 7375 6c74 206f  rint("\nResult o
+000093b0: 6620 6d69 6e6f 7320 6572 726f 7220 616e  f minos error an
+000093c0: 616c 7973 6973 3a22 290a 2020 2020 2020  alysis:").      
+000093d0: 7072 696e 7428 6669 7452 6573 756c 745b  print(fitResult[
+000093e0: 315d 290a 2020 2020 0a20 2023 2070 726f  1]).    .  # pro
+000093f0: 6475 6365 2066 6967 7572 6520 7769 7468  duce figure with
+00009400: 2064 6174 6120 616e 6420 6d6f 6465 6c0a   data and model.
+00009410: 2020 6966 2070 6c6f 743a 0a20 2020 2066    if plot:.    f
+00009420: 6967 203d 2075 4669 742e 706c 6f74 4d6f  ig = uFit.plotMo
+00009430: 6465 6c28 6178 6973 5f6c 6162 656c 733d  del(axis_labels=
+00009440: 6178 6973 5f6c 6162 656c 732c 0a20 2020  axis_labels,.   
+00009450: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00009460: 7461 5f6c 6567 656e 643d 6461 7461 5f6c  ta_legend=data_l
+00009470: 6567 656e 642c 0a20 2020 2020 2020 2020  egend,.         
+00009480: 2020 2020 2020 2020 6d6f 6465 6c5f 6c65          model_le
+00009490: 6765 6e64 3d6d 6f64 656c 5f6c 6567 656e  gend=model_legen
+000094a0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+000094b0: 2020 2020 706c 6f74 5f62 616e 643d 706c      plot_band=pl
+000094c0: 6f74 5f62 616e 642c 0a20 2020 2020 2020  ot_band,.       
+000094d0: 2020 2020 2020 2020 2020 7361 6d65 5f70            same_p
+000094e0: 6c6f 743d 7361 6d65 5f70 6c6f 7429 0a20  lot=same_plot). 
+000094f0: 2023 2066 6967 7572 6520 7769 7468 2076   # figure with v
+00009500: 6973 7561 6c20 7265 7072 6573 656e 7461  isual representa
+00009510: 7469 6f6e 206f 6620 636f 7661 7269 616e  tion of covarian
+00009520: 6365 730a 2020 2320 2020 2070 726f 6669  ces.  #    profi
+00009530: 6c65 206c 696b 656c 6968 6f6f 6420 7363  le likelihood sc
+00009540: 616e 2061 6e64 2063 6f6e 6669 6465 6e63  an and confidenc
+00009550: 6520 636f 6e74 6f75 7273 0a20 2069 6620  e contours.  if 
+00009560: 706c 6f74 5f63 6f72 3a0a 2020 2020 6669  plot_cor:.    fi
+00009570: 675f 636f 7220 3d20 7546 6974 2e70 6c6f  g_cor = uFit.plo
+00009580: 7443 6f6e 746f 7572 7328 6669 676e 616d  tContours(fignam
+00009590: 653d 2275 7365 7246 6974 3a20 5072 6f66  e="userFit: Prof
+000095a0: 696c 6573 2061 6e64 2043 6f6e 746f 7572  iles and Contour
+000095b0: 7322 290a 0a20 2023 2073 686f 7720 706c  s")..  # show pl
+000095c0: 6f74 7320 6f6e 2073 6372 6565 6e0a 2020  ots on screen.  
+000095d0: 6966 2073 686f 7770 6c6f 7473 2061 6e64  if showplots and
+000095e0: 2028 706c 6f74 206f 7220 706c 6f74 5f63   (plot or plot_c
+000095f0: 6f72 293a 0a20 2020 2070 6c74 2e73 686f  or):.    plt.sho
+00009600: 7728 290a 0a20 2069 6620 7265 7475 726e  w()..  if return
+00009610: 5f66 6974 4f62 6a65 6374 3a0a 2020 2020  _fitObject:.    
+00009620: 7265 7475 726e 2075 4669 740a 2020 656c  return uFit.  el
+00009630: 7365 3a0a 2020 2020 2320 7265 7475 726e  se:.    # return
+00009640: 0a20 2020 2023 2020 206e 756d 7079 2061  .    #   numpy a
+00009650: 7272 6179 7320 7769 7468 2066 6974 2072  rrays with fit r
+00009660: 6573 756c 743a 2070 6172 616d 6574 6572  esult: parameter
+00009670: 2076 616c 7565 732c 0a20 2020 2023 2020   values,.    #  
+00009680: 206e 6567 6174 6976 6520 616e 6420 706f   negative and po
+00009690: 7369 7469 7665 2070 6172 616d 6574 6572  sitive parameter
+000096a0: 2075 6e63 6572 7461 696e 7469 6573 2c0a   uncertainties,.
+000096b0: 2020 2020 2320 2020 636f 7272 656c 6174      #   correlat
+000096c0: 696f 6e20 6d61 7472 6978 0a20 2020 2023  ion matrix.    #
+000096d0: 2020 2067 6f66 0a20 2020 2023 2020 2070     gof.    #   p
+000096e0: 6172 616d 6574 6572 206e 616d 6573 0a20  arameter names. 
+000096f0: 2020 2072 6574 7572 6e20 7546 6974 2e67     return uFit.g
+00009700: 6574 5265 7375 6c74 2829 0a0a 230a 2320  etResult()..#.# 
+00009710: 2d2d 2d20 6865 6c70 6572 2066 756e 6374  --- helper funct
+00009720: 696f 6e73 0a23 0a64 6566 2067 6574 5f66  ions.#.def get_f
+00009730: 756e 6374 696f 6e53 6967 6e61 7475 7265  unctionSignature
+00009740: 2866 293a 0a20 2022 2222 6765 7420 6172  (f):.  """get ar
+00009750: 6775 6d65 6e74 7320 616e 6420 6b65 7977  guments and keyw
+00009760: 6f72 6420 6172 6775 6d65 6e74 7320 7061  ord arguments pa
+00009770: 7373 6564 2074 6f20 6120 6675 6e63 7469  ssed to a functi
+00009780: 6f6e 0a20 2022 2222 0a20 2070 6172 7320  on.  """.  pars 
+00009790: 3d20 7369 676e 6174 7572 6528 6629 2e70  = signature(f).p
+000097a0: 6172 616d 6574 6572 730a 2020 6172 6773  arameters.  args
+000097b0: 203d 205b 5d0a 2020 6b77 6172 6773 203d   = [].  kwargs =
+000097c0: 207b 7d0a 2020 666f 7220 7020 696e 2070   {}.  for p in p
+000097d0: 6172 732e 7661 6c75 6573 2829 3a0a 2020  ars.values():.  
+000097e0: 2020 6966 2070 2e64 6566 6175 6c74 2069    if p.default i
+000097f0: 7320 702e 656d 7074 793a 0a20 2020 2020  s p.empty:.     
+00009800: 2061 7267 732e 6170 7065 6e64 2870 2e6e   args.append(p.n
+00009810: 616d 6529 0a20 2020 2065 6c73 653a 0a20  ame).    else:. 
+00009820: 2020 2020 206b 7761 7267 735b 702e 6e61       kwargs[p.na
+00009830: 6d65 5d3d 702e 6465 6661 756c 740a 2020  me]=p.default.  
+00009840: 7265 7475 726e 2061 7267 732c 206b 7761  return args, kwa
+00009850: 7267 730a 0a64 6566 2072 6f75 6e64 5f74  rgs..def round_t
+00009860: 6f5f 6572 726f 7228 7661 6c2c 2065 7272  o_error(val, err
+00009870: 2c20 6e73 645f 653d 3229 3a0a 2020 2222  , nsd_e=2):.  ""
+00009880: 2272 6f75 6e64 2066 6c6f 6174 202a 7661  "round float *va
+00009890: 6c2a 2074 6f20 7361 6d65 206e 756d 6265  l* to same numbe
+000098a0: 7220 6f66 2073 6967 6e69 6669 6361 6e74  r of significant
+000098b0: 2064 6967 6974 7320 6173 2075 6e63 6572   digits as uncer
+000098c0: 7461 696e 7479 202a 6572 722a 0a20 200a  tainty *err*.  .
+000098d0: 2020 5265 7475 726e 733a 0a20 2020 202a    Returns:.    *
+000098e0: 2069 6e74 3a20 2020 6e75 6d62 6572 206f   int:   number o
+000098f0: 6620 7369 676e 6966 6963 616e 7420 6469  f significant di
+00009900: 6769 7473 2066 6f72 2076 0a20 2020 202a  gits for v.    *
+00009910: 2066 6c6f 6174 3a20 7661 6c20 726f 756e   float: val roun
+00009920: 6465 6420 746f 2070 7265 6369 7369 6f6e  ded to precision
+00009930: 206f 6620 6572 720a 2020 2020 2a20 666c   of err.    * fl
+00009940: 6f61 743a 2065 7272 2072 6f75 6e64 6564  oat: err rounded
+00009950: 2074 6f20 7072 6563 6973 696f 6e20 6e73   to precision ns
+00009960: 645f 650a 2020 2222 220a 2020 7620 3d20  d_e.  """.  v = 
+00009970: 6162 7328 7661 6c29 0a20 2023 2072 6f75  abs(val).  # rou
+00009980: 6e64 2075 6e63 6572 7461 696e 7479 2074  nd uncertainty t
+00009990: 6f20 6e64 3020 7369 676e 6966 6963 616e  o nd0 significan
+000099a0: 7420 6469 6769 7473 0a20 2065 203d 2066  t digits.  e = f
+000099b0: 6c6f 6174 2822 7b3a 2e7b 707d 677d 222e  loat("{:.{p}g}".
+000099c0: 666f 726d 6174 2861 6273 2865 7272 292c  format(abs(err),
+000099d0: 2070 3d6e 7364 5f65 2929 0a20 205f 7620   p=nsd_e)).  _v 
+000099e0: 3d20 7620 6966 2076 3e65 2065 6c73 6520  = v if v>e else 
+000099f0: 650a 2020 6c31 3065 3d6e 702e 666c 6f6f  e.  l10e=np.floo
+00009a00: 7228 6e70 2e6c 6f67 3130 2865 2929 0a20  r(np.log10(e)). 
+00009a10: 2023 2064 6574 6572 6d69 6e65 2023 206f   # determine # o
+00009a20: 6620 7369 676e 6966 6963 616e 7420 6469  f significant di
+00009a30: 6769 7473 2066 6f72 2076 0a20 205f 6e64  gits for v.  _nd
+00009a40: 203d 2069 6e74 2820 6e70 2e66 6c6f 6f72   = int( np.floor
+00009a50: 286e 702e 6c6f 6731 3028 5f76 2920 2d20  (np.log10(_v) - 
+00009a60: 6c31 3065 2029 2029 202b 206e 7364 5f65  l10e ) ) + nsd_e
+00009a70: 0a20 2023 2074 616b 6520 696e 746f 2061  .  # take into a
+00009a80: 6363 6f75 6e74 2070 6f73 7369 626c 6520  ccount possible 
+00009a90: 726f 756e 6469 6e67 206f 6620 7620 2e2e  rounding of v ..
+00009aa0: 2e0a 2020 7620 3d20 666c 6f61 7428 227b  ..  v = float("{
+00009ab0: 3a2e 7b70 7d67 7d22 2e66 6f72 6d61 7428  :.{p}g}".format(
+00009ac0: 762c 2070 3d5f 6e64 2929 0a20 2023 202e  v, p=_nd)).  # .
+00009ad0: 2e2e 2061 6e64 2064 6574 6572 6d69 6e65  .. and determine
+00009ae0: 2066 696e 616c 2023 206f 6620 7369 672e   final # of sig.
+00009af0: 2064 6967 6974 730a 2020 5f76 203d 2076   digits.  _v = v
+00009b00: 2069 6620 763e 6520 656c 7365 2065 0a20   if v>e else e. 
+00009b10: 206e 7364 5f76 203d 2069 6e74 2820 6e70   nsd_v = int( np
+00009b20: 2e66 6c6f 6f72 286e 702e 6c6f 6731 3028  .floor(np.log10(
+00009b30: 5f76 2920 2d20 6c31 3065 2029 2029 202b  _v) - l10e ) ) +
+00009b40: 206e 7364 5f65 0a20 2076 203d 2066 6c6f   nsd_e.  v = flo
+00009b50: 6174 2822 7b3a 2e7b 707d 677d 222e 666f  at("{:.{p}g}".fo
+00009b60: 726d 6174 2876 2c20 703d 6e73 645f 7629  rmat(v, p=nsd_v)
+00009b70: 2920 6966 2076 3e3d 3130 2a2a 286c 3130  ) if v>=10**(l10
+00009b80: 652d 3129 2065 6c73 6520 300a 2020 7265  e-1) else 0.  re
+00009b90: 7475 726e 206e 7364 5f76 2c20 6e70 2e73  turn nsd_v, np.s
+00009ba0: 6967 6e28 7661 6c29 2a76 2c20 6520 2020  ign(val)*v, e   
+00009bb0: 2020 2020 2020 2020 2020 2020 0a0a 0a64              ...d
+00009bc0: 6566 205f 6275 696c 645f 4572 7232 2865  ef _build_Err2(e
+00009bd0: 3d4e 6f6e 652c 2065 7265 6c3d 4e6f 6e65  =None, erel=None
+00009be0: 2c20 6461 7461 3d4e 6f6e 6529 3a0a 2020  , data=None):.  
+00009bf0: 2222 220a 2020 4275 696c 6420 7371 7561  """.  Build squa
+00009c00: 7265 6420 7375 6d20 6f66 2069 6e64 6570  red sum of indep
+00009c10: 656e 6465 6e74 2061 6273 6f6c 7574 6520  endent absolute 
+00009c20: 616e 642f 6f72 200a 2020 7265 6c61 7469  and/or .  relati
+00009c30: 7665 2065 7272 6f72 2063 6f6d 706f 6e65  ve error compone
+00009c40: 6e74 730a 0a20 2041 7267 733a 0a20 2020  nts..  Args:.   
+00009c50: 202a 2065 3a20 7363 616c 6172 206f 7220   * e: scalar or 
+00009c60: 3164 206e 702d 6172 7261 7920 6f66 2066  1d np-array of f
+00009c70: 6c6f 6174 3a20 696e 6465 7065 6e64 656e  loat: independen
+00009c80: 7420 756e 6365 7274 6169 6e74 6965 7320  t uncertainties 
+00009c90: 0a20 2020 202a 2065 7265 6c3a 2073 6361  .    * erel: sca
+00009ca0: 6c61 7220 6f72 2031 6420 6e70 2d61 7272  lar or 1d np-arr
+00009cb0: 6179 206f 6620 666c 6f61 743a 2069 6e64  ay of float: ind
+00009cc0: 6570 656e 6465 6e74 2072 656c 6174 6976  ependent relativ
+00009cd0: 6520 0a20 2020 2020 2075 6e63 6572 7461  e .      uncerta
+00009ce0: 696e 7469 6573 0a20 2022 2222 0a20 2020  inties.  """.   
+00009cf0: 2020 200a 2020 6572 7232 203d 2030 2e0a     .  err2 = 0..
+00009d00: 2020 6966 2065 2069 7320 6e6f 7420 4e6f    if e is not No
+00009d10: 6e65 3a0a 2020 2020 6572 7232 203d 2065  ne:.    err2 = e
+00009d20: 202a 2065 0a20 2069 6620 6572 656c 2069   * e.  if erel i
+00009d30: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00009d40: 5f65 7220 3d20 6572 656c 202a 2064 6174  _er = erel * dat
+00009d50: 610a 2020 2020 6572 7232 202b 3d20 5f65  a.    err2 += _e
+00009d60: 7220 2a20 5f65 720a 2020 7265 7475 726e  r * _er.  return
+00009d70: 2065 7272 320a 2020 2020 2020 0a64 6566   err2.      .def
+00009d80: 205f 6275 696c 645f 436f 764d 6174 286e   _build_CovMat(n
+00009d90: 642c 2065 3d4e 6f6e 652c 2065 7265 6c3d  d, e=None, erel=
+00009da0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+00009db0: 2020 2020 2020 2020 2020 2020 6561 6273              eabs
+00009dc0: 636f 723d 4e6f 6e65 2c20 6572 656c 636f  cor=None, erelco
+00009dd0: 723d 4e6f 6e65 2c20 6461 7461 3d4e 6f6e  r=None, data=Non
+00009de0: 6529 3a0a 2020 2222 220a 2020 4275 696c  e):.  """.  Buil
+00009df0: 6420 6120 636f 7661 7269 616e 6365 206d  d a covariance m
+00009e00: 6174 7269 7820 6672 6f6d 2069 6e64 6570  atrix from indep
+00009e10: 656e 6465 6e74 2061 6e64 2063 6f72 7265  endent and corre
+00009e20: 6c61 7465 6420 0a20 2061 6273 6f6c 7574  lated .  absolut
+00009e30: 6520 616e 642f 6f72 2072 656c 6174 6976  e and/or relativ
+00009e40: 6520 6572 726f 7220 636f 6d70 6f6e 656e  e error componen
+00009e50: 7473 0a0a 2020 436f 7272 656c 6174 6564  ts..  Correlated
+00009e60: 2061 6273 6f6c 7574 6520 616e 642f 6f72   absolute and/or
+00009e70: 2072 656c 6174 6976 6520 756e 6365 7274   relative uncert
+00009e80: 6169 6e74 6965 7320 6f66 2069 6e70 7574  ainties of input
+00009e90: 2064 6174 6120 0a20 2061 7265 2074 6f20   data .  are to 
+00009ea0: 6265 2073 7065 6369 6669 6564 2061 7320  be specified as 
+00009eb0: 6e75 6d70 792d 6172 7261 7973 206f 6620  numpy-arrays of 
+00009ec0: 666c 6f61 7473 3b20 7468 6579 2065 6e74  floats; they ent
+00009ed0: 6572 2069 6e20 7468 6520 0a20 2064 6961  er in the .  dia
+00009ee0: 676f 6e61 6c20 616e 6420 6f66 662d 6469  gonal and off-di
+00009ef0: 6167 6f6e 616c 2065 6c65 6d65 6e74 7320  agonal elements 
+00009f00: 6f66 2074 6865 2063 6f76 6172 6961 6e63  of the covarianc
+00009f10: 6520 6d61 7472 6978 2e20 0a20 2056 616c  e matrix. .  Val
+00009f20: 7565 7320 6f66 2030 2e20 6d61 7920 6265  ues of 0. may be
+00009f30: 2073 7065 6369 6669 6564 2066 6f72 2064   specified for d
+00009f40: 6174 6120 706f 696e 7473 206e 6f74 2061  ata points not a
+00009f50: 6666 6563 7465 640a 2020 6279 2061 2063  ffected.  by a c
+00009f60: 6f72 7265 6c61 7465 6420 756e 6365 7274  orrelated uncert
+00009f70: 6169 6e74 792e 2045 2e67 2e20 7468 6520  ainty. E.g. the 
+00009f80: 6172 7261 7920 5b30 2e2c 2030 2e2c 2030  array [0., 0., 0
+00009f90: 2e35 2e2c 2030 2e35 5d0a 2020 7265 7375  .5., 0.5].  resu
+00009fa0: 6c74 7320 696e 2061 2063 6f72 7265 6c61  lts in a correla
+00009fb0: 7465 6420 756e 6365 7274 6169 6e74 7920  ted uncertainty 
+00009fc0: 6f66 2030 2e35 206f 6620 7468 6520 3372  of 0.5 of the 3r
+00009fd0: 6420 616e 6420 3474 6820 0a20 2064 6174  d and 4th .  dat
+00009fe0: 6120 706f 696e 7473 2e0a 0a20 2043 6f76  a points...  Cov
+00009ff0: 6172 6961 6e63 6520 6d61 7472 6978 2065  ariance matrix e
+0000a000: 6c65 6d65 6e74 7320 6f66 2074 6865 2069  lements of the i
+0000a010: 6e64 6976 6964 7561 6c20 636f 6d70 6f6e  ndividual compon
+0000a020: 656e 7473 2061 7265 2061 6464 6564 200a  ents are added .
+0000a030: 2020 746f 2066 6f72 6d20 7468 6520 636f    to form the co
+0000a040: 6d70 6c65 7465 2043 6f76 6172 6961 6e63  mplete Covarianc
+0000a050: 6520 4d61 7472 6978 2e0a 2020 2020 2020  e Matrix..      
+0000a060: 0a20 2041 7267 733a 0a20 2020 202a 206e  .  Args:.    * n
+0000a070: 643a 206e 756d 6265 7220 6f66 2064 6174  d: number of dat
+0000a080: 6120 706f 696e 7473 0a20 2020 202a 2065  a points.    * e
+0000a090: 3a20 3164 206f 7220 3264 206e 702d 6172  : 1d or 2d np-ar
+0000a0a0: 7261 7920 6f66 2066 6c6f 6174 3a20 0a20  ray of float: . 
+0000a0b0: 2020 2020 2069 6e64 6570 656e 6465 6e74       independent
+0000a0c0: 2075 6e63 6572 7461 696e 7469 6573 206f   uncertainties o
+0000a0d0: 7220 6120 6675 6c6c 2063 6f76 6172 6961  r a full covaria
+0000a0e0: 6e63 6520 6d61 7472 6978 0a20 2020 202a  nce matrix.    *
+0000a0f0: 2065 7265 6c3a 2031 6420 6f72 2032 6420   erel: 1d or 2d 
+0000a100: 6e70 2d61 7272 6179 206f 6620 666c 6f61  np-array of floa
+0000a110: 743a 0a20 2020 2020 2069 6e64 6570 656e  t:.      indepen
+0000a120: 6465 6e74 2072 656c 6174 6976 6520 756e  dent relative un
+0000a130: 6365 7274 6169 6e74 6965 7320 6f72 2061  certainties or a
+0000a140: 2066 756c 6c20 636f 7661 7269 616e 6365   full covariance
+0000a150: 206d 6174 7269 780a 0a20 2063 6f72 7265   matrix..  corre
+0000a160: 6c61 7465 6420 636f 6d70 6f6e 656e 7473  lated components
+0000a170: 206f 6620 756e 6365 7274 6169 6e74 6965   of uncertaintie
+0000a180: 730a 2020 2020 2a20 6561 6273 636f 723a  s.    * eabscor:
+0000a190: 2031 6420 6e70 2d61 7272 6179 206f 6620   1d np-array of 
+0000a1a0: 666c 6f61 7473 206f 7220 6c69 7374 206f  floats or list o
+0000a1b0: 6620 6e70 2d61 7272 6179 733a 0a20 2020  f np-arrays:.   
+0000a1c0: 2061 6273 6f6c 7574 6520 636f 7272 656c   absolute correl
+0000a1d0: 6174 6564 2075 6e63 6572 7461 696e 7469  ated uncertainti
+0000a1e0: 6573 0a20 2020 202a 2065 7265 6c63 6f72  es.    * erelcor
+0000a1f0: 3a20 3164 206e 702d 6172 7261 7920 6f66  : 1d np-array of
+0000a200: 2066 6c6f 6174 7320 6f72 206c 6973 7420   floats or list 
+0000a210: 6f66 206e 702d 6172 7261 7973 3a0a 2020  of np-arrays:.  
+0000a220: 2020 7265 6c61 7469 7665 2063 6f72 7265    relative corre
+0000a230: 6c61 7465 6420 756e 6365 7274 6169 6e74  lated uncertaint
+0000a240: 6965 730a 2020 2020 2a20 6461 7461 3a20  ies.    * data: 
+0000a250: 6e70 2d61 7272 6179 206f 6620 666c 6f61  np-array of floa
+0000a260: 743a 2064 6174 612c 206e 6565 6465 6420  t: data, needed 
+0000a270: 286f 6e6c 7929 2066 6f72 2072 656c 6174  (only) for relat
+0000a280: 6976 6520 756e 6365 7274 6169 6e74 6965  ive uncertaintie
+0000a290: 730a 0a20 2052 6574 7572 6e73 3a0a 2020  s..  Returns:.  
+0000a2a0: 2020 2a20 6e70 2d61 7272 6179 206f 6620    * np-array of 
+0000a2b0: 666c 6f61 743a 2063 6f76 6172 6961 6e63  float: covarianc
+0000a2c0: 6520 6d61 7472 6978 200a 2020 2222 220a  e matrix .  """.
+0000a2d0: 0a20 2023 2031 2e20 696e 6465 7065 6e64  .  # 1. independ
+0000a2e0: 656e 7420 6572 726f 7273 0a20 2069 6620  ent errors.  if 
+0000a2f0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+0000a300: 2020 2069 6620 652e 6e64 696d 203d 3d20     if e.ndim == 
+0000a310: 323a 2023 2061 6c72 6561 6479 2067 6f74  2: # already got
+0000a320: 2061 206d 6174 7269 782c 2074 616b 6520   a matrix, take 
+0000a330: 6173 2063 6f76 6172 6961 6e63 6520 6d61  as covariance ma
+0000a340: 7472 6978 0a20 2020 2020 2063 6f76 203d  trix.      cov =
+0000a350: 206e 702e 6172 7261 7928 652c 2063 6f70   np.array(e, cop
+0000a360: 793d 5472 7565 290a 2020 2020 656c 7365  y=True).    else
+0000a370: 3a0a 2020 2020 2020 636f 7620 3d20 6e70  :.      cov = np
+0000a380: 2e64 6961 6728 6520 2a20 6529 2023 2073  .diag(e * e) # s
+0000a390: 6574 2064 6961 676f 6e61 6c20 656c 656d  et diagonal elem
+0000a3a0: 656e 7473 206f 6620 636f 7661 7269 616e  ents of covarian
+0000a3b0: 6365 206d 6174 7269 780a 2020 656c 7365  ce matrix.  else
+0000a3c0: 3a0a 2020 2020 636f 7620 3d20 6e70 2e7a  :.    cov = np.z
+0000a3d0: 6572 6f73 2820 286e 642c 206e 6429 2029  eros( (nd, nd) )
+0000a3e0: 0a20 2020 200a 2020 2320 322e 2061 6464  .    .  # 2. add
+0000a3f0: 2072 656c 6174 6976 6520 6572 726f 7273   relative errors
+0000a400: 0a20 2069 6620 6572 656c 2069 7320 6e6f  .  if erel is no
+0000a410: 7420 4e6f 6e65 3a0a 2020 2020 6966 2065  t None:.    if e
+0000a420: 7265 6c2e 6e64 696d 203d 3d20 323a 2023  rel.ndim == 2: #
+0000a430: 2067 6f74 2061 206d 6174 7269 780a 2020   got a matrix.  
+0000a440: 2020 2020 636f 7620 2b3d 2065 7220 2a20      cov += er * 
+0000a450: 6e70 2e6f 7574 6572 2864 6174 612c 2064  np.outer(data, d
+0000a460: 6174 6129 0a20 2020 2065 6c73 653a 0a20  ata).    else:. 
+0000a470: 2020 2020 2065 725f 203d 206e 702e 6172       er_ = np.ar
+0000a480: 7261 7928 6572 656c 2920 2a20 6461 7461  ray(erel) * data
+0000a490: 0a20 2020 2020 2063 6f76 202b 3d20 6e70  .      cov += np
+0000a4a0: 2e64 6961 6728 6572 5f20 2a20 6572 5f29  .diag(er_ * er_)
+0000a4b0: 2020 2023 2064 6961 676f 6e61 6c20 656c     # diagonal el
+0000a4c0: 656d 656e 7473 206f 6620 636f 7661 7269  ements of covari
+0000a4d0: 616e 6365 206d 6174 7269 780a 2020 0a20  ance matrix.  . 
+0000a4e0: 2023 2033 2e20 6164 6420 6162 736f 6c75   # 3. add absolu
+0000a4f0: 7465 2c20 636f 7272 656c 6174 6564 2065  te, correlated e
+0000a500: 7272 6f72 2063 6f6d 706f 6e65 6e74 7320  rror components 
+0000a510: 200a 2020 6966 2065 6162 7363 6f72 2069   .  if eabscor i
+0000a520: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000a530: 6966 206c 656e 286e 702e 7368 6170 6528  if len(np.shape(
+0000a540: 6561 6273 636f 7220 2929 203c 2032 3a20  eabscor )) < 2: 
+0000a550: 2320 6861 7320 6f6e 6520 656e 7472 790a  # has one entry.
+0000a560: 2020 2020 2020 636f 7620 2b3d 206e 702e        cov += np.
+0000a570: 6f75 7465 7228 6561 6273 636f 722c 2065  outer(eabscor, e
+0000a580: 6162 7363 6f72 2920 0a20 2020 2065 6c73  abscor) .    els
+0000a590: 653a 2020 2020 2020 2020 2020 2020 2320  e:            # 
+0000a5a0: 676f 7420 6120 6c69 7374 2c20 6164 6420  got a list, add 
+0000a5b0: 6561 6368 2063 6f6d 706f 6e65 6e74 0a20  each component. 
+0000a5c0: 2020 2020 2066 6f72 2063 2069 6e20 6561       for c in ea
+0000a5d0: 6273 636f 723a 0a20 2020 2020 2020 2063  bscor:.        c
+0000a5e0: 6f76 202b 3d20 6e70 2e6f 7574 6572 2863  ov += np.outer(c
+0000a5f0: 2c20 6329 0a20 2020 2020 2020 200a 2020  , c).        .  
+0000a600: 2320 342e 2061 6464 2072 656c 6174 6976  # 4. add relativ
+0000a610: 652c 2063 6f72 7265 6c61 7465 6420 6572  e, correlated er
+0000a620: 726f 7220 636f 6d70 6f6e 656e 7473 0a20  ror components. 
+0000a630: 2069 6620 6572 656c 636f 7220 6973 206e   if erelcor is n
+0000a640: 6f74 204e 6f6e 653a 0a20 2020 2069 6620  ot None:.    if 
+0000a650: 6c65 6e28 6e70 2e73 6861 7065 2865 7265  len(np.shape(ere
+0000a660: 6c63 6f72 2920 2920 3c20 323a 2023 2068  lcor) ) < 2: # h
+0000a670: 6173 206f 6e65 2065 6e74 7279 0a20 2020  as one entry.   
+0000a680: 2020 2063 5f20 3d20 6572 656c 636f 7220     c_ = erelcor 
+0000a690: 2a20 6461 7461 0a20 2020 2020 2063 6f76  * data.      cov
+0000a6a0: 202b 3d20 6e70 2e6f 7574 6572 2863 5f2c   += np.outer(c_,
+0000a6b0: 2063 5f29 200a 2020 2020 656c 7365 3a20   c_) .    else: 
+0000a6c0: 2020 2020 2020 2020 2020 2023 2067 6f74             # got
+0000a6d0: 2061 206c 6973 742c 2061 6464 2065 6163   a list, add eac
+0000a6e0: 6820 636f 6d70 6f6e 656e 740a 2020 2020  h component.    
+0000a6f0: 2020 666f 7220 6320 696e 2065 7265 6c63    for c in erelc
+0000a700: 6f72 3a0a 2020 2020 2020 2020 635f 203d  or:.        c_ =
+0000a710: 206e 702e 6172 7261 7928 6329 202a 2064   np.array(c) * d
+0000a720: 6174 610a 2020 2020 2020 2020 636f 7620  ata.        cov 
+0000a730: 2b3d 206e 702e 6f75 7465 7228 635f 2c20  += np.outer(c_, 
+0000a740: 635f 2920 0a20 2023 2072 6574 7572 6e20  c_) .  # return 
+0000a750: 636f 6d70 6c65 7465 206d 6174 7269 780a  complete matrix.
+0000a760: 2020 7265 7475 726e 2063 6f76 0a0a 230a    return cov..#.
+0000a770: 2320 2d2d 2d20 636c 6173 7365 7320 616e  # --- classes an
+0000a780: 6420 6675 6e63 7469 6f6e 730a 230a 0a63  d functions.#..c
+0000a790: 6c61 7373 206d 6e46 6974 2829 3a0a 2020  lass mnFit():.  
+0000a7a0: 2222 222a 2a46 6974 2061 6e20 6172 6269  """**Fit an arbi
+0000a7b0: 7472 6172 7920 6675 6e63 7469 6f6e 2066  trary function f
+0000a7c0: 2878 2c20 2a70 6172 2920 746f 2064 6174  (x, *par) to dat
+0000a7d0: 612a 2a20 200a 2020 7769 7468 2069 6e64  a**  .  with ind
+0000a7e0: 6570 656e 6465 6e74 2061 6e64 2f6f 7220  ependent and/or 
+0000a7f0: 636f 7272 656c 6174 6564 2061 6273 6f6c  correlated absol
+0000a800: 7574 6520 616e 642f 6f72 2072 656c 6174  ute and/or relat
+0000a810: 6976 6520 756e 6365 7274 6169 6e74 6965  ive uncertaintie
+0000a820: 730a 0a20 2054 6869 7320 696d 706c 656d  s..  This implem
+0000a830: 656e 7461 7469 6f6e 2064 6570 656e 6473  entation depends
+0000a840: 206f 6e20 616e 6420 6865 6176 696c 7920   on and heavily 
+0000a850: 7573 6573 2066 6561 7475 7265 7320 6f66  uses features of
+0000a860: 200a 2020 7468 6520 6d69 6e69 6d69 7a65   .  the minimize
+0000a870: 7220 616e 6420 756e 6365 7274 6169 6e74  r and uncertaint
+0000a880: 792d 6573 7469 6d61 746f 7220 2a2a 696d  y-estimator **im
+0000a890: 696e 7569 742a 2a2e 0a20 2020 0a20 2050  inuit**..   .  P
+0000a8a0: 7562 6c69 6320 4461 7461 206d 656d 6265  ublic Data membe
+0000a8b0: 720a 0a20 202d 2066 6974 5f74 7970 653a  r..  - fit_type:
+0000a8c0: 2027 7879 2720 2864 6566 6175 6c74 292c   'xy' (default),
+0000a8d0: 2027 6869 7374 272c 2027 7573 6572 2720   'hist', 'user' 
+0000a8e0: 6f72 2027 6d6c 272c 2063 6f6e 7472 6f6c  or 'ml', control
+0000a8f0: 7320 7479 7065 206f 6620 6669 7420 0a0a  s type of fit ..
+0000a900: 2020 5075 626c 6963 206d 6574 686f 6473    Public methods
+0000a910: 3a0a 0a20 202d 2069 6e69 745f 6461 7461  :..  - init_data
+0000a920: 2829 3a20 2020 2020 2020 2067 656e 6572  ():        gener
+0000a930: 6963 2077 7261 7070 6572 2066 6f72 2069  ic wrapper for i
+0000a940: 6e69 745f 2a44 6174 6128 2920 6d65 7468  nit_*Data() meth
+0000a950: 6f64 730a 2020 2d20 696e 6974 5f66 6974  ods.  - init_fit
+0000a960: 2829 3a20 2020 2020 2020 2020 6765 6e65  ():         gene
+0000a970: 7269 6320 7772 6170 7065 7220 666f 7220  ric wrapper for 
+0000a980: 696e 6974 5f2a 4669 7428 2920 6d65 7468  init_*Fit() meth
+0000a990: 6f64 730a 2020 2d20 7365 744f 7074 696f  ods.  - setOptio
+0000a9a0: 6e73 2829 3a20 2020 2020 2020 6765 6e65  ns():       gene
+0000a9b0: 7269 6320 7772 6170 7065 7220 666f 7220  ric wrapper for 
+0000a9c0: 7365 745f 2a4f 7074 696f 6e73 2829 206d  set_*Options() m
+0000a9d0: 6574 686f 6473 0a20 202d 2064 6f5f 6669  ethods.  - do_fi
+0000a9e0: 7428 293a 2020 2020 2020 2020 2020 2067  t():           g
+0000a9f0: 656e 6572 6963 2077 7261 7070 6572 2066  eneric wrapper f
+0000aa00: 6f72 2064 6f5f 2a46 6974 2829 206d 6574  or do_*Fit() met
+0000aa10: 686f 6473 0a20 202d 2070 6c6f 744d 6f64  hods.  - plotMod
+0000aa20: 656c 2829 3a20 2020 2020 2020 2070 6c6f  el():        plo
+0000aa30: 7420 6d6f 6465 6c20 6675 6e63 7469 6f6e  t model function
+0000aa40: 2061 6e64 2064 6174 610a 2020 2d20 706c   and data.  - pl
+0000aa50: 6f74 436f 6e74 6f75 7273 2829 3a20 2020  otContours():   
+0000aa60: 2020 706c 6f74 2070 726f 6669 6c65 206c    plot profile l
+0000aa70: 696b 656c 6968 6f6f 6473 2061 6e64 2063  ikelihoods and c
+0000aa80: 6f6e 6669 6465 6e63 6520 636f 6e74 6f75  onfidence contou
+0000aa90: 7273 200a 2020 2d20 6765 7452 6573 756c  rs .  - getResul
+0000aaa0: 7428 293a 2020 2020 2020 2020 6163 6365  t():        acce
+0000aab0: 7373 2074 6f20 6669 6e61 6c20 6669 7420  ss to final fit 
+0000aac0: 7265 7375 6c74 7320 0a20 202d 2067 6574  results .  - get
+0000aad0: 4675 6e63 7469 6f6e 4572 726f 7228 293a  FunctionError():
+0000aae0: 2075 6e63 6572 7461 696e 7479 206f 6620   uncertainty of 
+0000aaf0: 6d6f 6465 6c20 6174 2070 6f69 6e74 2873  model at point(s
+0000ab00: 2920 7820 666f 7220 7061 7261 6d65 7465  ) x for paramete
+0000ab10: 7273 2070 0a20 202d 2070 6c6f 745f 5072  rs p.  - plot_Pr
+0000ab20: 6f66 696c 6528 293a 2020 2020 2070 6c6f  ofile():     plo
+0000ab30: 7420 7072 6f66 696c 6520 4c69 6b65 6c69  t profile Likeli
+0000ab40: 686f 6f64 2066 6f72 2070 6172 616d 6574  hood for paramet
+0000ab50: 6572 0a20 202d 2070 6c6f 745f 636c 436f  er.  - plot_clCo
+0000ab60: 6e74 6f75 7228 293a 2020 2070 6c6f 7420  ntour():   plot 
+0000ab70: 636f 6e66 6964 656e 6365 206c 6576 656c  confidence level
+0000ab80: 2063 6f6e 746f 7572 2066 6f72 2070 6169   contour for pai
+0000ab90: 7220 6f66 2070 6172 616d 6574 6572 7320  r of parameters 
+0000aba0: 200a 2020 2d20 706c 6f74 5f6e 7369 6743   .  - plot_nsigC
+0000abb0: 6f6e 746f 7572 2829 3a20 706c 6f74 206e  ontour(): plot n
+0000abc0: 2d73 6967 6d61 2063 6f6e 746f 7572 7320  -sigma contours 
+0000abd0: 666f 7220 7061 6972 206f 6620 7061 7261  for pair of para
+0000abe0: 6d65 7465 7273 2020 0a20 202d 2067 6574  meters  .  - get
+0000abf0: 5072 6f66 696c 6528 293a 2020 2020 2020  Profile():      
+0000ac00: 2072 6574 7572 6e20 7072 6f66 696c 6520   return profile 
+0000ac10: 6c69 6b65 6c69 686f 6f64 206f 6620 7061  likelihood of pa
+0000ac20: 7261 6d65 7465 7220 706e 616d 0a20 202d  rameter pnam.  -
+0000ac30: 2067 6574 436f 6e74 6f75 7228 293a 2020   getContour():  
+0000ac40: 2020 2020 2072 6574 7572 6e20 636f 6e74       return cont
+0000ac50: 6f75 7220 706f 696e 7473 206f 6620 7061  our points of pa
+0000ac60: 6972 206f 6620 7061 7261 6d65 7465 7273  ir of parameters
+0000ac70: 0a0a 2020 5375 622d 436c 6173 7365 733a  ..  Sub-Classes:
+0000ac80: 0a0a 2020 2d20 7879 4461 7461 436f 6e74  ..  - xyDataCont
+0000ac90: 6169 6e65 723a 2020 2020 4461 7461 2061  ainer:    Data a
+0000aca0: 6e64 2075 6e63 6572 7461 696e 7469 6573  nd uncertainties
+0000acb0: 2066 6f72 2078 2d79 2064 6174 610a 2020   for x-y data.  
+0000acc0: 2d20 6869 7374 4461 7461 436f 6e74 6169  - histDataContai
+0000acd0: 6e65 723a 2020 436f 6e74 6169 6e65 7220  ner:  Container 
+0000ace0: 666f 7220 6869 7374 6f67 7261 6d20 6461  for histogram da
+0000acf0: 7461 0a20 202d 206d 6c44 6174 6143 6f6e  ta.  - mlDataCon
+0000ad00: 7461 696e 7465 723a 2020 2043 6f6e 7461  tainter:   Conta
+0000ad10: 696e 6572 2066 6f72 2067 656e 6572 616c  iner for general
+0000ad20: 2028 696e 6465 7865 6429 2064 6174 610a   (indexed) data.
+0000ad30: 0a20 202d 2078 4c53 7143 6f73 743a 2020  .  - xLSqCost:  
+0000ad40: 2020 2020 2020 2020 2045 7874 656e 6465           Extende
+0000ad50: 6420 6368 695e 3220 636f 7374 2066 756e  d chi^2 cost fun
+0000ad60: 6374 696f 6e20 666f 7220 6669 7473 2074  ction for fits t
+0000ad70: 6f20 782d 7920 6461 7461 0a20 202d 2068  o x-y data.  - h
+0000ad80: 436f 7374 3a20 2020 2020 2020 2020 2020  Cost:           
+0000ad90: 2020 2043 6f73 7420 6675 6e63 7469 6f6e     Cost function
+0000ada0: 2066 6f72 2028 6269 6e6e 6564 2920 6869   for (binned) hi
+0000adb0: 7374 6f67 7261 6d20 6461 7461 200a 2020  stogram data .  
+0000adc0: 2020 2832 2a6e 6567 6c2e 206c 6f67 2e20    (2*negl. log. 
+0000add0: 4c69 6b65 6c69 686f 6f64 206f 6620 506f  Likelihood of Po
+0000ade0: 6973 736f 6e20 6469 7374 7269 6275 7469  isson distributi
+0000adf0: 6f6e 290a 2020 2d20 6d6e 436f 7374 3a20  on).  - mnCost: 
+0000ae00: 2020 2020 2020 2020 2020 2020 7573 6572              user
+0000ae10: 2d73 7570 706c 6965 6420 636f 7374 2066  -supplied cost f
+0000ae20: 756e 6374 696f 6e20 6f72 206e 6567 6174  unction or negat
+0000ae30: 6976 6520 6c6f 672d 6c69 6b65 6c69 686f  ive log-likeliho
+0000ae40: 6f64 200a 2020 2020 6f66 2075 7365 722d  od .    of user-
+0000ae50: 7375 7070 6c69 6564 2070 726f 6261 6269  supplied probabi
+0000ae60: 6c69 7479 2064 6973 7472 6962 7574 696f  lity distributio
+0000ae70: 6e0a 0a20 204d 6574 686f 6473 3a0a 0a20  n..  Methods:.. 
+0000ae80: 202d 2069 6e69 745f 7879 4461 7461 2829   - init_xyData()
+0000ae90: 3a20 2020 2020 2020 696e 6974 6961 6c69  :       initiali
+0000aea0: 7a65 2078 7920 6461 7461 2061 6e64 2075  ze xy data and u
+0000aeb0: 6e63 6572 7461 696e 7469 6573 0a20 202d  ncertainties.  -
+0000aec0: 2069 6e69 745f 6844 6174 6128 293a 2020   init_hData():  
+0000aed0: 2020 2020 2020 696e 6974 6961 6c69 7a65        initialize
+0000aee0: 2068 6973 746f 6772 616d 2064 6174 6120   histogram data 
+0000aef0: 616e 6420 756e 6365 7274 6169 6e74 6965  and uncertaintie
+0000af00: 730a 2020 2d20 696e 6974 5f6d 6c44 6174  s.  - init_mlDat
+0000af10: 6128 293a 2020 2020 2020 2073 746f 7265  a():       store
+0000af20: 2064 6174 6120 666f 7220 756e 6269 6e6e   data for unbinn
+0000af30: 6564 206c 696b 656c 6968 6f6f 642d 6669  ed likelihood-fi
+0000af40: 740a 2020 2d20 696e 6974 5f78 7946 6974  t.  - init_xyFit
+0000af50: 2829 3a20 2020 2020 2020 2069 6e69 7469  ():        initi
+0000af60: 616c 697a 6520 7879 2066 6974 3a20 6461  alize xy fit: da
+0000af70: 7461 2c20 6d6f 6465 6c20 616e 6420 636f  ta, model and co
+0000af80: 6e73 7472 6169 6e74 730a 2020 2d20 696e  nstraints.  - in
+0000af90: 6974 5f68 4669 7428 293a 2020 2020 2020  it_hFit():      
+0000afa0: 2020 2069 6e69 7469 616c 697a 6520 6869     initialize hi
+0000afb0: 7374 6f67 7261 6d20 6669 743a 2064 6174  stogram fit: dat
+0000afc0: 612c 206d 6f64 656c 2061 6e64 2063 6f6e  a, model and con
+0000afd0: 7374 7261 696e 7473 0a20 202d 2069 6e69  straints.  - ini
+0000afe0: 745f 6d6e 4669 7428 293a 2020 2020 2020  t_mnFit():      
+0000aff0: 2020 696e 6974 6961 6c69 7a65 2068 6973    initialize his
+0000b000: 746f 6772 616d 2073 696d 706c 6520 6d69  togram simple mi
+0000b010: 6e75 6974 2066 6974 0a20 202d 2073 6574  nuit fit.  - set
+0000b020: 5f78 794f 7074 696f 6e73 2829 3a20 2020  _xyOptions():   
+0000b030: 2020 7365 7420 6f70 7469 6f6e 7320 666f    set options fo
+0000b040: 7220 7879 2046 6974 0a20 202d 2073 6574  r xy Fit.  - set
+0000b050: 5f68 4f70 7469 6f6e 7328 293a 2020 2020  _hOptions():    
+0000b060: 2020 7365 7420 6f70 7469 6f6e 7320 666f    set options fo
+0000b070: 7220 6869 7374 6f67 7261 6d20 4669 740a  r histogram Fit.
+0000b080: 2020 2d20 7365 745f 6d6e 4f70 7469 6f6e    - set_mnOption
+0000b090: 7328 293a 2020 2020 2073 6574 206f 7074  s():     set opt
+0000b0a0: 696f 6e73 2066 6f72 2073 696d 706c 6520  ions for simple 
+0000b0b0: 6d69 6e75 6974 2066 6974 2077 6974 6820  minuit fit with 
+0000b0c0: 6578 7465 726e 616c 2063 6f73 7420 6675  external cost fu
+0000b0d0: 6e63 7469 6f6e 0a20 202d 2064 6f5f 7879  nction.  - do_xy
+0000b0e0: 4669 7428 293a 2020 2020 2020 2020 2020  Fit():          
+0000b0f0: 7065 7266 6f72 6d20 7879 2066 6974 0a20  perform xy fit. 
+0000b100: 202d 2064 6f5f 6846 6974 2829 3a20 2020   - do_hFit():   
+0000b110: 2020 2020 2020 2020 7065 7266 6f72 6d20          perform 
+0000b120: 6869 7374 6f67 7261 6d20 6669 740a 2020  histogram fit.  
+0000b130: 2d20 646f 5f6d 6e46 6974 2829 3a20 2020  - do_mnFit():   
+0000b140: 2020 2020 2020 2073 696d 706c 6520 6d69         simple mi
+0000b150: 6e75 6974 2066 6974 2077 6974 6820 6578  nuit fit with ex
+0000b160: 7465 726e 616c 2c20 7573 6572 2d64 6566  ternal, user-def
+0000b170: 696e 6564 2063 6f73 7420 6675 6e63 7469  ined cost functi
+0000b180: 6f6e 0a20 0a20 2044 6174 6120 6d65 6d62  on. .  Data memb
+0000b190: 6572 733a 0a20 200a 2020 2d20 696d 696e  ers:.  .  - imin
+0000b1a0: 7569 745f 7665 7273 696f 6e20 2020 2020  uit_version     
+0000b1b0: 7665 7273 696f 6e20 6f66 2069 6d69 6e75  version of iminu
+0000b1c0: 6974 200a 2020 2d20 6f70 7469 6f6e 732c  it .  - options,
+0000b1d0: 2064 6963 743a 2020 2020 2020 6c69 7374   dict:      list
+0000b1e0: 206f 6620 6f70 7469 6f6e 7320 0a20 202d   of options .  -
+0000b1f0: 2050 6172 616d 6574 6572 4e61 6d65 733a   ParameterNames:
+0000b200: 2020 2020 206e 616d 6573 206f 6620 7061       names of pa
+0000b210: 7261 6d65 7465 7273 2028 6173 2073 7065  rameters (as spe
+0000b220: 6369 6669 6564 2069 6e20 6d6f 6465 6c20  cified in model 
+0000b230: 6675 6e63 7469 6f6e 290a 2020 2d20 6e63  function).  - nc
+0000b240: 6f6e 7374 7261 696e 7473 2020 2020 2020  onstraints      
+0000b250: 2020 6e75 6d62 6572 206f 6620 636f 6e73    number of cons
+0000b260: 7472 6169 6e65 6420 7061 7261 6d65 7465  trained paramete
+0000b270: 7273 2020 2020 0a20 202d 206e 6669 7865  rs    .  - nfixe
+0000b280: 6420 2020 2020 2020 2020 2020 2020 206e  d              n
+0000b290: 756d 6265 7220 6f66 2066 6978 6564 2070  umber of fixed p
+0000b2a0: 6172 616d 6574 6572 730a 2020 2d20 6672  arameters.  - fr
+0000b2b0: 6565 5061 724e 616d 733a 2020 2020 2020  eeParNams:      
+0000b2c0: 2020 6e61 6d65 7320 6f66 2066 7265 6520    names of free 
+0000b2d0: 7061 7261 6d65 7465 7273 200a 2020 2d20  parameters .  - 
+0000b2e0: 476f 463a 2020 2020 2020 2020 2020 2020  GoF:            
+0000b2f0: 2020 2020 676f 6f64 6e65 7373 2d6f 662d      goodness-of-
+0000b300: 6669 742c 2069 2e65 2e20 6368 6932 2061  fit, i.e. chi2 a
+0000b310: 7420 6265 7374 2d66 6974 2070 6f69 6e74  t best-fit point
+0000b320: 0a20 202d 204e 446f 463a 2020 2020 2020  .  - NDoF:      
+0000b330: 2020 2020 2020 2020 206e 756d 6265 7220           number 
+0000b340: 6f66 2064 6567 7265 6573 206f 6620 6672  of degrees of fr
+0000b350: 6565 646f 6d0a 2020 2d20 5061 7261 6d65  eedom.  - Parame
+0000b360: 7465 7256 616c 7565 733a 2020 2020 7061  terValues:    pa
+0000b370: 7261 6d65 7465 7220 7661 6c75 6573 2061  rameter values a
+0000b380: 7420 6265 7374 2d66 6974 2070 6f69 6e74  t best-fit point
+0000b390: 0a20 202d 204d 6967 7261 6445 7272 6f72  .  - MigradError
+0000b3a0: 733a 2020 2020 2020 2073 796d 6d65 7472  s:       symmetr
+0000b3b0: 6963 2075 6e63 6572 7461 696e 7469 6573  ic uncertainties
+0000b3c0: 0a20 202d 2043 6f76 6172 6961 6e63 654d  .  - CovarianceM
+0000b3d0: 6174 7269 783a 2020 2063 6f76 6172 6961  atrix:   covaria
+0000b3e0: 6e63 6520 6d61 7472 6978 0a20 202d 2043  nce matrix.  - C
+0000b3f0: 6f72 7265 6c61 7469 6f6e 4d61 7472 6978  orrelationMatrix
+0000b400: 3a20 2063 6f72 7265 6c61 7469 6f6e 206d  :  correlation m
+0000b410: 6174 7269 780a 2020 2d20 4f6e 6553 6967  atrix.  - OneSig
+0000b420: 496e 7465 7276 616c 3a20 2020 2020 6f6e  Interval:     on
+0000b430: 652d 7369 676d 6120 2836 3825 2043 4c29  e-sigma (68% CL)
+0000b440: 2072 616e 6765 7320 6f66 2070 6172 616d   ranges of param
+0000b450: 6574 6572 2076 616c 7565 7320 6672 6f6d  eter values from
+0000b460: 204d 494e 4f53 2020 2d20 5265 7375 6c74   MINOS  - Result
+0000b470: 4469 6374 696f 6e61 7279 3a20 2020 6469  Dictionary:   di
+0000b480: 6374 696f 6e61 7279 2077 6968 2073 756d  ctionary wih sum
+0000b490: 6d61 7279 206f 6620 6669 7420 7265 7375  mary of fit resu
+0000b4a0: 6c74 730a 200a 2020 2d20 666f 7220 7879  lts. .  - for xy
+0000b4b0: 4669 743a 0a20 200a 2020 2020 2d20 636f  Fit:.  .    - co
+0000b4c0: 7678 3a20 2020 2020 636f 7661 7269 616e  vx:     covarian
+0000b4d0: 6365 206d 6174 7269 7820 6f66 2078 2d64  ce matrix of x-d
+0000b4e0: 6174 610a 2020 2020 2d20 636f 7679 3a20  ata.    - covy: 
+0000b4f0: 2020 2020 636f 7661 7269 616e 6365 206d      covariance m
+0000b500: 6174 7269 7820 6f66 2079 2d64 6174 6120  atrix of y-data 
+0000b510: 0a20 2020 202d 2063 6f76 3a20 2020 2020  .    - cov:     
+0000b520: 2063 6f6d 6269 6e65 6420 636f 7661 7269   combined covari
+0000b530: 616e 6365 206d 6174 7269 782c 2069 6e63  ance matrix, inc
+0000b540: 6c75 6469 6e67 2070 726f 6a65 6374 6564  luding projected
+0000b550: 2078 2d75 6e63 6572 7461 696e 7469 6573   x-uncertainties
+0000b560: 0a0a 2020 496e 7374 616e 6365 7320 6f66  ..  Instances of
+0000b570: 2028 7375 622d 2963 6c61 7373 6573 3a0a   (sub-)classes:.
+0000b580: 0a20 202d 206d 696e 7569 742e 5c2a 3a20  .  - minuit.\*: 
+0000b590: 6d65 7468 6f64 7320 616e 6420 6d65 6d62  methods and memb
+0000b5a0: 6572 7320 6f66 204d 696e 7569 7420 6f62  ers of Minuit ob
+0000b5b0: 6a65 6374 200a 2020 2d20 6461 7461 2e5c  ject .  - data.\
+0000b5c0: 2a3a 2020 206d 6574 686f 6473 2061 6e64  *:   methods and
+0000b5d0: 206d 656d 6265 7273 206f 6620 6461 7461   members of data
+0000b5e0: 2073 7562 2d63 6c61 7373 2c20 6765 6e65   sub-class, gene
+0000b5f0: 7269 630a 2020 2d20 636f 7374 662e 5c2a  ric.  - costf.\*
+0000b600: 3a20 206d 6574 686f 6473 2061 6e64 206d  :  methods and m
+0000b610: 656d 6265 7273 206f 6620 636f 7374 2073  embers of cost s
+0000b620: 7562 2d63 6c61 7373 2c20 6765 6e65 7269  ub-class, generi
+0000b630: 6320 0a20 2022 2222 0a0a 2020 6465 6620  c .  """..  def 
+0000b640: 5f5f 696e 6974 5f5f 2873 656c 662c 2066  __init__(self, f
+0000b650: 6974 5f74 7970 653d 2778 7927 293a 0a20  it_type='xy'):. 
+0000b660: 2020 2022 2222 0a20 2020 2054 7970 6520     """.    Type 
+0000b670: 6f66 2066 6974 3a0a 0a20 2020 202d 2027  of fit:..    - '
+0000b680: 7879 2720 2020 3a20 6669 7420 6d6f 6465  xy'   : fit mode
+0000b690: 6c20 6d6f 6465 6c20 7928 6628 783b 2070  l model y(f(x; p
+0000b6a0: 6172 2920 746f 2064 6174 6120 0a20 2020  ar) to data .   
+0000b6b0: 202d 2027 6869 7374 2720 3a20 6669 7420   - 'hist' : fit 
+0000b6c0: 6465 6e73 6974 6979 2074 6f20 6269 6e6e  densitiy to binn
+0000b6d0: 6564 2064 6174 6120 2869 2e65 2e20 6869  ed data (i.e. hi
+0000b6e0: 7374 6f67 7261 6d29 200a 2020 2020 2d20  stogram) .    - 
+0000b6f0: 2775 7365 7227 3a20 7573 6572 2d73 7570  'user': user-sup
+0000b700: 706c 6965 6420 636f 7374 2d66 756e 6374  plied cost-funct
+0000b710: 696f 6e20 2869 2e65 2e20 6e65 672e 206c  ion (i.e. neg. l
+0000b720: 6f67 2d6c 696b 656c 6968 6f6f 6429 0a20  og-likelihood). 
+0000b730: 2020 2022 2222 0a0a 2020 2020 6966 2066     """..    if f
+0000b740: 6974 5f74 7970 6520 6e6f 7420 696e 205b  it_type not in [
+0000b750: 2778 7927 2c20 2769 6e64 6578 6564 272c  'xy', 'indexed',
+0000b760: 2027 6869 7374 272c 2027 7573 6572 272c   'hist', 'user',
+0000b770: 2027 6d6c 275d 3a0a 2020 2020 2020 7261   'ml']:.      ra
+0000b780: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+0000b790: 2020 2020 2020 2020 2721 2a2a 2120 6d6e          '!**! mn
+0000b7a0: 4669 743a 2069 6e76 616c 6964 2066 6974  Fit: invalid fit
+0000b7b0: 2074 7970 6520 2720 2b20 6669 745f 7479   type ' + fit_ty
+0000b7c0: 7065 202b 2027 202d 2065 7869 7469 6e67  pe + ' - exiting
+0000b7d0: 2127 2920 0a20 2020 2073 656c 662e 6669  !') .    self.fi
+0000b7e0: 745f 7479 7065 203d 2066 6974 5f74 7970  t_type = fit_typ
+0000b7f0: 650a 0a20 2020 2073 656c 662e 696d 696e  e..    self.imin
+0000b800: 7569 745f 7665 7273 696f 6e20 3d20 7374  uit_version = st
+0000b810: 7228 696d 696e 7569 745f 7665 7273 696f  r(iminuit_versio
+0000b820: 6e29 0a0a 2020 2020 2320 636f 756e 7465  n)..    # counte
+0000b830: 7220 666f 7220 6e75 6d62 6572 206f 6620  r for number of 
+0000b840: 6578 7465 726e 616c 2063 6f6e 7374 7261  external constra
+0000b850: 696e 7473 200a 2020 2020 7365 6c66 2e6e  ints .    self.n
+0000b860: 636f 6e73 7472 6169 6e74 7320 3d20 300a  constraints = 0.
+0000b870: 2020 2020 2320 636f 756e 7465 7220 666f      # counter fo
+0000b880: 7220 6e75 6d62 6572 206f 6620 6669 7865  r number of fixe
+0000b890: 6420 7061 7261 6d65 7465 7273 0a20 2020  d parameters.   
+0000b8a0: 2073 656c 662e 6e66 6978 6564 203d 2030   self.nfixed = 0
+0000b8b0: 200a 0a20 2020 2023 2073 6574 2064 6566   ..    # set def
+0000b8c0: 6175 6c74 206f 6620 616c 6c20 6f70 7469  ault of all opti
+0000b8d0: 6f6e 730a 2020 2020 230a 2020 2020 2320  ons.    #.    # 
+0000b8e0: 2020 6e6f 2064 6174 6120 6f72 206d 6f64    no data or mod
+0000b8f0: 656c 2070 726f 7669 6465 6420 7965 740a  el provided yet.
+0000b900: 2020 2020 7365 6c66 2e78 7944 6174 6120      self.xyData 
+0000b910: 3d20 4e6f 6e65 0a20 2020 2073 656c 662e  = None.    self.
+0000b920: 6844 6174 6120 3d20 4e6f 6e65 0a20 2020  hData = None.   
+0000b930: 2073 656c 662e 6d6c 4461 7461 203d 204e   self.mlData = N
+0000b940: 6f6e 650a 2020 2020 7365 6c66 2e78 4461  one.    self.xDa
+0000b950: 7461 203d 204e 6f6e 650a 2020 2020 2320  ta = None.    # 
+0000b960: 6765 6e65 7269 632c 2068 6f6c 6473 2061  generic, holds a
+0000b970: 6374 6976 6520 696e 7374 616e 6365 206f  ctive instance o
+0000b980: 6620 7375 622d 636c 6173 7320 7878 4461  f sub-class xxDa
+0000b990: 7461 0a20 2020 2073 656c 662e 6461 7461  ta.    self.data
+0000b9a0: 203d 204e 6f6e 650a 2020 2020 2320 6765   = None.    # ge
+0000b9b0: 6e65 7269 632c 2068 6f6c 6473 2061 6374  neric, holds act
+0000b9c0: 6976 6520 696e 7374 616e 6320 6f66 2073  ive instanc of s
+0000b9d0: 7562 2d63 6c61 7373 2078 7843 6f73 740a  ub-class xxCost.
+0000b9e0: 2020 2020 7365 6c66 2e63 6f73 7466 203d      self.costf =
+0000b9f0: 204e 6f6e 650a 2020 2020 2320 6e6f 2066   None.    # no f
+0000ba00: 6974 2064 6f6e 6520 7965 740a 2020 2020  it done yet.    
+0000ba10: 7365 6c66 2e6d 6967 7261 6452 6573 756c  self.migradResul
+0000ba20: 7420 3d20 4e6f 6e65 0a20 2020 2073 656c  t = None.    sel
+0000ba30: 662e 6d69 6e6f 7352 6573 756c 7420 3d20  f.minosResult = 
+0000ba40: 4e6f 6e65 0a20 2020 2073 656c 662e 6d69  None.    self.mi
+0000ba50: 6772 6164 5f6f 6b20 3d20 4661 6c73 650a  grad_ok = False.
+0000ba60: 2020 2020 7365 6c66 2e6d 696e 6f73 5f6f      self.minos_o
+0000ba70: 6b20 3d20 4661 6c73 650a 0a20 2020 2073  k = False..    s
+0000ba80: 656c 662e 5265 7375 6c74 4469 6374 696f  elf.ResultDictio
+0000ba90: 6e61 7279 203d 204e 6f6e 650a 2020 2020  nary = None.    
+0000baa0: 0a20 2020 2023 2064 6566 6175 6c74 206f  .    # default o
+0000bab0: 7074 696f 6e73 0a20 2020 2073 656c 662e  ptions.    self.
+0000bac0: 7275 6e5f 6d69 6e6f 7320 3d20 5472 7565  run_minos = True
+0000bad0: 0a20 2020 2073 656c 662e 7175 6965 7420  .    self.quiet 
+0000bae0: 3d20 5472 7565 0a20 2020 2023 2066 6f72  = True.    # for
+0000baf0: 2078 7920 616e 6420 696e 6465 7865 6420   xy and indexed 
+0000bb00: 4669 740a 2020 2020 7365 6c66 2e72 6566  Fit.    self.ref
+0000bb10: 4d6f 6465 6c3d 5472 7565 0a20 2020 2073  Model=True.    s
+0000bb20: 656c 662e 7573 655f 6e65 674c 6f67 4c20  elf.use_negLogL 
+0000bb30: 3d20 5472 7565 0a20 2020 2073 656c 662e  = True.    self.
+0000bb40: 6974 6572 6174 6546 6974 203d 2046 616c  iterateFit = Fal
+0000bb50: 7365 0a20 2020 2023 2066 6f72 2068 6973  se.    # for his
+0000bb60: 746f 6772 616d 2066 6974 0a20 2020 2073  togram fit.    s
+0000bb70: 656c 662e 7573 655f 4761 7573 7341 7070  elf.use_GaussApp
+0000bb80: 726f 7820 3d20 4661 6c73 650a 2020 2020  rox = False.    
+0000bb90: 7365 6c66 2e66 6974 5f64 656e 7369 7479  self.fit_density
+0000bba0: 203d 2054 7275 650a 2020 2020 2320 666f   = True.    # fo
+0000bbb0: 7220 6669 7420 7769 7468 2065 7874 6572  r fit with exter
+0000bbc0: 6e61 6c20 636f 7374 0a20 2020 2073 656c  nal cost.    sel
+0000bbd0: 662e 6e65 6732 6c6f 674c 203d 2054 7275  f.neg2logL = Tru
+0000bbe0: 650a 2020 2020 7365 6c66 2e45 7272 4465  e.    self.ErrDe
+0000bbf0: 6620 3d20 312e 0a20 2020 2023 206c 6567  f = 1..    # leg
+0000bc00: 656e 6420 666f 7220 706f 7373 6962 6c65  end for possible
+0000bc10: 206f 7074 696f 6e73 0a20 2020 2073 656c   options.    sel
+0000bc20: 662e 6f70 7469 6f6e 7320 3d20 7b7d 0a20  f.options = {}. 
+0000bc30: 2020 2073 656c 662e 6f70 7469 6f6e 735b     self.options[
+0000bc40: 2272 756e 5f6d 696e 6f73 225d 203d 205b  "run_minos"] = [
+0000bc50: 312c 2022 616c 6c22 2c0a 2020 2020 2020  1, "all",.      
+0000bc60: 2020 2020 2020 2020 2020 2020 226e 6f20              "no 
+0000bc70: 6c69 6b65 6c69 686f 6f64 2073 6361 6e22  likelihood scan"
+0000bc80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000bc90: 2020 2020 224d 494e 4f53 2070 726f 6669      "MINOS profi
+0000bca0: 6c65 206c 696b 656c 6968 6f6f 6420 7363  le likelihood sc
+0000bcb0: 616e 225d 0a20 2020 2073 656c 662e 6f70  an"].    self.op
+0000bcc0: 7469 6f6e 735b 2272 6566 4d6f 6465 6c22  tions["refModel"
+0000bcd0: 5d3d 5b31 2c20 5b22 7879 222c 2022 696e  ]=[1, ["xy", "in
+0000bce0: 6465 7865 6422 5d2c 0a20 2020 2020 2020  dexed"],.       
+0000bcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd00: 2020 2020 2022 7265 6c61 7469 7665 2075       "relative u
+0000bd10: 6e63 6572 7461 696e 7469 6573 2072 6566  ncertainties ref
+0000bd20: 6572 2074 6f20 6461 7461 222c 0a20 2020  er to data",.   
+0000bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd40: 2020 2020 2020 2020 2022 7265 6c61 7469           "relati
+0000bd50: 7665 2075 6e63 6572 7461 696e 7469 6573  ve uncertainties
+0000bd60: 2072 6566 6572 2074 6f20 6d6f 6465 6c22   refer to model"
+0000bd70: 5d0a 2020 2020 7365 6c66 2e6f 7074 696f  ].    self.optio
+0000bd80: 6e73 5b22 7573 655f 6e65 674c 6f67 4c22  ns["use_negLogL"
+0000bd90: 5d20 3d20 5b31 2c20 5b22 7879 222c 2022  ] = [1, ["xy", "
+0000bda0: 696e 6465 7865 6422 5d2c 0a20 2020 2020  indexed"],.     
+0000bdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bdc0: 2020 2020 2020 2020 2020 2020 2275 7369              "usi
+0000bdd0: 6e67 2073 696d 706c 6520 6368 695e 3220  ng simple chi^2 
+0000bde0: 636f 7374 2d66 756e 6374 696f 6e22 2c0a  cost-function",.
+0000bdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be10: 2022 7573 696e 6720 6675 6c6c 206e 6567   "using full neg
+0000be20: 6174 6976 6520 6c6f 672d 6c69 6b65 6c69  ative log-likeli
+0000be30: 686f 6f64 225d 0a0a 2020 2020 7365 6c66  hood"]..    self
+0000be40: 2e6f 7074 696f 6e73 5b22 7573 655f 4761  .options["use_Ga
+0000be50: 7573 7341 7070 726f 7822 5d20 3d20 5b30  ussApprox"] = [0
+0000be60: 2c20 2268 6973 7422 2c0a 2020 2020 2020  , "hist",.      
+0000be70: 2020 2020 2020 2275 7369 6e67 2050 6f69        "using Poi
+0000be80: 7373 6f6e 206c 696b 656c 6968 6f6f 6422  sson likelihood"
+0000be90: 2c0a 2020 2020 2020 2020 2020 2020 2275  ,.            "u
+0000bea0: 7369 6e67 2047 6175 7373 6961 6e20 6170  sing Gaussian ap
+0000beb0: 7072 6f78 696d 6174 696f 6e20 6f66 2050  proximation of P
+0000bec0: 6f69 7373 6f6e 2064 6973 7469 6275 7469  oisson distibuti
+0000bed0: 6f6e 225d 0a20 2020 2073 656c 662e 6f70  on"].    self.op
+0000bee0: 7469 6f6e 735b 2266 6974 5f64 656e 7369  tions["fit_densi
+0000bef0: 7479 225d 203d 205b 312c 2022 6869 7374  ty"] = [1, "hist
+0000bf00: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf20: 2020 2020 2266 6974 2066 6f72 206e 756d      "fit for num
+0000bf30: 6265 7220 6f66 2065 6e74 7269 6573 2f62  ber of entries/b
+0000bf40: 696e 222c 0a20 2020 2020 2020 2020 2020  in",.           
+0000bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bf60: 2020 2020 2020 2266 6974 2064 656e 7369        "fit densi
+0000bf70: 7479 2064 6973 7472 6962 7574 696f 6e22  ty distribution"
+0000bf80: 5d0a 2020 2020 7365 6c66 2e6f 7074 696f  ].    self.optio
+0000bf90: 6e73 5b22 6e65 6732 6c6f 674c 225d 203d  ns["neg2logL"] =
+0000bfa0: 205b 312c 205b 2275 7365 7222 2c20 226d   [1, ["user", "m
+0000bfb0: 6c22 5d2c 0a20 2020 2020 2020 2020 2020  l"],.           
+0000bfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfd0: 2020 2022 7573 696e 6720 7374 616e 6461     "using standa
+0000bfe0: 7264 206c 696b 656c 6968 6f6f 6420 2d3e  rd likelihood ->
+0000bff0: 2065 7272 6465 6620 3d20 302e 3522 2c0a   errdef = 0.5",.
+0000c000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c010: 2020 2020 2020 2020 2020 2020 2020 2275                "u
+0000c020: 7369 6e67 202d 3220 2a20 6e65 672e 206c  sing -2 * neg. l
+0000c030: 6f67 2e20 6c69 6b65 6c69 686f 6f64 202d  og. likelihood -
+0000c040: 3e20 6572 7264 6566 3d31 2e22 5d0a 0a20  > errdef=1."].. 
+0000c050: 2020 2023 2073 6574 206f 7074 696f 6e73     # set options
+0000c060: 2066 6f72 2028 6e69 6365 7229 2070 6c6f   for (nicer) plo
+0000c070: 7474 696e 670a 2020 2020 7365 6c66 2e73  tting.    self.s
+0000c080: 6574 506c 6f74 4f70 7469 6f6e 7328 290a  etPlotOptions().
+0000c090: 2020 2020 0a20 2064 6566 2069 6e69 745f      .  def init_
+0000c0a0: 6461 7461 2873 656c 662c 202a 6172 6773  data(self, *args
+0000c0b0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+0000c0c0: 2069 6620 7365 6c66 2e66 6974 5f74 7970   if self.fit_typ
+0000c0d0: 6520 3d3d 2027 7879 273a 0a20 2020 2020  e == 'xy':.     
+0000c0e0: 2073 656c 662e 696e 6974 5f78 7944 6174   self.init_xyDat
+0000c0f0: 6128 2a61 7267 732c 202a 2a6b 7761 7267  a(*args, **kwarg
+0000c100: 7329 0a20 2020 2065 6c69 6620 7365 6c66  s).    elif self
+0000c110: 2e66 6974 5f74 7970 6520 3d3d 2027 696e  .fit_type == 'in
+0000c120: 6465 7865 6427 3a0a 2020 2020 2020 7365  dexed':.      se
+0000c130: 6c66 2e69 6e69 745f 7844 6174 6128 2a61  lf.init_xData(*a
+0000c140: 7267 732c 202a 2a6b 7761 7267 7329 0a20  rgs, **kwargs). 
+0000c150: 2020 2065 6c69 6620 7365 6c66 2e66 6974     elif self.fit
+0000c160: 5f74 7970 6520 3d3d 2027 6869 7374 273a  _type == 'hist':
+0000c170: 0a20 2020 2020 2073 656c 662e 696e 6974  .      self.init
+0000c180: 5f68 4461 7461 282a 6172 6773 2c20 2a2a  _hData(*args, **
+0000c190: 6b77 6172 6773 290a 2020 2020 656c 6966  kwargs).    elif
+0000c1a0: 2073 656c 662e 6669 745f 7479 7065 203d   self.fit_type =
+0000c1b0: 3d20 276d 6c27 3a0a 2020 2020 2020 7365  = 'ml':.      se
+0000c1c0: 6c66 2e69 6e69 745f 6d6c 4461 7461 282a  lf.init_mlData(*
+0000c1d0: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
+0000c1e0: 2020 2020 656c 6966 2073 656c 662e 6669      elif self.fi
+0000c1f0: 745f 7479 7065 203d 3d20 2775 7365 7227  t_type == 'user'
+0000c200: 3a0a 2020 2020 2020 7072 696e 7428 2221  :.      print("!
+0000c210: 2a2a 2120 6d6e 4669 743a 206e 6f74 2064  **! mnFit: not d
+0000c220: 6174 6120 6f62 6a65 6374 2074 6f20 6265  ata object to be
+0000c230: 2064 6566 696e 6465 6420 666f 7220 6669   definded for fi
+0000c240: 745f 7479 7065 2027 7573 6572 2722 2029  t_type 'user'" )
+0000c250: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+0000c260: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000c270: 7228 0a20 2020 2020 2020 2022 212a 2a21  r(.        "!**!
+0000c280: 2075 6e6b 6e6f 776e 2074 7970 6520 6f66   unknown type of
+0000c290: 2046 6974 2022 202b 2073 656c 662e 6669   Fit " + self.fi
+0000c2a0: 745f 7479 7065 290a 2020 2020 0a20 2064  t_type).    .  d
+0000c2b0: 6566 2073 6574 4f70 7469 6f6e 7328 7365  ef setOptions(se
+0000c2c0: 6c66 2c20 2a61 7267 732c 202a 2a6b 7761  lf, *args, **kwa
+0000c2d0: 7267 7329 3a0a 2020 2020 6966 2073 656c  rgs):.    if sel
+0000c2e0: 662e 6669 745f 7479 7065 203d 3d20 2778  f.fit_type == 'x
+0000c2f0: 7927 3a0a 2020 2020 2020 7365 6c66 2e73  y':.      self.s
+0000c300: 6574 5f78 794f 7074 696f 6e73 282a 6172  et_xyOptions(*ar
+0000c310: 6773 2c20 2a2a 6b77 6172 6773 290a 2020  gs, **kwargs).  
+0000c320: 2020 656c 6966 2073 656c 662e 6669 745f    elif self.fit_
+0000c330: 7479 7065 203d 3d20 2769 6e64 6578 6564  type == 'indexed
+0000c340: 273a 0a20 2020 2020 2073 656c 662e 7365  ':.      self.se
+0000c350: 745f 784f 7074 696f 6e73 282a 6172 6773  t_xOptions(*args
+0000c360: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
+0000c370: 656c 6966 2073 656c 662e 6669 745f 7479  elif self.fit_ty
+0000c380: 7065 203d 3d20 2768 6973 7427 3a0a 2020  pe == 'hist':.  
+0000c390: 2020 2020 7365 6c66 2e73 6574 5f68 4f70      self.set_hOp
+0000c3a0: 7469 6f6e 7328 2a61 7267 732c 202a 2a6b  tions(*args, **k
+0000c3b0: 7761 7267 7329 0a20 2020 2065 6c69 6620  wargs).    elif 
+0000c3c0: 7365 6c66 2e66 6974 5f74 7970 6520 3d3d  self.fit_type ==
+0000c3d0: 2027 7573 6572 2720 6f72 2073 656c 662e   'user' or self.
+0000c3e0: 6669 745f 7479 7065 203d 3d20 276d 6c27  fit_type == 'ml'
+0000c3f0: 3a0a 2020 2020 2020 7365 6c66 2e73 6574  :.      self.set
+0000c400: 5f6d 6e4f 7074 696f 6e73 282a 6172 6773  _mnOptions(*args
+0000c410: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
+0000c420: 656c 7365 3a0a 2020 2020 2020 7261 6973  else:.      rais
+0000c430: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+0000c440: 2020 2020 2020 2221 2a2a 2120 756e 6b6e        "!**! unkn
+0000c450: 6f77 6e20 7479 7065 206f 6620 4669 7420  own type of Fit 
+0000c460: 2220 2b20 7365 6c66 2e66 6974 5f74 7970  " + self.fit_typ
+0000c470: 6529 0a0a 2020 6465 6620 696e 6974 5f66  e)..  def init_f
+0000c480: 6974 2873 656c 662c 202a 6172 6773 2c20  it(self, *args, 
+0000c490: 2a2a 6b77 6172 6773 293a 0a20 2020 2069  **kwargs):.    i
+0000c4a0: 6620 7365 6c66 2e66 6974 5f74 7970 6520  f self.fit_type 
+0000c4b0: 3d3d 2027 7879 273a 0a20 2020 2020 2073  == 'xy':.      s
+0000c4c0: 656c 662e 696e 6974 5f78 7946 6974 282a  elf.init_xyFit(*
+0000c4d0: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
+0000c4e0: 2020 2020 656c 6966 2073 656c 662e 6669      elif self.fi
+0000c4f0: 745f 7479 7065 203d 3d20 2769 6e64 6578  t_type == 'index
+0000c500: 6564 273a 0a20 2020 2020 2073 656c 662e  ed':.      self.
+0000c510: 696e 6974 5f78 4669 7428 2a61 7267 732c  init_xFit(*args,
+0000c520: 202a 2a6b 7761 7267 7329 0a20 2020 2065   **kwargs).    e
+0000c530: 6c69 6620 7365 6c66 2e66 6974 5f74 7970  lif self.fit_typ
+0000c540: 6520 3d3d 2027 6869 7374 273a 0a20 2020  e == 'hist':.   
+0000c550: 2020 2073 656c 662e 696e 6974 5f68 4669     self.init_hFi
+0000c560: 7428 2a61 7267 732c 202a 2a6b 7761 7267  t(*args, **kwarg
+0000c570: 7329 0a20 2020 2065 6c69 6620 7365 6c66  s).    elif self
+0000c580: 2e66 6974 5f74 7970 6520 3d3d 2027 7573  .fit_type == 'us
+0000c590: 6572 2720 6f72 2073 656c 662e 6669 745f  er' or self.fit_
+0000c5a0: 7479 7065 203d 3d20 276d 6c27 3a0a 2020  type == 'ml':.  
+0000c5b0: 2020 2020 7365 6c66 2e69 6e69 745f 6d6e      self.init_mn
+0000c5c0: 4669 7428 2a61 7267 732c 202a 2a6b 7761  Fit(*args, **kwa
+0000c5d0: 7267 7329 0a20 2020 2065 6c73 653a 0a20  rgs).    else:. 
+0000c5e0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000c5f0: 4572 726f 7228 0a20 2020 2020 2020 2022  Error(.        "
+0000c600: 212a 2a21 2075 6e6b 6e6f 776e 2074 7970  !**! unknown typ
+0000c610: 6520 6f66 2046 6974 2022 202b 2073 656c  e of Fit " + sel
+0000c620: 662e 6669 745f 7479 7065 290a 0a20 2023  f.fit_type)..  #
+0000c630: 0a20 2023 202d 2d2d 2073 7065 6369 616c  .  # --- special
+0000c640: 2063 6f64 6520 666f 7220 7879 2046 6974   code for xy Fit
+0000c650: 0a20 2023 2020 2020 2020 0a0a 2020 6465  .  #      ..  de
+0000c660: 6620 7365 745f 7879 4f70 7469 6f6e 7328  f set_xyOptions(
+0000c670: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+0000c680: 2020 2020 7265 6c61 7469 7665 5f72 6566      relative_ref
+0000c690: 6572 735f 746f 5f6d 6f64 656c 3d4e 6f6e  ers_to_model=Non
+0000c6a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000c6b0: 2072 756e 5f6d 696e 6f73 3d4e 6f6e 652c   run_minos=None,
+0000c6c0: 0a20 2020 2020 2020 2020 2020 2020 2075  .              u
+0000c6d0: 7365 5f6e 6567 4c6f 674c 3d4e 6f6e 652c  se_negLogL=None,
+0000c6e0: 0a20 2020 2020 2020 2020 2020 2020 2071  .              q
+0000c6f0: 7569 6574 3d4e 6f6e 6529 3a0a 0a20 2020  uiet=None):..   
+0000c700: 2022 2222 4465 6669 6e65 206f 7074 696f   """Define optio
+0000c710: 6e73 2066 6f72 2078 7920 6669 740a 0a20  ns for xy fit.. 
+0000c720: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+0000c730: 2020 2020 2d20 7265 6c2e 2065 7272 6f72      - rel. error
+0000c740: 7320 7265 6665 7220 746f 206d 6f64 656c  s refer to model
+0000c750: 2065 6c73 6520 6461 7461 0a20 2020 2020   else data.     
+0000c760: 2020 202d 2072 756e 206d 696e 6f73 2065     - run minos e
+0000c770: 6c73 6520 646f 6e2a 7420 7275 6e20 6d69  lse don*t run mi
+0000c780: 6e6f 730a 2020 2020 2020 2020 2d20 7573  nos.        - us
+0000c790: 6520 6675 6c6c 206e 6567 326c 6f67 4c0a  e full neg2logL.
+0000c7a0: 2020 2020 2020 2020 2d20 646f 6e2a 7420          - don*t 
+0000c7b0: 7072 6f76 6964 6520 7072 696e 746f 7574  provide printout
+0000c7c0: 2065 6c73 6520 7665 7262 6f73 6520 7072   else verbose pr
+0000c7d0: 696e 746f 7574 200a 2020 2020 2222 220a  intout .    """.
+0000c7e0: 2020 2020 6966 2072 656c 6174 6976 655f      if relative_
+0000c7f0: 7265 6665 7273 5f74 6f5f 6d6f 6465 6c20  refers_to_model 
+0000c800: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000c810: 2020 2073 656c 662e 7265 664d 6f64 656c     self.refModel
+0000c820: 203d 2072 656c 6174 6976 655f 7265 6665   = relative_refe
+0000c830: 7273 5f74 6f5f 6d6f 6465 6c0a 2020 2020  rs_to_model.    
+0000c840: 2020 7365 6c66 2e6f 7074 696f 6e73 5b22    self.options["
+0000c850: 7265 664d 6f64 656c 225d 5b30 5d20 3d20  refModel"][0] = 
+0000c860: 696e 7428 7265 6c61 7469 7665 5f72 6566  int(relative_ref
+0000c870: 6572 735f 746f 5f6d 6f64 656c 290a 2020  ers_to_model).  
+0000c880: 2020 6966 2072 756e 5f6d 696e 6f73 2069    if run_minos i
+0000c890: 7320 6e6f 7420 4e6f 6e65 3a20 2020 0a20  s not None:   . 
+0000c8a0: 2020 2020 2073 656c 662e 7275 6e5f 6d69       self.run_mi
+0000c8b0: 6e6f 7320 3d20 7275 6e5f 6d69 6e6f 730a  nos = run_minos.
+0000c8c0: 2020 2020 2020 7365 6c66 2e6f 7074 696f        self.optio
+0000c8d0: 6e73 5b22 7275 6e5f 6d69 6e6f 7322 5d5b  ns["run_minos"][
+0000c8e0: 305d 203d 2069 6e74 2872 756e 5f6d 696e  0] = int(run_min
+0000c8f0: 6f73 290a 2020 2020 6966 2075 7365 5f6e  os).    if use_n
+0000c900: 6567 4c6f 674c 2069 7320 6e6f 7420 4e6f  egLogL is not No
+0000c910: 6e65 3a20 2020 0a20 2020 2020 2073 656c  ne:   .      sel
+0000c920: 662e 7573 655f 6e65 674c 6f67 4c20 3d20  f.use_negLogL = 
+0000c930: 7573 655f 6e65 674c 6f67 4c0a 2020 2020  use_negLogL.    
+0000c940: 2020 7365 6c66 2e6f 7074 696f 6e73 5b22    self.options["
+0000c950: 7573 655f 6e65 674c 6f67 4c22 5d5b 305d  use_negLogL"][0]
+0000c960: 203d 2069 6e74 2875 7365 5f6e 6567 4c6f   = int(use_negLo
+0000c970: 674c 290a 2020 2020 6966 2071 7569 6574  gL).    if quiet
+0000c980: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000c990: 2020 2020 7365 6c66 2e71 7569 6574 203d      self.quiet =
+0000c9a0: 2071 7569 6574 0a20 2020 200a 2020 6465   quiet.    .  de
+0000c9b0: 6620 696e 6974 5f78 7944 6174 6128 7365  f init_xyData(se
+0000c9c0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+0000c9d0: 2020 2020 782c 2079 2c20 2020 2020 2020      x, y,       
+0000c9e0: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0000c9f0: 2020 2020 2020 2065 783d 4e6f 6e65 2c20         ex=None, 
+0000ca00: 6579 3d31 2e2c 0a20 2020 2020 2020 2020  ey=1.,.         
+0000ca10: 2020 2020 2020 2065 7265 6c78 3d4e 6f6e         erelx=Non
+0000ca20: 652c 2065 7265 6c79 3d4e 6f6e 652c 0a20  e, erely=None,. 
+0000ca30: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000ca40: 6162 7378 3d4e 6f6e 652c 2063 7265 6c78  absx=None, crelx
+0000ca50: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+0000ca60: 2020 2020 2020 2063 6162 7379 3d4e 6f6e         cabsy=Non
+0000ca70: 652c 2063 7265 6c79 3d4e 6f6e 6529 3a0a  e, crely=None):.
+0000ca80: 0a20 2020 2022 2222 696e 6974 6961 6c69  .    """initiali
+0000ca90: 7a65 2064 6174 6120 6f62 6a65 6374 0a0a  ze data object..
+0000caa0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+0000cab0: 2d20 2078 3a20 2020 2020 2020 6162 7363  -  x:       absc
+0000cac0: 6973 7361 206f 6620 6461 7461 2070 6f69  issa of data poi
+0000cad0: 6e74 7320 2822 7820 7661 6c75 6573 2229  nts ("x values")
+0000cae0: 0a20 2020 2020 202d 2020 793a 2020 2020  .      -  y:    
+0000caf0: 2020 206f 7264 696e 6174 6520 6f66 2064     ordinate of d
+0000cb00: 6174 6120 706f 696e 7473 2028 2279 2076  ata points ("y v
+0000cb10: 616c 7565 7322 290a 2020 2020 2020 2d20  alues").      - 
+0000cb20: 2065 783a 2020 2020 2020 696e 6465 7065   ex:      indepe
+0000cb30: 6e64 656e 7420 756e 6365 7274 6169 6e74  ndent uncertaint
+0000cb40: 6965 7320 780a 2020 2020 2020 2d20 2065  ies x.      -  e
+0000cb50: 793a 2020 2020 2020 696e 6465 7065 6e64  y:      independ
+0000cb60: 656e 7420 756e 6365 7274 6169 6e74 6965  ent uncertaintie
+0000cb70: 7320 790a 2020 2020 2020 2d20 2065 7265  s y.      -  ere
+0000cb80: 6c78 3a20 2020 696e 6465 7065 6e64 656e  lx:   independen
+0000cb90: 7420 7265 6c61 7469 7665 2075 6e63 6572  t relative uncer
+0000cba0: 7461 696e 7469 6573 2078 0a20 2020 2020  tainties x.     
+0000cbb0: 202d 2020 6572 656c 793a 2020 2069 6e64   -  erely:   ind
+0000cbc0: 6570 656e 6465 6e74 2072 656c 6174 6976  ependent relativ
+0000cbd0: 6520 756e 6365 7274 6169 6e74 6965 7320  e uncertainties 
+0000cbe0: 790a 2020 2020 2020 2d20 2063 6162 7378  y.      -  cabsx
+0000cbf0: 3a20 2020 636f 7272 656c 6174 6564 2061  :   correlated a
+0000cc00: 626f 6c75 7465 2075 6e63 6572 7461 696e  bolute uncertain
+0000cc10: 7469 6573 2078 0a20 2020 2020 202d 2020  ties x.      -  
+0000cc20: 6372 656c 783a 2020 2063 6f72 7265 6c61  crelx:   correla
+0000cc30: 7465 6420 7265 6c61 7469 7665 2075 6e63  ted relative unc
+0000cc40: 6572 7461 696e 7469 6573 2078 0a20 2020  ertainties x.   
+0000cc50: 2020 202d 2020 6361 6273 793a 2020 2063     -  cabsy:   c
+0000cc60: 6f72 7265 6c61 7465 6420 6162 736f 6c75  orrelated absolu
+0000cc70: 7465 2075 6e63 6572 7461 696e 7469 6573  te uncertainties
+0000cc80: 2079 0a20 2020 2020 202d 2020 6372 656c   y.      -  crel
+0000cc90: 793a 2020 2063 6f72 7265 6c61 7465 6420  y:   correlated 
+0000cca0: 7265 6c61 7469 7665 2075 6e63 6572 7461  relative uncerta
+0000ccb0: 696e 7469 6573 2079 0a20 2020 2020 202d  inties y.      -
+0000ccc0: 2020 7175 6965 743a 2020 206e 6f20 696e    quiet:   no in
+0000ccd0: 666f 726d 6174 6976 6520 7072 696e 746f  formative printo
+0000cce0: 7574 2069 6620 5472 7565 0a20 2020 2022  ut if True.    "
+0000ccf0: 2222 0a20 2020 200a 2020 2020 2320 6372  "".    .    # cr
+0000cd00: 6561 7465 2064 6174 6120 6f62 6a65 6374  eate data object
+0000cd10: 2061 6e64 2070 6173 7320 616c 6c20 696e   and pass all in
+0000cd20: 7075 7420 6172 6775 6d65 6e74 730a 2020  put arguments.  
+0000cd30: 2020 7365 6c66 2e78 7944 6174 6120 3d20    self.xyData = 
+0000cd40: 7365 6c66 2e78 7944 6174 6143 6f6e 7461  self.xyDataConta
+0000cd50: 696e 6572 2873 656c 662c 2078 2c20 792c  iner(self, x, y,
+0000cd60: 2065 782c 2065 792c 0a20 2020 2020 2020   ex, ey,.       
+0000cd70: 2020 2020 2020 2020 2020 2020 2065 7265               ere
+0000cd80: 6c78 2c20 6572 656c 792c 2063 6162 7378  lx, erely, cabsx
+0000cd90: 2c20 6372 656c 782c 2063 6162 7379 2c20  , crelx, cabsy, 
+0000cda0: 6372 656c 792c 0a20 2020 2020 2020 2020  crely,.         
+0000cdb0: 2020 2020 2020 2020 2020 2071 7569 6574             quiet
+0000cdc0: 3d73 656c 662e 7175 6965 7429 0a20 2020  =self.quiet).   
+0000cdd0: 2073 656c 662e 6461 7461 203d 2073 656c   self.data = sel
+0000cde0: 662e 7879 4461 7461 0a20 2020 2023 2073  f.xyData.    # s
+0000cdf0: 6574 2066 6c61 6773 2066 6f72 2073 7465  et flags for ste
+0000ce00: 6572 696e 6720 6f66 2066 6974 2070 726f  ering of fit pro
+0000ce10: 6365 7373 2069 6e20 646f 5f66 6974 2829  cess in do_fit()
+0000ce20: 0a20 2020 2073 656c 662e 6974 6572 6174  .    self.iterat
+0000ce30: 6546 6974 203d 2073 656c 662e 7879 4461  eFit = self.xyDa
+0000ce40: 7461 2e68 6173 5f78 4572 726f 7273 206f  ta.has_xErrors o
+0000ce50: 7228 0a20 2020 2020 2020 2020 7365 6c66  r(.         self
+0000ce60: 2e78 7944 6174 612e 6861 735f 7265 6c5f  .xyData.has_rel_
+0000ce70: 7945 7272 6f72 7320 616e 6420 7365 6c66  yErrors and self
+0000ce80: 2e72 6566 4d6f 6465 6c29 0a0a 0a20 2064  .refModel)...  d
+0000ce90: 6566 2069 6e69 745f 7879 4669 7428 7365  ef init_xyFit(se
+0000cea0: 6c66 2c20 6d6f 6465 6c2c 206d 6f64 656c  lf, model, model
+0000ceb0: 5f6b 7761 7267 733d 4e6f 6e65 2c20 7030  _kwargs=None, p0
+0000cec0: 3d4e 6f6e 652c 2064 7030 3d4e 6f6e 652c  =None, dp0=None,
+0000ced0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0000cee0: 2020 2063 6f6e 7374 7261 696e 7473 3d4e     constraints=N
+0000cef0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0000cf00: 2020 2020 2020 6669 7850 6172 733d 4e6f        fixPars=No
+0000cf10: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0000cf20: 2020 2020 206c 696d 6974 733d 4e6f 6e65       limits=None
+0000cf30: 293a 0a20 2020 2022 2222 696e 6974 6961  ):.    """initia
+0000cf40: 6c69 7a65 2066 6974 206f 626a 6563 740a  lize fit object.
+0000cf50: 0a20 2020 2041 7267 733a 0a20 2020 2020  .    Args:.     
+0000cf60: 202d 206d 6f64 656c 3a20 6d6f 6465 6c20   - model: model 
+0000cf70: 6675 6e63 7469 6f6e 2066 2878 3b20 5c2a  function f(x; \*
+0000cf80: 7061 7229 0a20 2020 2020 202d 206d 6f64  par).      - mod
+0000cf90: 656c 5f6b 7761 7267 733a 206f 7074 696f  el_kwargs: optio
+0000cfa0: 6e61 6c2c 2066 6974 2070 6172 616d 6574  nal, fit paramet
+0000cfb0: 6572 7320 6966 206e 6f74 2066 726f 6d20  ers if not from 
+0000cfc0: 6d6f 6465 6c20 7369 676e 6174 7572 6520  model signature 
+0000cfd0: 0a20 2020 2020 202d 2070 303a 206e 702d  .      - p0: np-
+0000cfe0: 6172 7261 7920 6f66 2066 6c6f 6174 732c  array of floats,
+0000cff0: 2069 6e69 7469 616c 2070 6172 616d 6574   initial paramet
+0000d000: 6572 2076 616c 7565 7320 0a20 2020 2020  er values .     
+0000d010: 202d 2064 7030 3a20 6172 7261 792d 6c69   - dp0: array-li
+0000d020: 6b65 2c20 696e 6974 6961 6c20 6775 6573  ke, initial gues
+0000d030: 7320 6f66 2070 6172 616d 6574 6572 2075  s of parameter u
+0000d040: 6e63 6572 7461 696e 7469 6573 2028 6f70  ncertainties (op
+0000d050: 7469 6f6e 616c 290a 2020 2020 2020 2d20  tional).      - 
+0000d060: 636f 6e73 7472 6169 6e74 733a 2028 6e65  constraints: (ne
+0000d070: 7374 6564 2920 6c69 7374 2873 293a 205b  sted) list(s): [
+0000d080: 7061 7261 6d65 7465 7220 6e61 6d65 2c20  parameter name, 
+0000d090: 7661 6c75 652c 2075 6e63 6572 7461 696e  value, uncertain
+0000d0a0: 7479 5d20 0a20 2020 2020 2020 206f 7220  ty] .        or 
+0000d0b0: 5b70 6172 616d 6574 6572 2069 6e64 6578  [parameter index
+0000d0c0: 2c20 7661 6c75 652c 2075 6e63 6572 7461  , value, uncerta
+0000d0d0: 696e 7479 5d0a 2020 2020 2020 2d20 6c69  inty].      - li
+0000d0e0: 6d69 7473 3a20 286e 6573 7465 6429 206c  mits: (nested) l
+0000d0f0: 6973 7428 7329 3a20 5b70 6172 616d 6574  ist(s): [paramet
+0000d100: 6572 206e 616d 652c 206d 696e 2c20 6d61  er name, min, ma
+0000d110: 785d 200a 2020 2020 2020 2020 6f72 205b  x] .        or [
+0000d120: 7061 7261 6d65 7465 7220 696e 6465 782c  parameter index,
+0000d130: 206d 696e 2c20 6d61 785d 0a20 2020 2022   min, max].    "
+0000d140: 2222 0a0a 2020 2020 6966 2073 656c 662e  ""..    if self.
+0000d150: 7879 4461 7461 2069 7320 4e6f 6e65 3a0a  xyData is None:.
+0000d160: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000d170: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0000d180: 2720 2121 2120 6d6e 4669 742e 696e 6974  ' !!! mnFit.init
+0000d190: 5f78 7946 6974 3a20 6e6f 2064 6174 6120  _xyFit: no data 
+0000d1a0: 6f62 6a65 6374 2064 6566 696e 6564 202d  object defined -
+0000d1b0: 2063 616c 6c20 696e 6974 5f64 6174 6128   call init_data(
+0000d1c0: 2927 290a 0a20 2020 2023 2067 6574 2070  )')..    # get p
+0000d1d0: 6172 616d 6574 6572 7320 6f66 206d 6f64  arameters of mod
+0000d1e0: 656c 2066 756e 6374 696f 6e20 746f 2073  el function to s
+0000d1f0: 6574 2073 7461 7274 2076 616c 7565 7320  et start values 
+0000d200: 666f 7220 6669 740a 2020 2020 6966 206d  for fit.    if m
+0000d210: 6f64 656c 5f6b 7761 7267 7320 6973 204e  odel_kwargs is N
+0000d220: 6f6e 653a 0a20 2020 2020 2061 7267 732c  one:.      args,
+0000d230: 206d 6f64 656c 5f6b 7761 7267 7320 3d20   model_kwargs = 
+0000d240: 6765 745f 6675 6e63 7469 6f6e 5369 676e  get_functionSign
+0000d250: 6174 7572 6528 6d6f 6465 6c29 0a0a 2020  ature(model)..  
+0000d260: 2020 7061 7220 3d20 286d 6f64 656c 5f6b    par = (model_k
+0000d270: 7761 7267 732c 2070 302c 2064 7030 2c20  wargs, p0, dp0, 
+0000d280: 636f 6e73 7472 6169 6e74 732c 2066 6978  constraints, fix
+0000d290: 5061 7273 2c20 6c69 6d69 7473 290a 2020  Pars, limits).  
+0000d2a0: 2020 7365 6c66 2e5f 7365 7475 7046 6974    self._setupFit
+0000d2b0: 5061 7261 6d65 7465 7273 282a 7061 7229  Parameters(*par)
+0000d2c0: 200a 0a20 2020 2023 2063 7265 6174 6520   ..    # create 
+0000d2d0: 636f 7374 2066 756e 6374 696f 6e0a 2020  cost function.  
+0000d2e0: 2020 7365 6c66 2e63 6f73 7466 203d 2073    self.costf = s
+0000d2f0: 656c 662e 784c 5371 436f 7374 2873 656c  elf.xLSqCost(sel
+0000d300: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
+0000d310: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+0000d320: 6465 6c2c 0a20 2020 2020 2020 2020 2020  del,.           
+0000d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d340: 7573 655f 6e65 6732 6c6f 674c 3d20 7365  use_neg2logL= se
+0000d350: 6c66 2e75 7365 5f6e 6567 4c6f 674c 290a  lf.use_negLogL).
+0000d360: 2020 2020 7365 6c66 2e5f 7365 7475 704d      self._setupM
+0000d370: 696e 7569 7428 6d6f 6465 6c5f 6b77 6172  inuit(model_kwar
+0000d380: 6773 2920 0a0a 2020 2020 2020 0a20 2063  gs) ..      .  c
+0000d390: 6c61 7373 2078 7944 6174 6143 6f6e 7461  lass xyDataConta
+0000d3a0: 696e 6572 3a0a 2020 2020 2222 220a 2020  iner:.    """.  
+0000d3b0: 2020 4861 6e64 6c65 2064 6174 6120 616e    Handle data an
+0000d3c0: 6420 756e 6365 7274 6169 6e74 6965 7320  d uncertainties 
+0000d3d0: 616e 6420 200a 2020 2020 6275 696c 6420  and  .    build 
+0000d3e0: 636f 7661 7269 616e 6365 206d 6174 7269  covariance matri
+0000d3f0: 6365 7320 6672 6f6d 2063 6f6d 706f 6e65  ces from compone
+0000d400: 6e74 730a 0a20 2020 2041 7267 733a 0a20  nts..    Args:. 
+0000d410: 2020 2020 202d 206f 7574 6572 3a20 2020       - outer:   
+0000d420: 706f 696e 7465 7220 746f 2069 6e73 7461  pointer to insta
+0000d430: 6e63 6520 6f66 2063 616c 6c69 6e67 206f  nce of calling o
+0000d440: 626a 6563 740a 2020 2020 2020 2d20 783a  bject.      - x:
+0000d450: 2020 2020 2020 2061 6273 6369 7373 6120         abscissa 
+0000d460: 6f66 2064 6174 6120 706f 696e 7473 2028  of data points (
+0000d470: 2278 2076 616c 7565 7322 290a 2020 2020  "x values").    
+0000d480: 2020 2d20 793a 2020 2020 2020 206f 7264    - y:       ord
+0000d490: 696e 6174 6520 6f66 2064 6174 6120 706f  inate of data po
+0000d4a0: 696e 7473 2028 2279 2076 616c 7565 7322  ints ("y values"
+0000d4b0: 290a 2020 2020 2020 2d20 6578 3a20 2020  ).      - ex:   
+0000d4c0: 2020 2069 6e64 6570 656e 6465 6e74 2075     independent u
+0000d4d0: 6e63 6572 7461 696e 7469 6573 2078 0a20  ncertainties x. 
+0000d4e0: 2020 2020 202d 2065 793a 2020 2020 2020       - ey:      
+0000d4f0: 696e 6465 7065 6e64 656e 7420 756e 6365  independent unce
+0000d500: 7274 6169 6e74 6965 7320 790a 2020 2020  rtainties y.    
+0000d510: 2020 2d20 6572 656c 783a 2020 2069 6e64    - erelx:   ind
+0000d520: 6570 656e 6465 6e74 2072 656c 6174 6976  ependent relativ
+0000d530: 6520 756e 6365 7274 6169 6e74 6965 7320  e uncertainties 
+0000d540: 780a 2020 2020 2020 2d20 6572 656c 793a  x.      - erely:
+0000d550: 2020 2069 6e64 6570 656e 6465 6e74 2072     independent r
+0000d560: 656c 6174 6976 6520 756e 6365 7274 6169  elative uncertai
+0000d570: 6e74 6965 7320 790a 2020 2020 2020 2d20  nties y.      - 
+0000d580: 6361 6273 783a 2020 2063 6f72 7265 6c61  cabsx:   correla
+0000d590: 7465 6420 6162 6f6c 7574 6520 756e 6365  ted abolute unce
+0000d5a0: 7274 6169 6e74 6965 7320 780a 2020 2020  rtainties x.    
+0000d5b0: 2020 2d20 6372 656c 783a 2020 2063 6f72    - crelx:   cor
+0000d5c0: 7265 6c61 7465 6420 7265 6c61 7469 7665  related relative
+0000d5d0: 2075 6e63 6572 7461 696e 7469 6573 2078   uncertainties x
+0000d5e0: 0a20 2020 2020 202d 2063 6162 7379 3a20  .      - cabsy: 
+0000d5f0: 2020 636f 7272 656c 6174 6564 2061 6273    correlated abs
+0000d600: 6f6c 7574 6520 756e 6365 7274 6169 6e74  olute uncertaint
+0000d610: 6965 7320 790a 2020 2020 2020 2d20 6372  ies y.      - cr
+0000d620: 656c 793a 2020 2063 6f72 7265 6c61 7465  ely:   correlate
+0000d630: 6420 7265 6c61 7469 7665 2075 6e63 6572  d relative uncer
+0000d640: 7461 696e 7469 6573 2079 0a20 2020 2020  tainties y.     
+0000d650: 202d 2071 7569 6574 3a20 2020 6e6f 2069   - quiet:   no i
+0000d660: 6e66 6f72 6d61 7469 7665 2070 7269 6e74  nformative print
+0000d670: 6f75 7420 6966 2054 7275 650a 0a20 2020  out if True..   
+0000d680: 2050 7562 6c69 6320 6d65 7468 6f64 733a   Public methods:
+0000d690: 0a20 2020 2020 202d 2069 6e69 745f 6479  .      - init_dy
+0000d6a0: 6e61 6d69 6345 7272 6f72 7328 293a 0a20  namicErrors():. 
+0000d6b0: 2020 2020 202d 2067 6574 5f43 6f76 2829       - get_Cov()
+0000d6c0: 3a20 6669 6e61 6c20 636f 7661 7269 616e  : final covarian
+0000d6d0: 6365 206d 6174 7269 7820 2869 6e63 6c2e  ce matrix (incl.
+0000d6e0: 2070 726f 6a2e 2078 2920 200a 2020 2020   proj. x)  .    
+0000d6f0: 2020 2d20 6765 745f 7843 6f76 2829 3a20    - get_xCov(): 
+0000d700: 636f 7661 7269 616e 6365 206f 6620 782d  covariance of x-
+0000d710: 7661 6c75 6573 0a20 2020 2020 202d 2067  values.      - g
+0000d720: 6574 5f79 436f 7628 293a 2063 6f76 6172  et_yCov(): covar
+0000d730: 6961 6e63 6520 6f66 2079 2d76 616c 7565  iance of y-value
+0000d740: 730a 2020 2020 2020 2d20 6765 745f 6943  s.      - get_iC
+0000d750: 6f76 2829 3a20 696e 7665 7273 6520 636f  ov(): inverse co
+0000d760: 7661 7269 616e 6365 206d 6174 7269 780a  variance matrix.
+0000d770: 2020 2020 2020 2d20 706c 6f74 2829 3a20        - plot(): 
+0000d780: 7072 6f76 6964 6520 6120 6669 6775 7265  provide a figure
+0000d790: 2077 6974 6820 7265 7072 6573 656e 7461   with representa
+0000d7a0: 7469 6f6e 206f 6620 6461 7461 0a20 0a20  tion of data. . 
+0000d7b0: 2020 2044 6174 6120 6d65 6d62 6572 733a     Data members:
+0000d7c0: 2020 0a20 2020 2020 202a 2063 6f70 7920    .      * copy 
+0000d7d0: 6f66 2061 6c6c 2069 6e70 7574 2061 7267  of all input arg
+0000d7e0: 756d 656e 7473 0a20 2020 2020 202a 2063  uments.      * c
+0000d7f0: 6f76 783a 2063 6f76 6172 6961 6e63 6520  ovx: covariance 
+0000d800: 6d61 7472 6978 206f 6620 780a 2020 2020  matrix of x.    
+0000d810: 2020 2a20 636f 7679 3a20 636f 7661 7269    * covy: covari
+0000d820: 616e 6365 206d 6174 7269 7820 6f66 2079  ance matrix of y
+0000d830: 2075 6e63 6572 7461 696e 7469 6573 0a20   uncertainties. 
+0000d840: 2020 2020 202a 2063 6f76 3a20 6675 6c6c       * cov: full
+0000d850: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
+0000d860: 6978 2069 6e63 6c2e 2070 726f 6a65 6374  ix incl. project
+0000d870: 6564 2078 0a20 2020 2020 202a 2069 436f  ed x.      * iCo
+0000d880: 763a 2069 6e76 6572 7365 206f 6620 636f  v: inverse of co
+0000d890: 7661 7269 616e 6365 206d 6174 7269 780a  variance matrix.
+0000d8a0: 2020 2020 2222 220a 2020 2020 6465 6620      """.    def 
+0000d8b0: 5f5f 696e 6974 5f5f 2873 656c 662c 206f  __init__(self, o
+0000d8c0: 7574 6572 2c0a 2020 2020 2020 2020 2020  uter,.          
+0000d8d0: 2020 2020 2020 2078 2c20 792c 2065 782c         x, y, ex,
+0000d8e0: 2065 792c 0a20 2020 2020 2020 2020 2020   ey,.           
+0000d8f0: 2020 2020 2020 6572 656c 782c 2065 7265        erelx, ere
+0000d900: 6c79 2c20 6361 6273 782c 2063 7265 6c78  ly, cabsx, crelx
+0000d910: 2c20 6361 6273 792c 2063 7265 6c79 2c0a  , cabsy, crely,.
+0000d920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d930: 2071 7569 6574 3d54 7275 6529 3a0a 2020   quiet=True):.  
+0000d940: 2020 2020 2320 7361 7665 2070 6f69 6e65      # save poine
+0000d950: 7220 746f 2063 616c 6c69 6e67 2063 6c61  r to calling cla
+0000d960: 7373 0a20 2020 2020 2073 656c 662e 6f75  ss.      self.ou
+0000d970: 7465 7220 3d20 6f75 7465 720a 0a20 2020  ter = outer..   
+0000d980: 2020 2023 2061 7373 756d 6520 7369 6d70     # assume simp
+0000d990: 6c65 2063 6173 6520 772e 6f2e 2063 6f76  le case w.o. cov
+0000d9a0: 2e6d 6174 2e0a 2020 2020 2020 7365 6c66  .mat..      self
+0000d9b0: 2e6e 6565 6473 5f63 6f76 6172 6961 6e63  .needs_covarianc
+0000d9c0: 6520 3d20 4661 6c73 6520 0a0a 2020 2020  e = False ..    
+0000d9d0: 2020 6e64 203d 206c 656e 2878 2920 2020    nd = len(x)   
+0000d9e0: 2020 200a 2020 2020 2020 2320 7374 6f72     .      # stor
+0000d9f0: 6520 696e 7075 7420 6461 7461 2061 7320  e input data as 
+0000da00: 6e75 6d70 7920 666c 6f61 7420 6172 7261  numpy float arra
+0000da10: 7973 2c20 656e 7375 7265 206c 656e 6774  ys, ensure lengt
+0000da20: 6820 6e64 2069 6620 6e65 6564 6564 0a20  h nd if needed. 
+0000da30: 2020 2020 2073 656c 662e 646c 656e 6774       self.dlengt
+0000da40: 6820 3d20 6e64 0a20 2020 2020 2073 656c  h = nd.      sel
+0000da50: 662e 7820 3d20 6e70 2e61 7366 6172 7261  f.x = np.asfarra
+0000da60: 7928 7829 2020 2020 2020 2020 2023 2061  y(x)         # a
+0000da70: 6273 6369 7373 6120 2d20 2278 2076 616c  bscissa - "x val
+0000da80: 7565 7322 0a20 2020 2020 2073 656c 662e  ues".      self.
+0000da90: 7920 3d20 6e70 2e61 7366 6172 7261 7928  y = np.asfarray(
+0000daa0: 7929 2020 2020 2020 2020 2023 206f 7264  y)         # ord
+0000dab0: 696e 6174 6520 2d20 2279 2076 616c 7565  inate - "y value
+0000dac0: 7322 0a20 2020 2020 2069 6620 6578 2069  s".      if ex i
+0000dad0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000dae0: 2020 2020 7365 6c66 2e65 7820 3d20 6e70      self.ex = np
+0000daf0: 2e61 7366 6172 7261 7928 6578 2920 2020  .asfarray(ex)   
+0000db00: 2020 2020 2320 696e 6465 7065 6e64 656e      # independen
+0000db10: 7420 756e 6365 7274 6169 6e74 6965 7320  t uncertainties 
+0000db20: 780a 2020 2020 2020 2020 6966 2073 656c  x.        if sel
+0000db30: 662e 6578 2e6e 6469 6d20 3d3d 2030 3a0a  f.ex.ndim == 0:.
+0000db40: 2020 2020 2020 2020 2020 7365 6c66 2e65            self.e
+0000db50: 7820 3d20 7365 6c66 2e65 7820 2a20 6e70  x = self.ex * np
+0000db60: 2e6f 6e65 7328 6e64 290a 2020 2020 2020  .ones(nd).      
+0000db70: 2020 656c 6966 2073 656c 662e 6578 2e6e    elif self.ex.n
+0000db80: 6469 6d20 3d3d 2032 3a0a 2020 2020 2020  dim == 2:.      
+0000db90: 2020 2020 7365 6c66 2e6e 6565 6473 5f63      self.needs_c
+0000dba0: 6f76 6172 6961 6e63 653d 5472 7565 0a20  ovariance=True. 
+0000dbb0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000dbc0: 2020 2073 656c 662e 6578 203d 204e 6f6e     self.ex = Non
+0000dbd0: 650a 2020 2020 2020 6966 2065 7920 6973  e.      if ey is
+0000dbe0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000dbf0: 2020 2073 656c 662e 6579 203d 206e 702e     self.ey = np.
+0000dc00: 6173 6661 7272 6179 2865 7929 2020 2020  asfarray(ey)    
+0000dc10: 2020 2023 2069 6e64 6570 656e 6465 6e74     # independent
+0000dc20: 2075 6e63 6572 7461 696e 7469 6573 2079   uncertainties y
+0000dc30: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000dc40: 2e65 792e 6e64 696d 203d 3d20 303a 0a20  .ey.ndim == 0:. 
+0000dc50: 2020 2020 2020 2020 2073 656c 662e 6579           self.ey
+0000dc60: 203d 2073 656c 662e 6579 202a 206e 702e   = self.ey * np.
+0000dc70: 6f6e 6573 286e 6429 0a20 2020 2020 2020  ones(nd).       
+0000dc80: 2065 6c69 6620 7365 6c66 2e65 792e 6e64   elif self.ey.nd
+0000dc90: 696d 203d 3d20 323a 0a20 2020 2020 2020  im == 2:.       
+0000dca0: 2020 2073 656c 662e 6e65 6564 735f 636f     self.needs_co
+0000dcb0: 7661 7269 616e 6365 3d54 7275 650a 2020  variance=True.  
+0000dcc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000dcd0: 2020 7365 6c66 2e65 7920 3d20 4e6f 6e65    self.ey = None
+0000dce0: 0a20 2020 2020 2069 6620 6572 656c 7820  .      if erelx 
+0000dcf0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000dd00: 2020 2020 2073 656c 662e 6572 656c 7820       self.erelx 
+0000dd10: 3d20 6e70 2e61 7366 6172 7261 7928 6572  = np.asfarray(er
+0000dd20: 656c 7829 2023 2069 6e64 6570 656e 6465  elx) # independe
+0000dd30: 6e74 2072 656c 6174 6976 6520 756e 6365  nt relative unce
+0000dd40: 7274 6169 6e74 6965 7320 780a 2020 2020  rtainties x.    
+0000dd50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000dd60: 7365 6c66 2e65 7265 6c78 203d 204e 6f6e  self.erelx = Non
+0000dd70: 650a 2020 2020 2020 6966 2065 7265 6c79  e.      if erely
+0000dd80: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0000dd90: 2020 2020 2020 7365 6c66 2e65 7265 6c79        self.erely
+0000dda0: 203d 206e 702e 6173 6661 7272 6179 2865   = np.asfarray(e
+0000ddb0: 7265 6c79 2920 2320 696e 6465 7065 6e64  rely) # independ
+0000ddc0: 656e 7420 7265 6c61 7469 7665 2075 6e63  ent relative unc
+0000ddd0: 6572 7461 696e 7469 6573 2079 0a20 2020  ertainties y.   
+0000dde0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000ddf0: 2073 656c 662e 6572 656c 7920 3d20 4e6f   self.erely = No
+0000de00: 6e65 0a20 2020 2020 2069 6620 6361 6273  ne.      if cabs
+0000de10: 7820 6973 206e 6f74 204e 6f6e 653a 0a20  x is not None:. 
+0000de20: 2020 2020 2020 2073 656c 662e 6361 6273         self.cabs
+0000de30: 7820 3d20 6e70 2e61 7366 6172 7261 7928  x = np.asfarray(
+0000de40: 6361 6273 7829 2023 2063 6f72 7265 6c61  cabsx) # correla
+0000de50: 7465 6420 6162 6f6c 7574 6520 756e 6365  ted abolute unce
+0000de60: 7274 6169 6e74 6965 7320 780a 2020 2020  rtainties x.    
+0000de70: 2020 2020 6966 2073 656c 662e 6361 6273      if self.cabs
+0000de80: 782e 6e64 696d 203d 3d20 303a 0a20 2020  x.ndim == 0:.   
+0000de90: 2020 2020 2020 2073 656c 662e 6361 6273         self.cabs
+0000dea0: 7820 3d20 7365 6c66 2e63 6162 7378 202a  x = self.cabsx *
+0000deb0: 206e 702e 6f6e 6573 286e 6429 0a20 2020   np.ones(nd).   
+0000dec0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000ded0: 2073 656c 662e 6361 6273 7820 3d20 4e6f   self.cabsx = No
+0000dee0: 6e65 0a20 2020 2020 2069 6620 6372 656c  ne.      if crel
+0000def0: 7820 6973 206e 6f74 204e 6f6e 653a 2020  x is not None:  
+0000df00: 200a 2020 2020 2020 2020 7365 6c66 2e63   .        self.c
+0000df10: 7265 6c78 203d 206e 702e 6173 6661 7272  relx = np.asfarr
+0000df20: 6179 2863 7265 6c78 2920 2320 636f 7272  ay(crelx) # corr
+0000df30: 656c 6174 6564 2072 656c 6174 6976 6520  elated relative 
+0000df40: 756e 6365 7274 6169 6e74 6965 7320 780a  uncertainties x.
+0000df50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000df60: 2020 2020 7365 6c66 2e63 7265 6c78 203d      self.crelx =
+0000df70: 204e 6f6e 650a 2020 2020 2020 6966 2063   None.      if c
+0000df80: 6162 7379 2069 7320 6e6f 7420 4e6f 6e65  absy is not None
+0000df90: 3a0a 2020 2020 2020 2020 7365 6c66 2e63  :.        self.c
+0000dfa0: 6162 7379 203d 206e 702e 6173 6661 7272  absy = np.asfarr
+0000dfb0: 6179 2863 6162 7379 2920 2320 636f 7272  ay(cabsy) # corr
+0000dfc0: 656c 6174 6564 2061 6273 6f6c 7574 6520  elated absolute 
+0000dfd0: 756e 6365 7274 6169 6e74 6965 7320 790a  uncertainties y.
+0000dfe0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000dff0: 6361 6273 792e 6e64 696d 203d 3d20 303a  cabsy.ndim == 0:
+0000e000: 0a20 2020 2020 2020 2020 2073 656c 662e  .          self.
+0000e010: 6361 6273 7920 3d20 7365 6c66 2e63 6162  cabsy = self.cab
+0000e020: 7379 202a 206e 702e 6f6e 6573 286e 6429  sy * np.ones(nd)
+0000e030: 0a20 2020 2020 2065 6c73 653a 0a20 2020  .      else:.   
+0000e040: 2020 2020 2073 656c 662e 6361 6273 7920       self.cabsy 
+0000e050: 3d20 4e6f 6e65 0a20 2020 2020 2069 6620  = None.      if 
+0000e060: 6372 656c 7920 6973 206e 6f74 204e 6f6e  crely is not Non
+0000e070: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
+0000e080: 6372 656c 7920 3d20 6e70 2e61 7366 6172  crely = np.asfar
+0000e090: 7261 7928 6372 656c 7929 2023 2063 6f72  ray(crely) # cor
+0000e0a0: 7265 6c61 7465 6420 7265 6c61 7469 7665  related relative
+0000e0b0: 2075 6e63 6572 7461 696e 7469 6573 2079   uncertainties y
+0000e0c0: 0a20 2020 2020 2065 6c73 653a 0a20 2020  .      else:.   
+0000e0d0: 2020 2020 2073 656c 662e 6372 656c 7920       self.crely 
+0000e0e0: 3d20 4e6f 6e65 0a20 2020 2020 2073 656c  = None.      sel
+0000e0f0: 662e 7175 6965 7420 3d20 7175 6965 7420  f.quiet = quiet 
+0000e100: 2020 2020 2023 206e 6f20 696e 666f 726d       # no inform
+0000e110: 6174 6976 6520 7072 696e 746f 7574 2069  ative printout i
+0000e120: 6620 5472 7565 0a0a 2020 2020 2020 7365  f True..      se
+0000e130: 6c66 2e6e 6420 3d20 6e64 0a20 2020 2020  lf.nd = nd.     
+0000e140: 2073 656c 662e 6d6f 6465 6c20 3d20 4e6f   self.model = No
+0000e150: 6e65 2023 206e 6f20 6d6f 6465 6c20 6465  ne # no model de
+0000e160: 6669 6e65 6420 7965 740a 2020 2020 2020  fined yet.      
+0000e170: 7365 6c66 2e6d 6f64 656c 5f76 616c 7565  self.model_value
+0000e180: 7320 3d20 4e6f 6e65 0a0a 2020 2020 2020  s = None..      
+0000e190: 2320 7365 7420 666c 6167 7320 666f 7220  # set flags for 
+0000e1a0: 7374 6565 7269 6e67 206f 6620 6669 7420  steering of fit 
+0000e1b0: 7072 6f63 6573 7320 696e 2064 6f5f 6669  process in do_fi
+0000e1c0: 7428 290a 2020 2020 2020 7365 6c66 2e72  t().      self.r
+0000e1d0: 6562 756c 696c 6443 6f76 203d 204e 6f6e  ebulildCov = Non
+0000e1e0: 650a 2020 2020 2020 7365 6c66 2e68 6173  e.      self.has
+0000e1f0: 5f78 4572 726f 7273 203d 2065 7820 6973  _xErrors = ex is
+0000e200: 206e 6f74 204e 6f6e 6520 6f72 2065 7265   not None or ere
+0000e210: 6c78 2069 7320 6e6f 7420 4e6f 6e65 205c  lx is not None \
+0000e220: 0a20 2020 2020 2020 206f 7220 6361 6273  .        or cabs
+0000e230: 7820 6973 206e 6f74 204e 6f6e 6520 6f72  x is not None or
+0000e240: 2063 7265 6c78 2069 7320 6e6f 7420 4e6f   crelx is not No
+0000e250: 6e65 0a20 2020 2020 2073 656c 662e 6861  ne.      self.ha
+0000e260: 735f 7265 6c5f 7945 7272 6f72 7320 3d20  s_rel_yErrors = 
+0000e270: 6572 656c 7920 6973 206e 6f74 204e 6f6e  erely is not Non
+0000e280: 6520 6f72 2063 7265 6c79 2069 7320 6e6f  e or crely is no
+0000e290: 7420 4e6f 6e65 0a20 2020 2020 2073 656c  t None.      sel
+0000e2a0: 662e 6e65 6564 735f 636f 7661 7269 616e  f.needs_covarian
+0000e2b0: 6365 203d 2073 656c 662e 6e65 6564 735f  ce = self.needs_
+0000e2c0: 636f 7661 7269 616e 6365 206f 7220 5c0a  covariance or \.
+0000e2d0: 2020 2020 2020 2020 7365 6c66 2e63 6162          self.cab
+0000e2e0: 7378 2069 7320 6e6f 7420 4e6f 6e65 206f  sx is not None o
+0000e2f0: 7220 7365 6c66 2e63 7265 6c78 2069 7320  r self.crelx is 
+0000e300: 6e6f 7420 4e6f 6e65 206f 7220 5c0a 2020  not None or \.  
+0000e310: 2020 2020 2020 7365 6c66 2e63 6162 7379        self.cabsy
+0000e320: 2069 7320 6e6f 7420 4e6f 6e65 206f 7220   is not None or 
+0000e330: 7365 6c66 2e63 7265 6c79 2069 7320 6e6f  self.crely is no
+0000e340: 7420 4e6f 6e65 200a 0a20 2020 2020 2023  t None ..      #
+0000e350: 2062 7569 6c64 2028 696e 6974 6961 6c29   build (initial)
+0000e360: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
+0000e370: 6978 2028 7769 7468 6f75 7420 782d 6572  ix (without x-er
+0000e380: 726f 7273 290a 2020 2020 2020 6966 2073  rors).      if s
+0000e390: 656c 662e 6e65 6564 735f 636f 7661 7269  elf.needs_covari
+0000e3a0: 616e 6365 3a0a 2020 2020 2020 2020 6572  ance:.        er
+0000e3b0: 7232 203d 205f 6275 696c 645f 436f 764d  r2 = _build_CovM
+0000e3c0: 6174 2873 656c 662e 6e64 2c0a 2020 2020  at(self.nd,.    
+0000e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3e0: 7365 6c66 2e65 792c 2073 656c 662e 6572  self.ey, self.er
+0000e3f0: 656c 792c 2073 656c 662e 6361 6273 792c  ely, self.cabsy,
+0000e400: 2073 656c 662e 6372 656c 792c 2073 656c   self.crely, sel
+0000e410: 662e 7929 0a20 2020 2020 2065 6c73 653a  f.y).      else:
+0000e420: 0a20 2020 2020 2020 2065 7272 3220 3d20  .        err2 = 
+0000e430: 5f62 7569 6c64 5f45 7272 3228 7365 6c66  _build_Err2(self
+0000e440: 2e65 792c 2073 656c 662e 6572 656c 792c  .ey, self.erely,
+0000e450: 2073 656c 662e 7929 0a0a 2020 2020 2020   self.y)..      
+0000e460: 2320 696e 6974 6961 6c69 7a65 2075 6e63  # initialize unc
+0000e470: 6572 7461 696e 7469 6573 2061 6e64 2063  ertainties and c
+0000e480: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
+0000e490: 2c0a 2020 2020 2020 7365 6c66 2e5f 696e  ,.      self._in
+0000e4a0: 6974 6961 6c43 6f76 2865 7272 3229 0a20  itialCov(err2). 
+0000e4b0: 2020 2020 2023 2073 6574 733a 200a 2020       # sets: .  
+0000e4c0: 2020 2020 2320 2020 7365 6c66 2e63 6f76      #   self.cov
+0000e4d0: 783a 2063 6f76 6172 6961 6e63 6520 6d61  x: covariance ma
+0000e4e0: 7472 6978 206f 6620 780a 2020 2020 2020  trix of x.      
+0000e4f0: 2320 2020 7365 6c66 2e63 6f76 793a 2063  #   self.covy: c
+0000e500: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
+0000e510: 206f 6620 7920 756e 6365 7274 6169 6e74   of y uncertaint
+0000e520: 6965 730a 2020 2020 2020 2320 2020 7365  ies.      #   se
+0000e530: 6c66 2e63 6f76 3a20 6675 6c6c 2063 6f76  lf.cov: full cov
+0000e540: 6172 6961 6e63 6520 6d61 7472 6978 2069  ariance matrix i
+0000e550: 6e63 6c2e 2070 726f 6a65 6374 6564 2078  ncl. projected x
+0000e560: 0a20 2020 2020 2023 2020 2073 656c 662e  .      #   self.
+0000e570: 6943 6f76 3a20 696e 7665 7273 6520 6f66  iCov: inverse of
+0000e580: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
+0000e590: 6978 0a20 2020 2020 2023 2020 2073 656c  ix.      #   sel
+0000e5a0: 662e 6572 7232 3a20 6172 7261 7920 6f66  f.err2: array of
+0000e5b0: 2073 7175 6172 6564 2075 6e63 6572 7461   squared uncerta
+0000e5c0: 696e 7469 6573 0a20 2020 2020 2023 2020  inties.      #  
+0000e5d0: 2073 656c 662e 6945 7272 323a 2031 2e2f   self.iErr2: 1./
+0000e5e0: 7365 6c66 2e65 7272 320a 2020 2020 2020  self.err2.      
+0000e5f0: 0a20 2020 2064 6566 205f 696e 6974 6961  .    def _initia
+0000e600: 6c43 6f76 2873 656c 662c 2065 7272 3229  lCov(self, err2)
+0000e610: 3a0a 2020 2020 2020 2222 2242 7569 6c64  :.      """Build
+0000e620: 2069 6e69 7469 616c 2028 7374 6174 6963   initial (static
+0000e630: 2920 636f 7661 7269 616e 6365 206d 6174  ) covariance mat
+0000e640: 7269 7820 666f 7220 792d 6572 726f 7273  rix for y-errors
+0000e650: 0a20 2020 2020 2028 666f 7220 7072 652d  .      (for pre-
+0000e660: 6669 7429 2061 6e64 2063 616c 6375 6c61  fit) and calcula
+0000e670: 7465 2069 6e76 6572 7365 206d 6174 7269  te inverse matri
+0000e680: 780a 2020 2020 2020 2222 220a 2020 2020  x.      """.    
+0000e690: 2020 6966 2065 7272 322e 6e64 696d 203d    if err2.ndim =
+0000e6a0: 3d20 323a 0a20 2020 2020 2020 2320 676f  = 2:.       # go
+0000e6b0: 7420 6120 636f 7661 7269 616e 6365 206d  t a covariance m
+0000e6c0: 6174 7269 782c 206e 6565 6420 696e 7665  atrix, need inve
+0000e6d0: 7273 650a 2020 2020 2020 2020 7365 6c66  rse.        self
+0000e6e0: 2e6e 6565 6473 5f63 6f76 6172 6961 6e63  .needs_covarianc
+0000e6f0: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
+0000e700: 2073 656c 662e 636f 7679 203d 2065 7272   self.covy = err
+0000e710: 320a 2020 2020 2020 2020 7365 6c66 2e69  2.        self.i
+0000e720: 436f 7620 3d20 6c69 6e61 6c67 2e69 6e76  Cov = linalg.inv
+0000e730: 2865 7272 3229 0a20 2020 2020 2020 2073  (err2).        s
+0000e740: 656c 662e 6572 7232 203d 206e 702e 6469  elf.err2 = np.di
+0000e750: 6167 6f6e 616c 2865 7272 3229 2023 2073  agonal(err2) # s
+0000e760: 7175 6172 6564 2064 6961 676f 6e61 6c20  quared diagonal 
+0000e770: 656c 656d 656e 7473 0a20 2020 2020 2065  elements.      e
+0000e780: 6c73 653a 0a20 2020 2020 2023 2067 6f74  lse:.      # got
+0000e790: 2069 6e64 6570 656e 6465 6e74 2075 6e63   independent unc
+0000e7a0: 6572 7461 696e 7469 6573 0a20 2020 2020  ertainties.     
+0000e7b0: 2020 2073 656c 662e 6572 7232 203d 2065     self.err2 = e
+0000e7c0: 7272 320a 2020 2020 2020 2020 7365 6c66  rr2.        self
+0000e7d0: 2e65 7272 3279 203d 2065 7272 320a 2020  .err2y = err2.  
+0000e7e0: 2020 2020 2020 7365 6c66 2e69 4572 7232        self.iErr2
+0000e7f0: 203d 2031 2e2f 6572 7232 0a20 2020 2020   = 1./err2.     
+0000e800: 2020 2073 656c 662e 636f 7679 203d 206e     self.covy = n
+0000e810: 702e 6469 6167 2865 7272 3229 0a20 2020  p.diag(err2).   
+0000e820: 2020 2020 2073 656c 662e 6943 6f76 203d       self.iCov =
+0000e830: 206e 702e 6469 6167 2831 2e2f 7365 6c66   np.diag(1./self
+0000e840: 2e65 7272 3229 0a20 2020 2020 2023 2064  .err2).      # d
+0000e850: 6f20 6e6f 7420 7265 6275 696c 6420 636f  o not rebuild co
+0000e860: 7661 7269 616e 6365 206d 6174 7269 7820  variance matrix 
+0000e870: 696e 2063 6f73 7420 6675 6e63 7469 6f6e  in cost function
+0000e880: 0a20 2020 2020 2073 656c 662e 6e65 6564  .      self.need
+0000e890: 735f 6479 6e61 6d69 6345 7272 6f72 7320  s_dynamicErrors 
+0000e8a0: 3d20 4661 6c73 6520 0a0a 2020 2020 2020  = False ..      
+0000e8b0: 2320 6e6f 2063 6f76 6172 6961 6e63 6520  # no covariance 
+0000e8c0: 6f66 2078 2d65 7272 6f72 730a 2020 2020  of x-errors.    
+0000e8d0: 2020 7365 6c66 2e63 6f76 7820 3d20 4e6f    self.covx = No
+0000e8e0: 6e65 0a20 2020 2020 2073 656c 662e 6572  ne.      self.er
+0000e8f0: 7232 7820 3d20 4e6f 6e65 0a20 2020 2020  r2x = None.     
+0000e900: 2023 2074 6f74 616c 2063 6f76 6172 6961   # total covaria
+0000e910: 6e63 6520 6973 2074 6861 7420 6f66 2079  nce is that of y
+0000e920: 2d65 7272 6f72 730a 2020 2020 2020 7365  -errors.      se
+0000e930: 6c66 2e63 6f76 203d 2073 656c 662e 636f  lf.cov = self.co
+0000e940: 7679 2020 2020 2020 0a20 2020 2020 200a  vy      .      .
+0000e950: 2020 2020 6465 6620 696e 6974 5f64 796e      def init_dyn
+0000e960: 616d 6963 4572 726f 7273 2873 656c 6629  amicErrors(self)
+0000e970: 3a0a 2020 2020 2020 2320 6d65 7468 6f64  :.      # method
+0000e980: 2074 6f20 7377 6974 6368 206f 6e20 6479   to switch on dy
+0000e990: 6e61 6d69 6320 7265 2d63 616c 6375 6c61  namic re-calcula
+0000e9a0: 7469 6f6e 206f 6620 636f 7661 7269 616e  tion of covarian
+0000e9b0: 6365 206d 6174 7269 7820 0a20 2020 2020  ce matrix .     
+0000e9c0: 2073 656c 662e 7265 665f 746f 4d6f 6465   self.ref_toMode
+0000e9d0: 6c20 3d20 7365 6c66 2e6f 7574 6572 2e72  l = self.outer.r
+0000e9e0: 6566 4d6f 6465 6c0a 2020 2020 2020 7365  efModel.      se
+0000e9f0: 6c66 2e6d 6f64 656c 203d 2073 656c 662e  lf.model = self.
+0000ea00: 6f75 7465 722e 636f 7374 662e 6d6f 6465  outer.costf.mode
+0000ea10: 6c0a 2020 2020 200a 2020 2020 2020 7365  l.     .      se
+0000ea20: 6c66 2e5f 7374 6174 6963 436f 7620 3d20  lf._staticCov = 
+0000ea30: 4e6f 6e65 0a20 2020 2020 2073 656c 662e  None.      self.
+0000ea40: 5f73 7461 7469 6345 7272 3220 3d20 4e6f  _staticErr2 = No
+0000ea50: 6e65 0a20 2020 2020 2073 656c 662e 6943  ne.      self.iC
+0000ea60: 6f76 203d 204e 6f6e 650a 2020 2020 2020  ov = None.      
+0000ea70: 7365 6c66 2e69 4572 7232 203d 204e 6f6e  self.iErr2 = Non
+0000ea80: 650a 0a20 2020 2020 2023 2072 6562 7569  e..      # rebui
+0000ea90: 6c64 2063 6f76 6172 6961 6e63 6520 6d61  ld covariance ma
+0000eaa0: 7472 6978 2064 7572 696e 6720 6669 7474  trix during fitt
+0000eab0: 696e 6720 7072 6f63 6564 7572 650a 2020  ing procedure.  
+0000eac0: 2020 2020 7365 6c66 2e6e 6565 6473 5f64      self.needs_d
+0000ead0: 796e 616d 6963 4572 726f 7273 203d 2054  ynamicErrors = T
+0000eae0: 7275 6520 2020 2023 2066 6c61 6720 666f  rue    # flag fo
+0000eaf0: 7220 636f 7374 2066 756e 6374 696f 6e0a  r cost function.
+0000eb00: 2020 2020 2020 7365 6c66 2e66 696e 616c        self.final
+0000eb10: 5f63 616c 6c20 3d20 4661 6c73 6520 2320  _call = False # 
+0000eb20: 666c 6167 2066 6f72 205f 7265 6275 696c  flag for _rebuil
+0000eb30: 645f 436f 763a 206e 6f20 7374 6f72 6167  d_Cov: no storag
+0000eb40: 6520 6f66 2079 636f 7620 0a20 2020 2020  e of ycov .     
+0000eb50: 200a 2020 2020 2020 6966 2073 656c 662e   .      if self.
+0000eb60: 6e65 6564 735f 636f 7661 7269 616e 6365  needs_covariance
+0000eb70: 3a0a 2020 2020 2020 2020 2320 6275 696c  :.        # buil
+0000eb80: 6420 7374 6174 6963 2028 3d70 6172 616d  d static (=param
+0000eb90: 6574 6572 2d69 6e64 6570 656e 6465 6e74  eter-independent
+0000eba0: 2920 7061 7274 206f 6620 636f 7661 7269  ) part of covari
+0000ebb0: 616e 6365 206d 6174 7269 7820 2020 2020  ance matrix     
+0000ebc0: 200a 2020 2020 2020 2020 6966 2073 656c   .        if sel
+0000ebd0: 662e 6861 735f 7265 6c5f 7945 7272 6f72  f.has_rel_yError
+0000ebe0: 7320 616e 6420 7365 6c66 2e72 6566 5f74  s and self.ref_t
+0000ebf0: 6f4d 6f64 656c 3a0a 2020 2020 2020 2020  oModel:.        
+0000ec00: 2020 2320 736f 6d65 2079 2d65 7272 6f72    # some y-error
+0000ec10: 7320 6172 6520 7061 7261 6d65 7465 722d  s are parameter-
+0000ec20: 696e 6465 7065 6e64 656e 740a 2020 2020  independent.    
+0000ec30: 2020 2020 2020 7365 6c66 2e5f 7374 6174        self._stat
+0000ec40: 6963 436f 7620 3d20 5f62 7569 6c64 5f43  icCov = _build_C
+0000ec50: 6f76 4d61 7428 7365 6c66 2e6e 642c 0a20  ovMat(self.nd,. 
+0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ec70: 2020 2020 2020 7365 6c66 2e65 792c 2065        self.ey, e
+0000ec80: 6162 7363 6f72 203d 2073 656c 662e 6361  abscor = self.ca
+0000ec90: 6273 7929 0a20 2020 2020 2020 2065 6c73  bsy).        els
+0000eca0: 653a 200a 2020 2020 2020 2020 2020 2320  e: .          # 
+0000ecb0: 616c 6c20 792d 6572 726f 7273 2061 7265  all y-errors are
+0000ecc0: 2070 6172 616d 6574 6572 2d69 6e64 6570   parameter-indep
+0000ecd0: 656e 6465 6e74 0a20 2020 2020 2020 2020  endent.         
+0000ece0: 2073 656c 662e 5f73 7461 7469 6343 6f76   self._staticCov
+0000ecf0: 203d 205f 6275 696c 645f 436f 764d 6174   = _build_CovMat
+0000ed00: 2873 656c 662e 6e64 2c0a 2020 2020 2020  (self.nd,.      
+0000ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed20: 2020 2020 2020 2020 7365 6c66 2e65 792c          self.ey,
+0000ed30: 2065 7265 6c3d 7365 6c66 2e65 7265 6c79   erel=self.erely
+0000ed40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0000ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed60: 2020 2020 2020 6461 7461 3d6e 702e 6f6e        data=np.on
-0000ed70: 6573 2873 656c 662e 6e64 2929 0a20 2020  es(self.nd)).   
-0000ed80: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000ed90: 2020 2020 2073 656c 662e 5f63 6f76 7930       self._covy0
-0000eda0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0000edb0: 2320 636f 7661 7269 616e 6365 206d 6174  # covariance mat
-0000edc0: 7269 7820 6f66 2078 2d75 6e63 6572 7461  rix of x-uncerta
-0000edd0: 696e 7469 6573 2028 616c 6c20 6172 6520  inties (all are 
-0000ede0: 7061 7261 6d65 7465 722d 6465 7065 6e64  parameter-depend
-0000edf0: 656e 7429 0a20 2020 2020 2020 2069 6620  ent).        if 
-0000ee00: 7365 6c66 2e68 6173 5f78 4572 726f 7273  self.has_xErrors
-0000ee10: 3a0a 2020 2020 2020 2020 2020 7365 6c66  :.          self
-0000ee20: 2e63 6f76 7820 3d20 5f62 7569 6c64 5f43  .covx = _build_C
-0000ee30: 6f76 4d61 7428 7365 6c66 2e6e 642c 0a20  ovMat(self.nd,. 
-0000ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee50: 2020 2020 2020 2020 7365 6c66 2e65 782c          self.ex,
-0000ee60: 2073 656c 662e 6572 656c 782c 0a20 2020   self.erelx,.   
-0000ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee80: 2020 2020 2020 7365 6c66 2e63 6162 7378        self.cabsx
-0000ee90: 2c20 7365 6c66 2e63 7265 6c78 2c0a 2020  , self.crelx,.  
-0000eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eeb0: 2020 2020 2020 2073 656c 662e 7829 0a20         self.x). 
-0000eec0: 2020 2020 2020 2020 2320 2064 6574 6572          #  deter
-0000eed0: 6d69 6e65 2064 7820 666f 7220 6465 7269  mine dx for deri
-0000eee0: 7661 7469 7665 2066 726f 6d20 736d 616c  vative from smal
-0000eef0: 6c65 7374 2078 2d75 6e63 6572 7461 696e  lest x-uncertain
-0000ef00: 7479 0a20 2020 2020 2020 2020 2073 656c  ty.          sel
-0000ef10: 662e 5f64 7820 3d20 6e70 2e73 7172 7428  f._dx = np.sqrt(
-0000ef20: 6d69 6e28 6e70 2e64 6961 676f 6e61 6c28  min(np.diagonal(
-0000ef30: 7365 6c66 2e63 6f76 7829 2929 2f31 302e  self.covx)))/10.
-0000ef40: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000ef50: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-0000ef60: 7678 203d 204e 6f6e 650a 0a20 2020 2020  vx = None..     
-0000ef70: 2065 6c73 653a 2023 206e 6f20 636f 7661   else: # no cova
-0000ef80: 7269 616e 6365 206e 6565 6465 642c 2075  riance needed, u
-0000ef90: 7365 2073 696d 706c 6520 6d61 7468 0a20  se simple math. 
-0000efa0: 2020 2020 2020 2023 2062 7569 6c64 2073         # build s
-0000efb0: 7461 7469 6320 283d 7061 7261 6d65 7465  tatic (=paramete
-0000efc0: 722d 696e 6465 7065 6e64 656e 7429 2070  r-independent) p
-0000efd0: 6172 7420 6f66 2063 6f76 6172 6961 6e63  art of covarianc
-0000efe0: 6520 6d61 7472 6978 2020 2020 2020 0a20  e matrix      . 
-0000eff0: 2020 2020 2020 2069 6620 7365 6c66 2e68         if self.h
-0000f000: 6173 5f72 656c 5f79 4572 726f 7273 2061  as_rel_yErrors a
-0000f010: 6e64 2073 656c 662e 7265 665f 746f 4d6f  nd self.ref_toMo
-0000f020: 6465 6c3a 0a20 2020 2020 2020 2020 2023  del:.          #
-0000f030: 206f 6e6c 7920 696e 6465 7065 6e64 656e   only independen
-0000f040: 7420 792d 6572 726f 7273 2064 6f20 6e6f  t y-errors do no
-0000f050: 7420 6465 7065 6e64 206f 6e20 7061 7261  t depend on para
-0000f060: 6d65 7465 7273 0a20 2020 2020 2020 2020  meters.         
-0000f070: 2073 656c 662e 5f73 7461 7469 6345 7272   self._staticErr
-0000f080: 3220 3d20 5f62 7569 6c64 5f45 7272 3228  2 = _build_Err2(
-0000f090: 7365 6c66 2e65 7929 0a20 2020 2020 2020  self.ey).       
-0000f0a0: 2065 6c73 653a 200a 2020 2020 2020 2020   else: .        
-0000f0b0: 2020 2320 616c 6c20 792d 6572 726f 7273    # all y-errors
-0000f0c0: 2061 7265 2070 6172 616d 6574 6572 2d69   are parameter-i
-0000f0d0: 6e64 6570 656e 6465 6e74 0a20 2020 2020  ndependent.     
-0000f0e0: 2020 2020 2073 656c 662e 5f73 7461 7469       self._stati
-0000f0f0: 6345 7272 3220 3d20 5f62 7569 6c64 5f45  cErr2 = _build_E
-0000f100: 7272 3228 2073 656c 662e 6579 2c20 7365  rr2( self.ey, se
-0000f110: 6c66 2e65 7265 6c79 2c20 7365 6c66 2e79  lf.erely, self.y
-0000f120: 290a 2020 2020 2020 2020 2020 0a20 2020  ).          .   
-0000f130: 2020 2020 2069 6620 7365 6c66 2e68 6173       if self.has
-0000f140: 5f78 4572 726f 7273 3a0a 2020 2020 2020  _xErrors:.      
-0000f150: 2020 2020 7365 6c66 2e65 7272 3278 203d      self.err2x =
-0000f160: 205f 6275 696c 645f 4572 7232 2873 656c   _build_Err2(sel
-0000f170: 662e 6578 2c20 7365 6c66 2e65 7265 6c78  f.ex, self.erelx
-0000f180: 2c20 7365 6c66 2e78 290a 2020 2020 2020  , self.x).      
-0000f190: 2020 2023 2020 6465 7465 726d 696e 6520     #  determine 
-0000f1a0: 6478 2066 6f72 2064 6572 6976 6174 6976  dx for derivativ
-0000f1b0: 6520 6672 6f6d 2073 6d61 6c6c 6573 7420  e from smallest 
-0000f1c0: 782d 756e 6365 7274 6169 6e74 790a 2020  x-uncertainty.  
-0000f1d0: 2020 2020 2020 2020 7365 6c66 2e5f 6478          self._dx
-0000f1e0: 203d 206e 702e 7371 7274 286d 696e 2873   = np.sqrt(min(s
-0000f1f0: 656c 662e 6572 7232 7829 292f 3130 2e0a  elf.err2x))/10..
-0000f200: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000f210: 2020 2020 2020 2020 7365 6c66 2e65 7272          self.err
-0000f220: 3278 203d 204e 6f6e 650a 0a20 2020 2064  2x = None..    d
-0000f230: 6566 205f 7265 6275 696c 645f 4572 7232  ef _rebuild_Err2
-0000f240: 2873 656c 662c 206d 7061 7229 3a0a 2020  (self, mpar):.  
-0000f250: 2020 2020 2222 220a 2020 2020 2020 2852      """.      (R
-0000f260: 652d 2963 616c 6375 6c61 7465 2075 6e63  e-)calculate unc
-0000f270: 6572 7461 696e 6769 6573 200a 2020 2020  ertaingies .    
-0000f280: 2020 2222 220a 2020 2020 2020 6966 2073    """.      if s
-0000f290: 656c 662e 5f73 7461 7469 6345 7272 3220  elf._staticErr2 
-0000f2a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000f2b0: 2020 2020 2073 656c 662e 6572 7232 203d       self.err2 =
-0000f2c0: 206e 702e 6172 7261 7928 7365 6c66 2e5f   np.array(self._
-0000f2d0: 7374 6174 6963 4572 7232 2c20 636f 7079  staticErr2, copy
-0000f2e0: 3d54 7275 6529 0a20 2020 2020 2065 6c73  =True).      els
-0000f2f0: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
-0000f300: 6572 7232 203d 206e 702e 7a65 726f 7328  err2 = np.zeros(
-0000f310: 7365 6c66 2e6e 6429 0a20 2020 2020 2069  self.nd).      i
-0000f320: 6620 7365 6c66 2e72 6566 5f74 6f4d 6f64  f self.ref_toMod
-0000f330: 656c 2061 6e64 2073 656c 662e 6861 735f  el and self.has_
-0000f340: 7265 6c5f 7945 7272 6f72 733a 0a20 2020  rel_yErrors:.   
-0000f350: 2020 2020 205f 6572 203d 2073 656c 662e       _er = self.
-0000f360: 6572 656c 7920 2a20 7365 6c66 2e6d 6f64  erely * self.mod
-0000f370: 656c 2873 656c 662e 782c 202a 6d70 6172  el(self.x, *mpar
-0000f380: 2920 2020 2020 2020 0a20 2020 2020 2020  )       .       
-0000f390: 2073 656c 662e 6572 7232 202b 3d20 5f65   self.err2 += _e
-0000f3a0: 7220 2a20 5f65 720a 2020 2020 2020 2320  r * _er.      # 
-0000f3b0: 7265 6d65 6d62 6572 2079 2d65 7272 6f72  remember y-error
-0000f3c0: 7320 200a 2020 2020 2020 7365 6c66 2e65  s  .      self.e
-0000f3d0: 7272 3279 203d 206e 702e 6172 7261 7928  rr2y = np.array(
-0000f3e0: 7365 6c66 2e65 7272 322c 2063 6f70 793d  self.err2, copy=
-0000f3f0: 5472 7565 290a 2020 2020 2023 2061 6464  True).     # add
-0000f400: 2070 726f 6a65 6374 6564 2078 2065 7272   projected x err
-0000f410: 6f72 730a 2020 2020 2020 6966 2073 656c  ors.      if sel
-0000f420: 662e 6572 7232 7820 6973 206e 6f74 204e  f.err2x is not N
-0000f430: 6f6e 653a 0a20 2020 2020 2023 2064 6574  one:.      # det
-0000f440: 6572 6d69 6e65 2064 6572 6976 6174 6976  ermine derivativ
-0000f450: 6573 206f 6620 6d6f 6465 6c20 6675 6e63  es of model func
-0000f460: 7469 6f6e 2077 2e72 2e74 2e20 782c 0a20  tion w.r.t. x,. 
-0000f470: 2020 2020 2020 205f 6d70 7269 6d65 203d         _mprime =
-0000f480: 2030 2e35 202f 2073 656c 662e 5f64 7820   0.5 / self._dx 
-0000f490: 2a20 280a 2020 2020 2020 2020 2020 2020  * (.            
-0000f4a0: 2020 2073 656c 662e 6d6f 6465 6c28 7365     self.model(se
-0000f4b0: 6c66 2e78 202b 2073 656c 662e 5f64 782c  lf.x + self._dx,
-0000f4c0: 202a 6d70 6172 2920 2d20 0a20 2020 2020   *mpar) - .     
-0000f4d0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-0000f4e0: 6f64 656c 2873 656c 662e 7820 2d20 7365  odel(self.x - se
-0000f4f0: 6c66 2e5f 6478 2c20 2a6d 7061 7229 2029  lf._dx, *mpar) )
-0000f500: 0a20 2020 2020 2023 2070 726f 6a65 6374  .      # project
-0000f510: 206f 6e20 7920 616e 6420 6164 6420 746f   on y and add to
-0000f520: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
-0000f530: 6978 0a20 2020 2020 2020 2073 656c 662e  ix.        self.
-0000f540: 6572 7232 202b 3d20 5f6d 7072 696d 6520  err2 += _mprime 
-0000f550: 2a20 5f6d 7072 696d 6520 2a20 7365 6c66  * _mprime * self
-0000f560: 2e65 7272 3278 0a20 2020 2020 2020 200a  .err2x.        .
-0000f570: 2020 2020 6465 6620 5f72 6562 7569 6c64      def _rebuild
-0000f580: 5f43 6f76 2873 656c 662c 206d 7061 7229  _Cov(self, mpar)
-0000f590: 3a0a 2020 2020 2020 2222 220a 2020 2020  :.      """.    
-0000f5a0: 2020 2852 652d 2942 7569 6c64 2074 6865    (Re-)Build the
-0000f5b0: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
-0000f5c0: 6978 2066 726f 6d20 636f 6d70 6f6e 656e  ix from componen
-0000f5d0: 7473 0a20 2020 2020 2061 6e64 2063 6163  ts.      and cac
-0000f5e0: 6c75 6c61 7465 2069 7473 2069 6e76 6572  lulate its inver
-0000f5f0: 7365 0a20 2020 2020 2022 2222 0a20 2020  se.      """.   
-0000f600: 2020 2320 7374 6172 7420 6672 6f6d 2070    # start from p
-0000f610: 7265 2d62 7569 6c74 2070 6172 616d 6574  re-built paramet
-0000f620: 6572 2d69 6e64 6570 656e 6465 6e74 2070  er-independent p
-0000f630: 6172 7420 6f66 2043 6f76 6172 6961 6e63  art of Covarianc
-0000f640: 6520 4d61 7472 6978 0a20 2020 2020 2073  e Matrix.      s
-0000f650: 656c 662e 636f 7620 3d20 6e70 2e61 7272  elf.cov = np.arr
-0000f660: 6179 2873 656c 662e 5f73 7461 7469 6343  ay(self._staticC
-0000f670: 6f76 2c20 636f 7079 3d54 7275 6529 0a0a  ov, copy=True)..
-0000f680: 2020 2020 2023 2061 6464 206d 6174 7269       # add matri
-0000f690: 7820 6f66 2070 6172 616d 6574 6572 2d64  x of parameter-d
-0000f6a0: 6570 656e 6465 6e74 2079 2d75 6e63 6572  ependent y-uncer
-0000f6b0: 7461 696e 7469 6573 0a23 2020 2020 2020  tainties.#      
-0000f6c0: 6966 2073 656c 662e 7265 665f 746f 4d6f  if self.ref_toMo
-0000f6d0: 6465 6c20 616e 6420 7365 6c66 2e68 6173  del and self.has
-0000f6e0: 5f72 656c 5f79 4572 726f 7273 3a0a 2020  _rel_yErrors:.  
-0000f6f0: 2020 2020 6966 2073 656c 662e 5f63 6f76      if self._cov
-0000f700: 7930 2069 7320 6e6f 7420 4e6f 6e65 3a0a  y0 is not None:.
-0000f710: 2020 2020 2020 2020 5f79 6461 7420 3d20          _ydat = 
-0000f720: 7365 6c66 2e6d 6f64 656c 2873 656c 662e  self.model(self.
-0000f730: 782c 202a 6d70 6172 2920 2020 2020 2020  x, *mpar)       
-0000f740: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
-0000f750: 7620 2b3d 2073 656c 662e 5f63 6f76 7930  v += self._covy0
-0000f760: 202a 206e 702e 6f75 7465 7228 5f79 6461   * np.outer(_yda
-0000f770: 742c 205f 7964 6174 290a 2020 2020 2023  t, _ydat).     #
-0000f780: 2061 6464 2070 726f 6a65 6374 6564 2078   add projected x
-0000f790: 2065 7272 6f72 730a 2020 2020 2020 6966   errors.      if
-0000f7a0: 2073 656c 662e 6861 735f 7845 7272 6f72   self.has_xError
-0000f7b0: 733a 0a20 2020 2020 2020 2023 2073 746f  s:.        # sto
-0000f7c0: 7265 2063 6f76 6172 6961 6e63 6520 6d61  re covariance ma
-0000f7d0: 7472 6978 206f 6620 792d 756e 6365 7274  trix of y-uncert
-0000f7e0: 6169 6e74 6965 7320 2020 200a 2020 2020  ainties    .    
-0000f7f0: 2020 2020 6966 2073 656c 662e 6669 6e61      if self.fina
-0000f800: 6c5f 6361 6c6c 3a0a 2020 2020 2020 2020  l_call:.        
-0000f810: 2020 7365 6c66 2e63 6f76 7920 3d20 6e70    self.covy = np
-0000f820: 2e61 7272 6179 2873 656c 662e 636f 762c  .array(self.cov,
-0000f830: 2063 6f70 793d 5472 7565 290a 0a20 2020   copy=True)..   
-0000f840: 2020 2020 2320 6465 7465 726d 696e 6520      # determine 
-0000f850: 6465 7269 7661 7469 7665 7320 6f66 206d  derivatives of m
-0000f860: 6f64 656c 2066 756e 6374 696f 6e20 772e  odel function w.
-0000f870: 722e 742e 2078 2c0a 2020 2020 2020 2020  r.t. x,.        
-0000f880: 5f6d 7072 696d 6520 3d20 302e 3520 2f20  _mprime = 0.5 / 
-0000f890: 7365 6c66 2e5f 6478 202a 2028 0a20 2020  self._dx * (.   
-0000f8a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f8b0: 2e6d 6f64 656c 2873 656c 662e 7820 2b20  .model(self.x + 
-0000f8c0: 7365 6c66 2e5f 6478 2c20 2a6d 7061 7229  self._dx, *mpar)
-0000f8d0: 202d 200a 2020 2020 2020 2020 2020 2020   - .            
-0000f8e0: 2020 2073 656c 662e 6d6f 6465 6c28 7365     self.model(se
-0000f8f0: 6c66 2e78 202d 2073 656c 662e 5f64 782c  lf.x - self._dx,
-0000f900: 202a 6d70 6172 2920 290a 2020 2020 2020   *mpar) ).      
-0000f910: 2023 2070 726f 6a65 6374 206f 6e20 7920   # project on y 
-0000f920: 616e 6420 6164 6420 746f 2063 6f76 6172  and add to covar
-0000f930: 6961 6e63 6520 6d61 7472 6978 0a20 2020  iance matrix.   
-0000f940: 2020 2020 2073 656c 662e 636f 7620 2b3d       self.cov +=
-0000f950: 206e 702e 6f75 7465 7228 5f6d 7072 696d   np.outer(_mprim
-0000f960: 652c 205f 6d70 7269 6d65 2920 2a20 7365  e, _mprime) * se
-0000f970: 6c66 2e63 6f76 7820 2020 2020 200a 2020  lf.covx      .  
-0000f980: 2020 2020 656c 7365 3a20 2320 6e6f 2078      else: # no x
-0000f990: 2d65 7272 6f72 732c 2079 2d63 6f76 6d61  -errors, y-covma
-0000f9a0: 7420 3d20 636f 766d 6174 0a20 2020 2020  t = covmat.     
-0000f9b0: 2020 2073 656c 662e 636f 7679 203d 2073     self.covy = s
-0000f9c0: 656c 662e 636f 7620 2020 200a 0a20 2020  elf.cov    ..   
-0000f9d0: 2064 6566 2067 6574 5f43 6f76 2873 656c   def get_Cov(sel
-0000f9e0: 6629 3a0a 2020 2020 2020 2222 2272 6574  f):.      """ret
-0000f9f0: 7572 6e20 636f 7661 7269 616e 6365 206d  urn covariance m
-0000fa00: 6174 7269 7820 6f66 2064 6174 610a 2020  atrix of data.  
-0000fa10: 2020 2020 2222 220a 2020 2020 2020 6966      """.      if
-0000fa20: 2073 656c 662e 6e65 6564 735f 636f 7661   self.needs_cova
-0000fa30: 7269 616e 6365 3a0a 2020 2020 2020 2020  riance:.        
-0000fa40: 7265 7475 726e 2073 656c 662e 636f 760a  return self.cov.
-0000fa50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000fa60: 2020 2020 6966 2073 656c 662e 6572 7232      if self.err2
-0000fa70: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000fa80: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-0000fa90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000faa0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0000fab0: 702e 6469 6167 2873 656c 662e 6572 7232  p.diag(self.err2
-0000fac0: 290a 2020 0a20 2020 2064 6566 2067 6574  ).  .    def get
-0000fad0: 5f78 436f 7628 7365 6c66 293a 0a20 2020  _xCov(self):.   
-0000fae0: 2020 2022 2222 7265 7475 726e 2063 6f76     """return cov
-0000faf0: 6172 6961 6e63 6520 6d61 7472 6978 206f  ariance matrix o
-0000fb00: 6620 782d 6461 7461 0a20 2020 2020 2022  f x-data.      "
-0000fb10: 2222 0a20 2020 2020 2069 6620 7365 6c66  "".      if self
-0000fb20: 2e6e 6565 6473 5f63 6f76 6172 6961 6e63  .needs_covarianc
-0000fb30: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
-0000fb40: 6e20 7365 6c66 2e63 6f76 780a 2020 2020  n self.covx.    
-0000fb50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000fb60: 6966 2073 656c 662e 6572 7232 7820 6973  if self.err2x is
-0000fb70: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000fb80: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-0000fb90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000fba0: 2020 2020 2072 6574 7572 6e20 6e70 2e64       return np.d
-0000fbb0: 6961 6728 7365 6c66 2e65 7272 3278 290a  iag(self.err2x).
-0000fbc0: 0a20 2020 2064 6566 2067 6574 5f79 436f  .    def get_yCo
-0000fbd0: 7628 7365 6c66 293a 0a20 2020 2020 2022  v(self):.      "
-0000fbe0: 2222 7265 7475 726e 2063 6f76 6172 6961  ""return covaria
-0000fbf0: 6e63 6520 6d61 7472 6978 206f 6620 792d  nce matrix of y-
-0000fc00: 6461 7461 0a20 2020 2020 2022 2222 0a20  data.      """. 
-0000fc10: 2020 2020 2069 6620 7365 6c66 2e6e 6565       if self.nee
-0000fc20: 6473 5f63 6f76 6172 6961 6e63 653a 0a20  ds_covariance:. 
-0000fc30: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000fc40: 6c66 2e63 6f76 790a 2020 2020 2020 656c  lf.covy.      el
-0000fc50: 7365 3a0a 2020 2020 2020 2020 6966 2073  se:.        if s
-0000fc60: 656c 662e 6572 7232 7920 6973 204e 6f6e  elf.err2y is Non
-0000fc70: 653a 0a20 2020 2020 2020 2020 2072 6574  e:.          ret
-0000fc80: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0000fc90: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000fca0: 2072 6574 7572 6e20 6e70 2e64 6961 6728   return np.diag(
-0000fcb0: 7365 6c66 2e65 7272 3279 290a 2020 2020  self.err2y).    
-0000fcc0: 2020 0a20 2020 2064 6566 2067 6574 5f69    .    def get_i
-0000fcd0: 436f 7628 7365 6c66 293a 0a20 2020 2020  Cov(self):.     
-0000fce0: 2022 2222 7265 7475 726e 2069 6e76 6572   """return inver
-0000fcf0: 7365 206f 6620 636f 7661 7269 616e 6365  se of covariance
-0000fd00: 206d 6174 7269 782c 2061 7320 7573 6564   matrix, as used
-0000fd10: 2069 6e20 636f 7374 2066 756e 6374 696f   in cost functio
-0000fd20: 6e0a 2020 2020 2020 2222 220a 2020 2020  n.      """.    
-0000fd30: 2020 6966 2073 656c 662e 6e65 6564 735f    if self.needs_
-0000fd40: 636f 7661 7269 616e 6365 3a0a 2020 2020  covariance:.    
-0000fd50: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000fd60: 6943 6f76 0a20 2020 2020 2065 6c73 653a  iCov.      else:
-0000fd70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000fd80: 6e70 2e64 6961 6728 312e 2f73 656c 662e  np.diag(1./self.
-0000fd90: 6572 7232 290a 0a20 2020 2064 6566 2070  err2)..    def p
-0000fda0: 6c6f 7428 7365 6c66 2c20 6e75 6d3d 2778  lot(self, num='x
-0000fdb0: 7944 6174 6120 616e 6420 4d6f 6465 6c27  yData and Model'
-0000fdc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000fdd0: 2020 2020 2066 6967 7369 7a65 3d28 372e       figsize=(7.
-0000fde0: 352c 2036 2e35 292c 2020 2020 2020 2020  5, 6.5),        
-0000fdf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fe00: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0000fe10: 2020 2020 2020 2020 2064 6174 615f 6c61           data_la
-0000fe20: 6265 6c3d 2764 6174 6127 2c0a 2020 2020  bel='data',.    
-0000fe30: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000fe40: 6c6f 745f 7265 7369 6475 616c 3d46 616c  lot_residual=Fal
-0000fe50: 7365 293a 0a20 2020 2020 2022 2222 7265  se):.      """re
-0000fe60: 7475 726e 2066 6967 7572 6520 7769 7468  turn figure with
-0000fe70: 2078 7920 6461 7461 2061 6e64 2075 6e63   xy data and unc
-0000fe80: 6572 7461 696e 7469 6573 0a20 2020 2020  ertainties.     
-0000fe90: 2022 2222 0a23 2020 2020 2320 6765 7420   """.#    # get 
-0000fea0: 6461 7461 0a20 2020 2020 2078 203d 2073  data.      x = s
-0000feb0: 656c 662e 780a 2020 2020 2020 6966 2070  elf.x.      if p
-0000fec0: 6c6f 745f 7265 7369 6475 616c 2061 6e64  lot_residual and
-0000fed0: 2073 656c 662e 6d6f 6465 6c5f 7661 6c75   self.model_valu
-0000fee0: 6573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  es is not None:.
-0000fef0: 2020 2020 2020 2020 7920 3d20 7365 6c66          y = self
-0000ff00: 2e79 202d 2073 656c 662e 6d6f 6465 6c5f  .y - self.model_
-0000ff10: 7661 6c75 6573 0a20 2020 2020 2065 6c73  values.      els
-0000ff20: 653a 2020 0a20 2020 2020 2020 2079 203d  e:  .        y =
-0000ff30: 2073 656c 662e 790a 2020 2020 2020 6579   self.y.      ey
-0000ff40: 203d 2073 656c 662e 6765 745f 7943 6f76   = self.get_yCov
-0000ff50: 2829 0a20 2020 2020 2069 6620 6579 2e6e  ().      if ey.n
-0000ff60: 6469 6d20 3d3d 2032 3a0a 2020 2020 2020  dim == 2:.      
-0000ff70: 2020 6579 203d 206e 702e 7371 7274 286e    ey = np.sqrt(n
-0000ff80: 702e 6469 6167 6f6e 616c 2865 7929 290a  p.diagonal(ey)).
-0000ff90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000ffa0: 2020 2020 6579 203d 206e 702e 7371 7274      ey = np.sqrt
-0000ffb0: 2865 7929 0a20 2020 2020 2065 7820 3d20  (ey).      ex = 
-0000ffc0: 7365 6c66 2e67 6574 5f78 436f 7628 290a  self.get_xCov().
-0000ffd0: 2020 2020 2020 6966 2065 7820 6973 206e        if ex is n
-0000ffe0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000fff0: 2069 6620 6578 2e6e 6469 6d20 3d3d 323a   if ex.ndim ==2:
-00010000: 0a20 2020 2020 2020 2020 2065 7820 3d20  .          ex = 
-00010010: 6e70 2e73 7172 7428 6e70 2e64 6961 676f  np.sqrt(np.diago
-00010020: 6e61 6c28 6578 2929 0a20 2020 2020 2020  nal(ex)).       
-00010030: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00010040: 2065 7820 3d20 6e70 2e73 7172 7428 6578   ex = np.sqrt(ex
-00010050: 290a 2020 2023 2064 7261 7720 6461 7461  ).   # draw data
-00010060: 0a20 2020 2020 2066 6967 203d 2070 6c74  .      fig = plt
-00010070: 2e66 6967 7572 6528 6e75 6d3d 6e75 6d2c  .figure(num=num,
-00010080: 2066 6967 7369 7a65 3d66 6967 7369 7a65   figsize=figsize
-00010090: 290a 2020 2020 2020 706c 742e 706c 6f74  ).      plt.plot
-000100a0: 2878 2c20 792c 206d 6172 6b65 723d 2778  (x, y, marker='x
-000100b0: 272c 206c 696e 6573 7479 6c65 3d27 272c  ', linestyle='',
-000100c0: 2063 6f6c 6f72 3d27 6772 6579 272c 2061   color='grey', a
-000100d0: 6c70 6861 3d30 2e35 290a 2020 2020 2020  lpha=0.5).      
-000100e0: 6966 2065 7820 6973 206e 6f74 204e 6f6e  if ex is not Non
-000100f0: 653a 0a20 2020 2020 2020 2070 6c74 2e65  e:.        plt.e
-00010100: 7272 6f72 6261 7228 782c 2079 2c20 7865  rrorbar(x, y, xe
-00010110: 7272 3d65 782c 2079 6572 723d 6579 2c20  rr=ex, yerr=ey, 
-00010120: 666d 743d 272e 272c 206c 6162 656c 3d64  fmt='.', label=d
-00010130: 6174 615f 6c61 6265 6c29 0a20 2020 2020  ata_label).     
-00010140: 2065 6c73 653a 0a20 2020 2020 2020 2070   else:.        p
-00010150: 6c74 2e65 7272 6f72 6261 7228 782c 2079  lt.errorbar(x, y
-00010160: 2c20 6579 2c20 666d 743d 222e 222c 206c  , ey, fmt=".", l
-00010170: 6162 656c 3d64 6174 615f 6c61 6265 6c29  abel=data_label)
-00010180: 0a20 2020 2020 2072 6574 7572 6e20 6669  .      return fi
-00010190: 670a 2020 2020 2020 0a20 2023 2064 6566  g.      .  # def
-000101a0: 696e 6520 6375 7374 6f6d 2063 6f73 7420  ine custom cost 
-000101b0: 6675 6e63 7469 6f6e 2066 6f72 2069 6d69  function for imi
-000101c0: 6e75 6974 0a20 2063 6c61 7373 2078 4c53  nuit.  class xLS
-000101d0: 7143 6f73 743a 0a20 2020 2022 2222 0a20  qCost:.    """. 
-000101e0: 2020 2043 7573 746f 6d20 655f 785f 7465     Custom e_x_te
-000101f0: 6e64 6564 204c 6561 7374 2d53 5175 6172  nded Least-SQuar
-00010200: 6573 2063 6f73 7420 6675 6e63 7469 6f6e  es cost function
-00010210: 2077 6974 6820 0a20 2020 2064 796e 616d   with .    dynam
-00010220: 6963 616c 6c79 2075 7064 6174 6564 2063  ically updated c
-00010230: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
-00010240: 2061 6e64 202d 326c 6f67 284c 2920 0a20   and -2log(L) . 
-00010250: 2020 2063 6f72 7265 6374 696f 6e20 7465     correction te
-00010260: 726d 2066 6f72 2070 6172 616d 6574 6572  rm for parameter
-00010270: 2d64 6570 656e 6465 6e74 2075 6e63 6572  -dependent uncer
-00010280: 7461 696e 7469 6573 2e0a 0a20 2020 2054  tainties...    T
-00010290: 6865 2064 6566 6175 6c74 2063 6f73 7420  he default cost 
-000102a0: 6675 6e63 7469 6f6e 2069 7320 7477 6963  function is twic
-000102b0: 6520 7468 6520 6e65 6761 7469 7665 206c  e the negative l
-000102c0: 6f67 6172 6974 686d 200a 2020 2020 6f66  ogarithm .    of
-000102d0: 2074 6865 206c 696b 656c 6968 6f6f 6420   the likelihood 
-000102e0: 6f66 2061 2047 6175 7373 6961 6e20 6469  of a Gaussian di
-000102f0: 7374 7269 6275 7469 6f6e 2066 6f72 2064  stribution for d
-00010300: 6174 6120 706f 696e 7473 200a 2020 2020  ata points .    
-00010310: 3a6d 6174 683a 6028 782c 2079 2960 2077  :math:`(x, y)` w
-00010320: 6974 6820 6120 6d6f 6465 6c20 6675 6e63  ith a model func
-00010330: 7469 6f6e 203a 6d61 7468 3a60 793d 6628  tion :math:`y=f(
-00010340: 782c 202a 7029 6020 6465 7065 6e64 696e  x, *p)` dependin
-00010350: 670a 2020 2020 6f6e 2061 2073 6574 206f  g.    on a set o
-00010360: 6620 7061 7261 6d65 7465 7273 203a 6d61  f parameters :ma
-00010370: 7468 3a60 2a70 6020 616e 6420 6120 706f  th:`*p` and a po
-00010380: 7373 6962 6c79 2070 6172 616d 6574 6572  ssibly parameter
-00010390: 2d64 6570 656e 6465 6e74 0a20 2020 2063  -dependent.    c
-000103a0: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
-000103b0: 203a 6d61 7468 3a60 5628 782c 2066 2878   :math:`V(x, f(x
-000103c0: 2c20 2a70 2929 6020 6f66 2074 6865 2078  , *p))` of the x
-000103d0: 2061 6e64 2079 2064 6174 613a 0a0a 2020   and y data:..  
-000103e0: 2020 2e2e 206d 6174 683a 3a20 0a20 2020    .. math:: .   
-000103f0: 2020 202d 325c 6c6e 207b 5c63 616c 204c     -2\ln {\cal L
-00010400: 7d20 3d20 5c63 6869 5e32 2879 2c20 565e  } = \chi^2(y, V^
-00010410: 7b2d 317d 2c20 6628 782c 202a 7029 205c  {-1}, f(x, *p) \
-00010420: 2c29 200a 2020 2020 2020 2b20 5c6c 6e28  ,) .      + \ln(
-00010430: 5c2c 205c 6465 7428 2056 2878 2c20 6628  \, \det( V(x, f(
-00010440: 782c 202a 7029 2029 205c 2c29 0a0a 2020  x, *p) ) \,)..  
-00010450: 2020 496e 2074 6865 2061 6273 656e 6365    In the absence
-00010460: 206f 6620 7061 7261 6d65 7465 722d 6465   of parameter-de
-00010470: 7065 6e64 656e 7420 636f 6d70 6f6e 656e  pendent componen
-00010480: 7473 206f 6620 7468 6520 636f 7661 7269  ts of the covari
-00010490: 616e 6365 0a20 2020 206d 6174 7269 782c  ance.    matrix,
-000104a0: 2074 6865 206c 6173 7420 7465 726d 2069   the last term i
-000104b0: 7320 6f6d 6974 7465 6420 616e 6420 7468  s omitted and th
-000104c0: 6520 636f 7374 2066 756e 6374 696f 6e20  e cost function 
-000104d0: 6973 2069 6465 6e74 6963 616c 0a20 2020  is identical.   
-000104e0: 2074 6f20 7468 6520 636c 6173 7369 6361   to the classica
-000104f0: 6c20 3a6d 6174 683a 605c 6368 695e 3260  l :math:`\chi^2`
-00010500: 2e20 0a20 2020 2046 6f72 2074 6865 2065  . .    For the e
-00010510: 7661 6c75 6174 696f 6e20 6f66 2074 6865  valuation of the
-00010520: 2063 6f73 7420 6675 6e63 7469 6f6e 2061   cost function a
-00010530: 6e20 6566 6669 6369 656e 7420 6170 7072  n efficient appr
-00010540: 6f61 6368 2062 6173 6564 0a20 2020 206f  oach based.    o
-00010550: 6e20 7468 6520 2243 686f 6c65 736b 7920  n the "Cholesky 
-00010560: 6465 636f 6d70 6f73 6974 696f 6e22 206f  decomposition" o
-00010570: 6620 7468 6520 636f 7661 7269 616e 6365  f the covariance
-00010580: 206d 6174 7269 7820 696e 200a 2020 2020   matrix in .    
-00010590: 6120 7072 6f64 7563 7420 6f66 2061 2074  a product of a t
-000105a0: 7269 616e 6775 6c61 7220 6d61 7472 6978  riangular matrix
-000105b0: 2061 6e64 2069 7473 2074 7261 6e73 706f   and its transpo
-000105c0: 7365 6420 6973 2075 7365 643a 0a0a 2020  sed is used:..  
-000105d0: 2020 2e2e 206d 6174 683a 3a0a 2020 2020    .. math::.    
-000105e0: 2020 2056 203d 204c 204c 5e54 2e20 2020     V = L L^T.   
-000105f0: 200a 0a20 2020 2054 6865 2076 616c 7565   ..    The value
-00010600: 206f 6620 7468 6520 636f 7374 2066 756e   of the cost fun
-00010610: 6374 696f 6e20 0a0a 2020 2020 2e2e 206d  ction ..    .. m
-00010620: 6174 683a 3a0a 2020 2020 2020 5c63 6869  ath::.      \chi
-00010630: 5e32 203d 207b 727d 5c63 646f 7420 2856  ^2 = {r}\cdot (V
-00010640: 5e7b 2d31 7d7b 727d 2920 7e7e 7769 7468  ^{-1}{r}) ~~with
-00010650: 7e7e 2072 203d 2079 202d 2066 2878 2c2a  ~~ r = y - f(x,*
-00010660: 7029 0a0a 2020 2020 6973 2074 6865 6e20  p)..    is then 
-00010670: 6361 6c63 756c 6174 6564 2062 7920 736f  calculated by so
-00010680: 6c76 696e 6720 7468 6520 6c69 6e65 6172  lving the linear
-00010690: 2065 7175 6174 696f 6e20 200a 0a20 2020   equation  ..   
-000106a0: 2e2e 206d 6174 683a 3a0a 2020 2020 2020  .. math::.      
-000106b0: 5620 5820 3d20 722c 207e 692e 652e 7e20  V X = r, ~i.e.~ 
-000106c0: 583d 565e 7b2d 317d 2072 207e 616e 647e  X=V^{-1} r ~and~
-000106d0: 205c 6368 695e 323d 2072 205c 6364 6f74   \chi^2= r \cdot
-000106e0: 2058 2020 200a 0a20 2020 7769 7468 2074   X   ..   with t
-000106f0: 6865 206c 696e 6561 722d 6571 7561 7469  he linear-equati
-00010700: 6f6e 2073 6f6c 7665 7220 2a73 6369 7079  on solver *scipy
-00010710: 2e6c 696e 616c 672e 6368 6f5f 736f 6c76  .linalg.cho_solv
-00010720: 6528 4c2c 7829 2a0a 2020 2066 6f72 2043  e(L,x)*.   for C
-00010730: 686f 6c65 736b 792d 6465 636f 6d70 6f73  holesky-decompos
-00010740: 6564 206d 6174 7269 6365 732c 2074 6875  ed matrices, thu
-00010750: 7320 6176 6f69 6469 6e67 2074 6865 2063  s avoiding the c
-00010760: 6f73 7479 200a 2020 2063 616c 6375 6c61  osty .   calcula
-00010770: 7469 6f6e 206f 6620 7468 6520 696e 7665  tion of the inve
-00010780: 7273 6520 6d61 7472 6978 2e0a 2020 2020  rse matrix..    
-00010790: 0a0a 2020 2054 6865 2064 6574 6572 6d69  ..   The determi
-000107a0: 6e61 6e74 2c20 6966 206e 6565 6465 642c  nant, if needed,
-000107b0: 2069 7320 6566 6669 6369 656e 746c 7920   is efficiently 
-000107c0: 6361 6c63 756c 6174 6564 2062 7920 7461  calculated by ta
-000107d0: 6b69 6e67 200a 2020 2074 6865 2070 726f  king .   the pro
-000107e0: 6475 6374 206f 6620 7468 6520 6469 6167  duct of the diag
-000107f0: 6f6e 616c 2065 6c65 6d65 6e74 7320 6f66  onal elements of
-00010800: 2074 6865 206d 6174 7269 7820 4c2c 0a0a   the matrix L,..
-00010810: 2020 2020 2e2e 206d 6174 683a 3a0a 2020      .. math::.  
-00010820: 2020 2020 5c64 6574 2856 2920 3d20 3220      \det(V) = 2 
-00010830: 5c2c 205c 7072 6f64 204c 5f7b 692c 697d  \, \prod L_{i,i}
-00010840: 0a20 2020 200a 2020 2020 496e 7075 743a  .    .    Input:
-00010850: 0a0a 2020 2020 2d20 6f75 7465 723a 2070  ..    - outer: p
-00010860: 6f69 6e74 6572 2074 6f20 696e 7374 616e  ointer to instan
-00010870: 6365 206f 6620 6361 6c6c 696e 6720 636c  ce of calling cl
-00010880: 6173 730a 2020 2020 2d20 6d6f 6465 6c3a  ass.    - model:
-00010890: 206d 6f64 656c 2066 756e 6374 696f 6e20   model function 
-000108a0: 6628 782c 205c 2a70 6172 290a 2020 2020  f(x, \*par).    
-000108b0: 2d20 7573 655f 6e65 6732 6c6f 674c 3a20  - use_neg2logL: 
-000108c0: 7573 6520 6675 6c6c 202d 326c 6f67 284c  use full -2log(L
-000108d0: 2920 696e 7374 6561 6420 6f66 2063 6869  ) instead of chi
-000108e0: 3220 6966 2054 7275 650a 0a20 2020 205f  2 if True..    _
-000108f0: 5f63 616c 6c5f 5f20 6d65 7468 6f64 206f  _call__ method o
-00010900: 6620 7468 6973 2063 6c61 7373 2069 7320  f this class is 
-00010910: 6361 6c6c 6564 2062 7920 696d 696e 7569  called by iminui
-00010920: 740a 0a20 2020 2044 6174 6120 6d65 6d62  t..    Data memb
-00010930: 6572 733a 0a0a 2020 2020 2d20 6e64 6f66  ers:..    - ndof
-00010940: 3a20 6465 6772 6565 7320 6f66 2066 7265  : degrees of fre
-00010950: 6564 6f6d 200a 2020 2020 2d20 6e63 6f6e  edom .    - ncon
-00010960: 7374 7261 696e 7473 3a20 6e75 6d62 6572  straints: number
-00010970: 206f 6620 7061 7261 6d65 7465 7220 636f   of parameter co
-00010980: 6e73 7472 6169 6e74 730a 2020 2020 2d20  nstraints.    - 
-00010990: 676f 663a 2063 6869 322d 7661 6c75 6520  gof: chi2-value 
-000109a0: 2867 6f6f 646e 6573 7320 6f66 2066 6974  (goodness of fit
-000109b0: 290a 2020 2020 2d20 7573 655f 6e65 6732  ).    - use_neg2
-000109c0: 6c6f 674c 3a20 7573 6167 6520 6f66 2066  logL: usage of f
-000109d0: 756c 6c20 322a 6e65 6720 4c6f 6720 4c69  ull 2*neg Log Li
-000109e0: 6b65 6c69 686f 6f64 0a20 2020 202d 2071  kelihood.    - q
-000109f0: 7569 6574 3a20 6e6f 2070 7269 6e74 6f75  uiet: no printou
-00010a00: 7420 6966 2054 7275 6520 2020 200a 0a20  t if True    .. 
-00010a10: 2020 204d 6574 686f 6473 3a0a 0a20 2020     Methods:..   
-00010a20: 202d 206d 6f64 656c 2878 2c20 5c2a 7061   - model(x, \*pa
-00010a30: 7229 0a20 2020 2022 2222 0a20 0a20 2020  r).    """. .   
-00010a40: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00010a50: 6c66 2c20 6f75 7465 722c 200a 2020 2020  lf, outer, .    
-00010a60: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00010a70: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
-00010a80: 2020 2020 2075 7365 5f6e 6567 326c 6f67       use_neg2log
-00010a90: 4c3d 4661 6c73 6529 3a0a 0a20 2020 2020  L=False):..     
-00010aa0: 2066 726f 6d20 696d 696e 7569 742e 7574   from iminuit.ut
-00010ab0: 696c 2069 6d70 6f72 7420 6d61 6b65 5f66  il import make_f
-00010ac0: 756e 635f 636f 6465 0a0a 2020 2020 2020  unc_code..      
-00010ad0: 2320 6461 7461 206f 626a 6563 7420 6f66  # data object of
-00010ae0: 2074 7970 6520 7879 4461 7461 436f 6e74   type xyDataCont
-00010af0: 6169 6e65 720a 2020 2020 2020 7365 6c66  ainer.      self
-00010b00: 2e64 6174 6120 3d20 6f75 7465 722e 6461  .data = outer.da
-00010b10: 7461 0a20 2020 2020 2069 6620 6e6f 7420  ta.      if not 
-00010b20: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
-00010b30: 6461 7461 2c20 6d6e 4669 742e 7879 4461  data, mnFit.xyDa
-00010b40: 7461 436f 6e74 6169 6e65 7229 3a0a 2020  taContainer):.  
-00010b50: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00010b60: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00010b70: 2020 2220 2121 2120 6d6e 4669 742e 784c    " !!! mnFit.xL
-00010b80: 5371 436f 7374 3a20 6578 7065 6374 696e  SqCost: expectin
-00010b90: 6720 6461 7461 2063 6f6e 7461 696e 6572  g data container
-00010ba0: 206f 6620 7479 7065 2027 6d6e 4669 742e   of type 'mnFit.
-00010bb0: 7879 4461 7461 436f 6e74 6169 6e65 7227  xyDataContainer'
-00010bc0: 2229 0a20 2020 2020 2073 656c 662e 6d6f  ").      self.mo
-00010bd0: 6465 6c20 3d20 6d6f 6465 6c0a 2020 2020  del = model.    
-00010be0: 2020 7365 6c66 2e71 7569 6574 203d 206f    self.quiet = o
-00010bf0: 7574 6572 2e71 7569 6574 0a20 2020 2020  uter.quiet.     
-00010c00: 2023 2075 7365 202d 3220 2a20 6c6f 6728   # use -2 * log(
-00010c10: 4c29 206f 6620 4761 7573 7369 616e 2069  L) of Gaussian i
-00010c20: 6e73 7465 6164 206f 6620 4368 6932 0a20  nstead of Chi2. 
-00010c30: 2020 2020 2023 2020 286f 6e6c 7920 6469       #  (only di
-00010c40: 6666 6572 656e 7420 6672 6f6d 2043 6869  fferent from Chi
-00010c50: 3220 666f 7220 7061 7261 6d65 7465 722d  2 for parameter-
-00010c60: 6465 7065 6e64 656e 7420 756e 6365 7274  dependent uncert
-00010c70: 6169 6e74 6965 7329 0a20 2020 2020 2073  ainties).      s
-00010c80: 656c 662e 7573 655f 6e65 6732 6c6f 674c  elf.use_neg2logL
-00010c90: 203d 2075 7365 5f6e 6567 326c 6f67 4c0a   = use_neg2logL.
-00010ca0: 2020 2020 2020 0a20 2020 2020 2023 2073        .      # s
-00010cb0: 6574 2070 726f 7065 7220 7369 676e 6174  et proper signat
-00010cc0: 7572 6520 6f66 206d 6f64 656c 2066 756e  ure of model fun
-00010cd0: 6374 696f 6e20 666f 7220 696d 696e 7569  ction for iminui
-00010ce0: 740a 2020 2020 2020 7365 6c66 2e70 6e61  t.      self.pna
-00010cf0: 6d73 203d 206f 7574 6572 2e70 6e61 6d73  ms = outer.pnams
-00010d00: 0a20 2020 2020 2073 656c 662e 6675 6e63  .      self.func
-00010d10: 5f63 6f64 6520 3d20 6d61 6b65 5f66 756e  _code = make_fun
-00010d20: 635f 636f 6465 2873 656c 662e 706e 616d  c_code(self.pnam
-00010d30: 7329 0a20 2020 2020 2073 656c 662e 6e70  s).      self.np
-00010d40: 6172 203d 206f 7574 6572 2e6e 7061 720a  ar = outer.npar.
-00010d50: 2020 2020 2020 0a20 2020 2020 2023 2074        .      # t
-00010d60: 616b 6520 6163 636f 756e 7420 6f66 2063  ake account of c
-00010d70: 6f6e 7374 7261 696e 7473 200a 2020 2020  onstraints .    
-00010d80: 2020 7365 6c66 2e63 6f6e 7374 7261 696e    self.constrain
-00010d90: 7473 203d 206f 7574 6572 2e63 6f6e 7374  ts = outer.const
-00010da0: 7261 696e 7473 0a20 2020 2020 2073 656c  raints.      sel
-00010db0: 662e 6e63 6f6e 7374 7261 696e 7473 203d  f.nconstraints =
-00010dc0: 206c 656e 2873 656c 662e 636f 6e73 7472   len(self.constr
-00010dd0: 6169 6e74 7329 0a20 2020 2020 2073 656c  aints).      sel
-00010de0: 662e 6e64 6f66 203d 206c 656e 2873 656c  f.ndof = len(sel
-00010df0: 662e 6461 7461 2e79 2920 2d20 7365 6c66  f.data.y) - self
-00010e00: 2e6e 7061 7220 2b20 7365 6c66 2e6e 636f  .npar + self.nco
-00010e10: 6e73 7472 6169 6e74 7320 2b20 6f75 7465  nstraints + oute
-00010e20: 722e 6e66 6978 6564 0a0a 2020 2020 2020  r.nfixed..      
-00010e30: 2320 666c 6167 2074 6f20 636f 6e74 726f  # flag to contro
-00010e40: 6c20 6669 6e61 6c20 6163 7469 6f6e 7320  l final actions 
-00010e50: 696e 2063 6f73 7420 6675 6e63 7469 6f6e  in cost function
-00010e60: 0a20 2020 2020 2073 656c 662e 6669 6e61  .      self.fina
-00010e70: 6c5f 6361 6c6c 203d 2046 616c 7365 0a0a  l_call = False..
-00010e80: 0a20 2020 2064 6566 205f 5f63 616c 6c5f  .    def __call_
-00010e90: 5f28 7365 6c66 2c20 2a70 6172 293a 2020  _(self, *par):  
-00010ea0: 0a20 2020 2020 2023 2063 616c 6c65 6420  .      # called 
-00010eb0: 6974 6572 6174 6976 656c 7920 6279 206d  iteratively by m
-00010ec0: 696e 7569 740a 0a20 2020 2020 2023 2063  inuit..      # c
-00010ed0: 6f73 7420 6675 6e63 7469 6f6e 2069 7320  ost function is 
-00010ee0: 6578 7465 6e64 6564 2063 6869 323a 0a20  extended chi2:. 
-00010ef0: 2020 2020 2023 2020 2061 6464 206e 6f72       #   add nor
-00010f00: 6d61 6c69 7a61 7469 6f6e 2074 6572 6d20  malization term 
-00010f10: 6966 2075 6e63 6572 7461 696e 7469 6573  if uncertainties
-00010f20: 2064 6570 656e 6420 6f6e 206d 6f64 656c   depend on model
-00010f30: 200a 0a20 2020 2020 206e 6c4c 3220 3d20   ..      nlL2 = 
-00010f40: 302e 2023 2069 6e69 7469 616c 697a 6520  0. # initialize 
-00010f50: 2d32 2a6c 6e28 4c29 0a20 2020 2020 2023  -2*ln(L).      #
-00010f60: 2020 6669 7273 742c 2074 616b 6520 696e    first, take in
-00010f70: 746f 2061 6363 6f75 6e74 2070 6f73 7369  to account possi
-00010f80: 626c 6520 7061 7261 6d65 7465 7220 636f  ble parameter co
-00010f90: 6e73 7472 6169 6e74 7320 200a 2020 2020  nstraints  .    
-00010fa0: 2020 6966 2073 656c 662e 6e63 6f6e 7374    if self.nconst
-00010fb0: 7261 696e 7473 3a0a 2020 2020 2020 2020  raints:.        
-00010fc0: 666f 7220 6320 696e 2073 656c 662e 636f  for c in self.co
-00010fd0: 6e73 7472 6169 6e74 733a 0a20 2020 2020  nstraints:.     
-00010fe0: 2020 2020 2070 5f69 6420 3d20 635b 305d       p_id = c[0]
-00010ff0: 0a20 2020 2020 2020 2020 2072 203d 2028  .          r = (
-00011000: 2070 6172 5b70 5f69 645d 202d 2063 5b31   par[p_id] - c[1
-00011010: 5d29 202f 2063 5b32 5d20 0a20 2020 2020  ]) / c[2] .     
-00011020: 2020 2020 206e 6c4c 3220 2b3d 2072 2a72       nlL2 += r*r
-00011030: 0a0a 2020 2020 2020 2320 6361 6c63 756c  ..      # calcul
-00011040: 6174 6520 7265 7369 6475 616c 206f 6620  ate residual of 
-00011050: 6461 7461 2077 7274 2e20 6d6f 6465 6c0a  data wrt. model.
-00011060: 2020 2020 2020 6d6f 6465 6c5f 7661 6c75        model_valu
-00011070: 6573 203d 2073 656c 662e 6d6f 6465 6c28  es = self.model(
-00011080: 7365 6c66 2e64 6174 612e 782c 202a 7061  self.data.x, *pa
-00011090: 7229 0a20 2020 2020 205f 7220 3d20 7365  r).      _r = se
-000110a0: 6c66 2e64 6174 612e 7920 2d20 6d6f 6465  lf.data.y - mode
-000110b0: 6c5f 7661 6c75 6573 0a0a 2020 2020 2020  l_values..      
-000110c0: 6966 2073 656c 662e 6461 7461 2e6e 6565  if self.data.nee
-000110d0: 6473 5f63 6f76 6172 6961 6e63 653a 0a20  ds_covariance:. 
-000110e0: 2020 2020 2020 2023 2020 6368 6563 6b20         #  check 
-000110f0: 6966 206d 6174 7269 7820 6e65 6564 7320  if matrix needs 
-00011100: 7265 6275 696c 6469 6e67 0a20 2020 2020  rebuilding.     
-00011110: 2020 2069 6620 6e6f 7420 7365 6c66 2e64     if not self.d
-00011120: 6174 612e 6e65 6564 735f 6479 6e61 6d69  ata.needs_dynami
-00011130: 6345 7272 6f72 733a 0a20 2020 2020 2020  cErrors:.       
-00011140: 2020 2320 7374 6174 6963 2063 6f76 6172    # static covar
-00011150: 6961 6e63 652c 2075 7365 2069 7473 2069  iance, use its i
-00011160: 6e76 6572 7365 0a20 2020 2020 2020 2020  nverse.         
-00011170: 206e 6c4c 3220 2b3d 2066 6c6f 6174 286e   nlL2 += float(n
-00011180: 702e 696e 6e65 7228 6e70 2e6d 6174 6d75  p.inner(np.matmu
-00011190: 6c28 5f72 2c20 7365 6c66 2e64 6174 612e  l(_r, self.data.
-000111a0: 6943 6f76 292c 205f 7229 290a 2020 2020  iCov), _r)).    
-000111b0: 2020 2020 2020 2320 6964 656e 7469 6361        # identica
-000111c0: 6c20 746f 2063 6c61 7373 6963 616c 2043  l to classical C
-000111d0: 6869 320a 2020 2020 2020 2020 2020 7365  hi2.          se
-000111e0: 6c66 2e67 6f66 203d 206e 6c4c 320a 2020  lf.gof = nlL2.  
-000111f0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00011200: 2065 6c73 653a 2023 2064 796e 616d 6963   else: # dynamic
-00011210: 616c 6c79 2072 6562 7569 6c64 2063 6f76  ally rebuild cov
-00011220: 6172 6961 6e63 6520 6d61 7472 6978 0a20  ariance matrix. 
-00011230: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
-00011240: 7461 2e5f 7265 6275 696c 645f 436f 7628  ta._rebuild_Cov(
-00011250: 7061 7229 0a20 2020 2020 2020 2020 2023  par).          #
-00011260: 2075 7365 2043 686f 6c65 736b 7920 6465   use Cholesky de
-00011270: 636f 6d70 6f73 6974 6f6e 2074 6f20 636f  compositon to co
-00011280: 6d70 7574 6520 6368 6932 203d 205f 722e  mpute chi2 = _r.
-00011290: 5420 2856 5e2d 3129 205f 7220 0a20 2020  T (V^-1) _r .   
-000112a0: 2020 2020 2020 204c 2c20 6973 5f6c 6f77         L, is_low
-000112b0: 6572 203d 206c 696e 616c 672e 6368 6f5f  er = linalg.cho_
-000112c0: 6661 6374 6f72 2873 656c 662e 6461 7461  factor(self.data
-000112d0: 2e63 6f76 2c20 6368 6563 6b5f 6669 6e69  .cov, check_fini
-000112e0: 7465 3d46 616c 7365 290a 2020 2020 2020  te=False).      
-000112f0: 2020 2020 6e6c 4c32 202b 3d20 6e70 2e69      nlL2 += np.i
-00011300: 6e6e 6572 285f 722c 206c 696e 616c 672e  nner(_r, linalg.
-00011310: 6368 6f5f 736f 6c76 6528 284c 2c20 6973  cho_solve((L, is
-00011320: 5f6c 6f77 6572 292c 205f 7229 2029 0a20  _lower), _r) ). 
-00011330: 2020 2020 2020 2020 2023 2075 7020 746f           # up to
-00011340: 2068 6572 652c 2069 6465 6e74 6963 616c   here, identical
-00011350: 2074 6f20 636c 6173 7369 6361 6c20 4368   to classical Ch
-00011360: 6932 0a20 2020 2020 2020 2020 2073 656c  i2.          sel
-00011370: 662e 676f 6620 3d20 6e6c 4c32 2020 2020  f.gof = nlL2    
-00011380: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
-00011390: 2020 2020 2020 2023 2074 616b 6520 696e         # take in
-000113a0: 746f 2061 6363 6f75 6e74 2070 6172 616d  to account param
-000113b0: 6574 6572 2d64 6570 656e 6465 6e74 206e  eter-dependent n
-000113c0: 6f72 6d61 6c69 7361 7469 6f6e 2074 6572  ormalisation ter
-000113d0: 6d0a 2020 2020 2020 2020 2020 6966 2073  m.          if s
-000113e0: 656c 662e 7573 655f 6e65 6732 6c6f 674c  elf.use_neg2logL
-000113f0: 3a0a 2020 2020 2020 2020 2023 2020 6661  :.         #  fa
-00011400: 7374 2063 616c 6375 6c61 7469 6f6e 206f  st calculation o
-00011410: 6620 6465 7465 726d 696e 616e 7420 6465  f determinant de
-00011420: 7428 5629 2066 726f 6d20 4368 6f6c 6573  t(V) from Choles
-00011430: 6b79 2066 6163 746f 7220 0a20 2020 2020  ky factor .     
-00011440: 2020 2020 2020 206e 6c4c 3220 2b3d 2032         nlL2 += 2
-00011450: 2e2a 6e70 2e73 756d 286e 702e 6c6f 6728  .*np.sum(np.log(
-00011460: 6e70 2e64 6961 676f 6e61 6c28 4c29 2029  np.diagonal(L) )
-00011470: 2029 0a0a 2020 2020 2020 656c 7365 3a20   )..      else: 
-00011480: 2023 2066 6173 7420 6361 6c63 756c 6174   # fast calculat
-00011490: 696f 6e20 666f 7220 7369 6d70 6c65 2065  ion for simple e
-000114a0: 7272 6f72 730a 2020 2020 2020 2020 2320  rrors.        # 
-000114b0: 6368 6563 6b20 6966 2065 7272 6f72 7320  check if errors 
-000114c0: 6e65 6564 7320 7265 6361 6c63 756c 6174  needs recalculat
-000114d0: 696e 670a 2020 2020 2020 2020 6966 2073  ing.        if s
-000114e0: 656c 662e 6461 7461 2e6e 6565 6473 5f64  elf.data.needs_d
-000114f0: 796e 616d 6963 4572 726f 7273 3a0a 2020  ynamicErrors:.  
-00011500: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-00011510: 612e 5f72 6562 7569 6c64 5f45 7272 3228  a._rebuild_Err2(
-00011520: 7061 7229 0a20 2020 2020 2020 2020 206e  par).          n
-00011530: 6c4c 3220 2b3d 206e 702e 7375 6d28 5f72  lL2 += np.sum(_r
-00011540: 202a 205f 7220 2f20 7365 6c66 2e64 6174   * _r / self.dat
-00011550: 612e 6572 7232 290a 2020 2020 2020 2020  a.err2).        
-00011560: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00011570: 6e6c 4c32 202b 3d20 6e70 2e73 756d 285f  nlL2 += np.sum(_
-00011580: 7220 2a20 5f72 202a 2073 656c 662e 6461  r * _r * self.da
-00011590: 7461 2e69 4572 7232 290a 0a20 2020 2020  ta.iErr2)..     
-000115a0: 2020 2023 2074 6869 7320 6973 2069 6465     # this is ide
-000115b0: 6e74 6963 616c 2074 6f20 636c 6173 7369  ntical to classi
-000115c0: 6361 6c20 4368 6932 0a20 2020 2020 2020  cal Chi2.       
-000115d0: 2073 656c 662e 676f 6620 3d20 6e6c 4c32   self.gof = nlL2
-000115e0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-000115f0: 2020 2320 6164 6420 7061 7261 6d65 7465    # add paramete
-00011600: 722d 6465 7065 6e64 656e 7420 6e6f 726d  r-dependent norm
-00011610: 616c 697a 6174 696f 6e20 7465 726d 2069  alization term i
-00011620: 6620 6e65 6564 6564 2061 6e64 2077 616e  f needed and wan
-00011630: 7465 640a 2020 2020 2020 2020 6966 2073  ted.        if s
-00011640: 656c 662e 6461 7461 2e6e 6565 6473 5f64  elf.data.needs_d
-00011650: 796e 616d 6963 4572 726f 7273 2061 6e64  ynamicErrors and
-00011660: 2073 656c 662e 7573 655f 6e65 6732 6c6f   self.use_neg2lo
-00011670: 674c 3a0a 2020 2020 2020 2020 2020 6e6c  gL:.          nl
-00011680: 4c32 202b 3d20 6e70 2e73 756d 286e 702e  L2 += np.sum(np.
-00011690: 6c6f 6728 7365 6c66 2e64 6174 612e 6572  log(self.data.er
-000116a0: 7232 2929 0a0a 2020 2020 2020 2320 7072  r2))..      # pr
-000116b0: 6f76 6964 6520 6d6f 6465 6c20 7661 6c75  ovide model valu
-000116c0: 6573 2074 6f20 6461 7461 206f 626a 6563  es to data objec
-000116d0: 740a 2020 2020 2020 7365 6c66 2e64 6174  t.      self.dat
-000116e0: 612e 6d6f 6465 6c5f 7661 6c75 6573 203d  a.model_values =
-000116f0: 206d 6f64 656c 5f76 616c 7565 7320 2020   model_values   
-00011700: 2020 2020 0a0a 2020 2020 2020 7265 7475      ..      retu
-00011710: 726e 206e 6c4c 320a 2020 2020 0a20 2023  rn nlL2.    .  #
-00011720: 202d 2d2d 2065 6e64 2064 6566 696e 6974   --- end definit
-00011730: 696f 6e20 6f66 2063 6c61 7373 2078 4c53  ion of class xLS
-00011740: 7143 6f73 7420 2d2d 2d2d 0a0a 2020 230a  qCost ----..  #.
-00011750: 2020 2320 2d2d 2d20 7370 6563 6961 6c20    # --- special 
-00011760: 636f 6465 2066 6f72 2069 6e64 6578 6564  code for indexed
-00011770: 2046 6974 2028 7846 6974 290a 2020 2320   Fit (xFit).  # 
-00011780: 2020 2020 200a 0a20 2064 6566 2073 6574       ..  def set
-00011790: 5f78 4f70 7469 6f6e 7328 7365 6c66 2c0a  _xOptions(self,.
-000117a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000117b0: 6c61 7469 7665 5f72 6566 6572 735f 746f  lative_refers_to
-000117c0: 5f6d 6f64 656c 3d4e 6f6e 652c 0a20 2020  _model=None,.   
-000117d0: 2020 2020 2020 2020 2020 2072 756e 5f6d             run_m
-000117e0: 696e 6f73 3d4e 6f6e 652c 0a20 2020 2020  inos=None,.     
-000117f0: 2020 2020 2020 2020 2075 7365 5f6e 6567           use_neg
-00011800: 4c6f 674c 3d4e 6f6e 652c 0a20 2020 2020  LogL=None,.     
-00011810: 2020 2020 2020 2020 2071 7569 6574 3d4e           quiet=N
-00011820: 6f6e 6529 3a0a 0a20 2020 2022 2222 4465  one):..    """De
-00011830: 6669 6e65 206f 7074 696f 6e73 2066 6f72  fine options for
-00011840: 2069 6e64 6578 6564 2066 6974 0a0a 2020   indexed fit..  
-00011850: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00011860: 2020 202d 2072 656c 2e20 6572 726f 7273     - rel. errors
-00011870: 2072 6566 6572 2074 6f20 6d6f 6465 6c20   refer to model 
-00011880: 656c 7365 2064 6174 610a 2020 2020 2020  else data.      
-00011890: 2020 2d20 7275 6e20 6d69 6e6f 7320 656c    - run minos el
-000118a0: 7365 2064 6f6e 2a74 2072 756e 206d 696e  se don*t run min
-000118b0: 6f73 0a20 2020 2020 2020 202d 2075 7365  os.        - use
-000118c0: 2066 756c 6c20 6e65 6732 6c6f 674c 0a20   full neg2logL. 
-000118d0: 2020 2020 2020 202d 2064 6f6e 2a74 2070         - don*t p
-000118e0: 726f 7669 6465 2070 7269 6e74 6f75 7420  rovide printout 
-000118f0: 656c 7365 2076 6572 626f 7365 2070 7269  else verbose pri
-00011900: 6e74 6f75 7420 0a20 2020 2022 2222 0a20  ntout .    """. 
-00011910: 2020 2069 6620 7265 6c61 7469 7665 5f72     if relative_r
-00011920: 6566 6572 735f 746f 5f6d 6f64 656c 2069  efers_to_model i
-00011930: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00011940: 2020 7365 6c66 2e72 6566 4d6f 6465 6c20    self.refModel 
-00011950: 3d20 7265 6c61 7469 7665 5f72 6566 6572  = relative_refer
-00011960: 735f 746f 5f6d 6f64 656c 0a20 2020 2020  s_to_model.     
-00011970: 2073 656c 662e 6f70 7469 6f6e 735b 2272   self.options["r
-00011980: 6566 4d6f 6465 6c22 5d5b 305d 203d 2069  efModel"][0] = i
-00011990: 6e74 2872 656c 6174 6976 655f 7265 6665  nt(relative_refe
-000119a0: 7273 5f74 6f5f 6d6f 6465 6c29 0a20 2020  rs_to_model).   
-000119b0: 2069 6620 7275 6e5f 6d69 6e6f 7320 6973   if run_minos is
-000119c0: 206e 6f74 204e 6f6e 653a 2020 200a 2020   not None:   .  
-000119d0: 2020 2020 7365 6c66 2e72 756e 5f6d 696e      self.run_min
-000119e0: 6f73 203d 2072 756e 5f6d 696e 6f73 0a20  os = run_minos. 
-000119f0: 2020 2020 2073 656c 662e 6f70 7469 6f6e       self.option
-00011a00: 735b 2272 756e 5f6d 696e 6f73 225d 5b30  s["run_minos"][0
-00011a10: 5d20 3d20 696e 7428 7275 6e5f 6d69 6e6f  ] = int(run_mino
-00011a20: 7329 0a20 2020 2069 6620 7573 655f 6e65  s).    if use_ne
-00011a30: 674c 6f67 4c20 6973 206e 6f74 204e 6f6e  gLogL is not Non
-00011a40: 653a 2020 200a 2020 2020 2020 7365 6c66  e:   .      self
-00011a50: 2e75 7365 5f6e 6567 4c6f 674c 203d 2075  .use_negLogL = u
-00011a60: 7365 5f6e 6567 4c6f 674c 0a20 2020 2020  se_negLogL.     
-00011a70: 2073 656c 662e 6f70 7469 6f6e 735b 2275   self.options["u
-00011a80: 7365 5f6e 6567 4c6f 674c 225d 5b30 5d20  se_negLogL"][0] 
-00011a90: 3d20 696e 7428 7573 655f 6e65 674c 6f67  = int(use_negLog
-00011aa0: 4c29 0a20 2020 2069 6620 7175 6965 7420  L).    if quiet 
-00011ab0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00011ac0: 2020 2073 656c 662e 7175 6965 7420 3d20     self.quiet = 
-00011ad0: 7175 6965 740a 0a20 2064 6566 2069 6e69  quiet..  def ini
-00011ae0: 745f 7844 6174 6128 7365 6c66 2c20 782c  t_xData(self, x,
-00011af0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00011b00: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00011b10: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
-00011b20: 2020 2020 2020 2020 2065 7265 6c3d 4e6f           erel=No
-00011b30: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00011b40: 2020 2020 2063 6162 733d 4e6f 6e65 2c20       cabs=None, 
-00011b50: 6372 656c 3d4e 6f6e 652c 0a20 2020 2020  crel=None,.     
-00011b60: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00011b70: 733d 4e6f 6e65 293a 0a0a 2020 2020 2222  s=None):..    ""
-00011b80: 2269 6e69 7469 616c 697a 6520 6461 7461  "initialize data
-00011b90: 206f 626a 6563 740a 0a20 2020 2041 7267   object..    Arg
-00011ba0: 733a 0a20 2020 2020 202d 2020 783a 2020  s:.      -  x:  
-00011bb0: 2020 2020 6461 7461 2076 616c 7565 730a      data values.
-00011bc0: 2020 2020 2020 2d20 2073 3a20 2020 2020        -  s:     
-00011bd0: 2069 6e64 6570 656e 6465 6e74 2075 6e63   independent unc
-00011be0: 6572 7461 696e 7469 6573 2078 0a20 2020  ertainties x.   
-00011bf0: 2020 202d 2020 7372 656c 3a20 2020 696e     -  srel:   in
-00011c00: 6465 7065 6e64 656e 7420 7265 6c61 7469  dependent relati
-00011c10: 7665 2075 6e63 6572 7461 696e 7469 6573  ve uncertainties
-00011c20: 2078 0a20 2020 2020 202d 2020 6361 6273   x.      -  cabs
-00011c30: 3a20 2020 636f 7272 656c 6174 6564 2061  :   correlated a
-00011c40: 626f 6c75 7465 2075 6e63 6572 7461 696e  bolute uncertain
-00011c50: 7469 6573 2078 0a20 2020 2020 202d 2020  ties x.      -  
-00011c60: 6372 656c 3a20 2020 636f 7272 656c 6174  crel:   correlat
-00011c70: 6564 2072 656c 6174 6976 6520 756e 6365  ed relative unce
-00011c80: 7274 6169 6e74 6965 7320 780a 2020 2020  rtainties x.    
-00011c90: 2222 220a 2020 2020 0a20 2020 2023 2063  """.    .    # c
-00011ca0: 7265 6174 6520 6461 7461 206f 626a 6563  reate data objec
-00011cb0: 7420 616e 6420 7061 7373 2061 6c6c 2069  t and pass all i
-00011cc0: 6e70 7574 2061 7267 756d 656e 7473 0a20  nput arguments. 
-00011cd0: 2020 2073 656c 662e 7844 6174 6120 3d20     self.xData = 
-00011ce0: 7365 6c66 2e78 4461 7461 436f 6e74 6169  self.xDataContai
-00011cf0: 6e65 7228 7365 6c66 2c20 782c 2065 2c20  ner(self, x, e, 
-00011d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d20: 2020 2020 2020 6572 656c 2c20 6361 6273        erel, cabs
-00011d30: 2c20 6372 656c 2c0a 2020 2020 2020 2020  , crel,.        
-00011d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d50: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00011d60: 6573 203d 206e 616d 6573 2c20 0a20 2020  es = names, .   
-00011d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d90: 2020 7175 6965 743d 7365 6c66 2e71 7569    quiet=self.qui
-00011da0: 6574 290a 2020 2020 7365 6c66 2e64 6174  et).    self.dat
-00011db0: 6120 3d20 7365 6c66 2e78 4461 7461 0a20  a = self.xData. 
-00011dc0: 2020 2023 2073 6574 2066 6c61 6773 2066     # set flags f
-00011dd0: 6f72 2073 7465 6572 696e 6720 6f66 2066  or steering of f
-00011de0: 6974 2070 726f 6365 7373 2069 6e20 646f  it process in do
-00011df0: 5f66 6974 2829 0a20 2020 2073 656c 662e  _fit().    self.
-00011e00: 6974 6572 6174 6546 6974 203d 2073 656c  iterateFit = sel
-00011e10: 662e 7844 6174 612e 6861 735f 7265 6c5f  f.xData.has_rel_
-00011e20: 4572 726f 7273 2061 6e64 2073 656c 662e  Errors and self.
-00011e30: 7265 664d 6f64 656c 0a0a 0a20 2064 6566  refModel...  def
-00011e40: 2069 6e69 745f 7846 6974 2873 656c 662c   init_xFit(self,
-00011e50: 206d 6f64 656c 2c20 6d6f 6465 6c5f 6b77   model, model_kw
-00011e60: 6172 6773 3d4e 6f6e 652c 2070 303d 4e6f  args=None, p0=No
-00011e70: 6e65 2c20 6470 303d 4e6f 6e65 2c0a 2020  ne, dp0=None,.  
-00011e80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00011e90: 6f6e 7374 7261 696e 7473 3d4e 6f6e 652c  onstraints=None,
-00011ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011eb0: 2020 6669 7850 6172 733d 4e6f 6e65 2c0a    fixPars=None,.
-00011ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ed0: 206c 696d 6974 733d 4e6f 6e65 293a 0a20   limits=None):. 
-00011ee0: 2020 2022 2222 696e 6974 6961 6c69 7a65     """initialize
-00011ef0: 2066 6974 206f 626a 6563 740a 0a20 2020   fit object..   
-00011f00: 2041 7267 733a 0a20 2020 2020 202d 206d   Args:.      - m
-00011f10: 6f64 656c 3a20 6d6f 6465 6c20 6675 6e63  odel: model func
-00011f20: 7469 6f6e 2066 2878 3b20 5c2a 7061 7229  tion f(x; \*par)
-00011f30: 0a20 2020 2020 202d 206d 6f64 656c 5f6b  .      - model_k
-00011f40: 7761 7267 733a 206f 7074 696f 6e61 6c2c  wargs: optional,
-00011f50: 2066 6974 2070 6172 616d 6574 6572 7320   fit parameters 
-00011f60: 6966 206e 6f74 2066 726f 6d20 6d6f 6465  if not from mode
-00011f70: 6c20 7369 676e 6174 7572 6520 0a20 2020  l signature .   
-00011f80: 2020 202d 2070 303a 206e 702d 6172 7261     - p0: np-arra
-00011f90: 7920 6f66 2066 6c6f 6174 732c 2069 6e69  y of floats, ini
-00011fa0: 7469 616c 2070 6172 616d 6574 6572 2076  tial parameter v
-00011fb0: 616c 7565 7320 0a20 2020 2020 202d 2064  alues .      - d
-00011fc0: 7030 3a20 6172 7261 792d 6c69 6b65 2c20  p0: array-like, 
-00011fd0: 696e 6974 6961 6c20 6775 6573 7320 6f66  initial guess of
-00011fe0: 2070 6172 616d 6574 6572 2075 6e63 6572   parameter uncer
-00011ff0: 7461 696e 7469 6573 2028 6f70 7469 6f6e  tainties (option
-00012000: 616c 290a 2020 2020 2020 2d20 636f 6e73  al).      - cons
-00012010: 7472 6169 6e74 733a 2028 6e65 7374 6564  traints: (nested
-00012020: 2920 6c69 7374 2873 293a 205b 7061 7261  ) list(s): [para
-00012030: 6d65 7465 7220 6e61 6d65 2c20 7661 6c75  meter name, valu
-00012040: 652c 2075 6e63 6572 7461 696e 7479 5d20  e, uncertainty] 
-00012050: 0a20 2020 2020 2020 206f 7220 5b70 6172  .        or [par
-00012060: 616d 6574 6572 2069 6e64 6578 2c20 7661  ameter index, va
-00012070: 6c75 652c 2075 6e63 6572 7461 696e 7479  lue, uncertainty
-00012080: 5d0a 2020 2020 2020 2d20 6c69 6d69 7473  ].      - limits
-00012090: 3a20 286e 6573 7465 6429 206c 6973 7428  : (nested) list(
-000120a0: 7329 3a20 5b70 6172 616d 6574 6572 206e  s): [parameter n
-000120b0: 616d 652c 206d 696e 2c20 6d61 785d 200a  ame, min, max] .
-000120c0: 2020 2020 2020 2020 6f72 205b 7061 7261          or [para
-000120d0: 6d65 7465 7220 696e 6465 782c 206d 696e  meter index, min
-000120e0: 2c20 6d61 785d 0a20 2020 2022 2222 0a0a  , max].    """..
-000120f0: 2020 2020 6966 2073 656c 662e 7844 6174      if self.xDat
-00012100: 6120 6973 204e 6f6e 653a 200a 2020 2020  a is None: .    
-00012110: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00012120: 6f72 280a 2020 2020 2020 2020 2720 2121  or(.        ' !!
-00012130: 2120 6d6e 4669 742e 696e 6974 5f78 4669  ! mnFit.init_xFi
-00012140: 743a 206e 6f20 6461 7461 206f 626a 6563  t: no data objec
-00012150: 7420 6465 6669 6e65 6420 2d20 6361 6c6c  t defined - call
-00012160: 2069 6e69 745f 6461 7461 2829 2729 0a0a   init_data()')..
-00012170: 2020 2020 2320 6765 7420 7061 7261 6d65      # get parame
-00012180: 7465 7273 206f 6620 6d6f 6465 6c20 6675  ters of model fu
-00012190: 6e63 7469 6f6e 2074 6f20 7365 7420 7374  nction to set st
-000121a0: 6172 7420 7661 6c75 6573 2066 6f72 2066  art values for f
-000121b0: 6974 0a20 2020 2069 6620 6d6f 6465 6c5f  it.    if model_
-000121c0: 6b77 6172 6773 2069 7320 4e6f 6e65 3a0a  kwargs is None:.
-000121d0: 2020 2020 2020 6172 6773 2c20 6d6f 6465        args, mode
-000121e0: 6c5f 6b77 6172 6773 203d 2067 6574 5f66  l_kwargs = get_f
-000121f0: 756e 6374 696f 6e53 6967 6e61 7475 7265  unctionSignature
-00012200: 286d 6f64 656c 290a 0a20 2020 2070 6172  (model)..    par
-00012210: 203d 2028 6d6f 6465 6c5f 6b77 6172 6773   = (model_kwargs
-00012220: 2c20 7030 2c20 6470 302c 2063 6f6e 7374  , p0, dp0, const
-00012230: 7261 696e 7473 2c20 6669 7850 6172 732c  raints, fixPars,
-00012240: 206c 696d 6974 7329 0a20 2020 2073 656c   limits).    sel
-00012250: 662e 5f73 6574 7570 4669 7450 6172 616d  f._setupFitParam
-00012260: 6574 6572 7328 2a70 6172 2920 0a0a 2020  eters(*par) ..  
-00012270: 2020 2320 6372 6561 7465 2063 6f73 7420    # create cost 
-00012280: 6675 6e63 7469 6f6e 0a20 2020 2073 656c  function.    sel
-00012290: 662e 636f 7374 6620 3d20 7365 6c66 2e69  f.costf = self.i
-000122a0: 6e64 6578 6564 436f 7374 2873 656c 662c  ndexedCost(self,
-000122b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000122c0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-000122d0: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
-000122e0: 2020 2020 2020 2020 2020 2020 2020 7573                us
-000122f0: 655f 6e65 6732 6c6f 674c 3d20 7365 6c66  e_neg2logL= self
-00012300: 2e75 7365 5f6e 6567 4c6f 674c 290a 2020  .use_negLogL).  
-00012310: 2020 7365 6c66 2e5f 7365 7475 704d 696e    self._setupMin
-00012320: 7569 7428 6d6f 6465 6c5f 6b77 6172 6773  uit(model_kwargs
-00012330: 2920 0a0a 2020 2020 2020 0a20 2063 6c61  ) ..      .  cla
-00012340: 7373 2078 4461 7461 436f 6e74 6169 6e65  ss xDataContaine
-00012350: 723a 0a20 2020 2022 2222 0a20 2020 2048  r:.    """.    H
-00012360: 616e 646c 6520 6461 7461 2061 6e64 2075  andle data and u
-00012370: 6e63 6572 7461 696e 7469 6573 2061 6e64  ncertainties and
-00012380: 2020 0a20 2020 2062 7569 6c64 2063 6f76    .    build cov
-00012390: 6172 6961 6e63 6520 6d61 7472 6963 6573  ariance matrices
-000123a0: 2066 726f 6d20 636f 6d70 6f6e 656e 7473   from components
-000123b0: 0a0a 2020 2020 4172 6773 3a0a 2020 2020  ..    Args:.    
-000123c0: 2020 2d20 6f75 7465 723a 2020 2070 6f69    - outer:   poi
-000123d0: 6e74 6572 2074 6f20 696e 7374 616e 6365  nter to instance
-000123e0: 206f 6620 6361 6c6c 696e 6720 6f62 6a65   of calling obje
-000123f0: 6374 0a20 2020 2020 202d 2078 3a20 2020  ct.      - x:   
-00012400: 2020 2020 6162 7363 6973 7361 206f 6620      abscissa of 
-00012410: 6461 7461 2070 6f69 6e74 7320 2822 7820  data points ("x 
-00012420: 7661 6c75 6573 2229 0a20 2020 2020 202d  values").      -
-00012430: 2065 3a20 2020 2020 2020 696e 6465 7065   e:       indepe
-00012440: 6e64 656e 7420 756e 6365 7274 6169 6e74  ndent uncertaint
-00012450: 6965 7320 0a20 2020 2020 202d 2065 7265  ies .      - ere
-00012460: 6c3a 2020 2069 6e64 6570 656e 6465 6e74  l:   independent
-00012470: 2072 656c 6174 6976 6520 756e 6365 7274   relative uncert
-00012480: 6169 6e74 6965 7320 780a 2020 2020 2020  ainties x.      
-00012490: 2d20 6361 6273 3a20 2020 636f 7272 656c  - cabs:   correl
-000124a0: 6174 6564 2061 626f 6c75 7465 2075 6e63  ated abolute unc
-000124b0: 6572 7461 696e 7469 6573 2078 0a20 2020  ertainties x.   
-000124c0: 2020 202d 2063 7265 6c3a 2020 2063 6f72     - crel:   cor
-000124d0: 7265 6c61 7465 6420 7265 6c61 7469 7665  related relative
-000124e0: 2075 6e63 6572 7461 696e 7469 6573 2078   uncertainties x
-000124f0: 0a20 2020 2020 202d 2071 7569 6574 3a20  .      - quiet: 
-00012500: 2020 6e6f 2069 6e66 6f72 6d61 7469 7665    no informative
-00012510: 2070 7269 6e74 6f75 7420 6966 2054 7275   printout if Tru
-00012520: 650a 0a20 2020 2050 7562 6c69 6320 6d65  e..    Public me
-00012530: 7468 6f64 733a 0a20 2020 2020 202d 2069  thods:.      - i
-00012540: 6e69 745f 6479 6e61 6d69 6345 7272 6f72  nit_dynamicError
-00012550: 7328 293a 0a20 2020 2020 202d 2067 6574  s():.      - get
-00012560: 5f43 6f76 2829 3a20 6669 6e61 6c20 636f  _Cov(): final co
-00012570: 7661 7269 616e 6365 206d 6174 7269 7820  variance matrix 
-00012580: 2869 6e63 6c2e 2070 726f 6a2e 2078 2920  (incl. proj. x) 
-00012590: 200a 2020 2020 2020 2d20 6765 745f 6943   .      - get_iC
-000125a0: 6f76 2829 3a20 696e 7665 7273 6520 636f  ov(): inverse co
-000125b0: 7661 7269 616e 6365 206d 6174 7269 780a  variance matrix.
-000125c0: 2020 2020 2020 2d20 706c 6f74 2829 3a20        - plot(): 
-000125d0: 7072 6f76 6964 6520 6120 6669 6775 7265  provide a figure
-000125e0: 2077 6974 6820 7265 7072 6573 656e 7461   with representa
-000125f0: 7469 6f6e 206f 6620 6461 7461 0a20 0a20  tion of data. . 
-00012600: 2020 2044 6174 6120 6d65 6d62 6572 733a     Data members:
-00012610: 2020 0a20 2020 2020 202a 2063 6f70 7920    .      * copy 
-00012620: 6f66 2061 6c6c 2069 6e70 7574 2061 7267  of all input arg
-00012630: 756d 656e 7473 0a20 2020 2020 202a 2063  uments.      * c
-00012640: 6f76 3a20 636f 7661 7269 616e 6365 206d  ov: covariance m
-00012650: 6174 7269 780a 2020 2020 2020 2a20 6943  atrix.      * iC
-00012660: 6f76 3a20 696e 7665 7273 6520 6f66 2063  ov: inverse of c
-00012670: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
-00012680: 0a20 2020 2022 2222 0a20 2020 2064 6566  .    """.    def
-00012690: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-000126a0: 6f75 7465 722c 0a20 2020 2020 2020 2020  outer,.         
-000126b0: 2020 2020 2020 2020 782c 2065 2c20 6572          x, e, er
-000126c0: 656c 2c20 6361 6273 2c20 6372 656c 2c0a  el, cabs, crel,.
-000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126e0: 206e 616d 6573 203d 204e 6f6e 652c 0a20   names = None,. 
-000126f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012700: 7175 6965 743d 5472 7565 293a 0a20 2020  quiet=True):.   
-00012710: 2020 2023 2073 6176 6520 706f 696e 6572     # save poiner
-00012720: 2074 6f20 6361 6c6c 696e 6720 636c 6173   to calling clas
-00012730: 730a 2020 2020 2020 7365 6c66 2e6f 7574  s.      self.out
-00012740: 6572 203d 206f 7574 6572 0a0a 2020 2020  er = outer..    
-00012750: 2020 2320 6173 7375 6d65 2073 696d 706c    # assume simpl
-00012760: 6520 6361 7365 2077 2e6f 2e20 636f 762e  e case w.o. cov.
-00012770: 6d61 742e 0a20 2020 2020 2073 656c 662e  mat..      self.
-00012780: 6e65 6564 735f 636f 7661 7269 616e 6365  needs_covariance
-00012790: 203d 2046 616c 7365 200a 0a20 2020 2020   = False ..     
-000127a0: 2073 656c 662e 784e 616d 6573 203d 206e   self.xNames = n
-000127b0: 616d 6573 2023 2073 6574 2070 6172 616d  ames # set param
-000127c0: 6574 6572 206e 616d 6573 0a20 2020 2020  eter names.     
-000127d0: 200a 2020 2020 2020 6e64 203d 206c 656e   .      nd = len
-000127e0: 2878 290a 2020 2020 2020 2320 7374 6f72  (x).      # stor
-000127f0: 6520 696e 7075 7420 6461 7461 2061 7320  e input data as 
-00012800: 6e75 6d70 7920 666c 6f61 7420 6172 7261  numpy float arra
-00012810: 7973 2c20 656e 7375 7265 206c 656e 6774  ys, ensure lengt
-00012820: 6820 6e64 2069 6620 6e65 6564 6564 0a20  h nd if needed. 
-00012830: 2020 2020 2073 656c 662e 7820 3d20 6e70       self.x = np
-00012840: 2e61 7366 6172 7261 7928 7829 2020 2020  .asfarray(x)    
-00012850: 2020 2020 2023 2061 6273 6369 7373 6120       # abscissa 
-00012860: 2d20 2278 2076 616c 7565 7322 0a20 2020  - "x values".   
-00012870: 2020 2073 656c 662e 6520 3d20 6e70 2e61     self.e = np.a
-00012880: 7366 6172 7261 7928 6529 2020 2020 2020  sfarray(e)      
-00012890: 2023 2069 6e64 6570 656e 6465 6e74 2075   # independent u
-000128a0: 6e63 6572 7461 696e 7469 6573 2079 0a20  ncertainties y. 
-000128b0: 2020 2020 2069 6620 7365 6c66 2e65 2e6e       if self.e.n
-000128c0: 6469 6d20 3d3d 2030 3a0a 2020 2020 2020  dim == 0:.      
-000128d0: 2020 2020 7365 6c66 2e65 203d 2073 656c      self.e = sel
-000128e0: 662e 6520 2a20 6e70 2e6f 6e65 7328 6e64  f.e * np.ones(nd
-000128f0: 290a 2020 2020 2020 656c 6966 2073 656c  ).      elif sel
-00012900: 662e 652e 6e64 696d 203d 3d20 323a 0a20  f.e.ndim == 2:. 
-00012910: 2020 2020 2020 2020 2073 656c 662e 6e65           self.ne
-00012920: 6564 735f 636f 7661 7269 616e 6365 3d54  eds_covariance=T
-00012930: 7275 650a 2020 2020 2020 6966 2065 7265  rue.      if ere
-00012940: 6c20 6973 206e 6f74 204e 6f6e 653a 0a20  l is not None:. 
-00012950: 2020 2020 2020 2073 656c 662e 6572 656c         self.erel
-00012960: 203d 206e 702e 6173 6661 7272 6179 2865   = np.asfarray(e
-00012970: 7265 6c29 2023 2069 6e64 6570 656e 6465  rel) # independe
-00012980: 6e74 2072 656c 6174 6976 6520 756e 6365  nt relative unce
-00012990: 7274 6169 6e74 6965 7320 780a 2020 2020  rtainties x.    
-000129a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000129b0: 7365 6c66 2e65 7265 6c20 3d20 4e6f 6e65  self.erel = None
-000129c0: 0a20 2020 2020 2069 6620 6361 6273 2069  .      if cabs i
-000129d0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000129e0: 2020 2020 7365 6c66 2e63 6162 7320 3d20      self.cabs = 
-000129f0: 6e70 2e61 7366 6172 7261 7928 6361 6273  np.asfarray(cabs
-00012a00: 2920 2320 636f 7272 656c 6174 6564 2061  ) # correlated a
-00012a10: 626f 6c75 7465 2075 6e63 6572 7461 696e  bolute uncertain
-00012a20: 7469 6573 2078 0a20 2020 2020 2020 2069  ties x.        i
-00012a30: 6620 7365 6c66 2e63 6162 732e 6e64 696d  f self.cabs.ndim
-00012a40: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00012a50: 2073 656c 662e 6361 6273 203d 2073 656c   self.cabs = sel
-00012a60: 662e 6361 6273 202a 206e 702e 6f6e 6573  f.cabs * np.ones
-00012a70: 286e 6429 0a20 2020 2020 2065 6c73 653a  (nd).      else:
-00012a80: 0a20 2020 2020 2020 2073 656c 662e 6361  .        self.ca
-00012a90: 6273 203d 204e 6f6e 650a 2020 2020 2020  bs = None.      
-00012aa0: 6966 2063 7265 6c20 6973 206e 6f74 204e  if crel is not N
-00012ab0: 6f6e 653a 2020 200a 2020 2020 2020 2020  one:   .        
-00012ac0: 7365 6c66 2e63 7265 6c20 3d20 6e70 2e61  self.crel = np.a
-00012ad0: 7366 6172 7261 7928 6372 656c 2920 2320  sfarray(crel) # 
-00012ae0: 636f 7272 656c 6174 6564 2072 656c 6174  correlated relat
-00012af0: 6976 6520 756e 6365 7274 6169 6e74 6965  ive uncertaintie
-00012b00: 7320 780a 2020 2020 2020 656c 7365 3a0a  s x.      else:.
-00012b10: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
-00012b20: 6c20 3d20 4e6f 6e65 0a20 2020 2020 2073  l = None.      s
-00012b30: 656c 662e 7175 6965 7420 3d20 7175 6965  elf.quiet = quie
-00012b40: 7420 2020 2020 2023 206e 6f20 696e 666f  t      # no info
-00012b50: 726d 6174 6976 6520 7072 696e 746f 7574  rmative printout
-00012b60: 2069 6620 5472 7565 0a0a 2020 2020 2020   if True..      
-00012b70: 7365 6c66 2e6e 6420 3d20 6e64 0a20 2020  self.nd = nd.   
-00012b80: 2020 2073 656c 662e 646c 656e 6774 6820     self.dlength 
-00012b90: 3d20 6e64 0a20 2020 2020 2073 656c 662e  = nd.      self.
-00012ba0: 6d6f 6465 6c20 3d20 4e6f 6e65 2023 206e  model = None # n
-00012bb0: 6f20 6d6f 6465 6c20 6465 6669 6e65 6420  o model defined 
-00012bc0: 7965 740a 2020 2020 2020 7365 6c66 2e6d  yet.      self.m
-00012bd0: 6f64 656c 5f76 616c 7565 7320 3d20 4e6f  odel_values = No
-00012be0: 6e65 0a0a 2020 2020 2020 2320 7365 7420  ne..      # set 
-00012bf0: 666c 6167 7320 666f 7220 7374 6565 7269  flags for steeri
-00012c00: 6e67 206f 6620 6669 7420 7072 6f63 6573  ng of fit proces
-00012c10: 7320 696e 2064 6f5f 6669 7428 290a 2020  s in do_fit().  
-00012c20: 2020 2020 7365 6c66 2e72 6562 756c 696c      self.rebulil
-00012c30: 6443 6f76 203d 204e 6f6e 650a 2020 2020  dCov = None.    
-00012c40: 2020 7365 6c66 2e68 6173 5f72 656c 5f45    self.has_rel_E
-00012c50: 7272 6f72 7320 3d20 6572 656c 2069 7320  rrors = erel is 
-00012c60: 6e6f 7420 4e6f 6e65 206f 7220 6372 656c  not None or crel
-00012c70: 2069 7320 6e6f 7420 4e6f 6e65 0a20 2020   is not None.   
-00012c80: 2020 2073 656c 662e 6e65 6564 735f 636f     self.needs_co
-00012c90: 7661 7269 616e 6365 203d 2073 656c 662e  variance = self.
-00012ca0: 6e65 6564 735f 636f 7661 7269 616e 6365  needs_covariance
-00012cb0: 206f 7220 5c0a 2020 2020 2020 2020 7365   or \.        se
-00012cc0: 6c66 2e63 6162 7320 6973 206e 6f74 204e  lf.cabs is not N
-00012cd0: 6f6e 6520 6f72 2073 656c 662e 6372 656c  one or self.crel
-00012ce0: 2069 7320 6e6f 7420 4e6f 6e65 0a0a 0a20   is not None... 
-00012cf0: 2020 2020 2023 2062 7569 6c64 2028 696e       # build (in
-00012d00: 6974 6961 6c29 2063 6f76 6172 6961 6e63  itial) covarianc
-00012d10: 6520 6d61 7472 6978 2028 7769 7468 6f75  e matrix (withou
-00012d20: 7420 782d 6572 726f 7273 290a 2020 2020  t x-errors).    
-00012d30: 2020 6966 2073 656c 662e 6e65 6564 735f    if self.needs_
-00012d40: 636f 7661 7269 616e 6365 3a0a 2020 2020  covariance:.    
-00012d50: 2020 2020 6572 7232 203d 205f 6275 696c      err2 = _buil
-00012d60: 645f 436f 764d 6174 2873 656c 662e 6e64  d_CovMat(self.nd
-00012d70: 2c20 7365 6c66 2e65 2c20 7365 6c66 2e65  , self.e, self.e
-00012d80: 7265 6c2c 0a20 2020 2020 2020 2020 2020  rel,.           
-00012d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012da0: 2020 7365 6c66 2e63 6162 732c 2073 656c    self.cabs, sel
-00012db0: 662e 6372 656c 2c20 7365 6c66 2e78 290a  f.crel, self.x).
-00012dc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00012dd0: 2020 2020 6572 7232 203d 205f 6275 696c      err2 = _buil
-00012de0: 645f 4572 7232 2873 656c 662e 652c 2073  d_Err2(self.e, s
-00012df0: 656c 662e 6572 656c 2c20 7365 6c66 2e78  elf.erel, self.x
-00012e00: 290a 0a20 2020 2020 2023 2069 6e69 7469  )..      # initi
-00012e10: 616c 697a 6520 756e 6365 7274 6169 6e74  alize uncertaint
-00012e20: 6965 7320 616e 6420 636f 7661 7269 616e  ies and covarian
-00012e30: 6365 206d 6174 7269 782c 0a20 2020 2020  ce matrix,.     
-00012e40: 2073 656c 662e 5f69 6e69 7469 616c 436f   self._initialCo
-00012e50: 7628 6572 7232 290a 2020 2020 2020 2320  v(err2).      # 
-00012e60: 7365 7473 3a20 0a20 2020 2020 2023 2020  sets: .      #  
-00012e70: 2073 656c 662e 636f 7678 3a20 636f 7661   self.covx: cova
-00012e80: 7269 616e 6365 206d 6174 7269 7820 6f66  riance matrix of
-00012e90: 2078 0a20 2020 2020 2023 2020 2073 656c   x.      #   sel
-00012ea0: 662e 636f 7679 3a20 636f 7661 7269 616e  f.covy: covarian
-00012eb0: 6365 206d 6174 7269 7820 6f66 2079 2075  ce matrix of y u
-00012ec0: 6e63 6572 7461 696e 7469 6573 0a20 2020  ncertainties.   
-00012ed0: 2020 2023 2020 2073 656c 662e 636f 763a     #   self.cov:
-00012ee0: 2066 756c 6c20 636f 7661 7269 616e 6365   full covariance
-00012ef0: 206d 6174 7269 7820 696e 636c 2e20 7072   matrix incl. pr
-00012f00: 6f6a 6563 7465 6420 780a 2020 2020 2020  ojected x.      
-00012f10: 2320 2020 7365 6c66 2e69 436f 763a 2069  #   self.iCov: i
-00012f20: 6e76 6572 7365 206f 6620 636f 7661 7269  nverse of covari
-00012f30: 616e 6365 206d 6174 7269 780a 2020 2020  ance matrix.    
-00012f40: 2020 2320 2020 7365 6c66 2e65 7272 323a    #   self.err2:
-00012f50: 2061 7272 6179 206f 6620 7371 7561 7265   array of square
-00012f60: 6420 756e 6365 7274 6169 6e74 6965 730a  d uncertainties.
-00012f70: 2020 2020 2020 2320 2020 7365 6c66 2e69        #   self.i
-00012f80: 4572 7232 3a20 312e 2f73 656c 662e 6572  Err2: 1./self.er
-00012f90: 7232 0a20 2020 2020 200a 2020 2020 6465  r2.      .    de
-00012fa0: 6620 5f69 6e69 7469 616c 436f 7628 7365  f _initialCov(se
-00012fb0: 6c66 2c20 6572 7232 293a 0a20 2020 2020  lf, err2):.     
-00012fc0: 2022 2222 4275 696c 6420 696e 6974 6961   """Build initia
-00012fd0: 6c20 2873 7461 7469 6329 2063 6f76 6172  l (static) covar
-00012fe0: 6961 6e63 6520 6d61 7472 6978 2066 6f72  iance matrix for
-00012ff0: 2079 2d65 7272 6f72 730a 2020 2020 2020   y-errors.      
-00013000: 2866 6f72 2070 7265 2d66 6974 2920 616e  (for pre-fit) an
-00013010: 6420 6361 6c63 756c 6174 6520 696e 7665  d calculate inve
-00013020: 7273 6520 6d61 7472 6978 0a20 2020 2020  rse matrix.     
-00013030: 2022 2222 0a20 2020 2020 2069 6620 6572   """.      if er
-00013040: 7232 2e6e 6469 6d20 3d3d 2032 3a0a 2020  r2.ndim == 2:.  
-00013050: 2020 2020 2023 2067 6f74 2061 2063 6f76       # got a cov
-00013060: 6172 6961 6e63 6520 6d61 7472 6978 2c20  ariance matrix, 
-00013070: 6e65 6564 2069 6e76 6572 7365 0a20 2020  need inverse.   
-00013080: 2020 2020 2073 656c 662e 6e65 6564 735f       self.needs_
-00013090: 636f 7661 7269 616e 6365 203d 2054 7275  covariance = Tru
-000130a0: 650a 2020 2020 2020 2020 7365 6c66 2e63  e.        self.c
-000130b0: 6f76 203d 2065 7272 320a 2020 2020 2020  ov = err2.      
-000130c0: 2020 7365 6c66 2e69 436f 7620 3d20 6c69    self.iCov = li
-000130d0: 6e61 6c67 2e69 6e76 2865 7272 3229 0a20  nalg.inv(err2). 
-000130e0: 2020 2020 2020 2073 656c 662e 6572 7232         self.err2
-000130f0: 203d 206e 702e 6469 6167 6f6e 616c 2865   = np.diagonal(e
-00013100: 7272 3229 2023 2073 7175 6172 6564 2064  rr2) # squared d
-00013110: 6961 676f 6e61 6c20 656c 656d 656e 7473  iagonal elements
-00013120: 0a20 2020 2020 2065 6c73 653a 0a20 2020  .      else:.   
-00013130: 2020 2023 2067 6f74 2069 6e64 6570 656e     # got indepen
-00013140: 6465 6e74 2075 6e63 6572 7461 696e 7469  dent uncertainti
-00013150: 6573 0a20 2020 2020 2020 2073 656c 662e  es.        self.
-00013160: 6572 7232 203d 2065 7272 320a 2020 2020  err2 = err2.    
-00013170: 2020 2020 7365 6c66 2e65 7272 3279 203d      self.err2y =
-00013180: 2065 7272 320a 2020 2020 2020 2020 7365   err2.        se
-00013190: 6c66 2e69 4572 7232 203d 2031 2e2f 6572  lf.iErr2 = 1./er
-000131a0: 7232 0a20 2020 2020 2020 2073 656c 662e  r2.        self.
-000131b0: 636f 7620 3d20 6e70 2e64 6961 6728 6572  cov = np.diag(er
-000131c0: 7232 290a 2020 2020 2020 2020 7365 6c66  r2).        self
-000131d0: 2e69 436f 7620 3d20 6e70 2e64 6961 6728  .iCov = np.diag(
-000131e0: 312e 2f73 656c 662e 6572 7232 290a 2020  1./self.err2).  
-000131f0: 2020 2020 2320 646f 206e 6f74 2072 6562      # do not reb
-00013200: 7569 6c64 2063 6f76 6172 6961 6e63 6520  uild covariance 
-00013210: 6d61 7472 6978 2069 6e20 636f 7374 2066  matrix in cost f
-00013220: 756e 6374 696f 6e0a 2020 2020 2020 7365  unction.      se
-00013230: 6c66 2e6e 6565 6473 5f64 796e 616d 6963  lf.needs_dynamic
-00013240: 4572 726f 7273 203d 2046 616c 7365 200a  Errors = False .
-00013250: 0a20 2020 2064 6566 2069 6e69 745f 6479  .    def init_dy
-00013260: 6e61 6d69 6345 7272 6f72 7328 7365 6c66  namicErrors(self
-00013270: 293a 0a20 2020 2020 2023 206d 6574 686f  ):.      # metho
-00013280: 6420 746f 2073 7769 7463 6820 6f6e 2064  d to switch on d
-00013290: 796e 616d 6963 2072 652d 6361 6c63 756c  ynamic re-calcul
-000132a0: 6174 696f 6e20 6f66 2063 6f76 6172 6961  ation of covaria
-000132b0: 6e63 6520 6d61 7472 6978 200a 2020 2020  nce matrix .    
-000132c0: 2020 7365 6c66 2e72 6566 5f74 6f4d 6f64    self.ref_toMod
-000132d0: 656c 203d 2073 656c 662e 6f75 7465 722e  el = self.outer.
-000132e0: 7265 664d 6f64 656c 0a20 2020 2020 2073  refModel.      s
-000132f0: 656c 662e 6d6f 6465 6c20 3d20 7365 6c66  elf.model = self
-00013300: 2e6f 7574 6572 2e63 6f73 7466 2e6d 6f64  .outer.costf.mod
-00013310: 656c 0a20 2020 2020 0a20 2020 2020 2073  el.     .      s
-00013320: 656c 662e 5f73 7461 7469 6343 6f76 203d  elf._staticCov =
-00013330: 204e 6f6e 650a 2020 2020 2020 7365 6c66   None.      self
-00013340: 2e5f 7374 6174 6963 4572 7232 203d 204e  ._staticErr2 = N
-00013350: 6f6e 650a 2020 2020 2020 7365 6c66 2e69  one.      self.i
-00013360: 436f 7620 3d20 4e6f 6e65 0a20 2020 2020  Cov = None.     
-00013370: 2073 656c 662e 6945 7272 3220 3d20 4e6f   self.iErr2 = No
-00013380: 6e65 0a0a 2020 2020 2020 2320 7265 6275  ne..      # rebu
-00013390: 696c 6420 636f 7661 7269 616e 6365 206d  ild covariance m
-000133a0: 6174 7269 7820 6475 7269 6e67 2066 6974  atrix during fit
-000133b0: 7469 6e67 2070 726f 6365 6475 7265 0a20  ting procedure. 
-000133c0: 2020 2020 2073 656c 662e 6e65 6564 735f       self.needs_
-000133d0: 6479 6e61 6d69 6345 7272 6f72 7320 3d20  dynamicErrors = 
-000133e0: 5472 7565 2020 2020 2320 666c 6167 2066  True    # flag f
-000133f0: 6f72 2063 6f73 7420 6675 6e63 7469 6f6e  or cost function
-00013400: 0a20 2020 2020 2073 656c 662e 6669 6e61  .      self.fina
-00013410: 6c5f 6361 6c6c 203d 2046 616c 7365 2023  l_call = False #
-00013420: 2066 6c61 6720 666f 7220 5f72 6562 7569   flag for _rebui
-00013430: 6c64 5f43 6f76 3a20 6e6f 2073 746f 7261  ld_Cov: no stora
-00013440: 6765 206f 6620 7963 6f76 200a 2020 2020  ge of ycov .    
-00013450: 2020 0a20 2020 2020 2069 6620 7365 6c66    .      if self
-00013460: 2e6e 6565 6473 5f63 6f76 6172 6961 6e63  .needs_covarianc
-00013470: 653a 0a20 2020 2020 2020 2023 2062 7569  e:.        # bui
-00013480: 6c64 2073 7461 7469 6320 283d 7061 7261  ld static (=para
-00013490: 6d65 7465 722d 696e 6465 7065 6e64 656e  meter-independen
-000134a0: 7429 2070 6172 7420 6f66 2063 6f76 6172  t) part of covar
-000134b0: 6961 6e63 6520 6d61 7472 6978 2020 2020  iance matrix    
-000134c0: 2020 0a20 2020 2020 2020 2069 6620 7365    .        if se
-000134d0: 6c66 2e68 6173 5f72 656c 5f45 7272 6f72  lf.has_rel_Error
-000134e0: 7320 616e 6420 7365 6c66 2e72 6566 5f74  s and self.ref_t
-000134f0: 6f4d 6f64 656c 3a0a 2020 2020 2020 2020  oModel:.        
-00013500: 2020 2320 736f 6d65 2079 2d65 7272 6f72    # some y-error
-00013510: 7320 6172 6520 7061 7261 6d65 7465 722d  s are parameter-
-00013520: 696e 6465 7065 6e64 656e 740a 2020 2020  independent.    
-00013530: 2020 2020 2020 7365 6c66 2e5f 7374 6174        self._stat
-00013540: 6963 436f 7620 3d20 5f62 7569 6c64 5f43  icCov = _build_C
-00013550: 6f76 4d61 7428 7365 6c66 2e6e 642c 0a20  ovMat(self.nd,. 
-00013560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013570: 2020 2020 2020 7365 6c66 2e65 2c20 6561        self.e, ea
-00013580: 6273 636f 7220 3d20 7365 6c66 2e63 6162  bscor = self.cab
-00013590: 7320 290a 2020 2020 2020 2020 656c 7365  s ).        else
-000135a0: 3a20 0a20 2020 2020 2020 2020 2023 2061  : .          # a
-000135b0: 6c6c 2079 2d65 7272 6f72 7320 6172 6520  ll y-errors are 
-000135c0: 7061 7261 6d65 7465 722d 696e 6465 7065  parameter-indepe
-000135d0: 6e64 656e 740a 2020 2020 2020 2020 2020  ndent.          
-000135e0: 7365 6c66 2e5f 7374 6174 6963 436f 7620  self._staticCov 
-000135f0: 3d20 5f62 7569 6c64 5f43 6f76 4d61 7428  = _build_CovMat(
-00013600: 7365 6c66 2e6e 642c 0a20 2020 2020 2020  self.nd,.       
-00013610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013620: 2020 2020 2020 2073 656c 662e 652c 2065         self.e, e
-00013630: 7265 6c3d 7365 6c66 2e65 7265 6c2c 0a20  rel=self.erel,. 
-00013640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013650: 2020 2020 2020 2020 2020 2020 2065 6162               eab
-00013660: 7363 6f72 203d 2073 656c 662e 6361 6273  scor = self.cabs
-00013670: 2c20 6572 656c 636f 723d 7365 6c66 2e63  , erelcor=self.c
-00013680: 7265 6c2c 0a20 2020 2020 2020 2020 2020  rel,.           
-00013690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136b0: 2064 6174 613d 7365 6c66 2e78 290a 2020   data=self.x).  
-000136c0: 2020 2020 2020 2320 6275 696c 6420 6d61        # build ma
-000136d0: 7472 6978 206f 6620 7265 6c61 7469 7665  trix of relative
-000136e0: 2065 7272 6f72 730a 2020 2020 2020 2020   errors.        
-000136f0: 6966 2073 656c 662e 7265 665f 746f 4d6f  if self.ref_toMo
-00013700: 6465 6c20 616e 6420 7365 6c66 2e68 6173  del and self.has
-00013710: 5f72 656c 5f45 7272 6f72 733a 0a20 2020  _rel_Errors:.   
-00013720: 2020 2020 2020 2073 656c 662e 5f63 6f76         self._cov
-00013730: 7930 203d 205f 6275 696c 645f 436f 764d  y0 = _build_CovM
-00013740: 6174 2873 656c 662e 6e64 2c0a 2020 2020  at(self.nd,.    
+0000ed60: 6561 6273 636f 7220 3d20 7365 6c66 2e63  eabscor = self.c
+0000ed70: 6162 7379 2c20 6572 656c 636f 723d 7365  absy, erelcor=se
+0000ed80: 6c66 2e63 7265 6c79 2c0a 2020 2020 2020  lf.crely,.      
+0000ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edb0: 2020 2020 2020 6461 7461 3d73 656c 662e        data=self.
+0000edc0: 7929 0a20 2020 2020 2020 2023 2062 7569  y).        # bui
+0000edd0: 6c64 206d 6174 7269 7820 6f66 2072 656c  ld matrix of rel
+0000ede0: 6174 6976 6520 6572 726f 7273 0a20 2020  ative errors.   
+0000edf0: 2020 2020 2069 6620 7365 6c66 2e72 6566       if self.ref
+0000ee00: 5f74 6f4d 6f64 656c 2061 6e64 2073 656c  _toModel and sel
+0000ee10: 662e 6861 735f 7265 6c5f 7945 7272 6f72  f.has_rel_yError
+0000ee20: 733a 0a20 2020 2020 2020 2020 2073 656c  s:.          sel
+0000ee30: 662e 5f63 6f76 7930 203d 205f 6275 696c  f._covy0 = _buil
+0000ee40: 645f 436f 764d 6174 2873 656c 662e 6e64  d_CovMat(self.nd
+0000ee50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ee60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000ee70: 7265 6c3d 7365 6c66 2e65 7265 6c79 2c0a  rel=self.erely,.
+0000ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee90: 2020 2020 2020 2020 2020 2020 2065 7265               ere
+0000eea0: 6c63 6f72 3d73 656c 662e 6372 656c 792c  lcor=self.crely,
+0000eeb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000eec0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0000eed0: 7461 3d6e 702e 6f6e 6573 2873 656c 662e  ta=np.ones(self.
+0000eee0: 6e64 2929 0a20 2020 2020 2020 2065 6c73  nd)).        els
+0000eef0: 653a 0a20 2020 2020 2020 2020 2073 656c  e:.          sel
+0000ef00: 662e 5f63 6f76 7930 203d 204e 6f6e 650a  f._covy0 = None.
+0000ef10: 2020 2020 2020 2020 2320 636f 7661 7269          # covari
+0000ef20: 616e 6365 206d 6174 7269 7820 6f66 2078  ance matrix of x
+0000ef30: 2d75 6e63 6572 7461 696e 7469 6573 2028  -uncertainties (
+0000ef40: 616c 6c20 6172 6520 7061 7261 6d65 7465  all are paramete
+0000ef50: 722d 6465 7065 6e64 656e 7429 0a20 2020  r-dependent).   
+0000ef60: 2020 2020 2069 6620 7365 6c66 2e68 6173       if self.has
+0000ef70: 5f78 4572 726f 7273 3a0a 2020 2020 2020  _xErrors:.      
+0000ef80: 2020 2020 7365 6c66 2e63 6f76 7820 3d20      self.covx = 
+0000ef90: 5f62 7569 6c64 5f43 6f76 4d61 7428 7365  _build_CovMat(se
+0000efa0: 6c66 2e6e 642c 0a20 2020 2020 2020 2020  lf.nd,.         
+0000efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efc0: 7365 6c66 2e65 782c 2073 656c 662e 6572  self.ex, self.er
+0000efd0: 656c 782c 0a20 2020 2020 2020 2020 2020  elx,.           
+0000efe0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000eff0: 6c66 2e63 6162 7378 2c20 7365 6c66 2e63  lf.cabsx, self.c
+0000f000: 7265 6c78 2c0a 2020 2020 2020 2020 2020  relx,.          
+0000f010: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f020: 656c 662e 7829 0a20 2020 2020 2020 2020  elf.x).         
+0000f030: 2320 2064 6574 6572 6d69 6e65 2064 7820  #  determine dx 
+0000f040: 666f 7220 6465 7269 7661 7469 7665 2066  for derivative f
+0000f050: 726f 6d20 736d 616c 6c65 7374 2078 2d75  rom smallest x-u
+0000f060: 6e63 6572 7461 696e 7479 0a20 2020 2020  ncertainty.     
+0000f070: 2020 2020 2073 656c 662e 5f64 7820 3d20       self._dx = 
+0000f080: 6e70 2e73 7172 7428 6d69 6e28 6e70 2e64  np.sqrt(min(np.d
+0000f090: 6961 676f 6e61 6c28 7365 6c66 2e63 6f76  iagonal(self.cov
+0000f0a0: 7829 2929 2f31 302e 0a20 2020 2020 2020  x)))/10..       
+0000f0b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000f0c0: 2073 656c 662e 636f 7678 203d 204e 6f6e   self.covx = Non
+0000f0d0: 650a 0a20 2020 2020 2065 6c73 653a 2023  e..      else: #
+0000f0e0: 206e 6f20 636f 7661 7269 616e 6365 206e   no covariance n
+0000f0f0: 6565 6465 642c 2075 7365 2073 696d 706c  eeded, use simpl
+0000f100: 6520 6d61 7468 0a20 2020 2020 2020 2023  e math.        #
+0000f110: 2062 7569 6c64 2073 7461 7469 6320 283d   build static (=
+0000f120: 7061 7261 6d65 7465 722d 696e 6465 7065  parameter-indepe
+0000f130: 6e64 656e 7429 2070 6172 7420 6f66 2063  ndent) part of c
+0000f140: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
+0000f150: 2020 2020 2020 0a20 2020 2020 2020 2069        .        i
+0000f160: 6620 7365 6c66 2e68 6173 5f72 656c 5f79  f self.has_rel_y
+0000f170: 4572 726f 7273 2061 6e64 2073 656c 662e  Errors and self.
+0000f180: 7265 665f 746f 4d6f 6465 6c3a 0a20 2020  ref_toModel:.   
+0000f190: 2020 2020 2020 2023 206f 6e6c 7920 696e         # only in
+0000f1a0: 6465 7065 6e64 656e 7420 792d 6572 726f  dependent y-erro
+0000f1b0: 7273 2064 6f20 6e6f 7420 6465 7065 6e64  rs do not depend
+0000f1c0: 206f 6e20 7061 7261 6d65 7465 7273 0a20   on parameters. 
+0000f1d0: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
+0000f1e0: 7461 7469 6345 7272 3220 3d20 5f62 7569  taticErr2 = _bui
+0000f1f0: 6c64 5f45 7272 3228 7365 6c66 2e65 7929  ld_Err2(self.ey)
+0000f200: 0a20 2020 2020 2020 2065 6c73 653a 200a  .        else: .
+0000f210: 2020 2020 2020 2020 2020 2320 616c 6c20            # all 
+0000f220: 792d 6572 726f 7273 2061 7265 2070 6172  y-errors are par
+0000f230: 616d 6574 6572 2d69 6e64 6570 656e 6465  ameter-independe
+0000f240: 6e74 0a20 2020 2020 2020 2020 2073 656c  nt.          sel
+0000f250: 662e 5f73 7461 7469 6345 7272 3220 3d20  f._staticErr2 = 
+0000f260: 5f62 7569 6c64 5f45 7272 3228 2073 656c  _build_Err2( sel
+0000f270: 662e 6579 2c20 7365 6c66 2e65 7265 6c79  f.ey, self.erely
+0000f280: 2c20 7365 6c66 2e79 290a 2020 2020 2020  , self.y).      
+0000f290: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
+0000f2a0: 7365 6c66 2e68 6173 5f78 4572 726f 7273  self.has_xErrors
+0000f2b0: 3a0a 2020 2020 2020 2020 2020 7365 6c66  :.          self
+0000f2c0: 2e65 7272 3278 203d 205f 6275 696c 645f  .err2x = _build_
+0000f2d0: 4572 7232 2873 656c 662e 6578 2c20 7365  Err2(self.ex, se
+0000f2e0: 6c66 2e65 7265 6c78 2c20 7365 6c66 2e78  lf.erelx, self.x
+0000f2f0: 290a 2020 2020 2020 2020 2023 2020 6465  ).         #  de
+0000f300: 7465 726d 696e 6520 6478 2066 6f72 2064  termine dx for d
+0000f310: 6572 6976 6174 6976 6520 6672 6f6d 2073  erivative from s
+0000f320: 6d61 6c6c 6573 7420 782d 756e 6365 7274  mallest x-uncert
+0000f330: 6169 6e74 790a 2020 2020 2020 2020 2020  ainty.          
+0000f340: 7365 6c66 2e5f 6478 203d 206e 702e 7371  self._dx = np.sq
+0000f350: 7274 286d 696e 2873 656c 662e 6572 7232  rt(min(self.err2
+0000f360: 7829 292f 3130 2e0a 2020 2020 2020 2020  x))/10..        
+0000f370: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000f380: 7365 6c66 2e65 7272 3278 203d 204e 6f6e  self.err2x = Non
+0000f390: 650a 0a20 2020 2064 6566 205f 7265 6275  e..    def _rebu
+0000f3a0: 696c 645f 4572 7232 2873 656c 662c 206d  ild_Err2(self, m
+0000f3b0: 7061 7229 3a0a 2020 2020 2020 2222 220a  par):.      """.
+0000f3c0: 2020 2020 2020 2852 652d 2963 616c 6375        (Re-)calcu
+0000f3d0: 6c61 7465 2075 6e63 6572 7461 696e 6769  late uncertaingi
+0000f3e0: 6573 200a 2020 2020 2020 2222 220a 2020  es .      """.  
+0000f3f0: 2020 2020 6966 2073 656c 662e 5f73 7461      if self._sta
+0000f400: 7469 6345 7272 3220 6973 206e 6f74 204e  ticErr2 is not N
+0000f410: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
+0000f420: 662e 6572 7232 203d 206e 702e 6172 7261  f.err2 = np.arra
+0000f430: 7928 7365 6c66 2e5f 7374 6174 6963 4572  y(self._staticEr
+0000f440: 7232 2c20 636f 7079 3d54 7275 6529 0a20  r2, copy=True). 
+0000f450: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000f460: 2020 2073 656c 662e 6572 7232 203d 206e     self.err2 = n
+0000f470: 702e 7a65 726f 7328 7365 6c66 2e6e 6429  p.zeros(self.nd)
+0000f480: 0a20 2020 2020 2069 6620 7365 6c66 2e72  .      if self.r
+0000f490: 6566 5f74 6f4d 6f64 656c 2061 6e64 2073  ef_toModel and s
+0000f4a0: 656c 662e 6861 735f 7265 6c5f 7945 7272  elf.has_rel_yErr
+0000f4b0: 6f72 733a 0a20 2020 2020 2020 205f 6572  ors:.        _er
+0000f4c0: 203d 2073 656c 662e 6572 656c 7920 2a20   = self.erely * 
+0000f4d0: 7365 6c66 2e6d 6f64 656c 2873 656c 662e  self.model(self.
+0000f4e0: 782c 202a 6d70 6172 2920 2020 2020 2020  x, *mpar)       
+0000f4f0: 0a20 2020 2020 2020 2073 656c 662e 6572  .        self.er
+0000f500: 7232 202b 3d20 5f65 7220 2a20 5f65 720a  r2 += _er * _er.
+0000f510: 2020 2020 2020 2320 7265 6d65 6d62 6572        # remember
+0000f520: 2079 2d65 7272 6f72 7320 200a 2020 2020   y-errors  .    
+0000f530: 2020 7365 6c66 2e65 7272 3279 203d 206e    self.err2y = n
+0000f540: 702e 6172 7261 7928 7365 6c66 2e65 7272  p.array(self.err
+0000f550: 322c 2063 6f70 793d 5472 7565 290a 2020  2, copy=True).  
+0000f560: 2020 2023 2061 6464 2070 726f 6a65 6374     # add project
+0000f570: 6564 2078 2065 7272 6f72 730a 2020 2020  ed x errors.    
+0000f580: 2020 6966 2073 656c 662e 6572 7232 7820    if self.err2x 
+0000f590: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000f5a0: 2020 2023 2064 6574 6572 6d69 6e65 2064     # determine d
+0000f5b0: 6572 6976 6174 6976 6573 206f 6620 6d6f  erivatives of mo
+0000f5c0: 6465 6c20 6675 6e63 7469 6f6e 2077 2e72  del function w.r
+0000f5d0: 2e74 2e20 782c 0a20 2020 2020 2020 205f  .t. x,.        _
+0000f5e0: 6d70 7269 6d65 203d 2030 2e35 202f 2073  mprime = 0.5 / s
+0000f5f0: 656c 662e 5f64 7820 2a20 280a 2020 2020  elf._dx * (.    
+0000f600: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f610: 6d6f 6465 6c28 7365 6c66 2e78 202b 2073  model(self.x + s
+0000f620: 656c 662e 5f64 782c 202a 6d70 6172 2920  elf._dx, *mpar) 
+0000f630: 2d20 0a20 2020 2020 2020 2020 2020 2020  - .             
+0000f640: 2020 7365 6c66 2e6d 6f64 656c 2873 656c    self.model(sel
+0000f650: 662e 7820 2d20 7365 6c66 2e5f 6478 2c20  f.x - self._dx, 
+0000f660: 2a6d 7061 7229 2029 0a20 2020 2020 2023  *mpar) ).      #
+0000f670: 2070 726f 6a65 6374 206f 6e20 7920 616e   project on y an
+0000f680: 6420 6164 6420 746f 2063 6f76 6172 6961  d add to covaria
+0000f690: 6e63 6520 6d61 7472 6978 0a20 2020 2020  nce matrix.     
+0000f6a0: 2020 2073 656c 662e 6572 7232 202b 3d20     self.err2 += 
+0000f6b0: 5f6d 7072 696d 6520 2a20 5f6d 7072 696d  _mprime * _mprim
+0000f6c0: 6520 2a20 7365 6c66 2e65 7272 3278 0a20  e * self.err2x. 
+0000f6d0: 2020 2020 2020 200a 2020 2020 6465 6620         .    def 
+0000f6e0: 5f72 6562 7569 6c64 5f43 6f76 2873 656c  _rebuild_Cov(sel
+0000f6f0: 662c 206d 7061 7229 3a0a 2020 2020 2020  f, mpar):.      
+0000f700: 2222 220a 2020 2020 2020 2852 652d 2942  """.      (Re-)B
+0000f710: 7569 6c64 2074 6865 2063 6f76 6172 6961  uild the covaria
+0000f720: 6e63 6520 6d61 7472 6978 2066 726f 6d20  nce matrix from 
+0000f730: 636f 6d70 6f6e 656e 7473 0a20 2020 2020  components.     
+0000f740: 2061 6e64 2063 6163 6c75 6c61 7465 2069   and caclulate i
+0000f750: 7473 2069 6e76 6572 7365 0a20 2020 2020  ts inverse.     
+0000f760: 2022 2222 0a20 2020 2020 2320 7374 6172   """.     # star
+0000f770: 7420 6672 6f6d 2070 7265 2d62 7569 6c74  t from pre-built
+0000f780: 2070 6172 616d 6574 6572 2d69 6e64 6570   parameter-indep
+0000f790: 656e 6465 6e74 2070 6172 7420 6f66 2043  endent part of C
+0000f7a0: 6f76 6172 6961 6e63 6520 4d61 7472 6978  ovariance Matrix
+0000f7b0: 0a20 2020 2020 2073 656c 662e 636f 7620  .      self.cov 
+0000f7c0: 3d20 6e70 2e61 7272 6179 2873 656c 662e  = np.array(self.
+0000f7d0: 5f73 7461 7469 6343 6f76 2c20 636f 7079  _staticCov, copy
+0000f7e0: 3d54 7275 6529 0a0a 2020 2020 2023 2061  =True)..     # a
+0000f7f0: 6464 206d 6174 7269 7820 6f66 2070 6172  dd matrix of par
+0000f800: 616d 6574 6572 2d64 6570 656e 6465 6e74  ameter-dependent
+0000f810: 2079 2d75 6e63 6572 7461 696e 7469 6573   y-uncertainties
+0000f820: 0a23 2020 2020 2020 6966 2073 656c 662e  .#      if self.
+0000f830: 7265 665f 746f 4d6f 6465 6c20 616e 6420  ref_toModel and 
+0000f840: 7365 6c66 2e68 6173 5f72 656c 5f79 4572  self.has_rel_yEr
+0000f850: 726f 7273 3a0a 2020 2020 2020 6966 2073  rors:.      if s
+0000f860: 656c 662e 5f63 6f76 7930 2069 7320 6e6f  elf._covy0 is no
+0000f870: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000f880: 5f79 6461 7420 3d20 7365 6c66 2e6d 6f64  _ydat = self.mod
+0000f890: 656c 2873 656c 662e 782c 202a 6d70 6172  el(self.x, *mpar
+0000f8a0: 2920 2020 2020 2020 0a20 2020 2020 2020  )       .       
+0000f8b0: 2073 656c 662e 636f 7620 2b3d 2073 656c   self.cov += sel
+0000f8c0: 662e 5f63 6f76 7930 202a 206e 702e 6f75  f._covy0 * np.ou
+0000f8d0: 7465 7228 5f79 6461 742c 205f 7964 6174  ter(_ydat, _ydat
+0000f8e0: 290a 2020 2020 2023 2061 6464 2070 726f  ).     # add pro
+0000f8f0: 6a65 6374 6564 2078 2065 7272 6f72 730a  jected x errors.
+0000f900: 2020 2020 2020 6966 2073 656c 662e 6861        if self.ha
+0000f910: 735f 7845 7272 6f72 733a 0a20 2020 2020  s_xErrors:.     
+0000f920: 2020 2023 2073 746f 7265 2063 6f76 6172     # store covar
+0000f930: 6961 6e63 6520 6d61 7472 6978 206f 6620  iance matrix of 
+0000f940: 792d 756e 6365 7274 6169 6e74 6965 7320  y-uncertainties 
+0000f950: 2020 200a 2020 2020 2020 2020 6966 2073     .        if s
+0000f960: 656c 662e 6669 6e61 6c5f 6361 6c6c 3a0a  elf.final_call:.
+0000f970: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+0000f980: 6f76 7920 3d20 6e70 2e61 7272 6179 2873  ovy = np.array(s
+0000f990: 656c 662e 636f 762c 2063 6f70 793d 5472  elf.cov, copy=Tr
+0000f9a0: 7565 290a 0a20 2020 2020 2020 2320 6465  ue)..       # de
+0000f9b0: 7465 726d 696e 6520 6465 7269 7661 7469  termine derivati
+0000f9c0: 7665 7320 6f66 206d 6f64 656c 2066 756e  ves of model fun
+0000f9d0: 6374 696f 6e20 772e 722e 742e 2078 2c0a  ction w.r.t. x,.
+0000f9e0: 2020 2020 2020 2020 5f6d 7072 696d 6520          _mprime 
+0000f9f0: 3d20 302e 3520 2f20 7365 6c66 2e5f 6478  = 0.5 / self._dx
+0000fa00: 202a 2028 0a20 2020 2020 2020 2020 2020   * (.           
+0000fa10: 2020 2020 7365 6c66 2e6d 6f64 656c 2873      self.model(s
+0000fa20: 656c 662e 7820 2b20 7365 6c66 2e5f 6478  elf.x + self._dx
+0000fa30: 2c20 2a6d 7061 7229 202d 200a 2020 2020  , *mpar) - .    
+0000fa40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000fa50: 6d6f 6465 6c28 7365 6c66 2e78 202d 2073  model(self.x - s
+0000fa60: 656c 662e 5f64 782c 202a 6d70 6172 2920  elf._dx, *mpar) 
+0000fa70: 290a 2020 2020 2020 2023 2070 726f 6a65  ).       # proje
+0000fa80: 6374 206f 6e20 7920 616e 6420 6164 6420  ct on y and add 
+0000fa90: 746f 2063 6f76 6172 6961 6e63 6520 6d61  to covariance ma
+0000faa0: 7472 6978 0a20 2020 2020 2020 2073 656c  trix.        sel
+0000fab0: 662e 636f 7620 2b3d 206e 702e 6f75 7465  f.cov += np.oute
+0000fac0: 7228 5f6d 7072 696d 652c 205f 6d70 7269  r(_mprime, _mpri
+0000fad0: 6d65 2920 2a20 7365 6c66 2e63 6f76 7820  me) * self.covx 
+0000fae0: 2020 2020 200a 2020 2020 2020 656c 7365       .      else
+0000faf0: 3a20 2320 6e6f 2078 2d65 7272 6f72 732c  : # no x-errors,
+0000fb00: 2079 2d63 6f76 6d61 7420 3d20 636f 766d   y-covmat = covm
+0000fb10: 6174 0a20 2020 2020 2020 2073 656c 662e  at.        self.
+0000fb20: 636f 7679 203d 2073 656c 662e 636f 7620  covy = self.cov 
+0000fb30: 2020 200a 0a20 2020 2064 6566 2067 6574     ..    def get
+0000fb40: 5f43 6f76 2873 656c 6629 3a0a 2020 2020  _Cov(self):.    
+0000fb50: 2020 2222 2272 6574 7572 6e20 636f 7661    """return cova
+0000fb60: 7269 616e 6365 206d 6174 7269 7820 6f66  riance matrix of
+0000fb70: 2064 6174 610a 2020 2020 2020 2222 220a   data.      """.
+0000fb80: 2020 2020 2020 6966 2073 656c 662e 6e65        if self.ne
+0000fb90: 6564 735f 636f 7661 7269 616e 6365 3a0a  eds_covariance:.
+0000fba0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000fbb0: 656c 662e 636f 760a 2020 2020 2020 656c  elf.cov.      el
+0000fbc0: 7365 3a0a 2020 2020 2020 2020 6966 2073  se:.        if s
+0000fbd0: 656c 662e 6572 7232 2069 7320 4e6f 6e65  elf.err2 is None
+0000fbe0: 3a0a 2020 2020 2020 2020 2020 7265 7475  :.          retu
+0000fbf0: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+0000fc00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000fc10: 7265 7475 726e 206e 702e 6469 6167 2873  return np.diag(s
+0000fc20: 656c 662e 6572 7232 290a 2020 0a20 2020  elf.err2).  .   
+0000fc30: 2064 6566 2067 6574 5f78 436f 7628 7365   def get_xCov(se
+0000fc40: 6c66 293a 0a20 2020 2020 2022 2222 7265  lf):.      """re
+0000fc50: 7475 726e 2063 6f76 6172 6961 6e63 6520  turn covariance 
+0000fc60: 6d61 7472 6978 206f 6620 782d 6461 7461  matrix of x-data
+0000fc70: 0a20 2020 2020 2022 2222 0a20 2020 2020  .      """.     
+0000fc80: 2069 6620 7365 6c66 2e6e 6565 6473 5f63   if self.needs_c
+0000fc90: 6f76 6172 6961 6e63 653a 0a20 2020 2020  ovariance:.     
+0000fca0: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
+0000fcb0: 6f76 780a 2020 2020 2020 656c 7365 3a0a  ovx.      else:.
+0000fcc0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000fcd0: 6572 7232 7820 6973 204e 6f6e 653a 0a20  err2x is None:. 
+0000fce0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000fcf0: 4e6f 6e65 0a20 2020 2020 2020 2065 6c73  None.        els
+0000fd00: 653a 0a20 2020 2020 2020 2020 2072 6574  e:.          ret
+0000fd10: 7572 6e20 6e70 2e64 6961 6728 7365 6c66  urn np.diag(self
+0000fd20: 2e65 7272 3278 290a 0a20 2020 2064 6566  .err2x)..    def
+0000fd30: 2067 6574 5f79 436f 7628 7365 6c66 293a   get_yCov(self):
+0000fd40: 0a20 2020 2020 2022 2222 7265 7475 726e  .      """return
+0000fd50: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
+0000fd60: 6978 206f 6620 792d 6461 7461 0a20 2020  ix of y-data.   
+0000fd70: 2020 2022 2222 0a20 2020 2020 2069 6620     """.      if 
+0000fd80: 7365 6c66 2e6e 6565 6473 5f63 6f76 6172  self.needs_covar
+0000fd90: 6961 6e63 653a 0a20 2020 2020 2020 2072  iance:.        r
+0000fda0: 6574 7572 6e20 7365 6c66 2e63 6f76 790a  eturn self.covy.
+0000fdb0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000fdc0: 2020 2020 6966 2073 656c 662e 6572 7232      if self.err2
+0000fdd0: 7920 6973 204e 6f6e 653a 0a20 2020 2020  y is None:.     
+0000fde0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0000fdf0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+0000fe00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000fe10: 6e70 2e64 6961 6728 7365 6c66 2e65 7272  np.diag(self.err
+0000fe20: 3279 290a 2020 2020 2020 0a20 2020 2064  2y).      .    d
+0000fe30: 6566 2067 6574 5f69 436f 7628 7365 6c66  ef get_iCov(self
+0000fe40: 293a 0a20 2020 2020 2022 2222 7265 7475  ):.      """retu
+0000fe50: 726e 2069 6e76 6572 7365 206f 6620 636f  rn inverse of co
+0000fe60: 7661 7269 616e 6365 206d 6174 7269 782c  variance matrix,
+0000fe70: 2061 7320 7573 6564 2069 6e20 636f 7374   as used in cost
+0000fe80: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+0000fe90: 2222 220a 2020 2020 2020 6966 2073 656c  """.      if sel
+0000fea0: 662e 6e65 6564 735f 636f 7661 7269 616e  f.needs_covarian
+0000feb0: 6365 3a0a 2020 2020 2020 2020 7265 7475  ce:.        retu
+0000fec0: 726e 2073 656c 662e 6943 6f76 0a20 2020  rn self.iCov.   
+0000fed0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000fee0: 2072 6574 7572 6e20 6e70 2e64 6961 6728   return np.diag(
+0000fef0: 312e 2f73 656c 662e 6572 7232 290a 0a20  1./self.err2).. 
+0000ff00: 2020 2064 6566 2070 6c6f 7428 7365 6c66     def plot(self
+0000ff10: 2c20 6e75 6d3d 2778 7944 6174 6120 616e  , num='xyData an
+0000ff20: 6420 4d6f 6465 6c27 2c0a 2020 2020 2020  d Model',.      
+0000ff30: 2020 2020 2020 2020 2020 2020 2066 6967               fig
+0000ff40: 7369 7a65 3d28 372e 352c 2036 2e35 292c  size=(7.5, 6.5),
+0000ff50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff60: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+0000ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff80: 2064 6174 615f 6c61 6265 6c3d 2764 6174   data_label='dat
+0000ff90: 6127 2c0a 2020 2020 2020 2020 2020 2020  a',.            
+0000ffa0: 2020 2020 2020 2070 6c6f 745f 7265 7369         plot_resi
+0000ffb0: 6475 616c 3d46 616c 7365 293a 0a20 2020  dual=False):.   
+0000ffc0: 2020 2022 2222 7265 7475 726e 2066 6967     """return fig
+0000ffd0: 7572 6520 7769 7468 2078 7920 6461 7461  ure with xy data
+0000ffe0: 2061 6e64 2075 6e63 6572 7461 696e 7469   and uncertainti
+0000fff0: 6573 0a20 2020 2020 2022 2222 0a23 2020  es.      """.#  
+00010000: 2020 2320 6765 7420 6461 7461 0a20 2020    # get data.   
+00010010: 2020 2078 203d 2073 656c 662e 780a 2020     x = self.x.  
+00010020: 2020 2020 6966 2070 6c6f 745f 7265 7369      if plot_resi
+00010030: 6475 616c 2061 6e64 2073 656c 662e 6d6f  dual and self.mo
+00010040: 6465 6c5f 7661 6c75 6573 2069 7320 6e6f  del_values is no
+00010050: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00010060: 7920 3d20 7365 6c66 2e79 202d 2073 656c  y = self.y - sel
+00010070: 662e 6d6f 6465 6c5f 7661 6c75 6573 0a20  f.model_values. 
+00010080: 2020 2020 2065 6c73 653a 2020 0a20 2020       else:  .   
+00010090: 2020 2020 2079 203d 2073 656c 662e 790a       y = self.y.
+000100a0: 2020 2020 2020 6579 203d 2073 656c 662e        ey = self.
+000100b0: 6765 745f 7943 6f76 2829 0a20 2020 2020  get_yCov().     
+000100c0: 2069 6620 6579 2e6e 6469 6d20 3d3d 2032   if ey.ndim == 2
+000100d0: 3a0a 2020 2020 2020 2020 6579 203d 206e  :.        ey = n
+000100e0: 702e 7371 7274 286e 702e 6469 6167 6f6e  p.sqrt(np.diagon
+000100f0: 616c 2865 7929 290a 2020 2020 2020 656c  al(ey)).      el
+00010100: 7365 3a0a 2020 2020 2020 2020 6579 203d  se:.        ey =
+00010110: 206e 702e 7371 7274 2865 7929 0a20 2020   np.sqrt(ey).   
+00010120: 2020 2065 7820 3d20 7365 6c66 2e67 6574     ex = self.get
+00010130: 5f78 436f 7628 290a 2020 2020 2020 6966  _xCov().      if
+00010140: 2065 7820 6973 206e 6f74 204e 6f6e 653a   ex is not None:
+00010150: 0a20 2020 2020 2020 2069 6620 6578 2e6e  .        if ex.n
+00010160: 6469 6d20 3d3d 323a 0a20 2020 2020 2020  dim ==2:.       
+00010170: 2020 2065 7820 3d20 6e70 2e73 7172 7428     ex = np.sqrt(
+00010180: 6e70 2e64 6961 676f 6e61 6c28 6578 2929  np.diagonal(ex))
+00010190: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+000101a0: 2020 2020 2020 2020 2065 7820 3d20 6e70           ex = np
+000101b0: 2e73 7172 7428 6578 290a 2020 2023 2064  .sqrt(ex).   # d
+000101c0: 7261 7720 6461 7461 0a20 2020 2020 2066  raw data.      f
+000101d0: 6967 203d 2070 6c74 2e66 6967 7572 6528  ig = plt.figure(
+000101e0: 6e75 6d3d 6e75 6d2c 2066 6967 7369 7a65  num=num, figsize
+000101f0: 3d66 6967 7369 7a65 290a 2020 2020 2020  =figsize).      
+00010200: 706c 742e 706c 6f74 2878 2c20 792c 206d  plt.plot(x, y, m
+00010210: 6172 6b65 723d 2778 272c 206c 696e 6573  arker='x', lines
+00010220: 7479 6c65 3d27 272c 2063 6f6c 6f72 3d27  tyle='', color='
+00010230: 6772 6579 272c 2061 6c70 6861 3d30 2e35  grey', alpha=0.5
+00010240: 290a 2020 2020 2020 6966 2065 7820 6973  ).      if ex is
+00010250: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00010260: 2020 2070 6c74 2e65 7272 6f72 6261 7228     plt.errorbar(
+00010270: 782c 2079 2c20 7865 7272 3d65 782c 2079  x, y, xerr=ex, y
+00010280: 6572 723d 6579 2c20 666d 743d 272e 272c  err=ey, fmt='.',
+00010290: 206c 6162 656c 3d64 6174 615f 6c61 6265   label=data_labe
+000102a0: 6c29 0a20 2020 2020 2065 6c73 653a 0a20  l).      else:. 
+000102b0: 2020 2020 2020 2070 6c74 2e65 7272 6f72         plt.error
+000102c0: 6261 7228 782c 2079 2c20 6579 2c20 666d  bar(x, y, ey, fm
+000102d0: 743d 222e 222c 206c 6162 656c 3d64 6174  t=".", label=dat
+000102e0: 615f 6c61 6265 6c29 0a20 2020 2020 2072  a_label).      r
+000102f0: 6574 7572 6e20 6669 670a 2020 2020 2020  eturn fig.      
+00010300: 0a20 2023 2064 6566 696e 6520 6375 7374  .  # define cust
+00010310: 6f6d 2063 6f73 7420 6675 6e63 7469 6f6e  om cost function
+00010320: 2066 6f72 2069 6d69 6e75 6974 0a20 2063   for iminuit.  c
+00010330: 6c61 7373 2078 4c53 7143 6f73 743a 0a20  lass xLSqCost:. 
+00010340: 2020 2022 2222 0a20 2020 2043 7573 746f     """.    Custo
+00010350: 6d20 655f 785f 7465 6e64 6564 204c 6561  m e_x_tended Lea
+00010360: 7374 2d53 5175 6172 6573 2063 6f73 7420  st-SQuares cost 
+00010370: 6675 6e63 7469 6f6e 2077 6974 6820 0a20  function with . 
+00010380: 2020 2064 796e 616d 6963 616c 6c79 2075     dynamically u
+00010390: 7064 6174 6564 2063 6f76 6172 6961 6e63  pdated covarianc
+000103a0: 6520 6d61 7472 6978 2061 6e64 202d 326c  e matrix and -2l
+000103b0: 6f67 284c 2920 0a20 2020 2063 6f72 7265  og(L) .    corre
+000103c0: 6374 696f 6e20 7465 726d 2066 6f72 2070  ction term for p
+000103d0: 6172 616d 6574 6572 2d64 6570 656e 6465  arameter-depende
+000103e0: 6e74 2075 6e63 6572 7461 696e 7469 6573  nt uncertainties
+000103f0: 2e0a 0a20 2020 2054 6865 2064 6566 6175  ...    The defau
+00010400: 6c74 2063 6f73 7420 6675 6e63 7469 6f6e  lt cost function
+00010410: 2069 7320 7477 6963 6520 7468 6520 6e65   is twice the ne
+00010420: 6761 7469 7665 206c 6f67 6172 6974 686d  gative logarithm
+00010430: 200a 2020 2020 6f66 2074 6865 206c 696b   .    of the lik
+00010440: 656c 6968 6f6f 6420 6f66 2061 2047 6175  elihood of a Gau
+00010450: 7373 6961 6e20 6469 7374 7269 6275 7469  ssian distributi
+00010460: 6f6e 2066 6f72 2064 6174 6120 706f 696e  on for data poin
+00010470: 7473 200a 2020 2020 3a6d 6174 683a 6028  ts .    :math:`(
+00010480: 782c 2079 2960 2077 6974 6820 6120 6d6f  x, y)` with a mo
+00010490: 6465 6c20 6675 6e63 7469 6f6e 203a 6d61  del function :ma
+000104a0: 7468 3a60 793d 6628 782c 202a 7029 6020  th:`y=f(x, *p)` 
+000104b0: 6465 7065 6e64 696e 670a 2020 2020 6f6e  depending.    on
+000104c0: 2061 2073 6574 206f 6620 7061 7261 6d65   a set of parame
+000104d0: 7465 7273 203a 6d61 7468 3a60 2a70 6020  ters :math:`*p` 
+000104e0: 616e 6420 6120 706f 7373 6962 6c79 2070  and a possibly p
+000104f0: 6172 616d 6574 6572 2d64 6570 656e 6465  arameter-depende
+00010500: 6e74 0a20 2020 2063 6f76 6172 6961 6e63  nt.    covarianc
+00010510: 6520 6d61 7472 6978 203a 6d61 7468 3a60  e matrix :math:`
+00010520: 5628 782c 2066 2878 2c20 2a70 2929 6020  V(x, f(x, *p))` 
+00010530: 6f66 2074 6865 2078 2061 6e64 2079 2064  of the x and y d
+00010540: 6174 613a 0a0a 2020 2020 2e2e 206d 6174  ata:..    .. mat
+00010550: 683a 3a20 0a20 2020 2020 202d 325c 6c6e  h:: .      -2\ln
+00010560: 207b 5c63 616c 204c 7d20 3d20 5c63 6869   {\cal L} = \chi
+00010570: 5e32 2879 2c20 565e 7b2d 317d 2c20 6628  ^2(y, V^{-1}, f(
+00010580: 782c 202a 7029 205c 2c29 200a 2020 2020  x, *p) \,) .    
+00010590: 2020 2b20 5c6c 6e28 5c2c 205c 6465 7428    + \ln(\, \det(
+000105a0: 2056 2878 2c20 6628 782c 202a 7029 2029   V(x, f(x, *p) )
+000105b0: 205c 2c29 0a0a 2020 2020 496e 2074 6865   \,)..    In the
+000105c0: 2061 6273 656e 6365 206f 6620 7061 7261   absence of para
+000105d0: 6d65 7465 722d 6465 7065 6e64 656e 7420  meter-dependent 
+000105e0: 636f 6d70 6f6e 656e 7473 206f 6620 7468  components of th
+000105f0: 6520 636f 7661 7269 616e 6365 0a20 2020  e covariance.   
+00010600: 206d 6174 7269 782c 2074 6865 206c 6173   matrix, the las
+00010610: 7420 7465 726d 2069 7320 6f6d 6974 7465  t term is omitte
+00010620: 6420 616e 6420 7468 6520 636f 7374 2066  d and the cost f
+00010630: 756e 6374 696f 6e20 6973 2069 6465 6e74  unction is ident
+00010640: 6963 616c 0a20 2020 2074 6f20 7468 6520  ical.    to the 
+00010650: 636c 6173 7369 6361 6c20 3a6d 6174 683a  classical :math:
+00010660: 605c 6368 695e 3260 2e20 0a20 2020 2046  `\chi^2`. .    F
+00010670: 6f72 2074 6865 2065 7661 6c75 6174 696f  or the evaluatio
+00010680: 6e20 6f66 2074 6865 2063 6f73 7420 6675  n of the cost fu
+00010690: 6e63 7469 6f6e 2061 6e20 6566 6669 6369  nction an effici
+000106a0: 656e 7420 6170 7072 6f61 6368 2062 6173  ent approach bas
+000106b0: 6564 0a20 2020 206f 6e20 7468 6520 2243  ed.    on the "C
+000106c0: 686f 6c65 736b 7920 6465 636f 6d70 6f73  holesky decompos
+000106d0: 6974 696f 6e22 206f 6620 7468 6520 636f  ition" of the co
+000106e0: 7661 7269 616e 6365 206d 6174 7269 7820  variance matrix 
+000106f0: 696e 200a 2020 2020 6120 7072 6f64 7563  in .    a produc
+00010700: 7420 6f66 2061 2074 7269 616e 6775 6c61  t of a triangula
+00010710: 7220 6d61 7472 6978 2061 6e64 2069 7473  r matrix and its
+00010720: 2074 7261 6e73 706f 7365 6420 6973 2075   transposed is u
+00010730: 7365 643a 0a0a 2020 2020 2e2e 206d 6174  sed:..    .. mat
+00010740: 683a 3a0a 2020 2020 2020 2056 203d 204c  h::.       V = L
+00010750: 204c 5e54 2e20 2020 200a 0a20 2020 2054   L^T.    ..    T
+00010760: 6865 2076 616c 7565 206f 6620 7468 6520  he value of the 
+00010770: 636f 7374 2066 756e 6374 696f 6e20 0a0a  cost function ..
+00010780: 2020 2020 2e2e 206d 6174 683a 3a0a 2020      .. math::.  
+00010790: 2020 2020 5c63 6869 5e32 203d 207b 727d      \chi^2 = {r}
+000107a0: 5c63 646f 7420 2856 5e7b 2d31 7d7b 727d  \cdot (V^{-1}{r}
+000107b0: 2920 7e7e 7769 7468 7e7e 2072 203d 2079  ) ~~with~~ r = y
+000107c0: 202d 2066 2878 2c2a 7029 0a0a 2020 2020   - f(x,*p)..    
+000107d0: 6973 2074 6865 6e20 6361 6c63 756c 6174  is then calculat
+000107e0: 6564 2062 7920 736f 6c76 696e 6720 7468  ed by solving th
+000107f0: 6520 6c69 6e65 6172 2065 7175 6174 696f  e linear equatio
+00010800: 6e20 200a 0a20 2020 2e2e 206d 6174 683a  n  ..   .. math:
+00010810: 3a0a 2020 2020 2020 5620 5820 3d20 722c  :.      V X = r,
+00010820: 207e 692e 652e 7e20 583d 565e 7b2d 317d   ~i.e.~ X=V^{-1}
+00010830: 2072 207e 616e 647e 205c 6368 695e 323d   r ~and~ \chi^2=
+00010840: 2072 205c 6364 6f74 2058 2020 200a 0a20   r \cdot X   .. 
+00010850: 2020 7769 7468 2074 6865 206c 696e 6561    with the linea
+00010860: 722d 6571 7561 7469 6f6e 2073 6f6c 7665  r-equation solve
+00010870: 7220 2a73 6369 7079 2e6c 696e 616c 672e  r *scipy.linalg.
+00010880: 6368 6f5f 736f 6c76 6528 4c2c 7829 2a0a  cho_solve(L,x)*.
+00010890: 2020 2066 6f72 2043 686f 6c65 736b 792d     for Cholesky-
+000108a0: 6465 636f 6d70 6f73 6564 206d 6174 7269  decomposed matri
+000108b0: 6365 732c 2074 6875 7320 6176 6f69 6469  ces, thus avoidi
+000108c0: 6e67 2074 6865 2063 6f73 7479 200a 2020  ng the costy .  
+000108d0: 2063 616c 6375 6c61 7469 6f6e 206f 6620   calculation of 
+000108e0: 7468 6520 696e 7665 7273 6520 6d61 7472  the inverse matr
+000108f0: 6978 2e0a 2020 2020 0a0a 2020 2054 6865  ix..    ..   The
+00010900: 2064 6574 6572 6d69 6e61 6e74 2c20 6966   determinant, if
+00010910: 206e 6565 6465 642c 2069 7320 6566 6669   needed, is effi
+00010920: 6369 656e 746c 7920 6361 6c63 756c 6174  ciently calculat
+00010930: 6564 2062 7920 7461 6b69 6e67 200a 2020  ed by taking .  
+00010940: 2074 6865 2070 726f 6475 6374 206f 6620   the product of 
+00010950: 7468 6520 6469 6167 6f6e 616c 2065 6c65  the diagonal ele
+00010960: 6d65 6e74 7320 6f66 2074 6865 206d 6174  ments of the mat
+00010970: 7269 7820 4c2c 0a0a 2020 2020 2e2e 206d  rix L,..    .. m
+00010980: 6174 683a 3a0a 2020 2020 2020 5c64 6574  ath::.      \det
+00010990: 2856 2920 3d20 3220 5c2c 205c 7072 6f64  (V) = 2 \, \prod
+000109a0: 204c 5f7b 692c 697d 0a20 2020 200a 2020   L_{i,i}.    .  
+000109b0: 2020 496e 7075 743a 0a0a 2020 2020 2d20    Input:..    - 
+000109c0: 6f75 7465 723a 2070 6f69 6e74 6572 2074  outer: pointer t
+000109d0: 6f20 696e 7374 616e 6365 206f 6620 6361  o instance of ca
+000109e0: 6c6c 696e 6720 636c 6173 730a 2020 2020  lling class.    
+000109f0: 2d20 6d6f 6465 6c3a 206d 6f64 656c 2066  - model: model f
+00010a00: 756e 6374 696f 6e20 6628 782c 205c 2a70  unction f(x, \*p
+00010a10: 6172 290a 2020 2020 2d20 7573 655f 6e65  ar).    - use_ne
+00010a20: 6732 6c6f 674c 3a20 7573 6520 6675 6c6c  g2logL: use full
+00010a30: 202d 326c 6f67 284c 2920 696e 7374 6561   -2log(L) instea
+00010a40: 6420 6f66 2063 6869 3220 6966 2054 7275  d of chi2 if Tru
+00010a50: 650a 0a20 2020 205f 5f63 616c 6c5f 5f20  e..    __call__ 
+00010a60: 6d65 7468 6f64 206f 6620 7468 6973 2063  method of this c
+00010a70: 6c61 7373 2069 7320 6361 6c6c 6564 2062  lass is called b
+00010a80: 7920 696d 696e 7569 740a 0a20 2020 2044  y iminuit..    D
+00010a90: 6174 6120 6d65 6d62 6572 733a 0a0a 2020  ata members:..  
+00010aa0: 2020 2d20 6e64 6f66 3a20 6465 6772 6565    - ndof: degree
+00010ab0: 7320 6f66 2066 7265 6564 6f6d 200a 2020  s of freedom .  
+00010ac0: 2020 2d20 6e63 6f6e 7374 7261 696e 7473    - nconstraints
+00010ad0: 3a20 6e75 6d62 6572 206f 6620 7061 7261  : number of para
+00010ae0: 6d65 7465 7220 636f 6e73 7472 6169 6e74  meter constraint
+00010af0: 730a 2020 2020 2d20 676f 663a 2063 6869  s.    - gof: chi
+00010b00: 322d 7661 6c75 6520 2867 6f6f 646e 6573  2-value (goodnes
+00010b10: 7320 6f66 2066 6974 290a 2020 2020 2d20  s of fit).    - 
+00010b20: 7573 655f 6e65 6732 6c6f 674c 3a20 7573  use_neg2logL: us
+00010b30: 6167 6520 6f66 2066 756c 6c20 322a 6e65  age of full 2*ne
+00010b40: 6720 4c6f 6720 4c69 6b65 6c69 686f 6f64  g Log Likelihood
+00010b50: 0a20 2020 202d 2071 7569 6574 3a20 6e6f  .    - quiet: no
+00010b60: 2070 7269 6e74 6f75 7420 6966 2054 7275   printout if Tru
+00010b70: 6520 2020 200a 0a20 2020 204d 6574 686f  e    ..    Metho
+00010b80: 6473 3a0a 0a20 2020 202d 206d 6f64 656c  ds:..    - model
+00010b90: 2878 2c20 5c2a 7061 7229 0a20 2020 2022  (x, \*par).    "
+00010ba0: 2222 0a20 0a20 2020 2064 6566 205f 5f69  "". .    def __i
+00010bb0: 6e69 745f 5f28 7365 6c66 2c20 6f75 7465  nit__(self, oute
+00010bc0: 722c 200a 2020 2020 2020 2020 2020 2020  r, .            
+00010bd0: 2020 2020 206d 6f64 656c 2c0a 2020 2020       model,.    
+00010be0: 2020 2020 2020 2020 2020 2020 2075 7365               use
+00010bf0: 5f6e 6567 326c 6f67 4c3d 4661 6c73 6529  _neg2logL=False)
+00010c00: 3a0a 0a20 2020 2020 2023 2064 6174 6120  :..      # data 
+00010c10: 6f62 6a65 6374 206f 6620 7479 7065 2078  object of type x
+00010c20: 7944 6174 6143 6f6e 7461 696e 6572 0a20  yDataContainer. 
+00010c30: 2020 2020 2073 656c 662e 6461 7461 203d       self.data =
+00010c40: 206f 7574 6572 2e64 6174 610a 2020 2020   outer.data.    
+00010c50: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+00010c60: 6e63 6528 7365 6c66 2e64 6174 612c 206d  nce(self.data, m
+00010c70: 6e46 6974 2e78 7944 6174 6143 6f6e 7461  nFit.xyDataConta
+00010c80: 696e 6572 293a 0a20 2020 2020 2020 2072  iner):.        r
+00010c90: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00010ca0: 0a20 2020 2020 2020 2020 2022 2021 2121  .          " !!!
+00010cb0: 206d 6e46 6974 2e78 4c53 7143 6f73 743a   mnFit.xLSqCost:
+00010cc0: 2065 7870 6563 7469 6e67 2064 6174 6120   expecting data 
+00010cd0: 636f 6e74 6169 6e65 7220 6f66 2074 7970  container of typ
+00010ce0: 6520 276d 6e46 6974 2e78 7944 6174 6143  e 'mnFit.xyDataC
+00010cf0: 6f6e 7461 696e 6572 2722 290a 2020 2020  ontainer'").    
+00010d00: 2020 7365 6c66 2e6d 6f64 656c 203d 206d    self.model = m
+00010d10: 6f64 656c 0a20 2020 2020 2073 656c 662e  odel.      self.
+00010d20: 7175 6965 7420 3d20 6f75 7465 722e 7175  quiet = outer.qu
+00010d30: 6965 740a 2020 2020 2020 2320 7573 6520  iet.      # use 
+00010d40: 2d32 202a 206c 6f67 284c 2920 6f66 2047  -2 * log(L) of G
+00010d50: 6175 7373 6961 6e20 696e 7374 6561 6420  aussian instead 
+00010d60: 6f66 2043 6869 320a 2020 2020 2020 2320  of Chi2.      # 
+00010d70: 2028 6f6e 6c79 2064 6966 6665 7265 6e74   (only different
+00010d80: 2066 726f 6d20 4368 6932 2066 6f72 2070   from Chi2 for p
+00010d90: 6172 616d 6574 6572 2d64 6570 656e 6465  arameter-depende
+00010da0: 6e74 2075 6e63 6572 7461 696e 7469 6573  nt uncertainties
+00010db0: 290a 2020 2020 2020 7365 6c66 2e75 7365  ).      self.use
+00010dc0: 5f6e 6567 326c 6f67 4c20 3d20 7573 655f  _neg2logL = use_
+00010dd0: 6e65 6732 6c6f 674c 0a20 2020 2020 200a  neg2logL.      .
+00010de0: 2020 2020 2020 2320 7365 7420 7072 6f70        # set prop
+00010df0: 6572 2073 6967 6e61 7475 7265 206f 6620  er signature of 
+00010e00: 6d6f 6465 6c20 6675 6e63 7469 6f6e 2066  model function f
+00010e10: 6f72 2069 6d69 6e75 6974 0a20 2020 2020  or iminuit.     
+00010e20: 2073 656c 662e 706e 616d 7320 3d20 6f75   self.pnams = ou
+00010e30: 7465 722e 706e 616d 730a 2020 2020 2020  ter.pnams.      
+00010e40: 7365 6c66 2e6e 7061 7220 3d20 6f75 7465  self.npar = oute
+00010e50: 722e 6e70 6172 0a20 2020 2020 200a 2020  r.npar.      .  
+00010e60: 2020 2020 2320 7461 6b65 2061 6363 6f75      # take accou
+00010e70: 6e74 206f 6620 636f 6e73 7472 6169 6e74  nt of constraint
+00010e80: 7320 0a20 2020 2020 2073 656c 662e 636f  s .      self.co
+00010e90: 6e73 7472 6169 6e74 7320 3d20 6f75 7465  nstraints = oute
+00010ea0: 722e 636f 6e73 7472 6169 6e74 730a 2020  r.constraints.  
+00010eb0: 2020 2020 7365 6c66 2e6e 636f 6e73 7472      self.nconstr
+00010ec0: 6169 6e74 7320 3d20 6c65 6e28 7365 6c66  aints = len(self
+00010ed0: 2e63 6f6e 7374 7261 696e 7473 290a 2020  .constraints).  
+00010ee0: 2020 2020 7365 6c66 2e6e 646f 6620 3d20      self.ndof = 
+00010ef0: 6c65 6e28 7365 6c66 2e64 6174 612e 7929  len(self.data.y)
+00010f00: 202d 2073 656c 662e 6e70 6172 202b 2073   - self.npar + s
+00010f10: 656c 662e 6e63 6f6e 7374 7261 696e 7473  elf.nconstraints
+00010f20: 202b 206f 7574 6572 2e6e 6669 7865 640a   + outer.nfixed.
+00010f30: 0a20 2020 2020 2023 2066 6c61 6720 746f  .      # flag to
+00010f40: 2063 6f6e 7472 6f6c 2066 696e 616c 2061   control final a
+00010f50: 6374 696f 6e73 2069 6e20 636f 7374 2066  ctions in cost f
+00010f60: 756e 6374 696f 6e0a 2020 2020 2020 7365  unction.      se
+00010f70: 6c66 2e66 696e 616c 5f63 616c 6c20 3d20  lf.final_call = 
+00010f80: 4661 6c73 650a 0a0a 2020 2020 6465 6620  False...    def 
+00010f90: 5f5f 6361 6c6c 5f5f 2873 656c 662c 202a  __call__(self, *
+00010fa0: 7061 7229 3a20 200a 2020 2020 2020 2320  par):  .      # 
+00010fb0: 6361 6c6c 6564 2069 7465 7261 7469 7665  called iterative
+00010fc0: 6c79 2062 7920 6d69 6e75 6974 0a0a 2020  ly by minuit..  
+00010fd0: 2020 2020 2320 636f 7374 2066 756e 6374      # cost funct
+00010fe0: 696f 6e20 6973 2065 7874 656e 6465 6420  ion is extended 
+00010ff0: 6368 6932 3a0a 2020 2020 2020 2320 2020  chi2:.      #   
+00011000: 6164 6420 6e6f 726d 616c 697a 6174 696f  add normalizatio
+00011010: 6e20 7465 726d 2069 6620 756e 6365 7274  n term if uncert
+00011020: 6169 6e74 6965 7320 6465 7065 6e64 206f  ainties depend o
+00011030: 6e20 6d6f 6465 6c20 0a0a 2020 2020 2020  n model ..      
+00011040: 6e6c 4c32 203d 2030 2e20 2320 696e 6974  nlL2 = 0. # init
+00011050: 6961 6c69 7a65 202d 322a 6c6e 284c 290a  ialize -2*ln(L).
+00011060: 2020 2020 2020 2320 2066 6972 7374 2c20        #  first, 
+00011070: 7461 6b65 2069 6e74 6f20 6163 636f 756e  take into accoun
+00011080: 7420 706f 7373 6962 6c65 2070 6172 616d  t possible param
+00011090: 6574 6572 2063 6f6e 7374 7261 696e 7473  eter constraints
+000110a0: 2020 0a20 2020 2020 2069 6620 7365 6c66    .      if self
+000110b0: 2e6e 636f 6e73 7472 6169 6e74 733a 0a20  .nconstraints:. 
+000110c0: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
+000110d0: 7365 6c66 2e63 6f6e 7374 7261 696e 7473  self.constraints
+000110e0: 3a0a 2020 2020 2020 2020 2020 705f 6964  :.          p_id
+000110f0: 203d 2063 5b30 5d0a 2020 2020 2020 2020   = c[0].        
+00011100: 2020 7220 3d20 2820 7061 725b 705f 6964    r = ( par[p_id
+00011110: 5d20 2d20 635b 315d 2920 2f20 635b 325d  ] - c[1]) / c[2]
+00011120: 200a 2020 2020 2020 2020 2020 6e6c 4c32   .          nlL2
+00011130: 202b 3d20 722a 720a 0a20 2020 2020 2023   += r*r..      #
+00011140: 2063 616c 6375 6c61 7465 2072 6573 6964   calculate resid
+00011150: 7561 6c20 6f66 2064 6174 6120 7772 742e  ual of data wrt.
+00011160: 206d 6f64 656c 0a20 2020 2020 206d 6f64   model.      mod
+00011170: 656c 5f76 616c 7565 7320 3d20 7365 6c66  el_values = self
+00011180: 2e6d 6f64 656c 2873 656c 662e 6461 7461  .model(self.data
+00011190: 2e78 2c20 2a70 6172 290a 2020 2020 2020  .x, *par).      
+000111a0: 5f72 203d 2073 656c 662e 6461 7461 2e79  _r = self.data.y
+000111b0: 202d 206d 6f64 656c 5f76 616c 7565 730a   - model_values.
+000111c0: 0a20 2020 2020 2069 6620 7365 6c66 2e64  .      if self.d
+000111d0: 6174 612e 6e65 6564 735f 636f 7661 7269  ata.needs_covari
+000111e0: 616e 6365 3a0a 2020 2020 2020 2020 2320  ance:.        # 
+000111f0: 2063 6865 636b 2069 6620 6d61 7472 6978   check if matrix
+00011200: 206e 6565 6473 2072 6562 7569 6c64 696e   needs rebuildin
+00011210: 670a 2020 2020 2020 2020 6966 206e 6f74  g.        if not
+00011220: 2073 656c 662e 6461 7461 2e6e 6565 6473   self.data.needs
+00011230: 5f64 796e 616d 6963 4572 726f 7273 3a0a  _dynamicErrors:.
+00011240: 2020 2020 2020 2020 2023 2073 7461 7469           # stati
+00011250: 6320 636f 7661 7269 616e 6365 2c20 7573  c covariance, us
+00011260: 6520 6974 7320 696e 7665 7273 650a 2020  e its inverse.  
+00011270: 2020 2020 2020 2020 6e6c 4c32 202b 3d20          nlL2 += 
+00011280: 666c 6f61 7428 6e70 2e69 6e6e 6572 286e  float(np.inner(n
+00011290: 702e 6d61 746d 756c 285f 722c 2073 656c  p.matmul(_r, sel
+000112a0: 662e 6461 7461 2e69 436f 7629 2c20 5f72  f.data.iCov), _r
+000112b0: 2929 0a20 2020 2020 2020 2020 2023 2069  )).          # i
+000112c0: 6465 6e74 6963 616c 2074 6f20 636c 6173  dentical to clas
+000112d0: 7369 6361 6c20 4368 6932 0a20 2020 2020  sical Chi2.     
+000112e0: 2020 2020 2073 656c 662e 676f 6620 3d20       self.gof = 
+000112f0: 6e6c 4c32 0a20 2020 2020 2020 2020 200a  nlL2.          .
+00011300: 2020 2020 2020 2020 656c 7365 3a20 2320          else: # 
+00011310: 6479 6e61 6d69 6361 6c6c 7920 7265 6275  dynamically rebu
+00011320: 696c 6420 636f 7661 7269 616e 6365 206d  ild covariance m
+00011330: 6174 7269 780a 2020 2020 2020 2020 2020  atrix.          
+00011340: 7365 6c66 2e64 6174 612e 5f72 6562 7569  self.data._rebui
+00011350: 6c64 5f43 6f76 2870 6172 290a 2020 2020  ld_Cov(par).    
+00011360: 2020 2020 2020 2320 7573 6520 4368 6f6c        # use Chol
+00011370: 6573 6b79 2064 6563 6f6d 706f 7369 746f  esky decomposito
+00011380: 6e20 746f 2063 6f6d 7075 7465 2063 6869  n to compute chi
+00011390: 3220 3d20 5f72 2e54 2028 565e 2d31 2920  2 = _r.T (V^-1) 
+000113a0: 5f72 200a 2020 2020 2020 2020 2020 4c2c  _r .          L,
+000113b0: 2069 735f 6c6f 7765 7220 3d20 6c69 6e61   is_lower = lina
+000113c0: 6c67 2e63 686f 5f66 6163 746f 7228 7365  lg.cho_factor(se
+000113d0: 6c66 2e64 6174 612e 636f 762c 2063 6865  lf.data.cov, che
+000113e0: 636b 5f66 696e 6974 653d 4661 6c73 6529  ck_finite=False)
+000113f0: 0a20 2020 2020 2020 2020 206e 6c4c 3220  .          nlL2 
+00011400: 2b3d 206e 702e 696e 6e65 7228 5f72 2c20  += np.inner(_r, 
+00011410: 6c69 6e61 6c67 2e63 686f 5f73 6f6c 7665  linalg.cho_solve
+00011420: 2828 4c2c 2069 735f 6c6f 7765 7229 2c20  ((L, is_lower), 
+00011430: 5f72 2920 290a 2020 2020 2020 2020 2020  _r) ).          
+00011440: 2320 7570 2074 6f20 6865 7265 2c20 6964  # up to here, id
+00011450: 656e 7469 6361 6c20 746f 2063 6c61 7373  entical to class
+00011460: 6963 616c 2043 6869 320a 2020 2020 2020  ical Chi2.      
+00011470: 2020 2020 7365 6c66 2e67 6f66 203d 206e      self.gof = n
+00011480: 6c4c 3220 2020 2020 2020 2020 2020 2020  lL2             
+00011490: 2020 2020 200a 2020 2020 2020 2020 2320       .        # 
+000114a0: 7461 6b65 2069 6e74 6f20 6163 636f 756e  take into accoun
+000114b0: 7420 7061 7261 6d65 7465 722d 6465 7065  t parameter-depe
+000114c0: 6e64 656e 7420 6e6f 726d 616c 6973 6174  ndent normalisat
+000114d0: 696f 6e20 7465 726d 0a20 2020 2020 2020  ion term.       
+000114e0: 2020 2069 6620 7365 6c66 2e75 7365 5f6e     if self.use_n
+000114f0: 6567 326c 6f67 4c3a 0a20 2020 2020 2020  eg2logL:.       
+00011500: 2020 2320 2066 6173 7420 6361 6c63 756c    #  fast calcul
+00011510: 6174 696f 6e20 6f66 2064 6574 6572 6d69  ation of determi
+00011520: 6e61 6e74 2064 6574 2856 2920 6672 6f6d  nant det(V) from
+00011530: 2043 686f 6c65 736b 7920 6661 6374 6f72   Cholesky factor
+00011540: 200a 2020 2020 2020 2020 2020 2020 6e6c   .            nl
+00011550: 4c32 202b 3d20 322e 2a6e 702e 7375 6d28  L2 += 2.*np.sum(
+00011560: 6e70 2e6c 6f67 286e 702e 6469 6167 6f6e  np.log(np.diagon
+00011570: 616c 284c 2920 2920 290a 0a20 2020 2020  al(L) ) )..     
+00011580: 2065 6c73 653a 2020 2320 6661 7374 2063   else:  # fast c
+00011590: 616c 6375 6c61 7469 6f6e 2066 6f72 2073  alculation for s
+000115a0: 696d 706c 6520 6572 726f 7273 0a20 2020  imple errors.   
+000115b0: 2020 2020 2023 2063 6865 636b 2069 6620       # check if 
+000115c0: 6572 726f 7273 206e 6565 6473 2072 6563  errors needs rec
+000115d0: 616c 6375 6c61 7469 6e67 0a20 2020 2020  alculating.     
+000115e0: 2020 2069 6620 7365 6c66 2e64 6174 612e     if self.data.
+000115f0: 6e65 6564 735f 6479 6e61 6d69 6345 7272  needs_dynamicErr
+00011600: 6f72 733a 0a20 2020 2020 2020 2020 2073  ors:.          s
+00011610: 656c 662e 6461 7461 2e5f 7265 6275 696c  elf.data._rebuil
+00011620: 645f 4572 7232 2870 6172 290a 2020 2020  d_Err2(par).    
+00011630: 2020 2020 2020 6e6c 4c32 202b 3d20 6e70        nlL2 += np
+00011640: 2e73 756d 285f 7220 2a20 5f72 202f 2073  .sum(_r * _r / s
+00011650: 656c 662e 6461 7461 2e65 7272 3229 0a20  elf.data.err2). 
+00011660: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00011670: 2020 2020 2020 206e 6c4c 3220 2b3d 206e         nlL2 += n
+00011680: 702e 7375 6d28 5f72 202a 205f 7220 2a20  p.sum(_r * _r * 
+00011690: 7365 6c66 2e64 6174 612e 6945 7272 3229  self.data.iErr2)
+000116a0: 0a0a 2020 2020 2020 2020 2320 7468 6973  ..        # this
+000116b0: 2069 7320 6964 656e 7469 6361 6c20 746f   is identical to
+000116c0: 2063 6c61 7373 6963 616c 2043 6869 320a   classical Chi2.
+000116d0: 2020 2020 2020 2020 7365 6c66 2e67 6f66          self.gof
+000116e0: 203d 206e 6c4c 320a 2020 2020 2020 2020   = nlL2.        
+000116f0: 0a20 2020 2020 2020 2023 2061 6464 2070  .        # add p
+00011700: 6172 616d 6574 6572 2d64 6570 656e 6465  arameter-depende
+00011710: 6e74 206e 6f72 6d61 6c69 7a61 7469 6f6e  nt normalization
+00011720: 2074 6572 6d20 6966 206e 6565 6465 6420   term if needed 
+00011730: 616e 6420 7761 6e74 6564 0a20 2020 2020  and wanted.     
+00011740: 2020 2069 6620 7365 6c66 2e64 6174 612e     if self.data.
+00011750: 6e65 6564 735f 6479 6e61 6d69 6345 7272  needs_dynamicErr
+00011760: 6f72 7320 616e 6420 7365 6c66 2e75 7365  ors and self.use
+00011770: 5f6e 6567 326c 6f67 4c3a 0a20 2020 2020  _neg2logL:.     
+00011780: 2020 2020 206e 6c4c 3220 2b3d 206e 702e       nlL2 += np.
+00011790: 7375 6d28 6e70 2e6c 6f67 2873 656c 662e  sum(np.log(self.
+000117a0: 6461 7461 2e65 7272 3229 290a 0a20 2020  data.err2))..   
+000117b0: 2020 2023 2070 726f 7669 6465 206d 6f64     # provide mod
+000117c0: 656c 2076 616c 7565 7320 746f 2064 6174  el values to dat
+000117d0: 6120 6f62 6a65 6374 0a20 2020 2020 2073  a object.      s
+000117e0: 656c 662e 6461 7461 2e6d 6f64 656c 5f76  elf.data.model_v
+000117f0: 616c 7565 7320 3d20 6d6f 6465 6c5f 7661  alues = model_va
+00011800: 6c75 6573 2020 2020 2020 200a 0a20 2020  lues       ..   
+00011810: 2020 2072 6574 7572 6e20 6e6c 4c32 0a20     return nlL2. 
+00011820: 2020 200a 2020 2320 2d2d 2d20 656e 6420     .  # --- end 
+00011830: 6465 6669 6e69 7469 6f6e 206f 6620 636c  definition of cl
+00011840: 6173 7320 784c 5371 436f 7374 202d 2d2d  ass xLSqCost ---
+00011850: 2d0a 0a20 2023 0a20 2023 202d 2d2d 2073  -..  #.  # --- s
+00011860: 7065 6369 616c 2063 6f64 6520 666f 7220  pecial code for 
+00011870: 696e 6465 7865 6420 4669 7420 2878 4669  indexed Fit (xFi
+00011880: 7429 0a20 2023 2020 2020 2020 0a0a 2020  t).  #      ..  
+00011890: 6465 6620 7365 745f 784f 7074 696f 6e73  def set_xOptions
+000118a0: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
+000118b0: 2020 2020 2072 656c 6174 6976 655f 7265       relative_re
+000118c0: 6665 7273 5f74 6f5f 6d6f 6465 6c3d 4e6f  fers_to_model=No
+000118d0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+000118e0: 2020 7275 6e5f 6d69 6e6f 733d 4e6f 6e65    run_minos=None
+000118f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00011900: 7573 655f 6e65 674c 6f67 4c3d 4e6f 6e65  use_negLogL=None
+00011910: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00011920: 7175 6965 743d 4e6f 6e65 293a 0a0a 2020  quiet=None):..  
+00011930: 2020 2222 2244 6566 696e 6520 6f70 7469    """Define opti
+00011940: 6f6e 7320 666f 7220 696e 6465 7865 6420  ons for indexed 
+00011950: 6669 740a 0a20 2020 2020 2020 4172 6773  fit..       Args
+00011960: 3a0a 2020 2020 2020 2020 2d20 7265 6c2e  :.        - rel.
+00011970: 2065 7272 6f72 7320 7265 6665 7220 746f   errors refer to
+00011980: 206d 6f64 656c 2065 6c73 6520 6461 7461   model else data
+00011990: 0a20 2020 2020 2020 202d 2072 756e 206d  .        - run m
+000119a0: 696e 6f73 2065 6c73 6520 646f 6e2a 7420  inos else don*t 
+000119b0: 7275 6e20 6d69 6e6f 730a 2020 2020 2020  run minos.      
+000119c0: 2020 2d20 7573 6520 6675 6c6c 206e 6567    - use full neg
+000119d0: 326c 6f67 4c0a 2020 2020 2020 2020 2d20  2logL.        - 
+000119e0: 646f 6e2a 7420 7072 6f76 6964 6520 7072  don*t provide pr
+000119f0: 696e 746f 7574 2065 6c73 6520 7665 7262  intout else verb
+00011a00: 6f73 6520 7072 696e 746f 7574 200a 2020  ose printout .  
+00011a10: 2020 2222 220a 2020 2020 6966 2072 656c    """.    if rel
+00011a20: 6174 6976 655f 7265 6665 7273 5f74 6f5f  ative_refers_to_
+00011a30: 6d6f 6465 6c20 6973 206e 6f74 204e 6f6e  model is not Non
+00011a40: 653a 0a20 2020 2020 2073 656c 662e 7265  e:.      self.re
+00011a50: 664d 6f64 656c 203d 2072 656c 6174 6976  fModel = relativ
+00011a60: 655f 7265 6665 7273 5f74 6f5f 6d6f 6465  e_refers_to_mode
+00011a70: 6c0a 2020 2020 2020 7365 6c66 2e6f 7074  l.      self.opt
+00011a80: 696f 6e73 5b22 7265 664d 6f64 656c 225d  ions["refModel"]
+00011a90: 5b30 5d20 3d20 696e 7428 7265 6c61 7469  [0] = int(relati
+00011aa0: 7665 5f72 6566 6572 735f 746f 5f6d 6f64  ve_refers_to_mod
+00011ab0: 656c 290a 2020 2020 6966 2072 756e 5f6d  el).    if run_m
+00011ac0: 696e 6f73 2069 7320 6e6f 7420 4e6f 6e65  inos is not None
+00011ad0: 3a20 2020 0a20 2020 2020 2073 656c 662e  :   .      self.
+00011ae0: 7275 6e5f 6d69 6e6f 7320 3d20 7275 6e5f  run_minos = run_
+00011af0: 6d69 6e6f 730a 2020 2020 2020 7365 6c66  minos.      self
+00011b00: 2e6f 7074 696f 6e73 5b22 7275 6e5f 6d69  .options["run_mi
+00011b10: 6e6f 7322 5d5b 305d 203d 2069 6e74 2872  nos"][0] = int(r
+00011b20: 756e 5f6d 696e 6f73 290a 2020 2020 6966  un_minos).    if
+00011b30: 2075 7365 5f6e 6567 4c6f 674c 2069 7320   use_negLogL is 
+00011b40: 6e6f 7420 4e6f 6e65 3a20 2020 0a20 2020  not None:   .   
+00011b50: 2020 2073 656c 662e 7573 655f 6e65 674c     self.use_negL
+00011b60: 6f67 4c20 3d20 7573 655f 6e65 674c 6f67  ogL = use_negLog
+00011b70: 4c0a 2020 2020 2020 7365 6c66 2e6f 7074  L.      self.opt
+00011b80: 696f 6e73 5b22 7573 655f 6e65 674c 6f67  ions["use_negLog
+00011b90: 4c22 5d5b 305d 203d 2069 6e74 2875 7365  L"][0] = int(use
+00011ba0: 5f6e 6567 4c6f 674c 290a 2020 2020 6966  _negLogL).    if
+00011bb0: 2071 7569 6574 2069 7320 6e6f 7420 4e6f   quiet is not No
+00011bc0: 6e65 3a0a 2020 2020 2020 7365 6c66 2e71  ne:.      self.q
+00011bd0: 7569 6574 203d 2071 7569 6574 0a0a 2020  uiet = quiet..  
+00011be0: 6465 6620 696e 6974 5f78 4461 7461 2873  def init_xData(s
+00011bf0: 656c 662c 2078 2c20 2020 2020 2020 2020  elf, x,         
+00011c00: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+00011c10: 2020 2020 2020 653d 4e6f 6e65 2c20 0a20        e=None, . 
+00011c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c30: 6572 656c 3d4e 6f6e 652c 0a20 2020 2020  erel=None,.     
+00011c40: 2020 2020 2020 2020 2020 2020 6361 6273              cabs
+00011c50: 3d4e 6f6e 652c 2063 7265 6c3d 4e6f 6e65  =None, crel=None
+00011c60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00011c70: 2020 206e 616d 6573 3d4e 6f6e 6529 3a0a     names=None):.
+00011c80: 0a20 2020 2022 2222 696e 6974 6961 6c69  .    """initiali
+00011c90: 7a65 2064 6174 6120 6f62 6a65 6374 0a0a  ze data object..
+00011ca0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00011cb0: 2d20 2078 3a20 2020 2020 2064 6174 6120  -  x:      data 
+00011cc0: 7661 6c75 6573 0a20 2020 2020 202d 2020  values.      -  
+00011cd0: 733a 2020 2020 2020 696e 6465 7065 6e64  s:      independ
+00011ce0: 656e 7420 756e 6365 7274 6169 6e74 6965  ent uncertaintie
+00011cf0: 7320 780a 2020 2020 2020 2d20 2073 7265  s x.      -  sre
+00011d00: 6c3a 2020 2069 6e64 6570 656e 6465 6e74  l:   independent
+00011d10: 2072 656c 6174 6976 6520 756e 6365 7274   relative uncert
+00011d20: 6169 6e74 6965 7320 780a 2020 2020 2020  ainties x.      
+00011d30: 2d20 2063 6162 733a 2020 2063 6f72 7265  -  cabs:   corre
+00011d40: 6c61 7465 6420 6162 6f6c 7574 6520 756e  lated abolute un
+00011d50: 6365 7274 6169 6e74 6965 7320 780a 2020  certainties x.  
+00011d60: 2020 2020 2d20 2063 7265 6c3a 2020 2063      -  crel:   c
+00011d70: 6f72 7265 6c61 7465 6420 7265 6c61 7469  orrelated relati
+00011d80: 7665 2075 6e63 6572 7461 696e 7469 6573  ve uncertainties
+00011d90: 2078 0a20 2020 2022 2222 0a20 2020 200a   x.    """.    .
+00011da0: 2020 2020 2320 6372 6561 7465 2064 6174      # create dat
+00011db0: 6120 6f62 6a65 6374 2061 6e64 2070 6173  a object and pas
+00011dc0: 7320 616c 6c20 696e 7075 7420 6172 6775  s all input argu
+00011dd0: 6d65 6e74 730a 2020 2020 7365 6c66 2e78  ments.    self.x
+00011de0: 4461 7461 203d 2073 656c 662e 7844 6174  Data = self.xDat
+00011df0: 6143 6f6e 7461 696e 6572 2873 656c 662c  aContainer(self,
+00011e00: 2078 2c20 652c 200a 2020 2020 2020 2020   x, e, .        
+00011e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e20: 2020 2020 2020 2020 2020 2020 2065 7265               ere
+00011e30: 6c2c 2063 6162 732c 2063 7265 6c2c 0a20  l, cabs, crel,. 
+00011e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e60: 2020 2020 6e61 6d65 7320 3d20 6e61 6d65      names = name
+00011e70: 732c 200a 2020 2020 2020 2020 2020 2020  s, .            
+00011e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e90: 2020 2020 2020 2020 2071 7569 6574 3d73           quiet=s
+00011ea0: 656c 662e 7175 6965 7429 0a20 2020 2073  elf.quiet).    s
+00011eb0: 656c 662e 6461 7461 203d 2073 656c 662e  elf.data = self.
+00011ec0: 7844 6174 610a 2020 2020 2320 7365 7420  xData.    # set 
+00011ed0: 666c 6167 7320 666f 7220 7374 6565 7269  flags for steeri
+00011ee0: 6e67 206f 6620 6669 7420 7072 6f63 6573  ng of fit proces
+00011ef0: 7320 696e 2064 6f5f 6669 7428 290a 2020  s in do_fit().  
+00011f00: 2020 7365 6c66 2e69 7465 7261 7465 4669    self.iterateFi
+00011f10: 7420 3d20 7365 6c66 2e78 4461 7461 2e68  t = self.xData.h
+00011f20: 6173 5f72 656c 5f45 7272 6f72 7320 616e  as_rel_Errors an
+00011f30: 6420 7365 6c66 2e72 6566 4d6f 6465 6c0a  d self.refModel.
+00011f40: 0a0a 2020 6465 6620 696e 6974 5f78 4669  ..  def init_xFi
+00011f50: 7428 7365 6c66 2c20 6d6f 6465 6c2c 206d  t(self, model, m
+00011f60: 6f64 656c 5f6b 7761 7267 733d 4e6f 6e65  odel_kwargs=None
+00011f70: 2c20 7030 3d4e 6f6e 652c 2064 7030 3d4e  , p0=None, dp0=N
+00011f80: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00011f90: 2020 2020 2020 636f 6e73 7472 6169 6e74        constraint
+00011fa0: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+00011fb0: 2020 2020 2020 2020 2066 6978 5061 7273           fixPars
+00011fc0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+00011fd0: 2020 2020 2020 2020 6c69 6d69 7473 3d4e          limits=N
+00011fe0: 6f6e 6529 3a0a 2020 2020 2222 2269 6e69  one):.    """ini
+00011ff0: 7469 616c 697a 6520 6669 7420 6f62 6a65  tialize fit obje
+00012000: 6374 0a0a 2020 2020 4172 6773 3a0a 2020  ct..    Args:.  
+00012010: 2020 2020 2d20 6d6f 6465 6c3a 206d 6f64      - model: mod
+00012020: 656c 2066 756e 6374 696f 6e20 6628 783b  el function f(x;
+00012030: 205c 2a70 6172 290a 2020 2020 2020 2d20   \*par).      - 
+00012040: 6d6f 6465 6c5f 6b77 6172 6773 3a20 6f70  model_kwargs: op
+00012050: 7469 6f6e 616c 2c20 6669 7420 7061 7261  tional, fit para
+00012060: 6d65 7465 7273 2069 6620 6e6f 7420 6672  meters if not fr
+00012070: 6f6d 206d 6f64 656c 2073 6967 6e61 7475  om model signatu
+00012080: 7265 200a 2020 2020 2020 2d20 7030 3a20  re .      - p0: 
+00012090: 6e70 2d61 7272 6179 206f 6620 666c 6f61  np-array of floa
+000120a0: 7473 2c20 696e 6974 6961 6c20 7061 7261  ts, initial para
+000120b0: 6d65 7465 7220 7661 6c75 6573 200a 2020  meter values .  
+000120c0: 2020 2020 2d20 6470 303a 2061 7272 6179      - dp0: array
+000120d0: 2d6c 696b 652c 2069 6e69 7469 616c 2067  -like, initial g
+000120e0: 7565 7373 206f 6620 7061 7261 6d65 7465  uess of paramete
+000120f0: 7220 756e 6365 7274 6169 6e74 6965 7320  r uncertainties 
+00012100: 286f 7074 696f 6e61 6c29 0a20 2020 2020  (optional).     
+00012110: 202d 2063 6f6e 7374 7261 696e 7473 3a20   - constraints: 
+00012120: 286e 6573 7465 6429 206c 6973 7428 7329  (nested) list(s)
+00012130: 3a20 5b70 6172 616d 6574 6572 206e 616d  : [parameter nam
+00012140: 652c 2076 616c 7565 2c20 756e 6365 7274  e, value, uncert
+00012150: 6169 6e74 795d 200a 2020 2020 2020 2020  ainty] .        
+00012160: 6f72 205b 7061 7261 6d65 7465 7220 696e  or [parameter in
+00012170: 6465 782c 2076 616c 7565 2c20 756e 6365  dex, value, unce
+00012180: 7274 6169 6e74 795d 0a20 2020 2020 202d  rtainty].      -
+00012190: 206c 696d 6974 733a 2028 6e65 7374 6564   limits: (nested
+000121a0: 2920 6c69 7374 2873 293a 205b 7061 7261  ) list(s): [para
+000121b0: 6d65 7465 7220 6e61 6d65 2c20 6d69 6e2c  meter name, min,
+000121c0: 206d 6178 5d20 0a20 2020 2020 2020 206f   max] .        o
+000121d0: 7220 5b70 6172 616d 6574 6572 2069 6e64  r [parameter ind
+000121e0: 6578 2c20 6d69 6e2c 206d 6178 5d0a 2020  ex, min, max].  
+000121f0: 2020 2222 220a 0a20 2020 2069 6620 7365    """..    if se
+00012200: 6c66 2e78 4461 7461 2069 7320 4e6f 6e65  lf.xData is None
+00012210: 3a20 0a20 2020 2020 2072 6169 7365 2056  : .      raise V
+00012220: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+00012230: 2020 2027 2021 2121 206d 6e46 6974 2e69     ' !!! mnFit.i
+00012240: 6e69 745f 7846 6974 3a20 6e6f 2064 6174  nit_xFit: no dat
+00012250: 6120 6f62 6a65 6374 2064 6566 696e 6564  a object defined
+00012260: 202d 2063 616c 6c20 696e 6974 5f64 6174   - call init_dat
+00012270: 6128 2927 290a 0a20 2020 2023 2067 6574  a()')..    # get
+00012280: 2070 6172 616d 6574 6572 7320 6f66 206d   parameters of m
+00012290: 6f64 656c 2066 756e 6374 696f 6e20 746f  odel function to
+000122a0: 2073 6574 2073 7461 7274 2076 616c 7565   set start value
+000122b0: 7320 666f 7220 6669 740a 2020 2020 6966  s for fit.    if
+000122c0: 206d 6f64 656c 5f6b 7761 7267 7320 6973   model_kwargs is
+000122d0: 204e 6f6e 653a 0a20 2020 2020 2061 7267   None:.      arg
+000122e0: 732c 206d 6f64 656c 5f6b 7761 7267 7320  s, model_kwargs 
+000122f0: 3d20 6765 745f 6675 6e63 7469 6f6e 5369  = get_functionSi
+00012300: 676e 6174 7572 6528 6d6f 6465 6c29 0a0a  gnature(model)..
+00012310: 2020 2020 7061 7220 3d20 286d 6f64 656c      par = (model
+00012320: 5f6b 7761 7267 732c 2070 302c 2064 7030  _kwargs, p0, dp0
+00012330: 2c20 636f 6e73 7472 6169 6e74 732c 2066  , constraints, f
+00012340: 6978 5061 7273 2c20 6c69 6d69 7473 290a  ixPars, limits).
+00012350: 2020 2020 7365 6c66 2e5f 7365 7475 7046      self._setupF
+00012360: 6974 5061 7261 6d65 7465 7273 282a 7061  itParameters(*pa
+00012370: 7229 200a 0a20 2020 2023 2063 7265 6174  r) ..    # creat
+00012380: 6520 636f 7374 2066 756e 6374 696f 6e0a  e cost function.
+00012390: 2020 2020 7365 6c66 2e63 6f73 7466 203d      self.costf =
+000123a0: 2073 656c 662e 696e 6465 7865 6443 6f73   self.indexedCos
+000123b0: 7428 7365 6c66 2c0a 2020 2020 2020 2020  t(self,.        
+000123c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123d0: 2020 206d 6f64 656c 2c0a 2020 2020 2020     model,.      
+000123e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123f0: 2020 2020 2075 7365 5f6e 6567 326c 6f67       use_neg2log
+00012400: 4c3d 2073 656c 662e 7573 655f 6e65 674c  L= self.use_negL
+00012410: 6f67 4c29 0a20 2020 2073 656c 662e 5f73  ogL).    self._s
+00012420: 6574 7570 4d69 6e75 6974 286d 6f64 656c  etupMinuit(model
+00012430: 5f6b 7761 7267 7329 200a 0a20 2020 2020  _kwargs) ..     
+00012440: 200a 2020 636c 6173 7320 7844 6174 6143   .  class xDataC
+00012450: 6f6e 7461 696e 6572 3a0a 2020 2020 2222  ontainer:.    ""
+00012460: 220a 2020 2020 4861 6e64 6c65 2064 6174  ".    Handle dat
+00012470: 6120 616e 6420 756e 6365 7274 6169 6e74  a and uncertaint
+00012480: 6965 7320 616e 6420 200a 2020 2020 6275  ies and  .    bu
+00012490: 696c 6420 636f 7661 7269 616e 6365 206d  ild covariance m
+000124a0: 6174 7269 6365 7320 6672 6f6d 2063 6f6d  atrices from com
+000124b0: 706f 6e65 6e74 730a 0a20 2020 2041 7267  ponents..    Arg
+000124c0: 733a 0a20 2020 2020 202d 206f 7574 6572  s:.      - outer
+000124d0: 3a20 2020 706f 696e 7465 7220 746f 2069  :   pointer to i
+000124e0: 6e73 7461 6e63 6520 6f66 2063 616c 6c69  nstance of calli
+000124f0: 6e67 206f 626a 6563 740a 2020 2020 2020  ng object.      
+00012500: 2d20 783a 2020 2020 2020 2061 6273 6369  - x:       absci
+00012510: 7373 6120 6f66 2064 6174 6120 706f 696e  ssa of data poin
+00012520: 7473 2028 2278 2076 616c 7565 7322 290a  ts ("x values").
+00012530: 2020 2020 2020 2d20 653a 2020 2020 2020        - e:      
+00012540: 2069 6e64 6570 656e 6465 6e74 2075 6e63   independent unc
+00012550: 6572 7461 696e 7469 6573 200a 2020 2020  ertainties .    
+00012560: 2020 2d20 6572 656c 3a20 2020 696e 6465    - erel:   inde
+00012570: 7065 6e64 656e 7420 7265 6c61 7469 7665  pendent relative
+00012580: 2075 6e63 6572 7461 696e 7469 6573 2078   uncertainties x
+00012590: 0a20 2020 2020 202d 2063 6162 733a 2020  .      - cabs:  
+000125a0: 2063 6f72 7265 6c61 7465 6420 6162 6f6c   correlated abol
+000125b0: 7574 6520 756e 6365 7274 6169 6e74 6965  ute uncertaintie
+000125c0: 7320 780a 2020 2020 2020 2d20 6372 656c  s x.      - crel
+000125d0: 3a20 2020 636f 7272 656c 6174 6564 2072  :   correlated r
+000125e0: 656c 6174 6976 6520 756e 6365 7274 6169  elative uncertai
+000125f0: 6e74 6965 7320 780a 2020 2020 2020 2d20  nties x.      - 
+00012600: 7175 6965 743a 2020 206e 6f20 696e 666f  quiet:   no info
+00012610: 726d 6174 6976 6520 7072 696e 746f 7574  rmative printout
+00012620: 2069 6620 5472 7565 0a0a 2020 2020 5075   if True..    Pu
+00012630: 626c 6963 206d 6574 686f 6473 3a0a 2020  blic methods:.  
+00012640: 2020 2020 2d20 696e 6974 5f64 796e 616d      - init_dynam
+00012650: 6963 4572 726f 7273 2829 3a0a 2020 2020  icErrors():.    
+00012660: 2020 2d20 6765 745f 436f 7628 293a 2066    - get_Cov(): f
+00012670: 696e 616c 2063 6f76 6172 6961 6e63 6520  inal covariance 
+00012680: 6d61 7472 6978 2028 696e 636c 2e20 7072  matrix (incl. pr
+00012690: 6f6a 2e20 7829 2020 0a20 2020 2020 202d  oj. x)  .      -
+000126a0: 2067 6574 5f69 436f 7628 293a 2069 6e76   get_iCov(): inv
+000126b0: 6572 7365 2063 6f76 6172 6961 6e63 6520  erse covariance 
+000126c0: 6d61 7472 6978 0a20 2020 2020 202d 2070  matrix.      - p
+000126d0: 6c6f 7428 293a 2070 726f 7669 6465 2061  lot(): provide a
+000126e0: 2066 6967 7572 6520 7769 7468 2072 6570   figure with rep
+000126f0: 7265 7365 6e74 6174 696f 6e20 6f66 2064  resentation of d
+00012700: 6174 610a 200a 2020 2020 4461 7461 206d  ata. .    Data m
+00012710: 656d 6265 7273 3a20 200a 2020 2020 2020  embers:  .      
+00012720: 2a20 636f 7079 206f 6620 616c 6c20 696e  * copy of all in
+00012730: 7075 7420 6172 6775 6d65 6e74 730a 2020  put arguments.  
+00012740: 2020 2020 2a20 636f 763a 2063 6f76 6172      * cov: covar
+00012750: 6961 6e63 6520 6d61 7472 6978 0a20 2020  iance matrix.   
+00012760: 2020 202a 2069 436f 763a 2069 6e76 6572     * iCov: inver
+00012770: 7365 206f 6620 636f 7661 7269 616e 6365  se of covariance
+00012780: 206d 6174 7269 780a 2020 2020 2222 220a   matrix.    """.
+00012790: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+000127a0: 2873 656c 662c 206f 7574 6572 2c0a 2020  (self, outer,.  
+000127b0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+000127c0: 2c20 652c 2065 7265 6c2c 2063 6162 732c  , e, erel, cabs,
+000127d0: 2063 7265 6c2c 0a20 2020 2020 2020 2020   crel,.         
+000127e0: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
+000127f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+00012800: 2020 2020 2020 2071 7569 6574 3d54 7275         quiet=Tru
+00012810: 6529 3a0a 2020 2020 2020 2320 7361 7665  e):.      # save
+00012820: 2070 6f69 6e65 7220 746f 2063 616c 6c69   poiner to calli
+00012830: 6e67 2063 6c61 7373 0a20 2020 2020 2073  ng class.      s
+00012840: 656c 662e 6f75 7465 7220 3d20 6f75 7465  elf.outer = oute
+00012850: 720a 0a20 2020 2020 2023 2061 7373 756d  r..      # assum
+00012860: 6520 7369 6d70 6c65 2063 6173 6520 772e  e simple case w.
+00012870: 6f2e 2063 6f76 2e6d 6174 2e0a 2020 2020  o. cov.mat..    
+00012880: 2020 7365 6c66 2e6e 6565 6473 5f63 6f76    self.needs_cov
+00012890: 6172 6961 6e63 6520 3d20 4661 6c73 6520  ariance = False 
+000128a0: 0a0a 2020 2020 2020 7365 6c66 2e78 4e61  ..      self.xNa
+000128b0: 6d65 7320 3d20 6e61 6d65 7320 2320 7365  mes = names # se
+000128c0: 7420 7061 7261 6d65 7465 7220 6e61 6d65  t parameter name
+000128d0: 730a 2020 2020 2020 0a20 2020 2020 206e  s.      .      n
+000128e0: 6420 3d20 6c65 6e28 7829 0a20 2020 2020  d = len(x).     
+000128f0: 2023 2073 746f 7265 2069 6e70 7574 2064   # store input d
+00012900: 6174 6120 6173 206e 756d 7079 2066 6c6f  ata as numpy flo
+00012910: 6174 2061 7272 6179 732c 2065 6e73 7572  at arrays, ensur
+00012920: 6520 6c65 6e67 7468 206e 6420 6966 206e  e length nd if n
+00012930: 6565 6465 640a 2020 2020 2020 7365 6c66  eeded.      self
+00012940: 2e78 203d 206e 702e 6173 6661 7272 6179  .x = np.asfarray
+00012950: 2878 2920 2020 2020 2020 2020 2320 6162  (x)         # ab
+00012960: 7363 6973 7361 202d 2022 7820 7661 6c75  scissa - "x valu
+00012970: 6573 220a 2020 2020 2020 7365 6c66 2e65  es".      self.e
+00012980: 203d 206e 702e 6173 6661 7272 6179 2865   = np.asfarray(e
+00012990: 2920 2020 2020 2020 2320 696e 6465 7065  )       # indepe
+000129a0: 6e64 656e 7420 756e 6365 7274 6169 6e74  ndent uncertaint
+000129b0: 6965 7320 790a 2020 2020 2020 6966 2073  ies y.      if s
+000129c0: 656c 662e 652e 6e64 696d 203d 3d20 303a  elf.e.ndim == 0:
+000129d0: 0a20 2020 2020 2020 2020 2073 656c 662e  .          self.
+000129e0: 6520 3d20 7365 6c66 2e65 202a 206e 702e  e = self.e * np.
+000129f0: 6f6e 6573 286e 6429 0a20 2020 2020 2065  ones(nd).      e
+00012a00: 6c69 6620 7365 6c66 2e65 2e6e 6469 6d20  lif self.e.ndim 
+00012a10: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+00012a20: 7365 6c66 2e6e 6565 6473 5f63 6f76 6172  self.needs_covar
+00012a30: 6961 6e63 653d 5472 7565 0a20 2020 2020  iance=True.     
+00012a40: 2069 6620 6572 656c 2069 7320 6e6f 7420   if erel is not 
+00012a50: 4e6f 6e65 3a0a 2020 2020 2020 2020 7365  None:.        se
+00012a60: 6c66 2e65 7265 6c20 3d20 6e70 2e61 7366  lf.erel = np.asf
+00012a70: 6172 7261 7928 6572 656c 2920 2320 696e  array(erel) # in
+00012a80: 6465 7065 6e64 656e 7420 7265 6c61 7469  dependent relati
+00012a90: 7665 2075 6e63 6572 7461 696e 7469 6573  ve uncertainties
+00012aa0: 2078 0a20 2020 2020 2065 6c73 653a 0a20   x.      else:. 
+00012ab0: 2020 2020 2020 2073 656c 662e 6572 656c         self.erel
+00012ac0: 203d 204e 6f6e 650a 2020 2020 2020 6966   = None.      if
+00012ad0: 2063 6162 7320 6973 206e 6f74 204e 6f6e   cabs is not Non
+00012ae0: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
+00012af0: 6361 6273 203d 206e 702e 6173 6661 7272  cabs = np.asfarr
+00012b00: 6179 2863 6162 7329 2023 2063 6f72 7265  ay(cabs) # corre
+00012b10: 6c61 7465 6420 6162 6f6c 7574 6520 756e  lated abolute un
+00012b20: 6365 7274 6169 6e74 6965 7320 780a 2020  certainties x.  
+00012b30: 2020 2020 2020 6966 2073 656c 662e 6361        if self.ca
+00012b40: 6273 2e6e 6469 6d20 3d3d 2030 3a0a 2020  bs.ndim == 0:.  
+00012b50: 2020 2020 2020 2020 7365 6c66 2e63 6162          self.cab
+00012b60: 7320 3d20 7365 6c66 2e63 6162 7320 2a20  s = self.cabs * 
+00012b70: 6e70 2e6f 6e65 7328 6e64 290a 2020 2020  np.ones(nd).    
+00012b80: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00012b90: 7365 6c66 2e63 6162 7320 3d20 4e6f 6e65  self.cabs = None
+00012ba0: 0a20 2020 2020 2069 6620 6372 656c 2069  .      if crel i
+00012bb0: 7320 6e6f 7420 4e6f 6e65 3a20 2020 0a20  s not None:   . 
+00012bc0: 2020 2020 2020 2073 656c 662e 6372 656c         self.crel
+00012bd0: 203d 206e 702e 6173 6661 7272 6179 2863   = np.asfarray(c
+00012be0: 7265 6c29 2023 2063 6f72 7265 6c61 7465  rel) # correlate
+00012bf0: 6420 7265 6c61 7469 7665 2075 6e63 6572  d relative uncer
+00012c00: 7461 696e 7469 6573 2078 0a20 2020 2020  tainties x.     
+00012c10: 2065 6c73 653a 0a20 2020 2020 2020 2073   else:.        s
+00012c20: 656c 662e 6372 656c 203d 204e 6f6e 650a  elf.crel = None.
+00012c30: 2020 2020 2020 7365 6c66 2e71 7569 6574        self.quiet
+00012c40: 203d 2071 7569 6574 2020 2020 2020 2320   = quiet      # 
+00012c50: 6e6f 2069 6e66 6f72 6d61 7469 7665 2070  no informative p
+00012c60: 7269 6e74 6f75 7420 6966 2054 7275 650a  rintout if True.
+00012c70: 0a20 2020 2020 2073 656c 662e 6e64 203d  .      self.nd =
+00012c80: 206e 640a 2020 2020 2020 7365 6c66 2e64   nd.      self.d
+00012c90: 6c65 6e67 7468 203d 206e 640a 2020 2020  length = nd.    
+00012ca0: 2020 7365 6c66 2e6d 6f64 656c 203d 204e    self.model = N
+00012cb0: 6f6e 6520 2320 6e6f 206d 6f64 656c 2064  one # no model d
+00012cc0: 6566 696e 6564 2079 6574 0a20 2020 2020  efined yet.     
+00012cd0: 2073 656c 662e 6d6f 6465 6c5f 7661 6c75   self.model_valu
+00012ce0: 6573 203d 204e 6f6e 650a 0a20 2020 2020  es = None..     
+00012cf0: 2023 2073 6574 2066 6c61 6773 2066 6f72   # set flags for
+00012d00: 2073 7465 6572 696e 6720 6f66 2066 6974   steering of fit
+00012d10: 2070 726f 6365 7373 2069 6e20 646f 5f66   process in do_f
+00012d20: 6974 2829 0a20 2020 2020 2073 656c 662e  it().      self.
+00012d30: 7265 6275 6c69 6c64 436f 7620 3d20 4e6f  rebulildCov = No
+00012d40: 6e65 0a20 2020 2020 2073 656c 662e 6861  ne.      self.ha
+00012d50: 735f 7265 6c5f 4572 726f 7273 203d 2065  s_rel_Errors = e
+00012d60: 7265 6c20 6973 206e 6f74 204e 6f6e 6520  rel is not None 
+00012d70: 6f72 2063 7265 6c20 6973 206e 6f74 204e  or crel is not N
+00012d80: 6f6e 650a 2020 2020 2020 7365 6c66 2e6e  one.      self.n
+00012d90: 6565 6473 5f63 6f76 6172 6961 6e63 6520  eeds_covariance 
+00012da0: 3d20 7365 6c66 2e6e 6565 6473 5f63 6f76  = self.needs_cov
+00012db0: 6172 6961 6e63 6520 6f72 205c 0a20 2020  ariance or \.   
+00012dc0: 2020 2020 2073 656c 662e 6361 6273 2069       self.cabs i
+00012dd0: 7320 6e6f 7420 4e6f 6e65 206f 7220 7365  s not None or se
+00012de0: 6c66 2e63 7265 6c20 6973 206e 6f74 204e  lf.crel is not N
+00012df0: 6f6e 650a 0a0a 2020 2020 2020 2320 6275  one...      # bu
+00012e00: 696c 6420 2869 6e69 7469 616c 2920 636f  ild (initial) co
+00012e10: 7661 7269 616e 6365 206d 6174 7269 7820  variance matrix 
+00012e20: 2877 6974 686f 7574 2078 2d65 7272 6f72  (without x-error
+00012e30: 7329 0a20 2020 2020 2069 6620 7365 6c66  s).      if self
+00012e40: 2e6e 6565 6473 5f63 6f76 6172 6961 6e63  .needs_covarianc
+00012e50: 653a 0a20 2020 2020 2020 2065 7272 3220  e:.        err2 
+00012e60: 3d20 5f62 7569 6c64 5f43 6f76 4d61 7428  = _build_CovMat(
+00012e70: 7365 6c66 2e6e 642c 2073 656c 662e 652c  self.nd, self.e,
+00012e80: 2073 656c 662e 6572 656c 2c0a 2020 2020   self.erel,.    
+00012e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ea0: 2020 2020 2020 2020 2073 656c 662e 6361           self.ca
+00012eb0: 6273 2c20 7365 6c66 2e63 7265 6c2c 2073  bs, self.crel, s
+00012ec0: 656c 662e 7829 0a20 2020 2020 2065 6c73  elf.x).      els
+00012ed0: 653a 0a20 2020 2020 2020 2065 7272 3220  e:.        err2 
+00012ee0: 3d20 5f62 7569 6c64 5f45 7272 3228 7365  = _build_Err2(se
+00012ef0: 6c66 2e65 2c20 7365 6c66 2e65 7265 6c2c  lf.e, self.erel,
+00012f00: 2073 656c 662e 7829 0a0a 2020 2020 2020   self.x)..      
+00012f10: 2320 696e 6974 6961 6c69 7a65 2075 6e63  # initialize unc
+00012f20: 6572 7461 696e 7469 6573 2061 6e64 2063  ertainties and c
+00012f30: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
+00012f40: 2c0a 2020 2020 2020 7365 6c66 2e5f 696e  ,.      self._in
+00012f50: 6974 6961 6c43 6f76 2865 7272 3229 0a20  itialCov(err2). 
+00012f60: 2020 2020 2023 2073 6574 733a 200a 2020       # sets: .  
+00012f70: 2020 2020 2320 2020 7365 6c66 2e63 6f76      #   self.cov
+00012f80: 783a 2063 6f76 6172 6961 6e63 6520 6d61  x: covariance ma
+00012f90: 7472 6978 206f 6620 780a 2020 2020 2020  trix of x.      
+00012fa0: 2320 2020 7365 6c66 2e63 6f76 793a 2063  #   self.covy: c
+00012fb0: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
+00012fc0: 206f 6620 7920 756e 6365 7274 6169 6e74   of y uncertaint
+00012fd0: 6965 730a 2020 2020 2020 2320 2020 7365  ies.      #   se
+00012fe0: 6c66 2e63 6f76 3a20 6675 6c6c 2063 6f76  lf.cov: full cov
+00012ff0: 6172 6961 6e63 6520 6d61 7472 6978 2069  ariance matrix i
+00013000: 6e63 6c2e 2070 726f 6a65 6374 6564 2078  ncl. projected x
+00013010: 0a20 2020 2020 2023 2020 2073 656c 662e  .      #   self.
+00013020: 6943 6f76 3a20 696e 7665 7273 6520 6f66  iCov: inverse of
+00013030: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
+00013040: 6978 0a20 2020 2020 2023 2020 2073 656c  ix.      #   sel
+00013050: 662e 6572 7232 3a20 6172 7261 7920 6f66  f.err2: array of
+00013060: 2073 7175 6172 6564 2075 6e63 6572 7461   squared uncerta
+00013070: 696e 7469 6573 0a20 2020 2020 2023 2020  inties.      #  
+00013080: 2073 656c 662e 6945 7272 323a 2031 2e2f   self.iErr2: 1./
+00013090: 7365 6c66 2e65 7272 320a 2020 2020 2020  self.err2.      
+000130a0: 0a20 2020 2064 6566 205f 696e 6974 6961  .    def _initia
+000130b0: 6c43 6f76 2873 656c 662c 2065 7272 3229  lCov(self, err2)
+000130c0: 3a0a 2020 2020 2020 2222 2242 7569 6c64  :.      """Build
+000130d0: 2069 6e69 7469 616c 2028 7374 6174 6963   initial (static
+000130e0: 2920 636f 7661 7269 616e 6365 206d 6174  ) covariance mat
+000130f0: 7269 7820 666f 7220 792d 6572 726f 7273  rix for y-errors
+00013100: 0a20 2020 2020 2028 666f 7220 7072 652d  .      (for pre-
+00013110: 6669 7429 2061 6e64 2063 616c 6375 6c61  fit) and calcula
+00013120: 7465 2069 6e76 6572 7365 206d 6174 7269  te inverse matri
+00013130: 780a 2020 2020 2020 2222 220a 2020 2020  x.      """.    
+00013140: 2020 6966 2065 7272 322e 6e64 696d 203d    if err2.ndim =
+00013150: 3d20 323a 0a20 2020 2020 2020 2320 676f  = 2:.       # go
+00013160: 7420 6120 636f 7661 7269 616e 6365 206d  t a covariance m
+00013170: 6174 7269 782c 206e 6565 6420 696e 7665  atrix, need inve
+00013180: 7273 650a 2020 2020 2020 2020 7365 6c66  rse.        self
+00013190: 2e6e 6565 6473 5f63 6f76 6172 6961 6e63  .needs_covarianc
+000131a0: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
+000131b0: 2073 656c 662e 636f 7620 3d20 6572 7232   self.cov = err2
+000131c0: 0a20 2020 2020 2020 2073 656c 662e 6943  .        self.iC
+000131d0: 6f76 203d 206c 696e 616c 672e 696e 7628  ov = linalg.inv(
+000131e0: 6572 7232 290a 2020 2020 2020 2020 7365  err2).        se
+000131f0: 6c66 2e65 7272 3220 3d20 6e70 2e64 6961  lf.err2 = np.dia
+00013200: 676f 6e61 6c28 6572 7232 2920 2320 7371  gonal(err2) # sq
+00013210: 7561 7265 6420 6469 6167 6f6e 616c 2065  uared diagonal e
+00013220: 6c65 6d65 6e74 730a 2020 2020 2020 656c  lements.      el
+00013230: 7365 3a0a 2020 2020 2020 2320 676f 7420  se:.      # got 
+00013240: 696e 6465 7065 6e64 656e 7420 756e 6365  independent unce
+00013250: 7274 6169 6e74 6965 730a 2020 2020 2020  rtainties.      
+00013260: 2020 7365 6c66 2e65 7272 3220 3d20 6572    self.err2 = er
+00013270: 7232 0a20 2020 2020 2020 2073 656c 662e  r2.        self.
+00013280: 6572 7232 7920 3d20 6572 7232 0a20 2020  err2y = err2.   
+00013290: 2020 2020 2073 656c 662e 6945 7272 3220       self.iErr2 
+000132a0: 3d20 312e 2f65 7272 320a 2020 2020 2020  = 1./err2.      
+000132b0: 2020 7365 6c66 2e63 6f76 203d 206e 702e    self.cov = np.
+000132c0: 6469 6167 2865 7272 3229 0a20 2020 2020  diag(err2).     
+000132d0: 2020 2073 656c 662e 6943 6f76 203d 206e     self.iCov = n
+000132e0: 702e 6469 6167 2831 2e2f 7365 6c66 2e65  p.diag(1./self.e
+000132f0: 7272 3229 0a20 2020 2020 2023 2064 6f20  rr2).      # do 
+00013300: 6e6f 7420 7265 6275 696c 6420 636f 7661  not rebuild cova
+00013310: 7269 616e 6365 206d 6174 7269 7820 696e  riance matrix in
+00013320: 2063 6f73 7420 6675 6e63 7469 6f6e 0a20   cost function. 
+00013330: 2020 2020 2073 656c 662e 6e65 6564 735f       self.needs_
+00013340: 6479 6e61 6d69 6345 7272 6f72 7320 3d20  dynamicErrors = 
+00013350: 4661 6c73 6520 0a0a 2020 2020 6465 6620  False ..    def 
+00013360: 696e 6974 5f64 796e 616d 6963 4572 726f  init_dynamicErro
+00013370: 7273 2873 656c 6629 3a0a 2020 2020 2020  rs(self):.      
+00013380: 2320 6d65 7468 6f64 2074 6f20 7377 6974  # method to swit
+00013390: 6368 206f 6e20 6479 6e61 6d69 6320 7265  ch on dynamic re
+000133a0: 2d63 616c 6375 6c61 7469 6f6e 206f 6620  -calculation of 
+000133b0: 636f 7661 7269 616e 6365 206d 6174 7269  covariance matri
+000133c0: 7820 0a20 2020 2020 2073 656c 662e 7265  x .      self.re
+000133d0: 665f 746f 4d6f 6465 6c20 3d20 7365 6c66  f_toModel = self
+000133e0: 2e6f 7574 6572 2e72 6566 4d6f 6465 6c0a  .outer.refModel.
+000133f0: 2020 2020 2020 7365 6c66 2e6d 6f64 656c        self.model
+00013400: 203d 2073 656c 662e 6f75 7465 722e 636f   = self.outer.co
+00013410: 7374 662e 6d6f 6465 6c0a 2020 2020 200a  stf.model.     .
+00013420: 2020 2020 2020 7365 6c66 2e5f 7374 6174        self._stat
+00013430: 6963 436f 7620 3d20 4e6f 6e65 0a20 2020  icCov = None.   
+00013440: 2020 2073 656c 662e 5f73 7461 7469 6345     self._staticE
+00013450: 7272 3220 3d20 4e6f 6e65 0a20 2020 2020  rr2 = None.     
+00013460: 2073 656c 662e 6943 6f76 203d 204e 6f6e   self.iCov = Non
+00013470: 650a 2020 2020 2020 7365 6c66 2e69 4572  e.      self.iEr
+00013480: 7232 203d 204e 6f6e 650a 0a20 2020 2020  r2 = None..     
+00013490: 2023 2072 6562 7569 6c64 2063 6f76 6172   # rebuild covar
+000134a0: 6961 6e63 6520 6d61 7472 6978 2064 7572  iance matrix dur
+000134b0: 696e 6720 6669 7474 696e 6720 7072 6f63  ing fitting proc
+000134c0: 6564 7572 650a 2020 2020 2020 7365 6c66  edure.      self
+000134d0: 2e6e 6565 6473 5f64 796e 616d 6963 4572  .needs_dynamicEr
+000134e0: 726f 7273 203d 2054 7275 6520 2020 2023  rors = True    #
+000134f0: 2066 6c61 6720 666f 7220 636f 7374 2066   flag for cost f
+00013500: 756e 6374 696f 6e0a 2020 2020 2020 7365  unction.      se
+00013510: 6c66 2e66 696e 616c 5f63 616c 6c20 3d20  lf.final_call = 
+00013520: 4661 6c73 6520 2320 666c 6167 2066 6f72  False # flag for
+00013530: 205f 7265 6275 696c 645f 436f 763a 206e   _rebuild_Cov: n
+00013540: 6f20 7374 6f72 6167 6520 6f66 2079 636f  o storage of yco
+00013550: 7620 0a20 2020 2020 200a 2020 2020 2020  v .      .      
+00013560: 6966 2073 656c 662e 6e65 6564 735f 636f  if self.needs_co
+00013570: 7661 7269 616e 6365 3a0a 2020 2020 2020  variance:.      
+00013580: 2020 2320 6275 696c 6420 7374 6174 6963    # build static
+00013590: 2028 3d70 6172 616d 6574 6572 2d69 6e64   (=parameter-ind
+000135a0: 6570 656e 6465 6e74 2920 7061 7274 206f  ependent) part o
+000135b0: 6620 636f 7661 7269 616e 6365 206d 6174  f covariance mat
+000135c0: 7269 7820 2020 2020 200a 2020 2020 2020  rix      .      
+000135d0: 2020 6966 2073 656c 662e 6861 735f 7265    if self.has_re
+000135e0: 6c5f 4572 726f 7273 2061 6e64 2073 656c  l_Errors and sel
+000135f0: 662e 7265 665f 746f 4d6f 6465 6c3a 0a20  f.ref_toModel:. 
+00013600: 2020 2020 2020 2020 2023 2073 6f6d 6520           # some 
+00013610: 792d 6572 726f 7273 2061 7265 2070 6172  y-errors are par
+00013620: 616d 6574 6572 2d69 6e64 6570 656e 6465  ameter-independe
+00013630: 6e74 0a20 2020 2020 2020 2020 2073 656c  nt.          sel
+00013640: 662e 5f73 7461 7469 6343 6f76 203d 205f  f._staticCov = _
+00013650: 6275 696c 645f 436f 764d 6174 2873 656c  build_CovMat(sel
+00013660: 662e 6e64 2c0a 2020 2020 2020 2020 2020  f.nd,.          
+00013670: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00013680: 662e 652c 2065 6162 7363 6f72 203d 2073  f.e, eabscor = s
+00013690: 656c 662e 6361 6273 2029 0a20 2020 2020  elf.cabs ).     
+000136a0: 2020 2065 6c73 653a 200a 2020 2020 2020     else: .      
+000136b0: 2020 2020 2320 616c 6c20 792d 6572 726f      # all y-erro
+000136c0: 7273 2061 7265 2070 6172 616d 6574 6572  rs are parameter
+000136d0: 2d69 6e64 6570 656e 6465 6e74 0a20 2020  -independent.   
+000136e0: 2020 2020 2020 2073 656c 662e 5f73 7461         self._sta
+000136f0: 7469 6343 6f76 203d 205f 6275 696c 645f  ticCov = _build_
+00013700: 436f 764d 6174 2873 656c 662e 6e64 2c0a  CovMat(self.nd,.
+00013710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013720: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00013730: 6c66 2e65 2c20 6572 656c 3d73 656c 662e  lf.e, erel=self.
+00013740: 6572 656c 2c0a 2020 2020 2020 2020 2020  erel,.          
 00013750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013760: 2020 2020 2020 2020 2065 7265 6c3d 7365           erel=se
-00013770: 6c66 2e65 7265 6c2c 0a20 2020 2020 2020  lf.erel,.       
-00013780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013790: 2020 2020 2020 6572 656c 636f 723d 7365        erelcor=se
-000137a0: 6c66 2e63 7265 6c2c 0a20 2020 2020 2020  lf.crel,.       
-000137b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000137c0: 2020 2020 2020 6461 7461 3d6e 702e 6f6e        data=np.on
-000137d0: 6573 2873 656c 662e 6e64 2929 0a20 2020  es(self.nd)).   
-000137e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000137f0: 2020 2020 2073 656c 662e 5f63 6f76 7930       self._covy0
-00013800: 203d 204e 6f6e 650a 0a20 2020 2020 2065   = None..      e
-00013810: 6c73 653a 2023 206e 6f20 636f 7661 7269  lse: # no covari
-00013820: 616e 6365 206e 6565 6465 642c 2075 7365  ance needed, use
-00013830: 2073 696d 706c 6520 6d61 7468 0a20 2020   simple math.   
-00013840: 2020 2020 2023 2062 7569 6c64 2073 7461       # build sta
-00013850: 7469 6320 283d 7061 7261 6d65 7465 722d  tic (=parameter-
-00013860: 696e 6465 7065 6e64 656e 7429 2070 6172  independent) par
-00013870: 7420 6f66 2063 6f76 6172 6961 6e63 6520  t of covariance 
-00013880: 6d61 7472 6978 2020 2020 2020 0a20 2020  matrix      .   
-00013890: 2020 2020 2069 6620 7365 6c66 2e68 6173       if self.has
-000138a0: 5f72 656c 5f45 7272 6f72 7320 616e 6420  _rel_Errors and 
-000138b0: 7365 6c66 2e72 6566 5f74 6f4d 6f64 656c  self.ref_toModel
-000138c0: 3a0a 2020 2020 2020 2020 2020 2320 6f6e  :.          # on
-000138d0: 6c79 2069 6e64 6570 656e 6465 6e74 2079  ly independent y
-000138e0: 2d65 7272 6f72 7320 646f 206e 6f74 2064  -errors do not d
-000138f0: 6570 656e 6420 6f6e 2070 6172 616d 6574  epend on paramet
-00013900: 6572 730a 2020 2020 2020 2020 2020 7365  ers.          se
-00013910: 6c66 2e5f 7374 6174 6963 4572 7232 203d  lf._staticErr2 =
-00013920: 205f 6275 696c 645f 4572 7232 2873 656c   _build_Err2(sel
-00013930: 662e 6529 0a20 2020 2020 2020 2065 6c73  f.e).        els
-00013940: 653a 200a 2020 2020 2020 2020 2020 2320  e: .          # 
-00013950: 616c 6c20 792d 6572 726f 7273 2061 7265  all y-errors are
-00013960: 2070 6172 616d 6574 6572 2d69 6e64 6570   parameter-indep
-00013970: 656e 6465 6e74 0a20 2020 2020 2020 2020  endent.         
-00013980: 2073 656c 662e 5f73 7461 7469 6345 7272   self._staticErr
-00013990: 3220 3d20 5f62 7569 6c64 5f45 7272 3228  2 = _build_Err2(
-000139a0: 2073 656c 662e 652c 2073 656c 662e 6572   self.e, self.er
-000139b0: 656c 2c20 7365 6c66 2e78 290a 2020 2020  el, self.x).    
-000139c0: 2020 2020 2020 0a0a 2020 2020 6465 6620        ..    def 
-000139d0: 5f72 6562 7569 6c64 5f45 7272 3228 7365  _rebuild_Err2(se
-000139e0: 6c66 2c20 6d70 6172 293a 0a20 2020 2020  lf, mpar):.     
-000139f0: 2022 2222 0a20 2020 2020 2028 5265 2d29   """.      (Re-)
-00013a00: 6361 6c63 756c 6174 6520 756e 6365 7274  calculate uncert
-00013a10: 6169 6e67 6965 7320 0a20 2020 2020 2022  aingies .      "
-00013a20: 2222 0a20 2020 2020 2069 6620 7365 6c66  "".      if self
-00013a30: 2e5f 7374 6174 6963 4572 7232 2069 7320  ._staticErr2 is 
-00013a40: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00013a50: 2020 7365 6c66 2e65 7272 3220 3d20 6e70    self.err2 = np
-00013a60: 2e61 7272 6179 2873 656c 662e 5f73 7461  .array(self._sta
-00013a70: 7469 6345 7272 322c 2063 6f70 793d 5472  ticErr2, copy=Tr
-00013a80: 7565 290a 2020 2020 2020 656c 7365 3a0a  ue).      else:.
-00013a90: 2020 2020 2020 2020 7365 6c66 2e65 7272          self.err
-00013aa0: 3220 3d20 6e70 2e7a 6572 6f73 2873 656c  2 = np.zeros(sel
-00013ab0: 662e 6e64 290a 2020 2020 2020 6966 2073  f.nd).      if s
-00013ac0: 656c 662e 7265 665f 746f 4d6f 6465 6c20  elf.ref_toModel 
-00013ad0: 616e 6420 7365 6c66 2e68 6173 5f72 656c  and self.has_rel
-00013ae0: 5f45 7272 6f72 733a 0a20 2020 2020 2020  _Errors:.       
-00013af0: 205f 6572 203d 2073 656c 662e 6572 656c   _er = self.erel
-00013b00: 202a 2073 656c 662e 6d6f 6465 6c28 7365   * self.model(se
-00013b10: 6c66 2e78 2c20 2a6d 7061 7229 2020 2020  lf.x, *mpar)    
-00013b20: 2020 200a 2020 2020 2020 2020 7365 6c66     .        self
-00013b30: 2e65 7272 3220 2b3d 205f 6572 202a 205f  .err2 += _er * _
-00013b40: 6572 0a20 2020 2020 2020 200a 2020 2020  er.        .    
-00013b50: 6465 6620 5f72 6562 7569 6c64 5f43 6f76  def _rebuild_Cov
-00013b60: 2873 656c 662c 206d 7061 7229 3a0a 2020  (self, mpar):.  
-00013b70: 2020 2020 2222 220a 2020 2020 2020 2852      """.      (R
-00013b80: 652d 2942 7569 6c64 2074 6865 2063 6f76  e-)Build the cov
-00013b90: 6172 6961 6e63 6520 6d61 7472 6978 2066  ariance matrix f
-00013ba0: 726f 6d20 636f 6d70 6f6e 656e 7473 0a20  rom components. 
-00013bb0: 2020 2020 2061 6e64 2063 6163 6c75 6c61       and caclula
-00013bc0: 7465 2069 7473 2069 6e76 6572 7365 0a20  te its inverse. 
-00013bd0: 2020 2020 2022 2222 0a20 2020 2020 2320       """.     # 
-00013be0: 7374 6172 7420 6672 6f6d 2070 7265 2d62  start from pre-b
-00013bf0: 7569 6c74 2070 6172 616d 6574 6572 2d69  uilt parameter-i
-00013c00: 6e64 6570 656e 6465 6e74 2070 6172 7420  ndependent part 
-00013c10: 6f66 2043 6f76 6172 6961 6e63 6520 4d61  of Covariance Ma
-00013c20: 7472 6978 0a20 2020 2020 2073 656c 662e  trix.      self.
-00013c30: 636f 7620 3d20 6e70 2e61 7272 6179 2873  cov = np.array(s
-00013c40: 656c 662e 5f73 7461 7469 6343 6f76 2c20  elf._staticCov, 
-00013c50: 636f 7079 3d54 7275 6529 0a0a 2020 2020  copy=True)..    
-00013c60: 2023 2061 6464 206d 6174 7269 7820 6f66   # add matrix of
-00013c70: 2070 6172 616d 6574 6572 2d64 6570 656e   parameter-depen
-00013c80: 6465 6e74 2079 2d75 6e63 6572 7461 696e  dent y-uncertain
-00013c90: 7469 6573 0a20 2020 2020 2069 6620 7365  ties.      if se
-00013ca0: 6c66 2e5f 636f 7679 3020 6973 206e 6f74  lf._covy0 is not
-00013cb0: 204e 6f6e 653a 0a20 2020 2020 2020 205f   None:.        _
-00013cc0: 6461 7420 3d20 7365 6c66 2e6d 6f64 656c  dat = self.model
-00013cd0: 2873 656c 662e 782c 202a 6d70 6172 2920  (self.x, *mpar) 
-00013ce0: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
-00013cf0: 656c 662e 636f 7620 2b3d 2073 656c 662e  elf.cov += self.
-00013d00: 5f63 6f76 7930 202a 206e 702e 6f75 7465  _covy0 * np.oute
-00013d10: 7228 5f64 6174 2c20 5f64 6174 290a 0a20  r(_dat, _dat).. 
-00013d20: 2020 2064 6566 2067 6574 5f43 6f76 2873     def get_Cov(s
-00013d30: 656c 6629 3a0a 2020 2020 2020 2222 2272  elf):.      """r
-00013d40: 6574 7572 6e20 636f 7661 7269 616e 6365  eturn covariance
-00013d50: 206d 6174 7269 7820 6f66 2064 6174 610a   matrix of data.
-00013d60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013d70: 6966 2073 656c 662e 6e65 6564 735f 636f  if self.needs_co
-00013d80: 7661 7269 616e 6365 3a0a 2020 2020 2020  variance:.      
-00013d90: 2020 7265 7475 726e 2073 656c 662e 636f    return self.co
-00013da0: 760a 2020 2020 2020 656c 7365 3a0a 2020  v.      else:.  
-00013db0: 2020 2020 2020 6966 2073 656c 662e 6572        if self.er
-00013dc0: 7232 2069 7320 4e6f 6e65 3a0a 2020 2020  r2 is None:.    
-00013dd0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00013de0: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
-00013df0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013e00: 206e 702e 6469 6167 2873 656c 662e 6572   np.diag(self.er
-00013e10: 7232 290a 2020 0a20 2020 2064 6566 2067  r2).  .    def g
-00013e20: 6574 5f69 436f 7628 7365 6c66 293a 0a20  et_iCov(self):. 
-00013e30: 2020 2020 2022 2222 7265 7475 726e 2069       """return i
-00013e40: 6e76 6572 7365 206f 6620 636f 7661 7269  nverse of covari
-00013e50: 616e 6365 206d 6174 7269 782c 2061 7320  ance matrix, as 
-00013e60: 7573 6564 2069 6e20 636f 7374 2066 756e  used in cost fun
-00013e70: 6374 696f 6e0a 2020 2020 2020 2222 220a  ction.      """.
-00013e80: 2020 2020 2020 6966 2073 656c 662e 6e65        if self.ne
-00013e90: 6564 735f 636f 7661 7269 616e 6365 3a0a  eds_covariance:.
-00013ea0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00013eb0: 656c 662e 6943 6f76 0a20 2020 2020 2065  elf.iCov.      e
-00013ec0: 6c73 653a 0a20 2020 2020 2020 2072 6574  lse:.        ret
-00013ed0: 7572 6e20 6e70 2e64 6961 6728 312e 2f73  urn np.diag(1./s
-00013ee0: 656c 662e 6572 7232 290a 0a20 2020 2064  elf.err2)..    d
-00013ef0: 6566 2070 6c6f 7428 7365 6c66 2c20 6e75  ef plot(self, nu
-00013f00: 6d3d 2744 6174 6120 616e 6420 4d6f 6465  m='Data and Mode
-00013f10: 6c27 2c0a 2020 2020 2020 2020 2020 2020  l',.            
-00013f20: 2020 2020 2020 2066 6967 7369 7a65 3d28         figsize=(
-00013f30: 372e 352c 2036 2e35 292c 2020 2020 2020  7.5, 6.5),      
-00013f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f50: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00013f60: 2020 2020 2020 2020 2020 2064 6174 615f             data_
-00013f70: 6c61 6265 6c3d 2764 6174 6127 2c0a 2020  label='data',.  
-00013f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f90: 2070 6c6f 745f 7265 7369 6475 616c 3d46   plot_residual=F
-00013fa0: 616c 7365 293a 0a20 2020 2020 2022 2222  alse):.      """
-00013fb0: 7265 7475 726e 2066 6967 7572 6520 7769  return figure wi
-00013fc0: 7468 2064 6174 6120 616e 6420 756e 6365  th data and unce
-00013fd0: 7274 6169 6e74 6965 730a 2020 2020 2020  rtainties.      
-00013fe0: 2222 220a 2320 2020 2023 2067 6574 2064  """.#    # get d
-00013ff0: 6174 610a 2020 2020 2020 6966 2070 6c6f  ata.      if plo
-00014000: 745f 7265 7369 6475 616c 2061 6e64 2073  t_residual and s
-00014010: 656c 662e 6d6f 6465 6c5f 7661 6c75 6573  elf.model_values
-00014020: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00014030: 2020 2020 2020 7820 3d20 7365 6c66 2e78        x = self.x
-00014040: 202d 2073 656c 662e 6d6f 6465 6c5f 7661   - self.model_va
-00014050: 6c75 6573 0a20 2020 2020 2065 6c73 653a  lues.      else:
-00014060: 2020 0a20 2020 2020 2020 2078 203d 2073    .        x = s
-00014070: 656c 662e 780a 2020 2020 2020 6520 3d20  elf.x.      e = 
-00014080: 7365 6c66 2e67 6574 5f43 6f76 2829 0a20  self.get_Cov(). 
-00014090: 2020 2020 2069 6620 652e 6e64 696d 203d       if e.ndim =
-000140a0: 3d20 323a 0a20 2020 2020 2020 2065 203d  = 2:.        e =
-000140b0: 206e 702e 7371 7274 286e 702e 6469 6167   np.sqrt(np.diag
-000140c0: 6f6e 616c 2865 2929 0a20 2020 2020 2065  onal(e)).      e
-000140d0: 6c73 653a 0a20 2020 2020 2020 2065 203d  lse:.        e =
-000140e0: 206e 702e 7371 7274 2865 290a 2020 2023   np.sqrt(e).   #
-000140f0: 2064 7261 7720 6461 7461 0a20 2020 2020   draw data.     
-00014100: 2066 6967 203d 2070 6c74 2e66 6967 7572   fig = plt.figur
-00014110: 6528 6e75 6d3d 6e75 6d2c 2066 6967 7369  e(num=num, figsi
-00014120: 7a65 3d66 6967 7369 7a65 290a 2020 2020  ze=figsize).    
-00014130: 2020 6964 7820 3d20 6e70 2e6c 696e 7370    idx = np.linsp
-00014140: 6163 6528 302e 352c 206c 656e 2878 292d  ace(0.5, len(x)-
-00014150: 302e 352c 206c 656e 2878 2929 0a20 2020  0.5, len(x)).   
-00014160: 2020 2070 6c74 2e70 6c6f 7428 6964 782c     plt.plot(idx,
-00014170: 2078 2c20 6d61 726b 6572 3d27 7827 2c20   x, marker='x', 
-00014180: 6c69 6e65 7374 796c 653d 2727 2c20 636f  linestyle='', co
-00014190: 6c6f 723d 2767 7265 7927 2c20 616c 7068  lor='grey', alph
-000141a0: 613d 302e 3529 0a20 2020 2020 2070 6c74  a=0.5).      plt
-000141b0: 2e65 7272 6f72 6261 7228 6964 782c 2078  .errorbar(idx, x
-000141c0: 2c20 652c 2066 6d74 3d22 2e22 2c20 6361  , e, fmt=".", ca
-000141d0: 7073 697a 653d 332e 302c 206c 6162 656c  psize=3.0, label
-000141e0: 3d64 6174 615f 6c61 6265 6c29 0a20 2020  =data_label).   
-000141f0: 2020 2070 6c74 2e78 6c69 6d28 302e 2c20     plt.xlim(0., 
-00014200: 6c65 6e28 6964 7829 290a 2020 2020 2020  len(idx)).      
-00014210: 6966 2073 656c 662e 784e 616d 6573 2069  if self.xNames i
-00014220: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00014230: 2020 2020 2070 6c74 2e78 7469 636b 7328       plt.xticks(
-00014240: 7469 636b 733d 6964 782c 206c 6162 656c  ticks=idx, label
-00014250: 733d 7365 6c66 2e78 4e61 6d65 7329 0a20  s=self.xNames). 
-00014260: 2020 2020 2065 6c73 653a 200a 2020 2020       else: .    
-00014270: 2020 2020 2070 6c74 2e78 7469 636b 7328       plt.xticks(
-00014280: 7469 636b 733d 6964 782c 206c 6162 656c  ticks=idx, label
-00014290: 733d 7261 6e67 6528 6c65 6e28 6964 7829  s=range(len(idx)
-000142a0: 2929 0a0a 2020 2020 2020 7265 7475 726e  ))..      return
-000142b0: 2066 6967 0a20 2020 2020 200a 2020 2320   fig.      .  # 
-000142c0: 6465 6669 6e65 2063 7573 746f 6d20 636f  define custom co
-000142d0: 7374 2066 756e 6374 696f 6e20 666f 7220  st function for 
-000142e0: 696d 696e 7569 740a 2020 636c 6173 7320  iminuit.  class 
-000142f0: 696e 6465 7865 6443 6f73 743a 0a20 2020  indexedCost:.   
-00014300: 2022 2222 0a20 2020 2043 7573 746f 6d20   """.    Custom 
-00014310: 655f 785f 7465 6e64 6564 204c 6561 7374  e_x_tended Least
-00014320: 2d53 5175 6172 6573 2063 6f73 7420 6675  -SQuares cost fu
-00014330: 6e63 7469 6f6e 2077 6974 6820 0a20 2020  nction with .   
-00014340: 2064 796e 616d 6963 616c 6c79 2075 7064   dynamically upd
-00014350: 6174 6564 2063 6f76 6172 6961 6e63 6520  ated covariance 
-00014360: 6d61 7472 6978 2061 6e64 202d 326c 6f67  matrix and -2log
-00014370: 284c 2920 0a20 2020 2063 6f72 7265 6374  (L) .    correct
-00014380: 696f 6e20 7465 726d 2066 6f72 2070 6172  ion term for par
-00014390: 616d 6574 6572 2d64 6570 656e 6465 6e74  ameter-dependent
-000143a0: 2075 6e63 6572 7461 696e 7469 6573 2e0a   uncertainties..
-000143b0: 0a20 2020 2054 6865 2064 6566 6175 6c74  .    The default
-000143c0: 2063 6f73 7420 6675 6e63 7469 6f6e 2069   cost function i
-000143d0: 7320 7477 6963 6520 7468 6520 6e65 6761  s twice the nega
-000143e0: 7469 7665 206c 6f67 6172 6974 686d 200a  tive logarithm .
-000143f0: 2020 2020 6f66 2074 6865 206c 696b 656c      of the likel
-00014400: 6968 6f6f 6420 6f66 2061 2047 6175 7373  ihood of a Gauss
-00014410: 6961 6e20 6469 7374 7269 6275 7469 6f6e  ian distribution
-00014420: 2066 6f72 2064 6174 6120 706f 696e 7473   for data points
-00014430: 200a 2020 2020 3a6d 6174 683a 6028 782c   .    :math:`(x,
-00014440: 2079 2960 2077 6974 6820 6120 6d6f 6465   y)` with a mode
-00014450: 6c20 6675 6e63 7469 6f6e 203a 6d61 7468  l function :math
-00014460: 3a60 793d 6628 782c 202a 7029 6020 6465  :`y=f(x, *p)` de
-00014470: 7065 6e64 696e 670a 2020 2020 6f6e 2061  pending.    on a
-00014480: 2073 6574 206f 6620 7061 7261 6d65 7465   set of paramete
-00014490: 7273 203a 6d61 7468 3a60 2a70 6020 616e  rs :math:`*p` an
-000144a0: 6420 6120 706f 7373 6962 6c79 2070 6172  d a possibly par
-000144b0: 616d 6574 6572 2d64 6570 656e 6465 6e74  ameter-dependent
-000144c0: 0a20 2020 2063 6f76 6172 6961 6e63 6520  .    covariance 
-000144d0: 6d61 7472 6978 203a 6d61 7468 3a60 5628  matrix :math:`V(
-000144e0: 782c 2066 2878 2c20 2a70 2929 6020 6f66  x, f(x, *p))` of
-000144f0: 2074 6865 2078 2061 6e64 2079 2064 6174   the x and y dat
-00014500: 613a 0a0a 2020 2020 2e2e 206d 6174 683a  a:..    .. math:
-00014510: 3a20 0a20 2020 2020 202d 325c 6c6e 207b  : .      -2\ln {
-00014520: 5c63 616c 204c 7d20 3d20 5c63 6869 5e32  \cal L} = \chi^2
-00014530: 2878 2c20 565e 7b2d 317d 2c20 7828 2a70  (x, V^{-1}, x(*p
-00014540: 2920 5c2c 2920 0a20 2020 2020 202b 205c  ) \,) .      + \
-00014550: 6c6e 285c 2c20 5c64 6574 2820 5628 782c  ln(\, \det( V(x,
-00014560: 2078 282a 7029 2029 205c 2c29 0a0a 2020   x(*p) ) \,)..  
-00014570: 2020 496e 2074 6865 2061 6273 656e 6365    In the absence
-00014580: 206f 6620 7061 7261 6d65 7465 722d 6465   of parameter-de
-00014590: 7065 6e64 656e 7420 636f 6d70 6f6e 656e  pendent componen
-000145a0: 7473 206f 6620 7468 6520 636f 7661 7269  ts of the covari
-000145b0: 616e 6365 0a20 2020 206d 6174 7269 782c  ance.    matrix,
-000145c0: 2074 6865 206c 6173 7420 7465 726d 2069   the last term i
-000145d0: 7320 6f6d 6974 7465 6420 616e 6420 7468  s omitted and th
-000145e0: 6520 636f 7374 2066 756e 6374 696f 6e20  e cost function 
-000145f0: 6973 2069 6465 6e74 6963 616c 0a20 2020  is identical.   
-00014600: 2074 6f20 7468 6520 636c 6173 7369 6361   to the classica
-00014610: 6c20 3a6d 6174 683a 605c 6368 695e 3260  l :math:`\chi^2`
-00014620: 2e20 0a20 2020 2046 6f72 2074 6865 2065  . .    For the e
-00014630: 7661 6c75 6174 696f 6e20 6f66 2074 6865  valuation of the
-00014640: 2063 6f73 7420 6675 6e63 7469 6f6e 2061   cost function a
-00014650: 6e20 6566 6669 6369 656e 7420 6170 7072  n efficient appr
-00014660: 6f61 6368 2062 6173 6564 0a20 2020 206f  oach based.    o
-00014670: 6e20 7468 6520 2243 686f 6c65 736b 7920  n the "Cholesky 
-00014680: 6465 636f 6d70 6f73 6974 696f 6e22 206f  decomposition" o
-00014690: 6620 7468 6520 636f 7661 7269 616e 6365  f the covariance
-000146a0: 206d 6174 7269 7820 696e 200a 2020 2020   matrix in .    
-000146b0: 6120 7072 6f64 7563 7420 6f66 2061 2074  a product of a t
-000146c0: 7269 616e 6775 6c61 7220 6d61 7472 6978  riangular matrix
-000146d0: 2061 6e64 2069 7473 2074 7261 6e73 706f   and its transpo
-000146e0: 7365 6420 6973 2075 7365 643a 0a0a 2020  sed is used:..  
-000146f0: 2020 2e2e 206d 6174 683a 3a0a 2020 2020    .. math::.    
-00014700: 2020 2056 203d 204c 204c 5e54 2e20 2020     V = L L^T.   
-00014710: 200a 0a20 2020 2054 6865 2076 616c 7565   ..    The value
-00014720: 206f 6620 7468 6520 636f 7374 2066 756e   of the cost fun
-00014730: 6374 696f 6e20 0a0a 2020 2020 2e2e 206d  ction ..    .. m
-00014740: 6174 683a 3a0a 2020 2020 2020 5c63 6869  ath::.      \chi
-00014750: 5e32 203d 207b 727d 5c63 646f 7420 2856  ^2 = {r}\cdot (V
-00014760: 5e7b 2d31 7d7b 727d 2920 7e7e 7769 7468  ^{-1}{r}) ~~with
-00014770: 7e7e 2072 203d 2078 202d 2078 282a 7029  ~~ r = x - x(*p)
-00014780: 0a0a 2020 2020 6973 2074 6865 6e20 6361  ..    is then ca
-00014790: 6c63 756c 6174 6564 2062 7920 736f 6c76  lculated by solv
-000147a0: 696e 6720 7468 6520 6c69 6e65 6172 2065  ing the linear e
-000147b0: 7175 6174 696f 6e20 200a 0a20 2020 2e2e  quation  ..   ..
-000147c0: 206d 6174 683a 3a0a 2020 2020 2020 5620   math::.      V 
-000147d0: 5820 3d20 722c 207e 692e 652e 7e20 583d  X = r, ~i.e.~ X=
-000147e0: 565e 7b2d 317d 2072 207e 616e 647e 205c  V^{-1} r ~and~ \
-000147f0: 6368 695e 323d 2072 205c 6364 6f74 2058  chi^2= r \cdot X
-00014800: 2020 200a 0a20 2020 7769 7468 2074 6865     ..   with the
-00014810: 206c 696e 6561 722d 6571 7561 7469 6f6e   linear-equation
-00014820: 2073 6f6c 7665 7220 2a73 6369 7079 2e6c   solver *scipy.l
-00014830: 696e 616c 672e 6368 6f5f 736f 6c76 6528  inalg.cho_solve(
-00014840: 4c2c 7829 2a0a 2020 2066 6f72 2043 686f  L,x)*.   for Cho
-00014850: 6c65 736b 792d 6465 636f 6d70 6f73 6564  lesky-decomposed
-00014860: 206d 6174 7269 6365 732c 2074 6875 7320   matrices, thus 
-00014870: 6176 6f69 6469 6e67 2074 6865 2063 6f73  avoiding the cos
-00014880: 7479 200a 2020 2063 616c 6375 6c61 7469  ty .   calculati
-00014890: 6f6e 206f 6620 7468 6520 696e 7665 7273  on of the invers
-000148a0: 6520 6d61 7472 6978 2e0a 2020 2020 0a0a  e matrix..    ..
-000148b0: 2020 2054 6865 2064 6574 6572 6d69 6e61     The determina
-000148c0: 6e74 2c20 6966 206e 6565 6465 642c 2069  nt, if needed, i
-000148d0: 7320 6566 6669 6369 656e 746c 7920 6361  s efficiently ca
-000148e0: 6c63 756c 6174 6564 2062 7920 7461 6b69  lculated by taki
-000148f0: 6e67 200a 2020 2074 6865 2070 726f 6475  ng .   the produ
-00014900: 6374 206f 6620 7468 6520 6469 6167 6f6e  ct of the diagon
-00014910: 616c 2065 6c65 6d65 6e74 7320 6f66 2074  al elements of t
-00014920: 6865 206d 6174 7269 7820 4c2c 0a0a 2020  he matrix L,..  
-00014930: 2020 2e2e 206d 6174 683a 3a0a 2020 2020    .. math::.    
-00014940: 2020 5c64 6574 2856 2920 3d20 3220 5c2c    \det(V) = 2 \,
-00014950: 205c 7072 6f64 204c 5f7b 692c 697d 0a20   \prod L_{i,i}. 
-00014960: 2020 200a 2020 2020 496e 7075 743a 0a0a     .    Input:..
-00014970: 2020 2020 2d20 6f75 7465 723a 2070 6f69      - outer: poi
-00014980: 6e74 6572 2074 6f20 696e 7374 616e 6365  nter to instance
-00014990: 206f 6620 6361 6c6c 696e 6720 636c 6173   of calling clas
-000149a0: 730a 2020 2020 2d20 6d6f 6465 6c3a 206d  s.    - model: m
-000149b0: 6f64 656c 2066 756e 6374 696f 6e20 6361  odel function ca
-000149c0: 6c75 6c61 7469 6e67 2074 6865 2064 6174  lulating the dat
-000149d0: 6120 7828 5c2a 7061 7229 0a20 2020 202d  a x(\*par).    -
-000149e0: 2075 7365 5f6e 6567 326c 6f67 4c3a 2075   use_neg2logL: u
-000149f0: 7365 2066 756c 6c20 2d32 6c6f 6728 4c29  se full -2log(L)
-00014a00: 2069 6e73 7465 6164 206f 6620 6368 6932   instead of chi2
-00014a10: 2069 6620 5472 7565 0a0a 2020 2020 5f5f   if True..    __
-00014a20: 6361 6c6c 5f5f 206d 6574 686f 6420 6f66  call__ method of
-00014a30: 2074 6869 7320 636c 6173 7320 6973 2063   this class is c
-00014a40: 616c 6c65 6420 6279 2069 6d69 6e75 6974  alled by iminuit
-00014a50: 0a0a 2020 2020 4461 7461 206d 656d 6265  ..    Data membe
-00014a60: 7273 3a0a 0a20 2020 202d 206e 646f 663a  rs:..    - ndof:
-00014a70: 2064 6567 7265 6573 206f 6620 6672 6565   degrees of free
-00014a80: 646f 6d20 0a20 2020 202d 206e 636f 6e73  dom .    - ncons
-00014a90: 7472 6169 6e74 733a 206e 756d 6265 7220  traints: number 
-00014aa0: 6f66 2070 6172 616d 6574 6572 2063 6f6e  of parameter con
-00014ab0: 7374 7261 696e 7473 0a20 2020 202d 2067  straints.    - g
-00014ac0: 6f66 3a20 6368 6932 2d76 616c 7565 2028  of: chi2-value (
-00014ad0: 676f 6f64 6e65 7373 206f 6620 6669 7429  goodness of fit)
-00014ae0: 0a20 2020 202d 2075 7365 5f6e 6567 326c  .    - use_neg2l
-00014af0: 6f67 4c3a 2075 7361 6765 206f 6620 6675  ogL: usage of fu
-00014b00: 6c6c 2032 2a6e 6567 204c 6f67 204c 696b  ll 2*neg Log Lik
-00014b10: 656c 6968 6f6f 640a 2020 2020 2d20 7175  elihood.    - qu
-00014b20: 6965 743a 206e 6f20 7072 696e 746f 7574  iet: no printout
-00014b30: 2069 6620 5472 7565 2020 2020 0a0a 2020   if True    ..  
-00014b40: 2020 4d65 7468 6f64 733a 0a0a 2020 2020    Methods:..    
-00014b50: 2d20 6d6f 6465 6c28 782c 205c 2a70 6172  - model(x, \*par
-00014b60: 290a 2020 2020 2222 220a 200a 2020 2020  ).    """. .    
-00014b70: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-00014b80: 662c 206f 7574 6572 2c20 0a20 2020 2020  f, outer, .     
-00014b90: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
-00014ba0: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
-00014bb0: 2020 2020 7573 655f 6e65 6732 6c6f 674c      use_neg2logL
-00014bc0: 3d46 616c 7365 293a 0a0a 2020 2020 2020  =False):..      
-00014bd0: 6672 6f6d 2069 6d69 6e75 6974 2e75 7469  from iminuit.uti
-00014be0: 6c20 696d 706f 7274 206d 616b 655f 6675  l import make_fu
-00014bf0: 6e63 5f63 6f64 650a 0a20 2020 2020 2023  nc_code..      #
-00014c00: 2064 6174 6120 6f62 6a65 6374 206f 6620   data object of 
-00014c10: 7479 7065 2078 7944 6174 6143 6f6e 7461  type xyDataConta
-00014c20: 696e 6572 0a20 2020 2020 2073 656c 662e  iner.      self.
-00014c30: 6461 7461 203d 206f 7574 6572 2e64 6174  data = outer.dat
-00014c40: 610a 2020 2020 2020 6966 206e 6f74 2069  a.      if not i
-00014c50: 7369 6e73 7461 6e63 6528 7365 6c66 2e64  sinstance(self.d
-00014c60: 6174 612c 206d 6e46 6974 2e78 4461 7461  ata, mnFit.xData
-00014c70: 436f 6e74 6169 6e65 7229 3a0a 2020 2020  Container):.    
-00014c80: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00014c90: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00014ca0: 2220 2121 2120 6d6e 4669 742e 696e 6465  " !!! mnFit.inde
-00014cb0: 7865 6443 6f73 743a 2065 7870 6563 7469  xedCost: expecti
-00014cc0: 6e67 2064 6174 6120 636f 6e74 6169 6e65  ng data containe
-00014cd0: 7220 6f66 2074 7970 6520 276d 6e46 6974  r of type 'mnFit
-00014ce0: 2e78 4461 7461 436f 6e74 6169 6e65 7227  .xDataContainer'
-00014cf0: 2229 0a20 2020 2020 2073 656c 662e 6d6f  ").      self.mo
-00014d00: 6465 6c20 3d20 6d6f 6465 6c0a 2020 2020  del = model.    
-00014d10: 2020 7365 6c66 2e71 7569 6574 203d 206f    self.quiet = o
-00014d20: 7574 6572 2e71 7569 6574 0a20 2020 2020  uter.quiet.     
-00014d30: 2023 2075 7365 202d 3220 2a20 6c6f 6728   # use -2 * log(
-00014d40: 4c29 206f 6620 4761 7573 7369 616e 2069  L) of Gaussian i
-00014d50: 6e73 7465 6164 206f 6620 4368 6932 0a20  nstead of Chi2. 
-00014d60: 2020 2020 2023 2020 286f 6e6c 7920 6469       #  (only di
-00014d70: 6666 6572 656e 7420 6672 6f6d 2043 6869  fferent from Chi
-00014d80: 3220 666f 7220 7061 7261 6d65 7465 722d  2 for parameter-
-00014d90: 6465 7065 6e64 656e 7420 756e 6365 7274  dependent uncert
-00014da0: 6169 6e74 6965 7329 0a20 2020 2020 2073  ainties).      s
-00014db0: 656c 662e 7573 655f 6e65 6732 6c6f 674c  elf.use_neg2logL
-00014dc0: 203d 2075 7365 5f6e 6567 326c 6f67 4c0a   = use_neg2logL.
-00014dd0: 2020 2020 2020 0a20 2020 2020 2023 2073        .      # s
-00014de0: 6574 2070 726f 7065 7220 7369 676e 6174  et proper signat
-00014df0: 7572 6520 6f66 206d 6f64 656c 2066 756e  ure of model fun
-00014e00: 6374 696f 6e20 666f 7220 696d 696e 7569  ction for iminui
-00014e10: 740a 2020 2020 2020 7365 6c66 2e70 6e61  t.      self.pna
-00014e20: 6d73 203d 206f 7574 6572 2e70 6e61 6d73  ms = outer.pnams
-00014e30: 0a20 2020 2020 2073 656c 662e 6675 6e63  .      self.func
-00014e40: 5f63 6f64 6520 3d20 6d61 6b65 5f66 756e  _code = make_fun
-00014e50: 635f 636f 6465 2873 656c 662e 706e 616d  c_code(self.pnam
-00014e60: 7329 0a20 2020 2020 2073 656c 662e 6e70  s).      self.np
-00014e70: 6172 203d 206f 7574 6572 2e6e 7061 720a  ar = outer.npar.
-00014e80: 0a20 2020 2020 2023 2074 616b 6520 6163  .      # take ac
-00014e90: 636f 756e 7420 6f66 2063 6f6e 7374 7261  count of constra
-00014ea0: 696e 7473 200a 2020 2020 2020 7365 6c66  ints .      self
-00014eb0: 2e63 6f6e 7374 7261 696e 7473 203d 206f  .constraints = o
-00014ec0: 7574 6572 2e63 6f6e 7374 7261 696e 7473  uter.constraints
-00014ed0: 0a20 2020 2020 2073 656c 662e 6e63 6f6e  .      self.ncon
-00014ee0: 7374 7261 696e 7473 203d 206c 656e 2873  straints = len(s
-00014ef0: 656c 662e 636f 6e73 7472 6169 6e74 7329  elf.constraints)
-00014f00: 0a20 2020 2020 2073 656c 662e 6e64 6f66  .      self.ndof
-00014f10: 203d 206c 656e 2873 656c 662e 6461 7461   = len(self.data
-00014f20: 2e78 2920 2d20 7365 6c66 2e6e 7061 7220  .x) - self.npar 
-00014f30: 2b20 7365 6c66 2e6e 636f 6e73 7472 6169  + self.nconstrai
-00014f40: 6e74 7320 2b20 6f75 7465 722e 6e66 6978  nts + outer.nfix
-00014f50: 6564 0a0a 2020 2020 2020 2320 666c 6167  ed..      # flag
-00014f60: 2074 6f20 636f 6e74 726f 6c20 6669 6e61   to control fina
-00014f70: 6c20 6163 7469 6f6e 7320 696e 2063 6f73  l actions in cos
-00014f80: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
-00014f90: 2073 656c 662e 6669 6e61 6c5f 6361 6c6c   self.final_call
-00014fa0: 203d 2046 616c 7365 0a0a 0a20 2020 2064   = False...    d
-00014fb0: 6566 205f 5f63 616c 6c5f 5f28 7365 6c66  ef __call__(self
-00014fc0: 2c20 2a70 6172 293a 2020 0a20 2020 2020  , *par):  .     
-00014fd0: 2023 2063 616c 6c65 6420 6974 6572 6174   # called iterat
-00014fe0: 6976 656c 7920 6279 206d 696e 7569 740a  ively by minuit.
-00014ff0: 0a20 2020 2020 2023 2063 6f73 7420 6675  .      # cost fu
-00015000: 6e63 7469 6f6e 2069 7320 6578 7465 6e64  nction is extend
-00015010: 6564 2063 6869 323a 0a20 2020 2020 2023  ed chi2:.      #
-00015020: 2020 2061 6464 206e 6f72 6d61 6c69 7a61     add normaliza
-00015030: 7469 6f6e 2074 6572 6d20 6966 2075 6e63  tion term if unc
-00015040: 6572 7461 696e 7469 6573 2064 6570 656e  ertainties depen
-00015050: 6420 6f6e 206d 6f64 656c 200a 0a20 2020  d on model ..   
-00015060: 2020 206e 6c4c 3220 3d20 302e 2023 2069     nlL2 = 0. # i
-00015070: 6e69 7469 616c 697a 6520 2d32 2a6c 6e28  nitialize -2*ln(
-00015080: 4c29 0a20 2020 2020 2023 2020 6669 7273  L).      #  firs
-00015090: 742c 2074 616b 6520 696e 746f 2061 6363  t, take into acc
-000150a0: 6f75 6e74 2070 6f73 7369 626c 6520 7061  ount possible pa
-000150b0: 7261 6d65 7465 7220 636f 6e73 7472 6169  rameter constrai
-000150c0: 6e74 7320 200a 2020 2020 2020 6966 2073  nts  .      if s
-000150d0: 656c 662e 6e63 6f6e 7374 7261 696e 7473  elf.nconstraints
-000150e0: 3a0a 2020 2020 2020 2020 666f 7220 6320  :.        for c 
-000150f0: 696e 2073 656c 662e 636f 6e73 7472 6169  in self.constrai
-00015100: 6e74 733a 0a20 2020 2020 2020 2020 2070  nts:.          p
-00015110: 5f69 6420 3d20 635b 305d 0a20 2020 2020  _id = c[0].     
-00015120: 2020 2020 2072 203d 2028 2070 6172 5b70       r = ( par[p
-00015130: 5f69 645d 202d 2063 5b31 5d29 202f 2063  _id] - c[1]) / c
-00015140: 5b32 5d20 0a20 2020 2020 2020 2020 206e  [2] .          n
-00015150: 6c4c 3220 2b3d 2072 2a72 0a0a 2020 2020  lL2 += r*r..    
-00015160: 2020 2320 6361 6c63 756c 6174 6520 7265    # calculate re
-00015170: 7369 6475 616c 206f 6620 6461 7461 2077  sidual of data w
-00015180: 7274 2e20 6d6f 6465 6c0a 2020 2020 2020  rt. model.      
-00015190: 6d6f 6465 6c5f 7661 6c75 6573 203d 2073  model_values = s
-000151a0: 656c 662e 6d6f 6465 6c28 7365 6c66 2e64  elf.model(self.d
-000151b0: 6174 612e 782c 202a 7061 7229 0a20 2020  ata.x, *par).   
-000151c0: 2020 205f 7220 3d20 7365 6c66 2e64 6174     _r = self.dat
-000151d0: 612e 7820 2d20 6d6f 6465 6c5f 7661 6c75  a.x - model_valu
-000151e0: 6573 0a0a 2020 2020 2020 6966 2073 656c  es..      if sel
-000151f0: 662e 6461 7461 2e6e 6565 6473 5f63 6f76  f.data.needs_cov
-00015200: 6172 6961 6e63 653a 0a20 2020 2020 2020  ariance:.       
-00015210: 2023 2020 6368 6563 6b20 6966 206d 6174   #  check if mat
-00015220: 7269 7820 6e65 6564 7320 7265 6275 696c  rix needs rebuil
-00015230: 6469 6e67 0a20 2020 2020 2020 2069 6620  ding.        if 
-00015240: 6e6f 7420 7365 6c66 2e64 6174 612e 6e65  not self.data.ne
-00015250: 6564 735f 6479 6e61 6d69 6345 7272 6f72  eds_dynamicError
-00015260: 733a 0a20 2020 2020 2020 2020 2320 7374  s:.         # st
-00015270: 6174 6963 2063 6f76 6172 6961 6e63 652c  atic covariance,
-00015280: 2075 7365 2069 7473 2069 6e76 6572 7365   use its inverse
-00015290: 0a20 2020 2020 2020 2020 206e 6c4c 3220  .          nlL2 
-000152a0: 2b3d 2066 6c6f 6174 286e 702e 696e 6e65  += float(np.inne
-000152b0: 7228 6e70 2e6d 6174 6d75 6c28 5f72 2c20  r(np.matmul(_r, 
-000152c0: 7365 6c66 2e64 6174 612e 6943 6f76 292c  self.data.iCov),
-000152d0: 205f 7229 290a 2020 2020 2020 2020 2020   _r)).          
-000152e0: 2320 6964 656e 7469 6361 6c20 746f 2063  # identical to c
-000152f0: 6c61 7373 6963 616c 2043 6869 320a 2020  lassical Chi2.  
-00015300: 2020 2020 2020 2020 7365 6c66 2e67 6f66          self.gof
-00015310: 203d 206e 6c4c 320a 2020 2020 2020 2020   = nlL2.        
-00015320: 2020 0a20 2020 2020 2020 2065 6c73 653a    .        else:
-00015330: 2023 2064 796e 616d 6963 616c 6c79 2072   # dynamically r
-00015340: 6562 7569 6c64 2063 6f76 6172 6961 6e63  ebuild covarianc
-00015350: 6520 6d61 7472 6978 0a20 2020 2020 2020  e matrix.       
-00015360: 2020 2073 656c 662e 6461 7461 2e5f 7265     self.data._re
-00015370: 6275 696c 645f 436f 7628 7061 7229 0a20  build_Cov(par). 
-00015380: 2020 2020 2020 2020 2023 2075 7365 2043           # use C
-00015390: 686f 6c65 736b 7920 6465 636f 6d70 6f73  holesky decompos
-000153a0: 6974 6f6e 2074 6f20 636f 6d70 7574 6520  iton to compute 
-000153b0: 6368 6932 203d 205f 722e 5420 2856 5e2d  chi2 = _r.T (V^-
-000153c0: 3129 205f 7220 0a20 2020 2020 2020 2020  1) _r .         
-000153d0: 204c 2c20 6973 5f6c 6f77 6572 203d 206c   L, is_lower = l
-000153e0: 696e 616c 672e 6368 6f5f 6661 6374 6f72  inalg.cho_factor
-000153f0: 2873 656c 662e 6461 7461 2e63 6f76 2c20  (self.data.cov, 
-00015400: 6368 6563 6b5f 6669 6e69 7465 3d46 616c  check_finite=Fal
-00015410: 7365 290a 2020 2020 2020 2020 2020 6e6c  se).          nl
-00015420: 4c32 202b 3d20 6e70 2e69 6e6e 6572 285f  L2 += np.inner(_
-00015430: 722c 206c 696e 616c 672e 6368 6f5f 736f  r, linalg.cho_so
-00015440: 6c76 6528 284c 2c20 6973 5f6c 6f77 6572  lve((L, is_lower
-00015450: 292c 205f 7229 2029 0a20 2020 2020 2020  ), _r) ).       
-00015460: 2020 2023 2075 7020 746f 2068 6572 652c     # up to here,
-00015470: 2069 6465 6e74 6963 616c 2074 6f20 636c   identical to cl
-00015480: 6173 7369 6361 6c20 4368 6932 0a20 2020  assical Chi2.   
-00015490: 2020 2020 2020 2073 656c 662e 676f 6620         self.gof 
-000154a0: 3d20 6e6c 4c32 2020 2020 2020 2020 2020  = nlL2          
-000154b0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000154c0: 2023 2074 616b 6520 696e 746f 2061 6363   # take into acc
-000154d0: 6f75 6e74 2070 6172 616d 6574 6572 2d64  ount parameter-d
-000154e0: 6570 656e 6465 6e74 206e 6f72 6d61 6c69  ependent normali
-000154f0: 7361 7469 6f6e 2074 6572 6d0a 2020 2020  sation term.    
-00015500: 2020 2020 2020 6966 2073 656c 662e 7573        if self.us
-00015510: 655f 6e65 6732 6c6f 674c 3a0a 2020 2020  e_neg2logL:.    
-00015520: 2020 2020 2023 2020 6661 7374 2063 616c       #  fast cal
-00015530: 6375 6c61 7469 6f6e 206f 6620 6465 7465  culation of dete
-00015540: 726d 696e 616e 7420 6465 7428 5629 2066  rminant det(V) f
-00015550: 726f 6d20 4368 6f6c 6573 6b79 2066 6163  rom Cholesky fac
-00015560: 746f 7220 0a20 2020 2020 2020 2020 2020  tor .           
-00015570: 206e 6c4c 3220 2b3d 2032 2e2a 6e70 2e73   nlL2 += 2.*np.s
-00015580: 756d 286e 702e 6c6f 6728 6e70 2e64 6961  um(np.log(np.dia
-00015590: 676f 6e61 6c28 4c29 2029 2029 0a0a 2020  gonal(L) ) )..  
-000155a0: 2020 2020 656c 7365 3a20 2023 2066 6173      else:  # fas
-000155b0: 7420 6361 6c63 756c 6174 696f 6e20 666f  t calculation fo
-000155c0: 7220 7369 6d70 6c65 2065 7272 6f72 730a  r simple errors.
-000155d0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-000155e0: 6966 2065 7272 6f72 7320 6e65 6564 7320  if errors needs 
-000155f0: 7265 6361 6c63 756c 6174 696e 670a 2020  recalculating.  
-00015600: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
-00015610: 7461 2e6e 6565 6473 5f64 796e 616d 6963  ta.needs_dynamic
-00015620: 4572 726f 7273 3a0a 2020 2020 2020 2020  Errors:.        
-00015630: 2020 7365 6c66 2e64 6174 612e 5f72 6562    self.data._reb
-00015640: 7569 6c64 5f45 7272 3228 7061 7229 0a20  uild_Err2(par). 
-00015650: 2020 2020 2020 2020 206e 6c4c 3220 2b3d           nlL2 +=
-00015660: 206e 702e 7375 6d28 5f72 202a 205f 7220   np.sum(_r * _r 
-00015670: 2f20 7365 6c66 2e64 6174 612e 6572 7232  / self.data.err2
-00015680: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-00015690: 2020 2020 2020 2020 2020 6e6c 4c32 202b            nlL2 +
-000156a0: 3d20 6e70 2e73 756d 285f 7220 2a20 5f72  = np.sum(_r * _r
-000156b0: 202a 2073 656c 662e 6461 7461 2e69 4572   * self.data.iEr
-000156c0: 7232 290a 0a20 2020 2020 2020 2023 2074  r2)..        # t
-000156d0: 6869 7320 6973 2069 6465 6e74 6963 616c  his is identical
-000156e0: 2074 6f20 636c 6173 7369 6361 6c20 4368   to classical Ch
-000156f0: 6932 0a20 2020 2020 2020 2073 656c 662e  i2.        self.
-00015700: 676f 6620 3d20 6e6c 4c32 0a20 2020 2020  gof = nlL2.     
-00015710: 2020 200a 2020 2020 2020 2020 2320 6164     .        # ad
-00015720: 6420 7061 7261 6d65 7465 722d 6465 7065  d parameter-depe
-00015730: 6e64 656e 7420 6e6f 726d 616c 697a 6174  ndent normalizat
-00015740: 696f 6e20 7465 726d 2069 6620 6e65 6564  ion term if need
-00015750: 6564 2061 6e64 2077 616e 7465 640a 2020  ed and wanted.  
-00015760: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
-00015770: 7461 2e6e 6565 6473 5f64 796e 616d 6963  ta.needs_dynamic
-00015780: 4572 726f 7273 2061 6e64 2073 656c 662e  Errors and self.
-00015790: 7573 655f 6e65 6732 6c6f 674c 3a0a 2020  use_neg2logL:.  
-000157a0: 2020 2020 2020 2020 6e6c 4c32 202b 3d20          nlL2 += 
-000157b0: 6e70 2e73 756d 286e 702e 6c6f 6728 7365  np.sum(np.log(se
-000157c0: 6c66 2e64 6174 612e 6572 7232 2929 0a0a  lf.data.err2))..
-000157d0: 2020 2020 2020 2320 7072 6f76 6964 6520        # provide 
-000157e0: 6d6f 6465 6c20 7661 6c75 6573 2074 6f20  model values to 
-000157f0: 6461 7461 206f 626a 6563 740a 2020 2020  data object.    
-00015800: 2020 7365 6c66 2e64 6174 612e 6d6f 6465    self.data.mode
-00015810: 6c5f 7661 6c75 6573 203d 206d 6f64 656c  l_values = model
-00015820: 5f76 616c 7565 7320 2020 2020 2020 0a0a  _values       ..
-00015830: 2020 2020 2020 7265 7475 726e 206e 6c4c        return nlL
-00015840: 320a 0a0a 2020 230a 2020 2320 2d2d 2d20  2...  #.  # --- 
-00015850: 7370 6563 6961 6c20 636f 6465 2066 6f72  special code for
-00015860: 2068 6973 746f 6772 616d 2046 6974 0a20   histogram Fit. 
-00015870: 2023 2020 2020 2020 0a0a 2020 6465 6620   #      ..  def 
-00015880: 7365 745f 684f 7074 696f 6e73 2873 656c  set_hOptions(sel
-00015890: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-000158a0: 2072 756e 5f6d 696e 6f73 3d4e 6f6e 652c   run_minos=None,
-000158b0: 0a20 2020 2020 2020 2020 2020 2020 2075  .              u
-000158c0: 7365 5f47 6175 7373 4170 7072 6f78 3d4e  se_GaussApprox=N
-000158d0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-000158e0: 2020 2066 6974 5f64 656e 7369 7479 203d     fit_density =
-000158f0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00015900: 2020 2020 2071 7569 6574 3d4e 6f6e 6529       quiet=None)
-00015910: 3a0a 0a20 2020 2022 2222 4465 6669 6e65  :..    """Define
-00015920: 206d 6e46 6974 206f 7074 696f 6e73 0a0a   mnFit options..
-00015930: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-00015940: 2020 2020 202d 2072 756e 206d 696e 6f73       - run minos
-00015950: 2065 6c73 6520 646f 6e2a 7420 7275 6e20   else don*t run 
-00015960: 6d69 6e6f 730a 2020 2020 2020 2020 2d20  minos.        - 
-00015970: 7573 6520 4761 7573 7369 616e 2041 7070  use Gaussian App
-00015980: 726f 7869 6d61 7469 6f6e 206f 6620 506f  roximation of Po
-00015990: 6973 736f 6e20 6469 7374 7269 6275 7469  isson distributi
-000159a0: 6f6e 0a20 2020 2020 2020 202d 2064 6f6e  on.        - don
-000159b0: 2a74 2070 726f 7669 6465 2070 7269 6e74  *t provide print
-000159c0: 6f75 7420 656c 7365 2076 6572 626f 7365  out else verbose
-000159d0: 2070 7269 6e74 6f75 7420 0a20 2020 2022   printout .    "
-000159e0: 2222 0a20 2020 2069 6620 7275 6e5f 6d69  "".    if run_mi
-000159f0: 6e6f 7320 6973 206e 6f74 204e 6f6e 653a  nos is not None:
-00015a00: 2020 200a 2020 2020 2020 7365 6c66 2e72     .      self.r
-00015a10: 756e 5f6d 696e 6f73 203d 2072 756e 5f6d  un_minos = run_m
-00015a20: 696e 6f73 0a20 2020 2020 2073 656c 662e  inos.      self.
-00015a30: 6f70 7469 6f6e 735b 2272 756e 5f6d 696e  options["run_min
-00015a40: 6f73 225d 5b30 5d20 3d20 696e 7428 7275  os"][0] = int(ru
-00015a50: 6e5f 6d69 6e6f 7329 0a20 2020 2069 6620  n_minos).    if 
-00015a60: 7573 655f 4761 7573 7341 7070 726f 7820  use_GaussApprox 
-00015a70: 6973 206e 6f74 204e 6f6e 653a 2020 200a  is not None:   .
-00015a80: 2020 2020 2020 7365 6c66 2e75 7365 5f47        self.use_G
-00015a90: 6175 7373 4170 7072 6f78 203d 2075 7365  aussApprox = use
-00015aa0: 5f47 6175 7373 4170 7072 6f78 0a20 2020  _GaussApprox.   
-00015ab0: 2020 2073 656c 662e 6f70 7469 6f6e 735b     self.options[
-00015ac0: 2275 7365 5f47 6175 7373 4170 7072 6f78  "use_GaussApprox
-00015ad0: 225d 5b30 5d20 3d20 696e 7428 7573 655f  "][0] = int(use_
-00015ae0: 4761 7573 7341 7070 726f 7829 0a20 2020  GaussApprox).   
-00015af0: 2069 6620 6669 745f 6465 6e73 6974 7920   if fit_density 
-00015b00: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00015b10: 2020 2073 656c 662e 6669 745f 6465 6e73     self.fit_dens
-00015b20: 6974 7920 3d20 6669 745f 6465 6e73 6974  ity = fit_densit
-00015b30: 790a 2020 2020 2020 7365 6c66 2e6f 7074  y.      self.opt
-00015b40: 696f 6e73 5b22 6669 745f 6465 6e73 6974  ions["fit_densit
-00015b50: 7922 5d5b 305d 203d 2069 6e74 2866 6974  y"][0] = int(fit
-00015b60: 5f64 656e 7369 7479 290a 2020 2020 6966  _density).    if
-00015b70: 2071 7569 6574 2069 7320 6e6f 7420 4e6f   quiet is not No
-00015b80: 6e65 3a0a 2020 2020 2020 7365 6c66 2e71  ne:.      self.q
-00015b90: 7569 6574 203d 2071 7569 6574 0a20 2020  uiet = quiet.   
-00015ba0: 200a 2020 6465 6620 696e 6974 5f68 4461   .  def init_hDa
-00015bb0: 7461 2873 656c 662c 0a20 2020 2020 2020  ta(self,.       
-00015bc0: 2020 2020 2020 2020 2062 696e 5f63 6f6e           bin_con
-00015bd0: 7465 6e74 732c 2062 696e 5f65 6467 6573  tents, bin_edges
-00015be0: 2c20 4465 6c74 614d 753d 4e6f 6e65 293a  , DeltaMu=None):
-00015bf0: 0a20 2020 2022 2222 0a20 2020 2069 6e69  .    """.    ini
-00015c00: 7469 616c 697a 6520 6869 7374 6f67 7261  tialize histogra
-00015c10: 6d20 6461 7461 206f 626a 6563 740a 0a20  m data object.. 
-00015c20: 2020 2041 7267 733a 0a20 2020 202d 2062     Args:.    - b
-00015c30: 696e 5f63 6f6e 7465 6e74 733a 2061 7272  in_contents: arr
-00015c40: 6179 206f 6620 666c 6f61 7473 0a20 2020  ay of floats.   
-00015c50: 202d 2062 696e 5f65 6467 6573 3a20 6172   - bin_edges: ar
-00015c60: 7261 7920 6f66 206c 656e 6774 6820 6c65  ray of length le
-00015c70: 6e28 6269 6e5f 636f 6e74 656e 7473 292a  n(bin_contents)*
-00015c80: 310a 2020 2020 2d20 4465 6c74 614d 753a  1.    - DeltaMu:
-00015c90: 2073 6869 6674 2069 6e20 6d65 616e 2028   shift in mean (
-00015ca0: 4465 6c74 6120 6d75 2920 7665 7273 7573  Delta mu) versus
-00015cb0: 206c 616d 6264 6120 0a20 2020 206f 6620   lambda .    of 
-00015cc0: 506f 6973 736f 6e20 6469 7374 7269 6275  Poisson distribu
-00015cd0: 7469 6f6e 200a 2020 2020 2222 220a 2020  tion .    """.  
-00015ce0: 2020 0a20 2020 2023 2063 7265 6174 6520    .    # create 
-00015cf0: 6461 7461 206f 626a 6563 7420 616e 6420  data object and 
-00015d00: 7061 7373 2061 6c6c 2069 6e70 7574 2061  pass all input a
-00015d10: 7267 756d 656e 7473 0a20 2020 2073 656c  rguments.    sel
-00015d20: 662e 6844 6174 6120 3d20 7365 6c66 2e68  f.hData = self.h
-00015d30: 6973 7444 6174 6143 6f6e 7461 696e 6572  istDataContainer
-00015d40: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
-00015d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d60: 2020 2020 2020 6269 6e5f 636f 6e74 656e        bin_conten
-00015d70: 7473 2c20 6269 6e5f 6564 6765 732c 0a20  ts, bin_edges,. 
-00015d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d90: 2020 2020 2020 2020 2020 2020 2020 4465                De
-00015da0: 6c74 614d 752c 0a20 2020 2020 2020 2020  ltaMu,.         
-00015db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015dc0: 2020 2020 2020 7175 6965 743d 7365 6c66        quiet=self
-00015dd0: 2e71 7569 6574 290a 2020 2020 7365 6c66  .quiet).    self
-00015de0: 2e64 6174 6120 3d20 7365 6c66 2e68 4461  .data = self.hDa
-00015df0: 7461 0a20 2020 200a 2020 6465 6620 696e  ta.    .  def in
-00015e00: 6974 5f68 4669 7428 7365 6c66 2c20 6d6f  it_hFit(self, mo
-00015e10: 6465 6c2c 206d 6f64 656c 5f6b 7761 7267  del, model_kwarg
-00015e20: 733d 4e6f 6e65 2c20 7030 3d4e 6f6e 652c  s=None, p0=None,
-00015e30: 2064 7030 3d4e 6f6e 652c 0a20 2020 2020   dp0=None,.     
-00015e40: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
-00015e50: 7261 696e 7473 3d4e 6f6e 652c 0a20 2020  raints=None,.   
-00015e60: 2020 2020 2020 2020 2020 2020 2066 6978               fix
-00015e70: 5061 7273 203d 204e 6f6e 652c 200a 2020  Pars = None, .  
-00015e80: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-00015e90: 6d69 7473 3d4e 6f6e 6529 3a0a 2020 2020  mits=None):.    
-00015ea0: 2222 2269 6e69 7469 616c 697a 6520 6669  """initialize fi
-00015eb0: 7420 6f62 6a65 6374 0a0a 2020 2020 4172  t object..    Ar
-00015ec0: 6773 3a0a 2020 2020 2020 2d20 6d6f 6465  gs:.      - mode
-00015ed0: 6c3a 206d 6f64 656c 2064 656e 7369 7479  l: model density
-00015ee0: 2066 756e 6374 696f 6e20 6628 783b 205c   function f(x; \
-00015ef0: 2a70 6172 290a 2020 2020 2020 2d20 6d6f  *par).      - mo
-00015f00: 6465 6c5f 6b77 6172 6773 3a20 6f70 7469  del_kwargs: opti
-00015f10: 6f6e 616c 2c20 6669 7420 7061 7261 6d65  onal, fit parame
-00015f20: 7465 7273 2069 6620 6e6f 7420 6672 6f6d  ters if not from
-00015f30: 206d 6f64 656c 2073 6967 6e61 7475 7265   model signature
-00015f40: 200a 2020 2020 2020 2d20 7030 3a20 6e70   .      - p0: np
-00015f50: 2d61 7272 6179 206f 6620 666c 6f61 7473  -array of floats
-00015f60: 2c20 696e 6974 6961 6c20 7061 7261 6d65  , initial parame
-00015f70: 7465 7220 7661 6c75 6573 200a 2020 2020  ter values .    
-00015f80: 2020 2d20 6470 303a 2061 7272 6179 2d6c    - dp0: array-l
-00015f90: 696b 652c 2069 6e69 7469 616c 2067 7565  ike, initial gue
-00015fa0: 7373 206f 6620 7061 7261 6d65 7465 7220  ss of parameter 
-00015fb0: 756e 6365 7274 6169 6e74 6965 7320 286f  uncertainties (o
-00015fc0: 7074 696f 6e61 6c29 0a20 2020 2020 202d  ptional).      -
-00015fd0: 2063 6f6e 7374 7261 696e 7473 3a20 286e   constraints: (n
-00015fe0: 6573 7465 6429 206c 6973 7428 7329 3a20  ested) list(s): 
-00015ff0: 5b70 6172 616d 6574 6572 206e 616d 652c  [parameter name,
-00016000: 2076 616c 7565 2c20 756e 6365 7274 6169   value, uncertai
-00016010: 6e74 795d 200a 2020 2020 2020 2020 6f72  nty] .        or
-00016020: 205b 7061 7261 6d65 7465 7220 696e 6465   [parameter inde
-00016030: 782c 2076 616c 7565 2c20 756e 6365 7274  x, value, uncert
-00016040: 6169 6e74 795d 0a20 2020 2020 202d 2066  ainty].      - f
-00016050: 6978 2070 6172 616d 6574 6572 2873 2920  ix parameter(s) 
-00016060: 696e 2066 6974 3a20 6c69 7374 206f 6620  in fit: list of 
-00016070: 7061 7261 6d65 7465 7220 6e61 6d65 7320  parameter names 
-00016080: 6f72 2069 6e64 6963 6573 0a20 2020 2020  or indices.     
-00016090: 202d 206c 696d 6974 733a 2028 6e65 7374   - limits: (nest
-000160a0: 6564 2920 6c69 7374 2873 293a 205b 7061  ed) list(s): [pa
-000160b0: 7261 6d65 7465 7220 6e61 6d65 2c20 6d69  rameter name, mi
-000160c0: 6e2c 206d 6178 5d20 0a20 2020 2020 2020  n, max] .       
-000160d0: 206f 7220 5b70 6172 616d 6574 6572 2069   or [parameter i
-000160e0: 6e64 6578 2c20 6d69 6e2c 206d 6178 5d0a  ndex, min, max].
-000160f0: 2020 2020 2222 220a 0a20 2020 2069 6620      """..    if 
-00016100: 7365 6c66 2e68 4461 7461 2069 7320 4e6f  self.hData is No
-00016110: 6e65 3a20 0a20 2020 2020 2072 6169 7365  ne: .      raise
-00016120: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00016130: 2020 2020 2027 2021 2121 206d 6e46 6974       ' !!! mnFit
-00016140: 2e69 6e69 745f 6846 6974 3a20 6e6f 2064  .init_hFit: no d
-00016150: 6174 6120 6f62 6a65 6374 2064 6566 696e  ata object defin
-00016160: 6564 202d 2063 616c 6c20 696e 6974 5f64  ed - call init_d
-00016170: 6174 6128 2927 290a 2020 2020 0a20 2020  ata()').    .   
-00016180: 2023 2067 6574 2070 6172 616d 6574 6572   # get parameter
-00016190: 7320 6f66 206d 6f64 656c 2066 756e 6374  s of model funct
-000161a0: 696f 6e20 746f 2073 6574 2073 7461 7274  ion to set start
-000161b0: 2076 616c 7565 7320 666f 7220 6669 740a   values for fit.
-000161c0: 2020 2020 6966 206d 6f64 656c 5f6b 7761      if model_kwa
-000161d0: 7267 7320 6973 204e 6f6e 653a 0a20 2020  rgs is None:.   
-000161e0: 2020 2061 7267 732c 206d 6f64 656c 5f6b     args, model_k
-000161f0: 7761 7267 7320 3d20 6765 745f 6675 6e63  wargs = get_func
-00016200: 7469 6f6e 5369 676e 6174 7572 6528 6d6f  tionSignature(mo
-00016210: 6465 6c29 0a0a 2020 2020 7061 7220 3d20  del)..    par = 
-00016220: 286d 6f64 656c 5f6b 7761 7267 732c 2070  (model_kwargs, p
-00016230: 302c 2064 7030 2c20 636f 6e73 7472 6169  0, dp0, constrai
-00016240: 6e74 732c 2066 6978 5061 7273 2c20 6c69  nts, fixPars, li
-00016250: 6d69 7473 290a 2020 2020 7365 6c66 2e5f  mits).    self._
-00016260: 7365 7475 7046 6974 5061 7261 6d65 7465  setupFitParamete
-00016270: 7273 282a 7061 7229 0a0a 2020 2020 2320  rs(*par)..    # 
-00016280: 6372 6561 7465 2063 6f73 7420 6675 6e63  create cost func
-00016290: 7469 6f6e 0a20 2020 2073 656c 662e 636f  tion.    self.co
-000162a0: 7374 6620 3d20 7365 6c66 2e68 436f 7374  stf = self.hCost
-000162b0: 2873 656c 662c 206d 6f64 656c 2c0a 2020  (self, model,.  
-000162c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000162d0: 2020 2020 2020 2020 2020 7573 655f 4761            use_Ga
-000162e0: 7573 7341 7070 726f 783d 7365 6c66 2e75  ussApprox=self.u
-000162f0: 7365 5f47 6175 7373 4170 7072 6f78 2c0a  se_GaussApprox,.
-00016300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016310: 2020 2020 2020 2020 2020 2020 6465 6e73              dens
-00016320: 6974 7920 3d20 7365 6c66 2e66 6974 5f64  ity = self.fit_d
-00016330: 656e 7369 7479 290a 2020 2020 7365 6c66  ensity).    self
-00016340: 2e5f 7365 7475 704d 696e 7569 7428 6d6f  ._setupMinuit(mo
-00016350: 6465 6c5f 6b77 6172 6773 2920 0a20 2020  del_kwargs) .   
-00016360: 2020 200a 2020 636c 6173 7320 6869 7374     .  class hist
-00016370: 4461 7461 436f 6e74 6169 6e65 723a 0a20  DataContainer:. 
-00016380: 2020 2022 2222 0a20 2020 2020 2043 6f6e     """.      Con
-00016390: 7461 696e 6572 2066 6f72 2048 6973 746f  tainer for Histo
-000163a0: 6772 616d 2064 6174 610a 0a20 2020 2020  gram data..     
-000163b0: 2044 6174 6120 4d65 6d62 6572 733a 0a0a   Data Members:..
-000163c0: 2020 2020 2020 2d20 636f 6e74 656e 7473        - contents
-000163d0: 2c20 6172 7261 7920 6f66 2066 6c6f 6174  , array of float
-000163e0: 733a 2062 696e 2063 6f6e 7465 6e74 730a  s: bin contents.
-000163f0: 2020 2020 2020 2d20 6564 6765 732c 2061        - edges, a
-00016400: 7272 6179 206f 6620 666c 6f61 7473 3a20  rray of floats: 
-00016410: 6269 6e20 6564 6765 7320 286e 6269 6e73  bin edges (nbins
-00016420: 2b31 2076 616c 7565 7329 0a0a 2020 2020  +1 values)..    
-00016430: 2020 6361 6c63 756c 6174 6564 2066 726f    calculated fro
-00016440: 6d20 696e 7075 743a 0a0a 2020 2020 2020  m input:..      
-00016450: 2d20 6e62 696e 733a 206e 756d 6265 7220  - nbins: number 
-00016460: 6f66 2062 696e 730a 2020 2020 2020 2d20  of bins.      - 
-00016470: 6c65 6674 733a 206c 6566 7420 6564 6765  lefts: left edge
-00016480: 730a 2020 2020 2020 2d20 7269 6768 7473  s.      - rights
-00016490: 3a20 7269 6768 7420 6564 6765 730a 2020  : right edges.  
-000164a0: 2020 2020 2d20 6365 6e74 6572 733a 2062      - centers: b
-000164b0: 696e 2063 656e 7465 7273 0a20 2020 2020  in centers.     
-000164c0: 202d 2077 6964 7468 733a 2062 696e 2077   - widths: bin w
-000164d0: 6964 7468 730a 2020 2020 2020 2d20 4e74  idths.      - Nt
-000164e0: 6f74 3a20 746f 7461 6c20 6e75 6d62 6572  ot: total number
-000164f0: 206f 6620 656e 7472 6965 732c 2075 7365   of entries, use
-00016500: 6420 746f 206e 6f72 6d61 6c69 7a65 2070  d to normalize p
-00016510: 726f 6261 7469 6c69 7479 2064 656e 7369  robatility densi
-00016520: 7479 0a0a 2020 2020 2020 6176 6169 6c61  ty..      availa
-00016530: 626c 6520 6166 7465 7220 636f 6d70 6c65  ble after comple
-00016540: 7469 6f6e 206f 6620 6669 743a 0a0a 2020  tion of fit:..  
-00016550: 2020 2020 2d20 6d6f 6465 6c5f 7661 6c75      - model_valu
-00016560: 6573 3a20 6269 6e20 636f 6e74 656e 7473  es: bin contents
-00016570: 2066 726f 6d20 6265 7374 2d66 6974 206d   from best-fit m
-00016580: 6f64 656c 200a 0a20 2020 2020 204d 6574  odel ..      Met
-00016590: 686f 6473 3a0a 0a20 2020 2020 202d 2070  hods:..      - p
-000165a0: 6c6f 7428 293a 2072 6574 7572 6e20 6669  lot(): return fi
-000165b0: 6775 7265 2077 6974 6820 6869 7374 6f67  gure with histog
-000165c0: 7261 6d20 6f66 2064 6174 6120 616e 6420  ram of data and 
-000165d0: 756e 6365 7274 6169 6e74 6965 730a 2020  uncertainties.  
-000165e0: 2020 2222 220a 2020 2020 0a20 2020 2064    """.    .    d
-000165f0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00016600: 2c20 6f75 7465 722c 0a20 2020 2020 2020  , outer,.       
-00016610: 2020 2020 2020 2020 2020 6269 6e5f 636f            bin_co
-00016620: 6e74 656e 7473 2c20 6269 6e5f 6564 6765  ntents, bin_edge
-00016630: 732c 2044 656c 7461 4d75 3d4e 6f6e 652c  s, DeltaMu=None,
-00016640: 2071 7569 6574 3d54 7275 6529 3a0a 2020   quiet=True):.  
-00016650: 2020 2020 2222 2220 0a20 2020 2020 2069      """ .      i
-00016660: 6e69 7469 616c 697a 6520 6869 7374 6f67  nitialize histog
-00016670: 7261 6d20 4461 7461 0a0a 2020 2020 2020  ram Data..      
-00016680: 4172 6773 3a0a 2020 2020 2020 2d20 6269  Args:.      - bi
-00016690: 6e5f 636f 6e74 656e 7473 3a20 6172 7261  n_contents: arra
-000166a0: 7920 6f66 2066 6c6f 6174 730a 2020 2020  y of floats.    
-000166b0: 2020 2d20 6269 6e5f 6564 6765 733a 2061    - bin_edges: a
-000166c0: 7272 6179 206f 6620 6c65 6e67 7468 206c  rray of length l
-000166d0: 656e 2862 696e 5f63 6f6e 7465 6e74 7329  en(bin_contents)
-000166e0: 2a31 0a20 2020 2020 202d 2044 656c 7461  *1.      - Delta
-000166f0: 4d75 3a20 6172 7261 7920 6f66 2066 6c6f  Mu: array of flo
-00016700: 6174 732c 2073 6869 6674 206f 6620 6d65  ats, shift of me
-00016710: 616e 206d 7520 7673 2e20 0a20 2020 2020  an mu vs. .     
-00016720: 2020 2020 206c 616d 6264 6120 6f66 2050       lambda of P
-00016730: 6f69 7373 6f6e 2064 6973 7472 6962 7574  oisson distribut
-00016740: 696f 6e2c 2044 656c 7461 4d75 203d 206d  ion, DeltaMu = m
-00016750: 752d 6c61 6d62 6461 200a 2020 2020 2020  u-lambda .      
-00016760: 2d20 7175 6965 743a 2062 6f6f 6c65 616e  - quiet: boolean
-00016770: 2c20 636f 6e74 726f 6c73 2070 7269 6e74  , controls print
-00016780: 6564 206f 7574 7075 740a 0a20 2020 2020  ed output..     
-00016790: 2022 2222 0a0a 2020 2020 2020 7365 6c66   """..      self
-000167a0: 2e6f 7574 6572 203d 206f 7574 6572 0a20  .outer = outer. 
-000167b0: 2020 2020 2073 656c 662e 636f 6e74 656e       self.conten
-000167c0: 7473 203d 2062 696e 5f63 6f6e 7465 6e74  ts = bin_content
-000167d0: 730a 2020 2020 2020 7365 6c66 2e6e 6269  s.      self.nbi
-000167e0: 6e73 3d6c 656e 2862 696e 5f63 6f6e 7465  ns=len(bin_conte
-000167f0: 6e74 7329 0a20 2020 2020 2073 656c 662e  nts).      self.
-00016800: 646c 656e 6774 6820 3d20 7365 6c66 2e6e  dlength = self.n
-00016810: 6269 6e73 0a20 2020 2020 2073 656c 662e  bins.      self.
-00016820: 4e74 6f74 203d 206e 702e 7375 6d28 6269  Ntot = np.sum(bi
-00016830: 6e5f 636f 6e74 656e 7473 290a 2020 2020  n_contents).    
-00016840: 2020 7365 6c66 2e65 6467 6573 203d 2062    self.edges = b
-00016850: 696e 5f65 6467 6573 0a20 2020 2020 2069  in_edges.      i
-00016860: 6620 4465 6c74 614d 7520 6973 204e 6f6e  f DeltaMu is Non
-00016870: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
-00016880: 4465 6c74 614d 7520 3d20 6e70 2e7a 6572  DeltaMu = np.zer
-00016890: 6f73 286c 656e 2862 696e 5f63 6f6e 7465  os(len(bin_conte
-000168a0: 6e74 7329 290a 2020 2020 2020 656c 7365  nts)).      else
-000168b0: 3a0a 2020 2020 2020 2020 7365 6c66 2e44  :.        self.D
-000168c0: 656c 7461 203d 2044 656c 7461 4d75 0a20  elta = DeltaMu. 
-000168d0: 2020 2020 2023 2020 0a20 2020 2020 2073       #  .      s
-000168e0: 656c 662e 6c65 6674 733d 7365 6c66 2e65  elf.lefts=self.e
-000168f0: 6467 6573 5b3a 2d31 5d0a 2020 2020 2020  dges[:-1].      
-00016900: 7365 6c66 2e72 6967 6874 733d 7365 6c66  self.rights=self
-00016910: 2e65 6467 6573 5b31 3a5d 0a20 2020 2020  .edges[1:].     
-00016920: 2073 656c 662e 6365 6e74 6572 7320 3d20   self.centers = 
-00016930: 2873 656c 662e 7269 6768 7473 2020 2b20  (self.rights  + 
-00016940: 7365 6c66 2e6c 6566 7473 292f 322e 0a20  self.lefts)/2.. 
-00016950: 2020 2020 2073 656c 662e 7769 6474 6873       self.widths
-00016960: 203d 2073 656c 662e 7269 6768 7473 202d   = self.rights -
-00016970: 2073 656c 662e 6c65 6674 730a 2020 2020   self.lefts.    
-00016980: 2020 2320 666c 6167 2074 6f20 636f 6e74    # flag to cont
-00016990: 726f 6c20 6669 6e61 6c20 6163 7469 6f6e  rol final action
-000169a0: 7320 696e 2063 6f73 7420 6675 6e63 7469  s in cost functi
-000169b0: 6f6e 0a20 2020 2020 2073 656c 662e 6669  on.      self.fi
-000169c0: 6e61 6c5f 6361 6c6c 203d 2046 616c 7365  nal_call = False
-000169d0: 0a20 2020 2020 2073 656c 662e 6d6f 6465  .      self.mode
-000169e0: 6c5f 7661 6c75 6573 203d 204e 6f6e 650a  l_values = None.
-000169f0: 2020 2020 2020 0a20 2020 2064 6566 2070        .    def p
-00016a00: 6c6f 7428 7365 6c66 2c20 6e75 6d3d 2768  lot(self, num='h
-00016a10: 6973 7444 6174 6120 616e 6420 4d6f 6465  istData and Mode
-00016a20: 6c27 2c0a 2020 2020 2020 2020 2020 2020  l',.            
-00016a30: 2020 2020 2020 2066 6967 7369 7a65 3d28         figsize=(
-00016a40: 372e 352c 2036 2e35 292c 2020 2020 2020  7.5, 6.5),      
-00016a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a60: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00016a70: 2020 2020 2020 2020 2020 2064 6174 615f             data_
-00016a80: 6c61 6265 6c3d 2742 696e 6e65 6420 6461  label='Binned da
-00016a90: 7461 272c 0a20 2020 2020 2020 2020 2020  ta',.           
-00016aa0: 2020 2020 2020 2020 706c 6f74 5f72 6573          plot_res
-00016ab0: 6964 7561 6c3d 4661 6c73 6529 3a0a 0a20  idual=False):.. 
-00016ac0: 2020 2020 2022 2222 7265 7475 726e 2066       """return f
-00016ad0: 6967 7572 6520 7769 7468 2068 6973 746f  igure with histo
-00016ae0: 6772 616d 2064 6174 6120 616e 6420 756e  gram data and un
-00016af0: 6365 7274 6169 6e74 6965 730a 2020 2020  certainties.    
-00016b00: 2020 2222 220a 0a20 2020 2020 2077 203d    """..      w =
-00016b10: 2073 656c 662e 6564 6765 735b 313a 5d20   self.edges[1:] 
-00016b20: 2d20 7365 6c66 2e65 6467 6573 5b3a 2d31  - self.edges[:-1
-00016b30: 5d0a 2020 2020 2020 6669 6720 3d20 706c  ].      fig = pl
-00016b40: 742e 6669 6775 7265 286e 756d 3d6e 756d  t.figure(num=num
-00016b50: 2c20 6669 6773 697a 653d 6669 6773 697a  , figsize=figsiz
-00016b60: 6529 0a20 2020 2020 2069 6620 7365 6c66  e).      if self
-00016b70: 2e6d 6f64 656c 5f76 616c 7565 7320 6973  .model_values is
-00016b80: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00016b90: 2020 2069 6620 706c 6f74 5f72 6573 6964     if plot_resid
-00016ba0: 7561 6c3a 0a20 2020 2020 2020 2020 206d  ual:.          m
-00016bb0: 636f 6e74 7320 3d20 6e70 2e7a 6572 6f73  conts = np.zeros
-00016bc0: 2873 656c 662e 6e62 696e 7329 0a20 2020  (self.nbins).   
-00016bd0: 2020 2020 2020 2062 636f 6e74 7320 3d20         bconts = 
-00016be0: 7365 6c66 2e63 6f6e 7465 6e74 7320 2d20  self.contents - 
-00016bf0: 7365 6c66 2e6d 6f64 656c 5f76 616c 7565  self.model_value
-00016c00: 730a 2020 2020 2020 2020 656c 7365 3a0a  s.        else:.
-00016c10: 2020 2020 2020 2020 2020 6d63 6f6e 7473            mconts
-00016c20: 203d 2073 656c 662e 6d6f 6465 6c5f 7661   = self.model_va
-00016c30: 6c75 6573 0a20 2020 2020 2020 2020 2062  lues.          b
-00016c40: 636f 6e74 7320 3d20 7365 6c66 2e63 6f6e  conts = self.con
-00016c50: 7465 6e74 730a 2020 2020 2020 706c 742e  tents.      plt.
-00016c60: 6261 7228 7365 6c66 2e63 656e 7465 7273  bar(self.centers
-00016c70: 2c20 6263 6f6e 7473 2c0a 2020 2020 2020  , bconts,.      
-00016c80: 2020 2020 2020 2020 616c 6967 6e3d 2763          align='c
-00016c90: 656e 7465 7227 2c20 7769 6474 6820 3d20  enter', width = 
-00016ca0: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
-00016cb0: 2066 6163 6563 6f6c 6f72 3d27 6361 6465   facecolor='cade
-00016cc0: 7462 6c75 6527 2c20 6564 6765 636f 6c6f  tblue', edgecolo
-00016cd0: 723d 2764 6172 6b62 6c75 6527 2c20 616c  r='darkblue', al
-00016ce0: 7068 613d 302e 3636 2c0a 2020 2020 2020  pha=0.66,.      
-00016cf0: 2020 2020 2020 2020 6c61 6265 6c20 3d20          label = 
-00016d00: 6461 7461 5f6c 6162 656c 290a 0a20 2020  data_label)..   
-00016d10: 2020 2023 2073 6574 2061 6e64 2070 6c6f     # set and plo
-00016d20: 7420 6572 726f 7220 6261 7273 0a20 2020  t error bars.   
-00016d30: 2020 2069 6620 7365 6c66 2e6d 6f64 656c     if self.model
-00016d40: 5f76 616c 7565 7320 6973 206e 6f74 204e  _values is not N
-00016d50: 6f6e 653a 0a20 2020 2020 2023 2062 6573  one:.      # bes
-00016d60: 742d 6669 7420 6d6f 6465 6c20 7661 6c75  t-fit model valu
-00016d70: 6573 2061 7661 6961 626c 650a 2020 2020  es avaiable.    
-00016d80: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00016d90: 6f75 7465 722e 7573 655f 4761 7573 7341  outer.use_GaussA
-00016da0: 7070 726f 783a 0a20 2020 2020 2020 2020  pprox:.         
-00016db0: 2023 2073 686f 7720 506f 6973 736f 6e20   # show Poisson 
-00016dc0: 436f 6e66 6964 656e 6365 2049 6e74 6572  Confidence Inter
-00016dd0: 7661 6c73 0a20 2020 2020 2020 2020 2065  vals.          e
-00016de0: 7020 3d20 5b5d 0a20 2020 2020 2020 2020  p = [].         
-00016df0: 2065 6d20 3d20 5b5d 0a20 2020 2020 2020   em = [].       
-00016e00: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00016e10: 6528 7365 6c66 2e6e 6269 6e73 293a 0a20  e(self.nbins):. 
-00016e20: 2020 2020 2020 2020 2020 206c 203d 2028             l = (
-00016e30: 7365 6c66 2e6d 6f64 656c 5f76 616c 7565  self.model_value
-00016e40: 735b 695d 202b 206e 702e 6162 7328 7365  s[i] + np.abs(se
-00016e50: 6c66 2e44 656c 7461 4d75 5b69 5d29 2920  lf.DeltaMu[i])) 
-00016e60: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00016e70: 2020 6d2c 2070 203d 2073 656c 662e 506f    m, p = self.Po
-00016e80: 6973 736f 6e5f 4349 286c 2c20 7369 676d  isson_CI(l, sigm
-00016e90: 613d 312e 290a 2020 2020 2020 2020 2020  a=1.).          
-00016ea0: 2020 6570 2e61 7070 656e 6428 702d 6c29    ep.append(p-l)
-00016eb0: 0a20 2020 2020 2020 2020 2020 2065 6d2e  .            em.
-00016ec0: 6170 7065 6e64 286c 2d6d 290a 2020 2020  append(l-m).    
-00016ed0: 2020 2020 2020 706c 742e 6572 726f 7262        plt.errorb
-00016ee0: 6172 2873 656c 662e 6365 6e74 6572 732c  ar(self.centers,
-00016ef0: 206d 636f 6e74 732c 0a20 2020 2020 2020   mconts,.       
-00016f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f10: 7965 7272 3d28 656d 2c20 6570 292c 2066  yerr=(em, ep), f
-00016f20: 6d74 3d27 2027 2c20 0a20 2020 2020 2020  mt=' ', .       
-00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f40: 6563 6f6c 6f72 3d27 6f6c 6976 6527 2c20  ecolor='olive', 
-00016f50: 6361 7073 697a 653d 332c 2020 0a20 2020  capsize=3,  .   
-00016f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f70: 2020 616c 7068 613d 302e 3829 0a20 2020    alpha=0.8).   
-00016f80: 2020 2020 2065 6c73 653a 2023 2073 686f       else: # sho
-00016f90: 7720 7379 6d6d 6574 7269 6320 6572 726f  w symmetric erro
-00016fa0: 7220 6261 7273 200a 2020 2020 2020 2020  r bars .        
-00016fb0: 2020 6570 203d 206e 702e 7371 7274 2873    ep = np.sqrt(s
-00016fc0: 656c 662e 6d6f 6465 6c5f 7661 6c75 6573  elf.model_values
-00016fd0: 202b 206e 702e 6162 7328 7365 6c66 2e44   + np.abs(self.D
-00016fe0: 656c 7461 4d75 2929 0a20 2020 2020 2020  eltaMu)).       
-00016ff0: 2020 2065 6d20 3d20 5b65 705b 695d 2069     em = [ep[i] i
-00017000: 6620 7365 6c66 2e6d 6f64 656c 5f76 616c  f self.model_val
-00017010: 7565 735b 695d 2d65 705b 695d 3e30 2e20  ues[i]-ep[i]>0. 
-00017020: 656c 7365 2073 656c 662e 6d6f 6465 6c5f  else self.model_
-00017030: 7661 6c75 6573 5b69 5d0a 2020 2020 2020  values[i].      
-00017040: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
-00017050: 696e 2072 616e 6765 286c 656e 2865 7029  in range(len(ep)
-00017060: 295d 0a20 2020 2020 2020 2020 2070 6c74  )].          plt
-00017070: 2e65 7272 6f72 6261 7228 7365 6c66 2e63  .errorbar(self.c
-00017080: 656e 7465 7273 2c20 7365 6c66 2e6d 6f64  enters, self.mod
-00017090: 656c 5f76 616c 7565 732c 0a20 2020 2020  el_values,.     
-000170a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170b0: 2020 7965 7272 3d28 656d 2c20 6570 292c    yerr=(em, ep),
-000170c0: 2066 6d74 3d27 2027 2c20 0a20 2020 2020   fmt=' ', .     
-000170d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170e0: 2020 6563 6f6c 6f72 3d27 6f6c 6976 6527    ecolor='olive'
-000170f0: 2c20 656c 696e 6577 6964 7468 3d32 2c20  , elinewidth=2, 
-00017100: 616c 7068 613d 302e 3829 0a20 2020 2020  alpha=0.8).     
-00017110: 2065 6c73 653a 2023 206e 6f20 6d6f 6465   else: # no mode
-00017120: 6c20 7661 6c75 6573 2061 7661 696c 6162  l values availab
-00017130: 6c65 2028 7965 7429 2c20 7368 6f77 2065  le (yet), show e
-00017140: 7272 6f72 2062 6172 7320 7265 6c61 7465  rror bars relate
-00017150: 6420 746f 2064 6174 6120 2020 2020 200a  d to data      .
-00017160: 2020 2020 2020 2020 6570 203d 206e 702e          ep = np.
-00017170: 7371 7274 2873 656c 662e 636f 6e74 656e  sqrt(self.conten
-00017180: 7473 202b 206e 702e 6162 7328 7365 6c66  ts + np.abs(self
-00017190: 2e44 656c 7461 4d75 2929 0a20 2020 2020  .DeltaMu)).     
-000171a0: 2020 2065 6d20 3d20 5b65 705b 695d 2069     em = [ep[i] i
-000171b0: 6620 7365 6c66 2e63 6f6e 7465 6e74 735b  f self.contents[
-000171c0: 695d 2d65 705b 695d 3e30 2e20 656c 7365  i]-ep[i]>0. else
-000171d0: 2073 656c 662e 636f 6e74 656e 7473 5b69   self.contents[i
-000171e0: 5d20 666f 7220 6920 696e 2072 616e 6765  ] for i in range
-000171f0: 286c 656e 2865 7029 295d 2020 2020 2020  (len(ep))]      
-00017200: 0a20 2020 2020 2020 2070 6c74 2e65 7272  .        plt.err
-00017210: 6f72 6261 7228 7365 6c66 2e63 656e 7465  orbar(self.cente
-00017220: 7273 2c20 6263 6f6e 7473 2c0a 2020 2020  rs, bconts,.    
-00017230: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00017240: 6572 723d 2865 6d2c 2065 7029 2c0a 2020  err=(em, ep),.  
-00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017260: 2066 6d74 3d27 5f27 2c20 636f 6c6f 723d   fmt='_', color=
-00017270: 2764 6172 6b62 6c75 6527 2c20 6d61 726b  'darkblue', mark
-00017280: 6572 7369 7a65 3d31 352c 0a20 2020 2020  ersize=15,.     
-00017290: 2020 2020 2020 2020 2020 2020 2020 6563                ec
-000172a0: 6f6c 6f72 3d27 6461 726b 626c 7565 272c  olor='darkblue',
-000172b0: 2061 6c70 6861 3d30 2e38 290a 2020 2020   alpha=0.8).    
-000172c0: 2020 7265 7475 726e 2066 6967 0a0a 2020    return fig..  
-000172d0: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-000172e0: 2020 2020 6465 6620 506f 6973 736f 6e5f      def Poisson_
-000172f0: 4349 286c 616d 2c20 7369 676d 613d 312e  CI(lam, sigma=1.
-00017300: 293a 0a20 2020 2020 2022 2222 0a20 2020  ):.      """.   
-00017310: 2020 2064 6574 6572 6d69 6e65 206f 6e65     determine one
-00017320: 2d73 6967 6d61 2043 6f6e 6669 6465 6e63  -sigma Confidenc
-00017330: 6520 496e 7465 7276 616c 2061 726f 756e  e Interval aroun
-00017340: 6420 7468 6520 0a20 2020 2020 206d 6561  d the .      mea
-00017350: 6e20 6c61 6d62 6461 206f 6620 6120 506f  n lambda of a Po
-00017360: 6973 736f 6e20 6469 7374 7269 6275 7469  isson distributi
-00017370: 6f6e 2c20 506f 6973 7328 782c 206c 616d  on, Poiss(x, lam
-00017380: 6264 6129 2e20 0a0a 2020 2020 2020 5468  bda). ..      Th
-00017390: 6520 6d65 7468 6f64 2069 7320 6261 7365  e method is base
-000173a0: 6420 6f6e 2064 656c 7461 2d6c 6f67 2d4c  d on delta-log-L
-000173b0: 696b 656c 6968 6f6f 6420 2864 6c4c 2920  ikelihood (dlL) 
-000173c0: 0a20 2020 2020 206f 6620 7468 6520 506f  .      of the Po
-000173d0: 6973 7369 6f6e 206c 696b 656c 6968 6f6f  ission likelihoo
-000173e0: 6420 0a0a 2020 2020 2020 4172 6773 3a0a  d ..      Args:.
-000173f0: 2020 2020 2020 202d 206c 616d 3a20 6d65         - lam: me
-00017400: 616e 206f 6620 506f 6973 7369 6f6e 2064  an of Poission d
-00017410: 6973 7472 6962 7574 696f 6e0a 2020 2020  istribution.    
-00017420: 2020 202d 2063 6c3a 2064 6573 6972 6564     - cl: desired
-00017430: 2063 6f6e 6669 6465 6e63 6520 6c65 7665   confidence leve
-00017440: 6c0a 2020 2020 2020 202d 2073 6967 6d61  l.       - sigma
-00017450: 3a20 616c 7465 726e 6174 6976 656c 7920  : alternatively 
-00017460: 7370 6563 6966 7920 616e 206e 2d73 6967  specify an n-sig
-00017470: 6d61 2069 6e74 6572 7661 6c0a 2020 2020  ma interval.    
-00017480: 2020 2222 220a 0a20 2020 2020 2023 2066    """..      # f
-00017490: 756e 6374 696f 6e73 0a20 2020 2020 2064  unctions.      d
-000174a0: 6566 206e 6c4c 506f 6973 736f 6e28 782c  ef nlLPoisson(x,
-000174b0: 206c 616d 293a 0a20 2020 2020 2020 2022   lam):.        "
-000174c0: 2222 6e65 6761 7469 7665 206c 6f67 2d6c  ""negative log-l
-000174d0: 696b 656c 6968 6f6f 6420 6f66 2050 6f69  ikelihood of Poi
-000174e0: 7373 6f69 6e20 6469 7374 7262 7574 696f  ssoin distrbutio
-000174f0: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
-00017500: 2020 2020 2020 7265 7475 726e 206c 616d        return lam
-00017510: 202d 2078 2a6e 702e 6c6f 6728 6c61 6d29   - x*np.log(lam)
-00017520: 202b 206c 6f67 6761 6d6d 6128 782b 312e   + loggamma(x+1.
-00017530: 290a 0a20 2020 2020 2064 6566 2066 2878  )..      def f(x
-00017540: 2c20 6c61 6d2c 2064 6c4c 293a 0a20 2020  , lam, dlL):.   
-00017550: 2020 2020 2022 2222 4465 6c74 6120 6c6f       """Delta lo
-00017560: 672d 4c20 2d20 6f66 6673 6574 2c20 696e  g-L - offset, in
-00017570: 7075 7420 746f 204e 6577 746f 6e20 6d65  put to Newton me
-00017580: 7468 6f64 0a20 2020 2020 2020 2022 2222  thod.        """
-00017590: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000175a0: 6e6c 4c50 6f69 7373 6f6e 2878 2c20 6c61  nlLPoisson(x, la
-000175b0: 6d29 202d 206e 6c4c 506f 6973 736f 6e28  m) - nlLPoisson(
-000175c0: 6c61 6d2c 206c 616d 2920 2d20 646c 4c0a  lam, lam) - dlL.
-000175d0: 0a20 2020 2020 2064 6c4c 203d 2030 2e35  .      dlL = 0.5
-000175e0: 2a73 6967 6d61 2a73 6967 6d61 200a 0a20  *sigma*sigma .. 
-000175f0: 2020 2020 2023 2066 6f72 2064 6c4c 3d30       # for dlL=0
-00017600: 2e35 2c20 7468 6572 6520 6973 206f 6e6c  .5, there is onl
-00017610: 7920 6f6e 6520 696e 7465 7273 6563 7469  y one intersecti
-00017620: 6f6e 2077 6974 6820 7a65 726f 2066 6f72  on with zero for
-00017630: 206c 616d 3c31 2e38 0a20 2020 2020 2064   lam<1.8.      d
-00017640: 6c20 3d20 312e 322a 6e70 2e73 7172 7428  l = 1.2*np.sqrt(
-00017650: 6c61 6d29 0a20 2020 2020 2064 6c6d 203d  lam).      dlm =
-00017660: 206d 696e 2864 6c2c 206c 616d 290a 2020   min(dl, lam).  
-00017670: 2020 2020 6370 203d 206e 6577 746f 6e28      cp = newton(
-00017680: 662c 2078 303d 6c61 6d2b 646c 2c20 7831  f, x0=lam+dl, x1
-00017690: 3d6c 616d 2c20 6172 6773 3d28 6c61 6d2c  =lam, args=(lam,
-000176a0: 2064 6c4c 2929 0a20 2020 2020 2074 7279   dlL)).      try
-000176b0: 3a20 2320 6d61 7920 6e6f 7420 636f 6e76  : # may not conv
-000176c0: 6572 6765 2066 6f72 2073 6d61 6c6c 206c  erge for small l
-000176d0: 616d 6264 612c 2061 7320 7468 6572 6520  ambda, as there 
-000176e0: 6973 206e 6f20 696e 7465 7273 6563 7469  is no intersecti
-000176f0: 6f6e 203c 206c 616d 0a20 2020 2020 2020  on < lam.       
-00017700: 2063 6d20 3d20 6e65 7774 6f6e 2866 2c20   cm = newton(f, 
-00017710: 7830 3d6c 616d 2d64 6c6d 2c20 7831 3d6c  x0=lam-dlm, x1=l
-00017720: 616d 2c20 6172 6773 3d28 6c61 6d2c 2064  am, args=(lam, d
-00017730: 6c4c 2929 0a20 2020 2020 2065 7863 6570  lL)).      excep
-00017740: 743a 0a20 2020 2020 2020 2063 6d20 3d20  t:.        cm = 
-00017750: 302e 0a20 2020 2020 2069 6620 2863 702d  0..      if (cp-
-00017760: 636d 293c 6c61 6d2f 3130 302e 3a20 2320  cm)<lam/100.: # 
-00017770: 666f 756e 6420 7361 6d65 2069 6e74 6572  found same inter
-00017780: 7365 6374 696f 6e2c 0a20 2020 2020 2020  section,.       
-00017790: 2063 6d20 3d20 302e 2020 2020 2020 2020   cm = 0.        
-000177a0: 2020 2020 2320 2073 6574 2031 7374 206f      #  set 1st o
-000177b0: 6e65 2074 6f20 302e 2020 0a20 0a20 2020  ne to 0.  . .   
-000177c0: 2020 2072 6574 7572 6e20 636d 2c20 6370     return cm, cp
-000177d0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-000177e0: 200a 2020 2320 2d2d 2d20 636f 7374 2066   .  # --- cost f
-000177f0: 756e 6374 696f 6e20 666f 7220 6869 7374  unction for hist
-00017800: 6f67 7261 6d20 6461 7461 0a20 2063 6c61  ogram data.  cla
-00017810: 7373 2068 436f 7374 3a0a 2020 2020 2222  ss hCost:.    ""
-00017820: 2220 2020 2043 6f73 7420 6675 6e63 7469  "    Cost functi
-00017830: 6f6e 2066 6f72 2062 696e 6e65 6420 6461  on for binned da
-00017840: 7461 0a0a 2020 2020 5468 6520 5f5f 6361  ta..    The __ca
-00017850: 6c6c 5f5f 206d 6574 686f 6420 6f66 2074  ll__ method of t
-00017860: 6869 7320 636c 6173 7320 6973 2063 616c  his class is cal
-00017870: 6c65 6420 6279 2069 6d69 6e75 6974 2e0a  led by iminuit..
-00017880: 0a20 2020 2054 6865 2064 6566 6175 6c74  .    The default
-00017890: 2063 6f73 7420 6675 6e63 7469 6f6e 2074   cost function t
-000178a0: 6f20 6d69 6e69 6d6f 7a65 2069 7320 7477  o minimoze is tw
-000178b0: 6963 6520 7468 6520 6e65 6761 7469 7665  ice the negative
-000178c0: 200a 2020 2020 6c6f 672d 6c69 6b65 6c69   .    log-likeli
-000178d0: 686f 6f64 206f 6620 7468 6520 506f 6973  hood of the Pois
-000178e0: 736f 6e20 6469 7374 7269 6275 7469 6f6e  son distribution
-000178f0: 2067 656e 6572 616c 697a 6564 2074 6f20   generalized to 
-00017900: 0a20 2020 2063 6f6e 7469 6e75 6f75 7320  .    continuous 
-00017910: 6f62 7365 7276 6174 696f 6e73 2078 2062  observations x b
-00017920: 7920 7265 706c 6163 696e 6720 6b21 2062  y replacing k! b
-00017930: 7920 7468 6520 6761 6d6d 6120 6675 6e63  y the gamma func
-00017940: 7469 6f6e 3a0a 0a20 2020 202e 2e20 6d61  tion:..    .. ma
-00017950: 7468 3a3a 0a20 2020 2020 2020 2063 6f73  th::.        cos
-00017960: 7428 783b 5c6c 616d 6264 6129 203d 2032  t(x;\lambda) = 2
-00017970: 205c 6c61 6d62 6461 2028 5c6c 616d 6264   \lambda (\lambd
-00017980: 6120 2d20 782a 5c6c 6e28 5c6c 616d 6264  a - x*\ln(\lambd
-00017990: 6129 202b 205c 6c6e 5c47 616d 6d61 2878  a) + \ln\Gamma(x
-000179a0: 2b31 2e29 290a 0a20 2020 2041 6c74 6572  +1.))..    Alter
-000179b0: 6e61 7469 7665 6c79 2c20 7468 6520 4761  natively, the Ga
-000179c0: 7573 7369 616e 2061 7070 726f 7869 6d61  ussian approxima
-000179d0: 7469 6f6e 2069 7320 6176 6169 6c61 626c  tion is availabl
-000179e0: 653a 0a0a 2020 2020 2e2e 206d 6174 683a  e:..    .. math:
-000179f0: 3a0a 2020 2020 2020 2020 636f 7374 2878  :.        cost(x
-00017a00: 3b5c 6c61 6d62 6461 2920 3d20 2878 202d  ;\lambda) = (x -
-00017a10: 205c 6c61 6d62 6461 295e 3220 2f20 5c6c   \lambda)^2 / \l
-00017a20: 616d 6264 6120 2b20 5c6c 6e28 5c6c 616d  ambda + \ln(\lam
-00017a30: 6264 6129 0a20 2020 2020 2020 2020 2020  bda).           
-00017a40: 0a20 2020 2054 6865 2069 6d70 6c65 6d65  .    The impleme
-00017a50: 6e74 6174 696f 6e20 616c 736f 2070 6572  ntation also per
-00017a60: 6d69 7473 2074 6f20 7368 6966 7420 7468  mits to shift th
-00017a70: 6520 6f62 7365 7276 6174 696f 6e20 7820  e observation x 
-00017a80: 6279 2061 6e0a 2020 2020 6f66 6673 6574  by an.    offset
-00017a90: 2074 6f20 7461 6b65 2069 6e74 6f20 6163   to take into ac
-00017aa0: 636f 756e 7420 636f 7272 6563 7469 6f6e  count correction
-00017ab0: 7320 746f 2074 6865 206e 756d 6265 7220  s to the number 
-00017ac0: 6f66 206f 6273 6572 7665 640a 2020 2020  of observed.    
-00017ad0: 6269 6e20 656e 7472 6965 7320 2865 2e67  bin entries (e.g
-00017ae0: 2e20 6475 6520 746f 2062 6163 6b67 726f  . due to backgro
-00017af0: 756e 6420 6f72 2065 6666 6963 6965 6e63  und or efficienc
-00017b00: 7920 636f 7272 6563 7469 6f6e 7329 3a0a  y corrections):.
-00017b10: 2020 2020 7820 2d3e 2078 2d64 656c 7461      x -> x-delta
-00017b20: 4d75 2077 6974 6820 6465 6c74 614d 7520  Mu with deltaMu 
-00017b30: 3d20 6d75 202d 206c 616d 6264 612c 2077  = mu - lambda, w
-00017b40: 6865 7265 206d 7520 6973 2074 6865 206d  here mu is the m
-00017b50: 6561 6e0a 2020 2020 6f66 2074 6865 2073  ean.    of the s
-00017b60: 6869 6674 6564 2050 6f69 7373 6f6e 206f  hifted Poisson o
-00017b70: 7220 4761 75c3 9f20 6469 7374 7269 6275  r Gau.. distribu
-00017b80: 7469 6f6e 2e20 200a 0a20 2020 2054 6865  tion.  ..    The
-00017b90: 206e 756d 6265 7220 6f66 2062 696e 2065   number of bin e
-00017ba0: 6e74 7269 6573 2070 7265 6469 6374 6564  ntries predicted
-00017bb0: 2062 7920 7468 6520 6d6f 6465 6c20 6465   by the model de
-00017bc0: 6e73 6974 7920 6973 2063 616c 6375 6c61  nsity is calcula
-00017bd0: 7465 640a 2020 2020 6279 2061 6e20 6170  ted.    by an ap
-00017be0: 7072 6f78 696d 6174 6520 696e 7465 6772  proximate integr
-00017bf0: 616c 206f 7665 7220 7468 6520 7265 7370  al over the resp
-00017c00: 6563 7469 7665 2062 696e 2072 616e 6765  ective bin range
-00017c10: 7320 7573 696e 6720 7468 650a 2020 2020  s using the.    
-00017c20: 5369 6d70 736f 6e20 7275 6c65 2e20 0a0a  Simpson rule. ..
-00017c30: 2020 2020 546f 206a 7564 6765 2074 6865      To judge the
-00017c40: 206c 6576 656c 206f 6620 6167 7265 656d   level of agreem
-00017c50: 656e 7420 6f66 206d 6f64 656c 2064 656e  ent of model den
-00017c60: 7369 7479 2061 6e64 2068 6973 746f 6772  sity and histogr
-00017c70: 616d 2064 6174 612c 200a 2020 2020 6120  am data, .    a 
-00017c80: 2267 6f6f 646e 6573 732d 6f66 2d66 6974  "goodness-of-fit
-00017c90: 2220 282a 676f 662a 2920 7661 6c75 6520  " (*gof*) value 
-00017ca0: 6973 2063 616c 756c 6174 6564 2061 7320  is calulated as 
-00017cb0: 7468 6520 6c69 6b65 6c69 686f 6f64 2d72  the likelihood-r
-00017cc0: 6174 696f 206f 660a 2020 2020 7468 6520  atio of.    the 
-00017cd0: 6d6f 6465 6c20 772e 722e 742e 2074 6865  model w.r.t. the
-00017ce0: 2064 6174 6120 616e 6420 7468 6520 736f   data and the so
-00017cf0: 2d63 616c 6c65 6420 2273 6174 7572 6174  -called "saturat
-00017d00: 6564 206d 6f64 656c 2220 6465 7363 7269  ed model" descri
-00017d10: 6269 6e67 200a 2020 2020 7468 6520 6461  bing .    the da
-00017d20: 7461 2070 6572 6665 6374 6c79 2c20 692e  ta perfectly, i.
-00017d30: 652e 2020 3a6d 6174 683a 6063 6f73 745f  e.  :math:`cost_
-00017d40: 7b73 6174 7d28 7829 203d 2063 6f73 7428  {sat}(x) = cost(
-00017d50: 783b 205c 6c61 6d62 6461 3d78 2960 2e0a  x; \lambda=x)`..
-00017d60: 2020 2020 4966 2074 6865 2062 696e 2065      If the bin e
-00017d70: 6e74 7269 6573 2061 7265 2073 7566 6669  ntries are suffi
-00017d80: 6369 656e 746c 7920 6c61 7267 652c 202a  ciently large, *
-00017d90: 676f 662a 2063 6f6e 7665 7267 6573 2074  gof* converges t
-00017da0: 6f20 7468 6520 7374 616e 6461 7264 200a  o the standard .
-00017db0: 2020 2020 2a63 6869 322a 2076 616c 7565      *chi2* value
-00017dc0: 2e20 0a0a 2020 2020 496e 7075 743a 0a0a  . ..    Input:..
-00017dd0: 2020 2020 2d20 6f75 7465 723a 2070 6f69      - outer: poi
-00017de0: 6e74 6572 2074 6f20 696e 7374 616e 6365  nter to instance
-00017df0: 206f 6620 6361 6c6c 696e 6720 636c 6173   of calling clas
-00017e00: 730a 2020 2020 2d20 6d6f 6465 6c3a 206d  s.    - model: m
-00017e10: 6f64 656c 2066 756e 6374 696f 6e20 6628  odel function f(
-00017e20: 782c 205c 2a70 6172 290a 2020 2020 2d20  x, \*par).    - 
-00017e30: 7573 655f 4761 7573 7341 7070 726f 782c  use_GaussApprox,
-00017e40: 2062 6f6f 6c3a 2075 7365 2047 6175 7373   bool: use Gauss
-00017e50: 6961 6e20 6170 7072 6f78 696d 6174 696f  ian approximatio
-00017e60: 6e20 0a20 2020 202d 2064 656e 7369 7479  n .    - density
-00017e70: 2c20 626f 6f6c 3a20 6669 7420 6120 6e6f  , bool: fit a no
-00017e80: 726d 616c 6973 6564 2064 656e 7369 7479  rmalised density
-00017e90: 3b20 6966 2046 616c 7365 2c20 616e 206f  ; if False, an o
-00017ea0: 7665 7261 6c6c 0a20 2020 2020 206e 6f72  verall.      nor
-00017eb0: 6d61 6c69 7361 7469 6f6e 206d 7573 7420  malisation must 
-00017ec0: 6265 2070 726f 7669 6465 6420 696e 2074  be provided in t
-00017ed0: 6865 206d 6f64 656c 2066 756e 6374 696f  he model functio
-00017ee0: 6e0a 0a20 2020 2044 6174 6120 6d65 6d62  n..    Data memb
-00017ef0: 6572 733a 0a0a 2020 2020 2d20 6e64 6f66  ers:..    - ndof
-00017f00: 3a20 6465 6772 6565 7320 6f66 2066 7265  : degrees of fre
-00017f10: 6564 6f6d 200a 2020 2020 2d20 6e63 6f6e  edom .    - ncon
-00017f20: 7374 7261 696e 7473 3a20 6e75 6d62 6572  straints: number
-00017f30: 206f 6620 7061 7261 6d65 7465 7220 636f   of parameter co
-00017f40: 6e73 7472 6169 6e74 730a 2020 2020 2d20  nstraints.    - 
-00017f50: 676f 663a 2067 6f6f 646e 6573 732d 6f66  gof: goodness-of
-00017f60: 2d66 6974 2061 7320 6c69 6b65 6c69 686f  -fit as likeliho
-00017f70: 6f64 2072 6174 696f 2077 2e72 2e74 2e20  od ratio w.r.t. 
-00017f80: 7468 6520 2773 6174 7572 6174 6564 206d  the 'saturated m
-00017f90: 6f64 656c 270a 0a20 2020 2045 7874 6572  odel'..    Exter
-00017fa0: 6e61 6c20 7265 6665 7265 6e63 6573 3a0a  nal references:.
-00017fb0: 0a20 2020 202d 206d 6f64 656c 2878 2c20  .    - model(x, 
-00017fc0: 5c2a 7061 7229 3a20 7468 6520 6d6f 6465  \*par): the mode
-00017fd0: 6c20 6675 6e63 7469 6f6e 200a 2020 2020  l function .    
-00017fe0: 2d20 6461 7461 3a20 706f 696e 7465 7220  - data: pointer 
-00017ff0: 746f 2069 6e73 7461 6e63 6520 6f66 2063  to instance of c
-00018000: 6c61 7373 2068 6973 7444 6174 610a 2020  lass histData.  
-00018010: 2020 2d20 6461 7461 2e6d 6f64 656c 5f76    - data.model_v
-00018020: 616c 7565 733a 2062 696e 2065 6e74 7269  alues: bin entri
-00018030: 6573 2063 616c 6375 6c61 7465 6420 6279  es calculated by
-00018040: 2074 6865 2062 6573 742d 6669 7420 6d6f   the best-fit mo
-00018050: 6465 6c0a 2020 2020 2222 220a 0a20 2020  del.    """..   
-00018060: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00018070: 6c66 2c20 6f75 7465 722c 200a 2020 2020  lf, outer, .    
-00018080: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00018090: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
-000180a0: 2020 2020 2075 7365 5f47 6175 7373 4170       use_GaussAp
-000180b0: 7072 6f78 3d46 616c 7365 2c20 6465 6e73  prox=False, dens
-000180c0: 6974 793d 2054 7275 6529 3a0a 2020 2020  ity= True):.    
-000180d0: 2020 6672 6f6d 2069 6d69 6e75 6974 2e75    from iminuit.u
-000180e0: 7469 6c20 696d 706f 7274 206d 616b 655f  til import make_
-000180f0: 6675 6e63 5f63 6f64 650a 0a20 2020 2020  func_code..     
-00018100: 2023 2064 6174 6120 6f62 6a65 6374 206f   # data object o
-00018110: 6620 7479 7065 2068 6973 7444 6174 6143  f type histDataC
-00018120: 6f6e 7461 696e 7465 720a 2020 2020 2020  ontainter.      
-00018130: 7365 6c66 2e64 6174 6120 3d20 6f75 7465  self.data = oute
-00018140: 722e 6844 6174 610a 2020 2020 2020 6966  r.hData.      if
-00018150: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00018160: 7365 6c66 2e64 6174 612c 206d 6e46 6974  self.data, mnFit
-00018170: 2e68 6973 7444 6174 6143 6f6e 7461 696e  .histDataContain
-00018180: 6572 293a 0a20 2020 2020 2020 2072 6169  er):.        rai
-00018190: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-000181a0: 2020 2020 2020 2020 2022 2021 2121 206d           " !!! m
-000181b0: 6e46 6974 2e68 436f 7374 3a20 6578 7065  nFit.hCost: expe
-000181c0: 6374 696e 6720 6461 7461 2063 6f6e 7461  cting data conta
-000181d0: 696e 6572 206f 6620 7479 7065 2027 6869  iner of type 'hi
-000181e0: 7374 4461 7461 436f 6e74 6169 6e65 7227  stDataContainer'
-000181f0: 2229 0a20 2020 2020 200a 2020 2020 2020  ").      .      
-00018200: 7365 6c66 2e6d 6f64 656c 203d 206d 6f64  self.model = mod
-00018210: 656c 0a20 2020 2020 2073 656c 662e 6465  el.      self.de
-00018220: 6e73 6974 7920 3d20 6465 6e73 6974 790a  nsity = density.
-00018230: 2020 2020 2020 7365 6c66 2e47 6175 7373        self.Gauss
-00018240: 4170 7072 6f78 203d 2075 7365 5f47 6175  Approx = use_Gau
-00018250: 7373 4170 7072 6f78 0a20 2020 2020 2073  ssApprox.      s
-00018260: 656c 662e 7175 6965 7420 3d20 6f75 7465  elf.quiet = oute
-00018270: 722e 7175 6965 740a 2020 2020 2020 0a20  r.quiet.      . 
-00018280: 2020 2020 2023 2073 6574 2070 726f 7065       # set prope
-00018290: 7220 7369 676e 6174 7572 6520 6f66 206d  r signature of m
-000182a0: 6f64 656c 2066 756e 6374 696f 6e20 666f  odel function fo
-000182b0: 7220 696d 696e 7569 740a 2020 2020 2020  r iminuit.      
-000182c0: 7365 6c66 2e70 6e61 6d73 203d 206f 7574  self.pnams = out
-000182d0: 6572 2e70 6e61 6d73 0a20 2020 2020 2073  er.pnams.      s
-000182e0: 656c 662e 6675 6e63 5f63 6f64 6520 3d20  elf.func_code = 
-000182f0: 6d61 6b65 5f66 756e 635f 636f 6465 2873  make_func_code(s
-00018300: 656c 662e 706e 616d 7329 0a20 2020 2020  elf.pnams).     
-00018310: 2073 656c 662e 6e70 6172 203d 206f 7574   self.npar = out
-00018320: 6572 2e6e 7061 720a 200a 2020 2020 2020  er.npar. .      
-00018330: 7365 6c66 2e63 6f6e 7374 7261 696e 7473  self.constraints
-00018340: 203d 206f 7574 6572 2e63 6f6e 7374 7261   = outer.constra
-00018350: 696e 7473 0a20 2020 2020 2073 656c 662e  ints.      self.
-00018360: 6e63 6f6e 7374 7261 696e 7473 203d 6c65  nconstraints =le
-00018370: 6e28 7365 6c66 2e63 6f6e 7374 7261 696e  n(self.constrain
-00018380: 7473 290a 2020 2020 2020 2320 7461 6b65  ts).      # take
-00018390: 2061 6363 6f75 6e74 206f 6620 636f 6e73   account of cons
-000183a0: 7472 6169 6e74 7320 696e 2064 6567 7265  traints in degre
-000183b0: 6573 206f 6620 6672 6565 646f 6d20 0a20  es of freedom . 
-000183c0: 2020 2020 2073 656c 662e 6e64 6f66 203d       self.ndof =
-000183d0: 2073 656c 662e 6461 7461 2e6e 6269 6e73   self.data.nbins
-000183e0: 2d73 656c 662e 6e70 6172 2b73 656c 662e  -self.npar+self.
-000183f0: 6e63 6f6e 7374 7261 696e 7473 2b6f 7574  nconstraints+out
-00018400: 6572 2e6e 6669 7865 640a 0a20 2020 2020  er.nfixed..     
-00018410: 2023 2066 6c61 6720 746f 2063 6f6e 7472   # flag to contr
-00018420: 6f6c 2066 696e 616c 2061 6374 696f 6e73  ol final actions
-00018430: 2069 6e20 636f 7374 2066 756e 6374 696f   in cost functio
-00018440: 6e0a 2020 2020 2020 7365 6c66 2e66 696e  n.      self.fin
-00018450: 616c 5f63 616c 6c20 3d20 4661 6c73 650a  al_call = False.
-00018460: 0a20 2020 2020 2069 6620 7365 6c66 2e47  .      if self.G
-00018470: 6175 7373 4170 7072 6f78 3a0a 2020 2020  aussApprox:.    
-00018480: 2020 2020 7365 6c66 2e6e 326c 4c63 6f73      self.n2lLcos
-00018490: 7420 3d20 7365 6c66 2e6e 326c 4c47 6175  t = self.n2lLGau
-000184a0: 7373 0a20 2020 2020 2065 6c73 653a 0a20  ss.      else:. 
-000184b0: 2020 2020 2020 2073 656c 662e 6e32 6c4c         self.n2lL
-000184c0: 636f 7374 203d 2073 656c 662e 6e32 6c4c  cost = self.n2lL
-000184d0: 506f 6973 736f 6e0a 0a20 2020 2020 2069  Poisson..      i
-000184e0: 6620 7365 6c66 2e64 656e 7369 7479 3a0a  f self.density:.
-000184f0: 2020 2020 2020 2020 7365 6c66 2e6e 6f72          self.nor
-00018500: 6d20 3d20 7365 6c66 2e64 6174 612e 4e74  m = self.data.Nt
-00018510: 6f74 0a20 2020 2020 2065 6c73 653a 0a20  ot.      else:. 
-00018520: 2020 2020 2020 2073 656c 662e 6e6f 726d         self.norm
-00018530: 203d 2031 2e0a 2020 2020 2020 2020 0a20   = 1..        . 
-00018540: 2020 2064 6566 205f 5f63 616c 6c5f 5f28     def __call__(
-00018550: 7365 6c66 2c20 2a70 6172 293a 0a20 2020  self, *par):.   
-00018560: 2020 2023 2063 616c 6c65 6420 6974 6572     # called iter
-00018570: 6174 6976 656c 7920 6279 206d 696e 7569  atively by minui
-00018580: 740a 0a20 2020 2020 2023 2063 6f73 7420  t..      # cost 
-00018590: 6675 6e63 7469 6f6e 2069 7320 6c69 6b65  function is like
-000185a0: 6c69 686f 6f64 206f 6620 7368 6966 7465  lihood of shifte
-000185b0: 6420 506f 6973 736f 6e20 6f72 2047 6175  d Poisson or Gau
-000185c0: 7373 2061 7070 726f 7869 6d61 7469 6f6e  ss approximation
-000185d0: 0a0a 2020 2020 2020 2320 2d20 6669 7273  ..      # - firs
-000185e0: 742c 2074 616b 6520 696e 746f 2061 6363  t, take into acc
-000185f0: 6f75 6e74 2070 6f73 7369 626c 6520 7061  ount possible pa
-00018600: 7261 6d65 7465 7220 636f 6e73 7472 6169  rameter constrai
-00018610: 6e74 7320 200a 2020 2020 2020 6e32 6c4c  nts  .      n2lL
-00018620: 3d20 302e 0a20 2020 2020 2069 6620 7365  = 0..      if se
-00018630: 6c66 2e6e 636f 6e73 7472 6169 6e74 733a  lf.nconstraints:
-00018640: 0a20 2020 2020 2020 2066 6f72 2063 2069  .        for c i
-00018650: 6e20 7365 6c66 2e63 6f6e 7374 7261 696e  n self.constrain
-00018660: 7473 3a0a 2020 2020 2020 2020 2020 705f  ts:.          p_
-00018670: 6964 203d 2063 5b30 5d0a 2020 2020 2020  id = c[0].      
-00018680: 2020 2020 7220 3d20 2820 7061 725b 705f      r = ( par[p_
-00018690: 6964 5d20 2d20 635b 315d 2920 2f20 635b  id] - c[1]) / c[
-000186a0: 325d 200a 2020 2020 2020 2020 2020 6e32  2] .          n2
-000186b0: 6c4c 202b 3d20 722a 720a 0a20 2020 2020  lL += r*r..     
-000186c0: 2023 202d 2063 616c 6375 6c61 7465 2032   # - calculate 2
-000186d0: 2a6e 6567 4c6f 674c 2050 6f69 7373 6f6e  *negLogL Poisson
-000186e0: 3b0a 2020 2020 2020 2320 206d 6f64 656c  ;.      #  model
-000186f0: 2070 7265 6469 6374 696f 6e20 6173 2061   prediction as a
-00018700: 7070 726f 7869 6d61 7465 2069 6e74 6567  pproximate integ
-00018710: 7261 6c20 6f76 6572 2062 696e 0a20 2020  ral over bin.   
-00018720: 2020 206d 6f64 656c 5f76 616c 7565 7320     model_values 
-00018730: 3d20 7365 6c66 2e6e 6f72 6d20 2a20 7365  = self.norm * se
-00018740: 6c66 2e69 6e74 6567 7261 6c5f 6f76 6572  lf.integral_over
-00018750: 4269 6e73 280a 2020 2020 2020 2020 7365  Bins(.        se
-00018760: 6c66 2e64 6174 612e 6c65 6674 732c 2073  lf.data.lefts, s
-00018770: 656c 662e 6461 7461 2e72 6967 6874 732c  elf.data.rights,
-00018780: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
-00018790: 6465 6c2c 202a 7061 7229 200a 2020 2020  del, *par) .    
-000187a0: 2020 2320 0a0a 2020 2020 2020 6e32 6c4c    # ..      n2lL
-000187b0: 202b 3d20 6e70 2e73 756d 280a 2020 2020   += np.sum(.    
-000187c0: 2020 2020 7365 6c66 2e6e 326c 4c63 6f73      self.n2lLcos
-000187d0: 7428 2073 656c 662e 6461 7461 2e63 6f6e  t( self.data.con
-000187e0: 7465 6e74 7320 2d20 7365 6c66 2e64 6174  tents - self.dat
-000187f0: 612e 4465 6c74 614d 752c 200a 2020 2020  a.DeltaMu, .    
-00018800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018810: 2020 6d6f 6465 6c5f 7661 6c75 6573 202b    model_values +
-00018820: 206e 702e 6162 7328 7365 6c66 2e64 6174   np.abs(self.dat
-00018830: 612e 4465 6c74 614d 7529 2029 2029 0a20  a.DeltaMu) ) ). 
-00018840: 2020 2020 2020 0a20 2020 2020 2069 6620        .      if 
-00018850: 7365 6c66 2e66 696e 616c 5f63 616c 6c3a  self.final_call:
-00018860: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00018870: 2e47 6175 7373 4170 7072 6f78 3a0a 2020  .GaussApprox:.  
-00018880: 2020 2020 2020 2020 2320 7265 7475 726e          # return
-00018890: 2073 7461 6e64 6172 6420 6368 695e 320a   standard chi^2.
-000188a0: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
-000188b0: 6f66 203d 206e 326c 4c2d 6e70 2e6c 6f67  of = n2lL-np.log
-000188c0: 286d 6f64 656c 5f76 616c 7565 732b 6e70  (model_values+np
-000188d0: 2e61 6273 2873 656c 662e 6461 7461 2e44  .abs(self.data.D
-000188e0: 656c 7461 4d75 2929 2e73 756d 2829 200a  eltaMu)).sum() .
-000188f0: 2020 2020 2020 2020 656c 7365 3a20 0a20          else: . 
-00018900: 2020 2020 2020 2020 2023 2073 746f 7265           # store
-00018910: 2067 6f6f 646e 6573 732d 6f66 2d66 6974   goodness-of-fit
-00018920: 2028 6469 6666 6572 656e 6365 206f 6620   (difference of 
-00018930: 6e6c 4c32 2077 2e72 2e74 2e20 7361 7475  nlL2 w.r.t. satu
-00018940: 7261 7465 6420 6d6f 6465 6c29 0a20 2020  rated model).   
-00018950: 2020 2020 2020 206e 326c 4c5f 7361 7475         n2lL_satu
-00018960: 7261 7465 6420 3d20 6e70 2e73 756d 280a  rated = np.sum(.
-00018970: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018980: 2e6e 326c 4c63 6f73 7428 0a20 2020 2020  .n2lLcost(.     
-00018990: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
-000189a0: 7461 2e63 6f6e 7465 6e74 7320 2d20 7365  ta.contents - se
-000189b0: 6c66 2e64 6174 612e 4465 6c74 614d 752c  lf.data.DeltaMu,
-000189c0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-000189d0: 7365 6c66 2e64 6174 612e 636f 6e74 656e  self.data.conten
-000189e0: 7473 202b 206e 702e 6162 7328 7365 6c66  ts + np.abs(self
-000189f0: 2e64 6174 612e 4465 6c74 614d 7529 202b  .data.DeltaMu) +
-00018a00: 2030 2e30 3035 2920 290a 2020 2020 2020   0.005) ).      
-00018a10: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00018a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a30: 2020 2021 2121 2063 6f6e 7374 2e20 302e     !!! const. 0.
-00018a40: 3030 3520 746f 2061 766f 6964 206c 6f67  005 to avoid log
-00018a50: 2830 2e29 200a 2020 2020 2020 2020 2020  (0.) .          
-00018a60: 7365 6c66 2e67 6f66 203d 2020 6e32 6c4c  self.gof =  n2lL
-00018a70: 202d 206e 326c 4c5f 7361 7475 7261 7465   - n2lL_saturate
-00018a80: 640a 0a20 2020 2020 2020 2023 2070 726f  d..        # pro
-00018a90: 7669 6465 206d 6f64 656c 2076 616c 7565  vide model value
-00018aa0: 7320 616e 6420 6d6f 6465 6c2d 7265 6c61  s and model-rela
-00018ab0: 7465 6420 756e 6365 7274 6169 6e74 6965  ted uncertaintie
-00018ac0: 7320 746f 2064 6174 6120 6f62 6a65 6374  s to data object
-00018ad0: 0a20 2020 2020 2020 2073 656c 662e 6461  .        self.da
-00018ae0: 7461 2e6d 6f64 656c 5f76 616c 7565 7320  ta.model_values 
-00018af0: 3d20 6d6f 6465 6c5f 7661 6c75 6573 2020  = model_values  
-00018b00: 2020 2020 200a 2020 2020 2020 2020 0a20       .        . 
-00018b10: 2020 2020 2020 2320 7265 7475 726e 2032        # return 2
-00018b20: 202a 206e 6567 2e20 6c6f 674c 0a20 2020   * neg. logL.   
-00018b30: 2020 2072 6574 7572 6e20 6e32 6c4c 0a20     return n2lL. 
-00018b40: 2020 200a 2020 2020 4073 7461 7469 636d     .    @staticm
-00018b50: 6574 686f 640a 2020 2020 6465 6620 6e32  ethod.    def n2
-00018b60: 6c4c 506f 6973 736f 6e28 782c 206c 616d  lLPoisson(x, lam
-00018b70: 293a 2020 0a20 2020 2020 2022 2222 0a20  ):  .      """. 
-00018b80: 2020 2020 206e 6567 2e20 6c6f 6761 7269       neg. logari
-00018b90: 7468 6d20 6f66 2050 6f69 7373 6f6e 2064  thm of Poisson d
-00018ba0: 6973 7472 6962 7574 696f 6e20 666f 7220  istribution for 
-00018bb0: 7265 616c 2d76 616c 7565 6420 780a 0a20  real-valued x.. 
-00018bc0: 2020 2020 2022 2222 0a20 2020 2020 2072       """.      r
-00018bd0: 6574 7572 6e20 322e 2a28 6c61 6d20 2d20  eturn 2.*(lam - 
-00018be0: 782a 6e70 2e6c 6f67 286c 616d 2920 2b20  x*np.log(lam) + 
-00018bf0: 6c6f 6767 616d 6d61 2878 2b31 2e29 290a  loggamma(x+1.)).
-00018c00: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-00018c10: 6f64 0a20 2020 2064 6566 206e 326c 4c73  od.    def n2lLs
-00018c20: 506f 6973 736f 6e28 786b 2c20 6c61 6d2c  Poisson(xk, lam,
-00018c30: 206d 7529 3a20 200a 2020 2020 2020 2222   mu):  .      ""
-00018c40: 220a 2020 2020 2020 322a 206e 6567 2e20  ".      2* neg. 
-00018c50: 6c6f 6761 7269 7468 6d20 6f66 2067 656e  logarithm of gen
-00018c60: 6572 616c 697a 6564 2050 6f69 7373 6f6e  eralized Poisson
-00018c70: 2064 6973 7472 6962 7574 696f 6e3a 200a   distribution: .
-00018c80: 2020 2020 2020 7368 6966 7465 6420 746f        shifted to
-00018c90: 206e 6577 206d 6561 6e20 6d75 2066 6f72   new mean mu for
-00018ca0: 2072 6561 6c2d 7661 6c75 6564 2078 6b20   real-valued xk 
-00018cb0: 2020 2020 2020 200a 2020 2020 2020 666f         .      fo
-00018cc0: 7220 6c61 6d3d 6d75 2c20 7468 6520 7374  r lam=mu, the st
-00018cd0: 616e 6461 7264 2050 6f69 7373 6f6e 2064  andard Poisson d
-00018ce0: 6973 7472 6962 7574 696f 6e20 6973 2072  istribution is r
-00018cf0: 6563 6f76 6572 6564 0a20 2020 2020 206c  ecovered.      l
-00018d00: 616d 3d73 6967 6d61 2a32 2069 7320 7468  am=sigma*2 is th
-00018d10: 6520 7661 7269 616e 6365 206f 6620 7468  e variance of th
-00018d20: 6520 7368 6966 7465 6420 506f 6973 736f  e shifted Poisso
-00018d30: 6e20 6469 7374 7269 6275 7469 6f6e 2e0a  n distribution..
-00018d40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00018d50: 7873 203d 2028 786b 202b 206c 616d 202d  xs = (xk + lam -
-00018d60: 206d 7529 0a20 2020 2020 2072 6574 7572   mu).      retur
-00018d70: 6e20 322e 2a28 6c61 6d20 2d20 7873 2a6e  n 2.*(lam - xs*n
-00018d80: 702e 6c6f 6728 6c61 6d29 202b 206c 6f67  p.log(lam) + log
-00018d90: 6761 6d6d 6128 7873 2b31 2e29 290a 0a20  gamma(xs+1.)).. 
-00018da0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
-00018db0: 0a20 2020 2064 6566 206e 326c 4c47 6175  .    def n2lLGau
-00018dc0: 7373 2878 2c20 6c61 6d29 3a20 200a 2020  ss(x, lam):  .  
-00018dd0: 2020 2020 2222 2220 2020 200a 2020 2020      """    .    
-00018de0: 2020 6e65 6761 7469 7665 206c 6f67 2d6c    negative log-l
-00018df0: 696b 656c 6968 6f6f 6420 6f66 2047 6175  ikelihood of Gau
-00018e00: 7373 6961 6e20 6170 7072 6f78 696d 6174  ssian approximat
-00018e10: 696f 6e0a 2020 2020 2020 506f 6973 2878  ion.      Pois(x
-00018e20: 2c20 6c61 6d29 205c 7369 6d65 7120 4761  , lam) \simeq Ga
-00018e30: 7573 7328 782c 206d 753d 6c61 6d2c 2073  uss(x, mu=lam, s
-00018e40: 6967 6d61 5e32 3d6c 616d 290a 2020 2020  igma^2=lam).    
-00018e50: 2020 2222 220a 2020 2020 2020 7220 3d20    """.      r = 
-00018e60: 2878 2d6c 616d 290a 2020 2020 2020 7265  (x-lam).      re
-00018e70: 7475 726e 2028 7220 2a20 722f 6c61 6d20  turn (r * r/lam 
-00018e80: 2b20 6e70 2e6c 6f67 286c 616d 2929 0a20  + np.log(lam)). 
-00018e90: 2020 2020 2020 2020 2020 0a20 2020 2040            .    @
-00018ea0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
-00018eb0: 2064 6566 2069 6e74 6567 7261 6c5f 6f76   def integral_ov
-00018ec0: 6572 4269 6e73 286c 6564 6765 732c 2072  erBins(ledges, r
-00018ed0: 6564 6765 732c 2066 2c20 2a70 6172 293a  edges, f, *par):
-00018ee0: 0a20 2020 2020 2022 2222 4361 6c63 756c  .      """Calcul
-00018ef0: 6174 6520 6170 7072 6f78 2e20 696e 7465  ate approx. inte
-00018f00: 6772 616c 206f 6620 6d6f 6465 6c20 6f76  gral of model ov
-00018f10: 6572 2062 696e 7320 7573 696e 6720 5369  er bins using Si
-00018f20: 6d70 736f 6e27 7320 7275 6c65 0a20 2020  mpson's rule.   
-00018f30: 2020 2022 2222 0a20 2020 2020 2072 6574     """.      ret
-00018f40: 7572 6e20 2872 6564 6765 7320 2d20 6c65  urn (redges - le
-00018f50: 6467 6573 292f 362e 202a 205c 0a20 2020  dges)/6. * \.   
-00018f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f70: 2020 2020 2020 2020 2028 2066 286c 6564           ( f(led
-00018f80: 6765 732c 202a 7061 7229 205c 0a20 2020  ges, *par) \.   
-00018f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fa0: 2020 2020 2020 2020 202b 2034 2e2a 6628           + 4.*f(
-00018fb0: 286c 6564 6765 732b 7265 6467 6573 292f  (ledges+redges)/
-00018fc0: 322e 2c20 2a70 6172 2920 5c0a 2020 2020  2., *par) \.    
-00018fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018fe0: 2020 2020 2020 2020 2b20 6628 7265 6467          + f(redg
-00018ff0: 6573 2c20 2a70 6172 2920 2920 0a0a 2020  es, *par) ) ..  
-00019000: 2320 2d2d 2d20 656e 6420 6465 6669 6e69  # --- end defini
-00019010: 7469 6f6e 206f 6620 636c 6173 7320 6843  tion of class hC
-00019020: 6f73 7420 2d2d 2d2d 0a0a 2020 230a 2020  ost ----..  #.  
-00019030: 2320 2d2d 2d20 7370 6563 6961 6c20 636f  # --- special co
-00019040: 6465 2066 6f72 2066 6974 2077 6974 6820  de for fit with 
-00019050: 7573 6572 2d73 7570 706c 6965 6420 636f  user-supplied co
-00019060: 7374 2066 756e 6374 696f 6e0a 2020 2320  st function.  # 
-00019070: 2020 2020 6f72 2070 6466 2066 6f72 206e      or pdf for n
-00019080: 6567 2e20 6c6f 672d 6c69 6b65 6c69 686f  eg. log-likeliho
-00019090: 6f64 2066 6974 200a 2020 2320 2020 2020  od fit .  #     
-000190a0: 200a 0a20 2064 6566 2069 6e69 745f 6d6c   ..  def init_ml
-000190b0: 4461 7461 2873 656c 662c 2078 293a 0a20  Data(self, x):. 
-000190c0: 2020 2022 2222 0a20 2020 2069 6e69 7469     """.    initi
-000190d0: 616c 697a 6520 6461 7461 206f 626a 6563  alize data objec
-000190e0: 740a 0a20 2020 2041 7267 733a 0a20 2020  t..    Args:.   
-000190f0: 202d 2078 2c20 6172 7261 7920 6f66 2066   - x, array of f
-00019100: 6c6f 6174 730a 2020 2020 2222 220a 2020  loats.    """.  
-00019110: 2020 0a20 2020 2023 2063 7265 6174 6520    .    # create 
-00019120: 6461 7461 206f 626a 6563 7420 616e 6420  data object and 
-00019130: 7061 7373 2061 6c6c 2069 6e70 7574 2061  pass all input a
-00019140: 7267 756d 656e 7473 0a20 2020 2073 656c  rguments.    sel
-00019150: 662e 6d6c 4461 7461 203d 2073 656c 662e  f.mlData = self.
-00019160: 6d6c 4461 7461 436f 6e74 6169 6e65 7228  mlDataContainer(
-00019170: 7365 6c66 2c20 7829 0a20 2020 2073 656c  self, x).    sel
-00019180: 662e 6461 7461 203d 2073 656c 662e 6d6c  f.data = self.ml
-00019190: 4461 7461 0a0a 0a20 2064 6566 2069 6e69  Data...  def ini
-000191a0: 745f 6d6e 4669 7428 7365 6c66 2c20 7573  t_mnFit(self, us
-000191b0: 6572 4675 6e63 7469 6f6e 2c20 6d6f 6465  erFunction, mode
-000191c0: 6c5f 6b77 6172 6773 3d4e 6f6e 652c 2070  l_kwargs=None, p
-000191d0: 303d 4e6f 6e65 2c20 6470 303d 4e6f 6e65  0=None, dp0=None
-000191e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000191f0: 2020 2020 2020 2020 2063 6f6e 7374 7261           constra
-00019200: 696e 7473 3d4e 6f6e 652c 2066 6978 5061  ints=None, fixPa
-00019210: 7273 3d4e 6f6e 652c 206c 696d 6974 733d  rs=None, limits=
-00019220: 4e6f 6e65 293a 0a20 2020 2022 2222 696e  None):.    """in
-00019230: 6974 6961 6c69 7a65 2066 6974 206f 626a  itialize fit obj
-00019240: 6563 7420 666f 7220 7369 6d70 6c65 206d  ect for simple m
-00019250: 696e 7569 7420 6669 7420 7769 7468 0a20  inuit fit with. 
-00019260: 2020 202a 2077 6974 6820 7573 6572 2d73     * with user-s
-00019270: 7570 706c 6965 6420 636f 7374 2066 756e  upplied cost fun
-00019280: 6374 696f 6e20 6f72 0a20 2020 202a 2061  ction or.    * a
-00019290: 2070 726f 6261 6269 6c69 7479 2064 656e   probability den
-000192a0: 7369 7479 2066 756e 6374 696f 6e20 666f  sity function fo
-000192b0: 7220 616e 2075 6e62 696e 6e65 6420 6e65  r an unbinned ne
-000192c0: 672e 206c 6f67 2d4c 2066 6974 0a0a 2020  g. log-L fit..  
-000192d0: 2020 4172 6773 3a0a 2020 2020 2020 2d20    Args:.      - 
-000192e0: 636f 7374 4675 6e63 7469 6f6e 3a20 636f  costFunction: co
-000192f0: 7374 2066 756e 6374 696f 6e20 6f72 2070  st function or p
-00019300: 6466 200a 2020 2020 2020 2d20 7030 3a20  df .      - p0: 
-00019310: 6e70 2d61 7272 6179 206f 6620 666c 6f61  np-array of floa
-00019320: 7473 2c20 696e 6974 6961 6c20 7061 7261  ts, initial para
-00019330: 6d65 7465 7220 7661 6c75 6573 200a 2020  meter values .  
-00019340: 2020 2020 2d20 6d6f 6465 6c5f 6b77 6172      - model_kwar
-00019350: 6773 3a20 6f70 7469 6f6e 616c 2c20 6669  gs: optional, fi
-00019360: 7420 7061 7261 6d65 7465 7273 2069 6620  t parameters if 
-00019370: 6e6f 7420 6672 6f6d 206d 6f64 656c 2073  not from model s
-00019380: 6967 6e61 7475 7265 200a 2020 2020 2020  ignature .      
-00019390: 2d20 6470 303a 2061 7272 6179 2d6c 696b  - dp0: array-lik
-000193a0: 652c 2069 6e69 7469 616c 2067 7565 7373  e, initial guess
-000193b0: 206f 6620 7061 7261 6d65 7465 7220 756e   of parameter un
-000193c0: 6365 7274 6169 6e74 6965 7320 286f 7074  certainties (opt
-000193d0: 696f 6e61 6c29 0a20 2020 2020 202d 2070  ional).      - p
-000193e0: 6172 616d 6574 6572 2063 6f6e 7374 7261  arameter constra
-000193f0: 696e 7473 3a20 286e 6573 7465 6429 206c  ints: (nested) l
-00019400: 6973 7428 7329 3a20 5b70 6172 616d 6574  ist(s): [paramet
-00019410: 6572 206e 616d 652c 2076 616c 7565 2c20  er name, value, 
-00019420: 756e 6365 7274 6169 6e74 795d 200a 2020  uncertainty] .  
-00019430: 2020 2020 2d20 6669 7820 7061 7261 6d65      - fix parame
-00019440: 7465 7228 7329 2069 6e20 6669 743a 206c  ter(s) in fit: l
-00019450: 6973 7420 6f66 2070 6172 616d 6574 6572  ist of parameter
-00019460: 206e 616d 6573 206f 7220 696e 6469 6365   names or indice
-00019470: 730a 2020 2020 2020 2d20 6c69 6d69 7473  s.      - limits
-00019480: 3a20 286e 6573 7465 6429 206c 6973 7428  : (nested) list(
-00019490: 7329 3a20 5b70 6172 616d 6574 6572 206e  s): [parameter n
-000194a0: 616d 652c 206d 696e 2c20 6d61 785d 206f  ame, min, max] o
-000194b0: 720a 2020 2020 2020 2020 5b70 6172 616d  r.        [param
-000194c0: 6574 6572 2069 6e64 6578 2c20 6d69 6e2c  eter index, min,
-000194d0: 206d 6178 5d0a 2020 2020 2222 220a 2020   max].    """.  
-000194e0: 2020 6966 2073 656c 662e 6461 7461 2069    if self.data i
-000194f0: 7320 4e6f 6e65 2061 6e64 2073 656c 662e  s None and self.
-00019500: 6669 745f 7479 7065 2021 3d20 2275 7365  fit_type != "use
-00019510: 7222 3a0a 2020 2020 2020 7261 6973 6520  r":.      raise 
-00019520: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00019530: 2020 2020 2720 2121 2120 6d6e 4669 742e      ' !!! mnFit.
-00019540: 696e 6974 5f6d 6e46 6974 3a20 6e6f 2064  init_mnFit: no d
-00019550: 6174 6120 6f62 6a65 6374 2064 6566 696e  ata object defin
-00019560: 6564 202d 2063 616c 6c20 696e 6974 5f64  ed - call init_d
-00019570: 6174 6128 2927 290a 0a20 2020 2023 2067  ata()')..    # g
-00019580: 6574 2070 6172 616d 6574 6572 7320 6f66  et parameters of
-00019590: 206d 6f64 656c 2066 756e 6374 696f 6e20   model function 
-000195a0: 746f 2073 6574 2073 7461 7274 2076 616c  to set start val
-000195b0: 7565 7320 666f 7220 6669 740a 2020 2020  ues for fit.    
-000195c0: 6966 206d 6f64 656c 5f6b 7761 7267 7320  if model_kwargs 
-000195d0: 6973 204e 6f6e 653a 0a20 2020 2020 2061  is None:.      a
-000195e0: 7267 732c 206d 6f64 656c 5f6b 7761 7267  rgs, model_kwarg
-000195f0: 7320 3d20 6765 745f 6675 6e63 7469 6f6e  s = get_function
-00019600: 5369 676e 6174 7572 6528 7573 6572 4675  Signature(userFu
-00019610: 6e63 7469 6f6e 290a 0a20 2020 2070 6172  nction)..    par
-00019620: 203d 2028 6d6f 6465 6c5f 6b77 6172 6773   = (model_kwargs
-00019630: 2c20 7030 2c20 6470 302c 2063 6f6e 7374  , p0, dp0, const
-00019640: 7261 696e 7473 2c20 6669 7850 6172 732c  raints, fixPars,
-00019650: 206c 696d 6974 7329 0a20 2020 2073 656c   limits).    sel
-00019660: 662e 5f73 6574 7570 4669 7450 6172 616d  f._setupFitParam
-00019670: 6574 6572 7328 2a70 6172 2920 0a0a 2020  eters(*par) ..  
-00019680: 2020 2373 6574 2075 7020 636f 7374 2066    #set up cost f
-00019690: 756e 6374 696f 6e20 666f 7220 696d 696e  unction for imin
-000196a0: 7569 740a 2020 2020 7365 6c66 2e63 6f73  uit.    self.cos
-000196b0: 7466 203d 2073 656c 662e 6d6e 436f 7374  tf = self.mnCost
-000196c0: 2873 656c 662c 2075 7365 7246 756e 6374  (self, userFunct
-000196d0: 696f 6e29 0a20 2020 2073 656c 662e 5f73  ion).    self._s
-000196e0: 6574 7570 4d69 6e75 6974 286d 6f64 656c  etupMinuit(model
-000196f0: 5f6b 7761 7267 7329 200a 0a20 2064 6566  _kwargs) ..  def
-00019700: 2073 6574 5f6d 6e4f 7074 696f 6e73 2873   set_mnOptions(s
-00019710: 656c 662c 2072 756e 5f6d 696e 6f73 3d4e  elf, run_minos=N
-00019720: 6f6e 652c 206e 6567 326c 6f67 4c3d 4e6f  one, neg2logL=No
-00019730: 6e65 2c20 7175 6965 743d 4e6f 6e65 293a  ne, quiet=None):
-00019740: 0a20 2020 2022 2222 4465 6669 6e65 206f  .    """Define o
-00019750: 7074 696f 6e73 2066 6f72 206d 696e 7569  ptions for minui
-00019760: 7420 6669 7420 7769 7468 2075 7365 7220  t fit with user 
-00019770: 636f 7374 2066 756e 6374 696f 6e0a 0a20  cost function.. 
-00019780: 2020 2041 7267 733a 0a0a 2020 2020 2d20     Args:..    - 
-00019790: 7275 6e5f 6d69 6e6f 733a 2072 756e 206d  run_minos: run m
-000197a0: 696e 6f73 2070 726f 6669 6c65 206c 696b  inos profile lik
-000197b0: 656c 6968 6f6f 6420 7363 616e 0a20 2020  elihood scan.   
-000197c0: 202d 206e 6567 326c 6f67 4c3a 2063 6f73   - neg2logL: cos
-000197d0: 7420 6675 6e63 7469 6f6e 2069 7320 2d32  t function is -2
-000197e0: 206e 6567 4c6f 674c 0a20 2020 2022 2222   negLogL.    """
-000197f0: 0a20 2020 2069 6620 7275 6e5f 6d69 6e6f  .    if run_mino
-00019800: 7320 6973 206e 6f74 204e 6f6e 653a 2020  s is not None:  
-00019810: 200a 2020 2020 2020 7365 6c66 2e72 756e   .      self.run
-00019820: 5f6d 696e 6f73 203d 2072 756e 5f6d 696e  _minos = run_min
-00019830: 6f73 0a20 2020 2020 2073 656c 662e 6f70  os.      self.op
-00019840: 7469 6f6e 735b 2272 756e 5f6d 696e 6f73  tions["run_minos
-00019850: 225d 5b30 5d20 3d20 696e 7428 7275 6e5f  "][0] = int(run_
-00019860: 6d69 6e6f 7329 0a20 2020 2069 6620 6e65  minos).    if ne
-00019870: 6732 6c6f 674c 2069 7320 6e6f 7420 4e6f  g2logL is not No
-00019880: 6e65 3a0a 2020 2020 2020 7365 6c66 2e6e  ne:.      self.n
-00019890: 6567 326c 6f67 4c20 3d20 6e65 6732 6c6f  eg2logL = neg2lo
-000198a0: 674c 0a20 2020 2020 2073 656c 662e 6f70  gL.      self.op
-000198b0: 7469 6f6e 735b 226e 6567 326c 6f67 4c22  tions["neg2logL"
-000198c0: 5d5b 305d 203d 2069 6e74 286e 6567 326c  ][0] = int(neg2l
-000198d0: 6f67 4c29 0a20 2020 2020 2069 6620 7365  ogL).      if se
-000198e0: 6c66 2e6e 6567 326c 6f67 4c3a 0a20 2020  lf.neg2logL:.   
-000198f0: 2020 2020 2073 656c 662e 4572 7244 6566       self.ErrDef
-00019900: 203d 2031 2e0a 2020 2020 2020 656c 7365   = 1..      else
-00019910: 3a0a 2020 2020 2020 2020 7365 6c66 2e45  :.        self.E
-00019920: 7272 4465 6620 3d20 302e 350a 2020 2020  rrDef = 0.5.    
-00019930: 6966 2071 7569 6574 2069 7320 6e6f 7420  if quiet is not 
-00019940: 4e6f 6e65 3a0a 2020 2020 2020 7365 6c66  None:.      self
-00019950: 2e71 7569 6574 203d 2071 7569 6574 0a0a  .quiet = quiet..
-00019960: 2020 636c 6173 7320 6d6c 4461 7461 436f    class mlDataCo
-00019970: 6e74 6169 6e65 723a 0a20 2020 2022 2222  ntainer:.    """
-00019980: 0a20 2020 2020 2043 6f6e 7461 696e 6572  .      Container
-00019990: 2066 6f72 2067 656e 6572 616c 2028 696e   for general (in
-000199a0: 6465 7865 6429 2064 6174 610a 0a20 2020  dexed) data..   
-000199b0: 2020 2044 6174 6120 4d65 6d62 6572 733a     Data Members:
-000199c0: 0a0a 2020 2020 2020 2d20 782c 2061 7272  ..      - x, arr
-000199d0: 6179 206f 6620 666c 6f61 7473 3a20 6461  ay of floats: da
-000199e0: 7461 0a0a 0a20 2020 2020 204d 6574 686f  ta...      Metho
-000199f0: 6473 3a0a 0a20 2020 2020 202d 706c 6f74  ds:..      -plot
-00019a00: 2829 3a20 7265 7475 726e 2066 6967 7572  (): return figur
-00019a10: 6520 7769 7468 2072 6570 7265 7365 6e74  e with represent
-00019a20: 6174 696f 6e20 6f66 2064 6174 610a 2020  ation of data.  
-00019a30: 2020 2222 220a 2020 2020 0a20 2020 2064    """.    .    d
-00019a40: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00019a50: 2c20 6f75 7465 722c 2078 293a 0a20 2020  , outer, x):.   
-00019a60: 2020 2022 2222 200a 2020 2020 2020 7374     """ .      st
-00019a70: 6f72 6520 6461 7461 0a0a 2020 2020 2020  ore data..      
-00019a80: 4172 6773 3a0a 2020 2020 2020 2d20 782c  Args:.      - x,
-00019a90: 2061 7272 6179 206f 6620 666c 6f61 7473   array of floats
-00019aa0: 0a20 2020 2020 202d 2071 7569 6574 3a20  .      - quiet: 
-00019ab0: 626f 6f6c 6561 6e2c 2063 6f6e 7472 6f6c  boolean, control
-00019ac0: 7320 7072 696e 7465 6420 6f75 7470 7574  s printed output
-00019ad0: 0a0a 2020 2020 2020 2222 220a 0a20 2020  ..      """..   
-00019ae0: 2020 2073 656c 662e 7820 3d20 6e70 2e61     self.x = np.a
-00019af0: 7361 7272 6179 2878 290a 2020 2020 2020  sarray(x).      
-00019b00: 7365 6c66 2e64 6c65 6e67 7468 203d 206c  self.dlength = l
-00019b10: 656e 2873 656c 662e 7829 0a0a 2020 2020  en(self.x)..    
-00019b20: 2020 0a20 2020 2064 6566 2070 6c6f 7428    .    def plot(
-00019b30: 7365 6c66 2c20 6e75 6d3d 2769 6e64 6578  self, num='index
-00019b40: 6564 2064 6174 6127 2c0a 2020 2020 2020  ed data',.      
-00019b50: 2020 2020 2020 2020 2020 2020 2066 6967               fig
-00019b60: 7369 7a65 3d28 372e 352c 2036 2e35 292c  size=(7.5, 6.5),
-00019b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b80: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00013760: 2020 2020 6561 6273 636f 7220 3d20 7365      eabscor = se
+00013770: 6c66 2e63 6162 732c 2065 7265 6c63 6f72  lf.cabs, erelcor
+00013780: 3d73 656c 662e 6372 656c 2c0a 2020 2020  =self.crel,.    
+00013790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000137b0: 2020 2020 2020 2020 6461 7461 3d73 656c          data=sel
+000137c0: 662e 7829 0a20 2020 2020 2020 2023 2062  f.x).        # b
+000137d0: 7569 6c64 206d 6174 7269 7820 6f66 2072  uild matrix of r
+000137e0: 656c 6174 6976 6520 6572 726f 7273 0a20  elative errors. 
+000137f0: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
+00013800: 6566 5f74 6f4d 6f64 656c 2061 6e64 2073  ef_toModel and s
+00013810: 656c 662e 6861 735f 7265 6c5f 4572 726f  elf.has_rel_Erro
+00013820: 7273 3a0a 2020 2020 2020 2020 2020 7365  rs:.          se
+00013830: 6c66 2e5f 636f 7679 3020 3d20 5f62 7569  lf._covy0 = _bui
+00013840: 6c64 5f43 6f76 4d61 7428 7365 6c66 2e6e  ld_CovMat(self.n
+00013850: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00013860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013870: 6572 656c 3d73 656c 662e 6572 656c 2c0a  erel=self.erel,.
+00013880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013890: 2020 2020 2020 2020 2020 2020 2065 7265               ere
+000138a0: 6c63 6f72 3d73 656c 662e 6372 656c 2c0a  lcor=self.crel,.
+000138b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000138c0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+000138d0: 613d 6e70 2e6f 6e65 7328 7365 6c66 2e6e  a=np.ones(self.n
+000138e0: 6429 290a 2020 2020 2020 2020 656c 7365  d)).        else
+000138f0: 3a0a 2020 2020 2020 2020 2020 7365 6c66  :.          self
+00013900: 2e5f 636f 7679 3020 3d20 4e6f 6e65 0a0a  ._covy0 = None..
+00013910: 2020 2020 2020 656c 7365 3a20 2320 6e6f        else: # no
+00013920: 2063 6f76 6172 6961 6e63 6520 6e65 6564   covariance need
+00013930: 6564 2c20 7573 6520 7369 6d70 6c65 206d  ed, use simple m
+00013940: 6174 680a 2020 2020 2020 2020 2320 6275  ath.        # bu
+00013950: 696c 6420 7374 6174 6963 2028 3d70 6172  ild static (=par
+00013960: 616d 6574 6572 2d69 6e64 6570 656e 6465  ameter-independe
+00013970: 6e74 2920 7061 7274 206f 6620 636f 7661  nt) part of cova
+00013980: 7269 616e 6365 206d 6174 7269 7820 2020  riance matrix   
+00013990: 2020 200a 2020 2020 2020 2020 6966 2073     .        if s
+000139a0: 656c 662e 6861 735f 7265 6c5f 4572 726f  elf.has_rel_Erro
+000139b0: 7273 2061 6e64 2073 656c 662e 7265 665f  rs and self.ref_
+000139c0: 746f 4d6f 6465 6c3a 0a20 2020 2020 2020  toModel:.       
+000139d0: 2020 2023 206f 6e6c 7920 696e 6465 7065     # only indepe
+000139e0: 6e64 656e 7420 792d 6572 726f 7273 2064  ndent y-errors d
+000139f0: 6f20 6e6f 7420 6465 7065 6e64 206f 6e20  o not depend on 
+00013a00: 7061 7261 6d65 7465 7273 0a20 2020 2020  parameters.     
+00013a10: 2020 2020 2073 656c 662e 5f73 7461 7469       self._stati
+00013a20: 6345 7272 3220 3d20 5f62 7569 6c64 5f45  cErr2 = _build_E
+00013a30: 7272 3228 7365 6c66 2e65 290a 2020 2020  rr2(self.e).    
+00013a40: 2020 2020 656c 7365 3a20 0a20 2020 2020      else: .     
+00013a50: 2020 2020 2023 2061 6c6c 2079 2d65 7272       # all y-err
+00013a60: 6f72 7320 6172 6520 7061 7261 6d65 7465  ors are paramete
+00013a70: 722d 696e 6465 7065 6e64 656e 740a 2020  r-independent.  
+00013a80: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
+00013a90: 6174 6963 4572 7232 203d 205f 6275 696c  aticErr2 = _buil
+00013aa0: 645f 4572 7232 2820 7365 6c66 2e65 2c20  d_Err2( self.e, 
+00013ab0: 7365 6c66 2e65 7265 6c2c 2073 656c 662e  self.erel, self.
+00013ac0: 7829 0a20 2020 2020 2020 2020 200a 0a20  x).          .. 
+00013ad0: 2020 2064 6566 205f 7265 6275 696c 645f     def _rebuild_
+00013ae0: 4572 7232 2873 656c 662c 206d 7061 7229  Err2(self, mpar)
+00013af0: 3a0a 2020 2020 2020 2222 220a 2020 2020  :.      """.    
+00013b00: 2020 2852 652d 2963 616c 6375 6c61 7465    (Re-)calculate
+00013b10: 2075 6e63 6572 7461 696e 6769 6573 200a   uncertaingies .
+00013b20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013b30: 6966 2073 656c 662e 5f73 7461 7469 6345  if self._staticE
+00013b40: 7272 3220 6973 206e 6f74 204e 6f6e 653a  rr2 is not None:
+00013b50: 0a20 2020 2020 2020 2073 656c 662e 6572  .        self.er
+00013b60: 7232 203d 206e 702e 6172 7261 7928 7365  r2 = np.array(se
+00013b70: 6c66 2e5f 7374 6174 6963 4572 7232 2c20  lf._staticErr2, 
+00013b80: 636f 7079 3d54 7275 6529 0a20 2020 2020  copy=True).     
+00013b90: 2065 6c73 653a 0a20 2020 2020 2020 2073   else:.        s
+00013ba0: 656c 662e 6572 7232 203d 206e 702e 7a65  elf.err2 = np.ze
+00013bb0: 726f 7328 7365 6c66 2e6e 6429 0a20 2020  ros(self.nd).   
+00013bc0: 2020 2069 6620 7365 6c66 2e72 6566 5f74     if self.ref_t
+00013bd0: 6f4d 6f64 656c 2061 6e64 2073 656c 662e  oModel and self.
+00013be0: 6861 735f 7265 6c5f 4572 726f 7273 3a0a  has_rel_Errors:.
+00013bf0: 2020 2020 2020 2020 5f65 7220 3d20 7365          _er = se
+00013c00: 6c66 2e65 7265 6c20 2a20 7365 6c66 2e6d  lf.erel * self.m
+00013c10: 6f64 656c 2873 656c 662e 782c 202a 6d70  odel(self.x, *mp
+00013c20: 6172 2920 2020 2020 2020 0a20 2020 2020  ar)       .     
+00013c30: 2020 2073 656c 662e 6572 7232 202b 3d20     self.err2 += 
+00013c40: 5f65 7220 2a20 5f65 720a 2020 2020 2020  _er * _er.      
+00013c50: 2020 0a20 2020 2064 6566 205f 7265 6275    .    def _rebu
+00013c60: 696c 645f 436f 7628 7365 6c66 2c20 6d70  ild_Cov(self, mp
+00013c70: 6172 293a 0a20 2020 2020 2022 2222 0a20  ar):.      """. 
+00013c80: 2020 2020 2028 5265 2d29 4275 696c 6420       (Re-)Build 
+00013c90: 7468 6520 636f 7661 7269 616e 6365 206d  the covariance m
+00013ca0: 6174 7269 7820 6672 6f6d 2063 6f6d 706f  atrix from compo
+00013cb0: 6e65 6e74 730a 2020 2020 2020 616e 6420  nents.      and 
+00013cc0: 6361 636c 756c 6174 6520 6974 7320 696e  caclulate its in
+00013cd0: 7665 7273 650a 2020 2020 2020 2222 220a  verse.      """.
+00013ce0: 2020 2020 2023 2073 7461 7274 2066 726f       # start fro
+00013cf0: 6d20 7072 652d 6275 696c 7420 7061 7261  m pre-built para
+00013d00: 6d65 7465 722d 696e 6465 7065 6e64 656e  meter-independen
+00013d10: 7420 7061 7274 206f 6620 436f 7661 7269  t part of Covari
+00013d20: 616e 6365 204d 6174 7269 780a 2020 2020  ance Matrix.    
+00013d30: 2020 7365 6c66 2e63 6f76 203d 206e 702e    self.cov = np.
+00013d40: 6172 7261 7928 7365 6c66 2e5f 7374 6174  array(self._stat
+00013d50: 6963 436f 762c 2063 6f70 793d 5472 7565  icCov, copy=True
+00013d60: 290a 0a20 2020 2020 2320 6164 6420 6d61  )..     # add ma
+00013d70: 7472 6978 206f 6620 7061 7261 6d65 7465  trix of paramete
+00013d80: 722d 6465 7065 6e64 656e 7420 792d 756e  r-dependent y-un
+00013d90: 6365 7274 6169 6e74 6965 730a 2020 2020  certainties.    
+00013da0: 2020 6966 2073 656c 662e 5f63 6f76 7930    if self._covy0
+00013db0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00013dc0: 2020 2020 2020 5f64 6174 203d 2073 656c        _dat = sel
+00013dd0: 662e 6d6f 6465 6c28 7365 6c66 2e78 2c20  f.model(self.x, 
+00013de0: 2a6d 7061 7229 2020 2020 2020 200a 2020  *mpar)       .  
+00013df0: 2020 2020 2020 7365 6c66 2e63 6f76 202b        self.cov +
+00013e00: 3d20 7365 6c66 2e5f 636f 7679 3020 2a20  = self._covy0 * 
+00013e10: 6e70 2e6f 7574 6572 285f 6461 742c 205f  np.outer(_dat, _
+00013e20: 6461 7429 0a0a 2020 2020 6465 6620 6765  dat)..    def ge
+00013e30: 745f 436f 7628 7365 6c66 293a 0a20 2020  t_Cov(self):.   
+00013e40: 2020 2022 2222 7265 7475 726e 2063 6f76     """return cov
+00013e50: 6172 6961 6e63 6520 6d61 7472 6978 206f  ariance matrix o
+00013e60: 6620 6461 7461 0a20 2020 2020 2022 2222  f data.      """
+00013e70: 0a20 2020 2020 2069 6620 7365 6c66 2e6e  .      if self.n
+00013e80: 6565 6473 5f63 6f76 6172 6961 6e63 653a  eeds_covariance:
+00013e90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013ea0: 7365 6c66 2e63 6f76 0a20 2020 2020 2065  self.cov.      e
+00013eb0: 6c73 653a 0a20 2020 2020 2020 2069 6620  lse:.        if 
+00013ec0: 7365 6c66 2e65 7272 3220 6973 204e 6f6e  self.err2 is Non
+00013ed0: 653a 0a20 2020 2020 2020 2020 2072 6574  e:.          ret
+00013ee0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+00013ef0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00013f00: 2072 6574 7572 6e20 6e70 2e64 6961 6728   return np.diag(
+00013f10: 7365 6c66 2e65 7272 3229 0a20 200a 2020  self.err2).  .  
+00013f20: 2020 6465 6620 6765 745f 6943 6f76 2873    def get_iCov(s
+00013f30: 656c 6629 3a0a 2020 2020 2020 2222 2272  elf):.      """r
+00013f40: 6574 7572 6e20 696e 7665 7273 6520 6f66  eturn inverse of
+00013f50: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
+00013f60: 6978 2c20 6173 2075 7365 6420 696e 2063  ix, as used in c
+00013f70: 6f73 7420 6675 6e63 7469 6f6e 0a20 2020  ost function.   
+00013f80: 2020 2022 2222 0a20 2020 2020 2069 6620     """.      if 
+00013f90: 7365 6c66 2e6e 6565 6473 5f63 6f76 6172  self.needs_covar
+00013fa0: 6961 6e63 653a 0a20 2020 2020 2020 2072  iance:.        r
+00013fb0: 6574 7572 6e20 7365 6c66 2e69 436f 760a  eturn self.iCov.
+00013fc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00013fd0: 2020 2020 7265 7475 726e 206e 702e 6469      return np.di
+00013fe0: 6167 2831 2e2f 7365 6c66 2e65 7272 3229  ag(1./self.err2)
+00013ff0: 0a0a 2020 2020 6465 6620 706c 6f74 2873  ..    def plot(s
+00014000: 656c 662c 206e 756d 3d27 4461 7461 2061  elf, num='Data a
+00014010: 6e64 204d 6f64 656c 272c 0a20 2020 2020  nd Model',.     
+00014020: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00014030: 6773 697a 653d 2837 2e35 2c20 362e 3529  gsize=(7.5, 6.5)
+00014040: 2c20 2020 2020 2020 2020 2020 2020 2020  ,               
+00014050: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+00014060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014070: 2020 6461 7461 5f6c 6162 656c 3d27 6461    data_label='da
+00014080: 7461 272c 0a20 2020 2020 2020 2020 2020  ta',.           
+00014090: 2020 2020 2020 2020 706c 6f74 5f72 6573          plot_res
+000140a0: 6964 7561 6c3d 4661 6c73 6529 3a0a 2020  idual=False):.  
+000140b0: 2020 2020 2222 2272 6574 7572 6e20 6669      """return fi
+000140c0: 6775 7265 2077 6974 6820 6461 7461 2061  gure with data a
+000140d0: 6e64 2075 6e63 6572 7461 696e 7469 6573  nd uncertainties
+000140e0: 0a20 2020 2020 2022 2222 0a23 2020 2020  .      """.#    
+000140f0: 2320 6765 7420 6461 7461 0a20 2020 2020  # get data.     
+00014100: 2069 6620 706c 6f74 5f72 6573 6964 7561   if plot_residua
+00014110: 6c20 616e 6420 7365 6c66 2e6d 6f64 656c  l and self.model
+00014120: 5f76 616c 7565 7320 6973 206e 6f74 204e  _values is not N
+00014130: 6f6e 653a 0a20 2020 2020 2020 2078 203d  one:.        x =
+00014140: 2073 656c 662e 7820 2d20 7365 6c66 2e6d   self.x - self.m
+00014150: 6f64 656c 5f76 616c 7565 730a 2020 2020  odel_values.    
+00014160: 2020 656c 7365 3a20 200a 2020 2020 2020    else:  .      
+00014170: 2020 7820 3d20 7365 6c66 2e78 0a20 2020    x = self.x.   
+00014180: 2020 2065 203d 2073 656c 662e 6765 745f     e = self.get_
+00014190: 436f 7628 290a 2020 2020 2020 6966 2065  Cov().      if e
+000141a0: 2e6e 6469 6d20 3d3d 2032 3a0a 2020 2020  .ndim == 2:.    
+000141b0: 2020 2020 6520 3d20 6e70 2e73 7172 7428      e = np.sqrt(
+000141c0: 6e70 2e64 6961 676f 6e61 6c28 6529 290a  np.diagonal(e)).
+000141d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000141e0: 2020 2020 6520 3d20 6e70 2e73 7172 7428      e = np.sqrt(
+000141f0: 6529 0a20 2020 2320 6472 6177 2064 6174  e).   # draw dat
+00014200: 610a 2020 2020 2020 6669 6720 3d20 706c  a.      fig = pl
+00014210: 742e 6669 6775 7265 286e 756d 3d6e 756d  t.figure(num=num
+00014220: 2c20 6669 6773 697a 653d 6669 6773 697a  , figsize=figsiz
+00014230: 6529 0a20 2020 2020 2069 6478 203d 206e  e).      idx = n
+00014240: 702e 6c69 6e73 7061 6365 2830 2e35 2c20  p.linspace(0.5, 
+00014250: 6c65 6e28 7829 2d30 2e35 2c20 6c65 6e28  len(x)-0.5, len(
+00014260: 7829 290a 2020 2020 2020 706c 742e 706c  x)).      plt.pl
+00014270: 6f74 2869 6478 2c20 782c 206d 6172 6b65  ot(idx, x, marke
+00014280: 723d 2778 272c 206c 696e 6573 7479 6c65  r='x', linestyle
+00014290: 3d27 272c 2063 6f6c 6f72 3d27 6772 6579  ='', color='grey
+000142a0: 272c 2061 6c70 6861 3d30 2e35 290a 2020  ', alpha=0.5).  
+000142b0: 2020 2020 706c 742e 6572 726f 7262 6172      plt.errorbar
+000142c0: 2869 6478 2c20 782c 2065 2c20 666d 743d  (idx, x, e, fmt=
+000142d0: 222e 222c 2063 6170 7369 7a65 3d33 2e30  ".", capsize=3.0
+000142e0: 2c20 6c61 6265 6c3d 6461 7461 5f6c 6162  , label=data_lab
+000142f0: 656c 290a 2020 2020 2020 706c 742e 786c  el).      plt.xl
+00014300: 696d 2830 2e2c 206c 656e 2869 6478 2929  im(0., len(idx))
+00014310: 0a20 2020 2020 2069 6620 7365 6c66 2e78  .      if self.x
+00014320: 4e61 6d65 7320 6973 206e 6f74 204e 6f6e  Names is not Non
+00014330: 653a 0a20 2020 2020 2020 2020 706c 742e  e:.         plt.
+00014340: 7874 6963 6b73 2874 6963 6b73 3d69 6478  xticks(ticks=idx
+00014350: 2c20 6c61 6265 6c73 3d73 656c 662e 784e  , labels=self.xN
+00014360: 616d 6573 290a 2020 2020 2020 656c 7365  ames).      else
+00014370: 3a20 0a20 2020 2020 2020 2020 706c 742e  : .         plt.
+00014380: 7874 6963 6b73 2874 6963 6b73 3d69 6478  xticks(ticks=idx
+00014390: 2c20 6c61 6265 6c73 3d72 616e 6765 286c  , labels=range(l
+000143a0: 656e 2869 6478 2929 290a 0a20 2020 2020  en(idx)))..     
+000143b0: 2072 6574 7572 6e20 6669 670a 2020 2020   return fig.    
+000143c0: 2020 0a20 2023 2064 6566 696e 6520 6375    .  # define cu
+000143d0: 7374 6f6d 2063 6f73 7420 6675 6e63 7469  stom cost functi
+000143e0: 6f6e 2066 6f72 2069 6d69 6e75 6974 0a20  on for iminuit. 
+000143f0: 2063 6c61 7373 2069 6e64 6578 6564 436f   class indexedCo
+00014400: 7374 3a0a 2020 2020 2222 220a 2020 2020  st:.    """.    
+00014410: 4375 7374 6f6d 2065 5f78 5f74 656e 6465  Custom e_x_tende
+00014420: 6420 4c65 6173 742d 5351 7561 7265 7320  d Least-SQuares 
+00014430: 636f 7374 2066 756e 6374 696f 6e20 7769  cost function wi
+00014440: 7468 200a 2020 2020 6479 6e61 6d69 6361  th .    dynamica
+00014450: 6c6c 7920 7570 6461 7465 6420 636f 7661  lly updated cova
+00014460: 7269 616e 6365 206d 6174 7269 7820 616e  riance matrix an
+00014470: 6420 2d32 6c6f 6728 4c29 200a 2020 2020  d -2log(L) .    
+00014480: 636f 7272 6563 7469 6f6e 2074 6572 6d20  correction term 
+00014490: 666f 7220 7061 7261 6d65 7465 722d 6465  for parameter-de
+000144a0: 7065 6e64 656e 7420 756e 6365 7274 6169  pendent uncertai
+000144b0: 6e74 6965 732e 0a0a 2020 2020 5468 6520  nties...    The 
+000144c0: 6465 6661 756c 7420 636f 7374 2066 756e  default cost fun
+000144d0: 6374 696f 6e20 6973 2074 7769 6365 2074  ction is twice t
+000144e0: 6865 206e 6567 6174 6976 6520 6c6f 6761  he negative loga
+000144f0: 7269 7468 6d20 0a20 2020 206f 6620 7468  rithm .    of th
+00014500: 6520 6c69 6b65 6c69 686f 6f64 206f 6620  e likelihood of 
+00014510: 6120 4761 7573 7369 616e 2064 6973 7472  a Gaussian distr
+00014520: 6962 7574 696f 6e20 666f 7220 6461 7461  ibution for data
+00014530: 2070 6f69 6e74 7320 0a20 2020 203a 6d61   points .    :ma
+00014540: 7468 3a60 2878 2c20 7929 6020 7769 7468  th:`(x, y)` with
+00014550: 2061 206d 6f64 656c 2066 756e 6374 696f   a model functio
+00014560: 6e20 3a6d 6174 683a 6079 3d66 2878 2c20  n :math:`y=f(x, 
+00014570: 2a70 2960 2064 6570 656e 6469 6e67 0a20  *p)` depending. 
+00014580: 2020 206f 6e20 6120 7365 7420 6f66 2070     on a set of p
+00014590: 6172 616d 6574 6572 7320 3a6d 6174 683a  arameters :math:
+000145a0: 602a 7060 2061 6e64 2061 2070 6f73 7369  `*p` and a possi
+000145b0: 626c 7920 7061 7261 6d65 7465 722d 6465  bly parameter-de
+000145c0: 7065 6e64 656e 740a 2020 2020 636f 7661  pendent.    cova
+000145d0: 7269 616e 6365 206d 6174 7269 7820 3a6d  riance matrix :m
+000145e0: 6174 683a 6056 2878 2c20 6628 782c 202a  ath:`V(x, f(x, *
+000145f0: 7029 2960 206f 6620 7468 6520 7820 616e  p))` of the x an
+00014600: 6420 7920 6461 7461 3a0a 0a20 2020 202e  d y data:..    .
+00014610: 2e20 6d61 7468 3a3a 200a 2020 2020 2020  . math:: .      
+00014620: 2d32 5c6c 6e20 7b5c 6361 6c20 4c7d 203d  -2\ln {\cal L} =
+00014630: 205c 6368 695e 3228 782c 2056 5e7b 2d31   \chi^2(x, V^{-1
+00014640: 7d2c 2078 282a 7029 205c 2c29 200a 2020  }, x(*p) \,) .  
+00014650: 2020 2020 2b20 5c6c 6e28 5c2c 205c 6465      + \ln(\, \de
+00014660: 7428 2056 2878 2c20 7828 2a70 2920 2920  t( V(x, x(*p) ) 
+00014670: 5c2c 290a 0a20 2020 2049 6e20 7468 6520  \,)..    In the 
+00014680: 6162 7365 6e63 6520 6f66 2070 6172 616d  absence of param
+00014690: 6574 6572 2d64 6570 656e 6465 6e74 2063  eter-dependent c
+000146a0: 6f6d 706f 6e65 6e74 7320 6f66 2074 6865  omponents of the
+000146b0: 2063 6f76 6172 6961 6e63 650a 2020 2020   covariance.    
+000146c0: 6d61 7472 6978 2c20 7468 6520 6c61 7374  matrix, the last
+000146d0: 2074 6572 6d20 6973 206f 6d69 7474 6564   term is omitted
+000146e0: 2061 6e64 2074 6865 2063 6f73 7420 6675   and the cost fu
+000146f0: 6e63 7469 6f6e 2069 7320 6964 656e 7469  nction is identi
+00014700: 6361 6c0a 2020 2020 746f 2074 6865 2063  cal.    to the c
+00014710: 6c61 7373 6963 616c 203a 6d61 7468 3a60  lassical :math:`
+00014720: 5c63 6869 5e32 602e 200a 2020 2020 466f  \chi^2`. .    Fo
+00014730: 7220 7468 6520 6576 616c 7561 7469 6f6e  r the evaluation
+00014740: 206f 6620 7468 6520 636f 7374 2066 756e   of the cost fun
+00014750: 6374 696f 6e20 616e 2065 6666 6963 6965  ction an efficie
+00014760: 6e74 2061 7070 726f 6163 6820 6261 7365  nt approach base
+00014770: 640a 2020 2020 6f6e 2074 6865 2022 4368  d.    on the "Ch
+00014780: 6f6c 6573 6b79 2064 6563 6f6d 706f 7369  olesky decomposi
+00014790: 7469 6f6e 2220 6f66 2074 6865 2063 6f76  tion" of the cov
+000147a0: 6172 6961 6e63 6520 6d61 7472 6978 2069  ariance matrix i
+000147b0: 6e20 0a20 2020 2061 2070 726f 6475 6374  n .    a product
+000147c0: 206f 6620 6120 7472 6961 6e67 756c 6172   of a triangular
+000147d0: 206d 6174 7269 7820 616e 6420 6974 7320   matrix and its 
+000147e0: 7472 616e 7370 6f73 6564 2069 7320 7573  transposed is us
+000147f0: 6564 3a0a 0a20 2020 202e 2e20 6d61 7468  ed:..    .. math
+00014800: 3a3a 0a20 2020 2020 2020 5620 3d20 4c20  ::.       V = L 
+00014810: 4c5e 542e 2020 2020 0a0a 2020 2020 5468  L^T.    ..    Th
+00014820: 6520 7661 6c75 6520 6f66 2074 6865 2063  e value of the c
+00014830: 6f73 7420 6675 6e63 7469 6f6e 200a 0a20  ost function .. 
+00014840: 2020 202e 2e20 6d61 7468 3a3a 0a20 2020     .. math::.   
+00014850: 2020 205c 6368 695e 3220 3d20 7b72 7d5c     \chi^2 = {r}\
+00014860: 6364 6f74 2028 565e 7b2d 317d 7b72 7d29  cdot (V^{-1}{r})
+00014870: 207e 7e77 6974 687e 7e20 7220 3d20 7820   ~~with~~ r = x 
+00014880: 2d20 7828 2a70 290a 0a20 2020 2069 7320  - x(*p)..    is 
+00014890: 7468 656e 2063 616c 6375 6c61 7465 6420  then calculated 
+000148a0: 6279 2073 6f6c 7669 6e67 2074 6865 206c  by solving the l
+000148b0: 696e 6561 7220 6571 7561 7469 6f6e 2020  inear equation  
+000148c0: 0a0a 2020 202e 2e20 6d61 7468 3a3a 0a20  ..   .. math::. 
+000148d0: 2020 2020 2056 2058 203d 2072 2c20 7e69       V X = r, ~i
+000148e0: 2e65 2e7e 2058 3d56 5e7b 2d31 7d20 7220  .e.~ X=V^{-1} r 
+000148f0: 7e61 6e64 7e20 5c63 6869 5e32 3d20 7220  ~and~ \chi^2= r 
+00014900: 5c63 646f 7420 5820 2020 0a0a 2020 2077  \cdot X   ..   w
+00014910: 6974 6820 7468 6520 6c69 6e65 6172 2d65  ith the linear-e
+00014920: 7175 6174 696f 6e20 736f 6c76 6572 202a  quation solver *
+00014930: 7363 6970 792e 6c69 6e61 6c67 2e63 686f  scipy.linalg.cho
+00014940: 5f73 6f6c 7665 284c 2c78 292a 0a20 2020  _solve(L,x)*.   
+00014950: 666f 7220 4368 6f6c 6573 6b79 2d64 6563  for Cholesky-dec
+00014960: 6f6d 706f 7365 6420 6d61 7472 6963 6573  omposed matrices
+00014970: 2c20 7468 7573 2061 766f 6964 696e 6720  , thus avoiding 
+00014980: 7468 6520 636f 7374 7920 0a20 2020 6361  the costy .   ca
+00014990: 6c63 756c 6174 696f 6e20 6f66 2074 6865  lculation of the
+000149a0: 2069 6e76 6572 7365 206d 6174 7269 782e   inverse matrix.
+000149b0: 0a20 2020 200a 0a20 2020 5468 6520 6465  .    ..   The de
+000149c0: 7465 726d 696e 616e 742c 2069 6620 6e65  terminant, if ne
+000149d0: 6564 6564 2c20 6973 2065 6666 6963 6965  eded, is efficie
+000149e0: 6e74 6c79 2063 616c 6375 6c61 7465 6420  ntly calculated 
+000149f0: 6279 2074 616b 696e 6720 0a20 2020 7468  by taking .   th
+00014a00: 6520 7072 6f64 7563 7420 6f66 2074 6865  e product of the
+00014a10: 2064 6961 676f 6e61 6c20 656c 656d 656e   diagonal elemen
+00014a20: 7473 206f 6620 7468 6520 6d61 7472 6978  ts of the matrix
+00014a30: 204c 2c0a 0a20 2020 202e 2e20 6d61 7468   L,..    .. math
+00014a40: 3a3a 0a20 2020 2020 205c 6465 7428 5629  ::.      \det(V)
+00014a50: 203d 2032 205c 2c20 5c70 726f 6420 4c5f   = 2 \, \prod L_
+00014a60: 7b69 2c69 7d0a 2020 2020 0a20 2020 2049  {i,i}.    .    I
+00014a70: 6e70 7574 3a0a 0a20 2020 202d 206f 7574  nput:..    - out
+00014a80: 6572 3a20 706f 696e 7465 7220 746f 2069  er: pointer to i
+00014a90: 6e73 7461 6e63 6520 6f66 2063 616c 6c69  nstance of calli
+00014aa0: 6e67 2063 6c61 7373 0a20 2020 202d 206d  ng class.    - m
+00014ab0: 6f64 656c 3a20 6d6f 6465 6c20 6675 6e63  odel: model func
+00014ac0: 7469 6f6e 2063 616c 756c 6174 696e 6720  tion calulating 
+00014ad0: 7468 6520 6461 7461 2078 285c 2a70 6172  the data x(\*par
+00014ae0: 290a 2020 2020 2d20 7573 655f 6e65 6732  ).    - use_neg2
+00014af0: 6c6f 674c 3a20 7573 6520 6675 6c6c 202d  logL: use full -
+00014b00: 326c 6f67 284c 2920 696e 7374 6561 6420  2log(L) instead 
+00014b10: 6f66 2063 6869 3220 6966 2054 7275 650a  of chi2 if True.
+00014b20: 0a20 2020 205f 5f63 616c 6c5f 5f20 6d65  .    __call__ me
+00014b30: 7468 6f64 206f 6620 7468 6973 2063 6c61  thod of this cla
+00014b40: 7373 2069 7320 6361 6c6c 6564 2062 7920  ss is called by 
+00014b50: 696d 696e 7569 740a 0a20 2020 2044 6174  iminuit..    Dat
+00014b60: 6120 6d65 6d62 6572 733a 0a0a 2020 2020  a members:..    
+00014b70: 2d20 6e64 6f66 3a20 6465 6772 6565 7320  - ndof: degrees 
+00014b80: 6f66 2066 7265 6564 6f6d 200a 2020 2020  of freedom .    
+00014b90: 2d20 6e63 6f6e 7374 7261 696e 7473 3a20  - nconstraints: 
+00014ba0: 6e75 6d62 6572 206f 6620 7061 7261 6d65  number of parame
+00014bb0: 7465 7220 636f 6e73 7472 6169 6e74 730a  ter constraints.
+00014bc0: 2020 2020 2d20 676f 663a 2063 6869 322d      - gof: chi2-
+00014bd0: 7661 6c75 6520 2867 6f6f 646e 6573 7320  value (goodness 
+00014be0: 6f66 2066 6974 290a 2020 2020 2d20 7573  of fit).    - us
+00014bf0: 655f 6e65 6732 6c6f 674c 3a20 7573 6167  e_neg2logL: usag
+00014c00: 6520 6f66 2066 756c 6c20 322a 6e65 6720  e of full 2*neg 
+00014c10: 4c6f 6720 4c69 6b65 6c69 686f 6f64 0a20  Log Likelihood. 
+00014c20: 2020 202d 2071 7569 6574 3a20 6e6f 2070     - quiet: no p
+00014c30: 7269 6e74 6f75 7420 6966 2054 7275 6520  rintout if True 
+00014c40: 2020 200a 0a20 2020 204d 6574 686f 6473     ..    Methods
+00014c50: 3a0a 0a20 2020 202d 206d 6f64 656c 2878  :..    - model(x
+00014c60: 2c20 5c2a 7061 7229 0a20 2020 2022 2222  , \*par).    """
+00014c70: 0a20 0a20 2020 2064 6566 205f 5f69 6e69  . .    def __ini
+00014c80: 745f 5f28 7365 6c66 2c20 6f75 7465 722c  t__(self, outer,
+00014c90: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00014ca0: 2020 206d 6f64 656c 2c0a 2020 2020 2020     model,.      
+00014cb0: 2020 2020 2020 2020 2020 2075 7365 5f6e             use_n
+00014cc0: 6567 326c 6f67 4c3d 4661 6c73 6529 3a0a  eg2logL=False):.
+00014cd0: 0a20 2020 2020 2023 2064 6174 6120 6f62  .      # data ob
+00014ce0: 6a65 6374 206f 6620 7479 7065 2078 7944  ject of type xyD
+00014cf0: 6174 6143 6f6e 7461 696e 6572 0a20 2020  ataContainer.   
+00014d00: 2020 2073 656c 662e 6461 7461 203d 206f     self.data = o
+00014d10: 7574 6572 2e64 6174 610a 2020 2020 2020  uter.data.      
+00014d20: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00014d30: 6528 7365 6c66 2e64 6174 612c 206d 6e46  e(self.data, mnF
+00014d40: 6974 2e78 4461 7461 436f 6e74 6169 6e65  it.xDataContaine
+00014d50: 7229 3a0a 2020 2020 2020 2020 7261 6973  r):.        rais
+00014d60: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+00014d70: 2020 2020 2020 2020 2220 2121 2120 6d6e          " !!! mn
+00014d80: 4669 742e 696e 6465 7865 6443 6f73 743a  Fit.indexedCost:
+00014d90: 2065 7870 6563 7469 6e67 2064 6174 6120   expecting data 
+00014da0: 636f 6e74 6169 6e65 7220 6f66 2074 7970  container of typ
+00014db0: 6520 276d 6e46 6974 2e78 4461 7461 436f  e 'mnFit.xDataCo
+00014dc0: 6e74 6169 6e65 7227 2229 0a20 2020 2020  ntainer'").     
+00014dd0: 2073 656c 662e 6d6f 6465 6c20 3d20 6d6f   self.model = mo
+00014de0: 6465 6c0a 2020 2020 2020 7365 6c66 2e71  del.      self.q
+00014df0: 7569 6574 203d 206f 7574 6572 2e71 7569  uiet = outer.qui
+00014e00: 6574 0a20 2020 2020 2023 2075 7365 202d  et.      # use -
+00014e10: 3220 2a20 6c6f 6728 4c29 206f 6620 4761  2 * log(L) of Ga
+00014e20: 7573 7369 616e 2069 6e73 7465 6164 206f  ussian instead o
+00014e30: 6620 4368 6932 0a20 2020 2020 2023 2020  f Chi2.      #  
+00014e40: 286f 6e6c 7920 6469 6666 6572 656e 7420  (only different 
+00014e50: 6672 6f6d 2043 6869 3220 666f 7220 7061  from Chi2 for pa
+00014e60: 7261 6d65 7465 722d 6465 7065 6e64 656e  rameter-dependen
+00014e70: 7420 756e 6365 7274 6169 6e74 6965 7329  t uncertainties)
+00014e80: 0a20 2020 2020 2073 656c 662e 7573 655f  .      self.use_
+00014e90: 6e65 6732 6c6f 674c 203d 2075 7365 5f6e  neg2logL = use_n
+00014ea0: 6567 326c 6f67 4c0a 2020 2020 2020 0a20  eg2logL.      . 
+00014eb0: 2020 2020 2023 2073 6574 2070 726f 7065       # set prope
+00014ec0: 7220 7369 676e 6174 7572 6520 6f66 206d  r signature of m
+00014ed0: 6f64 656c 2066 756e 6374 696f 6e20 666f  odel function fo
+00014ee0: 7220 696d 696e 7569 740a 2020 2020 2020  r iminuit.      
+00014ef0: 7365 6c66 2e70 6e61 6d73 203d 206f 7574  self.pnams = out
+00014f00: 6572 2e70 6e61 6d73 0a20 2020 2020 2073  er.pnams.      s
+00014f10: 656c 662e 6e70 6172 203d 206f 7574 6572  elf.npar = outer
+00014f20: 2e6e 7061 720a 0a20 2020 2020 2023 2074  .npar..      # t
+00014f30: 616b 6520 6163 636f 756e 7420 6f66 2063  ake account of c
+00014f40: 6f6e 7374 7261 696e 7473 200a 2020 2020  onstraints .    
+00014f50: 2020 7365 6c66 2e63 6f6e 7374 7261 696e    self.constrain
+00014f60: 7473 203d 206f 7574 6572 2e63 6f6e 7374  ts = outer.const
+00014f70: 7261 696e 7473 0a20 2020 2020 2073 656c  raints.      sel
+00014f80: 662e 6e63 6f6e 7374 7261 696e 7473 203d  f.nconstraints =
+00014f90: 206c 656e 2873 656c 662e 636f 6e73 7472   len(self.constr
+00014fa0: 6169 6e74 7329 0a20 2020 2020 2073 656c  aints).      sel
+00014fb0: 662e 6e64 6f66 203d 206c 656e 2873 656c  f.ndof = len(sel
+00014fc0: 662e 6461 7461 2e78 2920 2d20 7365 6c66  f.data.x) - self
+00014fd0: 2e6e 7061 7220 2b20 7365 6c66 2e6e 636f  .npar + self.nco
+00014fe0: 6e73 7472 6169 6e74 7320 2b20 6f75 7465  nstraints + oute
+00014ff0: 722e 6e66 6978 6564 0a0a 2020 2020 2020  r.nfixed..      
+00015000: 2320 666c 6167 2074 6f20 636f 6e74 726f  # flag to contro
+00015010: 6c20 6669 6e61 6c20 6163 7469 6f6e 7320  l final actions 
+00015020: 696e 2063 6f73 7420 6675 6e63 7469 6f6e  in cost function
+00015030: 0a20 2020 2020 2073 656c 662e 6669 6e61  .      self.fina
+00015040: 6c5f 6361 6c6c 203d 2046 616c 7365 0a0a  l_call = False..
+00015050: 0a20 2020 2064 6566 205f 5f63 616c 6c5f  .    def __call_
+00015060: 5f28 7365 6c66 2c20 2a70 6172 293a 2020  _(self, *par):  
+00015070: 0a20 2020 2020 2023 2063 616c 6c65 6420  .      # called 
+00015080: 6974 6572 6174 6976 656c 7920 6279 206d  iteratively by m
+00015090: 696e 7569 740a 0a20 2020 2020 2023 2063  inuit..      # c
+000150a0: 6f73 7420 6675 6e63 7469 6f6e 2069 7320  ost function is 
+000150b0: 6578 7465 6e64 6564 2063 6869 323a 0a20  extended chi2:. 
+000150c0: 2020 2020 2023 2020 2061 6464 206e 6f72       #   add nor
+000150d0: 6d61 6c69 7a61 7469 6f6e 2074 6572 6d20  malization term 
+000150e0: 6966 2075 6e63 6572 7461 696e 7469 6573  if uncertainties
+000150f0: 2064 6570 656e 6420 6f6e 206d 6f64 656c   depend on model
+00015100: 200a 0a20 2020 2020 206e 6c4c 3220 3d20   ..      nlL2 = 
+00015110: 302e 2023 2069 6e69 7469 616c 697a 6520  0. # initialize 
+00015120: 2d32 2a6c 6e28 4c29 0a20 2020 2020 2023  -2*ln(L).      #
+00015130: 2020 6669 7273 742c 2074 616b 6520 696e    first, take in
+00015140: 746f 2061 6363 6f75 6e74 2070 6f73 7369  to account possi
+00015150: 626c 6520 7061 7261 6d65 7465 7220 636f  ble parameter co
+00015160: 6e73 7472 6169 6e74 7320 200a 2020 2020  nstraints  .    
+00015170: 2020 6966 2073 656c 662e 6e63 6f6e 7374    if self.nconst
+00015180: 7261 696e 7473 3a0a 2020 2020 2020 2020  raints:.        
+00015190: 666f 7220 6320 696e 2073 656c 662e 636f  for c in self.co
+000151a0: 6e73 7472 6169 6e74 733a 0a20 2020 2020  nstraints:.     
+000151b0: 2020 2020 2070 5f69 6420 3d20 635b 305d       p_id = c[0]
+000151c0: 0a20 2020 2020 2020 2020 2072 203d 2028  .          r = (
+000151d0: 2070 6172 5b70 5f69 645d 202d 2063 5b31   par[p_id] - c[1
+000151e0: 5d29 202f 2063 5b32 5d20 0a20 2020 2020  ]) / c[2] .     
+000151f0: 2020 2020 206e 6c4c 3220 2b3d 2072 2a72       nlL2 += r*r
+00015200: 0a0a 2020 2020 2020 2320 6361 6c63 756c  ..      # calcul
+00015210: 6174 6520 7265 7369 6475 616c 206f 6620  ate residual of 
+00015220: 6461 7461 2077 7274 2e20 6d6f 6465 6c0a  data wrt. model.
+00015230: 2020 2020 2020 6d6f 6465 6c5f 7661 6c75        model_valu
+00015240: 6573 203d 2073 656c 662e 6d6f 6465 6c28  es = self.model(
+00015250: 7365 6c66 2e64 6174 612e 782c 202a 7061  self.data.x, *pa
+00015260: 7229 0a20 2020 2020 205f 7220 3d20 7365  r).      _r = se
+00015270: 6c66 2e64 6174 612e 7820 2d20 6d6f 6465  lf.data.x - mode
+00015280: 6c5f 7661 6c75 6573 0a0a 2020 2020 2020  l_values..      
+00015290: 6966 2073 656c 662e 6461 7461 2e6e 6565  if self.data.nee
+000152a0: 6473 5f63 6f76 6172 6961 6e63 653a 0a20  ds_covariance:. 
+000152b0: 2020 2020 2020 2023 2020 6368 6563 6b20         #  check 
+000152c0: 6966 206d 6174 7269 7820 6e65 6564 7320  if matrix needs 
+000152d0: 7265 6275 696c 6469 6e67 0a20 2020 2020  rebuilding.     
+000152e0: 2020 2069 6620 6e6f 7420 7365 6c66 2e64     if not self.d
+000152f0: 6174 612e 6e65 6564 735f 6479 6e61 6d69  ata.needs_dynami
+00015300: 6345 7272 6f72 733a 0a20 2020 2020 2020  cErrors:.       
+00015310: 2020 2320 7374 6174 6963 2063 6f76 6172    # static covar
+00015320: 6961 6e63 652c 2075 7365 2069 7473 2069  iance, use its i
+00015330: 6e76 6572 7365 0a20 2020 2020 2020 2020  nverse.         
+00015340: 206e 6c4c 3220 2b3d 2066 6c6f 6174 286e   nlL2 += float(n
+00015350: 702e 696e 6e65 7228 6e70 2e6d 6174 6d75  p.inner(np.matmu
+00015360: 6c28 5f72 2c20 7365 6c66 2e64 6174 612e  l(_r, self.data.
+00015370: 6943 6f76 292c 205f 7229 290a 2020 2020  iCov), _r)).    
+00015380: 2020 2020 2020 2320 6964 656e 7469 6361        # identica
+00015390: 6c20 746f 2063 6c61 7373 6963 616c 2043  l to classical C
+000153a0: 6869 320a 2020 2020 2020 2020 2020 7365  hi2.          se
+000153b0: 6c66 2e67 6f66 203d 206e 6c4c 320a 2020  lf.gof = nlL2.  
+000153c0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000153d0: 2065 6c73 653a 2023 2064 796e 616d 6963   else: # dynamic
+000153e0: 616c 6c79 2072 6562 7569 6c64 2063 6f76  ally rebuild cov
+000153f0: 6172 6961 6e63 6520 6d61 7472 6978 0a20  ariance matrix. 
+00015400: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
+00015410: 7461 2e5f 7265 6275 696c 645f 436f 7628  ta._rebuild_Cov(
+00015420: 7061 7229 0a20 2020 2020 2020 2020 2023  par).          #
+00015430: 2075 7365 2043 686f 6c65 736b 7920 6465   use Cholesky de
+00015440: 636f 6d70 6f73 6974 6f6e 2074 6f20 636f  compositon to co
+00015450: 6d70 7574 6520 6368 6932 203d 205f 722e  mpute chi2 = _r.
+00015460: 5420 2856 5e2d 3129 205f 7220 0a20 2020  T (V^-1) _r .   
+00015470: 2020 2020 2020 204c 2c20 6973 5f6c 6f77         L, is_low
+00015480: 6572 203d 206c 696e 616c 672e 6368 6f5f  er = linalg.cho_
+00015490: 6661 6374 6f72 2873 656c 662e 6461 7461  factor(self.data
+000154a0: 2e63 6f76 2c20 6368 6563 6b5f 6669 6e69  .cov, check_fini
+000154b0: 7465 3d46 616c 7365 290a 2020 2020 2020  te=False).      
+000154c0: 2020 2020 6e6c 4c32 202b 3d20 6e70 2e69      nlL2 += np.i
+000154d0: 6e6e 6572 285f 722c 206c 696e 616c 672e  nner(_r, linalg.
+000154e0: 6368 6f5f 736f 6c76 6528 284c 2c20 6973  cho_solve((L, is
+000154f0: 5f6c 6f77 6572 292c 205f 7229 2029 0a20  _lower), _r) ). 
+00015500: 2020 2020 2020 2020 2023 2075 7020 746f           # up to
+00015510: 2068 6572 652c 2069 6465 6e74 6963 616c   here, identical
+00015520: 2074 6f20 636c 6173 7369 6361 6c20 4368   to classical Ch
+00015530: 6932 0a20 2020 2020 2020 2020 2073 656c  i2.          sel
+00015540: 662e 676f 6620 3d20 6e6c 4c32 2020 2020  f.gof = nlL2    
+00015550: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+00015560: 2020 2020 2020 2023 2074 616b 6520 696e         # take in
+00015570: 746f 2061 6363 6f75 6e74 2070 6172 616d  to account param
+00015580: 6574 6572 2d64 6570 656e 6465 6e74 206e  eter-dependent n
+00015590: 6f72 6d61 6c69 7361 7469 6f6e 2074 6572  ormalisation ter
+000155a0: 6d0a 2020 2020 2020 2020 2020 6966 2073  m.          if s
+000155b0: 656c 662e 7573 655f 6e65 6732 6c6f 674c  elf.use_neg2logL
+000155c0: 3a0a 2020 2020 2020 2020 2023 2020 6661  :.         #  fa
+000155d0: 7374 2063 616c 6375 6c61 7469 6f6e 206f  st calculation o
+000155e0: 6620 6465 7465 726d 696e 616e 7420 6465  f determinant de
+000155f0: 7428 5629 2066 726f 6d20 4368 6f6c 6573  t(V) from Choles
+00015600: 6b79 2066 6163 746f 7220 0a20 2020 2020  ky factor .     
+00015610: 2020 2020 2020 206e 6c4c 3220 2b3d 2032         nlL2 += 2
+00015620: 2e2a 6e70 2e73 756d 286e 702e 6c6f 6728  .*np.sum(np.log(
+00015630: 6e70 2e64 6961 676f 6e61 6c28 4c29 2029  np.diagonal(L) )
+00015640: 2029 0a0a 2020 2020 2020 656c 7365 3a20   )..      else: 
+00015650: 2023 2066 6173 7420 6361 6c63 756c 6174   # fast calculat
+00015660: 696f 6e20 666f 7220 7369 6d70 6c65 2065  ion for simple e
+00015670: 7272 6f72 730a 2020 2020 2020 2020 2320  rrors.        # 
+00015680: 6368 6563 6b20 6966 2065 7272 6f72 7320  check if errors 
+00015690: 6e65 6564 7320 7265 6361 6c63 756c 6174  needs recalculat
+000156a0: 696e 670a 2020 2020 2020 2020 6966 2073  ing.        if s
+000156b0: 656c 662e 6461 7461 2e6e 6565 6473 5f64  elf.data.needs_d
+000156c0: 796e 616d 6963 4572 726f 7273 3a0a 2020  ynamicErrors:.  
+000156d0: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+000156e0: 612e 5f72 6562 7569 6c64 5f45 7272 3228  a._rebuild_Err2(
+000156f0: 7061 7229 0a20 2020 2020 2020 2020 206e  par).          n
+00015700: 6c4c 3220 2b3d 206e 702e 7375 6d28 5f72  lL2 += np.sum(_r
+00015710: 202a 205f 7220 2f20 7365 6c66 2e64 6174   * _r / self.dat
+00015720: 612e 6572 7232 290a 2020 2020 2020 2020  a.err2).        
+00015730: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00015740: 6e6c 4c32 202b 3d20 6e70 2e73 756d 285f  nlL2 += np.sum(_
+00015750: 7220 2a20 5f72 202a 2073 656c 662e 6461  r * _r * self.da
+00015760: 7461 2e69 4572 7232 290a 0a20 2020 2020  ta.iErr2)..     
+00015770: 2020 2023 2074 6869 7320 6973 2069 6465     # this is ide
+00015780: 6e74 6963 616c 2074 6f20 636c 6173 7369  ntical to classi
+00015790: 6361 6c20 4368 6932 0a20 2020 2020 2020  cal Chi2.       
+000157a0: 2073 656c 662e 676f 6620 3d20 6e6c 4c32   self.gof = nlL2
+000157b0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+000157c0: 2020 2320 6164 6420 7061 7261 6d65 7465    # add paramete
+000157d0: 722d 6465 7065 6e64 656e 7420 6e6f 726d  r-dependent norm
+000157e0: 616c 697a 6174 696f 6e20 7465 726d 2069  alization term i
+000157f0: 6620 6e65 6564 6564 2061 6e64 2077 616e  f needed and wan
+00015800: 7465 640a 2020 2020 2020 2020 6966 2073  ted.        if s
+00015810: 656c 662e 6461 7461 2e6e 6565 6473 5f64  elf.data.needs_d
+00015820: 796e 616d 6963 4572 726f 7273 2061 6e64  ynamicErrors and
+00015830: 2073 656c 662e 7573 655f 6e65 6732 6c6f   self.use_neg2lo
+00015840: 674c 3a0a 2020 2020 2020 2020 2020 6e6c  gL:.          nl
+00015850: 4c32 202b 3d20 6e70 2e73 756d 286e 702e  L2 += np.sum(np.
+00015860: 6c6f 6728 7365 6c66 2e64 6174 612e 6572  log(self.data.er
+00015870: 7232 2929 0a0a 2020 2020 2020 2320 7072  r2))..      # pr
+00015880: 6f76 6964 6520 6d6f 6465 6c20 7661 6c75  ovide model valu
+00015890: 6573 2074 6f20 6461 7461 206f 626a 6563  es to data objec
+000158a0: 740a 2020 2020 2020 7365 6c66 2e64 6174  t.      self.dat
+000158b0: 612e 6d6f 6465 6c5f 7661 6c75 6573 203d  a.model_values =
+000158c0: 206d 6f64 656c 5f76 616c 7565 7320 2020   model_values   
+000158d0: 2020 2020 0a0a 2020 2020 2020 7265 7475      ..      retu
+000158e0: 726e 206e 6c4c 320a 0a0a 2020 230a 2020  rn nlL2...  #.  
+000158f0: 2320 2d2d 2d20 7370 6563 6961 6c20 636f  # --- special co
+00015900: 6465 2066 6f72 2068 6973 746f 6772 616d  de for histogram
+00015910: 2046 6974 0a20 2023 2020 2020 2020 0a0a   Fit.  #      ..
+00015920: 2020 6465 6620 7365 745f 684f 7074 696f    def set_hOptio
+00015930: 6e73 2873 656c 662c 0a20 2020 2020 2020  ns(self,.       
+00015940: 2020 2020 2020 2072 756e 5f6d 696e 6f73         run_minos
+00015950: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+00015960: 2020 2020 2075 7365 5f47 6175 7373 4170       use_GaussAp
+00015970: 7072 6f78 3d4e 6f6e 652c 0a20 2020 2020  prox=None,.     
+00015980: 2020 2020 2020 2020 2066 6974 5f64 656e           fit_den
+00015990: 7369 7479 203d 204e 6f6e 652c 0a20 2020  sity = None,.   
+000159a0: 2020 2020 2020 2020 2020 2071 7569 6574             quiet
+000159b0: 3d4e 6f6e 6529 3a0a 0a20 2020 2022 2222  =None):..    """
+000159c0: 4465 6669 6e65 206d 6e46 6974 206f 7074  Define mnFit opt
+000159d0: 696f 6e73 0a0a 2020 2020 2020 2041 7267  ions..       Arg
+000159e0: 733a 0a20 2020 2020 2020 202d 2072 756e  s:.        - run
+000159f0: 206d 696e 6f73 2065 6c73 6520 646f 6e2a   minos else don*
+00015a00: 7420 7275 6e20 6d69 6e6f 730a 2020 2020  t run minos.    
+00015a10: 2020 2020 2d20 7573 6520 4761 7573 7369      - use Gaussi
+00015a20: 616e 2041 7070 726f 7869 6d61 7469 6f6e  an Approximation
+00015a30: 206f 6620 506f 6973 736f 6e20 6469 7374   of Poisson dist
+00015a40: 7269 6275 7469 6f6e 0a20 2020 2020 2020  ribution.       
+00015a50: 202d 2064 6f6e 2a74 2070 726f 7669 6465   - don*t provide
+00015a60: 2070 7269 6e74 6f75 7420 656c 7365 2076   printout else v
+00015a70: 6572 626f 7365 2070 7269 6e74 6f75 7420  erbose printout 
+00015a80: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+00015a90: 7275 6e5f 6d69 6e6f 7320 6973 206e 6f74  run_minos is not
+00015aa0: 204e 6f6e 653a 2020 200a 2020 2020 2020   None:   .      
+00015ab0: 7365 6c66 2e72 756e 5f6d 696e 6f73 203d  self.run_minos =
+00015ac0: 2072 756e 5f6d 696e 6f73 0a20 2020 2020   run_minos.     
+00015ad0: 2073 656c 662e 6f70 7469 6f6e 735b 2272   self.options["r
+00015ae0: 756e 5f6d 696e 6f73 225d 5b30 5d20 3d20  un_minos"][0] = 
+00015af0: 696e 7428 7275 6e5f 6d69 6e6f 7329 0a20  int(run_minos). 
+00015b00: 2020 2069 6620 7573 655f 4761 7573 7341     if use_GaussA
+00015b10: 7070 726f 7820 6973 206e 6f74 204e 6f6e  pprox is not Non
+00015b20: 653a 2020 200a 2020 2020 2020 7365 6c66  e:   .      self
+00015b30: 2e75 7365 5f47 6175 7373 4170 7072 6f78  .use_GaussApprox
+00015b40: 203d 2075 7365 5f47 6175 7373 4170 7072   = use_GaussAppr
+00015b50: 6f78 0a20 2020 2020 2073 656c 662e 6f70  ox.      self.op
+00015b60: 7469 6f6e 735b 2275 7365 5f47 6175 7373  tions["use_Gauss
+00015b70: 4170 7072 6f78 225d 5b30 5d20 3d20 696e  Approx"][0] = in
+00015b80: 7428 7573 655f 4761 7573 7341 7070 726f  t(use_GaussAppro
+00015b90: 7829 0a20 2020 2069 6620 6669 745f 6465  x).    if fit_de
+00015ba0: 6e73 6974 7920 6973 206e 6f74 204e 6f6e  nsity is not Non
+00015bb0: 653a 0a20 2020 2020 2073 656c 662e 6669  e:.      self.fi
+00015bc0: 745f 6465 6e73 6974 7920 3d20 6669 745f  t_density = fit_
+00015bd0: 6465 6e73 6974 790a 2020 2020 2020 7365  density.      se
+00015be0: 6c66 2e6f 7074 696f 6e73 5b22 6669 745f  lf.options["fit_
+00015bf0: 6465 6e73 6974 7922 5d5b 305d 203d 2069  density"][0] = i
+00015c00: 6e74 2866 6974 5f64 656e 7369 7479 290a  nt(fit_density).
+00015c10: 2020 2020 6966 2071 7569 6574 2069 7320      if quiet is 
+00015c20: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00015c30: 7365 6c66 2e71 7569 6574 203d 2071 7569  self.quiet = qui
+00015c40: 6574 0a20 2020 200a 2020 6465 6620 696e  et.    .  def in
+00015c50: 6974 5f68 4461 7461 2873 656c 662c 0a20  it_hData(self,. 
+00015c60: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00015c70: 696e 5f63 6f6e 7465 6e74 732c 2062 696e  in_contents, bin
+00015c80: 5f65 6467 6573 2c20 4465 6c74 614d 753d  _edges, DeltaMu=
+00015c90: 4e6f 6e65 293a 0a20 2020 2022 2222 0a20  None):.    """. 
+00015ca0: 2020 2069 6e69 7469 616c 697a 6520 6869     initialize hi
+00015cb0: 7374 6f67 7261 6d20 6461 7461 206f 626a  stogram data obj
+00015cc0: 6563 740a 0a20 2020 2041 7267 733a 0a20  ect..    Args:. 
+00015cd0: 2020 202d 2062 696e 5f63 6f6e 7465 6e74     - bin_content
+00015ce0: 733a 2061 7272 6179 206f 6620 666c 6f61  s: array of floa
+00015cf0: 7473 0a20 2020 202d 2062 696e 5f65 6467  ts.    - bin_edg
+00015d00: 6573 3a20 6172 7261 7920 6f66 206c 656e  es: array of len
+00015d10: 6774 6820 6c65 6e28 6269 6e5f 636f 6e74  gth len(bin_cont
+00015d20: 656e 7473 292a 310a 2020 2020 2d20 4465  ents)*1.    - De
+00015d30: 6c74 614d 753a 2073 6869 6674 2069 6e20  ltaMu: shift in 
+00015d40: 6d65 616e 2028 4465 6c74 6120 6d75 2920  mean (Delta mu) 
+00015d50: 7665 7273 7573 206c 616d 6264 6120 0a20  versus lambda . 
+00015d60: 2020 206f 6620 506f 6973 736f 6e20 6469     of Poisson di
+00015d70: 7374 7269 6275 7469 6f6e 200a 2020 2020  stribution .    
+00015d80: 2222 220a 2020 2020 0a20 2020 2023 2063  """.    .    # c
+00015d90: 7265 6174 6520 6461 7461 206f 626a 6563  reate data objec
+00015da0: 7420 616e 6420 7061 7373 2061 6c6c 2069  t and pass all i
+00015db0: 6e70 7574 2061 7267 756d 656e 7473 0a20  nput arguments. 
+00015dc0: 2020 2073 656c 662e 6844 6174 6120 3d20     self.hData = 
+00015dd0: 7365 6c66 2e68 6973 7444 6174 6143 6f6e  self.histDataCon
+00015de0: 7461 696e 6572 2873 656c 662c 0a20 2020  tainer(self,.   
+00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e00: 2020 2020 2020 2020 2020 2020 6269 6e5f              bin_
+00015e10: 636f 6e74 656e 7473 2c20 6269 6e5f 6564  contents, bin_ed
+00015e20: 6765 732c 0a20 2020 2020 2020 2020 2020  ges,.           
+00015e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e40: 2020 2020 4465 6c74 614d 752c 0a20 2020      DeltaMu,.   
+00015e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e60: 2020 2020 2020 2020 2020 2020 7175 6965              quie
+00015e70: 743d 7365 6c66 2e71 7569 6574 290a 2020  t=self.quiet).  
+00015e80: 2020 7365 6c66 2e64 6174 6120 3d20 7365    self.data = se
+00015e90: 6c66 2e68 4461 7461 0a20 2020 200a 2020  lf.hData.    .  
+00015ea0: 6465 6620 696e 6974 5f68 4669 7428 7365  def init_hFit(se
+00015eb0: 6c66 2c20 6d6f 6465 6c2c 206d 6f64 656c  lf, model, model
+00015ec0: 5f6b 7761 7267 733d 4e6f 6e65 2c20 7030  _kwargs=None, p0
+00015ed0: 3d4e 6f6e 652c 2064 7030 3d4e 6f6e 652c  =None, dp0=None,
+00015ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015ef0: 2063 6f6e 7374 7261 696e 7473 3d4e 6f6e   constraints=Non
+00015f00: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00015f10: 2020 2066 6978 5061 7273 203d 204e 6f6e     fixPars = Non
+00015f20: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+00015f30: 2020 2020 6c69 6d69 7473 3d4e 6f6e 6529      limits=None)
+00015f40: 3a0a 2020 2020 2222 2269 6e69 7469 616c  :.    """initial
+00015f50: 697a 6520 6669 7420 6f62 6a65 6374 0a0a  ize fit object..
+00015f60: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
+00015f70: 2d20 6d6f 6465 6c3a 206d 6f64 656c 2064  - model: model d
+00015f80: 656e 7369 7479 2066 756e 6374 696f 6e20  ensity function 
+00015f90: 6628 783b 205c 2a70 6172 290a 2020 2020  f(x; \*par).    
+00015fa0: 2020 2d20 6d6f 6465 6c5f 6b77 6172 6773    - model_kwargs
+00015fb0: 3a20 6f70 7469 6f6e 616c 2c20 6669 7420  : optional, fit 
+00015fc0: 7061 7261 6d65 7465 7273 2069 6620 6e6f  parameters if no
+00015fd0: 7420 6672 6f6d 206d 6f64 656c 2073 6967  t from model sig
+00015fe0: 6e61 7475 7265 200a 2020 2020 2020 2d20  nature .      - 
+00015ff0: 7030 3a20 6e70 2d61 7272 6179 206f 6620  p0: np-array of 
+00016000: 666c 6f61 7473 2c20 696e 6974 6961 6c20  floats, initial 
+00016010: 7061 7261 6d65 7465 7220 7661 6c75 6573  parameter values
+00016020: 200a 2020 2020 2020 2d20 6470 303a 2061   .      - dp0: a
+00016030: 7272 6179 2d6c 696b 652c 2069 6e69 7469  rray-like, initi
+00016040: 616c 2067 7565 7373 206f 6620 7061 7261  al guess of para
+00016050: 6d65 7465 7220 756e 6365 7274 6169 6e74  meter uncertaint
+00016060: 6965 7320 286f 7074 696f 6e61 6c29 0a20  ies (optional). 
+00016070: 2020 2020 202d 2063 6f6e 7374 7261 696e       - constrain
+00016080: 7473 3a20 286e 6573 7465 6429 206c 6973  ts: (nested) lis
+00016090: 7428 7329 3a20 5b70 6172 616d 6574 6572  t(s): [parameter
+000160a0: 206e 616d 652c 2076 616c 7565 2c20 756e   name, value, un
+000160b0: 6365 7274 6169 6e74 795d 200a 2020 2020  certainty] .    
+000160c0: 2020 2020 6f72 205b 7061 7261 6d65 7465      or [paramete
+000160d0: 7220 696e 6465 782c 2076 616c 7565 2c20  r index, value, 
+000160e0: 756e 6365 7274 6169 6e74 795d 0a20 2020  uncertainty].   
+000160f0: 2020 202d 2066 6978 2070 6172 616d 6574     - fix paramet
+00016100: 6572 2873 2920 696e 2066 6974 3a20 6c69  er(s) in fit: li
+00016110: 7374 206f 6620 7061 7261 6d65 7465 7220  st of parameter 
+00016120: 6e61 6d65 7320 6f72 2069 6e64 6963 6573  names or indices
+00016130: 0a20 2020 2020 202d 206c 696d 6974 733a  .      - limits:
+00016140: 2028 6e65 7374 6564 2920 6c69 7374 2873   (nested) list(s
+00016150: 293a 205b 7061 7261 6d65 7465 7220 6e61  ): [parameter na
+00016160: 6d65 2c20 6d69 6e2c 206d 6178 5d20 0a20  me, min, max] . 
+00016170: 2020 2020 2020 206f 7220 5b70 6172 616d         or [param
+00016180: 6574 6572 2069 6e64 6578 2c20 6d69 6e2c  eter index, min,
+00016190: 206d 6178 5d0a 2020 2020 2222 220a 0a20   max].    """.. 
+000161a0: 2020 2069 6620 7365 6c66 2e68 4461 7461     if self.hData
+000161b0: 2069 7320 4e6f 6e65 3a20 0a20 2020 2020   is None: .     
+000161c0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+000161d0: 7228 0a20 2020 2020 2020 2027 2021 2121  r(.        ' !!!
+000161e0: 206d 6e46 6974 2e69 6e69 745f 6846 6974   mnFit.init_hFit
+000161f0: 3a20 6e6f 2064 6174 6120 6f62 6a65 6374  : no data object
+00016200: 2064 6566 696e 6564 202d 2063 616c 6c20   defined - call 
+00016210: 696e 6974 5f64 6174 6128 2927 290a 2020  init_data()').  
+00016220: 2020 0a20 2020 2023 2067 6574 2070 6172    .    # get par
+00016230: 616d 6574 6572 7320 6f66 206d 6f64 656c  ameters of model
+00016240: 2066 756e 6374 696f 6e20 746f 2073 6574   function to set
+00016250: 2073 7461 7274 2076 616c 7565 7320 666f   start values fo
+00016260: 7220 6669 740a 2020 2020 6966 206d 6f64  r fit.    if mod
+00016270: 656c 5f6b 7761 7267 7320 6973 204e 6f6e  el_kwargs is Non
+00016280: 653a 0a20 2020 2020 2061 7267 732c 206d  e:.      args, m
+00016290: 6f64 656c 5f6b 7761 7267 7320 3d20 6765  odel_kwargs = ge
+000162a0: 745f 6675 6e63 7469 6f6e 5369 676e 6174  t_functionSignat
+000162b0: 7572 6528 6d6f 6465 6c29 0a0a 2020 2020  ure(model)..    
+000162c0: 7061 7220 3d20 286d 6f64 656c 5f6b 7761  par = (model_kwa
+000162d0: 7267 732c 2070 302c 2064 7030 2c20 636f  rgs, p0, dp0, co
+000162e0: 6e73 7472 6169 6e74 732c 2066 6978 5061  nstraints, fixPa
+000162f0: 7273 2c20 6c69 6d69 7473 290a 2020 2020  rs, limits).    
+00016300: 7365 6c66 2e5f 7365 7475 7046 6974 5061  self._setupFitPa
+00016310: 7261 6d65 7465 7273 282a 7061 7229 0a0a  rameters(*par)..
+00016320: 2020 2020 2320 6372 6561 7465 2063 6f73      # create cos
+00016330: 7420 6675 6e63 7469 6f6e 0a20 2020 2073  t function.    s
+00016340: 656c 662e 636f 7374 6620 3d20 7365 6c66  elf.costf = self
+00016350: 2e68 436f 7374 2873 656c 662c 206d 6f64  .hCost(self, mod
+00016360: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
+00016370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016380: 7573 655f 4761 7573 7341 7070 726f 783d  use_GaussApprox=
+00016390: 7365 6c66 2e75 7365 5f47 6175 7373 4170  self.use_GaussAp
+000163a0: 7072 6f78 2c0a 2020 2020 2020 2020 2020  prox,.          
+000163b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163c0: 2020 6465 6e73 6974 7920 3d20 7365 6c66    density = self
+000163d0: 2e66 6974 5f64 656e 7369 7479 290a 2020  .fit_density).  
+000163e0: 2020 7365 6c66 2e5f 7365 7475 704d 696e    self._setupMin
+000163f0: 7569 7428 6d6f 6465 6c5f 6b77 6172 6773  uit(model_kwargs
+00016400: 2920 0a20 2020 2020 200a 2020 636c 6173  ) .      .  clas
+00016410: 7320 6869 7374 4461 7461 436f 6e74 6169  s histDataContai
+00016420: 6e65 723a 0a20 2020 2022 2222 0a20 2020  ner:.    """.   
+00016430: 2020 2043 6f6e 7461 696e 6572 2066 6f72     Container for
+00016440: 2048 6973 746f 6772 616d 2064 6174 610a   Histogram data.
+00016450: 0a20 2020 2020 2044 6174 6120 4d65 6d62  .      Data Memb
+00016460: 6572 733a 0a0a 2020 2020 2020 2d20 636f  ers:..      - co
+00016470: 6e74 656e 7473 2c20 6172 7261 7920 6f66  ntents, array of
+00016480: 2066 6c6f 6174 733a 2062 696e 2063 6f6e   floats: bin con
+00016490: 7465 6e74 730a 2020 2020 2020 2d20 6564  tents.      - ed
+000164a0: 6765 732c 2061 7272 6179 206f 6620 666c  ges, array of fl
+000164b0: 6f61 7473 3a20 6269 6e20 6564 6765 7320  oats: bin edges 
+000164c0: 286e 6269 6e73 2b31 2076 616c 7565 7329  (nbins+1 values)
+000164d0: 0a0a 2020 2020 2020 6361 6c63 756c 6174  ..      calculat
+000164e0: 6564 2066 726f 6d20 696e 7075 743a 0a0a  ed from input:..
+000164f0: 2020 2020 2020 2d20 6e62 696e 733a 206e        - nbins: n
+00016500: 756d 6265 7220 6f66 2062 696e 730a 2020  umber of bins.  
+00016510: 2020 2020 2d20 6c65 6674 733a 206c 6566      - lefts: lef
+00016520: 7420 6564 6765 730a 2020 2020 2020 2d20  t edges.      - 
+00016530: 7269 6768 7473 3a20 7269 6768 7420 6564  rights: right ed
+00016540: 6765 730a 2020 2020 2020 2d20 6365 6e74  ges.      - cent
+00016550: 6572 733a 2062 696e 2063 656e 7465 7273  ers: bin centers
+00016560: 0a20 2020 2020 202d 2077 6964 7468 733a  .      - widths:
+00016570: 2062 696e 2077 6964 7468 730a 2020 2020   bin widths.    
+00016580: 2020 2d20 4e74 6f74 3a20 746f 7461 6c20    - Ntot: total 
+00016590: 6e75 6d62 6572 206f 6620 656e 7472 6965  number of entrie
+000165a0: 732c 2075 7365 6420 746f 206e 6f72 6d61  s, used to norma
+000165b0: 6c69 7a65 2070 726f 6261 7469 6c69 7479  lize probatility
+000165c0: 2064 656e 7369 7479 0a0a 2020 2020 2020   density..      
+000165d0: 6176 6169 6c61 626c 6520 6166 7465 7220  available after 
+000165e0: 636f 6d70 6c65 7469 6f6e 206f 6620 6669  completion of fi
+000165f0: 743a 0a0a 2020 2020 2020 2d20 6d6f 6465  t:..      - mode
+00016600: 6c5f 7661 6c75 6573 3a20 6269 6e20 636f  l_values: bin co
+00016610: 6e74 656e 7473 2066 726f 6d20 6265 7374  ntents from best
+00016620: 2d66 6974 206d 6f64 656c 200a 0a20 2020  -fit model ..   
+00016630: 2020 204d 6574 686f 6473 3a0a 0a20 2020     Methods:..   
+00016640: 2020 202d 2070 6c6f 7428 293a 2072 6574     - plot(): ret
+00016650: 7572 6e20 6669 6775 7265 2077 6974 6820  urn figure with 
+00016660: 6869 7374 6f67 7261 6d20 6f66 2064 6174  histogram of dat
+00016670: 6120 616e 6420 756e 6365 7274 6169 6e74  a and uncertaint
+00016680: 6965 730a 2020 2020 2222 220a 2020 2020  ies.    """.    
+00016690: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+000166a0: 5f28 7365 6c66 2c20 6f75 7465 722c 0a20  _(self, outer,. 
+000166b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000166c0: 6269 6e5f 636f 6e74 656e 7473 2c20 6269  bin_contents, bi
+000166d0: 6e5f 6564 6765 732c 2044 656c 7461 4d75  n_edges, DeltaMu
+000166e0: 3d4e 6f6e 652c 2071 7569 6574 3d54 7275  =None, quiet=Tru
+000166f0: 6529 3a0a 2020 2020 2020 2222 2220 0a20  e):.      """ . 
+00016700: 2020 2020 2069 6e69 7469 616c 697a 6520       initialize 
+00016710: 6869 7374 6f67 7261 6d20 4461 7461 0a0a  histogram Data..
+00016720: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00016730: 2020 2d20 6269 6e5f 636f 6e74 656e 7473    - bin_contents
+00016740: 3a20 6172 7261 7920 6f66 2066 6c6f 6174  : array of float
+00016750: 730a 2020 2020 2020 2d20 6269 6e5f 6564  s.      - bin_ed
+00016760: 6765 733a 2061 7272 6179 206f 6620 6c65  ges: array of le
+00016770: 6e67 7468 206c 656e 2862 696e 5f63 6f6e  ngth len(bin_con
+00016780: 7465 6e74 7329 2a31 0a20 2020 2020 202d  tents)*1.      -
+00016790: 2044 656c 7461 4d75 3a20 6172 7261 7920   DeltaMu: array 
+000167a0: 6f66 2066 6c6f 6174 732c 2073 6869 6674  of floats, shift
+000167b0: 206f 6620 6d65 616e 206d 7520 7673 2e20   of mean mu vs. 
+000167c0: 0a20 2020 2020 2020 2020 206c 616d 6264  .          lambd
+000167d0: 6120 6f66 2050 6f69 7373 6f6e 2064 6973  a of Poisson dis
+000167e0: 7472 6962 7574 696f 6e2c 2044 656c 7461  tribution, Delta
+000167f0: 4d75 203d 206d 752d 6c61 6d62 6461 200a  Mu = mu-lambda .
+00016800: 2020 2020 2020 2d20 7175 6965 743a 2062        - quiet: b
+00016810: 6f6f 6c65 616e 2c20 636f 6e74 726f 6c73  oolean, controls
+00016820: 2070 7269 6e74 6564 206f 7574 7075 740a   printed output.
+00016830: 0a20 2020 2020 2022 2222 0a0a 2020 2020  .      """..    
+00016840: 2020 7365 6c66 2e6f 7574 6572 203d 206f    self.outer = o
+00016850: 7574 6572 0a20 2020 2020 2073 656c 662e  uter.      self.
+00016860: 636f 6e74 656e 7473 203d 2062 696e 5f63  contents = bin_c
+00016870: 6f6e 7465 6e74 730a 2020 2020 2020 7365  ontents.      se
+00016880: 6c66 2e6e 6269 6e73 3d6c 656e 2862 696e  lf.nbins=len(bin
+00016890: 5f63 6f6e 7465 6e74 7329 0a20 2020 2020  _contents).     
+000168a0: 2073 656c 662e 646c 656e 6774 6820 3d20   self.dlength = 
+000168b0: 7365 6c66 2e6e 6269 6e73 0a20 2020 2020  self.nbins.     
+000168c0: 2073 656c 662e 4e74 6f74 203d 206e 702e   self.Ntot = np.
+000168d0: 7375 6d28 6269 6e5f 636f 6e74 656e 7473  sum(bin_contents
+000168e0: 290a 2020 2020 2020 7365 6c66 2e65 6467  ).      self.edg
+000168f0: 6573 203d 2062 696e 5f65 6467 6573 0a20  es = bin_edges. 
+00016900: 2020 2020 2069 6620 4465 6c74 614d 7520       if DeltaMu 
+00016910: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00016920: 2073 656c 662e 4465 6c74 614d 7520 3d20   self.DeltaMu = 
+00016930: 6e70 2e7a 6572 6f73 286c 656e 2862 696e  np.zeros(len(bin
+00016940: 5f63 6f6e 7465 6e74 7329 290a 2020 2020  _contents)).    
+00016950: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00016960: 7365 6c66 2e44 656c 7461 203d 2044 656c  self.Delta = Del
+00016970: 7461 4d75 0a20 2020 2020 2023 2020 0a20  taMu.      #  . 
+00016980: 2020 2020 2073 656c 662e 6c65 6674 733d       self.lefts=
+00016990: 7365 6c66 2e65 6467 6573 5b3a 2d31 5d0a  self.edges[:-1].
+000169a0: 2020 2020 2020 7365 6c66 2e72 6967 6874        self.right
+000169b0: 733d 7365 6c66 2e65 6467 6573 5b31 3a5d  s=self.edges[1:]
+000169c0: 0a20 2020 2020 2073 656c 662e 6365 6e74  .      self.cent
+000169d0: 6572 7320 3d20 2873 656c 662e 7269 6768  ers = (self.righ
+000169e0: 7473 2020 2b20 7365 6c66 2e6c 6566 7473  ts  + self.lefts
+000169f0: 292f 322e 0a20 2020 2020 2073 656c 662e  )/2..      self.
+00016a00: 7769 6474 6873 203d 2073 656c 662e 7269  widths = self.ri
+00016a10: 6768 7473 202d 2073 656c 662e 6c65 6674  ghts - self.left
+00016a20: 730a 2020 2020 2020 2320 666c 6167 2074  s.      # flag t
+00016a30: 6f20 636f 6e74 726f 6c20 6669 6e61 6c20  o control final 
+00016a40: 6163 7469 6f6e 7320 696e 2063 6f73 7420  actions in cost 
+00016a50: 6675 6e63 7469 6f6e 0a20 2020 2020 2073  function.      s
+00016a60: 656c 662e 6669 6e61 6c5f 6361 6c6c 203d  elf.final_call =
+00016a70: 2046 616c 7365 0a20 2020 2020 2073 656c   False.      sel
+00016a80: 662e 6d6f 6465 6c5f 7661 6c75 6573 203d  f.model_values =
+00016a90: 204e 6f6e 650a 2020 2020 2020 0a20 2020   None.      .   
+00016aa0: 2064 6566 2070 6c6f 7428 7365 6c66 2c20   def plot(self, 
+00016ab0: 6e75 6d3d 2768 6973 7444 6174 6120 616e  num='histData an
+00016ac0: 6420 4d6f 6465 6c27 2c0a 2020 2020 2020  d Model',.      
+00016ad0: 2020 2020 2020 2020 2020 2020 2066 6967               fig
+00016ae0: 7369 7a65 3d28 372e 352c 2036 2e35 292c  size=(7.5, 6.5),
+00016af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b00: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00016b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b20: 2064 6174 615f 6c61 6265 6c3d 2742 696e   data_label='Bin
+00016b30: 6e65 6420 6461 7461 272c 0a20 2020 2020  ned data',.     
+00016b40: 2020 2020 2020 2020 2020 2020 2020 706c                pl
+00016b50: 6f74 5f72 6573 6964 7561 6c3d 4661 6c73  ot_residual=Fals
+00016b60: 6529 3a0a 0a20 2020 2020 2022 2222 7265  e):..      """re
+00016b70: 7475 726e 2066 6967 7572 6520 7769 7468  turn figure with
+00016b80: 2068 6973 746f 6772 616d 2064 6174 6120   histogram data 
+00016b90: 616e 6420 756e 6365 7274 6169 6e74 6965  and uncertaintie
+00016ba0: 730a 2020 2020 2020 2222 220a 0a20 2020  s.      """..   
+00016bb0: 2020 2077 203d 2073 656c 662e 6564 6765     w = self.edge
+00016bc0: 735b 313a 5d20 2d20 7365 6c66 2e65 6467  s[1:] - self.edg
+00016bd0: 6573 5b3a 2d31 5d0a 2020 2020 2020 6669  es[:-1].      fi
+00016be0: 6720 3d20 706c 742e 6669 6775 7265 286e  g = plt.figure(n
+00016bf0: 756d 3d6e 756d 2c20 6669 6773 697a 653d  um=num, figsize=
+00016c00: 6669 6773 697a 6529 0a20 2020 2020 2069  figsize).      i
+00016c10: 6620 7365 6c66 2e6d 6f64 656c 5f76 616c  f self.model_val
+00016c20: 7565 7320 6973 206e 6f74 204e 6f6e 653a  ues is not None:
+00016c30: 0a20 2020 2020 2020 2069 6620 706c 6f74  .        if plot
+00016c40: 5f72 6573 6964 7561 6c3a 0a20 2020 2020  _residual:.     
+00016c50: 2020 2020 206d 636f 6e74 7320 3d20 6e70       mconts = np
+00016c60: 2e7a 6572 6f73 2873 656c 662e 6e62 696e  .zeros(self.nbin
+00016c70: 7329 0a20 2020 2020 2020 2020 2062 636f  s).          bco
+00016c80: 6e74 7320 3d20 7365 6c66 2e63 6f6e 7465  nts = self.conte
+00016c90: 6e74 7320 2d20 7365 6c66 2e6d 6f64 656c  nts - self.model
+00016ca0: 5f76 616c 7565 730a 2020 2020 2020 2020  _values.        
+00016cb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00016cc0: 6d63 6f6e 7473 203d 2073 656c 662e 6d6f  mconts = self.mo
+00016cd0: 6465 6c5f 7661 6c75 6573 0a20 2020 2020  del_values.     
+00016ce0: 2020 2020 2062 636f 6e74 7320 3d20 7365       bconts = se
+00016cf0: 6c66 2e63 6f6e 7465 6e74 730a 2020 2020  lf.contents.    
+00016d00: 2020 706c 742e 6261 7228 7365 6c66 2e63    plt.bar(self.c
+00016d10: 656e 7465 7273 2c20 6263 6f6e 7473 2c0a  enters, bconts,.
+00016d20: 2020 2020 2020 2020 2020 2020 2020 616c                al
+00016d30: 6967 6e3d 2763 656e 7465 7227 2c20 7769  ign='center', wi
+00016d40: 6474 6820 3d20 772c 0a20 2020 2020 2020  dth = w,.       
+00016d50: 2020 2020 2020 2066 6163 6563 6f6c 6f72         facecolor
+00016d60: 3d27 6361 6465 7462 6c75 6527 2c20 6564  ='cadetblue', ed
+00016d70: 6765 636f 6c6f 723d 2764 6172 6b62 6c75  gecolor='darkblu
+00016d80: 6527 2c20 616c 7068 613d 302e 3636 2c0a  e', alpha=0.66,.
+00016d90: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00016da0: 6265 6c20 3d20 6461 7461 5f6c 6162 656c  bel = data_label
+00016db0: 290a 0a20 2020 2020 2023 2073 6574 2061  )..      # set a
+00016dc0: 6e64 2070 6c6f 7420 6572 726f 7220 6261  nd plot error ba
+00016dd0: 7273 0a20 2020 2020 2069 6620 7365 6c66  rs.      if self
+00016de0: 2e6d 6f64 656c 5f76 616c 7565 7320 6973  .model_values is
+00016df0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00016e00: 2023 2062 6573 742d 6669 7420 6d6f 6465   # best-fit mode
+00016e10: 6c20 7661 6c75 6573 2061 7661 6961 626c  l values avaiabl
+00016e20: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
+00016e30: 2073 656c 662e 6f75 7465 722e 7573 655f   self.outer.use_
+00016e40: 4761 7573 7341 7070 726f 783a 0a20 2020  GaussApprox:.   
+00016e50: 2020 2020 2020 2023 2073 686f 7720 506f         # show Po
+00016e60: 6973 736f 6e20 436f 6e66 6964 656e 6365  isson Confidence
+00016e70: 2049 6e74 6572 7661 6c73 0a20 2020 2020   Intervals.     
+00016e80: 2020 2020 2065 7020 3d20 5b5d 0a20 2020       ep = [].   
+00016e90: 2020 2020 2020 2065 6d20 3d20 5b5d 0a20         em = []. 
+00016ea0: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+00016eb0: 6e20 7261 6e67 6528 7365 6c66 2e6e 6269  n range(self.nbi
+00016ec0: 6e73 293a 0a20 2020 2020 2020 2020 2020  ns):.           
+00016ed0: 206c 203d 2028 7365 6c66 2e6d 6f64 656c   l = (self.model
+00016ee0: 5f76 616c 7565 735b 695d 202b 206e 702e  _values[i] + np.
+00016ef0: 6162 7328 7365 6c66 2e44 656c 7461 4d75  abs(self.DeltaMu
+00016f00: 5b69 5d29 2920 2020 2020 200a 2020 2020  [i]))      .    
+00016f10: 2020 2020 2020 2020 6d2c 2070 203d 2073          m, p = s
+00016f20: 656c 662e 506f 6973 736f 6e5f 4349 286c  elf.Poisson_CI(l
+00016f30: 2c20 7369 676d 613d 312e 290a 2020 2020  , sigma=1.).    
+00016f40: 2020 2020 2020 2020 6570 2e61 7070 656e          ep.appen
+00016f50: 6428 702d 6c29 0a20 2020 2020 2020 2020  d(p-l).         
+00016f60: 2020 2065 6d2e 6170 7065 6e64 286c 2d6d     em.append(l-m
+00016f70: 290a 2020 2020 2020 2020 2020 706c 742e  ).          plt.
+00016f80: 6572 726f 7262 6172 2873 656c 662e 6365  errorbar(self.ce
+00016f90: 6e74 6572 732c 206d 636f 6e74 732c 0a20  nters, mconts,. 
+00016fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fb0: 2020 2020 2020 7965 7272 3d28 656d 2c20        yerr=(em, 
+00016fc0: 6570 292c 2066 6d74 3d27 2027 2c20 0a20  ep), fmt=' ', . 
+00016fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016fe0: 2020 2020 2020 6563 6f6c 6f72 3d27 6f6c        ecolor='ol
+00016ff0: 6976 6527 2c20 6361 7073 697a 653d 332c  ive', capsize=3,
+00017000: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+00017010: 2020 2020 2020 2020 616c 7068 613d 302e          alpha=0.
+00017020: 3829 0a20 2020 2020 2020 2065 6c73 653a  8).        else:
+00017030: 2023 2073 686f 7720 7379 6d6d 6574 7269   # show symmetri
+00017040: 6320 6572 726f 7220 6261 7273 200a 2020  c error bars .  
+00017050: 2020 2020 2020 2020 6570 203d 206e 702e          ep = np.
+00017060: 7371 7274 2873 656c 662e 6d6f 6465 6c5f  sqrt(self.model_
+00017070: 7661 6c75 6573 202b 206e 702e 6162 7328  values + np.abs(
+00017080: 7365 6c66 2e44 656c 7461 4d75 2929 0a20  self.DeltaMu)). 
+00017090: 2020 2020 2020 2020 2065 6d20 3d20 5b65           em = [e
+000170a0: 705b 695d 2069 6620 7365 6c66 2e6d 6f64  p[i] if self.mod
+000170b0: 656c 5f76 616c 7565 735b 695d 2d65 705b  el_values[i]-ep[
+000170c0: 695d 3e30 2e20 656c 7365 2073 656c 662e  i]>0. else self.
+000170d0: 6d6f 6465 6c5f 7661 6c75 6573 5b69 5d0a  model_values[i].
+000170e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170f0: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+00017100: 656e 2865 7029 295d 0a20 2020 2020 2020  en(ep))].       
+00017110: 2020 2070 6c74 2e65 7272 6f72 6261 7228     plt.errorbar(
+00017120: 7365 6c66 2e63 656e 7465 7273 2c20 7365  self.centers, se
+00017130: 6c66 2e6d 6f64 656c 5f76 616c 7565 732c  lf.model_values,
+00017140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017150: 2020 2020 2020 2020 7965 7272 3d28 656d          yerr=(em
+00017160: 2c20 6570 292c 2066 6d74 3d27 2027 2c20  , ep), fmt=' ', 
+00017170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017180: 2020 2020 2020 2020 6563 6f6c 6f72 3d27          ecolor='
+00017190: 6f6c 6976 6527 2c20 656c 696e 6577 6964  olive', elinewid
+000171a0: 7468 3d32 2c20 616c 7068 613d 302e 3829  th=2, alpha=0.8)
+000171b0: 0a20 2020 2020 2065 6c73 653a 2023 206e  .      else: # n
+000171c0: 6f20 6d6f 6465 6c20 7661 6c75 6573 2061  o model values a
+000171d0: 7661 696c 6162 6c65 2028 7965 7429 2c20  vailable (yet), 
+000171e0: 7368 6f77 2065 7272 6f72 2062 6172 7320  show error bars 
+000171f0: 7265 6c61 7465 6420 746f 2064 6174 6120  related to data 
+00017200: 2020 2020 200a 2020 2020 2020 2020 6570       .        ep
+00017210: 203d 206e 702e 7371 7274 2873 656c 662e   = np.sqrt(self.
+00017220: 636f 6e74 656e 7473 202b 206e 702e 6162  contents + np.ab
+00017230: 7328 7365 6c66 2e44 656c 7461 4d75 2929  s(self.DeltaMu))
+00017240: 0a20 2020 2020 2020 2065 6d20 3d20 5b65  .        em = [e
+00017250: 705b 695d 2069 6620 7365 6c66 2e63 6f6e  p[i] if self.con
+00017260: 7465 6e74 735b 695d 2d65 705b 695d 3e30  tents[i]-ep[i]>0
+00017270: 2e20 656c 7365 2073 656c 662e 636f 6e74  . else self.cont
+00017280: 656e 7473 5b69 5d20 666f 7220 6920 696e  ents[i] for i in
+00017290: 2072 616e 6765 286c 656e 2865 7029 295d   range(len(ep))]
+000172a0: 2020 2020 2020 0a20 2020 2020 2020 2070        .        p
+000172b0: 6c74 2e65 7272 6f72 6261 7228 7365 6c66  lt.errorbar(self
+000172c0: 2e63 656e 7465 7273 2c20 6263 6f6e 7473  .centers, bconts
+000172d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000172e0: 2020 2020 2079 6572 723d 2865 6d2c 2065       yerr=(em, e
+000172f0: 7029 2c0a 2020 2020 2020 2020 2020 2020  p),.            
+00017300: 2020 2020 2020 2066 6d74 3d27 5f27 2c20         fmt='_', 
+00017310: 636f 6c6f 723d 2764 6172 6b62 6c75 6527  color='darkblue'
+00017320: 2c20 6d61 726b 6572 7369 7a65 3d31 352c  , markersize=15,
+00017330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017340: 2020 2020 6563 6f6c 6f72 3d27 6461 726b      ecolor='dark
+00017350: 626c 7565 272c 2061 6c70 6861 3d30 2e38  blue', alpha=0.8
+00017360: 290a 2020 2020 2020 7265 7475 726e 2066  ).      return f
+00017370: 6967 0a0a 2020 2020 4073 7461 7469 636d  ig..    @staticm
+00017380: 6574 686f 640a 2020 2020 6465 6620 506f  ethod.    def Po
+00017390: 6973 736f 6e5f 4349 286c 616d 2c20 7369  isson_CI(lam, si
+000173a0: 676d 613d 312e 293a 0a20 2020 2020 2022  gma=1.):.      "
+000173b0: 2222 0a20 2020 2020 2064 6574 6572 6d69  "".      determi
+000173c0: 6e65 206f 6e65 2d73 6967 6d61 2043 6f6e  ne one-sigma Con
+000173d0: 6669 6465 6e63 6520 496e 7465 7276 616c  fidence Interval
+000173e0: 2061 726f 756e 6420 7468 6520 0a20 2020   around the .   
+000173f0: 2020 206d 6561 6e20 6c61 6d62 6461 206f     mean lambda o
+00017400: 6620 6120 506f 6973 736f 6e20 6469 7374  f a Poisson dist
+00017410: 7269 6275 7469 6f6e 2c20 506f 6973 7328  ribution, Poiss(
+00017420: 782c 206c 616d 6264 6129 2e20 0a0a 2020  x, lambda). ..  
+00017430: 2020 2020 5468 6520 6d65 7468 6f64 2069      The method i
+00017440: 7320 6261 7365 6420 6f6e 2064 656c 7461  s based on delta
+00017450: 2d6c 6f67 2d4c 696b 656c 6968 6f6f 6420  -log-Likelihood 
+00017460: 2864 6c4c 2920 0a20 2020 2020 206f 6620  (dlL) .      of 
+00017470: 7468 6520 506f 6973 7369 6f6e 206c 696b  the Poission lik
+00017480: 656c 6968 6f6f 6420 0a0a 2020 2020 2020  elihood ..      
+00017490: 4172 6773 3a0a 2020 2020 2020 202d 206c  Args:.       - l
+000174a0: 616d 3a20 6d65 616e 206f 6620 506f 6973  am: mean of Pois
+000174b0: 7369 6f6e 2064 6973 7472 6962 7574 696f  sion distributio
+000174c0: 6e0a 2020 2020 2020 202d 2063 6c3a 2064  n.       - cl: d
+000174d0: 6573 6972 6564 2063 6f6e 6669 6465 6e63  esired confidenc
+000174e0: 6520 6c65 7665 6c0a 2020 2020 2020 202d  e level.       -
+000174f0: 2073 6967 6d61 3a20 616c 7465 726e 6174   sigma: alternat
+00017500: 6976 656c 7920 7370 6563 6966 7920 616e  ively specify an
+00017510: 206e 2d73 6967 6d61 2069 6e74 6572 7661   n-sigma interva
+00017520: 6c0a 2020 2020 2020 2222 220a 0a20 2020  l.      """..   
+00017530: 2020 2023 2066 756e 6374 696f 6e73 0a20     # functions. 
+00017540: 2020 2020 2064 6566 206e 6c4c 506f 6973       def nlLPois
+00017550: 736f 6e28 782c 206c 616d 293a 0a20 2020  son(x, lam):.   
+00017560: 2020 2020 2022 2222 6e65 6761 7469 7665       """negative
+00017570: 206c 6f67 2d6c 696b 656c 6968 6f6f 6420   log-likelihood 
+00017580: 6f66 2050 6f69 7373 6f69 6e20 6469 7374  of Poissoin dist
+00017590: 7262 7574 696f 6e0a 2020 2020 2020 2020  rbution.        
+000175a0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+000175b0: 726e 206c 616d 202d 2078 2a6e 702e 6c6f  rn lam - x*np.lo
+000175c0: 6728 6c61 6d29 202b 206c 6f67 6761 6d6d  g(lam) + loggamm
+000175d0: 6128 782b 312e 290a 0a20 2020 2020 2064  a(x+1.)..      d
+000175e0: 6566 2066 2878 2c20 6c61 6d2c 2064 6c4c  ef f(x, lam, dlL
+000175f0: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
+00017600: 6c74 6120 6c6f 672d 4c20 2d20 6f66 6673  lta log-L - offs
+00017610: 6574 2c20 696e 7075 7420 746f 204e 6577  et, input to New
+00017620: 746f 6e20 6d65 7468 6f64 0a20 2020 2020  ton method.     
+00017630: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00017640: 6574 7572 6e20 6e6c 4c50 6f69 7373 6f6e  eturn nlLPoisson
+00017650: 2878 2c20 6c61 6d29 202d 206e 6c4c 506f  (x, lam) - nlLPo
+00017660: 6973 736f 6e28 6c61 6d2c 206c 616d 2920  isson(lam, lam) 
+00017670: 2d20 646c 4c0a 0a20 2020 2020 2064 6c4c  - dlL..      dlL
+00017680: 203d 2030 2e35 2a73 6967 6d61 2a73 6967   = 0.5*sigma*sig
+00017690: 6d61 200a 0a20 2020 2020 2023 2066 6f72  ma ..      # for
+000176a0: 2064 6c4c 3d30 2e35 2c20 7468 6572 6520   dlL=0.5, there 
+000176b0: 6973 206f 6e6c 7920 6f6e 6520 696e 7465  is only one inte
+000176c0: 7273 6563 7469 6f6e 2077 6974 6820 7a65  rsection with ze
+000176d0: 726f 2066 6f72 206c 616d 3c31 2e38 0a20  ro for lam<1.8. 
+000176e0: 2020 2020 2064 6c20 3d20 312e 322a 6e70       dl = 1.2*np
+000176f0: 2e73 7172 7428 6c61 6d29 0a20 2020 2020  .sqrt(lam).     
+00017700: 2064 6c6d 203d 206d 696e 2864 6c2c 206c   dlm = min(dl, l
+00017710: 616d 290a 2020 2020 2020 6370 203d 206e  am).      cp = n
+00017720: 6577 746f 6e28 662c 2078 303d 6c61 6d2b  ewton(f, x0=lam+
+00017730: 646c 2c20 7831 3d6c 616d 2c20 6172 6773  dl, x1=lam, args
+00017740: 3d28 6c61 6d2c 2064 6c4c 2929 0a20 2020  =(lam, dlL)).   
+00017750: 2020 2074 7279 3a20 2320 6d61 7920 6e6f     try: # may no
+00017760: 7420 636f 6e76 6572 6765 2066 6f72 2073  t converge for s
+00017770: 6d61 6c6c 206c 616d 6264 612c 2061 7320  mall lambda, as 
+00017780: 7468 6572 6520 6973 206e 6f20 696e 7465  there is no inte
+00017790: 7273 6563 7469 6f6e 203c 206c 616d 0a20  rsection < lam. 
+000177a0: 2020 2020 2020 2063 6d20 3d20 6e65 7774         cm = newt
+000177b0: 6f6e 2866 2c20 7830 3d6c 616d 2d64 6c6d  on(f, x0=lam-dlm
+000177c0: 2c20 7831 3d6c 616d 2c20 6172 6773 3d28  , x1=lam, args=(
+000177d0: 6c61 6d2c 2064 6c4c 2929 0a20 2020 2020  lam, dlL)).     
+000177e0: 2065 7863 6570 743a 0a20 2020 2020 2020   except:.       
+000177f0: 2063 6d20 3d20 302e 0a20 2020 2020 2069   cm = 0..      i
+00017800: 6620 2863 702d 636d 293c 6c61 6d2f 3130  f (cp-cm)<lam/10
+00017810: 302e 3a20 2320 666f 756e 6420 7361 6d65  0.: # found same
+00017820: 2069 6e74 6572 7365 6374 696f 6e2c 0a20   intersection,. 
+00017830: 2020 2020 2020 2063 6d20 3d20 302e 2020         cm = 0.  
+00017840: 2020 2020 2020 2020 2020 2320 2073 6574            #  set
+00017850: 2031 7374 206f 6e65 2074 6f20 302e 2020   1st one to 0.  
+00017860: 0a20 0a20 2020 2020 2072 6574 7572 6e20  . .      return 
+00017870: 636d 2c20 6370 2020 2020 2020 2020 2020  cm, cp          
+00017880: 2020 0a20 2020 200a 2020 2320 2d2d 2d20    .    .  # --- 
+00017890: 636f 7374 2066 756e 6374 696f 6e20 666f  cost function fo
+000178a0: 7220 6869 7374 6f67 7261 6d20 6461 7461  r histogram data
+000178b0: 0a20 2063 6c61 7373 2068 436f 7374 3a0a  .  class hCost:.
+000178c0: 2020 2020 2222 2220 2020 2043 6f73 7420      """    Cost 
+000178d0: 6675 6e63 7469 6f6e 2066 6f72 2062 696e  function for bin
+000178e0: 6e65 6420 6461 7461 0a0a 2020 2020 5468  ned data..    Th
+000178f0: 6520 5f5f 6361 6c6c 5f5f 206d 6574 686f  e __call__ metho
+00017900: 6420 6f66 2074 6869 7320 636c 6173 7320  d of this class 
+00017910: 6973 2063 616c 6c65 6420 6279 2069 6d69  is called by imi
+00017920: 6e75 6974 2e0a 0a20 2020 2054 6865 2064  nuit...    The d
+00017930: 6566 6175 6c74 2063 6f73 7420 6675 6e63  efault cost func
+00017940: 7469 6f6e 2074 6f20 6d69 6e69 6d6f 7a65  tion to minimoze
+00017950: 2069 7320 7477 6963 6520 7468 6520 6e65   is twice the ne
+00017960: 6761 7469 7665 200a 2020 2020 6c6f 672d  gative .    log-
+00017970: 6c69 6b65 6c69 686f 6f64 206f 6620 7468  likelihood of th
+00017980: 6520 506f 6973 736f 6e20 6469 7374 7269  e Poisson distri
+00017990: 6275 7469 6f6e 2067 656e 6572 616c 697a  bution generaliz
+000179a0: 6564 2074 6f20 0a20 2020 2063 6f6e 7469  ed to .    conti
+000179b0: 6e75 6f75 7320 6f62 7365 7276 6174 696f  nuous observatio
+000179c0: 6e73 2078 2062 7920 7265 706c 6163 696e  ns x by replacin
+000179d0: 6720 6b21 2062 7920 7468 6520 6761 6d6d  g k! by the gamm
+000179e0: 6120 6675 6e63 7469 6f6e 3a0a 0a20 2020  a function:..   
+000179f0: 202e 2e20 6d61 7468 3a3a 0a20 2020 2020   .. math::.     
+00017a00: 2020 2063 6f73 7428 783b 5c6c 616d 6264     cost(x;\lambd
+00017a10: 6129 203d 2032 205c 6c61 6d62 6461 2028  a) = 2 \lambda (
+00017a20: 5c6c 616d 6264 6120 2d20 782a 5c6c 6e28  \lambda - x*\ln(
+00017a30: 5c6c 616d 6264 6129 202b 205c 6c6e 5c47  \lambda) + \ln\G
+00017a40: 616d 6d61 2878 2b31 2e29 290a 0a20 2020  amma(x+1.))..   
+00017a50: 2041 6c74 6572 6e61 7469 7665 6c79 2c20   Alternatively, 
+00017a60: 7468 6520 4761 7573 7369 616e 2061 7070  the Gaussian app
+00017a70: 726f 7869 6d61 7469 6f6e 2069 7320 6176  roximation is av
+00017a80: 6169 6c61 626c 653a 0a0a 2020 2020 2e2e  ailable:..    ..
+00017a90: 206d 6174 683a 3a0a 2020 2020 2020 2020   math::.        
+00017aa0: 636f 7374 2878 3b5c 6c61 6d62 6461 2920  cost(x;\lambda) 
+00017ab0: 3d20 2878 202d 205c 6c61 6d62 6461 295e  = (x - \lambda)^
+00017ac0: 3220 2f20 5c6c 616d 6264 6120 2b20 5c6c  2 / \lambda + \l
+00017ad0: 6e28 5c6c 616d 6264 6129 0a20 2020 2020  n(\lambda).     
+00017ae0: 2020 2020 2020 0a20 2020 2054 6865 2069        .    The i
+00017af0: 6d70 6c65 6d65 6e74 6174 696f 6e20 616c  mplementation al
+00017b00: 736f 2070 6572 6d69 7473 2074 6f20 7368  so permits to sh
+00017b10: 6966 7420 7468 6520 6f62 7365 7276 6174  ift the observat
+00017b20: 696f 6e20 7820 6279 2061 6e0a 2020 2020  ion x by an.    
+00017b30: 6f66 6673 6574 2074 6f20 7461 6b65 2069  offset to take i
+00017b40: 6e74 6f20 6163 636f 756e 7420 636f 7272  nto account corr
+00017b50: 6563 7469 6f6e 7320 746f 2074 6865 206e  ections to the n
+00017b60: 756d 6265 7220 6f66 206f 6273 6572 7665  umber of observe
+00017b70: 640a 2020 2020 6269 6e20 656e 7472 6965  d.    bin entrie
+00017b80: 7320 2865 2e67 2e20 6475 6520 746f 2062  s (e.g. due to b
+00017b90: 6163 6b67 726f 756e 6420 6f72 2065 6666  ackground or eff
+00017ba0: 6963 6965 6e63 7920 636f 7272 6563 7469  iciency correcti
+00017bb0: 6f6e 7329 3a0a 2020 2020 7820 2d3e 2078  ons):.    x -> x
+00017bc0: 2d64 656c 7461 4d75 2077 6974 6820 6465  -deltaMu with de
+00017bd0: 6c74 614d 7520 3d20 6d75 202d 206c 616d  ltaMu = mu - lam
+00017be0: 6264 612c 2077 6865 7265 206d 7520 6973  bda, where mu is
+00017bf0: 2074 6865 206d 6561 6e0a 2020 2020 6f66   the mean.    of
+00017c00: 2074 6865 2073 6869 6674 6564 2050 6f69   the shifted Poi
+00017c10: 7373 6f6e 206f 7220 4761 75c3 9f20 6469  sson or Gau.. di
+00017c20: 7374 7269 6275 7469 6f6e 2e20 200a 0a20  stribution.  .. 
+00017c30: 2020 2054 6865 206e 756d 6265 7220 6f66     The number of
+00017c40: 2062 696e 2065 6e74 7269 6573 2070 7265   bin entries pre
+00017c50: 6469 6374 6564 2062 7920 7468 6520 6d6f  dicted by the mo
+00017c60: 6465 6c20 6465 6e73 6974 7920 6973 2063  del density is c
+00017c70: 616c 6375 6c61 7465 640a 2020 2020 6279  alculated.    by
+00017c80: 2061 6e20 6170 7072 6f78 696d 6174 6520   an approximate 
+00017c90: 696e 7465 6772 616c 206f 7665 7220 7468  integral over th
+00017ca0: 6520 7265 7370 6563 7469 7665 2062 696e  e respective bin
+00017cb0: 2072 616e 6765 7320 7573 696e 6720 7468   ranges using th
+00017cc0: 650a 2020 2020 5369 6d70 736f 6e20 7275  e.    Simpson ru
+00017cd0: 6c65 2e20 0a0a 2020 2020 546f 206a 7564  le. ..    To jud
+00017ce0: 6765 2074 6865 206c 6576 656c 206f 6620  ge the level of 
+00017cf0: 6167 7265 656d 656e 7420 6f66 206d 6f64  agreement of mod
+00017d00: 656c 2064 656e 7369 7479 2061 6e64 2068  el density and h
+00017d10: 6973 746f 6772 616d 2064 6174 612c 200a  istogram data, .
+00017d20: 2020 2020 6120 2267 6f6f 646e 6573 732d      a "goodness-
+00017d30: 6f66 2d66 6974 2220 282a 676f 662a 2920  of-fit" (*gof*) 
+00017d40: 7661 6c75 6520 6973 2063 616c 756c 6174  value is calulat
+00017d50: 6564 2061 7320 7468 6520 6c69 6b65 6c69  ed as the likeli
+00017d60: 686f 6f64 2d72 6174 696f 206f 660a 2020  hood-ratio of.  
+00017d70: 2020 7468 6520 6d6f 6465 6c20 772e 722e    the model w.r.
+00017d80: 742e 2074 6865 2064 6174 6120 616e 6420  t. the data and 
+00017d90: 7468 6520 736f 2d63 616c 6c65 6420 2273  the so-called "s
+00017da0: 6174 7572 6174 6564 206d 6f64 656c 2220  aturated model" 
+00017db0: 6465 7363 7269 6269 6e67 200a 2020 2020  describing .    
+00017dc0: 7468 6520 6461 7461 2070 6572 6665 6374  the data perfect
+00017dd0: 6c79 2c20 692e 652e 2020 3a6d 6174 683a  ly, i.e.  :math:
+00017de0: 6063 6f73 745f 7b73 6174 7d28 7829 203d  `cost_{sat}(x) =
+00017df0: 2063 6f73 7428 783b 205c 6c61 6d62 6461   cost(x; \lambda
+00017e00: 3d78 2960 2e0a 2020 2020 4966 2074 6865  =x)`..    If the
+00017e10: 2062 696e 2065 6e74 7269 6573 2061 7265   bin entries are
+00017e20: 2073 7566 6669 6369 656e 746c 7920 6c61   sufficiently la
+00017e30: 7267 652c 202a 676f 662a 2063 6f6e 7665  rge, *gof* conve
+00017e40: 7267 6573 2074 6f20 7468 6520 7374 616e  rges to the stan
+00017e50: 6461 7264 200a 2020 2020 2a63 6869 322a  dard .    *chi2*
+00017e60: 2076 616c 7565 2e20 0a0a 2020 2020 496e   value. ..    In
+00017e70: 7075 743a 0a0a 2020 2020 2d20 6f75 7465  put:..    - oute
+00017e80: 723a 2070 6f69 6e74 6572 2074 6f20 696e  r: pointer to in
+00017e90: 7374 616e 6365 206f 6620 6361 6c6c 696e  stance of callin
+00017ea0: 6720 636c 6173 730a 2020 2020 2d20 6d6f  g class.    - mo
+00017eb0: 6465 6c3a 206d 6f64 656c 2066 756e 6374  del: model funct
+00017ec0: 696f 6e20 6628 782c 205c 2a70 6172 290a  ion f(x, \*par).
+00017ed0: 2020 2020 2d20 7573 655f 4761 7573 7341      - use_GaussA
+00017ee0: 7070 726f 782c 2062 6f6f 6c3a 2075 7365  pprox, bool: use
+00017ef0: 2047 6175 7373 6961 6e20 6170 7072 6f78   Gaussian approx
+00017f00: 696d 6174 696f 6e20 0a20 2020 202d 2064  imation .    - d
+00017f10: 656e 7369 7479 2c20 626f 6f6c 3a20 6669  ensity, bool: fi
+00017f20: 7420 6120 6e6f 726d 616c 6973 6564 2064  t a normalised d
+00017f30: 656e 7369 7479 3b20 6966 2046 616c 7365  ensity; if False
+00017f40: 2c20 616e 206f 7665 7261 6c6c 0a20 2020  , an overall.   
+00017f50: 2020 206e 6f72 6d61 6c69 7361 7469 6f6e     normalisation
+00017f60: 206d 7573 7420 6265 2070 726f 7669 6465   must be provide
+00017f70: 6420 696e 2074 6865 206d 6f64 656c 2066  d in the model f
+00017f80: 756e 6374 696f 6e0a 0a20 2020 2044 6174  unction..    Dat
+00017f90: 6120 6d65 6d62 6572 733a 0a0a 2020 2020  a members:..    
+00017fa0: 2d20 6e64 6f66 3a20 6465 6772 6565 7320  - ndof: degrees 
+00017fb0: 6f66 2066 7265 6564 6f6d 200a 2020 2020  of freedom .    
+00017fc0: 2d20 6e63 6f6e 7374 7261 696e 7473 3a20  - nconstraints: 
+00017fd0: 6e75 6d62 6572 206f 6620 7061 7261 6d65  number of parame
+00017fe0: 7465 7220 636f 6e73 7472 6169 6e74 730a  ter constraints.
+00017ff0: 2020 2020 2d20 676f 663a 2067 6f6f 646e      - gof: goodn
+00018000: 6573 732d 6f66 2d66 6974 2061 7320 6c69  ess-of-fit as li
+00018010: 6b65 6c69 686f 6f64 2072 6174 696f 2077  kelihood ratio w
+00018020: 2e72 2e74 2e20 7468 6520 2773 6174 7572  .r.t. the 'satur
+00018030: 6174 6564 206d 6f64 656c 270a 0a20 2020  ated model'..   
+00018040: 2045 7874 6572 6e61 6c20 7265 6665 7265   External refere
+00018050: 6e63 6573 3a0a 0a20 2020 202d 206d 6f64  nces:..    - mod
+00018060: 656c 2878 2c20 5c2a 7061 7229 3a20 7468  el(x, \*par): th
+00018070: 6520 6d6f 6465 6c20 6675 6e63 7469 6f6e  e model function
+00018080: 200a 2020 2020 2d20 6461 7461 3a20 706f   .    - data: po
+00018090: 696e 7465 7220 746f 2069 6e73 7461 6e63  inter to instanc
+000180a0: 6520 6f66 2063 6c61 7373 2068 6973 7444  e of class histD
+000180b0: 6174 610a 2020 2020 2d20 6461 7461 2e6d  ata.    - data.m
+000180c0: 6f64 656c 5f76 616c 7565 733a 2062 696e  odel_values: bin
+000180d0: 2065 6e74 7269 6573 2063 616c 6375 6c61   entries calcula
+000180e0: 7465 6420 6279 2074 6865 2062 6573 742d  ted by the best-
+000180f0: 6669 7420 6d6f 6465 6c0a 2020 2020 2222  fit model.    ""
+00018100: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00018110: 745f 5f28 7365 6c66 2c20 6f75 7465 722c  t__(self, outer,
+00018120: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00018130: 2020 206d 6f64 656c 2c0a 2020 2020 2020     model,.      
+00018140: 2020 2020 2020 2020 2020 2075 7365 5f47             use_G
+00018150: 6175 7373 4170 7072 6f78 3d46 616c 7365  aussApprox=False
+00018160: 2c20 6465 6e73 6974 793d 2054 7275 6529  , density= True)
+00018170: 3a0a 0a20 2020 2020 2023 2064 6174 6120  :..      # data 
+00018180: 6f62 6a65 6374 206f 6620 7479 7065 2068  object of type h
+00018190: 6973 7444 6174 6143 6f6e 7461 696e 7465  istDataContainte
+000181a0: 720a 2020 2020 2020 7365 6c66 2e64 6174  r.      self.dat
+000181b0: 6120 3d20 6f75 7465 722e 6844 6174 610a  a = outer.hData.
+000181c0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+000181d0: 6e73 7461 6e63 6528 7365 6c66 2e64 6174  nstance(self.dat
+000181e0: 612c 206d 6e46 6974 2e68 6973 7444 6174  a, mnFit.histDat
+000181f0: 6143 6f6e 7461 696e 6572 293a 0a20 2020  aContainer):.   
+00018200: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00018210: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00018220: 2022 2021 2121 206d 6e46 6974 2e68 436f   " !!! mnFit.hCo
+00018230: 7374 3a20 6578 7065 6374 696e 6720 6461  st: expecting da
+00018240: 7461 2063 6f6e 7461 696e 6572 206f 6620  ta container of 
+00018250: 7479 7065 2027 6869 7374 4461 7461 436f  type 'histDataCo
+00018260: 6e74 6169 6e65 7227 2229 0a20 2020 2020  ntainer'").     
+00018270: 200a 2020 2020 2020 7365 6c66 2e6d 6f64   .      self.mod
+00018280: 656c 203d 206d 6f64 656c 0a20 2020 2020  el = model.     
+00018290: 2073 656c 662e 6465 6e73 6974 7920 3d20   self.density = 
+000182a0: 6465 6e73 6974 790a 2020 2020 2020 7365  density.      se
+000182b0: 6c66 2e47 6175 7373 4170 7072 6f78 203d  lf.GaussApprox =
+000182c0: 2075 7365 5f47 6175 7373 4170 7072 6f78   use_GaussApprox
+000182d0: 0a20 2020 2020 2073 656c 662e 7175 6965  .      self.quie
+000182e0: 7420 3d20 6f75 7465 722e 7175 6965 740a  t = outer.quiet.
+000182f0: 2020 2020 2020 0a20 2020 2020 2023 2073        .      # s
+00018300: 6574 2070 726f 7065 7220 7369 676e 6174  et proper signat
+00018310: 7572 6520 6f66 206d 6f64 656c 2066 756e  ure of model fun
+00018320: 6374 696f 6e20 666f 7220 696d 696e 7569  ction for iminui
+00018330: 740a 2020 2020 2020 7365 6c66 2e70 6e61  t.      self.pna
+00018340: 6d73 203d 206f 7574 6572 2e70 6e61 6d73  ms = outer.pnams
+00018350: 0a20 2020 2020 2073 656c 662e 6e70 6172  .      self.npar
+00018360: 203d 206f 7574 6572 2e6e 7061 720a 200a   = outer.npar. .
+00018370: 2020 2020 2020 7365 6c66 2e63 6f6e 7374        self.const
+00018380: 7261 696e 7473 203d 206f 7574 6572 2e63  raints = outer.c
+00018390: 6f6e 7374 7261 696e 7473 0a20 2020 2020  onstraints.     
+000183a0: 2073 656c 662e 6e63 6f6e 7374 7261 696e   self.nconstrain
+000183b0: 7473 203d 6c65 6e28 7365 6c66 2e63 6f6e  ts =len(self.con
+000183c0: 7374 7261 696e 7473 290a 2020 2020 2020  straints).      
+000183d0: 2320 7461 6b65 2061 6363 6f75 6e74 206f  # take account o
+000183e0: 6620 636f 6e73 7472 6169 6e74 7320 696e  f constraints in
+000183f0: 2064 6567 7265 6573 206f 6620 6672 6565   degrees of free
+00018400: 646f 6d20 0a20 2020 2020 2073 656c 662e  dom .      self.
+00018410: 6e64 6f66 203d 2073 656c 662e 6461 7461  ndof = self.data
+00018420: 2e6e 6269 6e73 2d73 656c 662e 6e70 6172  .nbins-self.npar
+00018430: 2b73 656c 662e 6e63 6f6e 7374 7261 696e  +self.nconstrain
+00018440: 7473 2b6f 7574 6572 2e6e 6669 7865 640a  ts+outer.nfixed.
+00018450: 0a20 2020 2020 2023 2066 6c61 6720 746f  .      # flag to
+00018460: 2063 6f6e 7472 6f6c 2066 696e 616c 2061   control final a
+00018470: 6374 696f 6e73 2069 6e20 636f 7374 2066  ctions in cost f
+00018480: 756e 6374 696f 6e0a 2020 2020 2020 7365  unction.      se
+00018490: 6c66 2e66 696e 616c 5f63 616c 6c20 3d20  lf.final_call = 
+000184a0: 4661 6c73 650a 0a20 2020 2020 2069 6620  False..      if 
+000184b0: 7365 6c66 2e47 6175 7373 4170 7072 6f78  self.GaussApprox
+000184c0: 3a0a 2020 2020 2020 2020 7365 6c66 2e6e  :.        self.n
+000184d0: 326c 4c63 6f73 7420 3d20 7365 6c66 2e6e  2lLcost = self.n
+000184e0: 326c 4c47 6175 7373 0a20 2020 2020 2065  2lLGauss.      e
+000184f0: 6c73 653a 0a20 2020 2020 2020 2073 656c  lse:.        sel
+00018500: 662e 6e32 6c4c 636f 7374 203d 2073 656c  f.n2lLcost = sel
+00018510: 662e 6e32 6c4c 506f 6973 736f 6e0a 0a20  f.n2lLPoisson.. 
+00018520: 2020 2020 2069 6620 7365 6c66 2e64 656e       if self.den
+00018530: 7369 7479 3a0a 2020 2020 2020 2020 7365  sity:.        se
+00018540: 6c66 2e6e 6f72 6d20 3d20 7365 6c66 2e64  lf.norm = self.d
+00018550: 6174 612e 4e74 6f74 0a20 2020 2020 2065  ata.Ntot.      e
+00018560: 6c73 653a 0a20 2020 2020 2020 2073 656c  lse:.        sel
+00018570: 662e 6e6f 726d 203d 2031 2e0a 2020 2020  f.norm = 1..    
+00018580: 2020 2020 0a20 2020 2064 6566 205f 5f63      .    def __c
+00018590: 616c 6c5f 5f28 7365 6c66 2c20 2a70 6172  all__(self, *par
+000185a0: 293a 0a20 2020 2020 2023 2063 616c 6c65  ):.      # calle
+000185b0: 6420 6974 6572 6174 6976 656c 7920 6279  d iteratively by
+000185c0: 206d 696e 7569 740a 0a20 2020 2020 2023   minuit..      #
+000185d0: 2063 6f73 7420 6675 6e63 7469 6f6e 2069   cost function i
+000185e0: 7320 6c69 6b65 6c69 686f 6f64 206f 6620  s likelihood of 
+000185f0: 7368 6966 7465 6420 506f 6973 736f 6e20  shifted Poisson 
+00018600: 6f72 2047 6175 7373 2061 7070 726f 7869  or Gauss approxi
+00018610: 6d61 7469 6f6e 0a0a 2020 2020 2020 2320  mation..      # 
+00018620: 2d20 6669 7273 742c 2074 616b 6520 696e  - first, take in
+00018630: 746f 2061 6363 6f75 6e74 2070 6f73 7369  to account possi
+00018640: 626c 6520 7061 7261 6d65 7465 7220 636f  ble parameter co
+00018650: 6e73 7472 6169 6e74 7320 200a 2020 2020  nstraints  .    
+00018660: 2020 6e32 6c4c 3d20 302e 0a20 2020 2020    n2lL= 0..     
+00018670: 2069 6620 7365 6c66 2e6e 636f 6e73 7472   if self.nconstr
+00018680: 6169 6e74 733a 0a20 2020 2020 2020 2066  aints:.        f
+00018690: 6f72 2063 2069 6e20 7365 6c66 2e63 6f6e  or c in self.con
+000186a0: 7374 7261 696e 7473 3a0a 2020 2020 2020  straints:.      
+000186b0: 2020 2020 705f 6964 203d 2063 5b30 5d0a      p_id = c[0].
+000186c0: 2020 2020 2020 2020 2020 7220 3d20 2820            r = ( 
+000186d0: 7061 725b 705f 6964 5d20 2d20 635b 315d  par[p_id] - c[1]
+000186e0: 2920 2f20 635b 325d 200a 2020 2020 2020  ) / c[2] .      
+000186f0: 2020 2020 6e32 6c4c 202b 3d20 722a 720a      n2lL += r*r.
+00018700: 0a20 2020 2020 2023 202d 2063 616c 6375  .      # - calcu
+00018710: 6c61 7465 2032 2a6e 6567 4c6f 674c 2050  late 2*negLogL P
+00018720: 6f69 7373 6f6e 3b0a 2020 2020 2020 2320  oisson;.      # 
+00018730: 206d 6f64 656c 2070 7265 6469 6374 696f   model predictio
+00018740: 6e20 6173 2061 7070 726f 7869 6d61 7465  n as approximate
+00018750: 2069 6e74 6567 7261 6c20 6f76 6572 2062   integral over b
+00018760: 696e 0a20 2020 2020 206d 6f64 656c 5f76  in.      model_v
+00018770: 616c 7565 7320 3d20 7365 6c66 2e6e 6f72  alues = self.nor
+00018780: 6d20 2a20 7365 6c66 2e69 6e74 6567 7261  m * self.integra
+00018790: 6c5f 6f76 6572 4269 6e73 280a 2020 2020  l_overBins(.    
+000187a0: 2020 2020 7365 6c66 2e64 6174 612e 6c65      self.data.le
+000187b0: 6674 732c 2073 656c 662e 6461 7461 2e72  fts, self.data.r
+000187c0: 6967 6874 732c 0a20 2020 2020 2020 2073  ights,.        s
+000187d0: 656c 662e 6d6f 6465 6c2c 202a 7061 7229  elf.model, *par)
+000187e0: 200a 2020 2020 2020 2320 0a0a 2020 2020   .      # ..    
+000187f0: 2020 6e32 6c4c 202b 3d20 6e70 2e73 756d    n2lL += np.sum
+00018800: 280a 2020 2020 2020 2020 7365 6c66 2e6e  (.        self.n
+00018810: 326c 4c63 6f73 7428 2073 656c 662e 6461  2lLcost( self.da
+00018820: 7461 2e63 6f6e 7465 6e74 7320 2d20 7365  ta.contents - se
+00018830: 6c66 2e64 6174 612e 4465 6c74 614d 752c  lf.data.DeltaMu,
+00018840: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00018850: 2020 2020 2020 2020 6d6f 6465 6c5f 7661          model_va
+00018860: 6c75 6573 202b 206e 702e 6162 7328 7365  lues + np.abs(se
+00018870: 6c66 2e64 6174 612e 4465 6c74 614d 7529  lf.data.DeltaMu)
+00018880: 2029 2029 0a20 2020 2020 2020 0a20 2020   ) ).       .   
+00018890: 2020 2069 6620 7365 6c66 2e66 696e 616c     if self.final
+000188a0: 5f63 616c 6c3a 0a20 2020 2020 2020 2069  _call:.        i
+000188b0: 6620 7365 6c66 2e47 6175 7373 4170 7072  f self.GaussAppr
+000188c0: 6f78 3a0a 2020 2020 2020 2020 2020 2320  ox:.          # 
+000188d0: 7265 7475 726e 2073 7461 6e64 6172 6420  return standard 
+000188e0: 6368 695e 320a 2020 2020 2020 2020 2020  chi^2.          
+000188f0: 7365 6c66 2e67 6f66 203d 206e 326c 4c2d  self.gof = n2lL-
+00018900: 6e70 2e6c 6f67 286d 6f64 656c 5f76 616c  np.log(model_val
+00018910: 7565 732b 6e70 2e61 6273 2873 656c 662e  ues+np.abs(self.
+00018920: 6461 7461 2e44 656c 7461 4d75 2929 2e73  data.DeltaMu)).s
+00018930: 756d 2829 200a 2020 2020 2020 2020 656c  um() .        el
+00018940: 7365 3a20 0a20 2020 2020 2020 2020 2023  se: .          #
+00018950: 2073 746f 7265 2067 6f6f 646e 6573 732d   store goodness-
+00018960: 6f66 2d66 6974 2028 6469 6666 6572 656e  of-fit (differen
+00018970: 6365 206f 6620 6e6c 4c32 2077 2e72 2e74  ce of nlL2 w.r.t
+00018980: 2e20 7361 7475 7261 7465 6420 6d6f 6465  . saturated mode
+00018990: 6c29 0a20 2020 2020 2020 2020 206e 326c  l).          n2l
+000189a0: 4c5f 7361 7475 7261 7465 6420 3d20 6e70  L_saturated = np
+000189b0: 2e73 756d 280a 2020 2020 2020 2020 2020  .sum(.          
+000189c0: 2020 7365 6c66 2e6e 326c 4c63 6f73 7428    self.n2lLcost(
+000189d0: 0a20 2020 2020 2020 2020 2020 2020 2073  .              s
+000189e0: 656c 662e 6461 7461 2e63 6f6e 7465 6e74  elf.data.content
+000189f0: 7320 2d20 7365 6c66 2e64 6174 612e 4465  s - self.data.De
+00018a00: 6c74 614d 752c 200a 2020 2020 2020 2020  ltaMu, .        
+00018a10: 2020 2020 2020 7365 6c66 2e64 6174 612e        self.data.
+00018a20: 636f 6e74 656e 7473 202b 206e 702e 6162  contents + np.ab
+00018a30: 7328 7365 6c66 2e64 6174 612e 4465 6c74  s(self.data.Delt
+00018a40: 614d 7529 202b 2030 2e30 3035 2920 290a  aMu) + 0.005) ).
+00018a50: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+00018a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a70: 2020 2020 2020 2020 2021 2121 2063 6f6e           !!! con
+00018a80: 7374 2e20 302e 3030 3520 746f 2061 766f  st. 0.005 to avo
+00018a90: 6964 206c 6f67 2830 2e29 200a 2020 2020  id log(0.) .    
+00018aa0: 2020 2020 2020 7365 6c66 2e67 6f66 203d        self.gof =
+00018ab0: 2020 6e32 6c4c 202d 206e 326c 4c5f 7361    n2lL - n2lL_sa
+00018ac0: 7475 7261 7465 640a 0a20 2020 2020 2020  turated..       
+00018ad0: 2023 2070 726f 7669 6465 206d 6f64 656c   # provide model
+00018ae0: 2076 616c 7565 7320 616e 6420 6d6f 6465   values and mode
+00018af0: 6c2d 7265 6c61 7465 6420 756e 6365 7274  l-related uncert
+00018b00: 6169 6e74 6965 7320 746f 2064 6174 6120  ainties to data 
+00018b10: 6f62 6a65 6374 0a20 2020 2020 2020 2073  object.        s
+00018b20: 656c 662e 6461 7461 2e6d 6f64 656c 5f76  elf.data.model_v
+00018b30: 616c 7565 7320 3d20 6d6f 6465 6c5f 7661  alues = model_va
+00018b40: 6c75 6573 2020 2020 2020 200a 2020 2020  lues       .    
+00018b50: 2020 2020 0a20 2020 2020 2020 2320 7265      .       # re
+00018b60: 7475 726e 2032 202a 206e 6567 2e20 6c6f  turn 2 * neg. lo
+00018b70: 674c 0a20 2020 2020 2072 6574 7572 6e20  gL.      return 
+00018b80: 6e32 6c4c 0a20 2020 200a 2020 2020 4073  n2lL.    .    @s
+00018b90: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+00018ba0: 6465 6620 6e32 6c4c 506f 6973 736f 6e28  def n2lLPoisson(
+00018bb0: 782c 206c 616d 293a 2020 0a20 2020 2020  x, lam):  .     
+00018bc0: 2022 2222 0a20 2020 2020 206e 6567 2e20   """.      neg. 
+00018bd0: 6c6f 6761 7269 7468 6d20 6f66 2050 6f69  logarithm of Poi
+00018be0: 7373 6f6e 2064 6973 7472 6962 7574 696f  sson distributio
+00018bf0: 6e20 666f 7220 7265 616c 2d76 616c 7565  n for real-value
+00018c00: 6420 780a 0a20 2020 2020 2022 2222 0a20  d x..      """. 
+00018c10: 2020 2020 2072 6574 7572 6e20 322e 2a28       return 2.*(
+00018c20: 6c61 6d20 2d20 782a 6e70 2e6c 6f67 286c  lam - x*np.log(l
+00018c30: 616d 2920 2b20 6c6f 6767 616d 6d61 2878  am) + loggamma(x
+00018c40: 2b31 2e29 290a 0a20 2020 2040 7374 6174  +1.))..    @stat
+00018c50: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00018c60: 206e 326c 4c73 506f 6973 736f 6e28 786b   n2lLsPoisson(xk
+00018c70: 2c20 6c61 6d2c 206d 7529 3a20 200a 2020  , lam, mu):  .  
+00018c80: 2020 2020 2222 220a 2020 2020 2020 322a      """.      2*
+00018c90: 206e 6567 2e20 6c6f 6761 7269 7468 6d20   neg. logarithm 
+00018ca0: 6f66 2067 656e 6572 616c 697a 6564 2050  of generalized P
+00018cb0: 6f69 7373 6f6e 2064 6973 7472 6962 7574  oisson distribut
+00018cc0: 696f 6e3a 200a 2020 2020 2020 7368 6966  ion: .      shif
+00018cd0: 7465 6420 746f 206e 6577 206d 6561 6e20  ted to new mean 
+00018ce0: 6d75 2066 6f72 2072 6561 6c2d 7661 6c75  mu for real-valu
+00018cf0: 6564 2078 6b20 2020 2020 2020 200a 2020  ed xk        .  
+00018d00: 2020 2020 666f 7220 6c61 6d3d 6d75 2c20      for lam=mu, 
+00018d10: 7468 6520 7374 616e 6461 7264 2050 6f69  the standard Poi
+00018d20: 7373 6f6e 2064 6973 7472 6962 7574 696f  sson distributio
+00018d30: 6e20 6973 2072 6563 6f76 6572 6564 0a20  n is recovered. 
+00018d40: 2020 2020 206c 616d 3d73 6967 6d61 2a32       lam=sigma*2
+00018d50: 2069 7320 7468 6520 7661 7269 616e 6365   is the variance
+00018d60: 206f 6620 7468 6520 7368 6966 7465 6420   of the shifted 
+00018d70: 506f 6973 736f 6e20 6469 7374 7269 6275  Poisson distribu
+00018d80: 7469 6f6e 2e0a 2020 2020 2020 2222 220a  tion..      """.
+00018d90: 2020 2020 2020 7873 203d 2028 786b 202b        xs = (xk +
+00018da0: 206c 616d 202d 206d 7529 0a20 2020 2020   lam - mu).     
+00018db0: 2072 6574 7572 6e20 322e 2a28 6c61 6d20   return 2.*(lam 
+00018dc0: 2d20 7873 2a6e 702e 6c6f 6728 6c61 6d29  - xs*np.log(lam)
+00018dd0: 202b 206c 6f67 6761 6d6d 6128 7873 2b31   + loggamma(xs+1
+00018de0: 2e29 290a 0a20 2020 2040 7374 6174 6963  .))..    @static
+00018df0: 6d65 7468 6f64 0a20 2020 2064 6566 206e  method.    def n
+00018e00: 326c 4c47 6175 7373 2878 2c20 6c61 6d29  2lLGauss(x, lam)
+00018e10: 3a20 200a 2020 2020 2020 2222 2220 2020  :  .      """   
+00018e20: 200a 2020 2020 2020 6e65 6761 7469 7665   .      negative
+00018e30: 206c 6f67 2d6c 696b 656c 6968 6f6f 6420   log-likelihood 
+00018e40: 6f66 2047 6175 7373 6961 6e20 6170 7072  of Gaussian appr
+00018e50: 6f78 696d 6174 696f 6e0a 2020 2020 2020  oximation.      
+00018e60: 506f 6973 2878 2c20 6c61 6d29 205c 7369  Pois(x, lam) \si
+00018e70: 6d65 7120 4761 7573 7328 782c 206d 753d  meq Gauss(x, mu=
+00018e80: 6c61 6d2c 2073 6967 6d61 5e32 3d6c 616d  lam, sigma^2=lam
+00018e90: 290a 2020 2020 2020 2222 220a 2020 2020  ).      """.    
+00018ea0: 2020 7220 3d20 2878 2d6c 616d 290a 2020    r = (x-lam).  
+00018eb0: 2020 2020 7265 7475 726e 2028 7220 2a20      return (r * 
+00018ec0: 722f 6c61 6d20 2b20 6e70 2e6c 6f67 286c  r/lam + np.log(l
+00018ed0: 616d 2929 0a20 2020 2020 2020 2020 2020  am)).           
+00018ee0: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+00018ef0: 6f64 0a20 2020 2064 6566 2069 6e74 6567  od.    def integ
+00018f00: 7261 6c5f 6f76 6572 4269 6e73 286c 6564  ral_overBins(led
+00018f10: 6765 732c 2072 6564 6765 732c 2066 2c20  ges, redges, f, 
+00018f20: 2a70 6172 293a 0a20 2020 2020 2022 2222  *par):.      """
+00018f30: 4361 6c63 756c 6174 6520 6170 7072 6f78  Calculate approx
+00018f40: 2e20 696e 7465 6772 616c 206f 6620 6d6f  . integral of mo
+00018f50: 6465 6c20 6f76 6572 2062 696e 7320 7573  del over bins us
+00018f60: 696e 6720 5369 6d70 736f 6e27 7320 7275  ing Simpson's ru
+00018f70: 6c65 0a20 2020 2020 2022 2222 0a20 2020  le.      """.   
+00018f80: 2020 2072 6574 7572 6e20 2872 6564 6765     return (redge
+00018f90: 7320 2d20 6c65 6467 6573 292f 362e 202a  s - ledges)/6. *
+00018fa0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00018fb0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00018fc0: 2066 286c 6564 6765 732c 202a 7061 7229   f(ledges, *par)
+00018fd0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00018fe0: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00018ff0: 2034 2e2a 6628 286c 6564 6765 732b 7265   4.*f((ledges+re
+00019000: 6467 6573 292f 322e 2c20 2a70 6172 2920  dges)/2., *par) 
+00019010: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+00019020: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
+00019030: 6628 7265 6467 6573 2c20 2a70 6172 2920  f(redges, *par) 
+00019040: 2920 0a0a 2020 2320 2d2d 2d20 656e 6420  ) ..  # --- end 
+00019050: 6465 6669 6e69 7469 6f6e 206f 6620 636c  definition of cl
+00019060: 6173 7320 6843 6f73 7420 2d2d 2d2d 0a0a  ass hCost ----..
+00019070: 2020 230a 2020 2320 2d2d 2d20 7370 6563    #.  # --- spec
+00019080: 6961 6c20 636f 6465 2066 6f72 2066 6974  ial code for fit
+00019090: 2077 6974 6820 7573 6572 2d73 7570 706c   with user-suppl
+000190a0: 6965 6420 636f 7374 2066 756e 6374 696f  ied cost functio
+000190b0: 6e0a 2020 2320 2020 2020 6f72 2070 6466  n.  #     or pdf
+000190c0: 2066 6f72 206e 6567 2e20 6c6f 672d 6c69   for neg. log-li
+000190d0: 6b65 6c69 686f 6f64 2066 6974 200a 2020  kelihood fit .  
+000190e0: 2320 2020 2020 200a 0a20 2064 6566 2069  #      ..  def i
+000190f0: 6e69 745f 6d6c 4461 7461 2873 656c 662c  nit_mlData(self,
+00019100: 2078 293a 0a20 2020 2022 2222 0a20 2020   x):.    """.   
+00019110: 2069 6e69 7469 616c 697a 6520 6461 7461   initialize data
+00019120: 206f 626a 6563 740a 0a20 2020 2041 7267   object..    Arg
+00019130: 733a 0a20 2020 202d 2078 2c20 6172 7261  s:.    - x, arra
+00019140: 7920 6f66 2066 6c6f 6174 730a 2020 2020  y of floats.    
+00019150: 2222 220a 2020 2020 0a20 2020 2023 2063  """.    .    # c
+00019160: 7265 6174 6520 6461 7461 206f 626a 6563  reate data objec
+00019170: 7420 616e 6420 7061 7373 2061 6c6c 2069  t and pass all i
+00019180: 6e70 7574 2061 7267 756d 656e 7473 0a20  nput arguments. 
+00019190: 2020 2073 656c 662e 6d6c 4461 7461 203d     self.mlData =
+000191a0: 2073 656c 662e 6d6c 4461 7461 436f 6e74   self.mlDataCont
+000191b0: 6169 6e65 7228 7365 6c66 2c20 7829 0a20  ainer(self, x). 
+000191c0: 2020 2073 656c 662e 6461 7461 203d 2073     self.data = s
+000191d0: 656c 662e 6d6c 4461 7461 0a0a 0a20 2064  elf.mlData...  d
+000191e0: 6566 2069 6e69 745f 6d6e 4669 7428 7365  ef init_mnFit(se
+000191f0: 6c66 2c20 7573 6572 4675 6e63 7469 6f6e  lf, userFunction
+00019200: 2c20 6d6f 6465 6c5f 6b77 6172 6773 3d4e  , model_kwargs=N
+00019210: 6f6e 652c 2070 303d 4e6f 6e65 2c20 6470  one, p0=None, dp
+00019220: 303d 4e6f 6e65 2c0a 2020 2020 2020 2020  0=None,.        
+00019230: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00019240: 6f6e 7374 7261 696e 7473 3d4e 6f6e 652c  onstraints=None,
+00019250: 2066 6978 5061 7273 3d4e 6f6e 652c 206c   fixPars=None, l
+00019260: 696d 6974 733d 4e6f 6e65 293a 0a20 2020  imits=None):.   
+00019270: 2022 2222 696e 6974 6961 6c69 7a65 2066   """initialize f
+00019280: 6974 206f 626a 6563 7420 666f 7220 7369  it object for si
+00019290: 6d70 6c65 206d 696e 7569 7420 6669 7420  mple minuit fit 
+000192a0: 7769 7468 0a20 2020 202a 2077 6974 6820  with.    * with 
+000192b0: 7573 6572 2d73 7570 706c 6965 6420 636f  user-supplied co
+000192c0: 7374 2066 756e 6374 696f 6e20 6f72 0a20  st function or. 
+000192d0: 2020 202a 2061 2070 726f 6261 6269 6c69     * a probabili
+000192e0: 7479 2064 656e 7369 7479 2066 756e 6374  ty density funct
+000192f0: 696f 6e20 666f 7220 616e 2075 6e62 696e  ion for an unbin
+00019300: 6e65 6420 6e65 672e 206c 6f67 2d4c 2066  ned neg. log-L f
+00019310: 6974 0a0a 2020 2020 4172 6773 3a0a 2020  it..    Args:.  
+00019320: 2020 2020 2d20 636f 7374 4675 6e63 7469      - costFuncti
+00019330: 6f6e 3a20 636f 7374 2066 756e 6374 696f  on: cost functio
+00019340: 6e20 6f72 2070 6466 200a 2020 2020 2020  n or pdf .      
+00019350: 2d20 7030 3a20 6e70 2d61 7272 6179 206f  - p0: np-array o
+00019360: 6620 666c 6f61 7473 2c20 696e 6974 6961  f floats, initia
+00019370: 6c20 7061 7261 6d65 7465 7220 7661 6c75  l parameter valu
+00019380: 6573 200a 2020 2020 2020 2d20 6d6f 6465  es .      - mode
+00019390: 6c5f 6b77 6172 6773 3a20 6f70 7469 6f6e  l_kwargs: option
+000193a0: 616c 2c20 6669 7420 7061 7261 6d65 7465  al, fit paramete
+000193b0: 7273 2069 6620 6e6f 7420 6672 6f6d 206d  rs if not from m
+000193c0: 6f64 656c 2073 6967 6e61 7475 7265 200a  odel signature .
+000193d0: 2020 2020 2020 2d20 6470 303a 2061 7272        - dp0: arr
+000193e0: 6179 2d6c 696b 652c 2069 6e69 7469 616c  ay-like, initial
+000193f0: 2067 7565 7373 206f 6620 7061 7261 6d65   guess of parame
+00019400: 7465 7220 756e 6365 7274 6169 6e74 6965  ter uncertaintie
+00019410: 7320 286f 7074 696f 6e61 6c29 0a20 2020  s (optional).   
+00019420: 2020 202d 2070 6172 616d 6574 6572 2063     - parameter c
+00019430: 6f6e 7374 7261 696e 7473 3a20 286e 6573  onstraints: (nes
+00019440: 7465 6429 206c 6973 7428 7329 3a20 5b70  ted) list(s): [p
+00019450: 6172 616d 6574 6572 206e 616d 652c 2076  arameter name, v
+00019460: 616c 7565 2c20 756e 6365 7274 6169 6e74  alue, uncertaint
+00019470: 795d 200a 2020 2020 2020 2d20 6669 7820  y] .      - fix 
+00019480: 7061 7261 6d65 7465 7228 7329 2069 6e20  parameter(s) in 
+00019490: 6669 743a 206c 6973 7420 6f66 2070 6172  fit: list of par
+000194a0: 616d 6574 6572 206e 616d 6573 206f 7220  ameter names or 
+000194b0: 696e 6469 6365 730a 2020 2020 2020 2d20  indices.      - 
+000194c0: 6c69 6d69 7473 3a20 286e 6573 7465 6429  limits: (nested)
+000194d0: 206c 6973 7428 7329 3a20 5b70 6172 616d   list(s): [param
+000194e0: 6574 6572 206e 616d 652c 206d 696e 2c20  eter name, min, 
+000194f0: 6d61 785d 206f 720a 2020 2020 2020 2020  max] or.        
+00019500: 5b70 6172 616d 6574 6572 2069 6e64 6578  [parameter index
+00019510: 2c20 6d69 6e2c 206d 6178 5d0a 2020 2020  , min, max].    
+00019520: 2222 220a 2020 2020 6966 2073 656c 662e  """.    if self.
+00019530: 6461 7461 2069 7320 4e6f 6e65 2061 6e64  data is None and
+00019540: 2073 656c 662e 6669 745f 7479 7065 2021   self.fit_type !
+00019550: 3d20 2275 7365 7222 3a0a 2020 2020 2020  = "user":.      
+00019560: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00019570: 280a 2020 2020 2020 2020 2720 2121 2120  (.        ' !!! 
+00019580: 6d6e 4669 742e 696e 6974 5f6d 6e46 6974  mnFit.init_mnFit
+00019590: 3a20 6e6f 2064 6174 6120 6f62 6a65 6374  : no data object
+000195a0: 2064 6566 696e 6564 202d 2063 616c 6c20   defined - call 
+000195b0: 696e 6974 5f64 6174 6128 2927 290a 0a20  init_data()').. 
+000195c0: 2020 2023 2067 6574 2070 6172 616d 6574     # get paramet
+000195d0: 6572 7320 6f66 206d 6f64 656c 2066 756e  ers of model fun
+000195e0: 6374 696f 6e20 746f 2073 6574 2073 7461  ction to set sta
+000195f0: 7274 2076 616c 7565 7320 666f 7220 6669  rt values for fi
+00019600: 740a 2020 2020 6966 206d 6f64 656c 5f6b  t.    if model_k
+00019610: 7761 7267 7320 6973 204e 6f6e 653a 0a20  wargs is None:. 
+00019620: 2020 2020 2061 7267 732c 206d 6f64 656c       args, model
+00019630: 5f6b 7761 7267 7320 3d20 6765 745f 6675  _kwargs = get_fu
+00019640: 6e63 7469 6f6e 5369 676e 6174 7572 6528  nctionSignature(
+00019650: 7573 6572 4675 6e63 7469 6f6e 290a 0a20  userFunction).. 
+00019660: 2020 2070 6172 203d 2028 6d6f 6465 6c5f     par = (model_
+00019670: 6b77 6172 6773 2c20 7030 2c20 6470 302c  kwargs, p0, dp0,
+00019680: 2063 6f6e 7374 7261 696e 7473 2c20 6669   constraints, fi
+00019690: 7850 6172 732c 206c 696d 6974 7329 0a20  xPars, limits). 
+000196a0: 2020 2073 656c 662e 5f73 6574 7570 4669     self._setupFi
+000196b0: 7450 6172 616d 6574 6572 7328 2a70 6172  tParameters(*par
+000196c0: 2920 0a0a 2020 2020 2373 6574 2075 7020  ) ..    #set up 
+000196d0: 636f 7374 2066 756e 6374 696f 6e20 666f  cost function fo
+000196e0: 7220 696d 696e 7569 740a 2020 2020 7365  r iminuit.    se
+000196f0: 6c66 2e63 6f73 7466 203d 2073 656c 662e  lf.costf = self.
+00019700: 6d6e 436f 7374 2873 656c 662c 2075 7365  mnCost(self, use
+00019710: 7246 756e 6374 696f 6e29 0a20 2020 2073  rFunction).    s
+00019720: 656c 662e 5f73 6574 7570 4d69 6e75 6974  elf._setupMinuit
+00019730: 286d 6f64 656c 5f6b 7761 7267 7329 200a  (model_kwargs) .
+00019740: 0a20 2064 6566 2073 6574 5f6d 6e4f 7074  .  def set_mnOpt
+00019750: 696f 6e73 2873 656c 662c 2072 756e 5f6d  ions(self, run_m
+00019760: 696e 6f73 3d4e 6f6e 652c 206e 6567 326c  inos=None, neg2l
+00019770: 6f67 4c3d 4e6f 6e65 2c20 7175 6965 743d  ogL=None, quiet=
+00019780: 4e6f 6e65 293a 0a20 2020 2022 2222 4465  None):.    """De
+00019790: 6669 6e65 206f 7074 696f 6e73 2066 6f72  fine options for
+000197a0: 206d 696e 7569 7420 6669 7420 7769 7468   minuit fit with
+000197b0: 2075 7365 7220 636f 7374 2066 756e 6374   user cost funct
+000197c0: 696f 6e0a 0a20 2020 2041 7267 733a 0a0a  ion..    Args:..
+000197d0: 2020 2020 2d20 7275 6e5f 6d69 6e6f 733a      - run_minos:
+000197e0: 2072 756e 206d 696e 6f73 2070 726f 6669   run minos profi
+000197f0: 6c65 206c 696b 656c 6968 6f6f 6420 7363  le likelihood sc
+00019800: 616e 0a20 2020 202d 206e 6567 326c 6f67  an.    - neg2log
+00019810: 4c3a 2063 6f73 7420 6675 6e63 7469 6f6e  L: cost function
+00019820: 2069 7320 2d32 206e 6567 4c6f 674c 0a20   is -2 negLogL. 
+00019830: 2020 2022 2222 0a20 2020 2069 6620 7275     """.    if ru
+00019840: 6e5f 6d69 6e6f 7320 6973 206e 6f74 204e  n_minos is not N
+00019850: 6f6e 653a 2020 200a 2020 2020 2020 7365  one:   .      se
+00019860: 6c66 2e72 756e 5f6d 696e 6f73 203d 2072  lf.run_minos = r
+00019870: 756e 5f6d 696e 6f73 0a20 2020 2020 2073  un_minos.      s
+00019880: 656c 662e 6f70 7469 6f6e 735b 2272 756e  elf.options["run
+00019890: 5f6d 696e 6f73 225d 5b30 5d20 3d20 696e  _minos"][0] = in
+000198a0: 7428 7275 6e5f 6d69 6e6f 7329 0a20 2020  t(run_minos).   
+000198b0: 2069 6620 6e65 6732 6c6f 674c 2069 7320   if neg2logL is 
+000198c0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000198d0: 7365 6c66 2e6e 6567 326c 6f67 4c20 3d20  self.neg2logL = 
+000198e0: 6e65 6732 6c6f 674c 0a20 2020 2020 2073  neg2logL.      s
+000198f0: 656c 662e 6f70 7469 6f6e 735b 226e 6567  elf.options["neg
+00019900: 326c 6f67 4c22 5d5b 305d 203d 2069 6e74  2logL"][0] = int
+00019910: 286e 6567 326c 6f67 4c29 0a20 2020 2020  (neg2logL).     
+00019920: 2069 6620 7365 6c66 2e6e 6567 326c 6f67   if self.neg2log
+00019930: 4c3a 0a20 2020 2020 2020 2073 656c 662e  L:.        self.
+00019940: 4572 7244 6566 203d 2031 2e0a 2020 2020  ErrDef = 1..    
+00019950: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00019960: 7365 6c66 2e45 7272 4465 6620 3d20 302e  self.ErrDef = 0.
+00019970: 350a 2020 2020 6966 2071 7569 6574 2069  5.    if quiet i
+00019980: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00019990: 2020 7365 6c66 2e71 7569 6574 203d 2071    self.quiet = q
+000199a0: 7569 6574 0a0a 2020 636c 6173 7320 6d6c  uiet..  class ml
+000199b0: 4461 7461 436f 6e74 6169 6e65 723a 0a20  DataContainer:. 
+000199c0: 2020 2022 2222 0a20 2020 2020 2043 6f6e     """.      Con
+000199d0: 7461 696e 6572 2066 6f72 2067 656e 6572  tainer for gener
+000199e0: 616c 2028 696e 6465 7865 6429 2064 6174  al (indexed) dat
+000199f0: 610a 0a20 2020 2020 2044 6174 6120 4d65  a..      Data Me
+00019a00: 6d62 6572 733a 0a0a 2020 2020 2020 2d20  mbers:..      - 
+00019a10: 782c 2061 7272 6179 206f 6620 666c 6f61  x, array of floa
+00019a20: 7473 3a20 6461 7461 0a0a 0a20 2020 2020  ts: data...     
+00019a30: 204d 6574 686f 6473 3a0a 0a20 2020 2020   Methods:..     
+00019a40: 202d 706c 6f74 2829 3a20 7265 7475 726e   -plot(): return
+00019a50: 2066 6967 7572 6520 7769 7468 2072 6570   figure with rep
+00019a60: 7265 7365 6e74 6174 696f 6e20 6f66 2064  resentation of d
+00019a70: 6174 610a 2020 2020 2222 220a 2020 2020  ata.    """.    
+00019a80: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00019a90: 5f28 7365 6c66 2c20 6f75 7465 722c 2078  _(self, outer, x
+00019aa0: 293a 0a20 2020 2020 2022 2222 200a 2020  ):.      """ .  
+00019ab0: 2020 2020 7374 6f72 6520 6461 7461 0a0a      store data..
+00019ac0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+00019ad0: 2020 2d20 782c 2061 7272 6179 206f 6620    - x, array of 
+00019ae0: 666c 6f61 7473 0a20 2020 2020 202d 2071  floats.      - q
+00019af0: 7569 6574 3a20 626f 6f6c 6561 6e2c 2063  uiet: boolean, c
+00019b00: 6f6e 7472 6f6c 7320 7072 696e 7465 6420  ontrols printed 
+00019b10: 6f75 7470 7574 0a0a 2020 2020 2020 2222  output..      ""
+00019b20: 220a 0a20 2020 2020 2073 656c 662e 7820  "..      self.x 
+00019b30: 3d20 6e70 2e61 7361 7272 6179 2878 290a  = np.asarray(x).
+00019b40: 2020 2020 2020 7365 6c66 2e64 6c65 6e67        self.dleng
+00019b50: 7468 203d 206c 656e 2873 656c 662e 7829  th = len(self.x)
+00019b60: 0a0a 2020 2020 2020 0a20 2020 2064 6566  ..      .    def
+00019b70: 2070 6c6f 7428 7365 6c66 2c20 6e75 6d3d   plot(self, num=
+00019b80: 2769 6e64 6578 6564 2064 6174 6127 2c0a  'indexed data',.
 00019b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ba0: 2064 6174 615f 6c61 6265 6c3d 2744 6174   data_label='Dat
-00019bb0: 6127 2c0a 2020 2020 2020 2020 2020 2020  a',.            
-00019bc0: 2020 2020 2020 2070 6c6f 745f 7265 7369         plot_resi
-00019bd0: 6475 616c 3d46 616c 7365 293a 0a20 2020  dual=False):.   
-00019be0: 2020 2022 2222 7265 7475 726e 2066 6967     """return fig
-00019bf0: 7572 6520 7769 7468 2068 6973 746f 6772  ure with histogr
-00019c00: 616d 2064 6174 6120 616e 6420 756e 6365  am data and unce
-00019c10: 7274 6169 6e74 6965 730a 2020 2020 2020  rtainties.      
-00019c20: 2222 220a 0a20 2020 2020 2066 6967 203d  """..      fig =
-00019c30: 2070 6c74 2e66 6967 7572 6528 6e75 6d3d   plt.figure(num=
-00019c40: 6e75 6d2c 2066 6967 7369 7a65 3d66 6967  num, figsize=fig
-00019c50: 7369 7a65 290a 0a20 2020 2020 2069 6620  size)..      if 
-00019c60: 706c 6f74 5f72 6573 6964 7561 6c3a 0a20  plot_residual:. 
-00019c70: 2020 2020 2020 2070 7269 6e74 2827 2021         print(' !
-00019c80: 2121 206d 6e46 6974 2e6d 6c44 6174 612e  !! mnFit.mlData.
-00019c90: 706c 6f74 3a20 706c 6f74 7469 6e67 2072  plot: plotting r
-00019ca0: 6573 6964 7561 6c73 206e 6f74 2070 6f73  esiduals not pos
-00019cb0: 7369 626c 6520 666f 7220 7573 6572 204d  sible for user M
-00019cc0: 4c20 6669 7427 290a 2020 2020 2020 2020  L fit').        
-00019cd0: 0a20 2020 2020 2069 6620 7365 6c66 2e78  .      if self.x
-00019ce0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00019cf0: 2020 7072 696e 7428 2720 2121 2120 6d6e    print(' !!! mn
-00019d00: 4669 742e 6d6c 4461 7461 2e70 6c6f 743a  Fit.mlData.plot:
-00019d10: 206e 6f20 6461 7461 206f 626a 6563 7420   no data object 
-00019d20: 6465 6669 6e65 6427 290a 2020 2020 2020  defined').      
-00019d30: 2020 7265 7475 726e 2066 6967 0a20 2020    return fig.   
-00019d40: 2020 200a 2020 2020 2020 6d6e 203d 206d     .      mn = m
-00019d50: 696e 2873 656c 662e 7829 0a20 2020 2020  in(self.x).     
-00019d60: 206d 7820 3d20 6d61 7828 7365 6c66 2e78   mx = max(self.x
-00019d70: 290a 2020 2020 2020 796d 6e20 3d20 302e  ).      ymn = 0.
-00019d80: 0a20 2020 2020 2079 6d78 203d 2030 2e32  .      ymx = 0.2
-00019d90: 352f 286d 782d 6d6e 290a 2020 2020 2020  5/(mx-mn).      
-00019da0: 706c 742e 766c 696e 6573 2873 656c 662e  plt.vlines(self.
-00019db0: 782c 2079 6d6e 2c20 796d 782c 206c 773d  x, ymn, ymx, lw=
-00019dc0: 312c 2063 6f6c 6f72 3d27 6772 6579 272c  1, color='grey',
-00019dd0: 2061 6c70 6861 3d30 2e35 2c20 6c61 6265   alpha=0.5, labe
-00019de0: 6c3d 6461 7461 5f6c 6162 656c 290a 2020  l=data_label).  
-00019df0: 2020 2020 0a20 2020 2020 2072 6574 7572      .      retur
-00019e00: 6e20 6669 670a 0a20 2020 2020 200a 2020  n fig..      .  
-00019e10: 2320 2d2d 2d20 636c 6173 7320 656e 6361  # --- class enca
-00019e20: 7073 756c 6174 696e 6720 7573 6572 2d64  psulating user-d
-00019e30: 6566 696e 6564 2063 6f73 7420 6675 6e63  efined cost func
-00019e40: 7469 6f6e 0a20 2063 6c61 7373 206d 6e43  tion.  class mnC
-00019e50: 6f73 743a 0a20 2020 2022 2222 0a20 2020  ost:.    """.   
-00019e60: 2049 6e74 6572 6661 6365 2066 6f72 2073   Interface for s
-00019e70: 696d 706c 6520 6d69 6e75 6974 2066 6974  imple minuit fit
-00019e80: 2077 6974 6820 7573 6572 2d73 7570 706c   with user-suppl
-00019e90: 6965 6420 636f 7374 2066 756e 6374 696f  ied cost functio
-00019ea0: 6e2e 0a0a 2020 2020 5468 6520 5f5f 6361  n...    The __ca
-00019eb0: 6c6c 5f5f 206d 6574 686f 6420 6f66 2074  ll__ method of t
-00019ec0: 6869 7320 636c 6173 7320 6973 2063 616c  his class is cal
-00019ed0: 6c65 6420 6279 2069 6d69 6e75 6974 2e0a  led by iminuit..
-00019ee0: 0a20 2020 2041 7267 733a 0a0a 2020 2020  .    Args:..    
-00019ef0: 2020 2d20 7573 6572 436f 7374 4675 6e63    - userCostFunc
-00019f00: 7469 6f6e 3a20 7573 6572 2d73 7570 706c  tion: user-suppl
-00019f10: 6965 6420 636f 7374 2066 756e 6374 696f  ied cost functio
-00019f20: 6e20 666f 7220 6d69 6e75 6974 3b0a 2020  n for minuit;.  
-00019f30: 2020 2020 2020 206d 7573 7420 6265 2061         must be a
-00019f40: 206e 6567 6174 6976 6520 6c6f 672d 6c69   negative log-li
-00019f50: 6b65 6c69 686f 6f64 200a 2020 2020 2222  kelihood .    ""
-00019f60: 220a 2020 2020 0a20 2020 2064 6566 205f  ".    .    def _
-00019f70: 5f69 6e69 745f 5f28 7365 6c66 2c20 6f75  _init__(self, ou
-00019f80: 7465 722c 200a 2020 2020 2020 2020 2020  ter, .          
-00019f90: 2020 2020 2020 2075 7365 7246 756e 6374         userFunct
-00019fa0: 696f 6e29 3a0a 2020 2020 2020 6672 6f6d  ion):.      from
-00019fb0: 2069 6d69 6e75 6974 2e75 7469 6c20 696d   iminuit.util im
-00019fc0: 706f 7274 206d 616b 655f 6675 6e63 5f63  port make_func_c
-00019fd0: 6f64 650a 0a20 2020 2020 2073 656c 662e  ode..      self.
-00019fe0: 7175 6965 7420 3d20 6f75 7465 722e 7175  quiet = outer.qu
-00019ff0: 6965 740a 2020 2020 2020 7365 6c66 2e64  iet.      self.d
-0001a000: 6174 6120 3d20 6f75 7465 722e 6461 7461  ata = outer.data
-0001a010: 0a20 2020 2020 2069 6620 7365 6c66 2e64  .      if self.d
-0001a020: 6174 6120 6973 204e 6f6e 653a 0a20 2020  ata is None:.   
-0001a030: 2020 2020 2073 656c 662e 636f 7374 203d       self.cost =
-0001a040: 2075 7365 7246 756e 6374 696f 6e0a 2020   userFunction.  
-0001a050: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0001a060: 662e 7175 6965 743a 0a20 2020 2020 2020  f.quiet:.       
-0001a070: 2020 2070 7269 6e74 2822 2a3d 3d2a 206d     print("*==* m
-0001a080: 6e46 6974 2e6d 6e43 6f73 743a 2066 6974  nFit.mnCost: fit
-0001a090: 2077 6974 6820 7573 6572 2d73 7570 706c   with user-suppl
-0001a0a0: 6965 6420 636f 7374 2066 756e 6374 696f  ied cost functio
-0001a0b0: 6e27 2229 2020 2020 2020 2020 2020 0a20  n'")          . 
-0001a0c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001a0d0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-0001a0e0: 616e 6365 2873 656c 662e 6461 7461 2c20  ance(self.data, 
-0001a0f0: 6d6e 4669 742e 6d6c 4461 7461 436f 6e74  mnFit.mlDataCont
-0001a100: 6169 6e65 7229 3a0a 2020 2020 2020 2020  ainer):.        
-0001a110: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0001a120: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0001a130: 2220 2121 2120 6d6e 4669 742e 6d6e 436f  " !!! mnFit.mnCo
-0001a140: 7374 3a20 6578 7065 6374 696e 6720 6461  st: expecting da
-0001a150: 7461 2063 6f6e 7461 696e 6572 206f 6620  ta container of 
-0001a160: 7479 7065 2027 6d6c 4461 7461 436f 6e74  type 'mlDataCont
-0001a170: 6169 6e65 7227 2229 0a20 2020 2020 2020  ainer'").       
-0001a180: 2073 656c 662e 6d6f 6465 6c20 3d20 7573   self.model = us
-0001a190: 6572 4675 6e63 7469 6f6e 0a20 2020 2020  erFunction.     
-0001a1a0: 2020 2073 656c 662e 636f 7374 203d 2073     self.cost = s
-0001a1b0: 656c 662e 6e6c 4c63 6f73 740a 2020 2020  elf.nlLcost.    
-0001a1c0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-0001a1d0: 7175 6965 743a 0a20 2020 2020 2020 2020  quiet:.         
-0001a1e0: 2070 7269 6e74 2822 2a3d 3d2a 206d 6e46   print("*==* mnF
-0001a1f0: 6974 2e6d 6e43 6f73 743a 206e 6567 4c6f  it.mnCost: negLo
-0001a200: 674c 2066 6974 2077 6974 6820 7573 6572  gL fit with user
-0001a210: 2d64 6566 696e 6564 2064 656e 7369 7479  -defined density
-0001a220: 2066 756e 6374 696f 6e27 2229 2020 2020   function'")    
-0001a230: 2020 2020 2020 0a0a 2020 2020 2020 2320        ..      # 
-0001a240: 7461 6b65 2061 6363 6f75 6e74 206f 6620  take account of 
-0001a250: 706f 7373 6962 6c65 2070 6172 616d 6574  possible paramet
-0001a260: 6572 2063 6f6e 7374 7261 696e 7473 0a20  er constraints. 
-0001a270: 2020 2020 2073 656c 662e 636f 6e73 7472       self.constr
-0001a280: 6169 6e74 7320 3d20 6f75 7465 722e 636f  aints = outer.co
-0001a290: 6e73 7472 6169 6e74 730a 2020 2020 2020  nstraints.      
-0001a2a0: 7365 6c66 2e6e 636f 6e73 7472 6169 6e74  self.nconstraint
-0001a2b0: 7320 3d20 6c65 6e28 7365 6c66 2e63 6f6e  s = len(self.con
-0001a2c0: 7374 7261 696e 7473 290a 2020 2020 2020  straints).      
-0001a2d0: 7365 6c66 2e45 7272 4465 6620 3d20 6f75  self.ErrDef = ou
-0001a2e0: 7465 722e 4572 7244 6566 0a20 2020 2020  ter.ErrDef.     
-0001a2f0: 2073 656c 662e 7366 5f6c 4c20 3d20 2d32   self.sf_lL = -2
-0001a300: 2e2a 7365 6c66 2e45 7272 4465 660a 2020  .*self.ErrDef.  
-0001a310: 2020 2020 0a20 2020 2020 2023 2073 6574      .      # set
-0001a320: 2070 726f 7065 7220 7369 676e 6174 7572   proper signatur
-0001a330: 6520 6f66 206d 6f64 656c 2066 756e 6374  e of model funct
-0001a340: 696f 6e20 666f 7220 696d 696e 7569 740a  ion for iminuit.
-0001a350: 2020 2020 2020 7365 6c66 2e70 6e61 6d73        self.pnams
-0001a360: 203d 206f 7574 6572 2e70 6e61 6d73 0a20   = outer.pnams. 
-0001a370: 2020 2020 2073 656c 662e 6675 6e63 5f63       self.func_c
-0001a380: 6f64 6520 3d20 6d61 6b65 5f66 756e 635f  ode = make_func_
-0001a390: 636f 6465 2873 656c 662e 706e 616d 7329  code(self.pnams)
-0001a3a0: 0a20 2020 2020 2073 656c 662e 6e70 6172  .      self.npar
-0001a3b0: 203d 206f 7574 6572 2e6e 7061 720a 0a20   = outer.npar.. 
-0001a3c0: 2020 2020 2023 2066 6f72 2074 6869 7320       # for this 
-0001a3d0: 6b69 6e64 206f 6620 6669 742c 2073 6f6d  kind of fit, som
-0001a3e0: 6520 696e 7075 7420 616e 6420 6f75 7075  e input and oupu
-0001a3f0: 7420 7175 616e 7469 7469 6573 2061 7265  t quantities are
-0001a400: 206e 6f74 206b 6e6f 776e 0a20 2020 2020   not known.     
-0001a410: 2073 656c 662e 676f 6620 3d20 4e6f 6e65   self.gof = None
-0001a420: 0a20 2020 2020 2073 656c 662e 6e64 6f66  .      self.ndof
-0001a430: 203d 204e 6f6e 650a 2020 2020 2020 0a20   = None.      . 
-0001a440: 2020 2064 6566 205f 5f63 616c 6c5f 5f28     def __call__(
-0001a450: 7365 6c66 2c20 2a70 6172 293a 0a20 2020  self, *par):.   
-0001a460: 2020 2063 6f73 7420 3d20 302e 0a20 2020     cost = 0..   
-0001a470: 2020 2023 2061 6464 2063 6f6e 7374 7261     # add constra
-0001a480: 696e 7473 2074 6f20 636f 7374 0a20 2020  ints to cost.   
-0001a490: 2020 2069 6620 7365 6c66 2e6e 636f 6e73     if self.ncons
-0001a4a0: 7472 6169 6e74 733a 0a20 2020 2020 2020  traints:.       
-0001a4b0: 2066 6f72 2063 2069 6e20 7365 6c66 2e63   for c in self.c
-0001a4c0: 6f6e 7374 7261 696e 7473 3a0a 2020 2020  onstraints:.    
-0001a4d0: 2020 2020 2020 705f 6964 203d 2063 5b30        p_id = c[0
-0001a4e0: 5d0a 2020 2020 2020 2020 2020 7220 3d20  ].          r = 
-0001a4f0: 2820 7061 725b 705f 6964 5d20 2d20 635b  ( par[p_id] - c[
-0001a500: 315d 2920 2f20 635b 325d 200a 2020 2020  1]) / c[2] .    
-0001a510: 2020 2020 2020 636f 7374 202b 3d20 722a        cost += r*
-0001a520: 720a 2020 2020 2020 2020 636f 7374 202a  r.        cost *
-0001a530: 3d20 7365 6c66 2e45 7272 4465 6620 0a20  = self.ErrDef . 
-0001a540: 2020 2020 2023 2063 616c 6c65 6420 6974       # called it
-0001a550: 6572 6174 6976 656c 7920 6279 206d 696e  eratively by min
-0001a560: 7569 740a 2020 2020 2020 7265 7475 726e  uit.      return
-0001a570: 2063 6f73 7420 2b20 7365 6c66 2e63 6f73   cost + self.cos
-0001a580: 7428 2a70 6172 290a 0a20 2020 2064 6566  t(*par)..    def
-0001a590: 206e 6c4c 636f 7374 2873 656c 662c 202a   nlLcost(self, *
-0001a5a0: 7061 7229 3a0a 2020 2020 2020 2222 226e  par):.      """n
-0001a5b0: 6567 6174 6976 6520 6c6f 6720 6c69 6b65  egative log like
-0001a5c0: 6c69 686f 6f64 206f 6620 6461 7461 2061  lihood of data a
-0001a5d0: 6e64 2075 7365 722d 6465 6669 6e65 6420  nd user-defined 
-0001a5e0: 5044 4620 616e 6420 0a20 2020 2020 2022  PDF and .      "
-0001a5f0: 2222 0a20 2020 2020 2020 2320 6368 6563  "".       # chec
-0001a600: 6b20 6966 2050 4446 2069 7320 6e6f 6d61  k if PDF is noma
-0001a610: 6c69 7a65 6420 746f 2031 0a20 2020 2020  lized to 1.     
-0001a620: 2020 2320 2e2e 2e0a 0a20 2020 2020 206c    # .....      l
-0001a630: 4c3d 206e 702e 7375 6d28 206e 702e 6c6f  L= np.sum( np.lo
-0001a640: 6728 2073 656c 662e 6d6f 6465 6c28 7365  g( self.model(se
-0001a650: 6c66 2e64 6174 612e 782c 202a 7061 7229  lf.data.x, *par)
-0001a660: 2029 2029 0a20 2020 2020 2072 6574 7572   ) ).      retur
-0001a670: 6e20 7365 6c66 2e73 665f 6c4c 202a 206c  n self.sf_lL * l
-0001a680: 4c0a 2020 2020 2020 2020 0a20 2320 2d2d  L.        . # --
-0001a690: 2d20 656e 6420 6465 6669 6e69 7469 6f6e  - end definition
-0001a6a0: 206f 6620 636c 6173 7320 6d6e 436f 7374   of class mnCost
-0001a6b0: 202d 2d2d 2d0a 0a20 230a 2023 202d 2d2d   ----.. #. # ---
-0001a6c0: 2063 6f6d 6d6f 6e20 636f 6465 2066 6f72   common code for
-0001a6d0: 2061 6c6c 2066 6974 2074 7970 6573 0a20   all fit types. 
-0001a6e0: 230a 0a20 2064 6566 205f 7365 7475 7046  #..  def _setupF
-0001a6f0: 6974 5061 7261 6d65 7465 7273 2873 656c  itParameters(sel
-0001a700: 662c 206d 6f64 656c 5f6b 7761 7267 732c  f, model_kwargs,
-0001a710: 2070 302c 2064 7030 2c20 636f 6e73 7472   p0, dp0, constr
-0001a720: 6169 6e74 732c 2066 6978 5061 7273 2c20  aints, fixPars, 
-0001a730: 6c69 6d69 7473 293a 0a20 2020 2022 2222  limits):.    """
-0001a740: 7365 7420 7570 2070 6172 616d 6574 6572  set up parameter
-0001a750: 7320 6e65 6564 6564 2066 6f72 204d 696e  s needed for Min
-0001a760: 7569 7420 616e 6420 636f 7374 2066 756e  uit and cost fun
-0001a770: 6374 696f 6e0a 2020 2020 2222 220a 0a20  ction.    """.. 
-0001a780: 2020 2023 2067 6574 2070 6172 616d 6574     # get paramet
-0001a790: 6572 206e 616d 6573 2066 726f 6d20 6b77  er names from kw
-0001a7a0: 6172 6773 206f 6620 6d6f 6465 6c20 6675  args of model fu
-0001a7b0: 6e63 7469 6f6e 0a20 2020 2073 656c 662e  nction.    self.
-0001a7c0: 706e 616d 7320 3d20 6c69 7374 2e63 6f70  pnams = list.cop
-0001a7d0: 7928 6c69 7374 286d 6f64 656c 5f6b 7761  y(list(model_kwa
-0001a7e0: 7267 732e 6b65 7973 2829 2929 0a20 2020  rgs.keys())).   
-0001a7f0: 2073 656c 662e 6e70 6172 203d 206c 656e   self.npar = len
-0001a800: 2873 656c 662e 706e 616d 7329 0a20 2020  (self.pnams).   
-0001a810: 2023 2064 6963 7469 6f6e 6172 7920 6173   # dictionary as
-0001a820: 7369 676e 696e 6720 7061 7261 6d65 7465  signing paramete
-0001a830: 7220 6e61 6d65 2074 6f20 696e 6465 780a  r name to index.
-0001a840: 2020 2020 7365 6c66 2e70 6e61 6d32 6964      self.pnam2id
-0001a850: 203d 207b 0a20 2020 2020 2073 656c 662e   = {.      self.
-0001a860: 706e 616d 735b 695d 203a 2069 2066 6f72  pnams[i] : i for
-0001a870: 2069 2069 6e20 7261 6e67 6528 302c 7365   i in range(0,se
-0001a880: 6c66 2e6e 7061 7229 207d 200a 0a20 2020  lf.npar) } ..   
-0001a890: 2023 2070 726f 6365 7373 2061 6e64 2073   # process and s
-0001a8a0: 746f 7265 2070 6172 616d 6574 6572 2063  tore parameter c
-0001a8b0: 6f6e 7374 7261 696e 7473 2028 7573 6564  onstraints (used
-0001a8c0: 2069 6e20 636f 7374 2066 756e 6374 696f   in cost functio
-0001a8d0: 6e29 0a20 2020 2073 656c 662e 7365 7443  n).    self.setC
-0001a8e0: 6f6e 7374 7261 696e 7473 203d 2063 6f6e  onstraints = con
-0001a8f0: 7374 7261 696e 7473 2020 2020 0a20 2020  straints    .   
-0001a900: 2073 656c 662e 636f 6e73 7472 6169 6e74   self.constraint
-0001a910: 7320 3d20 5b5d 0a20 2020 2069 6620 636f  s = [].    if co
-0001a920: 6e73 7472 6169 6e74 7320 6973 206e 6f74  nstraints is not
-0001a930: 204e 6f6e 653a 0a20 2020 2020 2069 6620   None:.      if 
-0001a940: 6c65 6e28 6e70 2e73 6861 7065 2863 6f6e  len(np.shape(con
-0001a950: 7374 7261 696e 7473 2929 3d3d 323a 0a20  straints))==2:. 
-0001a960: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
-0001a970: 636f 6e73 7472 6169 6e74 733a 0a20 2020  constraints:.   
-0001a980: 2020 2020 2020 2023 206e 616d 6520 746f         # name to
-0001a990: 2070 6172 616d 6574 6572 2069 640a 2020   parameter id.  
-0001a9a0: 2020 2020 2020 2020 6966 2074 7970 6528          if type(
-0001a9b0: 635b 305d 293d 3d74 7970 6528 2720 2729  c[0])==type(' ')
-0001a9c0: 3a0a 2020 2020 2020 2020 2020 2020 635b  :.            c[
-0001a9d0: 305d 203d 2073 656c 662e 706e 616d 3269  0] = self.pnam2i
-0001a9e0: 645b 635b 305d 5d0a 2020 2020 2020 2020  d[c[0]].        
-0001a9f0: 2020 7365 6c66 2e63 6f6e 7374 7261 696e    self.constrain
-0001aa00: 7473 2e61 7070 656e 6428 6329 0a20 2020  ts.append(c).   
-0001aa10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001aa20: 2023 206e 616d 6520 746f 2070 6172 616d   # name to param
-0001aa30: 6574 6572 2069 640a 2020 2020 2020 2020  eter id.        
-0001aa40: 6966 2074 7970 6528 636f 6e73 7472 6169  if type(constrai
-0001aa50: 6e74 735b 305d 293d 3d74 7970 6528 2720  nts[0])==type(' 
-0001aa60: 2729 3a0a 2020 2020 2020 2020 2020 636f  '):.          co
-0001aa70: 6e73 7472 6169 6e74 735b 305d 203d 2073  nstraints[0] = s
-0001aa80: 656c 662e 706e 616d 3269 645b 636f 6e73  elf.pnam2id[cons
-0001aa90: 7472 6169 6e74 735b 305d 5d0a 2020 2020  traints[0]].    
-0001aaa0: 2020 2020 7365 6c66 2e63 6f6e 7374 7261      self.constra
-0001aab0: 696e 7473 2e61 7070 656e 6428 636f 6e73  ints.append(cons
-0001aac0: 7472 6169 6e74 7329 0a20 2020 2073 656c  traints).    sel
-0001aad0: 662e 6e63 6f6e 7374 7261 696e 7473 203d  f.nconstraints =
-0001aae0: 206c 656e 2873 656c 662e 636f 6e73 7472   len(self.constr
-0001aaf0: 6169 6e74 7329 0a0a 2020 2020 2320 7365  aints)..    # se
-0001ab00: 7420 696e 6974 6961 6c20 7061 7261 6d65  t initial parame
-0001ab10: 7465 7273 2066 6f72 2066 6974 2028 7573  ters for fit (us
-0001ab20: 6564 2062 7920 6d69 6e75 6974 2920 0a20  ed by minuit) . 
-0001ab30: 2020 2069 6620 7030 2069 7320 6e6f 7420     if p0 is not 
-0001ab40: 4e6f 6e65 3a0a 2020 2020 2020 666f 7220  None:.      for 
-0001ab50: 692c 2070 6e61 6d20 696e 2065 6e75 6d65  i, pnam in enume
-0001ab60: 7261 7465 2873 656c 662e 706e 616d 7329  rate(self.pnams)
-0001ab70: 3a0a 2020 2020 2020 2020 6d6f 6465 6c5f  :.        model_
-0001ab80: 6b77 6172 6773 5b70 6e61 6d5d 203d 2070  kwargs[pnam] = p
-0001ab90: 305b 695d 2020 2020 0a0a 2020 2020 2320  0[i]    ..    # 
-0001aba0: 7365 7420 696e 6974 6961 6c20 756e 6365  set initial unce
-0001abb0: 7274 6169 6e74 6965 7320 286f 7074 696f  rtainties (optio
-0001abc0: 6e61 6c29 0a20 2020 2073 656c 662e 6470  nal).    self.dp
-0001abd0: 3020 3d20 6470 300a 2020 2020 0a20 2020  0 = dp0.    .   
-0001abe0: 2023 2073 746f 7265 2069 6e66 6f72 6d61   # store informa
-0001abf0: 7469 6f6e 7320 6f6e 2070 6172 616d 6574  tions on paramet
-0001ac00: 6572 206c 696d 6974 7320 2875 7365 6420  er limits (used 
-0001ac10: 6279 206d 696e 7569 7429 0a20 2020 2073  by minuit).    s
-0001ac20: 656c 662e 7365 744c 696d 6974 7320 3d20  elf.setLimits = 
-0001ac30: 6c69 6d69 7473 2020 2020 0a20 2020 2073  limits    .    s
-0001ac40: 656c 662e 6c69 6d69 7473 203d 205b 5d0a  elf.limits = [].
-0001ac50: 2020 2020 6966 206c 696d 6974 7320 6973      if limits is
-0001ac60: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0001ac70: 2073 656c 662e 6c69 6d69 7473 3d5b 205b   self.limits=[ [
-0001ac80: 4e6f 6e65 2c20 4e6f 6e65 5d5d 202a 206c  None, None]] * l
-0001ac90: 656e 2873 656c 662e 706e 616d 7329 0a20  en(self.pnams). 
-0001aca0: 2020 2020 2069 6620 6c65 6e28 6e70 2e73       if len(np.s
-0001acb0: 6861 7065 286c 696d 6974 7329 293d 3d32  hape(limits))==2
-0001acc0: 3a0a 2020 2020 2020 2020 666f 7220 6c20  :.        for l 
-0001acd0: 696e 206c 696d 6974 733a 0a20 2020 2020  in limits:.     
-0001ace0: 2020 2020 2069 6620 7479 7065 286c 5b30       if type(l[0
-0001acf0: 5d29 3d3d 7479 7065 2827 2027 293a 0a20  ])==type(' '):. 
-0001ad00: 2020 2020 2020 2020 2020 2070 5f69 6420             p_id 
-0001ad10: 3d20 7365 6c66 2e70 6e61 6d32 6964 5b6c  = self.pnam2id[l
-0001ad20: 5b30 5d5d 0a20 2020 2020 2020 2020 2065  [0]].          e
-0001ad30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001ad40: 2070 5f69 6420 3d20 6c5b 305d 0a20 2020   p_id = l[0].   
-0001ad50: 2020 2020 2020 2073 656c 662e 6c69 6d69         self.limi
-0001ad60: 7473 5b70 5f69 645d 203d 205b 6c5b 315d  ts[p_id] = [l[1]
-0001ad70: 2c20 6c5b 325d 5d20 2020 2020 2020 2020  , l[2]]         
-0001ad80: 200a 2020 2020 2020 656c 7365 3a0a 2020   .      else:.  
-0001ad90: 2020 2020 2020 6966 2074 7970 6528 6c69        if type(li
-0001ada0: 6d69 7473 5b30 5d29 3d3d 7479 7065 2827  mits[0])==type('
-0001adb0: 2027 293a 0a20 2020 2020 2020 2020 2070   '):.          p
-0001adc0: 5f69 6420 3d20 7365 6c66 2e70 6e61 6d32  _id = self.pnam2
-0001add0: 6964 5b6c 696d 6974 735b 305d 5d0a 2020  id[limits[0]].  
-0001ade0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001adf0: 2020 2020 2020 705f 6964 203d 206c 696d        p_id = lim
-0001ae00: 6974 735b 305d 0a20 2020 2020 2020 2073  its[0].        s
-0001ae10: 656c 662e 6c69 6d69 7473 5b70 5f69 645d  elf.limits[p_id]
-0001ae20: 3d5b 6c69 6d69 7473 5b31 5d2c 206c 696d  =[limits[1], lim
-0001ae30: 6974 735b 325d 5d20 2020 2020 2020 2020  its[2]]         
-0001ae40: 200a 0a20 2020 2023 2073 746f 7265 2069   ..    # store i
-0001ae50: 6e66 6f72 6d61 7469 6f6e 206f 6e20 6669  nformation on fi
-0001ae60: 7865 6420 7061 7261 6d65 7465 7273 200a  xed parameters .
-0001ae70: 2020 2020 7365 6c66 2e66 6978 5061 7273      self.fixPars
-0001ae80: 203d 2066 6978 5061 7273 2020 2020 0a20   = fixPars    . 
-0001ae90: 2020 2073 656c 662e 6669 7865 6450 6172     self.fixedPar
-0001aea0: 7320 3d20 5b20 4661 6c73 6520 5d20 2a20  s = [ False ] * 
-0001aeb0: 7365 6c66 2e6e 7061 720a 2020 2020 6966  self.npar.    if
-0001aec0: 2066 6978 5061 7273 2069 7320 6e6f 7420   fixPars is not 
-0001aed0: 4e6f 6e65 3a0a 2020 2020 2020 2320 6765  None:.      # ge
-0001aee0: 7420 7061 7261 6d65 7465 7220 6e61 6d65  t parameter name
-0001aef0: 7320 6f72 2069 6e64 6963 6573 2074 6f20  s or indices to 
-0001af00: 6669 780a 2020 2020 2020 6966 206c 656e  fix.      if len
-0001af10: 286e 702e 7368 6170 6528 6669 7850 6172  (np.shape(fixPar
-0001af20: 7329 293d 3d31 3a0a 2020 2020 2020 2020  s))==1:.        
-0001af30: 666f 7220 6620 696e 2066 6978 5061 7273  for f in fixPars
-0001af40: 3a0a 2020 2020 2020 2020 2020 6966 2074  :.          if t
-0001af50: 7970 6528 6629 3d3d 7479 7065 2827 2027  ype(f)==type(' '
-0001af60: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-0001af70: 5f69 6420 3d20 7365 6c66 2e70 6e61 6d32  _id = self.pnam2
-0001af80: 6964 5b66 5d0a 2020 2020 2020 2020 2020  id[f].          
-0001af90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001afa0: 2020 705f 6964 203d 2066 0a20 2020 2020    p_id = f.     
-0001afb0: 2020 2020 2073 656c 662e 6669 7865 6450       self.fixedP
-0001afc0: 6172 735b 705f 6964 5d20 3d20 5472 7565  ars[p_id] = True
-0001afd0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
-0001afe0: 2020 2073 656c 662e 6e66 6978 6564 203d     self.nfixed =
-0001aff0: 206c 656e 2866 6978 5061 7273 290a 2020   len(fixPars).  
-0001b000: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001b010: 2020 6966 2074 7970 6528 6669 7850 6172    if type(fixPar
-0001b020: 7329 3d3d 7479 7065 2827 2027 293a 0a20  s)==type(' '):. 
-0001b030: 2020 2020 2020 2020 2070 5f69 6420 3d20           p_id = 
-0001b040: 7365 6c66 2e70 6e61 6d32 6964 5b66 6978  self.pnam2id[fix
-0001b050: 5061 7273 5d0a 2020 2020 2020 2020 656c  Pars].        el
-0001b060: 7365 3a0a 2020 2020 2020 2020 2020 705f  se:.          p_
-0001b070: 6964 203d 2066 6978 5061 7273 0a20 2020  id = fixPars.   
-0001b080: 2020 2020 2073 656c 662e 6669 7865 6450       self.fixedP
-0001b090: 6172 735b 705f 6964 5d3d 5472 7565 2020  ars[p_id]=True  
-0001b0a0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-0001b0b0: 2073 656c 662e 6e66 6978 6564 203d 2031   self.nfixed = 1
-0001b0c0: 0a20 2020 2023 2067 6574 2070 6172 616d  .    # get param
-0001b0d0: 6574 6572 206e 616d 6573 206f 7220 696e  eter names or in
-0001b0e0: 6469 6365 7320 6f66 2066 6978 6564 2070  dices of fixed p
-0001b0f0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-0001b100: 7365 6c66 2e66 7265 6550 6172 4e61 6d73  self.freeParNams
-0001b110: 203d 205b 5d0a 2020 2020 2020 7365 6c66   = [].      self
-0001b120: 2e66 6978 6564 5061 724e 616d 7320 3d20  .fixedParNams = 
-0001b130: 5b5d 0a20 2020 2020 2066 6f72 2069 2c20  [].      for i, 
-0001b140: 6669 7865 6420 696e 2065 6e75 6d65 7261  fixed in enumera
-0001b150: 7465 2873 656c 662e 6669 7865 6450 6172  te(self.fixedPar
-0001b160: 7329 3a0a 2020 2020 2020 2020 6966 206e  s):.        if n
-0001b170: 6f74 2066 6978 6564 3a20 7365 6c66 2e66  ot fixed: self.f
-0001b180: 7265 6550 6172 4e61 6d73 2e61 7070 656e  reeParNams.appen
-0001b190: 6428 7365 6c66 2e70 6e61 6d73 5b69 5d29  d(self.pnams[i])
-0001b1a0: 0a20 2020 2020 2020 2069 6620 6669 7865  .        if fixe
-0001b1b0: 643a 2073 656c 662e 6669 7865 6450 6172  d: self.fixedPar
-0001b1c0: 4e61 6d73 2e61 7070 656e 6428 7365 6c66  Nams.append(self
-0001b1d0: 2e70 6e61 6d73 5b69 5d29 0a20 2020 2065  .pnams[i]).    e
-0001b1e0: 6c73 653a 0a20 2020 2020 2073 656c 662e  lse:.      self.
-0001b1f0: 6672 6565 5061 724e 616d 7320 3d20 7365  freeParNams = se
-0001b200: 6c66 2e70 6e61 6d73 2020 0a20 2020 2020  lf.pnams  .     
-0001b210: 2073 656c 662e 6669 7865 6450 6172 4e61   self.fixedParNa
-0001b220: 6d73 203d 205b 5d20 200a 0a20 2064 6566  ms = []  ..  def
-0001b230: 205f 7365 7475 704d 696e 7569 7428 7365   _setupMinuit(se
-0001b240: 6c66 2c20 6d6f 6465 6c5f 6b77 6172 6773  lf, model_kwargs
-0001b250: 293a 0a20 2020 2022 2222 6372 6561 7465  ):.    """create
-0001b260: 204d 696e 7569 7420 6f62 6a65 6374 2028   Minuit object (
-0001b270: 6465 7065 6e64 7320 6f6e 204d 696e 7569  depends on Minui
-0001b280: 7420 7665 7273 696f 6e29 0a20 2020 2022  t version).    "
-0001b290: 2222 0a20 2020 2069 6620 7365 6c66 2e69  "".    if self.i
-0001b2a0: 6d69 6e75 6974 5f76 6572 7369 6f6e 203c  minuit_version <
-0001b2b0: 2027 3227 3a0a 2020 2020 2020 6966 2073   '2':.      if s
-0001b2c0: 656c 662e 7175 6965 743a 0a20 2020 2020  elf.quiet:.     
-0001b2d0: 2020 2070 7269 6e74 5f6c 6576 656c 3d30     print_level=0
-0001b2e0: 0a20 2020 2020 2065 6c73 653a 0a20 2020  .      else:.   
-0001b2f0: 2020 2020 2070 7269 6e74 5f6c 6576 656c       print_level
-0001b300: 3d31 0a20 2020 2020 2069 6620 7365 6c66  =1.      if self
-0001b310: 2e64 7030 2069 7320 6e6f 7420 4e6f 6e65  .dp0 is not None
-0001b320: 3a0a 2020 2020 2020 2020 666f 7220 692c  :.        for i,
-0001b330: 2070 6e61 6d20 696e 2065 6e75 6d65 7261   pnam in enumera
-0001b340: 7465 2873 656c 662e 706e 616d 7329 3a0a  te(self.pnams):.
-0001b350: 2020 2020 2020 2020 2020 6d6f 6465 6c5f            model_
-0001b360: 6b77 6172 6773 5b27 6572 726f 725f 2720  kwargs['error_' 
-0001b370: 2b20 706e 616d 5d20 3d20 7365 6c66 2e64  + pnam] = self.d
-0001b380: 7030 5b69 5d0a 2020 2020 2020 6966 2073  p0[i].      if s
-0001b390: 656c 662e 7365 744c 696d 6974 7320 6973  elf.setLimits is
-0001b3a0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0001b3b0: 2020 2066 6f72 2069 2c20 706e 616d 2069     for i, pnam i
-0001b3c0: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
-0001b3d0: 2e70 6e61 6d73 293a 0a20 2020 2020 2020  .pnams):.       
-0001b3e0: 2020 206d 6f64 656c 5f6b 7761 7267 735b     model_kwargs[
-0001b3f0: 276c 696d 6974 5f27 202b 2070 6e61 6d5d  'limit_' + pnam]
-0001b400: 203d 2073 656c 662e 6c69 6d69 7473 5b69   = self.limits[i
-0001b410: 5d0a 2020 2020 2020 6966 2073 656c 662e  ].      if self.
-0001b420: 6669 7850 6172 7320 6973 206e 6f74 204e  fixPars is not N
-0001b430: 6f6e 653a 0a20 2020 2020 2020 2066 6f72  one:.        for
-0001b440: 2069 2c20 706e 616d 2069 6e20 656e 756d   i, pnam in enum
-0001b450: 6572 6174 6528 7365 6c66 2e70 6e61 6d73  erate(self.pnams
-0001b460: 293a 0a20 2020 2020 2020 2020 206d 6f64  ):.          mod
-0001b470: 656c 5f6b 7761 7267 735b 2766 6978 5f27  el_kwargs['fix_'
-0001b480: 202b 2070 6e61 6d5d 203d 2073 656c 662e   + pnam] = self.
-0001b490: 6669 7865 6450 6172 735b 695d 2020 2020  fixedPars[i]    
-0001b4a0: 2020 2020 2020 0a20 2020 2020 2073 656c        .      sel
-0001b4b0: 662e 6d69 6e75 6974 203d 204d 696e 7569  f.minuit = Minui
-0001b4c0: 7428 7365 6c66 2e63 6f73 7466 2c0a 2020  t(self.costf,.  
-0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4e0: 2020 2020 2020 2020 2065 7272 6f72 6465           errorde
-0001b4f0: 663d 7365 6c66 2e45 7272 4465 662c 0a20  f=self.ErrDef,. 
-0001b500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b510: 2020 2020 2020 2020 2020 7072 696e 745f            print_
-0001b520: 6c65 7665 6c3d 7072 696e 745f 6c65 7665  level=print_leve
-0001b530: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
-0001b540: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-0001b550: 6d6f 6465 6c5f 6b77 6172 6773 2029 0a20  model_kwargs ). 
-0001b560: 2020 2065 6c73 653a 0a20 2020 2020 2073     else:.      s
-0001b570: 656c 662e 6d69 6e75 6974 203d 204d 696e  elf.minuit = Min
-0001b580: 7569 7428 7365 6c66 2e63 6f73 7466 2c0a  uit(self.costf,.
-0001b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5a0: 2020 2020 2020 2020 2020 202a 6d6f 6465             *mode
-0001b5b0: 6c5f 6b77 6172 6773 2e76 616c 7565 7328  l_kwargs.values(
-0001b5c0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0001b5d0: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0001b5e0: 6d65 3d73 656c 662e 706e 616d 7320 290a  me=self.pnams ).
-0001b5f0: 2020 2020 2020 7365 6c66 2e6d 696e 7569        self.minui
-0001b600: 742e 6572 726f 7264 6566 203d 2073 656c  t.errordef = sel
-0001b610: 662e 4572 7244 6566 0a20 2020 2020 2069  f.ErrDef.      i
-0001b620: 6620 7365 6c66 2e71 7569 6574 3a0a 2020  f self.quiet:.  
-0001b630: 2020 2020 2020 7365 6c66 2e6d 696e 7569        self.minui
-0001b640: 742e 7072 696e 745f 6c65 7665 6c20 3d20  t.print_level = 
-0001b650: 300a 2020 2020 2020 6966 2073 656c 662e  0.      if self.
-0001b660: 6470 3020 6973 206e 6f74 204e 6f6e 653a  dp0 is not None:
-0001b670: 0a20 2020 2020 2020 2073 656c 662e 6d69  .        self.mi
-0001b680: 6e75 6974 2e65 7272 6f72 7320 3d20 7365  nuit.errors = se
-0001b690: 6c66 2e64 7030 0a20 2020 2020 2069 6620  lf.dp0.      if 
-0001b6a0: 7365 6c66 2e73 6574 4c69 6d69 7473 2069  self.setLimits i
-0001b6b0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0001b6c0: 2020 2020 7365 6c66 2e6d 696e 7569 742e      self.minuit.
-0001b6d0: 6c69 6d69 7473 203d 2073 656c 662e 6c69  limits = self.li
-0001b6e0: 6d69 7473 0a20 2020 2020 2069 6620 7365  mits.      if se
-0001b6f0: 6c66 2e66 6978 5061 7273 2069 7320 6e6f  lf.fixPars is no
-0001b700: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0001b710: 666f 7220 692c 2070 6e61 6d20 696e 2065  for i, pnam in e
-0001b720: 6e75 6d65 7261 7465 2873 656c 662e 706e  numerate(self.pn
-0001b730: 616d 7329 3a0a 2020 2020 2020 2020 2020  ams):.          
-0001b740: 6966 2073 656c 662e 6669 7865 6450 6172  if self.fixedPar
-0001b750: 735b 695d 3a20 7365 6c66 2e6d 696e 7569  s[i]: self.minui
-0001b760: 742e 6669 7865 645b 706e 616d 5d3d 5472  t.fixed[pnam]=Tr
-0001b770: 7565 200a 0a20 2064 6566 205f 7374 6f72  ue ..  def _stor
-0001b780: 6552 6573 756c 7428 7365 6c66 293a 0a20  eResult(self):. 
-0001b790: 2023 2063 6f6c 6c65 6374 2072 6573 756c   # collect resul
-0001b7a0: 7473 2061 7320 6e75 6d70 7920 6172 7261  ts as numpy arra
-0001b7b0: 7973 0a20 2020 2023 2021 2121 2074 6869  ys.    # !!! thi
-0001b7c0: 7320 7061 7274 2064 6570 656e 6473 206f  s part depends o
-0001b7d0: 6e20 696d 696e 7569 7420 7665 7273 696f  n iminuit versio
-0001b7e0: 6e20 2121 2120 2020 200a 2020 2020 6d3d  n !!!    .    m=
-0001b7f0: 7365 6c66 2e6d 696e 7569 740a 2020 2020  self.minuit.    
-0001b800: 6d69 6e43 6f73 7420 3d20 6d2e 6676 616c  minCost = m.fval
-0001b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b820: 2020 2020 2020 2020 2320 6d69 6e69 6d75          # minimu
-0001b830: 6d20 7661 6c75 6520 6f66 2063 6f73 7420  m value of cost 
-0001b840: 6675 6e63 7469 6f6e 0a20 2020 206e 6670  function.    nfp
-0001b850: 6172 203d 206d 2e6e 6669 7420 2020 2020  ar = m.nfit     
-0001b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b870: 2020 2020 2023 206e 756d 6572 206f 6620       # numer of 
-0001b880: 6672 6565 2070 6172 616d 6574 6572 730a  free parameters.
-0001b890: 2020 2020 6e64 6f66 203d 2073 656c 662e      ndof = self.
-0001b8a0: 636f 7374 662e 6e64 6f66 2020 2020 2020  costf.ndof      
-0001b8b0: 2020 2020 2020 2020 2020 2020 2320 6465              # de
-0001b8c0: 6772 6565 7320 6f66 2066 7265 6564 6f6d  grees of freedom
-0001b8d0: 0a20 2020 2069 6620 7365 6c66 2e69 6d69  .    if self.imi
-0001b8e0: 6e75 6974 5f76 6572 7369 6f6e 203c 2027  nuit_version < '
-0001b8f0: 3227 3a0a 2020 2020 2020 7061 726e 616d  2':.      parnam
-0001b900: 6573 203d 206d 2e76 616c 7565 732e 6b65  es = m.values.ke
-0001b910: 7973 2829 2020 2020 2020 2020 2020 2020  ys()            
-0001b920: 2320 7061 7261 6d65 7465 7220 6e61 6d65  # parameter name
-0001b930: 730a 2020 2020 2020 7061 7276 616c 7320  s.      parvals 
-0001b940: 3d20 6e70 2e61 7361 7272 6179 286d 2e76  = np.asarray(m.v
-0001b950: 616c 7565 732e 7661 6c75 6573 2829 2920  alues.values()) 
-0001b960: 2320 6265 7374 2d66 6974 2076 616c 7565  # best-fit value
-0001b970: 730a 2020 2020 2020 7061 7265 7272 7320  s.      parerrs 
-0001b980: 3d20 6e70 2e61 7361 7272 6179 286d 2e65  = np.asarray(m.e
-0001b990: 7272 6f72 732e 7661 6c75 6573 2829 2920  rrors.values()) 
-0001b9a0: 2320 7061 7261 6d65 7465 7220 756e 6365  # parameter unce
-0001b9b0: 7274 6169 6e74 6965 730a 2020 2020 2020  rtainties.      
-0001b9c0: 636f 7620 3d20 6e70 2e61 7272 6179 286d  cov = np.array(m
-0001b9d0: 2e6d 6174 7269 7828 2929 2020 2020 2020  .matrix())      
-0001b9e0: 2020 2020 2020 2320 636f 762e 206d 6174        # cov. mat
-0001b9f0: 7269 7820 6f66 2066 7265 6520 7061 7261  rix of free para
-0001ba00: 6d65 7465 7273 0a20 2020 2065 6c73 653a  meters.    else:
-0001ba10: 0a20 2020 2023 2076 6572 732e 203e 3d32  .    # vers. >=2
-0001ba20: 2e30 200a 2020 2020 2020 7061 726e 616d  .0 .      parnam
-0001ba30: 6573 203d 206d 2e70 6172 616d 6574 6572  es = m.parameter
-0001ba40: 7320 2020 2020 2020 2320 7061 7261 6d65  s       # parame
-0001ba50: 7465 7220 6e61 6d65 730a 2020 2020 2020  ter names.      
-0001ba60: 7061 7276 616c 7320 3d20 6e70 2e61 7361  parvals = np.asa
-0001ba70: 7272 6179 286d 2e76 616c 7565 7329 2020  rray(m.values)  
-0001ba80: 2320 6265 7374 2d66 6974 2076 616c 7565  # best-fit value
-0001ba90: 730a 2020 2020 2020 7061 7265 7272 7320  s.      parerrs 
-0001baa0: 3d20 6e70 2e61 7361 7272 6179 286d 2e65  = np.asarray(m.e
-0001bab0: 7272 6f72 7329 2020 2320 7061 7261 6d65  rrors)  # parame
-0001bac0: 7465 7220 756e 6365 7274 6169 6e74 6965  ter uncertaintie
-0001bad0: 730a 2020 2020 2020 636f 7620 3d20 6e70  s.      cov = np
-0001bae0: 2e61 7361 7272 6179 286d 2e63 6f76 6172  .asarray(m.covar
-0001baf0: 6961 6e63 6529 2020 2320 636f 7661 7269  iance)  # covari
-0001bb00: 616e 6365 206d 6174 7269 7820 6f66 2061  ance matrix of a
-0001bb10: 6c6c 2821 2920 7061 7261 6d65 7465 7273  ll(!) parameters
-0001bb20: 0a20 2020 2020 2023 2070 726f 6475 6365  .      # produce
-0001bb30: 2072 6564 7563 6564 2063 6f76 6172 6961   reduced covaria
-0001bb40: 6e63 6520 6d61 7472 6978 2066 6f72 2066  nce matrix for f
-0001bb50: 7265 6520 7061 7261 6d65 7465 7273 206f  ree parameters o
-0001bb60: 6e6c 790a 2020 2020 2020 6966 2073 656c  nly.      if sel
-0001bb70: 662e 6e66 6978 6564 2021 3d20 303a 0a20  f.nfixed != 0:. 
-0001bb80: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0001bb90: 7261 6e67 6528 6c65 6e28 7061 726e 616d  range(len(parnam
-0001bba0: 6573 292d 312c 202d 312c 202d 3129 3a20  es)-1, -1, -1): 
-0001bbb0: 2320 7374 6172 7420 6672 6f6d 206c 6172  # start from lar
-0001bbc0: 6765 7374 2069 6e64 6578 2061 6e64 2077  gest index and w
-0001bbd0: 6f72 6b20 6261 636b 0a20 2020 2020 2020  ork back.       
-0001bbe0: 2020 2069 6620 7365 6c66 2e66 6978 6564     if self.fixed
-0001bbf0: 5061 7273 5b69 5d3a 0a20 2020 2020 2020  Pars[i]:.       
-0001bc00: 2020 2020 2063 6f76 203d 206e 702e 6465       cov = np.de
-0001bc10: 6c65 7465 286e 702e 6465 6c65 7465 2863  lete(np.delete(c
-0001bc20: 6f76 2c20 692c 2030 2029 2c20 692c 2031  ov, i, 0 ), i, 1
-0001bc30: 290a 2020 2020 6e70 6172 3d6c 656e 2870  ).    npar=len(p
-0001bc40: 6172 6e61 6d65 7329 2020 2020 2020 2020  arnames)        
-0001bc50: 2020 2020 2023 206e 756d 6265 7220 6f66       # number of
-0001bc60: 2070 6172 616d 6574 6572 730a 0a20 2020   parameters..   
-0001bc70: 2069 6620 7365 6c66 2e6d 696e 6f73 5265   if self.minosRe
-0001bc80: 7375 6c74 2069 7320 6e6f 7420 4e6f 6e65  sult is not None
-0001bc90: 2061 6e64 2073 656c 662e 6d69 6e6f 735f   and self.minos_
-0001bca0: 6f6b 3a0a 2020 2020 2020 706d 6572 7273  ok:.      pmerrs
-0001bcb0: 203d 205b 5d20 0a20 2020 2023 2020 7072   = [] .    #  pr
-0001bcc0: 696e 7428 224d 494e 4f53 2065 7272 6f72  int("MINOS error
-0001bcd0: 733a 2229 0a20 2020 2020 2069 6620 7365  s:").      if se
-0001bce0: 6c66 2e69 6d69 6e75 6974 5f76 6572 7369  lf.iminuit_versi
-0001bcf0: 6f6e 203c 2027 3227 3a0a 2020 2020 2020  on < '2':.      
-0001bd00: 2020 666f 7220 706e 616d 2069 6e20 6d2e    for pnam in m.
-0001bd10: 6d65 7272 6f72 732e 6b65 7973 2829 3a0a  merrors.keys():.
-0001bd20: 2020 2020 2020 2020 2020 706d 6572 7273            pmerrs
-0001bd30: 2e61 7070 656e 6428 5b6d 2e6d 6572 726f  .append([m.merro
-0001bd40: 7273 5b70 6e61 6d5d 5b32 5d2c 206d 2e6d  rs[pnam][2], m.m
-0001bd50: 6572 726f 7273 5b70 6e61 6d5d 5b33 5d5d  errors[pnam][3]]
-0001bd60: 290a 2020 2020 2020 656c 7365 3a0a 2020  ).      else:.  
-0001bd70: 2020 2020 2020 666f 7220 706e 616d 2069        for pnam i
-0001bd80: 6e20 6d2e 6d65 7272 6f72 732e 6b65 7973  n m.merrors.keys
-0001bd90: 2829 3a0a 2020 2020 2020 2020 2020 706d  ():.          pm
-0001bda0: 6572 7273 2e61 7070 656e 6428 5b6d 2e6d  errs.append([m.m
-0001bdb0: 6572 726f 7273 5b70 6e61 6d5d 2e6c 6f77  errors[pnam].low
-0001bdc0: 6572 2c20 6d2e 6d65 7272 6f72 735b 706e  er, m.merrors[pn
-0001bdd0: 616d 5d2e 7570 7065 725d 290a 2020 2020  am].upper]).    
-0001bde0: 2020 7365 6c66 2e4f 6e65 5369 6749 6e74    self.OneSigInt
-0001bdf0: 6572 7661 6c3d 6e70 2e61 7272 6179 2870  erval=np.array(p
-0001be00: 6d65 7272 7329 0a20 2020 2065 6c73 653a  merrs).    else:
-0001be10: 0a20 2020 2020 2073 656c 662e 4f6e 6553  .      self.OneS
-0001be20: 6967 496e 7465 7276 616c 203d 206e 702e  igInterval = np.
-0001be30: 6172 7261 7928 6c69 7374 287a 6970 282d  array(list(zip(-
-0001be40: 7061 7265 7272 732c 2070 6172 6572 7273  parerrs, parerrs
-0001be50: 2929 290a 0a20 2020 2023 2066 696e 616c  )))..    # final
-0001be60: 2063 616c 6c20 6f66 2063 6f73 7420 6675   call of cost fu
-0001be70: 6e63 7469 6f6e 2061 7420 6d69 6d69 6e75  nction at miminu
-0001be80: 6d20 746f 2075 7064 6174 6520 616c 6c20  m to update all 
-0001be90: 7265 7375 6c74 730a 2020 2020 2320 2d20  results.    # - 
-0001bea0: 2073 6967 6e61 6c73 2064 6174 6120 6f62   signals data ob
-0001beb0: 6a65 6374 2074 6f20 7374 6f72 6520 6d6f  ject to store mo
-0001bec0: 6465 6c2d 6465 6e64 656e 7420 756e 6365  del-dendent unce
-0001bed0: 7274 6169 6e74 6965 730a 2020 2020 6966  rtainties.    if
-0001bee0: 2073 656c 662e 6461 7461 2069 7320 6e6f   self.data is no
-0001bef0: 7420 4e6f 6e65 3a20 7365 6c66 2e64 6174  t None: self.dat
-0001bf00: 612e 6669 6e61 6c5f 6361 6c6c 3d54 7275  a.final_call=Tru
-0001bf10: 650a 2020 2020 2320 2d20 2061 6e64 2063  e.    # -  and c
-0001bf20: 6f73 7420 6675 6e63 7469 6f6e 2074 6f20  ost function to 
-0001bf30: 7374 6f72 6520 676f 6f64 6e65 7373 2d6f  store goodness-o
-0001bf40: 662d 6669 740a 2020 2020 7365 6c66 2e63  f-fit.    self.c
-0001bf50: 6f73 7466 2e66 696e 616c 5f63 616c 6c3d  ostf.final_call=
-0001bf60: 5472 7565 0a20 2020 2066 7661 6c20 3d20  True.    fval = 
-0001bf70: 7365 6c66 2e63 6f73 7466 282a 7061 7276  self.costf(*parv
-0001bf80: 616c 7329 200a 2020 0a20 2020 2023 2073  als) .  .    # s
-0001bf90: 746f 7265 2072 6573 756c 7473 2061 7320  tore results as 
-0001bfa0: 636c 6173 7320 6d65 6d62 6572 730a 2020  class members.  
-0001bfb0: 2020 2320 2020 7061 7261 6d65 7465 7220    #   parameter 
-0001bfc0: 6e61 6d65 730a 2020 2020 7365 6c66 2e50  names.    self.P
-0001bfd0: 6172 616d 6574 6572 4e61 6d65 7320 3d20  arameterNames = 
-0001bfe0: 7061 726e 616d 6573 0a20 2020 2023 202a  parnames.    # *
-0001bff0: 2066 6c61 6720 666f 7220 6669 7865 6420   flag for fixed 
-0001c000: 7061 7261 6d65 7465 7273 2069 6e20 7365  parameters in se
-0001c010: 6c66 2e66 6978 6564 5061 7273 0a20 2020  lf.fixedPars.   
-0001c020: 2023 202a 206e 616d 6573 206f 6620 6672   # * names of fr
-0001c030: 6565 2070 6172 616d 6574 6572 7320 696e  ee parameters in
-0001c040: 2073 656c 662e 6672 6565 5061 724e 616d   self.freeParNam
-0001c050: 730a 2020 2020 2320 2020 6368 6932 2061  s.    #   chi2 a
-0001c060: 7420 6265 7374 2d66 6974 2070 6f69 6e74  t best-fit point
-0001c070: 2028 706f 7373 6962 6c79 2064 6966 6665   (possibly diffe
-0001c080: 7265 6e74 2066 726f 6d20 6d69 6e43 6f73  rent from minCos
-0001c090: 7429 0a20 2020 2073 656c 662e 476f 4620  t).    self.GoF 
-0001c0a0: 3d20 7365 6c66 2e63 6f73 7466 2e67 6f66  = self.costf.gof
-0001c0b0: 2020 0a20 2020 2023 2020 2070 6172 616d    .    #   param
-0001c0c0: 6574 6572 2076 616c 7565 7320 6174 2062  eter values at b
-0001c0d0: 6573 742d 6669 7420 706f 696e 740a 2020  est-fit point.  
-0001c0e0: 2020 7365 6c66 2e50 6172 616d 6574 6572    self.Parameter
-0001c0f0: 5661 6c75 6573 203d 206e 702e 6172 7261  Values = np.arra
-0001c100: 7928 7061 7276 616c 732c 2063 6f70 793d  y(parvals, copy=
-0001c110: 5472 7565 290a 2020 2020 7365 6c66 2e66  True).    self.f
-0001c120: 7265 6550 6172 5661 6c73 203d 206e 702e  reeParVals = np.
-0001c130: 6172 7261 7928 0a20 2020 2020 205b 2070  array(.      [ p
-0001c140: 6172 7661 6c73 5b69 5d20 666f 7220 6920  arvals[i] for i 
-0001c150: 696e 2072 616e 6765 286e 7061 7229 2069  in range(npar) i
-0001c160: 6620 6e6f 7420 7365 6c66 2e66 6978 6564  f not self.fixed
-0001c170: 5061 7273 5b69 5d20 5d29 0a20 2020 2073  Pars[i] ]).    s
-0001c180: 656c 662e 6672 6565 5061 7245 7272 7320  elf.freeParErrs 
-0001c190: 3d20 6e70 2e61 7272 6179 280a 2020 2020  = np.array(.    
-0001c1a0: 2020 5b20 7061 7265 7272 735b 695d 2066    [ parerrs[i] f
-0001c1b0: 6f72 2069 2069 6e20 7261 6e67 6528 6e70  or i in range(np
-0001c1c0: 6172 2920 6966 206e 6f74 2073 656c 662e  ar) if not self.
-0001c1d0: 6669 7865 6450 6172 735b 695d 205d 290a  fixedPars[i] ]).
-0001c1e0: 2020 2020 2320 6669 7865 6420 7061 7261      # fixed para
-0001c1f0: 6d65 7465 7220 6e61 6d65 7320 616e 6420  meter names and 
-0001c200: 7661 6c75 6573 0a20 2020 2073 656c 662e  values.    self.
-0001c210: 6669 7865 6450 6172 5661 6c73 203d 206e  fixedParVals = n
-0001c220: 702e 6172 7261 7928 0a20 2020 2020 205b  p.array(.      [
-0001c230: 2070 6172 7661 6c73 5b69 5d20 666f 7220   parvals[i] for 
-0001c240: 6920 696e 2072 616e 6765 286e 7061 7229  i in range(npar)
-0001c250: 2069 6620 7365 6c66 2e66 6978 6564 5061   if self.fixedPa
-0001c260: 7273 5b69 5d20 5d29 0a20 2020 2023 202a  rs[i] ]).    # *
-0001c270: 206e 616d 6573 206f 6620 6669 7865 6420   names of fixed 
-0001c280: 7061 7261 6d65 7465 7273 2069 6e20 7365  parameters in se
-0001c290: 6c66 2e66 6978 6564 5061 724e 616d 730a  lf.fixedParNams.
-0001c2a0: 2020 2020 2320 2020 6e75 6d62 6572 206f      #   number o
-0001c2b0: 6620 6465 6772 6565 7320 6f66 2066 7265  f degrees of fre
-0001c2c0: 6564 6f6d 0a20 2020 2073 656c 662e 4e44  edom.    self.ND
-0001c2d0: 6f46 203d 206e 646f 6620 200a 2020 2020  oF = ndof  .    
-0001c2e0: 2320 2020 7379 6d6d 6574 7269 6320 756e  #   symmetric un
-0001c2f0: 6365 7274 6169 6e74 6965 730a 2020 2020  certainties.    
-0001c300: 7365 6c66 2e4d 6967 7261 6445 7272 6f72  self.MigradError
-0001c310: 7320 3d20 6e70 2e61 7272 6179 2870 6172  s = np.array(par
-0001c320: 6572 7273 2c20 636f 7079 3d54 7275 6529  errs, copy=True)
-0001c330: 0a20 2020 2023 2020 2063 6f76 6172 6961  .    #   covaria
-0001c340: 6e63 6520 616e 6420 636f 7272 656c 6174  nce and correlat
-0001c350: 696f 6e20 6d61 7472 6963 6573 0a20 2020  ion matrices.   
-0001c360: 2073 656c 662e 436f 7661 7269 616e 6365   self.Covariance
-0001c370: 4d61 7472 6978 203d 206e 702e 6172 7261  Matrix = np.arra
-0001c380: 7928 636f 762c 2063 6f70 793d 5472 7565  y(cov, copy=True
-0001c390: 290a 2020 2020 7065 7272 7320 3d20 6e70  ).    perrs = np
-0001c3a0: 2e73 7172 7428 6e70 2e64 6961 676f 6e61  .sqrt(np.diagona
-0001c3b0: 6c28 636f 7629 290a 2020 2020 7365 6c66  l(cov)).    self
-0001c3c0: 2e43 6f72 7265 6c61 7469 6f6e 4d61 7472  .CorrelationMatr
-0001c3d0: 6978 203d 2063 6f76 2f6e 702e 6f75 7465  ix = cov/np.oute
-0001c3e0: 7228 7065 7272 732c 2070 6572 7273 290a  r(perrs, perrs).
-0001c3f0: 2020 2020 2320 2020 312d 7369 676d 6120      #   1-sigma 
-0001c400: 2836 3825 2043 4c29 2072 616e 6765 2069  (68% CL) range i
-0001c410: 6e20 7365 6c66 2e4f 6e65 5369 6749 6e74  n self.OneSigInt
-0001c420: 6572 7661 6c0a 0a20 2020 2023 2062 7569  erval..    # bui
-0001c430: 6c64 2061 2063 6f6e 7665 6e69 656e 7420  ld a convenient 
-0001c440: 7265 7375 6c74 2064 6963 7469 6f6e 6172  result dictionar
-0001c450: 790a 2020 2020 6966 2073 656c 662e 6e66  y.    if self.nf
-0001c460: 6978 6564 203d 3d30 3a0a 2020 2020 2020  ixed ==0:.      
-0001c470: 7274 7570 6c65 203d 2028 7365 6c66 2e50  rtuple = (self.P
-0001c480: 6172 616d 6574 6572 5661 6c75 6573 2c0a  arameterValues,.
-0001c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4a0: 7365 6c66 2e4f 6e65 5369 6749 6e74 6572  self.OneSigInter
-0001c4b0: 7661 6c2c 0a20 2020 2020 2020 2020 2020  val,.           
-0001c4c0: 2020 2020 2073 656c 662e 436f 7272 656c       self.Correl
-0001c4d0: 6174 696f 6e4d 6174 7269 782c 0a20 2020  ationMatrix,.   
+00019ba0: 2020 2066 6967 7369 7a65 3d28 372e 352c     figsize=(7.5,
+00019bb0: 2036 2e35 292c 2020 2020 2020 2020 2020   6.5),          
+00019bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019bd0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00019be0: 2020 2020 2020 2064 6174 615f 6c61 6265         data_labe
+00019bf0: 6c3d 2744 6174 6127 2c0a 2020 2020 2020  l='Data',.      
+00019c00: 2020 2020 2020 2020 2020 2020 2070 6c6f               plo
+00019c10: 745f 7265 7369 6475 616c 3d46 616c 7365  t_residual=False
+00019c20: 293a 0a20 2020 2020 2022 2222 7265 7475  ):.      """retu
+00019c30: 726e 2066 6967 7572 6520 7769 7468 2068  rn figure with h
+00019c40: 6973 746f 6772 616d 2064 6174 6120 616e  istogram data an
+00019c50: 6420 756e 6365 7274 6169 6e74 6965 730a  d uncertainties.
+00019c60: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00019c70: 2066 6967 203d 2070 6c74 2e66 6967 7572   fig = plt.figur
+00019c80: 6528 6e75 6d3d 6e75 6d2c 2066 6967 7369  e(num=num, figsi
+00019c90: 7a65 3d66 6967 7369 7a65 290a 0a20 2020  ze=figsize)..   
+00019ca0: 2020 2069 6620 706c 6f74 5f72 6573 6964     if plot_resid
+00019cb0: 7561 6c3a 0a20 2020 2020 2020 2070 7269  ual:.        pri
+00019cc0: 6e74 2827 2021 2121 206d 6e46 6974 2e6d  nt(' !!! mnFit.m
+00019cd0: 6c44 6174 612e 706c 6f74 3a20 706c 6f74  lData.plot: plot
+00019ce0: 7469 6e67 2072 6573 6964 7561 6c73 206e  ting residuals n
+00019cf0: 6f74 2070 6f73 7369 626c 6520 666f 7220  ot possible for 
+00019d00: 7573 6572 204d 4c20 6669 7427 290a 2020  user ML fit').  
+00019d10: 2020 2020 2020 0a20 2020 2020 2069 6620        .      if 
+00019d20: 7365 6c66 2e78 2069 7320 4e6f 6e65 3a0a  self.x is None:.
+00019d30: 2020 2020 2020 2020 7072 696e 7428 2720          print(' 
+00019d40: 2121 2120 6d6e 4669 742e 6d6c 4461 7461  !!! mnFit.mlData
+00019d50: 2e70 6c6f 743a 206e 6f20 6461 7461 206f  .plot: no data o
+00019d60: 626a 6563 7420 6465 6669 6e65 6427 290a  bject defined').
+00019d70: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00019d80: 6967 0a20 2020 2020 200a 2020 2020 2020  ig.      .      
+00019d90: 6d6e 203d 206d 696e 2873 656c 662e 7829  mn = min(self.x)
+00019da0: 0a20 2020 2020 206d 7820 3d20 6d61 7828  .      mx = max(
+00019db0: 7365 6c66 2e78 290a 2020 2020 2020 796d  self.x).      ym
+00019dc0: 6e20 3d20 302e 0a20 2020 2020 2079 6d78  n = 0..      ymx
+00019dd0: 203d 2030 2e32 352f 286d 782d 6d6e 290a   = 0.25/(mx-mn).
+00019de0: 2020 2020 2020 706c 742e 766c 696e 6573        plt.vlines
+00019df0: 2873 656c 662e 782c 2079 6d6e 2c20 796d  (self.x, ymn, ym
+00019e00: 782c 206c 773d 312c 2063 6f6c 6f72 3d27  x, lw=1, color='
+00019e10: 6772 6579 272c 2061 6c70 6861 3d30 2e35  grey', alpha=0.5
+00019e20: 2c20 6c61 6265 6c3d 6461 7461 5f6c 6162  , label=data_lab
+00019e30: 656c 290a 2020 2020 2020 0a20 2020 2020  el).      .     
+00019e40: 2072 6574 7572 6e20 6669 670a 0a20 2020   return fig..   
+00019e50: 2020 200a 2020 2320 2d2d 2d20 636c 6173     .  # --- clas
+00019e60: 7320 656e 6361 7073 756c 6174 696e 6720  s encapsulating 
+00019e70: 7573 6572 2d64 6566 696e 6564 2063 6f73  user-defined cos
+00019e80: 7420 6675 6e63 7469 6f6e 0a20 2063 6c61  t function.  cla
+00019e90: 7373 206d 6e43 6f73 743a 0a20 2020 2022  ss mnCost:.    "
+00019ea0: 2222 0a20 2020 2049 6e74 6572 6661 6365  "".    Interface
+00019eb0: 2066 6f72 2073 696d 706c 6520 6d69 6e75   for simple minu
+00019ec0: 6974 2066 6974 2077 6974 6820 7573 6572  it fit with user
+00019ed0: 2d73 7570 706c 6965 6420 636f 7374 2066  -supplied cost f
+00019ee0: 756e 6374 696f 6e2e 0a0a 2020 2020 5468  unction...    Th
+00019ef0: 6520 5f5f 6361 6c6c 5f5f 206d 6574 686f  e __call__ metho
+00019f00: 6420 6f66 2074 6869 7320 636c 6173 7320  d of this class 
+00019f10: 6973 2063 616c 6c65 6420 6279 2069 6d69  is called by imi
+00019f20: 6e75 6974 2e0a 0a20 2020 2041 7267 733a  nuit...    Args:
+00019f30: 0a0a 2020 2020 2020 2d20 7573 6572 436f  ..      - userCo
+00019f40: 7374 4675 6e63 7469 6f6e 3a20 7573 6572  stFunction: user
+00019f50: 2d73 7570 706c 6965 6420 636f 7374 2066  -supplied cost f
+00019f60: 756e 6374 696f 6e20 666f 7220 6d69 6e75  unction for minu
+00019f70: 6974 3b0a 2020 2020 2020 2020 206d 7573  it;.         mus
+00019f80: 7420 6265 2061 206e 6567 6174 6976 6520  t be a negative 
+00019f90: 6c6f 672d 6c69 6b65 6c69 686f 6f64 200a  log-likelihood .
+00019fa0: 2020 2020 2222 220a 2020 2020 0a20 2020      """.    .   
+00019fb0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00019fc0: 6c66 2c20 6f75 7465 722c 200a 2020 2020  lf, outer, .    
+00019fd0: 2020 2020 2020 2020 2020 2020 2075 7365               use
+00019fe0: 7246 756e 6374 696f 6e29 3a0a 0a20 2020  rFunction):..   
+00019ff0: 2020 2073 656c 662e 7175 6965 7420 3d20     self.quiet = 
+0001a000: 6f75 7465 722e 7175 6965 740a 2020 2020  outer.quiet.    
+0001a010: 2020 7365 6c66 2e64 6174 6120 3d20 6f75    self.data = ou
+0001a020: 7465 722e 6461 7461 0a20 2020 2020 2069  ter.data.      i
+0001a030: 6620 7365 6c66 2e64 6174 6120 6973 204e  f self.data is N
+0001a040: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
+0001a050: 662e 636f 7374 203d 2075 7365 7246 756e  f.cost = userFun
+0001a060: 6374 696f 6e0a 2020 2020 2020 2020 6966  ction.        if
+0001a070: 206e 6f74 2073 656c 662e 7175 6965 743a   not self.quiet:
+0001a080: 0a20 2020 2020 2020 2020 2070 7269 6e74  .          print
+0001a090: 2822 2a3d 3d2a 206d 6e46 6974 2e6d 6e43  ("*==* mnFit.mnC
+0001a0a0: 6f73 743a 2066 6974 2077 6974 6820 7573  ost: fit with us
+0001a0b0: 6572 2d73 7570 706c 6965 6420 636f 7374  er-supplied cost
+0001a0c0: 2066 756e 6374 696f 6e27 2229 2020 2020   function'")    
+0001a0d0: 2020 2020 2020 0a20 2020 2020 2065 6c73        .      els
+0001a0e0: 653a 0a20 2020 2020 2020 2069 6620 6e6f  e:.        if no
+0001a0f0: 7420 6973 696e 7374 616e 6365 2873 656c  t isinstance(sel
+0001a100: 662e 6461 7461 2c20 6d6e 4669 742e 6d6c  f.data, mnFit.ml
+0001a110: 4461 7461 436f 6e74 6169 6e65 7229 3a0a  DataContainer):.
+0001a120: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001a130: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+0001a140: 2020 2020 2020 2020 2220 2121 2120 6d6e          " !!! mn
+0001a150: 4669 742e 6d6e 436f 7374 3a20 6578 7065  Fit.mnCost: expe
+0001a160: 6374 696e 6720 6461 7461 2063 6f6e 7461  cting data conta
+0001a170: 696e 6572 206f 6620 7479 7065 2027 6d6c  iner of type 'ml
+0001a180: 4461 7461 436f 6e74 6169 6e65 7227 2229  DataContainer'")
+0001a190: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
+0001a1a0: 6465 6c20 3d20 7573 6572 4675 6e63 7469  del = userFuncti
+0001a1b0: 6f6e 0a20 2020 2020 2020 2073 656c 662e  on.        self.
+0001a1c0: 636f 7374 203d 2073 656c 662e 6e6c 4c63  cost = self.nlLc
+0001a1d0: 6f73 740a 2020 2020 2020 2020 6966 206e  ost.        if n
+0001a1e0: 6f74 2073 656c 662e 7175 6965 743a 0a20  ot self.quiet:. 
+0001a1f0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+0001a200: 2a3d 3d2a 206d 6e46 6974 2e6d 6e43 6f73  *==* mnFit.mnCos
+0001a210: 743a 206e 6567 4c6f 674c 2066 6974 2077  t: negLogL fit w
+0001a220: 6974 6820 7573 6572 2d64 6566 696e 6564  ith user-defined
+0001a230: 2064 656e 7369 7479 2066 756e 6374 696f   density functio
+0001a240: 6e27 2229 2020 2020 2020 2020 2020 0a0a  n'")          ..
+0001a250: 2020 2020 2020 2320 7461 6b65 2061 6363        # take acc
+0001a260: 6f75 6e74 206f 6620 706f 7373 6962 6c65  ount of possible
+0001a270: 2070 6172 616d 6574 6572 2063 6f6e 7374   parameter const
+0001a280: 7261 696e 7473 0a20 2020 2020 2073 656c  raints.      sel
+0001a290: 662e 636f 6e73 7472 6169 6e74 7320 3d20  f.constraints = 
+0001a2a0: 6f75 7465 722e 636f 6e73 7472 6169 6e74  outer.constraint
+0001a2b0: 730a 2020 2020 2020 7365 6c66 2e6e 636f  s.      self.nco
+0001a2c0: 6e73 7472 6169 6e74 7320 3d20 6c65 6e28  nstraints = len(
+0001a2d0: 7365 6c66 2e63 6f6e 7374 7261 696e 7473  self.constraints
+0001a2e0: 290a 2020 2020 2020 7365 6c66 2e45 7272  ).      self.Err
+0001a2f0: 4465 6620 3d20 6f75 7465 722e 4572 7244  Def = outer.ErrD
+0001a300: 6566 0a20 2020 2020 2073 656c 662e 7366  ef.      self.sf
+0001a310: 5f6c 4c20 3d20 2d32 2e2a 7365 6c66 2e45  _lL = -2.*self.E
+0001a320: 7272 4465 660a 2020 2020 2020 0a20 2020  rrDef.      .   
+0001a330: 2020 2023 2073 6574 2070 726f 7065 7220     # set proper 
+0001a340: 7369 676e 6174 7572 6520 6f66 206d 6f64  signature of mod
+0001a350: 656c 2066 756e 6374 696f 6e20 666f 7220  el function for 
+0001a360: 696d 696e 7569 740a 2020 2020 2020 7365  iminuit.      se
+0001a370: 6c66 2e70 6e61 6d73 203d 206f 7574 6572  lf.pnams = outer
+0001a380: 2e70 6e61 6d73 0a20 2020 2020 2073 656c  .pnams.      sel
+0001a390: 662e 6e70 6172 203d 206f 7574 6572 2e6e  f.npar = outer.n
+0001a3a0: 7061 720a 0a20 2020 2020 2023 2066 6f72  par..      # for
+0001a3b0: 2074 6869 7320 6b69 6e64 206f 6620 6669   this kind of fi
+0001a3c0: 742c 2073 6f6d 6520 696e 7075 7420 616e  t, some input an
+0001a3d0: 6420 6f75 7075 7420 7175 616e 7469 7469  d ouput quantiti
+0001a3e0: 6573 2061 7265 206e 6f74 206b 6e6f 776e  es are not known
+0001a3f0: 0a20 2020 2020 2073 656c 662e 676f 6620  .      self.gof 
+0001a400: 3d20 4e6f 6e65 0a20 2020 2020 2073 656c  = None.      sel
+0001a410: 662e 6e64 6f66 203d 204e 6f6e 650a 2020  f.ndof = None.  
+0001a420: 2020 2020 0a20 2020 2064 6566 205f 5f63      .    def __c
+0001a430: 616c 6c5f 5f28 7365 6c66 2c20 2a70 6172  all__(self, *par
+0001a440: 293a 0a20 2020 2020 2063 6f73 7420 3d20  ):.      cost = 
+0001a450: 302e 0a20 2020 2020 2023 2061 6464 2063  0..      # add c
+0001a460: 6f6e 7374 7261 696e 7473 2074 6f20 636f  onstraints to co
+0001a470: 7374 0a20 2020 2020 2069 6620 7365 6c66  st.      if self
+0001a480: 2e6e 636f 6e73 7472 6169 6e74 733a 0a20  .nconstraints:. 
+0001a490: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
+0001a4a0: 7365 6c66 2e63 6f6e 7374 7261 696e 7473  self.constraints
+0001a4b0: 3a0a 2020 2020 2020 2020 2020 705f 6964  :.          p_id
+0001a4c0: 203d 2063 5b30 5d0a 2020 2020 2020 2020   = c[0].        
+0001a4d0: 2020 7220 3d20 2820 7061 725b 705f 6964    r = ( par[p_id
+0001a4e0: 5d20 2d20 635b 315d 2920 2f20 635b 325d  ] - c[1]) / c[2]
+0001a4f0: 200a 2020 2020 2020 2020 2020 636f 7374   .          cost
+0001a500: 202b 3d20 722a 720a 2020 2020 2020 2020   += r*r.        
+0001a510: 636f 7374 202a 3d20 7365 6c66 2e45 7272  cost *= self.Err
+0001a520: 4465 6620 0a20 2020 2020 2023 2063 616c  Def .      # cal
+0001a530: 6c65 6420 6974 6572 6174 6976 656c 7920  led iteratively 
+0001a540: 6279 206d 696e 7569 740a 2020 2020 2020  by minuit.      
+0001a550: 7265 7475 726e 2063 6f73 7420 2b20 7365  return cost + se
+0001a560: 6c66 2e63 6f73 7428 2a70 6172 290a 0a20  lf.cost(*par).. 
+0001a570: 2020 2064 6566 206e 6c4c 636f 7374 2873     def nlLcost(s
+0001a580: 656c 662c 202a 7061 7229 3a0a 2020 2020  elf, *par):.    
+0001a590: 2020 2222 226e 6567 6174 6976 6520 6c6f    """negative lo
+0001a5a0: 6720 6c69 6b65 6c69 686f 6f64 206f 6620  g likelihood of 
+0001a5b0: 6461 7461 2061 6e64 2075 7365 722d 6465  data and user-de
+0001a5c0: 6669 6e65 6420 5044 4620 616e 6420 0a20  fined PDF and . 
+0001a5d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001a5e0: 2320 6368 6563 6b20 6966 2050 4446 2069  # check if PDF i
+0001a5f0: 7320 6e6f 6d61 6c69 7a65 6420 746f 2031  s nomalized to 1
+0001a600: 0a20 2020 2020 2020 2320 2e2e 2e0a 0a20  .       # ..... 
+0001a610: 2020 2020 206c 4c3d 206e 702e 7375 6d28       lL= np.sum(
+0001a620: 206e 702e 6c6f 6728 2073 656c 662e 6d6f   np.log( self.mo
+0001a630: 6465 6c28 7365 6c66 2e64 6174 612e 782c  del(self.data.x,
+0001a640: 202a 7061 7229 2029 2029 0a20 2020 2020   *par) ) ).     
+0001a650: 2072 6574 7572 6e20 7365 6c66 2e73 665f   return self.sf_
+0001a660: 6c4c 202a 206c 4c0a 2020 2020 2020 2020  lL * lL.        
+0001a670: 0a20 2320 2d2d 2d20 656e 6420 6465 6669  . # --- end defi
+0001a680: 6e69 7469 6f6e 206f 6620 636c 6173 7320  nition of class 
+0001a690: 6d6e 436f 7374 202d 2d2d 2d0a 0a20 230a  mnCost ----.. #.
+0001a6a0: 2023 202d 2d2d 2063 6f6d 6d6f 6e20 636f   # --- common co
+0001a6b0: 6465 2066 6f72 2061 6c6c 2066 6974 2074  de for all fit t
+0001a6c0: 7970 6573 0a20 230a 0a20 2064 6566 205f  ypes. #..  def _
+0001a6d0: 7365 7475 7046 6974 5061 7261 6d65 7465  setupFitParamete
+0001a6e0: 7273 2873 656c 662c 206d 6f64 656c 5f6b  rs(self, model_k
+0001a6f0: 7761 7267 732c 2070 302c 2064 7030 2c20  wargs, p0, dp0, 
+0001a700: 636f 6e73 7472 6169 6e74 732c 2066 6978  constraints, fix
+0001a710: 5061 7273 2c20 6c69 6d69 7473 293a 0a20  Pars, limits):. 
+0001a720: 2020 2022 2222 7365 7420 7570 2070 6172     """set up par
+0001a730: 616d 6574 6572 7320 6e65 6564 6564 2066  ameters needed f
+0001a740: 6f72 204d 696e 7569 7420 616e 6420 636f  or Minuit and co
+0001a750: 7374 2066 756e 6374 696f 6e0a 2020 2020  st function.    
+0001a760: 2222 220a 0a20 2020 2023 2067 6574 2070  """..    # get p
+0001a770: 6172 616d 6574 6572 206e 616d 6573 2066  arameter names f
+0001a780: 726f 6d20 6b77 6172 6773 206f 6620 6d6f  rom kwargs of mo
+0001a790: 6465 6c20 6675 6e63 7469 6f6e 0a20 2020  del function.   
+0001a7a0: 2073 656c 662e 706e 616d 7320 3d20 6c69   self.pnams = li
+0001a7b0: 7374 2e63 6f70 7928 6c69 7374 286d 6f64  st.copy(list(mod
+0001a7c0: 656c 5f6b 7761 7267 732e 6b65 7973 2829  el_kwargs.keys()
+0001a7d0: 2929 0a20 2020 2073 656c 662e 6e70 6172  )).    self.npar
+0001a7e0: 203d 206c 656e 2873 656c 662e 706e 616d   = len(self.pnam
+0001a7f0: 7329 0a20 2020 2023 2064 6963 7469 6f6e  s).    # diction
+0001a800: 6172 7920 6173 7369 676e 696e 6720 7061  ary assigning pa
+0001a810: 7261 6d65 7465 7220 6e61 6d65 2074 6f20  rameter name to 
+0001a820: 696e 6465 780a 2020 2020 7365 6c66 2e70  index.    self.p
+0001a830: 6e61 6d32 6964 203d 207b 0a20 2020 2020  nam2id = {.     
+0001a840: 2073 656c 662e 706e 616d 735b 695d 203a   self.pnams[i] :
+0001a850: 2069 2066 6f72 2069 2069 6e20 7261 6e67   i for i in rang
+0001a860: 6528 302c 7365 6c66 2e6e 7061 7229 207d  e(0,self.npar) }
+0001a870: 200a 0a20 2020 2023 2070 726f 6365 7373   ..    # process
+0001a880: 2061 6e64 2073 746f 7265 2070 6172 616d   and store param
+0001a890: 6574 6572 2063 6f6e 7374 7261 696e 7473  eter constraints
+0001a8a0: 2028 7573 6564 2069 6e20 636f 7374 2066   (used in cost f
+0001a8b0: 756e 6374 696f 6e29 0a20 2020 2073 656c  unction).    sel
+0001a8c0: 662e 7365 7443 6f6e 7374 7261 696e 7473  f.setConstraints
+0001a8d0: 203d 2063 6f6e 7374 7261 696e 7473 2020   = constraints  
+0001a8e0: 2020 0a20 2020 2073 656c 662e 636f 6e73    .    self.cons
+0001a8f0: 7472 6169 6e74 7320 3d20 5b5d 0a20 2020  traints = [].   
+0001a900: 2069 6620 636f 6e73 7472 6169 6e74 7320   if constraints 
+0001a910: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0001a920: 2020 2069 6620 6c65 6e28 6e70 2e73 6861     if len(np.sha
+0001a930: 7065 2863 6f6e 7374 7261 696e 7473 2929  pe(constraints))
+0001a940: 3d3d 323a 0a20 2020 2020 2020 2066 6f72  ==2:.        for
+0001a950: 2063 2069 6e20 636f 6e73 7472 6169 6e74   c in constraint
+0001a960: 733a 0a20 2020 2020 2020 2020 2023 206e  s:.          # n
+0001a970: 616d 6520 746f 2070 6172 616d 6574 6572  ame to parameter
+0001a980: 2069 640a 2020 2020 2020 2020 2020 6966   id.          if
+0001a990: 2074 7970 6528 635b 305d 293d 3d74 7970   type(c[0])==typ
+0001a9a0: 6528 2720 2729 3a0a 2020 2020 2020 2020  e(' '):.        
+0001a9b0: 2020 2020 635b 305d 203d 2073 656c 662e      c[0] = self.
+0001a9c0: 706e 616d 3269 645b 635b 305d 5d0a 2020  pnam2id[c[0]].  
+0001a9d0: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+0001a9e0: 7374 7261 696e 7473 2e61 7070 656e 6428  straints.append(
+0001a9f0: 6329 0a20 2020 2020 2065 6c73 653a 0a20  c).      else:. 
+0001aa00: 2020 2020 2020 2023 206e 616d 6520 746f         # name to
+0001aa10: 2070 6172 616d 6574 6572 2069 640a 2020   parameter id.  
+0001aa20: 2020 2020 2020 6966 2074 7970 6528 636f        if type(co
+0001aa30: 6e73 7472 6169 6e74 735b 305d 293d 3d74  nstraints[0])==t
+0001aa40: 7970 6528 2720 2729 3a0a 2020 2020 2020  ype(' '):.      
+0001aa50: 2020 2020 636f 6e73 7472 6169 6e74 735b      constraints[
+0001aa60: 305d 203d 2073 656c 662e 706e 616d 3269  0] = self.pnam2i
+0001aa70: 645b 636f 6e73 7472 6169 6e74 735b 305d  d[constraints[0]
+0001aa80: 5d0a 2020 2020 2020 2020 7365 6c66 2e63  ].        self.c
+0001aa90: 6f6e 7374 7261 696e 7473 2e61 7070 656e  onstraints.appen
+0001aaa0: 6428 636f 6e73 7472 6169 6e74 7329 0a20  d(constraints). 
+0001aab0: 2020 2073 656c 662e 6e63 6f6e 7374 7261     self.nconstra
+0001aac0: 696e 7473 203d 206c 656e 2873 656c 662e  ints = len(self.
+0001aad0: 636f 6e73 7472 6169 6e74 7329 0a0a 2020  constraints)..  
+0001aae0: 2020 2320 7365 7420 696e 6974 6961 6c20    # set initial 
+0001aaf0: 7061 7261 6d65 7465 7273 2066 6f72 2066  parameters for f
+0001ab00: 6974 2028 7573 6564 2062 7920 6d69 6e75  it (used by minu
+0001ab10: 6974 2920 0a20 2020 2069 6620 7030 2069  it) .    if p0 i
+0001ab20: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0001ab30: 2020 666f 7220 692c 2070 6e61 6d20 696e    for i, pnam in
+0001ab40: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
+0001ab50: 706e 616d 7329 3a0a 2020 2020 2020 2020  pnams):.        
+0001ab60: 6d6f 6465 6c5f 6b77 6172 6773 5b70 6e61  model_kwargs[pna
+0001ab70: 6d5d 203d 2070 305b 695d 2020 2020 0a0a  m] = p0[i]    ..
+0001ab80: 2020 2020 2320 7365 7420 696e 6974 6961      # set initia
+0001ab90: 6c20 756e 6365 7274 6169 6e74 6965 7320  l uncertainties 
+0001aba0: 286f 7074 696f 6e61 6c29 0a20 2020 2073  (optional).    s
+0001abb0: 656c 662e 6470 3020 3d20 6470 300a 2020  elf.dp0 = dp0.  
+0001abc0: 2020 0a20 2020 2023 2073 746f 7265 2069    .    # store i
+0001abd0: 6e66 6f72 6d61 7469 6f6e 7320 6f6e 2070  nformations on p
+0001abe0: 6172 616d 6574 6572 206c 696d 6974 7320  arameter limits 
+0001abf0: 2875 7365 6420 6279 206d 696e 7569 7429  (used by minuit)
+0001ac00: 0a20 2020 2073 656c 662e 7365 744c 696d  .    self.setLim
+0001ac10: 6974 7320 3d20 6c69 6d69 7473 2020 2020  its = limits    
+0001ac20: 0a20 2020 2073 656c 662e 6c69 6d69 7473  .    self.limits
+0001ac30: 203d 205b 5d0a 2020 2020 6966 206c 696d   = [].    if lim
+0001ac40: 6974 7320 6973 206e 6f74 204e 6f6e 653a  its is not None:
+0001ac50: 0a20 2020 2020 2073 656c 662e 6c69 6d69  .      self.limi
+0001ac60: 7473 3d5b 205b 4e6f 6e65 2c20 4e6f 6e65  ts=[ [None, None
+0001ac70: 5d5d 202a 206c 656e 2873 656c 662e 706e  ]] * len(self.pn
+0001ac80: 616d 7329 0a20 2020 2020 2069 6620 6c65  ams).      if le
+0001ac90: 6e28 6e70 2e73 6861 7065 286c 696d 6974  n(np.shape(limit
+0001aca0: 7329 293d 3d32 3a0a 2020 2020 2020 2020  s))==2:.        
+0001acb0: 666f 7220 6c20 696e 206c 696d 6974 733a  for l in limits:
+0001acc0: 0a20 2020 2020 2020 2020 2069 6620 7479  .          if ty
+0001acd0: 7065 286c 5b30 5d29 3d3d 7479 7065 2827  pe(l[0])==type('
+0001ace0: 2027 293a 0a20 2020 2020 2020 2020 2020   '):.           
+0001acf0: 2070 5f69 6420 3d20 7365 6c66 2e70 6e61   p_id = self.pna
+0001ad00: 6d32 6964 5b6c 5b30 5d5d 0a20 2020 2020  m2id[l[0]].     
+0001ad10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001ad20: 2020 2020 2020 2070 5f69 6420 3d20 6c5b         p_id = l[
+0001ad30: 305d 0a20 2020 2020 2020 2020 2073 656c  0].          sel
+0001ad40: 662e 6c69 6d69 7473 5b70 5f69 645d 203d  f.limits[p_id] =
+0001ad50: 205b 6c5b 315d 2c20 6c5b 325d 5d20 2020   [l[1], l[2]]   
+0001ad60: 2020 2020 2020 200a 2020 2020 2020 656c         .      el
+0001ad70: 7365 3a0a 2020 2020 2020 2020 6966 2074  se:.        if t
+0001ad80: 7970 6528 6c69 6d69 7473 5b30 5d29 3d3d  ype(limits[0])==
+0001ad90: 7479 7065 2827 2027 293a 0a20 2020 2020  type(' '):.     
+0001ada0: 2020 2020 2070 5f69 6420 3d20 7365 6c66       p_id = self
+0001adb0: 2e70 6e61 6d32 6964 5b6c 696d 6974 735b  .pnam2id[limits[
+0001adc0: 305d 5d0a 2020 2020 2020 2020 656c 7365  0]].        else
+0001add0: 3a0a 2020 2020 2020 2020 2020 705f 6964  :.          p_id
+0001ade0: 203d 206c 696d 6974 735b 305d 0a20 2020   = limits[0].   
+0001adf0: 2020 2020 2073 656c 662e 6c69 6d69 7473       self.limits
+0001ae00: 5b70 5f69 645d 3d5b 6c69 6d69 7473 5b31  [p_id]=[limits[1
+0001ae10: 5d2c 206c 696d 6974 735b 325d 5d20 2020  ], limits[2]]   
+0001ae20: 2020 2020 2020 200a 0a20 2020 2023 2073         ..    # s
+0001ae30: 746f 7265 2069 6e66 6f72 6d61 7469 6f6e  tore information
+0001ae40: 206f 6e20 6669 7865 6420 7061 7261 6d65   on fixed parame
+0001ae50: 7465 7273 200a 2020 2020 7365 6c66 2e66  ters .    self.f
+0001ae60: 6978 5061 7273 203d 2066 6978 5061 7273  ixPars = fixPars
+0001ae70: 2020 2020 0a20 2020 2073 656c 662e 6669      .    self.fi
+0001ae80: 7865 6450 6172 7320 3d20 5b20 4661 6c73  xedPars = [ Fals
+0001ae90: 6520 5d20 2a20 7365 6c66 2e6e 7061 720a  e ] * self.npar.
+0001aea0: 2020 2020 6966 2066 6978 5061 7273 2069      if fixPars i
+0001aeb0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0001aec0: 2020 2320 6765 7420 7061 7261 6d65 7465    # get paramete
+0001aed0: 7220 6e61 6d65 7320 6f72 2069 6e64 6963  r names or indic
+0001aee0: 6573 2074 6f20 6669 780a 2020 2020 2020  es to fix.      
+0001aef0: 6966 206c 656e 286e 702e 7368 6170 6528  if len(np.shape(
+0001af00: 6669 7850 6172 7329 293d 3d31 3a0a 2020  fixPars))==1:.  
+0001af10: 2020 2020 2020 666f 7220 6620 696e 2066        for f in f
+0001af20: 6978 5061 7273 3a0a 2020 2020 2020 2020  ixPars:.        
+0001af30: 2020 6966 2074 7970 6528 6629 3d3d 7479    if type(f)==ty
+0001af40: 7065 2827 2027 293a 0a20 2020 2020 2020  pe(' '):.       
+0001af50: 2020 2020 2070 5f69 6420 3d20 7365 6c66       p_id = self
+0001af60: 2e70 6e61 6d32 6964 5b66 5d0a 2020 2020  .pnam2id[f].    
+0001af70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001af80: 2020 2020 2020 2020 705f 6964 203d 2066          p_id = f
+0001af90: 0a20 2020 2020 2020 2020 2073 656c 662e  .          self.
+0001afa0: 6669 7865 6450 6172 735b 705f 6964 5d20  fixedPars[p_id] 
+0001afb0: 3d20 5472 7565 2020 2020 2020 2020 2020  = True          
+0001afc0: 0a20 2020 2020 2020 2073 656c 662e 6e66  .        self.nf
+0001afd0: 6978 6564 203d 206c 656e 2866 6978 5061  ixed = len(fixPa
+0001afe0: 7273 290a 2020 2020 2020 656c 7365 3a0a  rs).      else:.
+0001aff0: 2020 2020 2020 2020 6966 2074 7970 6528          if type(
+0001b000: 6669 7850 6172 7329 3d3d 7479 7065 2827  fixPars)==type('
+0001b010: 2027 293a 0a20 2020 2020 2020 2020 2070   '):.          p
+0001b020: 5f69 6420 3d20 7365 6c66 2e70 6e61 6d32  _id = self.pnam2
+0001b030: 6964 5b66 6978 5061 7273 5d0a 2020 2020  id[fixPars].    
+0001b040: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001b050: 2020 2020 705f 6964 203d 2066 6978 5061      p_id = fixPa
+0001b060: 7273 0a20 2020 2020 2020 2073 656c 662e  rs.        self.
+0001b070: 6669 7865 6450 6172 735b 705f 6964 5d3d  fixedPars[p_id]=
+0001b080: 5472 7565 2020 2020 2020 2020 2020 0a20  True          . 
+0001b090: 2020 2020 2020 2073 656c 662e 6e66 6978         self.nfix
+0001b0a0: 6564 203d 2031 0a20 2020 2023 2067 6574  ed = 1.    # get
+0001b0b0: 2070 6172 616d 6574 6572 206e 616d 6573   parameter names
+0001b0c0: 206f 7220 696e 6469 6365 7320 6f66 2066   or indices of f
+0001b0d0: 6978 6564 2070 6172 616d 6574 6572 730a  ixed parameters.
+0001b0e0: 2020 2020 2020 7365 6c66 2e66 7265 6550        self.freeP
+0001b0f0: 6172 4e61 6d73 203d 205b 5d0a 2020 2020  arNams = [].    
+0001b100: 2020 7365 6c66 2e66 6978 6564 5061 724e    self.fixedParN
+0001b110: 616d 7320 3d20 5b5d 0a20 2020 2020 2066  ams = [].      f
+0001b120: 6f72 2069 2c20 6669 7865 6420 696e 2065  or i, fixed in e
+0001b130: 6e75 6d65 7261 7465 2873 656c 662e 6669  numerate(self.fi
+0001b140: 7865 6450 6172 7329 3a0a 2020 2020 2020  xedPars):.      
+0001b150: 2020 6966 206e 6f74 2066 6978 6564 3a20    if not fixed: 
+0001b160: 7365 6c66 2e66 7265 6550 6172 4e61 6d73  self.freeParNams
+0001b170: 2e61 7070 656e 6428 7365 6c66 2e70 6e61  .append(self.pna
+0001b180: 6d73 5b69 5d29 0a20 2020 2020 2020 2069  ms[i]).        i
+0001b190: 6620 6669 7865 643a 2073 656c 662e 6669  f fixed: self.fi
+0001b1a0: 7865 6450 6172 4e61 6d73 2e61 7070 656e  xedParNams.appen
+0001b1b0: 6428 7365 6c66 2e70 6e61 6d73 5b69 5d29  d(self.pnams[i])
+0001b1c0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+0001b1d0: 2073 656c 662e 6672 6565 5061 724e 616d   self.freeParNam
+0001b1e0: 7320 3d20 7365 6c66 2e70 6e61 6d73 2020  s = self.pnams  
+0001b1f0: 0a20 2020 2020 2073 656c 662e 6669 7865  .      self.fixe
+0001b200: 6450 6172 4e61 6d73 203d 205b 5d20 200a  dParNams = []  .
+0001b210: 0a20 2064 6566 205f 7365 7475 704d 696e  .  def _setupMin
+0001b220: 7569 7428 7365 6c66 2c20 6d6f 6465 6c5f  uit(self, model_
+0001b230: 6b77 6172 6773 293a 0a20 2020 2022 2222  kwargs):.    """
+0001b240: 6372 6561 7465 204d 696e 7569 7420 6f62  create Minuit ob
+0001b250: 6a65 6374 2028 6465 7065 6e64 7320 6f6e  ject (depends on
+0001b260: 204d 696e 7569 7420 7665 7273 696f 6e29   Minuit version)
+0001b270: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+0001b280: 7365 6c66 2e69 6d69 6e75 6974 5f76 6572  self.iminuit_ver
+0001b290: 7369 6f6e 203c 2027 3227 3a0a 2020 2020  sion < '2':.    
+0001b2a0: 2020 6966 2073 656c 662e 7175 6965 743a    if self.quiet:
+0001b2b0: 0a20 2020 2020 2020 2070 7269 6e74 5f6c  .        print_l
+0001b2c0: 6576 656c 3d30 0a20 2020 2020 2065 6c73  evel=0.      els
+0001b2d0: 653a 0a20 2020 2020 2020 2070 7269 6e74  e:.        print
+0001b2e0: 5f6c 6576 656c 3d31 0a20 2020 2020 2069  _level=1.      i
+0001b2f0: 6620 7365 6c66 2e64 7030 2069 7320 6e6f  f self.dp0 is no
+0001b300: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0001b310: 666f 7220 692c 2070 6e61 6d20 696e 2065  for i, pnam in e
+0001b320: 6e75 6d65 7261 7465 2873 656c 662e 706e  numerate(self.pn
+0001b330: 616d 7329 3a0a 2020 2020 2020 2020 2020  ams):.          
+0001b340: 6d6f 6465 6c5f 6b77 6172 6773 5b27 6572  model_kwargs['er
+0001b350: 726f 725f 2720 2b20 706e 616d 5d20 3d20  ror_' + pnam] = 
+0001b360: 7365 6c66 2e64 7030 5b69 5d0a 2020 2020  self.dp0[i].    
+0001b370: 2020 6966 2073 656c 662e 7365 744c 696d    if self.setLim
+0001b380: 6974 7320 6973 206e 6f74 204e 6f6e 653a  its is not None:
+0001b390: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
+0001b3a0: 706e 616d 2069 6e20 656e 756d 6572 6174  pnam in enumerat
+0001b3b0: 6528 7365 6c66 2e70 6e61 6d73 293a 0a20  e(self.pnams):. 
+0001b3c0: 2020 2020 2020 2020 206d 6f64 656c 5f6b           model_k
+0001b3d0: 7761 7267 735b 276c 696d 6974 5f27 202b  wargs['limit_' +
+0001b3e0: 2070 6e61 6d5d 203d 2073 656c 662e 6c69   pnam] = self.li
+0001b3f0: 6d69 7473 5b69 5d0a 2020 2020 2020 6966  mits[i].      if
+0001b400: 2073 656c 662e 6669 7850 6172 7320 6973   self.fixPars is
+0001b410: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0001b420: 2020 2066 6f72 2069 2c20 706e 616d 2069     for i, pnam i
+0001b430: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
+0001b440: 2e70 6e61 6d73 293a 0a20 2020 2020 2020  .pnams):.       
+0001b450: 2020 206d 6f64 656c 5f6b 7761 7267 735b     model_kwargs[
+0001b460: 2766 6978 5f27 202b 2070 6e61 6d5d 203d  'fix_' + pnam] =
+0001b470: 2073 656c 662e 6669 7865 6450 6172 735b   self.fixedPars[
+0001b480: 695d 2020 2020 2020 2020 2020 0a20 2020  i]          .   
+0001b490: 2020 2073 656c 662e 6d69 6e75 6974 203d     self.minuit =
+0001b4a0: 204d 696e 7569 7428 7365 6c66 2e63 6f73   Minuit(self.cos
+0001b4b0: 7466 2c0a 2020 2020 2020 2020 2020 2020  tf,.            
+0001b4c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001b4d0: 7272 6f72 6465 663d 7365 6c66 2e45 7272  rrordef=self.Err
+0001b4e0: 4465 662c 0a20 2020 2020 2020 2020 2020  Def,.           
+0001b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b500: 7072 696e 745f 6c65 7665 6c3d 7072 696e  print_level=prin
+0001b510: 745f 6c65 7665 6c2c 0a20 2020 2020 2020  t_level,.       
+0001b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b530: 2020 2020 2a2a 6d6f 6465 6c5f 6b77 6172      **model_kwar
+0001b540: 6773 2029 0a20 2020 2065 6c73 653a 0a20  gs ).    else:. 
+0001b550: 2020 2020 2073 656c 662e 6d69 6e75 6974       self.minuit
+0001b560: 203d 204d 696e 7569 7428 7365 6c66 2e63   = Minuit(self.c
+0001b570: 6f73 7466 2c0a 2020 2020 2020 2020 2020  ostf,.          
+0001b580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b590: 202a 6d6f 6465 6c5f 6b77 6172 6773 2e76   *model_kwargs.v
+0001b5a0: 616c 7565 7328 292c 0a20 2020 2020 2020  alues(),.       
+0001b5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5c0: 2020 2020 6e61 6d65 3d73 656c 662e 706e      name=self.pn
+0001b5d0: 616d 7320 290a 2020 2020 2020 7365 6c66  ams ).      self
+0001b5e0: 2e6d 696e 7569 742e 6572 726f 7264 6566  .minuit.errordef
+0001b5f0: 203d 2073 656c 662e 4572 7244 6566 0a20   = self.ErrDef. 
+0001b600: 2020 2020 2069 6620 7365 6c66 2e71 7569       if self.qui
+0001b610: 6574 3a0a 2020 2020 2020 2020 7365 6c66  et:.        self
+0001b620: 2e6d 696e 7569 742e 7072 696e 745f 6c65  .minuit.print_le
+0001b630: 7665 6c20 3d20 300a 2020 2020 2020 6966  vel = 0.      if
+0001b640: 2073 656c 662e 6470 3020 6973 206e 6f74   self.dp0 is not
+0001b650: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
+0001b660: 656c 662e 6d69 6e75 6974 2e65 7272 6f72  elf.minuit.error
+0001b670: 7320 3d20 7365 6c66 2e64 7030 0a20 2020  s = self.dp0.   
+0001b680: 2020 2069 6620 7365 6c66 2e73 6574 4c69     if self.setLi
+0001b690: 6d69 7473 2069 7320 6e6f 7420 4e6f 6e65  mits is not None
+0001b6a0: 3a0a 2020 2020 2020 2020 7365 6c66 2e6d  :.        self.m
+0001b6b0: 696e 7569 742e 6c69 6d69 7473 203d 2073  inuit.limits = s
+0001b6c0: 656c 662e 6c69 6d69 7473 0a20 2020 2020  elf.limits.     
+0001b6d0: 2069 6620 7365 6c66 2e66 6978 5061 7273   if self.fixPars
+0001b6e0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0001b6f0: 2020 2020 2020 666f 7220 692c 2070 6e61        for i, pna
+0001b700: 6d20 696e 2065 6e75 6d65 7261 7465 2873  m in enumerate(s
+0001b710: 656c 662e 706e 616d 7329 3a0a 2020 2020  elf.pnams):.    
+0001b720: 2020 2020 2020 6966 2073 656c 662e 6669        if self.fi
+0001b730: 7865 6450 6172 735b 695d 3a20 7365 6c66  xedPars[i]: self
+0001b740: 2e6d 696e 7569 742e 6669 7865 645b 706e  .minuit.fixed[pn
+0001b750: 616d 5d3d 5472 7565 200a 0a20 2064 6566  am]=True ..  def
+0001b760: 205f 7374 6f72 6552 6573 756c 7428 7365   _storeResult(se
+0001b770: 6c66 293a 0a20 2023 2063 6f6c 6c65 6374  lf):.  # collect
+0001b780: 2072 6573 756c 7473 2061 7320 6e75 6d70   results as nump
+0001b790: 7920 6172 7261 7973 0a20 2020 2023 2021  y arrays.    # !
+0001b7a0: 2121 2074 6869 7320 7061 7274 2064 6570  !! this part dep
+0001b7b0: 656e 6473 206f 6e20 696d 696e 7569 7420  ends on iminuit 
+0001b7c0: 7665 7273 696f 6e20 2121 2120 2020 200a  version !!!    .
+0001b7d0: 2020 2020 6d3d 7365 6c66 2e6d 696e 7569      m=self.minui
+0001b7e0: 740a 2020 2020 6d69 6e43 6f73 7420 3d20  t.    minCost = 
+0001b7f0: 6d2e 6676 616c 2020 2020 2020 2020 2020  m.fval          
+0001b800: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001b810: 6d69 6e69 6d75 6d20 7661 6c75 6520 6f66  minimum value of
+0001b820: 2063 6f73 7420 6675 6e63 7469 6f6e 0a20   cost function. 
+0001b830: 2020 206e 6670 6172 203d 206d 2e6e 6669     nfpar = m.nfi
+0001b840: 7420 2020 2020 2020 2020 2020 2020 2020  t               
+0001b850: 2020 2020 2020 2020 2020 2023 206e 756d             # num
+0001b860: 6572 206f 6620 6672 6565 2070 6172 616d  er of free param
+0001b870: 6574 6572 730a 2020 2020 6e64 6f66 203d  eters.    ndof =
+0001b880: 2073 656c 662e 636f 7374 662e 6e64 6f66   self.costf.ndof
+0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8a0: 2020 2320 6465 6772 6565 7320 6f66 2066    # degrees of f
+0001b8b0: 7265 6564 6f6d 0a20 2020 2069 6620 7365  reedom.    if se
+0001b8c0: 6c66 2e69 6d69 6e75 6974 5f76 6572 7369  lf.iminuit_versi
+0001b8d0: 6f6e 203c 2027 3227 3a0a 2020 2020 2020  on < '2':.      
+0001b8e0: 7061 726e 616d 6573 203d 206d 2e76 616c  parnames = m.val
+0001b8f0: 7565 732e 6b65 7973 2829 2020 2020 2020  ues.keys()      
+0001b900: 2020 2020 2020 2320 7061 7261 6d65 7465        # paramete
+0001b910: 7220 6e61 6d65 730a 2020 2020 2020 7061  r names.      pa
+0001b920: 7276 616c 7320 3d20 6e70 2e61 7361 7272  rvals = np.asarr
+0001b930: 6179 286d 2e76 616c 7565 732e 7661 6c75  ay(m.values.valu
+0001b940: 6573 2829 2920 2320 6265 7374 2d66 6974  es()) # best-fit
+0001b950: 2076 616c 7565 730a 2020 2020 2020 7061   values.      pa
+0001b960: 7265 7272 7320 3d20 6e70 2e61 7361 7272  rerrs = np.asarr
+0001b970: 6179 286d 2e65 7272 6f72 732e 7661 6c75  ay(m.errors.valu
+0001b980: 6573 2829 2920 2320 7061 7261 6d65 7465  es()) # paramete
+0001b990: 7220 756e 6365 7274 6169 6e74 6965 730a  r uncertainties.
+0001b9a0: 2020 2020 2020 636f 7620 3d20 6e70 2e61        cov = np.a
+0001b9b0: 7272 6179 286d 2e6d 6174 7269 7828 2929  rray(m.matrix())
+0001b9c0: 2020 2020 2020 2020 2020 2020 2320 636f              # co
+0001b9d0: 762e 206d 6174 7269 7820 6f66 2066 7265  v. matrix of fre
+0001b9e0: 6520 7061 7261 6d65 7465 7273 0a20 2020  e parameters.   
+0001b9f0: 2065 6c73 653a 0a20 2020 2023 2076 6572   else:.    # ver
+0001ba00: 732e 203e 3d32 2e30 200a 2020 2020 2020  s. >=2.0 .      
+0001ba10: 7061 726e 616d 6573 203d 206d 2e70 6172  parnames = m.par
+0001ba20: 616d 6574 6572 7320 2020 2020 2020 2320  ameters       # 
+0001ba30: 7061 7261 6d65 7465 7220 6e61 6d65 730a  parameter names.
+0001ba40: 2020 2020 2020 7061 7276 616c 7320 3d20        parvals = 
+0001ba50: 6e70 2e61 7361 7272 6179 286d 2e76 616c  np.asarray(m.val
+0001ba60: 7565 7329 2020 2320 6265 7374 2d66 6974  ues)  # best-fit
+0001ba70: 2076 616c 7565 730a 2020 2020 2020 7061   values.      pa
+0001ba80: 7265 7272 7320 3d20 6e70 2e61 7361 7272  rerrs = np.asarr
+0001ba90: 6179 286d 2e65 7272 6f72 7329 2020 2320  ay(m.errors)  # 
+0001baa0: 7061 7261 6d65 7465 7220 756e 6365 7274  parameter uncert
+0001bab0: 6169 6e74 6965 730a 2020 2020 2020 636f  ainties.      co
+0001bac0: 7620 3d20 6e70 2e61 7361 7272 6179 286d  v = np.asarray(m
+0001bad0: 2e63 6f76 6172 6961 6e63 6529 2020 2320  .covariance)  # 
+0001bae0: 636f 7661 7269 616e 6365 206d 6174 7269  covariance matri
+0001baf0: 7820 6f66 2061 6c6c 2821 2920 7061 7261  x of all(!) para
+0001bb00: 6d65 7465 7273 0a20 2020 2020 2023 2070  meters.      # p
+0001bb10: 726f 6475 6365 2072 6564 7563 6564 2063  roduce reduced c
+0001bb20: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
+0001bb30: 2066 6f72 2066 7265 6520 7061 7261 6d65   for free parame
+0001bb40: 7465 7273 206f 6e6c 790a 2020 2020 2020  ters only.      
+0001bb50: 6966 2073 656c 662e 6e66 6978 6564 2021  if self.nfixed !
+0001bb60: 3d20 303a 0a20 2020 2020 2020 2066 6f72  = 0:.        for
+0001bb70: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
+0001bb80: 7061 726e 616d 6573 292d 312c 202d 312c  parnames)-1, -1,
+0001bb90: 202d 3129 3a20 2320 7374 6172 7420 6672   -1): # start fr
+0001bba0: 6f6d 206c 6172 6765 7374 2069 6e64 6578  om largest index
+0001bbb0: 2061 6e64 2077 6f72 6b20 6261 636b 0a20   and work back. 
+0001bbc0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0001bbd0: 2e66 6978 6564 5061 7273 5b69 5d3a 0a20  .fixedPars[i]:. 
+0001bbe0: 2020 2020 2020 2020 2020 2063 6f76 203d             cov =
+0001bbf0: 206e 702e 6465 6c65 7465 286e 702e 6465   np.delete(np.de
+0001bc00: 6c65 7465 2863 6f76 2c20 692c 2030 2029  lete(cov, i, 0 )
+0001bc10: 2c20 692c 2031 290a 2020 2020 6e70 6172  , i, 1).    npar
+0001bc20: 3d6c 656e 2870 6172 6e61 6d65 7329 2020  =len(parnames)  
+0001bc30: 2020 2020 2020 2020 2020 2023 206e 756d             # num
+0001bc40: 6265 7220 6f66 2070 6172 616d 6574 6572  ber of parameter
+0001bc50: 730a 0a20 2020 2069 6620 7365 6c66 2e6d  s..    if self.m
+0001bc60: 696e 6f73 5265 7375 6c74 2069 7320 6e6f  inosResult is no
+0001bc70: 7420 4e6f 6e65 2061 6e64 2073 656c 662e  t None and self.
+0001bc80: 6d69 6e6f 735f 6f6b 3a0a 2020 2020 2020  minos_ok:.      
+0001bc90: 706d 6572 7273 203d 205b 5d20 0a20 2020  pmerrs = [] .   
+0001bca0: 2023 2020 7072 696e 7428 224d 494e 4f53   #  print("MINOS
+0001bcb0: 2065 7272 6f72 733a 2229 0a20 2020 2020   errors:").     
+0001bcc0: 2069 6620 7365 6c66 2e69 6d69 6e75 6974   if self.iminuit
+0001bcd0: 5f76 6572 7369 6f6e 203c 2027 3227 3a0a  _version < '2':.
+0001bce0: 2020 2020 2020 2020 666f 7220 706e 616d          for pnam
+0001bcf0: 2069 6e20 6d2e 6d65 7272 6f72 732e 6b65   in m.merrors.ke
+0001bd00: 7973 2829 3a0a 2020 2020 2020 2020 2020  ys():.          
+0001bd10: 706d 6572 7273 2e61 7070 656e 6428 5b6d  pmerrs.append([m
+0001bd20: 2e6d 6572 726f 7273 5b70 6e61 6d5d 5b32  .merrors[pnam][2
+0001bd30: 5d2c 206d 2e6d 6572 726f 7273 5b70 6e61  ], m.merrors[pna
+0001bd40: 6d5d 5b33 5d5d 290a 2020 2020 2020 656c  m][3]]).      el
+0001bd50: 7365 3a0a 2020 2020 2020 2020 666f 7220  se:.        for 
+0001bd60: 706e 616d 2069 6e20 6d2e 6d65 7272 6f72  pnam in m.merror
+0001bd70: 732e 6b65 7973 2829 3a0a 2020 2020 2020  s.keys():.      
+0001bd80: 2020 2020 706d 6572 7273 2e61 7070 656e      pmerrs.appen
+0001bd90: 6428 5b6d 2e6d 6572 726f 7273 5b70 6e61  d([m.merrors[pna
+0001bda0: 6d5d 2e6c 6f77 6572 2c20 6d2e 6d65 7272  m].lower, m.merr
+0001bdb0: 6f72 735b 706e 616d 5d2e 7570 7065 725d  ors[pnam].upper]
+0001bdc0: 290a 2020 2020 2020 7365 6c66 2e4f 6e65  ).      self.One
+0001bdd0: 5369 6749 6e74 6572 7661 6c3d 6e70 2e61  SigInterval=np.a
+0001bde0: 7272 6179 2870 6d65 7272 7329 0a20 2020  rray(pmerrs).   
+0001bdf0: 2065 6c73 653a 0a20 2020 2020 2073 656c   else:.      sel
+0001be00: 662e 4f6e 6553 6967 496e 7465 7276 616c  f.OneSigInterval
+0001be10: 203d 206e 702e 6172 7261 7928 6c69 7374   = np.array(list
+0001be20: 287a 6970 282d 7061 7265 7272 732c 2070  (zip(-parerrs, p
+0001be30: 6172 6572 7273 2929 290a 0a20 2020 2023  arerrs)))..    #
+0001be40: 2066 696e 616c 2063 616c 6c20 6f66 2063   final call of c
+0001be50: 6f73 7420 6675 6e63 7469 6f6e 2061 7420  ost function at 
+0001be60: 6d69 6d69 6e75 6d20 746f 2075 7064 6174  miminum to updat
+0001be70: 6520 616c 6c20 7265 7375 6c74 730a 2020  e all results.  
+0001be80: 2020 2320 2d20 2073 6967 6e61 6c73 2064    # -  signals d
+0001be90: 6174 6120 6f62 6a65 6374 2074 6f20 7374  ata object to st
+0001bea0: 6f72 6520 6d6f 6465 6c2d 6465 6e64 656e  ore model-denden
+0001beb0: 7420 756e 6365 7274 6169 6e74 6965 730a  t uncertainties.
+0001bec0: 2020 2020 6966 2073 656c 662e 6461 7461      if self.data
+0001bed0: 2069 7320 6e6f 7420 4e6f 6e65 3a20 7365   is not None: se
+0001bee0: 6c66 2e64 6174 612e 6669 6e61 6c5f 6361  lf.data.final_ca
+0001bef0: 6c6c 3d54 7275 650a 2020 2020 2320 2d20  ll=True.    # - 
+0001bf00: 2061 6e64 2063 6f73 7420 6675 6e63 7469   and cost functi
+0001bf10: 6f6e 2074 6f20 7374 6f72 6520 676f 6f64  on to store good
+0001bf20: 6e65 7373 2d6f 662d 6669 740a 2020 2020  ness-of-fit.    
+0001bf30: 7365 6c66 2e63 6f73 7466 2e66 696e 616c  self.costf.final
+0001bf40: 5f63 616c 6c3d 5472 7565 0a20 2020 2066  _call=True.    f
+0001bf50: 7661 6c20 3d20 7365 6c66 2e63 6f73 7466  val = self.costf
+0001bf60: 282a 7061 7276 616c 7329 200a 2020 0a20  (*parvals) .  . 
+0001bf70: 2020 2023 2073 746f 7265 2072 6573 756c     # store resul
+0001bf80: 7473 2061 7320 636c 6173 7320 6d65 6d62  ts as class memb
+0001bf90: 6572 730a 2020 2020 2320 2020 7061 7261  ers.    #   para
+0001bfa0: 6d65 7465 7220 6e61 6d65 730a 2020 2020  meter names.    
+0001bfb0: 7365 6c66 2e50 6172 616d 6574 6572 4e61  self.ParameterNa
+0001bfc0: 6d65 7320 3d20 7061 726e 616d 6573 0a20  mes = parnames. 
+0001bfd0: 2020 2023 202a 2066 6c61 6720 666f 7220     # * flag for 
+0001bfe0: 6669 7865 6420 7061 7261 6d65 7465 7273  fixed parameters
+0001bff0: 2069 6e20 7365 6c66 2e66 6978 6564 5061   in self.fixedPa
+0001c000: 7273 0a20 2020 2023 202a 206e 616d 6573  rs.    # * names
+0001c010: 206f 6620 6672 6565 2070 6172 616d 6574   of free paramet
+0001c020: 6572 7320 696e 2073 656c 662e 6672 6565  ers in self.free
+0001c030: 5061 724e 616d 730a 2020 2020 2320 2020  ParNams.    #   
+0001c040: 6368 6932 2061 7420 6265 7374 2d66 6974  chi2 at best-fit
+0001c050: 2070 6f69 6e74 2028 706f 7373 6962 6c79   point (possibly
+0001c060: 2064 6966 6665 7265 6e74 2066 726f 6d20   different from 
+0001c070: 6d69 6e43 6f73 7429 0a20 2020 2073 656c  minCost).    sel
+0001c080: 662e 476f 4620 3d20 7365 6c66 2e63 6f73  f.GoF = self.cos
+0001c090: 7466 2e67 6f66 2020 0a20 2020 2023 2020  tf.gof  .    #  
+0001c0a0: 2070 6172 616d 6574 6572 2076 616c 7565   parameter value
+0001c0b0: 7320 6174 2062 6573 742d 6669 7420 706f  s at best-fit po
+0001c0c0: 696e 740a 2020 2020 7365 6c66 2e50 6172  int.    self.Par
+0001c0d0: 616d 6574 6572 5661 6c75 6573 203d 206e  ameterValues = n
+0001c0e0: 702e 6172 7261 7928 7061 7276 616c 732c  p.array(parvals,
+0001c0f0: 2063 6f70 793d 5472 7565 290a 2020 2020   copy=True).    
+0001c100: 7365 6c66 2e66 7265 6550 6172 5661 6c73  self.freeParVals
+0001c110: 203d 206e 702e 6172 7261 7928 0a20 2020   = np.array(.   
+0001c120: 2020 205b 2070 6172 7661 6c73 5b69 5d20     [ parvals[i] 
+0001c130: 666f 7220 6920 696e 2072 616e 6765 286e  for i in range(n
+0001c140: 7061 7229 2069 6620 6e6f 7420 7365 6c66  par) if not self
+0001c150: 2e66 6978 6564 5061 7273 5b69 5d20 5d29  .fixedPars[i] ])
+0001c160: 0a20 2020 2073 656c 662e 6672 6565 5061  .    self.freePa
+0001c170: 7245 7272 7320 3d20 6e70 2e61 7272 6179  rErrs = np.array
+0001c180: 280a 2020 2020 2020 5b20 7061 7265 7272  (.      [ parerr
+0001c190: 735b 695d 2066 6f72 2069 2069 6e20 7261  s[i] for i in ra
+0001c1a0: 6e67 6528 6e70 6172 2920 6966 206e 6f74  nge(npar) if not
+0001c1b0: 2073 656c 662e 6669 7865 6450 6172 735b   self.fixedPars[
+0001c1c0: 695d 205d 290a 2020 2020 2320 6669 7865  i] ]).    # fixe
+0001c1d0: 6420 7061 7261 6d65 7465 7220 6e61 6d65  d parameter name
+0001c1e0: 7320 616e 6420 7661 6c75 6573 0a20 2020  s and values.   
+0001c1f0: 2073 656c 662e 6669 7865 6450 6172 5661   self.fixedParVa
+0001c200: 6c73 203d 206e 702e 6172 7261 7928 0a20  ls = np.array(. 
+0001c210: 2020 2020 205b 2070 6172 7661 6c73 5b69       [ parvals[i
+0001c220: 5d20 666f 7220 6920 696e 2072 616e 6765  ] for i in range
+0001c230: 286e 7061 7229 2069 6620 7365 6c66 2e66  (npar) if self.f
+0001c240: 6978 6564 5061 7273 5b69 5d20 5d29 0a20  ixedPars[i] ]). 
+0001c250: 2020 2023 202a 206e 616d 6573 206f 6620     # * names of 
+0001c260: 6669 7865 6420 7061 7261 6d65 7465 7273  fixed parameters
+0001c270: 2069 6e20 7365 6c66 2e66 6978 6564 5061   in self.fixedPa
+0001c280: 724e 616d 730a 2020 2020 2320 2020 6e75  rNams.    #   nu
+0001c290: 6d62 6572 206f 6620 6465 6772 6565 7320  mber of degrees 
+0001c2a0: 6f66 2066 7265 6564 6f6d 0a20 2020 2073  of freedom.    s
+0001c2b0: 656c 662e 4e44 6f46 203d 206e 646f 6620  elf.NDoF = ndof 
+0001c2c0: 200a 2020 2020 2320 2020 7379 6d6d 6574   .    #   symmet
+0001c2d0: 7269 6320 756e 6365 7274 6169 6e74 6965  ric uncertaintie
+0001c2e0: 730a 2020 2020 7365 6c66 2e4d 6967 7261  s.    self.Migra
+0001c2f0: 6445 7272 6f72 7320 3d20 6e70 2e61 7272  dErrors = np.arr
+0001c300: 6179 2870 6172 6572 7273 2c20 636f 7079  ay(parerrs, copy
+0001c310: 3d54 7275 6529 0a20 2020 2023 2020 2063  =True).    #   c
+0001c320: 6f76 6172 6961 6e63 6520 616e 6420 636f  ovariance and co
+0001c330: 7272 656c 6174 696f 6e20 6d61 7472 6963  rrelation matric
+0001c340: 6573 0a20 2020 2073 656c 662e 436f 7661  es.    self.Cova
+0001c350: 7269 616e 6365 4d61 7472 6978 203d 206e  rianceMatrix = n
+0001c360: 702e 6172 7261 7928 636f 762c 2063 6f70  p.array(cov, cop
+0001c370: 793d 5472 7565 290a 2020 2020 7065 7272  y=True).    perr
+0001c380: 7320 3d20 6e70 2e73 7172 7428 6e70 2e64  s = np.sqrt(np.d
+0001c390: 6961 676f 6e61 6c28 636f 7629 290a 2020  iagonal(cov)).  
+0001c3a0: 2020 7365 6c66 2e43 6f72 7265 6c61 7469    self.Correlati
+0001c3b0: 6f6e 4d61 7472 6978 203d 2063 6f76 2f6e  onMatrix = cov/n
+0001c3c0: 702e 6f75 7465 7228 7065 7272 732c 2070  p.outer(perrs, p
+0001c3d0: 6572 7273 290a 2020 2020 2320 2020 312d  errs).    #   1-
+0001c3e0: 7369 676d 6120 2836 3825 2043 4c29 2072  sigma (68% CL) r
+0001c3f0: 616e 6765 2069 6e20 7365 6c66 2e4f 6e65  ange in self.One
+0001c400: 5369 6749 6e74 6572 7661 6c0a 0a20 2020  SigInterval..   
+0001c410: 2023 2062 7569 6c64 2061 2063 6f6e 7665   # build a conve
+0001c420: 6e69 656e 7420 7265 7375 6c74 2064 6963  nient result dic
+0001c430: 7469 6f6e 6172 790a 2020 2020 6966 2073  tionary.    if s
+0001c440: 656c 662e 6e66 6978 6564 203d 3d30 3a0a  elf.nfixed ==0:.
+0001c450: 2020 2020 2020 7274 7570 6c65 203d 2028        rtuple = (
+0001c460: 7365 6c66 2e50 6172 616d 6574 6572 5661  self.ParameterVa
+0001c470: 6c75 6573 2c0a 2020 2020 2020 2020 2020  lues,.          
+0001c480: 2020 2020 2020 7365 6c66 2e4f 6e65 5369        self.OneSi
+0001c490: 6749 6e74 6572 7661 6c2c 0a20 2020 2020  gInterval,.     
+0001c4a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001c4b0: 436f 7272 656c 6174 696f 6e4d 6174 7269  CorrelationMatri
+0001c4c0: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
+0001c4d0: 2020 2073 656c 662e 476f 462c 0a20 2020     self.GoF,.   
 0001c4e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001c4f0: 662e 476f 462c 0a20 2020 2020 2020 2020  f.GoF,.         
-0001c500: 2020 2020 2020 2073 656c 662e 5061 7261         self.Para
-0001c510: 6d65 7465 724e 616d 6573 2029 0a20 2020  meterNames ).   
-0001c520: 2065 6c73 653a 0a20 2020 2020 2020 7274   else:.       rt
-0001c530: 7570 6c65 3d20 286e 702e 636f 6e63 6174  uple= (np.concat
-0001c540: 656e 6174 6528 2028 7365 6c66 2e66 7265  enate( (self.fre
-0001c550: 6550 6172 5661 6c73 2c20 7365 6c66 2e66  eParVals, self.f
-0001c560: 6978 6564 5061 7256 616c 7329 2029 2c0a  ixedParVals) ),.
-0001c570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c580: 7365 6c66 2e4f 6e65 5369 6749 6e74 6572  self.OneSigInter
-0001c590: 7661 6c2c 0a20 2020 2020 2020 2020 2020  val,.           
-0001c5a0: 2020 2020 2073 656c 662e 436f 7272 656c       self.Correl
-0001c5b0: 6174 696f 6e4d 6174 7269 782c 0a20 2020  ationMatrix,.   
-0001c5c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001c5d0: 662e 476f 462c 0a20 2020 2020 2020 2020  f.GoF,.         
-0001c5e0: 2020 2020 2020 206e 702e 636f 6e63 6174         np.concat
-0001c5f0: 656e 6174 6528 2028 7365 6c66 2e66 7265  enate( (self.fre
-0001c600: 6550 6172 4e61 6d73 2c20 7365 6c66 2e66  eParNams, self.f
-0001c610: 6978 6564 5061 724e 616d 7329 2029 2029  ixedParNams) ) )
-0001c620: 0a20 2020 206b 6579 7320 3d20 2820 2770  .    keys = ( 'p
-0001c630: 6172 616d 6574 6572 2076 616c 7565 7327  arameter values'
-0001c640: 2c0a 2020 2020 2020 2020 2020 2020 2027  ,.             '
-0001c650: 636f 6e66 6964 656e 6365 2069 6e74 6572  confidence inter
-0001c660: 7661 6c73 272c 0a20 2020 2020 2020 2020  vals',.         
-0001c670: 2020 2020 2763 6f72 7265 6c61 7469 6f6e      'correlation
-0001c680: 206d 6174 7269 7827 2c0a 2020 2020 2020   matrix',.      
-0001c690: 2020 2020 2020 2027 676f 6f64 6e65 7373         'goodness
-0001c6a0: 2d6f 662d 6669 7427 2c0a 2020 2020 2020  -of-fit',.      
-0001c6b0: 2020 2020 2020 2027 7061 7261 6d65 7465         'paramete
-0001c6c0: 7220 6e61 6d65 7327 2029 0a20 2020 2023  r names' ).    #
-0001c6d0: 2062 7569 6c64 2064 6963 7469 6f6e 6172   build dictionar
-0001c6e0: 790a 2020 2020 7365 6c66 2e52 6573 756c  y.    self.Resul
-0001c6f0: 7444 6963 7469 6f6e 6172 7920 3d20 7b6b  tDictionary = {k
-0001c700: 3a72 7475 706c 655b 695d 2066 6f72 2028  :rtuple[i] for (
-0001c710: 692c 206b 2920 696e 2065 6e75 6d65 7261  i, k) in enumera
-0001c720: 7465 286b 6579 7329 7d0a 2020 2020 0a20  te(keys)}.    . 
-0001c730: 2064 6566 2067 6574 5265 7375 6c74 2873   def getResult(s
-0001c740: 656c 6629 3a0a 2020 2020 2222 2272 6574  elf):.    """ret
-0001c750: 7572 6e20 7265 7375 6c74 2064 6963 7469  urn result dicti
-0001c760: 6f6e 6172 790a 2020 2020 2222 220a 2020  onary.    """.  
-0001c770: 2020 6966 2073 656c 662e 5265 7375 6c74    if self.Result
-0001c780: 4469 6374 696f 6e61 7279 2069 7320 6e6f  Dictionary is no
-0001c790: 7420 4e6f 6e65 3a0a 2020 2020 2020 7265  t None:.      re
-0001c7a0: 7475 726e 2073 656c 662e 5265 7375 6c74  turn self.Result
-0001c7b0: 4469 6374 696f 6e61 7279 0a20 2020 2065  Dictionary.    e
-0001c7c0: 6c73 653a 0a20 2020 2020 2072 6169 7365  lse:.      raise
-0001c7d0: 2052 756e 7469 6d65 4572 726f 7228 0a20   RuntimeError(. 
-0001c7e0: 2020 2020 2020 2022 2021 2121 206d 6e46         " !!! mnF
-0001c7f0: 6974 2e67 6574 5265 7375 6c74 3a20 6e6f  it.getResult: no
-0001c800: 2072 6573 756c 7473 2061 7661 696c 6162   results availab
-0001c810: 6c65 202d 2072 756e 2066 6974 2066 6972  le - run fit fir
-0001c820: 7374 2229 0a20 2020 2020 2020 0a20 2040  st").       .  @
-0001c830: 7374 6174 6963 6d65 7468 6f64 0a20 2064  staticmethod.  d
-0001c840: 6566 2067 6574 4675 6e63 7469 6f6e 4572  ef getFunctionEr
-0001c850: 726f 7228 782c 206d 6f64 656c 2c20 7076  ror(x, model, pv
-0001c860: 616c 732c 2063 6f76 702c 2066 6978 6564  als, covp, fixed
-0001c870: 5061 7273 293a 0a20 2020 2022 2222 2064  Pars):.    """ d
-0001c880: 6574 6572 6d69 6e65 2065 7272 6f72 206f  etermine error o
-0001c890: 6620 6d6f 6465 6c20 6174 2078 2020 0a20  f model at x  . 
-0001c8a0: 2020 200a 2020 2020 466f 726d 756c 613a     .    Formula:
-0001c8b0: 200a 2020 2020 2020 4465 6c74 6128 7829   .      Delta(x)
-0001c8c0: 203d 2073 7172 7428 2073 756d 5f69 2c6a   = sqrt( sum_i,j
-0001c8d0: 2028 6466 2f64 705f 6928 7829 2064 662f   (df/dp_i(x) df/
-0001c8e0: 6470 5f6a 2878 2920 5670 5f69 2c6a 2920  dp_j(x) Vp_i,j) 
-0001c8f0: 290a 0a20 2020 2041 7267 733a 0a20 2020  )..    Args:.   
-0001c900: 2020 202a 2078 3a20 7363 616c 6172 206f     * x: scalar o
-0001c910: 7220 6e70 2d61 7272 6179 206f 6620 7820  r np-array of x 
-0001c920: 7661 6c75 6573 0a20 2020 2020 202a 206d  values.      * m
-0001c930: 6f64 656c 3a20 6d6f 6465 6c20 6675 6e63  odel: model func
-0001c940: 7469 6f6e 0a20 2020 2020 202a 2070 766c  tion.      * pvl
-0001c950: 6173 3a20 7061 7261 6d65 7465 7220 7661  as: parameter va
-0001c960: 6c75 6573 0a20 2020 2020 202a 2063 6f76  lues.      * cov
-0001c970: 703a 2063 6f76 6172 6961 6e63 6520 6d61  p: covariance ma
-0001c980: 7472 6978 206f 6620 7061 7261 6d65 7465  trix of paramete
-0001c990: 7273 0a0a 2020 2020 5265 7475 726e 733a  rs..    Returns:
-0001c9a0: 0a20 2020 2020 202a 206d 6f64 656c 2075  .      * model u
-0001c9b0: 6e63 6572 7461 696e 7479 2c20 7361 6d65  ncertainty, same
-0001c9c0: 206c 656e 6774 6820 6173 2078 0a20 2020   length as x.   
-0001c9d0: 2022 2222 0a0a 2020 2020 2320 6361 6c63   """..    # calc
-0001c9e0: 756c 6174 6520 7061 7274 6961 6c20 6465  ulate partial de
-0001c9f0: 7269 7661 7469 7665 7320 6f66 206d 6f64  rivatives of mod
-0001ca00: 656c 2077 2e72 2e74 2070 6172 616d 6574  el w.r.t paramet
-0001ca10: 6572 7320 2020 200a 0a20 2020 2023 2020  ers    ..    #  
-0001ca20: 2070 6172 616d 6574 6572 2073 7465 7020   parameter step 
-0001ca30: 7369 7a65 200a 2020 2020 6470 203d 2030  size .    dp = 0
-0001ca40: 2e30 3120 2a20 6e70 2e73 7172 7428 6e70  .01 * np.sqrt(np
-0001ca50: 2e64 6961 676f 6e61 6c28 636f 7670 2929  .diagonal(covp))
-0001ca60: 0a20 2020 2023 206e 756d 6265 7220 6f66  .    # number of
-0001ca70: 2076 6172 6961 626c 6520 7061 7261 6d65   variable parame
-0001ca80: 7465 7273 200a 2020 2020 6e76 7061 7220  ters .    nvpar 
-0001ca90: 3d20 6c65 6e28 6470 290a 2020 2020 2320  = len(dp).    # 
-0001caa0: 2020 6465 7269 7661 7469 7665 2064 662f    derivative df/
-0001cab0: 6470 5f6a 2061 7420 6561 6368 2078 5f69  dp_j at each x_i
-0001cac0: 0a20 2020 2064 6664 7020 3d20 6e70 2e65  .    dfdp = np.e
-0001cad0: 6d70 7479 2820 286e 7670 6172 2c20 6c65  mpty( (nvpar, le
-0001cae0: 6e28 7829 2920 290a 2020 2020 705f 706c  n(x)) ).    p_pl
-0001caf0: 7573 203d 206e 702e 6172 7261 7928 7076  us = np.array(pv
-0001cb00: 616c 732c 2063 6f70 793d 5472 7565 290a  als, copy=True).
-0001cb10: 2020 2020 705f 6d69 6e75 7320 3d20 6e70      p_minus = np
-0001cb20: 2e61 7272 6179 2870 7661 6c73 2c20 636f  .array(pvals, co
-0001cb30: 7079 3d54 7275 6529 0a20 2020 206b 3d30  py=True).    k=0
-0001cb40: 0a20 2020 2066 6f72 206a 2069 6e20 7261  .    for j in ra
-0001cb50: 6e67 6528 6c65 6e28 7076 616c 7329 293a  nge(len(pvals)):
-0001cb60: 0a20 2020 2020 2069 6620 6e6f 7420 6669  .      if not fi
-0001cb70: 7865 6450 6172 735b 6a5d 3a0a 2020 2020  xedPars[j]:.    
-0001cb80: 2020 2020 705f 706c 7573 5b6a 5d20 3d20      p_plus[j] = 
-0001cb90: 7076 616c 735b 6a5d 202b 2064 705b 6b5d  pvals[j] + dp[k]
-0001cba0: 0a20 2020 2020 2020 2070 5f6d 696e 7573  .        p_minus
-0001cbb0: 5b6a 5d20 3d20 7076 616c 735b 6a5d 202d  [j] = pvals[j] -
-0001cbc0: 2064 705b 6b5d 0a20 2020 2020 2020 2064   dp[k].        d
-0001cbd0: 6664 705b 6b5d 203d 2030 2e35 202f 2064  fdp[k] = 0.5 / d
-0001cbe0: 705b 6b5d 202a 2028 0a20 2020 2020 2020  p[k] * (.       
-0001cbf0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-0001cc00: 656c 2878 2c20 2a70 5f70 6c75 7329 202d  el(x, *p_plus) -
-0001cc10: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0001cc20: 2020 2020 2020 6d6f 6465 6c28 782c 202a        model(x, *
-0001cc30: 705f 6d69 6e75 7329 2029 0a20 2020 2020  p_minus) ).     
-0001cc40: 2020 2070 5f70 6c75 735b 6a5d 203d 2070     p_plus[j] = p
-0001cc50: 7661 6c73 5b6a 5d0a 2020 2020 2020 2020  vals[j].        
-0001cc60: 705f 6d69 6e75 735b 6a5d 203d 2070 7661  p_minus[j] = pva
-0001cc70: 6c73 5b6a 5d0a 2020 2020 2020 2020 6b2b  ls[j].        k+
-0001cc80: 3d31 0a20 2020 2023 2020 2073 7175 6172  =1.    #   squar
-0001cc90: 6520 6f66 2075 6e63 6572 7461 696e 7469  e of uncertainti
-0001cca0: 6573 206f 6e20 6675 6e63 7469 6f6e 2076  es on function v
-0001ccb0: 616c 7565 730a 2020 2020 4465 6c74 613d  alues.    Delta=
-0001ccc0: 206e 702e 656d 7074 7928 6c65 6e28 7829   np.empty(len(x)
-0001ccd0: 290a 2020 2020 666f 7220 6920 696e 2072  ).    for i in r
-0001cce0: 616e 6765 286c 656e 2878 2929 3a0a 2020  ange(len(x)):.  
-0001ccf0: 2020 2020 4465 6c74 615b 695d 203d 206e      Delta[i] = n
-0001cd00: 702e 7375 6d28 6e70 2e6f 7574 6572 2864  p.sum(np.outer(d
-0001cd10: 6664 705b 3a2c 695d 2c20 6466 6470 5b3a  fdp[:,i], dfdp[:
-0001cd20: 2c69 5d29 202a 2063 6f76 7029 0a20 2020  ,i]) * covp).   
-0001cd30: 2072 6574 7572 6e20 6e70 2e73 7172 7428   return np.sqrt(
-0001cd40: 4465 6c74 6129 200a 2020 0a0a 2020 6465  Delta) .  ..  de
-0001cd50: 6620 646f 5f66 6974 2873 656c 6629 3a0a  f do_fit(self):.
-0001cd60: 2020 2020 2222 2270 6572 666f 726d 2061      """perform a
-0001cd70: 6c6c 206e 6563 6573 7361 7279 2073 7465  ll necessary ste
-0001cd80: 7073 206f 6620 6669 7420 7365 7175 656e  ps of fit sequen
-0001cd90: 6365 0a20 2020 2022 2222 0a20 2020 2069  ce.    """.    i
-0001cda0: 6620 7365 6c66 2e64 6174 6120 6973 204e  f self.data is N
-0001cdb0: 6f6e 6520 616e 6420 7365 6c66 2e66 6974  one and self.fit
-0001cdc0: 5f74 7970 6520 213d 2022 7573 6572 223a  _type != "user":
-0001cdd0: 0a20 2020 2020 2072 6169 7365 2056 616c  .      raise Val
-0001cde0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-0001cdf0: 2027 2021 2121 206d 6e46 6974 3a20 6e6f   ' !!! mnFit: no
-0001ce00: 2064 6174 6120 6f62 6a65 6374 2064 6566   data object def
-0001ce10: 696e 6564 202d 2063 616c 6c20 696e 6974  ined - call init
-0001ce20: 5f64 6174 6128 2927 290a 2020 2020 6966  _data()').    if
-0001ce30: 2073 656c 662e 636f 7374 6620 6973 204e   self.costf is N
-0001ce40: 6f6e 653a 0a20 2020 2020 2072 6169 7365  one:.      raise
-0001ce50: 2052 756e 7469 6d65 4572 726f 7228 0a20   RuntimeError(. 
-0001ce60: 2020 2020 2020 2027 2121 2120 6d6e 4669         '!!! mnFi
-0001ce70: 743a 206e 6f20 6669 7420 6f62 6a65 6374  t: no fit object
-0001ce80: 2064 6566 696e 6564 202d 2063 616c 6c20   defined - call 
-0001ce90: 696e 6974 5f66 6974 2829 2729 0a20 2020  init_fit()').   
-0001cea0: 200a 2020 2020 2320 7375 6d6d 6172 697a   .    # summariz
-0001ceb0: 6520 6f70 7469 6f6e 730a 2020 2020 6966  e options.    if
-0001cec0: 206e 6f74 2073 656c 662e 7175 6965 743a   not self.quiet:
-0001ced0: 0a20 2020 2020 2069 6620 7365 6c66 2e69  .      if self.i
-0001cee0: 7465 7261 7465 4669 743a 0a20 2020 2020  terateFit:.     
-0001cef0: 2020 2070 7269 6e74 2820 272a 3d3d 2a20     print( '*==* 
-0001cf00: 6d6e 4669 7420 7374 6172 7469 6e67 2070  mnFit starting p
-0001cf10: 7265 2d66 6974 2729 0a20 2020 2020 2065  re-fit').      e
-0001cf20: 6c73 653a 200a 2020 2020 2020 2020 7072  lse: .        pr
-0001cf30: 696e 7428 2027 2a3d 3d2a 206d 6e46 6974  int( '*==* mnFit
-0001cf40: 2073 7461 7274 696e 6720 6669 7427 290a   starting fit').
-0001cf50: 2020 2020 2020 7072 696e 7428 2027 2020        print( '  
-0001cf60: 4f70 7469 6f6e 733a 2729 0a20 2020 2020  Options:').     
-0001cf70: 2066 6f72 206b 6579 2069 6e20 7365 6c66   for key in self
-0001cf80: 2e6f 7074 696f 6e73 2e6b 6579 7328 293a  .options.keys():
-0001cf90: 0a20 2020 2020 2020 2072 656c 6576 616e  .        relevan
-0001cfa0: 7420 3d20 7365 6c66 2e6f 7074 696f 6e73  t = self.options
-0001cfb0: 5b6b 6579 5d5b 315d 203d 3d20 2261 6c6c  [key][1] == "all
-0001cfc0: 2220 6f72 205c 0a20 2020 2020 2020 2020  " or \.         
-0001cfd0: 2073 656c 662e 6669 745f 7479 7065 2069   self.fit_type i
-0001cfe0: 6e20 7365 6c66 2e6f 7074 696f 6e73 5b6b  n self.options[k
-0001cff0: 6579 5d5b 315d 0a20 2020 2020 2020 2069  ey][1].        i
-0001d000: 6620 7265 6c65 7661 6e74 3a0a 2020 2020  f relevant:.    
-0001d010: 2020 2020 2020 696f 7074 203d 2073 656c        iopt = sel
-0001d020: 662e 6f70 7469 6f6e 735b 6b65 795d 5b30  f.options[key][0
-0001d030: 5d20 2b20 320a 2020 2020 2020 2020 2020  ] + 2.          
-0001d040: 7072 696e 7428 352a 2220 2220 2b20 222d  print(5*" " + "-
-0001d050: 2022 2c0a 2020 2020 2020 2020 2020 2020   ",.            
-0001d060: 2020 7365 6c66 2e6f 7074 696f 6e73 5b6b    self.options[k
-0001d070: 6579 5d5b 696f 7074 5d29 0a20 2020 2020  ey][iopt]).     
-0001d080: 2070 7269 6e74 2827 5c6e 2729 2020 0a0a   print('\n')  ..
-0001d090: 2020 2020 2320 7065 7266 6f72 6d20 2869      # perform (i
-0001d0a0: 6e69 7469 616c 2920 6669 740a 2020 2020  nitial) fit.    
-0001d0b0: 7472 793a 0a20 2020 2020 2073 656c 662e  try:.      self.
-0001d0c0: 6d69 6772 6164 5265 7375 6c74 203d 2073  migradResult = s
-0001d0d0: 656c 662e 6d69 6e75 6974 2e6d 6967 7261  elf.minuit.migra
-0001d0e0: 6428 2920 2023 2066 696e 6420 6d69 6e69  d()  # find mini
-0001d0f0: 6d75 6d20 6f66 2063 6f73 7420 6675 6e63  mum of cost func
-0001d100: 7469 6f6e 0a20 2020 2020 2073 656c 662e  tion.      self.
-0001d110: 6d69 6772 6164 5f6f 6b20 3d20 5472 7565  migrad_ok = True
-0001d120: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
-0001d130: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-0001d140: 2020 7365 6c66 2e6d 6967 7261 645f 6f6b    self.migrad_ok
-0001d150: 203d 2046 616c 7365 0a20 2020 2020 2070   = False.      p
-0001d160: 7269 6e74 2865 290a 2020 2020 2020 7261  rint(e).      ra
-0001d170: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
-0001d180: 280a 2020 2020 2020 2020 272a 3d3d 2a20  (.        '*==* 
-0001d190: 2121 2120 6669 7420 7769 7468 206d 6967  !!! fit with mig
-0001d1a0: 7261 6420 6661 696c 6564 2729 0a0a 2020  rad failed')..  
-0001d1b0: 2020 2320 706f 7373 6962 6c79 2c20 6e65    # possibly, ne
-0001d1c0: 6564 2074 6f20 6974 6572 6174 650a 2020  ed to iterate.  
-0001d1d0: 2020 6966 2073 656c 662e 6974 6572 6174    if self.iterat
-0001d1e0: 6546 6974 3a0a 2020 2020 2020 6966 206e  eFit:.      if n
-0001d1f0: 6f74 2073 656c 662e 7175 6965 743a 0a20  ot self.quiet:. 
-0001d200: 2020 2020 2020 2070 7269 6e74 2820 272a         print( '*
-0001d210: 3d3d 2a20 6d6e 4669 7420 6974 6572 6174  ==* mnFit iterat
-0001d220: 696e 6727 2c0a 2020 2020 2020 2020 2020  ing',.          
-0001d230: 2020 2020 2027 746f 2061 6363 6f75 6e74       'to account
-0001d240: 2066 6f72 2070 6172 616d 6574 6572 2d64   for parameter-d
-0001d250: 6570 656e 6465 6e74 2075 6e63 6572 7461  ependent uncerta
-0001d260: 696e 7469 6573 2729 0a20 2020 2020 2023  inties').      #
-0001d270: 2065 6e61 626c 6520 6479 6e61 6d69 6320   enable dynamic 
-0001d280: 6361 6c63 756c 6174 696f 6e20 6f66 2063  calculation of c
-0001d290: 6f76 6172 6961 6e63 6520 6d61 7472 6978  ovariance matrix
-0001d2a0: 0a20 2020 2020 2073 656c 662e 6461 7461  .      self.data
-0001d2b0: 2e69 6e69 745f 6479 6e61 6d69 6345 7272  .init_dynamicErr
-0001d2c0: 6f72 7328 290a 0a20 2020 2020 2023 2066  ors()..      # f
-0001d2d0: 6974 2077 6974 6820 6479 6e61 6d69 6320  it with dynamic 
-0001d2e0: 7265 6361 6c63 756c 6174 696f 6e20 6f66  recalculation of
-0001d2f0: 2063 6f76 6172 6961 6e63 6520 6d61 7472   covariance matr
-0001d300: 6978 0a20 2020 2020 2074 7279 3a0a 2020  ix.      try:.  
-0001d310: 2020 2020 2020 7365 6c66 2e6d 6967 7261        self.migra
-0001d320: 6452 6573 756c 7420 3d20 7365 6c66 2e6d  dResult = self.m
-0001d330: 696e 7569 742e 6d69 6772 6164 2829 0a20  inuit.migrad(). 
-0001d340: 2020 2020 2020 2073 656c 662e 6d69 6772         self.migr
-0001d350: 6164 5f6f 6b20 3d20 5472 7565 0a20 2020  ad_ok = True.   
-0001d360: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0001d370: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-0001d380: 2020 7365 6c66 2e6d 6967 7261 645f 6f6b    self.migrad_ok
-0001d390: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-0001d3a0: 2070 7269 6e74 2865 290a 2020 2020 2020   print(e).      
-0001d3b0: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
-0001d3c0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0001d3d0: 272a 3d3d 2a20 2121 2120 6974 6572 6174  '*==* !!! iterat
-0001d3e0: 696f 6e20 6f66 2066 6974 2077 6974 6820  ion of fit with 
-0001d3f0: 6d69 6772 6164 2066 6169 6c65 6427 290a  migrad failed').
-0001d400: 0a20 2020 2023 2072 756e 2070 726f 6669  .    # run profi
-0001d410: 6c65 206c 696b 656c 6968 6f6f 6420 7363  le likelihood sc
-0001d420: 616e 2074 6f20 6368 6563 6b20 666f 7220  an to check for 
-0001d430: 6173 796d 6d65 7472 6963 2065 7272 6f72  asymmetric error
-0001d440: 730a 2020 2020 6966 2073 656c 662e 7275  s.    if self.ru
-0001d450: 6e5f 6d69 6e6f 733a 0a20 2020 2020 2069  n_minos:.      i
-0001d460: 6620 6e6f 7420 7365 6c66 2e71 7569 6574  f not self.quiet
-0001d470: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-0001d480: 2027 2a3d 3d2a 206d 6e46 6974 2073 7461   '*==* mnFit sta
-0001d490: 7274 696e 6720 6d69 6e6f 7320 7363 616e  rting minos scan
-0001d4a0: 2729 0a20 2020 2020 2074 7279 3a20 200a  ').      try:  .
-0001d4b0: 2020 2020 2020 2020 7365 6c66 2e6d 696e          self.min
-0001d4c0: 6f73 5265 7375 6c74 203d 2073 656c 662e  osResult = self.
-0001d4d0: 6d69 6e75 6974 2e6d 696e 6f73 2829 0a20  minuit.minos(). 
-0001d4e0: 2020 2020 2020 2073 656c 662e 6d69 6e6f         self.mino
-0001d4f0: 735f 6f6b 203d 2054 7275 650a 2020 2020  s_ok = True.    
-0001d500: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-0001d510: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-0001d520: 2073 656c 662e 6d69 6e6f 735f 6f6b 203d   self.minos_ok =
-0001d530: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
-0001d540: 6620 6e6f 7420 7365 6c66 2e71 7569 6574  f not self.quiet
-0001d550: 3a0a 2020 2020 2020 2020 2020 7072 696e  :.          prin
-0001d560: 7428 2027 2a3d 3d2a 206d 6e46 6974 3a20  t( '*==* mnFit: 
-0001d570: 2121 2120 6d69 6e6f 7320 6661 696c 6564  !!! minos failed
-0001d580: 205c 6e27 2c20 6529 2020 2020 0a20 2020   \n', e)    .   
-0001d590: 2073 656c 662e 5f73 746f 7265 5265 7375   self._storeResu
-0001d5a0: 6c74 2829 0a20 2020 2072 6574 7572 6e20  lt().    return 
-0001d5b0: 7365 6c66 2e6d 6967 7261 6452 6573 756c  self.migradResul
-0001d5c0: 742c 2073 656c 662e 6d69 6e6f 7352 6573  t, self.minosRes
-0001d5d0: 756c 740a 0a0a 2020 6465 6620 7365 7450  ult...  def setP
-0001d5e0: 6c6f 744f 7074 696f 6e73 2873 656c 6629  lotOptions(self)
-0001d5f0: 3a0a 2020 2020 2222 2253 6574 206f 7074  :.    """Set opt
-0001d600: 696f 6e73 2066 6f72 206e 6963 6572 2070  ions for nicer p
-0001d610: 6c6f 7474 696e 670a 2020 2020 2222 220a  lotting.    """.
-0001d620: 0a20 2020 2023 2074 6f20 6265 2069 6d70  .    # to be imp
-0001d630: 6c65 6d65 6e74 6564 0a20 2020 2070 6173  lemented.    pas
-0001d640: 730a 0a20 2064 6566 2070 6c6f 744d 6f64  s..  def plotMod
-0001d650: 656c 2873 656c 662c 0a20 2020 2020 2020  el(self,.       
-0001d660: 2020 2020 2020 2020 2061 7869 735f 6c61           axis_la
-0001d670: 6265 6c73 3d5b 2778 272c 2027 7920 3d20  bels=['x', 'y = 
-0001d680: 6628 782c 202a 7061 7229 275d 2c20 0a20  f(x, *par)'], . 
-0001d690: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0001d6a0: 6174 615f 6c65 6765 6e64 203d 2027 6461  ata_legend = 'da
-0001d6b0: 7461 272c 2020 2020 0a20 2020 2020 2020  ta',    .       
-0001d6c0: 2020 2020 2020 2020 206d 6f64 656c 5f6c           model_l
-0001d6d0: 6567 656e 6420 3d20 2766 6974 272c 0a20  egend = 'fit',. 
-0001d6e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001d6f0: 6c6f 745f 6261 6e64 3d54 7275 652c 0a20  lot_band=True,. 
-0001d700: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001d710: 616d 655f 706c 6f74 3d20 4661 6c73 652c  ame_plot= False,
-0001d720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d730: 2070 6c6f 745f 7265 7369 6475 616c 3d46   plot_residual=F
-0001d740: 616c 7365 293a 200a 2020 2020 2222 220a  alse): .    """.
-0001d750: 2020 2020 506c 6f74 206d 6f64 656c 2066      Plot model f
-0001d760: 756e 6374 696f 6e20 616e 6420 6461 7461  unction and data
-0001d770: 200a 2020 2020 0a20 2020 2055 7365 7320   .    .    Uses 
-0001d780: 696d 696e 7569 744f 626a 6563 742c 2063  iminuitObject, c
-0001d790: 6f73 7420 4675 6e63 7469 6f6e 2028 616e  ost Function (an
-0001d7a0: 6420 6461 7461 206f 626a 6563 7429 0a0a  d data object)..
-0001d7b0: 2020 2020 4172 6773 3a20 0a20 2020 2020      Args: .     
-0001d7c0: 202a 206c 6973 7420 6f66 2073 7472 3a20   * list of str: 
-0001d7d0: 6178 6973 206c 6162 656c 730a 2020 2020  axis labels.    
-0001d7e0: 2020 2a20 7374 723a 206c 6567 656e 6420    * str: legend 
-0001d7f0: 666f 7220 6461 7461 0a20 2020 2020 202a  for data.      *
-0001d800: 2073 7472 3a20 6c65 6765 6e64 2066 6f72   str: legend for
-0001d810: 206d 6f64 656c 200a 2020 2020 2020 2a20   model .      * 
-0001d820: 706c 6f74 5f62 616e 643a 2070 6c6f 7420  plot_band: plot 
-0001d830: 6d6f 6465 6c20 636f 6e66 6964 656e 6365  model confidence
-0001d840: 2062 616e 6420 6966 2054 7275 650a 2020   band if True.  
-0001d850: 2020 2020 2a20 7361 6d65 5f70 6c6f 743a      * same_plot:
-0001d860: 2061 6363 756d 756c 6174 6520 6669 7420   accumulate fit 
-0001d870: 7265 7375 6c74 7320 6672 6f6d 2070 7265  results from pre
-0001d880: 7669 6f75 7320 6361 6c6c 2069 6620 5472  vious call if Tr
-0001d890: 7565 0a20 2020 2020 202a 2070 6c6f 745f  ue.      * plot_
-0001d8a0: 7265 7369 6475 616c 3a20 706c 6f74 2072  residual: plot r
-0001d8b0: 6573 6964 7561 6c20 772e 722e 742e 206d  esidual w.r.t. m
-0001d8c0: 6f64 656c 2069 6620 5472 7565 0a0a 2020  odel if True..  
-0001d8d0: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-0001d8e0: 202a 206d 6174 706c 6f74 6c69 6220 6669   * matplotlib fi
-0001d8f0: 6775 7265 0a20 2020 2022 2222 0a20 2020  gure.    """.   
-0001d900: 200a 2020 2320 6163 6365 7373 206f 626a   .  # access obj
-0001d910: 6563 7473 0a20 2020 206d 203d 2073 656c  ects.    m = sel
-0001d920: 662e 6d69 6e75 6974 2020 2320 6d69 6e75  f.minuit  # minu
-0001d930: 6974 206f 626a 6563 740a 2020 2020 6366  it object.    cf
-0001d940: 203d 2073 656c 662e 636f 7374 6620 2023   = self.costf  #
-0001d950: 2063 6f73 7420 6675 6e63 7469 6f6e 206f   cost function o
-0001d960: 626a 6563 740a 2020 2020 6420 3d20 6366  bject.    d = cf
-0001d970: 2e64 6174 610a 2020 2020 6e70 7473 203d  .data.    npts =
-0001d980: 206d 6178 2831 3930 2c20 352a 642e 646c   max(190, 5*d.dl
-0001d990: 656e 6774 6829 2023 206e 756d 6265 7220  ength) # number 
-0001d9a0: 6f66 2070 6f69 6e74 7320 666f 7220 6d6f  of points for mo
-0001d9b0: 6465 6c20 6675 6e63 7469 6f6e 0a20 2020  del function.   
-0001d9c0: 200a 2020 2320 7265 7472 6965 7665 2066   .  # retrieve f
-0001d9d0: 6974 2072 6573 756c 7473 0a20 2020 2070  it results.    p
-0001d9e0: 6e61 6d73 203d 2073 656c 662e 5061 7261  nams = self.Para
-0001d9f0: 6d65 7465 724e 616d 6573 0a20 2020 2070  meterNames.    p
-0001da00: 7661 6c73 203d 2073 656c 662e 5061 7261  vals = self.Para
-0001da10: 6d65 7465 7256 616c 7565 730a 2020 2020  meterValues.    
-0001da20: 706d 6572 7273 203d 2073 656c 662e 4f6e  pmerrs = self.On
-0001da30: 6553 6967 496e 7465 7276 616c 0a20 2020  eSigInterval.   
-0001da40: 2023 2020 7379 6d6d 6574 7269 6320 6572   #  symmetric er
-0001da50: 726f 7273 0a20 2020 2070 6572 7273 203d  rors.    perrs =
-0001da60: 2028 706d 6572 7273 5b3a 2c31 5d2d 706d   (pmerrs[:,1]-pm
-0001da70: 6572 7273 5b3a 2c30 5d29 2f32 2e0a 2020  errs[:,0])/2..  
-0001da80: 2020 636f 7220 3d20 7365 6c66 2e43 6f72    cor = self.Cor
-0001da90: 7265 6c61 7469 6f6e 4d61 7472 6978 0a20  relationMatrix. 
-0001daa0: 2020 2023 2020 636f 7661 7269 616e 6365     #  covariance
-0001dab0: 206d 6174 7269 7820 6672 6f6d 2063 6f72   matrix from cor
-0001dac0: 7265 6c61 7469 6f6e 730a 2020 2020 7063  relations.    pc
-0001dad0: 6f76 203d 2063 6f72 202a 206e 702e 6f75  ov = cor * np.ou
-0001dae0: 7465 7228 7065 7272 732c 2070 6572 7273  ter(perrs, perrs
-0001daf0: 290a 2020 2020 676f 6620 3d20 7365 6c66  ).    gof = self
-0001db00: 2e47 6f46 0a20 2020 206e 646f 6620 3d20  .GoF.    ndof = 
-0001db10: 6366 2e6e 646f 660a 2020 2020 2320 2063  cf.ndof.    #  c
-0001db20: 6869 3270 7262 0a20 2020 2069 6620 676f  hi2prb.    if go
-0001db30: 6620 6973 206e 6f74 204e 6f6e 653a 0a20  f is not None:. 
-0001db40: 2020 2020 2063 6869 3270 7262 203d 2073       chi2prb = s
-0001db50: 656c 662e 6368 6932 7072 6228 676f 662c  elf.chi2prb(gof,
-0001db60: 206e 646f 6629 200a 2020 2020 656c 7365   ndof) .    else
-0001db70: 3a0a 2020 2020 2020 6368 6932 7072 6220  :.      chi2prb 
-0001db80: 3d20 4e6f 6e65 2020 2020 2020 0a20 2020  = None      .   
-0001db90: 2023 2076 616c 7565 7320 6f66 2066 7265   # values of fre
-0001dba0: 6520 616e 6420 6669 7865 6420 7061 7261  e and fixed para
-0001dbb0: 6d65 7465 7273 0a20 2020 2066 6978 6564  meters.    fixed
-0001dbc0: 5061 7273 203d 2073 656c 662e 6669 7865  Pars = self.fixe
-0001dbd0: 6450 6172 730a 2020 2020 6672 6565 5f70  dPars.    free_p
-0001dbe0: 7661 6c73 203d 2073 656c 662e 6672 6565  vals = self.free
-0001dbf0: 5061 7256 616c 730a 2020 2020 6672 6565  ParVals.    free
-0001dc00: 5f70 6e61 6d73 203d 2073 656c 662e 6672  _pnams = self.fr
-0001dc10: 6565 5061 724e 616d 730a 2020 2020 6669  eeParNams.    fi
-0001dc20: 7865 645f 706e 616d 733d 2073 656c 662e  xed_pnams= self.
-0001dc30: 6669 7865 6450 6172 4e61 6d73 0a20 2020  fixedParNams.   
-0001dc40: 2066 6978 6564 5f70 7661 6c73 3d20 7365   fixed_pvals= se
-0001dc50: 6c66 2e66 6978 6564 5061 7256 616c 730a  lf.fixedParVals.
-0001dc60: 2020 2020 6e66 6978 6564 203d 206c 656e      nfixed = len
-0001dc70: 2866 6978 6564 5f70 7661 6c73 290a 2020  (fixed_pvals).  
-0001dc80: 2020 0a20 2023 2070 6c6f 7420 6461 7461    .  # plot data
-0001dc90: 0a20 2020 2066 6967 5f6d 6f64 656c 203d  .    fig_model =
-0001dca0: 2064 2e70 6c6f 7428 6669 6773 697a 653d   d.plot(figsize=
-0001dcb0: 2837 2e35 2c20 362e 3529 2c0a 2020 2020  (7.5, 6.5),.    
-0001dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dcd0: 2020 2064 6174 615f 6c61 6265 6c3d 6461     data_label=da
-0001dce0: 7461 5f6c 6567 656e 642c 0a20 2020 2020  ta_legend,.     
-0001dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd00: 2020 706c 6f74 5f72 6573 6964 7561 6c3d    plot_residual=
-0001dd10: 706c 6f74 5f72 6573 6964 7561 6c29 0a0a  plot_residual)..
-0001dd20: 2020 2320 6f76 6572 6c61 7920 6d6f 6465    # overlay mode
-0001dd30: 6c20 6675 6e63 7469 6f6e 0a20 2020 2023  l function.    #
-0001dd40: 2068 6973 746f 6772 616d 2066 6974 2070   histogram fit p
-0001dd50: 726f 7669 6465 7320 6e6f 726d 616c 6973  rovides normalis
-0001dd60: 6564 2064 6973 7472 6962 7574 696f 6e2c  ed distribution,
-0001dd70: 0a20 2020 2023 2020 2020 6465 7465 726d  .    #    determ
-0001dd80: 696e 6520 6269 6e20 7769 6474 6873 2061  ine bin widths a
-0001dd90: 6e64 2073 6361 6c65 2066 6163 746f 720a  nd scale factor.
-0001dda0: 2020 2020 786d 696e 2c20 786d 6178 203d      xmin, xmax =
-0001ddb0: 2070 6c74 2e78 6c69 6d28 290a 2020 2020   plt.xlim().    
-0001ddc0: 7870 6c74 203d 206e 702e 6c69 6e73 7061  xplt = np.linspa
-0001ddd0: 6365 2878 6d69 6e2c 2078 6d61 782c 206e  ce(xmin, xmax, n
-0001dde0: 7074 7329 0a20 2020 2078 7661 6c73 203d  pts).    xvals =
-0001ddf0: 2078 706c 7420 0a20 2020 2069 6620 7365   xplt .    if se
-0001de00: 6c66 2e66 6974 5f74 7970 653d 3d27 6869  lf.fit_type=='hi
-0001de10: 7374 273a 0a20 2020 2020 2023 2064 6574  st':.      # det
-0001de20: 656d 696e 6520 6c6f 6361 6c20 6269 6e20  emine local bin 
-0001de30: 7769 6474 680a 2020 2020 2020 6277 6964  width.      bwid
-0001de40: 7468 7320 3d20 6e70 2e7a 6572 6f73 286c  ths = np.zeros(l
-0001de50: 656e 2878 706c 7429 290a 2020 2020 2020  en(xplt)).      
-0001de60: 693d 300a 2020 2020 2020 666f 7220 6a2c  i=0.      for j,
-0001de70: 2078 2069 6e20 656e 756d 6572 6174 6528   x in enumerate(
-0001de80: 7870 6c74 293a 0a20 2020 2020 2020 2069  xplt):.        i
-0001de90: 6620 7820 3e3d 2063 662e 6461 7461 2e72  f x >= cf.data.r
-0001dea0: 6967 6874 735b 6d69 6e28 692c 2063 662e  ights[min(i, cf.
-0001deb0: 6461 7461 2e6e 6269 6e73 2d31 295d 3a0a  data.nbins-1)]:.
-0001dec0: 2020 2020 2020 2020 2020 6920 2b3d 2031            i += 1
-0001ded0: 0a20 2020 2020 2020 2062 7769 6474 6873  .        bwidths
-0001dee0: 5b6a 5d20 3d20 6366 2e64 6174 612e 7769  [j] = cf.data.wi
-0001def0: 6474 6873 5b6d 696e 2869 2c20 6366 2e64  dths[min(i, cf.d
-0001df00: 6174 612e 6e62 696e 732d 3129 5d0a 2020  ata.nbins-1)].  
-0001df10: 2020 2020 7366 6163 203d 2063 662e 6e6f      sfac = cf.no
-0001df20: 726d 202a 2062 7769 6474 6873 0a20 2020  rm * bwidths.   
-0001df30: 2065 6c69 6620 7365 6c66 2e66 6974 5f74   elif self.fit_t
-0001df40: 7970 653d 3d22 7879 2220 6f72 2073 656c  ype=="xy" or sel
-0001df50: 662e 6669 745f 7479 7065 3d3d 276d 6c27  f.fit_type=='ml'
-0001df60: 3a0a 2020 2020 2020 7366 6163 203d 2031  :.      sfac = 1
-0001df70: 2e0a 2020 2020 656c 6966 2073 656c 662e  ..    elif self.
-0001df80: 6669 745f 7479 7065 3d3d 2269 6e64 6578  fit_type=="index
-0001df90: 6564 223a 0a20 2020 2020 2073 6661 6320  ed":.      sfac 
-0001dfa0: 3d20 312e 0a20 2020 2020 2078 7661 6c73  = 1..      xvals
-0001dfb0: 203d 2063 662e 6461 7461 2e78 0a20 2020   = cf.data.x.   
-0001dfc0: 2020 2078 706c 7420 3d20 6e70 2e6c 696e     xplt = np.lin
-0001dfd0: 7370 6163 6528 302e 352c 206c 656e 2878  space(0.5, len(x
-0001dfe0: 7661 6c73 292d 302e 352c 206c 656e 2878  vals)-0.5, len(x
-0001dff0: 7661 6c73 2929 0a20 2020 2065 6c73 653a  vals)).    else:
-0001e000: 0a20 2020 2020 2070 7269 6e74 2822 212a  .      print("!*
-0001e010: 2a21 206d 6e46 6974 2e70 6c6f 744d 6f64  *! mnFit.plotMod
-0001e020: 656c 3a20 756e 6b6e 6f77 6e20 6669 7420  el: unknown fit 
-0001e030: 7479 7065 3a20 222c 2073 656c 662e 6669  type: ", self.fi
-0001e040: 745f 7479 7065 290a 2020 2020 2020 7366  t_type).      sf
-0001e050: 6163 203d 2031 2e0a 2020 2020 2020 7265  ac = 1..      re
-0001e060: 7475 726e 0a20 2020 200a 2020 2020 2320  turn.    .    # 
-0001e070: 646f 2077 6520 7761 6e74 206d 6f64 656c  do we want model
-0001e080: 206f 7220 7265 7369 6475 616c 7320 3f20   or residuals ? 
-0001e090: 200a 2020 2020 6966 2070 6c6f 745f 7265   .    if plot_re
-0001e0a0: 7369 6475 616c 3a0a 2020 2020 2020 7970  sidual:.      yp
-0001e0b0: 6c74 203d 206e 702e 7a65 726f 7328 6c65  lt = np.zeros(le
-0001e0c0: 6e28 7870 6c74 2929 0a20 2020 2065 6c73  n(xplt)).    els
-0001e0d0: 653a 0a20 2020 2020 2079 706c 7420 3d20  e:.      yplt = 
-0001e0e0: 6366 2e6d 6f64 656c 2878 7661 6c73 2c20  cf.model(xvals, 
-0001e0f0: 2a70 7661 6c73 290a 0a20 2020 2023 2020  *pvals)..    #  
-0001e100: 706c 6f74 206d 6f64 656c 206c 696e 650a  plot model line.
-0001e110: 2020 2020 6966 2073 656c 662e 6669 745f      if self.fit_
-0001e120: 7479 7065 203d 3d20 2269 6e64 6578 6564  type == "indexed
-0001e130: 223a 0a20 2020 2020 2070 6c74 2e65 7272  ":.      plt.err
-0001e140: 6f72 6261 7228 7870 6c74 2c20 7970 6c74  orbar(xplt, yplt
-0001e150: 2c20 666d 743d 2720 272c 2078 6572 723d  , fmt=' ', xerr=
-0001e160: 302e 342c 206c 6162 656c 3d6d 6f64 656c  0.4, label=model
-0001e170: 5f6c 6567 656e 642c 0a20 2020 2020 2020  _legend,.       
-0001e180: 2020 2020 2020 2020 2020 2020 2020 616c                al
-0001e190: 7068 613d 302e 372c 2065 6c69 6e65 7769  pha=0.7, elinewi
-0001e1a0: 6474 683d 322e 352c 2063 6f6c 6f72 3d27  dth=2.5, color='
-0001e1b0: 6461 726b 6f72 616e 6765 2729 0a20 2020  darkorange').   
-0001e1c0: 2065 6c73 653a 0a20 2020 2020 2070 6c74   else:.      plt
-0001e1d0: 2e70 6c6f 7428 7870 6c74 2c20 7970 6c74  .plot(xplt, yplt
-0001e1e0: 2a73 6661 632c 206c 6162 656c 3d6d 6f64  *sfac, label=mod
-0001e1f0: 656c 5f6c 6567 656e 642c 0a20 2020 2020  el_legend,.     
-0001e200: 2020 2020 2020 2020 6c69 6e65 7374 796c          linestyl
-0001e210: 653d 2764 6173 6865 6427 2c20 6c69 6e65  e='dashed', line
-0001e220: 7769 6474 683d 322e 352c 2061 6c70 6861  width=2.5, alpha
-0001e230: 203d 2030 2e37 290a 2020 2023 2320 2020   = 0.7).   ##   
-0001e240: 2020 2020 2020 2063 6f6c 6f72 3d27 6461         color='da
-0001e250: 726b 6f72 616e 6765 2729 0a20 2020 2070  rkorange').    p
-0001e260: 6c74 2e78 6c61 6265 6c28 6178 6973 5f6c  lt.xlabel(axis_l
-0001e270: 6162 656c 735b 305d 2c20 7369 7a65 3d27  abels[0], size='
-0001e280: 782d 6c61 7267 6527 290a 2020 2020 706c  x-large').    pl
-0001e290: 742e 796c 6162 656c 2861 7869 735f 6c61  t.ylabel(axis_la
-0001e2a0: 6265 6c73 5b31 5d2c 2073 697a 653d 2778  bels[1], size='x
-0001e2b0: 2d6c 6172 6765 2729 0a20 2020 2070 6c74  -large').    plt
-0001e2c0: 2e67 7269 6428 290a 0a20 2020 2023 2064  .grid()..    # d
-0001e2d0: 7261 7720 6572 726f 7220 6261 6e64 2061  raw error band a
-0001e2e0: 726f 756e 6420 6d6f 6465 6c20 6675 6e63  round model func
-0001e2f0: 7469 6f6e 0a20 2020 2069 6620 706c 6f74  tion.    if plot
-0001e300: 5f62 616e 643a 0a20 2020 2020 2069 6620  _band:.      if 
-0001e310: 7365 6c66 2e66 6974 5f74 7970 6520 213d  self.fit_type !=
-0001e320: 2022 696e 6465 7865 6422 3a0a 2020 2020   "indexed":.    
-0001e330: 2020 2020 4465 6c74 6146 203d 2073 656c      DeltaF = sel
-0001e340: 662e 6765 7446 756e 6374 696f 6e45 7272  f.getFunctionErr
-0001e350: 6f72 2878 706c 742c 2063 662e 6d6f 6465  or(xplt, cf.mode
-0001e360: 6c2c 2070 7661 6c73 2c20 7063 6f76 2c20  l, pvals, pcov, 
-0001e370: 6669 7865 6450 6172 7329 0a20 2020 2020  fixedPars).     
-0001e380: 2020 2070 6c74 2e66 696c 6c5f 6265 7477     plt.fill_betw
-0001e390: 6565 6e28 7870 6c74 2c20 7366 6163 2a28  een(xplt, sfac*(
-0001e3a0: 7970 6c74 2b44 656c 7461 4629 2c0a 2020  yplt+DeltaF),.  
-0001e3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3c0: 2020 2020 2020 2020 2020 2073 6661 632a             sfac*
-0001e3d0: 2879 706c 742d 4465 6c74 6146 292c 0a20  (yplt-DeltaF),. 
-0001e3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3f0: 2020 2020 2020 2020 2020 2020 616c 7068              alph
-0001e400: 613d 302e 332c 2063 6f6c 6f72 3d27 6461  a=0.3, color='da
-0001e410: 726b 6b68 616b 6927 2c20 6c61 6265 6c3d  rkkhaki', label=
-0001e420: 2720 2024 5c70 6d20 3120 5c73 6967 6d61  '  $\pm 1 \sigma
-0001e430: 2427 290a 2020 2020 2020 2020 706c 742e  $').        plt.
-0001e440: 706c 6f74 2878 706c 742c 2073 6661 632a  plot(xplt, sfac*
-0001e450: 2879 706c 742b 4465 6c74 6146 292c 206c  (yplt+DeltaF), l
-0001e460: 696e 6577 6964 7468 3d31 2c20 0a20 2020  inewidth=1, .   
-0001e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e480: 2020 2020 2020 2020 2020 616c 7068 613d            alpha=
-0001e490: 302e 342c 2063 6f6c 6f72 3d27 6461 726b  0.4, color='dark
-0001e4a0: 6772 6565 6e27 290a 2020 2020 2020 2020  green').        
-0001e4b0: 706c 742e 706c 6f74 2878 706c 742c 2073  plt.plot(xplt, s
-0001e4c0: 6661 632a 2879 706c 742d 4465 6c74 6146  fac*(yplt-DeltaF
-0001e4d0: 292c 206c 696e 6577 6964 7468 3d31 2c0a  ), linewidth=1,.
-0001e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4f0: 2020 2020 2020 2020 2020 2020 2061 6c70               alp
-0001e500: 6861 3d30 2e34 2c20 636f 6c6f 723d 2764  ha=0.4, color='d
-0001e510: 6172 6b67 7265 656e 2729 0a20 2020 2020  arkgreen').     
-0001e520: 2065 6c73 653a 0a20 2020 2020 2020 2044   else:.        D
-0001e530: 656c 7461 203d 2073 656c 662e 6765 7446  elta = self.getF
-0001e540: 756e 6374 696f 6e45 7272 6f72 2878 7661  unctionError(xva
-0001e550: 6c73 2c20 6366 2e6d 6f64 656c 2c20 7076  ls, cf.model, pv
-0001e560: 616c 732c 2070 636f 762c 2066 6978 6564  als, pcov, fixed
-0001e570: 5061 7273 290a 2020 2020 2020 2020 706c  Pars).        pl
-0001e580: 742e 6572 726f 7262 6172 2878 706c 742c  t.errorbar(xplt,
-0001e590: 2079 706c 742b 4465 6c74 612c 2066 6d74   yplt+Delta, fmt
-0001e5a0: 3d27 2027 2c20 7865 7272 3d30 2e34 2c0a  =' ', xerr=0.4,.
-0001e5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5c0: 2020 2020 2061 6c70 6861 3d30 2e37 2c20       alpha=0.7, 
-0001e5d0: 656c 696e 6577 6964 7468 3d31 2e30 2c20  elinewidth=1.0, 
-0001e5e0: 636f 6c6f 723d 2764 6172 6b67 7265 656e  color='darkgreen
-0001e5f0: 2729 0a20 2020 2020 2020 2070 6c74 2e65  ').        plt.e
-0001e600: 7272 6f72 6261 7228 7870 6c74 2c20 7970  rrorbar(xplt, yp
-0001e610: 6c74 2d44 656c 7461 2c20 666d 743d 2720  lt-Delta, fmt=' 
-0001e620: 272c 2078 6572 723d 302e 342c 0a20 2020  ', xerr=0.4,.   
-0001e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e640: 2020 616c 7068 613d 302e 372c 2065 6c69    alpha=0.7, eli
-0001e650: 6e65 7769 6474 683d 312e 2c20 636f 6c6f  newidth=1., colo
-0001e660: 723d 2764 6172 6b67 7265 656e 2729 0a20  r='darkgreen'). 
-0001e670: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0001e680: 7261 6e67 6528 6c65 6e28 7870 6c74 2929  range(len(xplt))
-0001e690: 3a0a 2020 2020 2020 2020 2020 206c 626c  :.           lbl
-0001e6a0: 203d 2027 245c 706d 2031 205c 7369 676d   = '$\pm 1 \sigm
-0001e6b0: 6124 2720 6966 2069 3d3d 3020 656c 7365  a$' if i==0 else
-0001e6c0: 2027 270a 2020 2020 2020 2020 2020 2070   ''.           p
-0001e6d0: 6c74 2e61 7868 7370 616e 2879 706c 745b  lt.axhspan(yplt[
-0001e6e0: 695d 2d44 656c 7461 5b69 5d2c 2079 706c  i]-Delta[i], ypl
-0001e6f0: 745b 695d 2b44 656c 7461 5b69 5d2c 0a20  t[i]+Delta[i],. 
-0001e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e710: 2020 2020 2020 786d 696e 3d28 7870 6c74        xmin=(xplt
-0001e720: 5b69 5d2d 302e 3429 2f6c 656e 2878 706c  [i]-0.4)/len(xpl
-0001e730: 7429 2c0a 2020 2020 2020 2020 2020 2020  t),.            
-0001e740: 2020 2020 2020 2020 2020 2078 6d61 783d             xmax=
-0001e750: 2878 706c 745b 695d 2b30 2e34 292f 6c65  (xplt[i]+0.4)/le
-0001e760: 6e28 7870 6c74 292c 0a20 2020 2020 2020  n(xplt),.       
-0001e770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e780: 616c 7068 613d 302e 332c 2063 6f6c 6f72  alpha=0.3, color
-0001e790: 3d27 6461 726b 6b68 616b 6927 2c20 6c61  ='darkkhaki', la
-0001e7a0: 6265 6c3d 6c62 6c29 200a 2020 2020 2020  bel=lbl) .      
-0001e7b0: 200a 2020 2320 6469 7370 6c61 7920 6c65   .  # display le
-0001e7c0: 6765 6e64 2077 6974 6820 6669 7420 696e  gend with fit in
-0001e7d0: 666f 200a 2020 2020 676c 6f62 616c 2066  fo .    global f
-0001e7e0: 6974 5f69 6e66 6f0a 2020 2020 6966 2073  it_info.    if s
-0001e7f0: 616d 655f 706c 6f74 3a0a 2020 2020 2020  ame_plot:.      
-0001e800: 7472 793a 2066 6974 5f69 6e66 6f0a 2020  try: fit_info.  
-0001e810: 2020 2020 6578 6365 7074 204e 616d 6545      except NameE
-0001e820: 7272 6f72 3a20 6669 745f 696e 666f 203d  rror: fit_info =
-0001e830: 205b 5d0a 2020 2020 656c 7365 3a0a 2020   [].    else:.  
-0001e840: 2020 2020 6669 745f 696e 666f 203d 205b      fit_info = [
-0001e850: 5d20 2020 2020 200a 0a20 2020 2023 2020  ]      ..    #  
-0001e860: 312e 2070 6172 616d 6574 6572 2076 616c  1. parameter val
-0001e870: 7565 7320 616e 6420 756e 6365 7274 6169  ues and uncertai
-0001e880: 6e74 6965 730a 2020 2020 7065 203d 2032  nties.    pe = 2
-0001e890: 2020 2023 206e 756d 6265 7220 6f66 2073     # number of s
-0001e8a0: 6967 6e69 6669 6361 6e74 2064 6967 6974  ignificant digit
-0001e8b0: 7320 6f66 2075 6e63 6572 7461 696e 7479  s of uncertainty
-0001e8c0: 0a20 2020 2069 6620 7365 6c66 2e6d 696e  .    if self.min
-0001e8d0: 6f73 5265 7375 6c74 2069 7320 6e6f 7420  osResult is not 
-0001e8e0: 4e6f 6e65 2061 6e64 2073 656c 662e 6d69  None and self.mi
-0001e8f0: 6e6f 735f 6f6b 3a0a 2020 2020 2020 666f  nos_ok:.      fo
-0001e900: 7220 706e 2c20 762c 2065 2069 6e20 7a69  r pn, v, e in zi
-0001e910: 7028 6672 6565 5f70 6e61 6d73 2c20 6672  p(free_pnams, fr
-0001e920: 6565 5f70 7661 6c73 2c20 706d 6572 7273  ee_pvals, pmerrs
-0001e930: 293a 0a20 2020 2020 2020 206e 642c 205f  ):.        nd, _
-0001e940: 762c 205f 6520 3d20 726f 756e 645f 746f  v, _e = round_to
-0001e950: 5f65 7272 6f72 2876 2c6d 696e 2861 6273  _error(v,min(abs
-0001e960: 2865 5b30 5d29 2c61 6273 2865 5b31 5d29  (e[0]),abs(e[1])
-0001e970: 292c 6e73 645f 653d 7065 290a 2020 2020  ),nsd_e=pe).    
-0001e980: 2020 2020 7478 743d 227b 7d20 3d20 247b      txt="{} = ${
-0001e990: 3a23 2e7b 7076 7d67 7d5e 7b7b 2b7b 3a23  :#.{pv}g}^{{+{:#
-0001e9a0: 2e7b 7065 7d67 7d7d 7d5f 7b7b 7b3a 232e  .{pe}g}}}_{{{:#.
-0001e9b0: 7b70 657d 677d 7d7d 2422 0a20 2020 2020  {pe}g}}}$".     
-0001e9c0: 2020 2066 6974 5f69 6e66 6f2e 6170 7065     fit_info.appe
-0001e9d0: 6e64 2874 7874 2e66 6f72 6d61 7428 706e  nd(txt.format(pn
-0001e9e0: 2c20 5f76 2c20 655b 315d 2c20 655b 305d  , _v, e[1], e[0]
-0001e9f0: 2c20 7076 3d6e 642c 2070 653d 7065 2929  , pv=nd, pe=pe))
-0001ea00: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-0001ea10: 2066 6f72 2070 6e2c 2076 2c20 6520 696e   for pn, v, e in
-0001ea20: 207a 6970 2866 7265 655f 706e 616d 732c   zip(free_pnams,
-0001ea30: 2066 7265 655f 7076 616c 732c 2070 6d65   free_pvals, pme
-0001ea40: 7272 7329 3a0a 2020 2020 2020 2020 6e64  rrs):.        nd
-0001ea50: 2c20 5f76 2c20 5f65 203d 2072 6f75 6e64  , _v, _e = round
-0001ea60: 5f74 6f5f 6572 726f 7228 762c 2065 5b31  _to_error(v, e[1
-0001ea70: 5d2c 206e 7364 5f65 3d70 6529 0a20 2020  ], nsd_e=pe).   
-0001ea80: 2020 2020 2074 7874 3d22 7b7d 203d 2024       txt="{} = $
-0001ea90: 7b3a 232e 7b70 767d 677d 5c70 6d7b 3a23  {:#.{pv}g}\pm{:#
-0001eaa0: 2e7b 7065 7d67 7d24 220a 2020 2020 2020  .{pe}g}$".      
-0001eab0: 2020 6669 745f 696e 666f 2e61 7070 656e    fit_info.appen
-0001eac0: 6428 7478 742e 666f 726d 6174 2870 6e2c  d(txt.format(pn,
-0001ead0: 205f 762c 205f 652c 2070 763d 6e64 2c20   _v, _e, pv=nd, 
-0001eae0: 7065 3d70 6529 290a 2020 2020 6966 206e  pe=pe)).    if n
-0001eaf0: 6669 7865 643a 0a20 2020 2020 2066 6f72  fixed:.      for
-0001eb00: 2070 6e2c 2076 2069 6e20 7a69 7028 6669   pn, v in zip(fi
-0001eb10: 7865 645f 706e 616d 732c 2066 6978 6564  xed_pnams, fixed
-0001eb20: 5f70 7661 6c73 293a 0a20 2020 2020 2020  _pvals):.       
-0001eb30: 2074 7874 3d22 7b7d 203d 207b 3a67 7d20   txt="{} = {:g} 
-0001eb40: 2028 6669 7865 6429 220a 2020 2020 2020   (fixed)".      
-0001eb50: 2020 6669 745f 696e 666f 2e61 7070 656e    fit_info.appen
-0001eb60: 6428 7478 742e 666f 726d 6174 2870 6e2c  d(txt.format(pn,
-0001eb70: 2076 2929 0a20 2020 2020 2020 200a 2020   v)).        .  
-0001eb80: 2020 2320 2032 2e20 676f 6f64 6e65 7373    #  2. goodness
-0001eb90: 2d6f 662d 6669 740a 2020 2020 6966 2073  -of-fit.    if s
-0001eba0: 656c 662e 6669 745f 7479 7065 2069 6e20  elf.fit_type in 
-0001ebb0: 5b27 7879 272c 2027 696e 6465 7865 6427  ['xy', 'indexed'
-0001ebc0: 5d3a 0a20 2020 2020 2066 6974 5f69 6e66  ]:.      fit_inf
-0001ebd0: 6f2e 6170 7065 6e64 280a 2020 2020 2020  o.append(.      
-0001ebe0: 2020 2224 5c5c 6368 695e 3224 2f24 6e5f    "$\\chi^2$/$n_
-0001ebf0: 5c5c 6d61 7468 726d 7b7b 646f 667d 7d24  \\mathrm{{dof}}$
-0001ec00: 3d7b 3a2e 3166 7d2f 7b7d 222e 666f 726d  ={:.1f}/{}".form
-0001ec10: 6174 2867 6f66 2c6e 646f 6629 202b 205c  at(gof,ndof) + \
-0001ec20: 0a20 2020 2020 2020 2020 222c 2070 3d7b  .         ", p={
-0001ec30: 3a2e 3166 7d25 222e 666f 726d 6174 2831  :.1f}%".format(1
-0001ec40: 3030 2a63 6869 3270 7262 2920 290a 2020  00*chi2prb) ).  
-0001ec50: 2020 656c 6966 2073 656c 662e 6669 745f    elif self.fit_
-0001ec60: 7479 7065 3d3d 2768 6973 7427 3a0a 2020  type=='hist':.  
-0001ec70: 2020 2020 6669 745f 696e 666f 2e61 7070      fit_info.app
-0001ec80: 656e 6428 0a20 2020 2020 2020 2022 672e  end(.        "g.
-0001ec90: 6f2e 662e 2f24 6e5f 5c5c 6d61 7468 726d  o.f./$n_\\mathrm
-0001eca0: 7b7b 646f 667d 7d24 203d 207b 3a2e 3166  {{dof}}$ = {:.1f
-0001ecb0: 7d2f 7b7d 222e 666f 726d 6174 2867 6f66  }/{}".format(gof
-0001ecc0: 2c20 6e64 6f66 2920 290a 2020 2020 2320  , ndof) ).    # 
-0001ecd0: 2061 6464 206c 6567 656e 6420 746f 2070   add legend to p
-0001ece0: 6c6f 7420 200a 2020 2020 706c 742e 6c65  lot  .    plt.le
-0001ecf0: 6765 6e64 286c 6f63 3d27 6265 7374 272c  gend(loc='best',
-0001ed00: 2074 6974 6c65 3d22 5c6e 222e 6a6f 696e   title="\n".join
-0001ed10: 2866 6974 5f69 6e66 6f29 2920 2020 2020  (fit_info))     
-0001ed20: 200a 0a20 2020 2072 6574 7572 6e20 6669   ..    return fi
-0001ed30: 675f 6d6f 6465 6c0a 2020 0a23 2070 6c6f  g_model.  .# plo
-0001ed40: 7420 6172 7261 7920 6f66 2070 726f 6669  t array of profi
-0001ed50: 6c65 7320 616e 6420 636f 6e74 6f75 7273  les and contours
-0001ed60: 0a20 2064 6566 2070 6c6f 7443 6f6e 746f  .  def plotConto
-0001ed70: 7572 7328 7365 6c66 2c20 6669 676e 616d  urs(self, fignam
-0001ed80: 653d 2750 726f 6669 6c65 7320 616e 6420  e='Profiles and 
-0001ed90: 436f 6e74 6f75 7273 2729 3a0a 2020 2020  Contours'):.    
-0001eda0: 2222 220a 2020 2020 506c 6f74 2067 7269  """.    Plot gri
-0001edb0: 6420 6f66 2070 726f 6669 6c65 2063 7572  d of profile cur
-0001edc0: 7665 7320 616e 6420 6f6e 652d 2061 6e64  ves and one- and
-0001edd0: 2074 776f 2d73 6967 6d61 0a20 2020 2063   two-sigma.    c
-0001ede0: 6f6e 746f 7572 206c 696e 6573 2066 726f  ontour lines fro
-0001edf0: 6d20 696d 696e 7569 7420 6f62 6a65 6374  m iminuit object
-0001ee00: 0a0a 2020 2020 4172 673a 200a 2020 2020  ..    Arg: .    
-0001ee10: 2020 2a20 696d 696e 7569 744f 626a 6563    * iminuitObjec
-0001ee20: 740a 0a20 2020 2052 6574 7572 6e73 3a0a  t..    Returns:.
-0001ee30: 2020 2020 2020 2a20 6d61 7470 6c6f 746c        * matplotl
-0001ee40: 6962 2066 6967 7572 6520 0a20 2020 2022  ib figure .    "
-0001ee50: 2222 0a0a 2020 2020 6966 206e 6f74 2073  ""..    if not s
-0001ee60: 656c 662e 7175 6965 743a 0a20 2020 2020  elf.quiet:.     
-0001ee70: 2070 7269 6e74 2820 272a 3d3d 2a20 6d6e   print( '*==* mn
-0001ee80: 4669 743a 2073 6361 6e6e 696e 6720 636f  Fit: scanning co
-0001ee90: 6e74 6f75 7273 2729 0a0a 2020 2020 2320  ntours')..    # 
-0001eea0: 7361 7665 2063 6f6c 6f72 206d 6170 2061  save color map a
-0001eeb0: 6e64 2073 6574 206e 6577 206f 6e65 202d  nd set new one -
-0001eec0: 2061 6666 6563 7473 2069 6d69 6e75 6974   affects iminuit
-0001eed0: 2e64 7261 775f 6d6e 636f 6e74 6f75 7228  .draw_mncontour(
-0001eee0: 290a 2020 2020 6f72 6967 5f63 6d20 3d20  ).    orig_cm = 
-0001eef0: 706c 742e 6765 745f 636d 6170 2829 0a20  plt.get_cmap(). 
-0001ef00: 2020 2070 6c74 2e73 6574 5f63 6d61 7028     plt.set_cmap(
-0001ef10: 2774 6162 3230 6227 290a 0a20 2020 206d  'tab20b')..    m
-0001ef20: 203d 2073 656c 662e 6d69 6e75 6974 0a20   = self.minuit. 
-0001ef30: 2020 2066 706e 616d 7320 3d20 7365 6c66     fpnams = self
-0001ef40: 2e66 7265 6550 6172 4e61 6d73 0a20 2020  .freeParNams.   
-0001ef50: 2066 7076 616c 7320 3d20 7365 6c66 2e66   fpvals = self.f
-0001ef60: 7265 6550 6172 5661 6c73 0a20 2020 2066  reeParVals.    f
-0001ef70: 7065 7272 7320 3d20 7365 6c66 2e66 7265  perrs = self.fre
-0001ef80: 6550 6172 4572 7273 0a20 2020 206e 7061  eParErrs.    npa
-0001ef90: 7220 3d20 6c65 6e28 6670 6e61 6d73 290a  r = len(fpnams).
-0001efa0: 0a20 2020 2066 7369 7a65 203d 2033 2e35  .    fsize = 3.5
-0001efb0: 2069 6620 6e70 6172 3c3d 3320 656c 7365   if npar<=3 else
-0001efc0: 2032 2e35 0a20 2020 2063 6f72 5f66 6967   2.5.    cor_fig
-0001efd0: 2c20 6178 6172 7220 3d20 706c 742e 7375  , axarr = plt.su
-0001efe0: 6270 6c6f 7473 286e 7061 722c 206e 7061  bplots(npar, npa
-0001eff0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0001f000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f010: 2020 2020 206e 756d 3d66 6967 6e61 6d65       num=figname
-0001f020: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f040: 2020 2020 6669 6773 697a 653d 2866 7369      figsize=(fsi
-0001f050: 7a65 2a6e 7061 722c 2066 7369 7a65 2a6e  ze*npar, fsize*n
-0001f060: 7061 7229 2c0a 2020 2020 2020 2020 2020  par),.          
-0001f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f080: 2020 2020 2020 2020 636f 6e73 7472 6169          constrai
-0001f090: 6e65 645f 6c61 796f 7574 3d54 7275 6529  ned_layout=True)
-0001f0a0: 0a20 2020 200a 2320 7072 6f74 6563 7420  .    .# protect 
-0001f0b0: 7468 6520 666f 6c6c 6f77 696e 672c 206d  the following, m
-0001f0c0: 6179 2066 6169 6c0a 2020 2020 7472 793a  ay fail.    try:
-0001f0d0: 0a20 2020 2020 2069 7020 3d20 2d31 0a20  .      ip = -1. 
-0001f0e0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-0001f0f0: 6e67 6528 302c 206e 7061 7229 3a0a 2020  nge(0, npar):.  
-0001f100: 2020 2020 2020 6970 202b 3d20 310a 2020        ip += 1.  
-0001f110: 2020 2020 2020 6a70 203d 202d 310a 2020        jp = -1.  
-0001f120: 2020 2020 2020 666f 7220 6a20 696e 2072        for j in r
-0001f130: 616e 6765 2830 2c20 6e70 6172 293a 0a20  ange(0, npar):. 
-0001f140: 2020 2020 2020 2020 206a 7020 2b3d 2031           jp += 1
-0001f150: 0a20 2020 2020 2020 2020 2069 6620 6970  .          if ip
-0001f160: 203e 206a 703a 0a20 2020 2020 2020 2020   > jp:.         
-0001f170: 2020 2320 656d 7074 7920 7370 6163 650a    # empty space.
-0001f180: 2020 2020 2020 2020 2020 2020 6178 6172              axar
-0001f190: 725b 6a70 2c20 6970 5d2e 6178 6973 2827  r[jp, ip].axis('
-0001f1a0: 6f66 6627 290a 2020 2020 2020 2020 2020  off').          
-0001f1b0: 656c 6966 2069 7020 3d3d 206a 703a 0a20  elif ip == jp:. 
-0001f1c0: 2020 2020 2020 2020 2020 2320 706c 6f74            # plot
-0001f1d0: 2070 726f 6669 6c65 0a20 2020 2020 2020   profile.       
-0001f1e0: 2020 2020 2070 6c74 2e73 6361 2861 7861       plt.sca(axa
-0001f1f0: 7272 5b69 702c 2069 705d 2920 6966 206e  rr[ip, ip]) if n
-0001f200: 7061 7221 3d31 2065 6c73 6520 706c 742e  par!=1 else plt.
-0001f210: 7363 6128 6178 6172 7229 0a20 2020 2020  sca(axarr).     
-0001f220: 2020 2020 2020 206d 2e64 7261 775f 6d6e         m.draw_mn
-0001f230: 7072 6f66 696c 6528 6670 6e61 6d73 5b69  profile(fpnams[i
-0001f240: 5d2c 2073 7562 7472 6163 745f 6d69 6e3d  ], subtract_min=
-0001f250: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0001f260: 2020 6966 2028 7365 6c66 2e45 7272 4465    if (self.ErrDe
-0001f270: 6620 3d3d 2031 293a 0a20 2020 2020 2020  f == 1):.       
-0001f280: 2020 2020 2020 2079 6c61 6265 6c3d 2724         ylabel='$
-0001f290: 5c44 656c 7461 2028 2d32 5c6c 6e5c 6361  \Delta (-2\ln\ca
-0001f2a0: 6c7b 4c7d 2924 270a 2020 2020 2020 2020  l{L})$'.        
-0001f2b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001f2c0: 2020 2020 2020 2020 796c 6162 656c 3d27          ylabel='
-0001f2d0: 245c 4465 6c74 6120 282d 5c6c 6e5c 6361  $\Delta (-\ln\ca
-0001f2e0: 6c7b 4c7d 2924 270a 2020 2020 2020 2020  l{L})$'.        
-0001f2f0: 2020 2020 706c 742e 796c 6162 656c 2879      plt.ylabel(y
-0001f300: 6c61 6265 6c29 0a20 2020 2020 2020 2020  label).         
-0001f310: 2020 2078 6d6e 2c20 786d 7820 3d20 706c     xmn, xmx = pl
-0001f320: 742e 6763 6128 292e 6765 745f 786c 696d  t.gca().get_xlim
-0001f330: 2829 0a20 2020 2020 2020 2020 2020 2023  ().            #
-0001f340: 2073 686f 7720 686f 7269 7a6f 6e74 616c   show horizontal
-0001f350: 206c 696e 6520 6174 2073 656c 662e 4572   line at self.Er
-0001f360: 7244 6566 200a 2020 2020 2020 2020 2020  rDef .          
-0001f370: 2020 706c 742e 686c 696e 6573 2873 656c    plt.hlines(sel
-0001f380: 662e 4572 7244 6566 2c20 786d 6e2c 2078  f.ErrDef, xmn, x
-0001f390: 6d78 2c20 636f 6c6f 723d 276f 7261 6e67  mx, color='orang
-0001f3a0: 6527 2c20 6c69 6e65 7374 796c 653d 272d  e', linestyle='-
-0001f3b0: 2d27 290a 2020 2020 2020 2020 2020 2020  -').            
-0001f3c0: 706c 742e 6572 726f 7262 6172 2866 7076  plt.errorbar(fpv
-0001f3d0: 616c 735b 695d 2c20 302e 2c20 7865 7272  als[i], 0., xerr
-0001f3e0: 3d66 7065 7272 735b 695d 2c0a 2020 2020  =fperrs[i],.    
-0001f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f400: 2020 2020 2066 6d74 3d27 7827 2c20 636f       fmt='x', co
-0001f410: 6c6f 723d 2762 6c75 6527 2c20 6c69 6e65  lor='blue', line
-0001f420: 7374 796c 653d 272d 272c 2063 6170 7369  style='-', capsi
-0001f430: 7a65 3d33 290a 2020 2020 2020 2020 2020  ze=3).          
-0001f440: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001f450: 2020 706c 742e 7363 6128 6178 6172 725b    plt.sca(axarr[
-0001f460: 6a70 2c20 6970 5d29 0a20 2020 2020 2020  jp, ip]).       
-0001f470: 2020 2020 2069 6620 7365 6c66 2e69 6d69       if self.imi
-0001f480: 6e75 6974 5f76 6572 7369 6f6e 203c 2732  nuit_version <'2
-0001f490: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
-0001f4a0: 206d 2e64 7261 775f 6d6e 636f 6e74 6f75   m.draw_mncontou
-0001f4b0: 7228 6670 6e61 6d73 5b69 5d2c 2066 706e  r(fpnams[i], fpn
-0001f4c0: 616d 735b 6a5d 290a 2020 2020 2020 2020  ams[j]).        
-0001f4d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001f4e0: 2020 2020 2020 2020 6d2e 6472 6177 5f6d          m.draw_m
-0001f4f0: 6e63 6f6e 746f 7572 2866 706e 616d 735b  ncontour(fpnams[
-0001f500: 695d 2c20 6670 6e61 6d73 5b6a 5d2c 0a20  i], fpnams[j],. 
-0001f510: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001f520: 6c3d 2873 656c 662e 4368 6932 3243 4c28  l=(self.Chi22CL(
-0001f530: 312e 292c 2073 656c 662e 4368 6932 3243  1.), self.Chi22C
-0001f540: 4c28 342e 2929 2029 0a20 2020 2020 2020  L(4.)) ).       
-0001f550: 2020 2020 2023 2070 6c6f 7420 6265 7374       # plot best
-0001f560: 2d66 6974 2076 616c 7565 7320 616e 6420  -fit values and 
-0001f570: 6d69 6772 6164 2065 7272 6f72 730a 2020  migrad errors.  
-0001f580: 2020 2020 2020 2020 2020 706c 742e 6572            plt.er
-0001f590: 726f 7262 6172 2866 7076 616c 735b 695d  rorbar(fpvals[i]
-0001f5a0: 2c20 6670 7661 6c73 5b6a 5d2c 0a20 2020  , fpvals[j],.   
-0001f5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5c0: 2020 2020 2020 7865 7272 3d66 7065 7272        xerr=fperr
-0001f5d0: 735b 695d 2c20 7965 7272 3d66 7065 7272  s[i], yerr=fperr
-0001f5e0: 735b 6a5d 2c0a 2020 2020 2020 2020 2020  s[j],.          
-0001f5f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001f600: 6d74 3d27 7827 2c20 636f 6c6f 723d 2764  mt='x', color='d
-0001f610: 6172 6b62 6c75 6527 2c0a 2020 2020 2020  arkblue',.      
-0001f620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f630: 2020 2065 636f 6c6f 723d 2762 6c75 6527     ecolor='blue'
-0001f640: 2c20 6361 7073 697a 653d 332c 200a 2020  , capsize=3, .  
-0001f650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f660: 2020 2020 2020 2061 6c70 6861 3d30 2e36         alpha=0.6
-0001f670: 3629 0a20 2020 2020 2023 2072 6573 746f  6).      # resto
-0001f680: 7265 2063 6f6c 6f72 206d 6170 0a20 2020  re color map.   
-0001f690: 2020 2070 6c74 2e73 6574 5f63 6d61 7028     plt.set_cmap(
-0001f6a0: 6f72 6967 5f63 6d29 2020 2020 2020 2020  orig_cm)        
-0001f6b0: 0a0a 2020 2020 2020 7265 7475 726e 2063  ..      return c
-0001f6c0: 6f72 5f66 6967 0a0a 2020 2020 6578 6365  or_fig..    exce
-0001f6d0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-0001f6e0: 653a 0a20 2020 2020 2070 7269 6e74 2827  e:.      print('
-0001f6f0: 2a3d 3d2a 2021 2121 2070 726f 6669 6c65  *==* !!! profile
-0001f700: 2061 6e64 2063 6f6e 746f 7572 2073 6361   and contour sca
-0001f710: 6e20 6661 696c 6564 2729 0a20 2020 2020  n failed').     
-0001f720: 2070 7269 6e74 2865 290a 2020 2020 2020   print(e).      
-0001f730: 7265 7475 726e 204e 6f6e 650a 0a20 2064  return None..  d
-0001f740: 6566 2067 6574 5072 6f66 696c 6528 7365  ef getProfile(se
-0001f750: 6c66 2c20 706e 616d 2c20 7261 6e67 653d  lf, pnam, range=
-0001f760: 332e 2c20 6e70 6f69 6e74 733d 3330 293a  3., npoints=30):
-0001f770: 0a20 2020 2022 2222 7265 7475 726e 2070  .    """return p
-0001f780: 726f 6669 6c65 206c 696b 656c 6968 6f6f  rofile likelihoo
-0001f790: 6420 6f66 2070 6172 616d 6574 6572 2070  d of parameter p
-0001f7a0: 6e61 6d0a 0a20 2020 2041 7267 733a 0a20  nam..    Args:. 
-0001f7b0: 2020 2020 202d 2070 6172 616d 6574 6572       - parameter
-0001f7c0: 206e 616d 650a 2020 2020 2020 2d20 7363   name.      - sc
-0001f7d0: 616e 2072 616e 6765 2069 6e20 7369 676d  an range in sigm
-0001f7e0: 612c 2061 7265 2074 7570 6c65 2077 6974  a, are tuple wit
-0001f7f0: 6820 6c6f 7765 7220 616e 6420 7570 7065  h lower and uppe
-0001f800: 7220 7661 6c75 650a 2020 2020 2020 2d20  r value.      - 
-0001f810: 6e75 6d62 6572 206f 6620 706f 696e 7473  number of points
-0001f820: 200a 2020 2020 2222 220a 2020 2020 6966   .    """.    if
-0001f830: 2073 656c 662e 696d 696e 7569 745f 7665   self.iminuit_ve
-0001f840: 7273 696f 6e20 3c27 3227 3a0a 2020 2020  rsion <'2':.    
-0001f850: 2020 7072 696e 7428 2221 2121 2067 6574    print("!!! get
-0001f860: 5072 6f66 696c 6520 6e6f 7420 696d 706c  Profile not impl
-0001f870: 656d 656e 7465 6420 766f 7220 696d 696e  emented vor imin
-0001f880: 7569 7420 7665 7273 2e3c 3222 290a 2020  uit vers.<2").  
-0001f890: 2020 2020 7265 7475 726e 0a20 2020 2065      return.    e
-0001f8a0: 6c73 653a 0a20 2020 2020 2072 6574 7572  lse:.      retur
-0001f8b0: 6e20 7365 6c66 2e6d 696e 7569 742e 6d6e  n self.minuit.mn
-0001f8c0: 7072 6f66 696c 6528 706e 616d 2c20 626f  profile(pnam, bo
-0001f8d0: 756e 6420 3d20 7261 6e67 652c 0a20 2020  und = range,.   
-0001f8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f8f0: 2020 2020 2020 2020 2020 2020 2020 7369                si
-0001f900: 7a65 3d6e 706f 696e 7473 2c20 7375 6274  ze=npoints, subt
-0001f910: 7261 6374 5f6d 696e 3d54 7275 6529 0a0a  ract_min=True)..
-0001f920: 2020 6465 6620 6765 7443 6f6e 746f 7572    def getContour
-0001f930: 2873 656c 662c 2070 6e61 6d31 2c20 706e  (self, pnam1, pn
-0001f940: 616d 322c 2063 6c3d 4e6f 6e65 2c20 6e70  am2, cl=None, np
-0001f950: 6f69 6e74 733d 3130 3029 3a0a 2020 2020  oints=100):.    
-0001f960: 2222 2272 6574 7572 6e20 7072 6f66 696c  """return profil
-0001f970: 6520 6c69 6b65 6c69 686f 6f64 2063 6f6e  e likelihood con
-0001f980: 746f 7572 206f 6620 7061 7261 6d65 7465  tour of paramete
-0001f990: 7273 2070 6e61 6d31 2061 6e64 2070 6e61  rs pnam1 and pna
-0001f9a0: 6d32 0a0a 2020 2020 4172 6773 3a0a 2020  m2..    Args:.  
-0001f9b0: 2020 2020 2d20 3173 7420 7061 7261 6d65      - 1st parame
-0001f9c0: 7465 7220 6e61 6d65 200a 2020 2020 2020  ter name .      
-0001f9d0: 2d20 326e 6420 7061 7261 6d65 7465 7220  - 2nd parameter 
-0001f9e0: 6e61 6d65 200a 2020 2020 2020 2d20 636f  name .      - co
-0001f9f0: 6e66 6964 656e 6365 206c 6576 656c 0a20  nfidence level. 
-0001fa00: 2020 2020 202d 206e 756d 6265 7220 6f66       - number of
-0001fa10: 2070 6f69 6e74 730a 2020 0a20 2020 2052   points.  .    R
-0001fa20: 6574 7572 6e73 3a20 0a20 2020 2020 202d  eturns: .      -
-0001fa30: 2061 7272 6179 206f 6620 666c 6f61 7420   array of float 
-0001fa40: 286e 706f 696e 7473 202a 2032 2920 636f  (npoints * 2) co
-0001fa50: 6e74 6f75 7220 706f 696e 7473 200a 2020  ntour points .  
-0001fa60: 2020 2222 220a 0a20 2020 2069 6620 7365    """..    if se
-0001fa70: 6c66 2e69 6d69 6e75 6974 5f76 6572 7369  lf.iminuit_versi
-0001fa80: 6f6e 203c 2732 273a 0a20 2020 2020 2070  on <'2':.      p
-0001fa90: 7269 6e74 2822 2121 2120 6765 7443 6f6e  rint("!!! getCon
-0001faa0: 746f 7572 206e 6f74 2069 6d70 6c65 6d65  tour not impleme
-0001fab0: 6e74 6564 2076 6f72 2069 6d69 6e75 6974  nted vor iminuit
-0001fac0: 2076 6572 732e 3c32 2229 0a20 2020 2020   vers.<2").     
-0001fad0: 2072 6574 7572 6e0a 2020 2020 7265 7475   return.    retu
-0001fae0: 726e 2073 656c 662e 6d69 6e75 6974 2e6d  rn self.minuit.m
-0001faf0: 6e63 6f6e 746f 7572 2870 6e61 6d31 2c20  ncontour(pnam1, 
-0001fb00: 706e 616d 322c 2063 6c3d 636c 2c20 7369  pnam2, cl=cl, si
-0001fb10: 7a65 3d6e 706f 696e 7473 290a 0a0a 2020  ze=npoints)...  
-0001fb20: 6465 6620 706c 6f74 5f50 726f 6669 6c65  def plot_Profile
-0001fb30: 2873 656c 662c 2070 6e61 6d2c 2072 616e  (self, pnam, ran
-0001fb40: 6765 3d32 2e2c 206e 706f 696e 7473 3d33  ge=2., npoints=3
-0001fb50: 3029 3a0a 2020 2020 2222 2270 6c6f 7420  0):.    """plot 
-0001fb60: 7072 6f66 696c 6520 6c69 6b65 6c69 686f  profile likeliho
-0001fb70: 6f64 206f 6620 7061 7261 6d65 7465 7220  od of parameter 
-0001fb80: 706e 616d 0a0a 2020 2020 4172 6773 3a0a  pnam..    Args:.
-0001fb90: 2020 2020 2020 2d20 7061 7261 6d65 7465        - paramete
-0001fba0: 7220 6e61 6d65 0a20 2020 2020 202d 2073  r name.      - s
-0001fbb0: 6361 6e20 7261 6e67 6520 696e 2073 6967  can range in sig
-0001fbc0: 6d61 2c20 6172 6520 7475 706c 6520 7769  ma, are tuple wi
-0001fbd0: 7468 206c 6f77 6572 2061 6e64 2075 7070  th lower and upp
-0001fbe0: 6572 2076 616c 7565 0a20 2020 2020 202d  er value.      -
-0001fbf0: 206e 756d 6265 7220 6f66 2070 6f69 6e74   number of point
-0001fc00: 730a 0a20 2020 2052 6574 7572 6e73 3a20  s..    Returns: 
-0001fc10: 0a20 2020 2020 202d 206d 6174 706c 6f74  .      - matplot
-0001fc20: 6c69 6220 6669 6775 7265 200a 2020 2020  lib figure .    
-0001fc30: 2222 220a 0a20 2020 2066 6967 203d 2070  """..    fig = p
-0001fc40: 6c74 2e66 6967 7572 6528 6e75 6d3d 274c  lt.figure(num='L
-0001fc50: 696b 656c 6968 6f6f 6420 7072 6f66 696c  ikelihood profil
-0001fc60: 6520 2720 2b20 706e 616d 2c0a 2020 2020  e ' + pnam,.    
-0001fc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc80: 2066 6967 7369 7a65 3d28 352e 2c20 352e   figsize=(5., 5.
-0001fc90: 2929 0a20 2020 2073 656c 662e 6d69 6e75  )).    self.minu
-0001fca0: 6974 2e64 7261 775f 6d6e 7072 6f66 696c  it.draw_mnprofil
-0001fcb0: 6528 706e 616d 2c20 626f 756e 643d 7261  e(pnam, bound=ra
-0001fcc0: 6e67 652c 2073 697a 653d 6e70 6f69 6e74  nge, size=npoint
-0001fcd0: 732c 2073 7562 7472 6163 745f 6d69 6e3d  s, subtract_min=
-0001fce0: 5472 7565 290a 2020 2020 0a20 2020 2069  True).    .    i
-0001fcf0: 6620 2873 656c 662e 4572 7244 6566 203d  f (self.ErrDef =
-0001fd00: 3d20 3129 3a0a 2020 2020 2020 796c 6162  = 1):.      ylab
-0001fd10: 656c 3d27 245c 4465 6c74 6120 282d 325c  el='$\Delta (-2\
-0001fd20: 6c6e 5c63 616c 7b4c 7d29 2427 0a20 2020  ln\cal{L})$'.   
-0001fd30: 2065 6c73 653a 0a20 2020 2020 2079 6c61   else:.      yla
-0001fd40: 6265 6c3d 2724 5c44 656c 7461 2028 2d5c  bel='$\Delta (-\
-0001fd50: 6c6e 5c63 616c 7b4c 7d29 2427 0a20 2020  ln\cal{L})$'.   
-0001fd60: 2070 6c74 2e79 6c61 6265 6c28 796c 6162   plt.ylabel(ylab
-0001fd70: 656c 290a 2020 2020 7265 7475 726e 2066  el).    return f
-0001fd80: 6967 0a0a 0a20 2064 6566 2070 6c6f 745f  ig...  def plot_
-0001fd90: 636c 436f 6e74 6f75 7228 7365 6c66 2c20  clContour(self, 
-0001fda0: 706e 616d 312c 2070 6e61 6d32 2c20 636c  pnam1, pnam2, cl
-0001fdb0: 293a 0a20 2020 2022 2222 706c 6f74 2061  ):.    """plot a
-0001fdc0: 2063 6f6e 746f 7572 206f 6620 7061 7261   contour of para
-0001fdd0: 6d65 7465 7273 2070 6e61 6d31 2061 6e64  meters pnam1 and
-0001fde0: 2070 6e61 6d32 0a20 2020 2077 6974 6820   pnam2.    with 
-0001fdf0: 636f 6e66 6964 656e 6365 206c 6576 656c  confidence level
-0001fe00: 2873 2920 636c 0a20 2020 2022 2222 0a20  (s) cl.    """. 
-0001fe10: 2020 2069 6620 7365 6c66 2e69 6d69 6e75     if self.iminu
-0001fe20: 6974 5f76 6572 7369 6f6e 203c 2732 273a  it_version <'2':
-0001fe30: 0a20 2020 2020 2070 7269 6e74 2822 2121  .      print("!!
-0001fe40: 2120 706c 6f74 5f63 6c43 6f6e 746f 7572  ! plot_clContour
-0001fe50: 206e 6f74 2069 6d70 6c65 6d65 6e74 6564   not implemented
-0001fe60: 2076 6f72 2069 6d69 6e75 6974 2076 6572   vor iminuit ver
-0001fe70: 732e 3c32 2229 0a20 2020 2020 2072 6574  s.<2").      ret
-0001fe80: 7572 6e0a 2020 2020 656c 7365 3a0a 2020  urn.    else:.  
-0001fe90: 2020 2020 6669 6720 3d20 706c 742e 6669      fig = plt.fi
-0001fea0: 6775 7265 286e 756d 3d27 436f 6e74 6f75  gure(num='Contou
-0001feb0: 7228 7329 2027 202b 2070 6e61 6d31 202b  r(s) ' + pnam1 +
-0001fec0: 2027 2076 732e 2027 202b 2070 6e61 6d32   ' vs. ' + pnam2
-0001fed0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001fee0: 2020 2020 2020 2020 2066 6967 7369 7a65           figsize
-0001fef0: 3d28 352e 2c20 352e 2929 0a20 2020 2020  =(5., 5.)).     
-0001ff00: 2073 656c 662e 6d69 6e75 6974 2e64 7261   self.minuit.dra
-0001ff10: 775f 6d6e 636f 6e74 6f75 7228 706e 616d  w_mncontour(pnam
-0001ff20: 312c 2070 6e61 6d32 2c20 636c 3d63 6c29  1, pnam2, cl=cl)
-0001ff30: 2020 2020 0a20 2020 2020 2072 6574 7572      .      retur
-0001ff40: 6e20 6669 670a 0a0a 2020 6465 6620 706c  n fig...  def pl
-0001ff50: 6f74 5f6e 7369 6743 6f6e 746f 7572 2873  ot_nsigContour(s
-0001ff60: 656c 662c 2070 6e61 6d31 2c20 706e 616d  elf, pnam1, pnam
-0001ff70: 322c 206e 7369 6729 3a0a 2020 2020 2222  2, nsig):.    ""
-0001ff80: 2270 6c6f 7420 6e73 6967 2063 6f6e 746f  "plot nsig conto
-0001ff90: 7572 7320 6f66 2070 6172 616d 6574 6572  urs of parameter
-0001ffa0: 7320 706e 616d 3120 616e 6420 706e 616d  s pnam1 and pnam
-0001ffb0: 320a 2020 2020 2222 220a 2020 2020 6669  2.    """.    fi
-0001ffc0: 6720 3d20 706c 742e 6669 6775 7265 286e  g = plt.figure(n
-0001ffd0: 756d 3d27 436f 6e74 6f75 7228 7329 2027  um='Contour(s) '
-0001ffe0: 202b 2070 6e61 6d31 202b 2027 2076 732e   + pnam1 + ' vs.
-0001fff0: 2027 202b 2070 6e61 6d32 2c0a 2020 2020   ' + pnam2,.    
-00020000: 2020 6669 6773 697a 653d 2835 2e2c 2035    figsize=(5., 5
-00020010: 2e29 290a 2020 2020 6966 2073 656c 662e  .)).    if self.
-00020020: 696d 696e 7569 745f 7665 7273 696f 6e20  iminuit_version 
-00020030: 3c27 3227 3a0a 2020 2020 2020 7365 6c66  <'2':.      self
-00020040: 2e6d 696e 7569 742e 6472 6177 5f6d 6e63  .minuit.draw_mnc
-00020050: 6f6e 746f 7572 2870 6e61 6d31 2c20 706e  ontour(pnam1, pn
-00020060: 616d 322c 206e 7369 676d 613d 6e73 6967  am2, nsigma=nsig
-00020070: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
-00020080: 2020 6e73 203d 2072 616e 6765 2831 2c20    ns = range(1, 
-00020090: 6e73 6967 2b31 290a 2020 2020 2020 6463  nsig+1).      dc
-000200a0: 6869 3220 3d20 6e70 2e61 7272 6179 286e  hi2 = np.array(n
-000200b0: 7329 2a2a 320a 2020 2020 2020 636c 203d  s)**2.      cl =
-000200c0: 2073 656c 662e 4368 6932 3243 4c28 6463   self.Chi22CL(dc
-000200d0: 6869 3229 2020 2020 0a20 2020 2020 2073  hi2)    .      s
-000200e0: 656c 662e 6d69 6e75 6974 2e64 7261 775f  elf.minuit.draw_
-000200f0: 6d6e 636f 6e74 6f75 7228 706e 616d 312c  mncontour(pnam1,
-00020100: 2070 6e61 6d32 2c20 636c 3d63 6c29 2020   pnam2, cl=cl)  
-00020110: 2020 0a20 2020 2072 6574 7572 6e20 6669    .    return fi
-00020120: 670a 0a20 2040 7374 6174 6963 6d65 7468  g..  @staticmeth
-00020130: 6f64 0a20 2064 6566 2063 6869 3270 7262  od.  def chi2prb
-00020140: 2863 6869 322c 6e64 6f66 293a 0a20 2020  (chi2,ndof):.   
-00020150: 2022 2222 4361 6c63 756c 6174 6520 6368   """Calculate ch
-00020160: 6932 2d70 726f 6261 6269 6c69 7479 2066  i2-probability f
-00020170: 726f 6d20 6368 6932 2061 6e64 2064 6567  rom chi2 and deg
-00020180: 7265 6573 206f 6620 6672 6565 646f 6d0a  rees of freedom.
-00020190: 2020 2020 2222 220a 2020 2020 7265 7475      """.    retu
-000201a0: 726e 2031 2e2d 2073 7461 7473 2e63 6869  rn 1.- stats.chi
-000201b0: 322e 6364 6628 6368 6932 2c20 6e64 6f66  2.cdf(chi2, ndof
-000201c0: 290a 2020 0a20 2040 7374 6174 6963 6d65  ).  .  @staticme
-000201d0: 7468 6f64 0a20 2064 6566 2043 4c32 4368  thod.  def CL2Ch
-000201e0: 6932 2843 4c29 3a0a 2020 2020 2222 2263  i2(CL):.    """c
-000201f0: 616c 6375 6c61 7465 2044 656c 7461 4368  alculate DeltaCh
-00020200: 6932 2066 726f 6d20 636f 6e66 6964 656e  i2 from confiden
-00020210: 6365 206c 6576 656c 2043 4c20 666f 7220  ce level CL for 
-00020220: 322d 6469 6d20 636f 6e74 6f75 7273 0a20  2-dim contours. 
-00020230: 2020 2022 2222 0a20 2020 2072 6574 7572     """.    retur
-00020240: 6e20 2d32 2e2a 6e70 2e6c 6f67 2831 2e2d  n -2.*np.log(1.-
-00020250: 434c 290a 0a20 2040 7374 6174 6963 6d65  CL)..  @staticme
-00020260: 7468 6f64 0a20 2064 6566 2043 6869 3232  thod.  def Chi22
-00020270: 434c 2864 6332 293a 0a20 2020 2022 2222  CL(dc2):.    """
-00020280: 6361 6c63 756c 6174 6520 636f 6e66 6964  calculate confid
-00020290: 656e 6365 206c 6576 656c 2043 4c20 6672  ence level CL fr
-000202a0: 6f6d 2044 656c 7461 4368 6932 2066 6f72  om DeltaChi2 for
-000202b0: 2032 2d64 696d 2063 6f6e 746f 7572 730a   2-dim contours.
-000202c0: 2020 2020 2222 220a 2020 2020 7265 7475      """.    retu
-000202d0: 726e 2028 312e 202d 206e 702e 6578 7028  rn (1. - np.exp(
-000202e0: 2d64 6332 202f 2032 2e29 290a 0a69 6620  -dc2 / 2.))..if 
-000202f0: 5f5f 6e61 6d65 5f5f 203d 3d20 225f 5f6d  __name__ == "__m
-00020300: 6169 6e5f 5f22 3a20 2320 2d2d 2d20 696e  ain__": # --- in
-00020310: 7465 7266 6163 6520 616e 6420 6578 616d  terface and exam
-00020320: 706c 650a 2020 0a20 2064 6566 2065 7861  ple.  .  def exa
-00020330: 6d70 6c65 5f78 7946 6974 2829 3a0a 2020  mple_xyFit():.  
-00020340: 230a 2020 2320 2a2a 2a20 4578 616d 706c  #.  # *** Exampl
-00020350: 6520 6f66 2061 6e20 6170 706c 6963 6174  e of an applicat
-00020360: 696f 6e20 6f66 2070 6879 4669 742e 7879  ion of phyFit.xy
-00020370: 4669 7428 290a 2020 230a 2020 2320 6465  Fit().  #.  # de
-00020380: 6669 6e65 2074 6865 206d 6f64 656c 2066  fine the model f
-00020390: 756e 6374 696f 6e20 746f 2066 6974 0a20  unction to fit. 
-000203a0: 2020 2064 6566 2065 7870 5f6d 6f64 656c     def exp_model
-000203b0: 2878 2c20 413d 312e 2c20 7830 3d31 2e29  (x, A=1., x0=1.)
-000203c0: 3a0a 2020 2020 2020 7265 7475 726e 2041  :.      return A
-000203d0: 2a6e 702e 6578 7028 2d78 2f78 3029 0a0a  *np.exp(-x/x0)..
-000203e0: 2020 2020 2320 616e 6f74 6865 7220 6d6f      # another mo
-000203f0: 6465 6c20 6675 6e63 7469 6f6e 0a20 2020  del function.   
-00020400: 2064 6566 2070 6f6c 7932 5f6d 6f64 656c   def poly2_model
-00020410: 2878 2c20 613d 302e 312c 2062 3d31 2e2c  (x, a=0.1, b=1.,
-00020420: 2063 3d31 2e29 3a0a 2020 2020 2020 7265   c=1.):.      re
-00020430: 7475 726e 2061 2a78 2a2a 3220 2b20 622a  turn a*x**2 + b*
-00020440: 7820 2b20 630a 0a20 2020 2023 2073 6574  x + c..    # set
-00020450: 206d 6f64 656c 2074 6f20 7573 6520 696e   model to use in
-00020460: 2066 6974 0a20 2020 2066 6974 6d6f 6465   fit.    fitmode
-00020470: 6c3d 6578 705f 6d6f 6465 6c20 2023 2061  l=exp_model  # a
-00020480: 6c73 6f20 7472 7920 706f 6c79 325f 6d6f  lso try poly2_mo
-00020490: 6465 6c20 210a 2020 0a20 2020 2023 2074  del !.  .    # t
-000204a0: 6865 2064 6174 6120 2e2e 2e0a 2020 2020  he data ....    
-000204b0: 6461 7461 5f78 203d 205b 302e 302c 2030  data_x = [0.0, 0
-000204c0: 2e32 2c20 302e 342c 2030 2e36 2c20 302e  .2, 0.4, 0.6, 0.
-000204d0: 382c 2031 2e2c 2031 2e32 2c0a 2020 2020  8, 1., 1.2,.    
-000204e0: 2020 2020 2020 312e 342c 2031 2e36 2c20        1.4, 1.6, 
-000204f0: 312e 382c 2032 2e30 2c20 322e 322c 2032  1.8, 2.0, 2.2, 2
-00020500: 2e34 2c20 322e 365d 0a20 2020 2064 6174  .4, 2.6].    dat
-00020510: 615f 7920 3d20 5b31 2e31 3439 2c20 302e  a_y = [1.149, 0.
-00020520: 3731 322c 2030 2e38 3033 2c20 302e 3436  712, 0.803, 0.46
-00020530: 342c 2030 2e33 3938 2c20 302e 3335 342c  4, 0.398, 0.354,
-00020540: 2030 2e31 3438 2c0a 2020 2020 2020 2020   0.148,.        
-00020550: 2020 2020 302e 3332 382c 2030 2e31 3831      0.328, 0.181
-00020560: 2c20 302e 3134 302c 2030 2e30 3635 2c20  , 0.140, 0.065, 
-00020570: 302e 3030 352c 2d30 2e30 3035 2c20 302e  0.005,-0.005, 0.
-00020580: 3131 365d 0a20 2020 2023 202e 2e2e 2061  116].    # ... a
-00020590: 6e64 2075 6e63 6572 7461 6974 6965 7320  nd uncertaities 
-000205a0: 200a 2020 2020 7361 6273 7920 3d20 302e   .    sabsy = 0.
-000205b0: 3037 2023 2069 6e64 6570 656e 6465 6e74  07 # independent
-000205c0: 2079 0a20 2020 2073 7265 6c79 203d 2030   y.    srely = 0
-000205d0: 2e30 3520 2320 3525 206f 6620 6d6f 6465  .05 # 5% of mode
-000205e0: 6c20 7661 6c75 650a 2020 2020 6361 6273  l value.    cabs
-000205f0: 7920 3d20 302e 3034 2023 2063 6f72 7265  y = 0.04 # corre
-00020600: 6c61 7465 640a 2020 2020 6372 656c 7920  lated.    crely 
-00020610: 3d20 302e 3033 2023 2033 2520 6f66 206d  = 0.03 # 3% of m
-00020620: 6f64 656c 2076 616c 7565 2063 6f72 7265  odel value corre
-00020630: 6c61 7465 640a 2020 2020 7361 6273 7820  lated.    sabsx 
-00020640: 3d20 302e 3035 2023 2069 6e64 6570 656e  = 0.05 # indepen
-00020650: 6465 6e74 2078 0a20 2020 2073 7265 6c78  dent x.    srelx
-00020660: 203d 2030 2e30 3420 2320 3425 206f 6620   = 0.04 # 4% of 
-00020670: 780a 2020 2020 6361 6273 7820 3d20 302e  x.    cabsx = 0.
-00020680: 3033 2023 2063 6f72 7265 6c61 7465 6420  03 # correlated 
-00020690: 780a 2020 2020 6372 656c 7820 3d20 302e  x.    crelx = 0.
-000206a0: 3032 2023 2032 2520 6f66 2078 2063 6f72  02 # 2% of x cor
-000206b0: 7265 6c61 7465 640a 0a20 2020 2023 2070  related..    # p
-000206c0: 6572 666f 726d 2066 6974 2074 6f20 6461  erform fit to da
-000206d0: 7461 2077 6974 6820 6675 6e63 7469 6f6e  ta with function
-000206e0: 2078 7946 6974 2075 7369 6e67 2063 6c61   xyFit using cla
-000206f0: 7373 206d 6e46 6974 0a20 2020 2072 6573  ss mnFit.    res
-00020700: 756c 7444 6963 7420 3d20 7879 4669 7428  ultDict = xyFit(
-00020710: 6669 746d 6f64 656c 2c20 6461 7461 5f78  fitmodel, data_x
-00020720: 2c20 6461 7461 5f79 2c0a 2020 2020 2020  , data_y,.      
-00020730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020740: 2073 783d 7361 6273 782c 0a20 2020 2020   sx=sabsx,.     
-00020750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020760: 2020 7379 3d73 6162 7379 2c0a 2020 2020    sy=sabsy,.    
-00020770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020780: 2020 2073 7265 6c78 3d73 7265 6c78 2c0a     srelx=srelx,.
-00020790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000207a0: 2020 2020 2020 2073 7265 6c79 3d73 7265         srely=sre
-000207b0: 6c79 2c0a 2020 2020 2020 2020 2020 2020  ly,.            
-000207c0: 2020 2020 2020 2020 2020 2078 6162 7363             xabsc
-000207d0: 6f72 3d63 6162 7378 2c0a 2020 2020 2020  or=cabsx,.      
-000207e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000207f0: 2078 7265 6c63 6f72 3d63 7265 6c78 2c0a   xrelcor=crelx,.
-00020800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020810: 2020 2020 2020 2079 6162 7363 6f72 3d63         yabscor=c
-00020820: 6162 7379 2c0a 2020 2020 2020 2020 2020  absy,.          
-00020830: 2020 2020 2020 2020 2020 2020 2079 7265               yre
-00020840: 6c63 6f72 3d63 7265 6c79 2c0a 2020 2020  lcor=crely,.    
-00020850: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00020860: 2020 2070 303d 2831 2e2c 2030 2e35 292c     p0=(1., 0.5),
-00020870: 2020 2020 200a 2020 2020 2320 2020 2020       .    #     
-00020880: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00020890: 7374 7261 696e 7473 3d5b 2741 272c 2031  straints=['A', 1
-000208a0: 2e2c 2030 2e30 335d 2c0a 2020 2020 2320  ., 0.03],.    # 
-000208b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000208c0: 2063 6f6e 7374 7261 696e 7473 3d5b 302c   constraints=[0,
-000208d0: 2031 2e2c 2030 2e30 335d 2028 616c 7465   1., 0.03] (alte
-000208e0: 726e 6174 6976 6529 0a20 2020 2023 2020  rnative).    #  
-000208f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020900: 6c69 6d69 7473 3d28 2741 272c 2030 2e2c  limits=('A', 0.,
-00020910: 204e 6f6e 6529 2c20 2023 2070 6172 616d   None),  # param
-00020920: 6574 6572 206c 696d 6974 730a 2020 2020  eter limits.    
-00020930: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00020940: 2020 2066 6978 5061 7273 203d 205b 2741     fixPars = ['A
-00020950: 275d 2c20 2020 2020 2020 2020 2320 6669  '],         # fi
-00020960: 7820 7061 7261 6d65 7465 7228 7329 200a  x parameter(s) .
-00020970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020980: 2020 2020 2020 2075 7365 5f6e 6567 4c6f         use_negLo
-00020990: 674c 3d54 7275 652c 0a20 2020 2020 2020  gL=True,.       
-000209a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000209b0: 706c 6f74 3d54 7275 652c 0a20 2020 2020  plot=True,.     
-000209c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000209d0: 2020 706c 6f74 5f62 616e 643d 5472 7565    plot_band=True
-000209e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000209f0: 2020 2020 2020 2020 2070 6c6f 745f 636f           plot_co
-00020a00: 723d 4661 6c73 652c 0a20 2020 2020 2020  r=False,.       
-00020a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a20: 7368 6f77 706c 6f74 733d 4661 6c73 652c  showplots=False,
-00020a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020a40: 2020 2020 2020 2020 7175 6965 743d 4661          quiet=Fa
-00020a50: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00020a60: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-00020a70: 5f6c 6162 656c 733d 5b27 7827 2c20 2779  _labels=['x', 'y
-00020a80: 2020 205c 2020 6628 782c 202a 7061 7229     \  f(x, *par)
-00020a90: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
-00020aa0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00020ab0: 5f6c 6567 656e 6420 3d20 2772 616e 646f  _legend = 'rando
-00020ac0: 6d20 6461 7461 272c 2020 2020 0a20 2020  m data',    .   
-00020ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ae0: 2020 2020 6d6f 6465 6c5f 6c65 6765 6e64      model_legend
-00020af0: 203d 2027 6d6f 6465 6c27 290a 2020 2020   = 'model').    
-00020b00: 706c 742e 7375 7074 6974 6c65 2822 6d6e  plt.suptitle("mn
-00020b10: 4669 7420 6578 616d 706c 653a 2066 6974  Fit example: fit
-00020b20: 2074 6f20 782d 7920 6461 7461 222c 0a20   to x-y data",. 
-00020b30: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00020b40: 7a65 3d27 7878 2d6c 6172 6765 272c 2063  ze='xx-large', c
-00020b50: 6f6c 6f72 3d27 6461 726b 626c 7565 2729  olor='darkblue')
-00020b60: 0a20 2020 200a 2020 2320 5072 696e 7420  .    .  # Print 
-00020b70: 7265 7375 6c74 7320 0a20 2020 2070 7661  results .    pva
-00020b80: 6c73 2c20 7065 7272 732c 2063 6f72 2c20  ls, perrs, cor, 
-00020b90: 6368 6932 2c20 706e 616d 7320 3d20 7265  chi2, pnams = re
-00020ba0: 7375 6c74 4469 6374 2e76 616c 7565 7328  sultDict.values(
-00020bb0: 290a 2020 2020 7072 696e 7428 275c 6e2a  ).    print('\n*
-00020bc0: 3d3d 2a20 7879 4669 7420 5265 7375 6c74  ==* xyFit Result
-00020bd0: 3a27 290a 2020 2020 7072 696e 7428 2220  :').    print(" 
-00020be0: 7061 7261 6d65 7465 7220 6e61 6d65 733a  parameter names:
-00020bf0: 2020 2020 2020 2022 2c20 706e 616d 7329         ", pnams)
-00020c00: 0a20 2020 2070 7269 6e74 2822 2063 6869  .    print(" chi
-00020c10: 323a 207b 3a2e 3367 7d22 2e66 6f72 6d61  2: {:.3g}".forma
-00020c20: 7428 6368 6932 2929 0a20 2020 2070 7269  t(chi2)).    pri
-00020c30: 6e74 2822 2070 6172 616d 6574 6572 2076  nt(" parameter v
-00020c40: 616c 7565 733a 2020 2020 2020 222c 2070  alues:      ", p
-00020c50: 7661 6c73 290a 2020 2020 7072 696e 7428  vals).    print(
-00020c60: 2220 6e65 672e 2070 6172 616d 6574 6572  " neg. parameter
-00020c70: 2065 7272 6f72 733a 2022 2c20 7065 7272   errors: ", perr
-00020c80: 735b 3a2c 305d 290a 2020 2020 7072 696e  s[:,0]).    prin
-00020c90: 7428 2220 706f 732e 2070 6172 616d 6574  t(" pos. paramet
-00020ca0: 6572 2065 7272 6f72 733a 2022 2c20 7065  er errors: ", pe
-00020cb0: 7272 735b 3a2c 315d 290a 2020 2020 7072  rrs[:,1]).    pr
-00020cc0: 696e 7428 2220 636f 7272 656c 6174 696f  int(" correlatio
-00020cd0: 6e73 203a 205c 6e22 2c20 636f 7229 0a0a  ns : \n", cor)..
-00020ce0: 0a20 2064 6566 2065 7861 6d70 6c65 5f69  .  def example_i
-00020cf0: 6e64 6578 6564 4669 7428 293a 0a20 2023  ndexedFit():.  #
-00020d00: 0a20 2023 202a 2a2a 2045 7861 6d70 6c65  .  # *** Example
-00020d10: 206f 6620 616e 2061 7070 6c69 6361 7469   of an applicati
-00020d20: 6f6e 206f 6620 7068 7946 6974 2e78 4669  on of phyFit.xFi
-00020d30: 7428 2920 746f 2066 6974 2069 6e64 6578  t() to fit index
-00020d40: 6564 2064 6174 610a 2020 230a 2020 2320  ed data.  #.  # 
-00020d50: 2020 2020 436f 6f72 6469 6e61 7465 7320      Coordinates 
-00020d60: 696e 2072 2d70 6869 2061 7265 2061 7665  in r-phi are ave
-00020d70: 7261 6765 6420 616e 6420 7472 616e 7366  raged and transf
-00020d80: 6f72 6d65 6420 746f 2063 6172 7465 7369  ormed to cartesi
-00020d90: 616e 200a 2020 2020 0a20 2020 2064 6566  an .    .    def
-00020da0: 2063 6172 7465 7369 616e 5f74 6f5f 706f   cartesian_to_po
-00020db0: 6c61 7228 6461 7461 2c20 783d 312e 2c20  lar(data, x=1., 
-00020dc0: 793d 312e 293a 0a20 2020 2020 2023 2064  y=1.):.      # d
-00020dd0: 6574 6572 6d69 6e65 2070 6f6c 6172 2063  etermine polar c
-00020de0: 6f6f 7264 696e 6174 7320 6672 6f6d 2063  oordinats from c
-00020df0: 6172 7465 7369 616e 2028 782c 7929 0a20  artesian (x,y). 
-00020e00: 2020 2020 206e 6d20 3d20 6c65 6e28 6461       nm = len(da
-00020e10: 7461 292f 2f32 2023 2065 7870 6563 7420  ta)//2 # expect 
-00020e20: 7477 6f20 6172 7261 7973 2077 6974 6820  two arrays with 
-00020e30: 6d65 6173 7572 656d 656e 7473 0a20 2020  measurements.   
-00020e40: 2020 2072 203d 206e 702e 7371 7274 2878     r = np.sqrt(x
-00020e50: 2a78 202b 2079 2a79 2920 2a20 6e70 2e6f  *x + y*y) * np.o
-00020e60: 6e65 7328 6e6d 290a 2020 2020 2020 7068  nes(nm).      ph
-00020e70: 6920 3d20 6e70 2e61 7263 7461 6e32 2879  i = np.arctan2(y
-00020e80: 2c20 7829 202a 206e 702e 6f6e 6573 286e  , x) * np.ones(n
-00020e90: 6d29 0a20 2020 2020 2072 6574 7572 6e20  m).      return 
-00020ea0: 6e70 2e63 6f6e 6361 7465 6e61 7465 2820  np.concatenate( 
-00020eb0: 2872 2c20 7068 6929 2029 0a0a 2020 2020  (r, phi) )..    
-00020ec0: 2320 6578 616d 706c 653a 2028 722c 2070  # example: (r, p
-00020ed0: 6869 2920 6f66 2074 776f 2073 7061 6365  hi) of two space
-00020ee0: 2070 6f69 6e74 7320 696e 2070 6f6c 6172   points in polar
-00020ef0: 2063 6f6f 7264 696e 6174 6573 0a20 2020   coordinates.   
-00020f00: 2070 6172 7320 3d20 6e70 2e61 7272 6179   pars = np.array
-00020f10: 285b 302e 392c 2030 2e38 372c 2030 2e37  ([0.9, 0.87, 0.7
-00020f20: 3535 2c20 302e 3739 305d 290a 2020 2020  55, 0.790]).    
-00020f30: 7075 6e63 7320 3d20 6e70 2e61 7272 6179  puncs = np.array
-00020f40: 285b 302e 3032 372c 2030 2e30 3233 2c20  ([0.027, 0.023, 
-00020f50: 302e 3136 2c20 302e 3133 5d29 0a0a 2020  0.16, 0.13])..  
-00020f60: 2020 2320 7065 7266 6f72 6d20 6669 7420    # perform fit 
-00020f70: 746f 2064 6174 6120 7769 7468 2066 756e  to data with fun
-00020f80: 6374 696f 6e20 7846 6974 2075 7369 6e67  ction xFit using
-00020f90: 2063 6c61 7373 206d 6e46 6974 0a20 2020   class mnFit.   
-00020fa0: 2072 6573 756c 7444 6963 7420 3d20 7846   resultDict = xF
-00020fb0: 6974 2863 6172 7465 7369 616e 5f74 6f5f  it(cartesian_to_
-00020fc0: 706f 6c61 722c 2070 6172 732c 2073 203d  polar, pars, s =
-00020fd0: 2070 756e 6373 2c0a 2020 2020 2020 2020   puncs,.        
-00020fe0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00020ff0: 7265 6c3d 4e6f 6e65 2c20 7361 6273 636f  rel=None, sabsco
-00021000: 723d 4e6f 6e65 2c20 7372 656c 636f 723d  r=None, srelcor=
-00021010: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-00021020: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-00021030: 6573 3d5b 2772 272c 2027 7227 2c20 7227  es=['r', 'r', r'
-00021040: 245c 7661 7270 6869 2427 2c20 7227 245c  $\varphi$', r'$\
-00021050: 7661 7270 6869 2427 5d2c 0a20 2020 2020  varphi$'],.     
-00021060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021070: 2023 2070 303d 2831 2e2c 2031 2e29 2c20   # p0=(1., 1.), 
-00021080: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-00021090: 2020 2020 2020 2020 2020 2020 7573 655f              use_
-000210a0: 6e65 674c 6f67 4c3d 5472 7565 2c0a 2020  negLogL=True,.  
-000210b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210c0: 2020 2020 2070 6c6f 743d 5472 7565 2c0a       plot=True,.
-000210d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000210e0: 2020 2020 2020 2070 6c6f 745f 6261 6e64         plot_band
-000210f0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
-00021100: 2020 2020 2020 2020 2020 2020 2020 706c                pl
-00021110: 6f74 5f63 6f72 3d54 7275 652c 0a20 2020  ot_cor=True,.   
-00021120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021130: 2020 2020 7368 6f77 706c 6f74 733d 4661      showplots=Fa
-00021140: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-00021150: 2020 2020 2020 2020 2020 2020 7175 6965              quie
-00021160: 743d 4661 6c73 652c 0a20 2020 2020 2020  t=False,.       
-00021170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021180: 6178 6973 5f6c 6162 656c 733d 5b27 496e  axis_labels=['In
-00021190: 6465 7827 2c20 2778 2020 205c 2020 7828  dex', 'x   \  x(
-000211a0: 2a70 6172 2927 5d2c 200a 2020 2020 2020  *par)'], .      
-000211b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211c0: 2064 6174 615f 6c65 6765 6e64 203d 2027   data_legend = '
-000211d0: 506f 6c61 7220 4461 7461 272c 2020 2020  Polar Data',    
-000211e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000211f0: 2020 2020 2020 2020 6d6f 6465 6c5f 6c65          model_le
-00021200: 6765 6e64 203d 2027 722d 7068 6920 6672  gend = 'r-phi fr
-00021210: 6f6d 2078 2d79 2729 0a20 2020 2070 6c74  om x-y').    plt
-00021220: 2e73 7570 7469 746c 6528 226d 6e46 6974  .suptitle("mnFit
-00021230: 2065 7861 6d70 6c65 3a20 6669 7420 746f   example: fit to
-00021240: 2069 6e64 6578 6564 2064 6174 6122 2c0a   indexed data",.
-00021250: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00021260: 697a 653d 2778 782d 6c61 7267 6527 2c20  ize='xx-large', 
-00021270: 636f 6c6f 723d 2764 6172 6b62 6c75 6527  color='darkblue'
-00021280: 290a 2020 2020 0a20 2023 2050 7269 6e74  ).    .  # Print
-00021290: 2072 6573 756c 7473 200a 2020 2020 7076   results .    pv
-000212a0: 616c 732c 2070 6572 7273 2c20 636f 722c  als, perrs, cor,
-000212b0: 2063 6869 322c 2070 6e61 6d73 203d 2072   chi2, pnams = r
-000212c0: 6573 756c 7444 6963 742e 7661 6c75 6573  esultDict.values
-000212d0: 2829 0a20 2020 2070 7269 6e74 2827 5c6e  ().    print('\n
-000212e0: 2a3d 3d2a 2078 7946 6974 2052 6573 756c  *==* xyFit Resul
-000212f0: 743a 2729 0a20 2020 2070 7269 6e74 2822  t:').    print("
-00021300: 2070 6172 616d 6574 6572 206e 616d 6573   parameter names
-00021310: 3a20 2020 2020 2020 222c 2070 6e61 6d73  :       ", pnams
-00021320: 290a 2020 2020 7072 696e 7428 2220 6368  ).    print(" ch
-00021330: 6932 3a20 7b3a 2e33 677d 222e 666f 726d  i2: {:.3g}".form
-00021340: 6174 2863 6869 3229 290a 2020 2020 7072  at(chi2)).    pr
-00021350: 696e 7428 2220 7061 7261 6d65 7465 7220  int(" parameter 
-00021360: 7661 6c75 6573 3a20 2020 2020 2022 2c20  values:      ", 
-00021370: 7076 616c 7329 0a20 2020 2070 7269 6e74  pvals).    print
-00021380: 2822 206e 6567 2e20 7061 7261 6d65 7465  (" neg. paramete
-00021390: 7220 6572 726f 7273 3a20 222c 2070 6572  r errors: ", per
-000213a0: 7273 5b3a 2c30 5d29 0a20 2020 2070 7269  rs[:,0]).    pri
-000213b0: 6e74 2822 2070 6f73 2e20 7061 7261 6d65  nt(" pos. parame
-000213c0: 7465 7220 6572 726f 7273 3a20 222c 2070  ter errors: ", p
-000213d0: 6572 7273 5b3a 2c31 5d29 0a20 2020 2070  errs[:,1]).    p
-000213e0: 7269 6e74 2822 2063 6f72 7265 6c61 7469  rint(" correlati
-000213f0: 6f6e 7320 3a20 5c6e 222c 2063 6f72 290a  ons : \n", cor).
-00021400: 2020 2020 0a20 2064 6566 2065 7861 6d70      .  def examp
-00021410: 6c65 5f68 6973 746f 6772 616d 4669 7428  le_histogramFit(
-00021420: 293a 0a20 2023 0a20 2023 202a 2a2a 2048  ):.  #.  # *** H
-00021430: 6973 746f 6772 616d 2046 6974 3a20 4578  istogram Fit: Ex
-00021440: 616d 706c 6520 6f66 2061 6e20 6170 706c  ample of an appl
-00021450: 6963 6174 696f 6e20 6f66 2070 6879 4669  ication of phyFi
-00021460: 742e 6846 6974 2829 200a 2020 230a 0a20  t.hFit() .  #.. 
-00021470: 2023 2020 2020 2320 6465 6669 6e65 2074   #    # define t
-00021480: 6865 206d 6f64 656c 2066 756e 6374 696f  he model functio
-00021490: 6e20 746f 2066 6974 0a20 2020 2064 6566  n to fit.    def
-000214a0: 2053 706c 7573 425f 6d6f 6465 6c28 782c   SplusB_model(x,
-000214b0: 206d 7520 3d20 362e 3938 372c 2073 6967   mu = 6.987, sig
-000214c0: 6d61 203d 2030 2e35 2c20 613d 302e 2c20  ma = 0.5, a=0., 
-000214d0: 7320 3d20 302e 3229 3a0a 2020 2020 2020  s = 0.2):.      
-000214e0: 2727 2770 6466 206f 6620 6120 4761 7573  '''pdf of a Gaus
-000214f0: 7369 616e 2073 6967 6e61 6c20 6f6e 2074  sian signal on t
-00021500: 6f70 206f 6620 666c 6174 2062 6163 6b67  op of flat backg
-00021510: 726f 756e 640a 2020 2020 2020 2727 270a  round.      '''.
-00021520: 2020 2020 2020 6e6f 726d 616c 203d 206e        normal = n
-00021530: 702e 6578 7028 2d30 2e35 2a28 2878 2d6d  p.exp(-0.5*((x-m
-00021540: 7529 2f73 6967 6d61 292a 2a32 292f 6e70  u)/sigma)**2)/np
-00021550: 2e73 7172 7428 322e 2a6e 702e 7069 2a73  .sqrt(2.*np.pi*s
-00021560: 6967 6d61 2a2a 3229 0a20 2020 2020 206c  igma**2).      l
-00021570: 696e 6561 7220 3d20 2861 2a28 786d 782b  inear = (a*(xmx+
-00021580: 786d 6e29 2f32 202b 2031 2e29 2f28 786d  xmn)/2 + 1.)/(xm
-00021590: 782d 786d 6e29 200a 2020 2020 2020 7265  x-xmn) .      re
-000215a0: 7475 726e 2073 202a 206e 6f72 6d61 6c20  turn s * normal 
-000215b0: 2b20 2831 2d73 2920 2a20 6c69 6e65 6172  + (1-s) * linear
-000215c0: 200a 0a20 2020 206e 6269 6e73 3d34 300a   ..    nbins=40.
-000215d0: 2020 2020 786d 6e20 3d20 310a 2020 2020      xmn = 1.    
-000215e0: 786d 7820 3d20 3130 0a20 2020 2062 6564  xmx = 10.    bed
-000215f0: 6765 733d 6e70 2e6c 696e 7370 6163 6528  ges=np.linspace(
-00021600: 786d 6e2c 2078 6d78 2c20 6e62 696e 732b  xmn, xmx, nbins+
-00021610: 3129 0a20 2020 2062 636f 6e74 656e 7473  1).    bcontents
-00021620: 203d 206e 702e 6172 7261 7928 5b31 2c20   = np.array([1, 
-00021630: 312c 2031 2c20 322c 2032 2c20 322c 2034  1, 1, 2, 2, 2, 4
-00021640: 2c20 312c 2030 2c20 332c 2031 2c20 312c  , 1, 0, 3, 1, 1,
-00021650: 2030 2c0a 2020 2020 2020 2020 2020 2020   0,.            
-00021660: 2020 2020 2020 2020 2020 2020 322c 2033              2, 3
-00021670: 2c20 332c 2031 2c20 312c 2030 2c20 322c  , 3, 1, 1, 0, 2,
-00021680: 2033 2c20 322c 2033 2c20 312c 2031 2c20   3, 2, 3, 1, 1, 
-00021690: 382c 0a20 2020 2020 2020 2020 2020 2020  8,.             
-000216a0: 2020 2020 2020 2020 2020 2036 2c20 372c             6, 7,
-000216b0: 2039 2c20 312c 2030 2c20 312c 2032 2c20   9, 1, 0, 1, 2, 
-000216c0: 312c 2033 2c20 322c 2031 2c20 332c 2032  1, 3, 2, 1, 3, 2
-000216d0: 2c20 345d 290a 2020 2020 2320 200a 2020  , 4]).    #  .  
-000216e0: 2020 2320 2d2d 2d20 2070 6572 666f 726d    # ---  perform
-000216f0: 2066 6974 2020 0a20 2020 2023 0a20 2020   fit  .    #.   
-00021700: 2072 6573 756c 7444 6963 7420 3d20 6846   resultDict = hF
-00021710: 6974 2853 706c 7573 425f 6d6f 6465 6c2c  it(SplusB_model,
-00021720: 0a20 2020 2020 2020 2020 2062 636f 6e74  .          bcont
-00021730: 656e 7473 2c20 6265 6467 6573 2c20 2023  ents, bedges,  #
-00021740: 2062 696e 2065 6e74 7269 6573 2061 6e64   bin entries and
-00021750: 2062 696e 2065 6467 6573 0a20 2020 2020   bin edges.     
-00021760: 2020 2020 2070 303d 4e6f 6e65 2c20 2020       p0=None,   
-00021770: 2020 2020 2020 2020 2023 2069 6e69 7469           # initi
-00021780: 616c 2067 7565 7373 2066 6f72 2070 6172  al guess for par
-00021790: 616d 6574 6572 2076 616c 7565 7320 0a20  ameter values . 
-000217a0: 2020 2020 2320 2020 2020 636f 6e73 7472      #     constr
-000217b0: 6169 6e74 733d 5b27 7327 2c20 7661 6c20  aints=['s', val 
-000217c0: 2c20 6572 7220 5d2c 2020 2023 2063 6f6e  , err ],   # con
-000217d0: 7374 7261 696e 7473 2077 6974 6869 6e20  straints within 
-000217e0: 6572 726f 7273 0a20 2020 2020 2020 2020  errors.         
-000217f0: 2066 6978 5061 7273 203d 205b 2761 275d   fixPars = ['a']
-00021800: 2c20 2020 2020 2020 2020 2320 6669 7820  ,         # fix 
-00021810: 7061 7261 6d65 7465 7228 7329 200a 2020  parameter(s) .  
-00021820: 2020 2020 2020 2020 6c69 6d69 7473 3d28          limits=(
-00021830: 2773 272c 2030 2e2c 204e 6f6e 6529 2c20  's', 0., None), 
-00021840: 2023 206c 696d 6974 730a 2020 2020 2020   # limits.      
-00021850: 2020 2020 7573 655f 4761 7573 7341 7070      use_GaussApp
-00021860: 726f 783d 4661 6c73 652c 2020 2023 2047  rox=False,   # G
-00021870: 6175 7373 6961 6e20 6170 7072 6f78 696d  aussian approxim
-00021880: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-00021890: 6669 745f 6465 6e73 6974 7920 3d20 5472  fit_density = Tr
-000218a0: 7565 2c20 2020 2020 2023 2066 6974 2064  ue,      # fit d
-000218b0: 656e 7369 7479 0a20 2020 2020 2020 2020  ensity.         
-000218c0: 2070 6c6f 743d 5472 7565 2c20 2020 2020   plot=True,     
-000218d0: 2020 2020 2020 2320 706c 6f74 2064 6174        # plot dat
-000218e0: 6120 616e 6420 6d6f 6465 6c0a 2020 2020  a and model.    
-000218f0: 2020 2020 2020 706c 6f74 5f62 616e 643d        plot_band=
-00021900: 5472 7565 2c20 2020 2020 2023 2070 6c6f  True,      # plo
-00021910: 7420 6d6f 6465 6c20 636f 6e66 6964 656e  t model confiden
-00021920: 6365 2d62 616e 640a 2020 2020 2020 2020  ce-band.        
-00021930: 2020 706c 6f74 5f63 6f72 3d54 7275 652c    plot_cor=True,
-00021940: 2020 2020 2020 2320 706c 6f74 2070 726f        # plot pro
-00021950: 6669 6c65 7320 6c69 6b65 6c69 686f 6f64  files likelihood
-00021960: 2061 6e64 2063 6f6e 746f 7572 730a 2020   and contours.  
-00021970: 2020 2020 2020 2020 7368 6f77 706c 6f74          showplot
-00021980: 733d 4661 6c73 652c 2020 2020 2023 2073  s=False,     # s
-00021990: 686f 7720 2f20 646f 6e27 7420 7368 6f77  how / don't show
-000219a0: 2070 6c6f 7473 0a20 2020 2020 2020 2020   plots.         
-000219b0: 2071 7569 6574 3d46 616c 7365 2c20 2020   quiet=False,   
-000219c0: 2020 2020 2020 2320 7375 7070 7265 7373        # suppress
-000219d0: 2069 6e66 6f72 6d61 7469 7665 2070 7269   informative pri
-000219e0: 6e74 6f75 740a 2020 2020 2020 2020 2020  ntout.          
-000219f0: 6178 6973 5f6c 6162 656c 733d 5b27 7827  axis_labels=['x'
-00021a00: 2c20 2779 2020 205c 2020 6628 782c 202a  , 'y   \  f(x, *
-00021a10: 7061 7229 275d 2c20 0a20 2020 2020 2020  par)'], .       
-00021a20: 2020 2064 6174 615f 6c65 6765 6e64 203d     data_legend =
-00021a30: 2027 7261 6e64 6f6d 2064 6174 6127 2c20   'random data', 
-00021a40: 2020 200a 2020 2020 2020 2020 2020 6d6f     .          mo
-00021a50: 6465 6c5f 6c65 6765 6e64 203d 2027 7369  del_legend = 'si
-00021a60: 676e 616c 202b 2062 6163 6b67 726f 756e  gnal + backgroun
-00021a70: 6420 6d6f 6465 6c27 2029 0a0a 2020 2020  d model' )..    
-00021a80: 706c 742e 7375 7074 6974 6c65 2822 6d6e  plt.suptitle("mn
-00021a90: 4669 7420 6578 616d 706c 653a 2066 6974  Fit example: fit
-00021aa0: 2074 6f20 6869 7374 6f67 7261 6d20 6461   to histogram da
-00021ab0: 7461 222c 0a20 2020 2020 2020 2020 2020  ta",.           
-00021ac0: 2020 2073 697a 653d 2778 782d 6c61 7267     size='xx-larg
-00021ad0: 6527 2c20 636f 6c6f 723d 2764 6172 6b62  e', color='darkb
-00021ae0: 6c75 6527 290a 0a20 2020 2023 2050 7269  lue')..    # Pri
-00021af0: 6e74 2072 6573 756c 7473 200a 2020 2020  nt results .    
-00021b00: 7072 696e 7428 275c 6e2a 3d3d 2a20 6869  print('\n*==* hi
-00021b10: 7374 6f67 7261 6d20 6669 7420 5265 7375  stogram fit Resu
-00021b20: 6c74 3a27 290a 2020 2020 7076 616c 732c  lt:').    pvals,
-00021b30: 2070 6572 7273 2c20 636f 722c 2067 6f66   perrs, cor, gof
-00021b40: 2c20 706e 616d 7320 3d20 7265 7375 6c74  , pnams = result
-00021b50: 4469 6374 2e76 616c 7565 7328 290a 2020  Dict.values().  
-00021b60: 2020 7072 696e 7428 2220 7061 7261 6d65    print(" parame
-00021b70: 7465 7220 6e61 6d65 733a 2020 2020 2020  ter names:      
-00021b80: 2022 2c20 706e 616d 7329 0a20 2020 2070   ", pnams).    p
-00021b90: 7269 6e74 2822 2067 6f6f 646e 6573 732d  rint(" goodness-
-00021ba0: 6f66 2d66 6974 3a20 7b3a 2e33 677d 222e  of-fit: {:.3g}".
-00021bb0: 666f 726d 6174 2867 6f66 2929 0a20 2020  format(gof)).   
-00021bc0: 2070 7269 6e74 2822 2070 6172 616d 6574   print(" paramet
-00021bd0: 6572 2076 616c 7565 733a 2020 2020 2020  er values:      
-00021be0: 222c 2070 7661 6c73 290a 2020 2020 7072  ", pvals).    pr
-00021bf0: 696e 7428 2220 6e65 672e 2070 6172 616d  int(" neg. param
-00021c00: 6574 6572 2065 7272 6f72 733a 2022 2c20  eter errors: ", 
-00021c10: 7065 7272 735b 3a2c 305d 290a 2020 2020  perrs[:,0]).    
-00021c20: 7072 696e 7428 2220 706f 732e 2070 6172  print(" pos. par
-00021c30: 616d 6574 6572 2065 7272 6f72 733a 2022  ameter errors: "
-00021c40: 2c20 7065 7272 735b 3a2c 315d 290a 2020  , perrs[:,1]).  
-00021c50: 2020 7072 696e 7428 2220 636f 7272 656c    print(" correl
-00021c60: 6174 696f 6e73 203a 205c 6e22 2c20 636f  ations : \n", co
-00021c70: 7229 0a0a 2020 6465 6620 6578 616d 706c  r)..  def exampl
-00021c80: 655f 7573 6572 4669 7428 293a 0a20 2020  e_userFit():.   
-00021c90: 2022 2222 2a2a 756e 6269 6e6e 6564 204d   """**unbinned M
-00021ca0: 4c20 6669 742a 2a20 7769 7468 2075 7365  L fit** with use
-00021cb0: 722d 6465 6669 6e65 6420 636f 7374 2066  r-defined cost f
-00021cc0: 756e 6374 696f 6e0a 0a20 2020 2054 6869  unction..    Thi
-00021cd0: 7320 636f 6465 2069 6c6c 7573 7472 6174  s code illustrat
-00021ce0: 6573 2075 7361 6765 206f 6620 7468 6520  es usage of the 
-00021cf0: 7772 6170 7065 7220 6675 6e63 7469 6f6e  wrapper function
-00021d00: 206d 4669 7428 2920 200a 2020 2020 666f   mFit()  .    fo
-00021d10: 7220 2063 6c61 7373 202a 2a6d 6e46 6974  r  class **mnFit
-00021d20: 2a2a 2075 7365 722d 6465 6669 6e65 6420  ** user-defined 
-00021d30: 636f 7374 2066 756e 6374 696f 6e0a 2020  cost function.  
-00021d40: 2020 2222 2220 200a 0a20 2020 2023 2067    """  ..    # g
-00021d50: 656e 6572 6174 6520 4761 7573 7369 616e  enerate Gaussian
-00021d60: 2d64 6973 7472 6962 7574 6564 2064 6174  -distributed dat
-00021d70: 610a 2020 2020 6d75 303d 322e 0a20 2020  a.    mu0=2..   
-00021d80: 2073 6967 303d 302e 350a 2020 2020 6e70   sig0=0.5.    np
-00021d90: 2e72 616e 646f 6d2e 7365 6564 2833 3134  .random.seed(314
-00021da0: 3135 3929 2020 2320 696e 6974 6961 6c69  159)  # initiali
-00021db0: 7a65 2072 616e 646f 6d20 6765 6e65 7261  ze random genera
-00021dc0: 746f 720a 2020 2020 6461 7461 203d 206d  tor.    data = m
-00021dd0: 7530 202b 2073 6967 3020 2a20 6e70 2e72  u0 + sig0 * np.r
-00021de0: 616e 646f 6d2e 7261 6e64 6e28 3130 3029  andom.randn(100)
-00021df0: 0a0a 2020 2020 2320 6465 6669 6e65 2063  ..    # define c
-00021e00: 6f73 7420 6675 6e63 7469 6f6e 3a20 3220  ost function: 2 
-00021e10: 2a20 6e65 6761 7469 7665 206c 6f67 206c  * negative log l
-00021e20: 696b 656c 6968 6f6f 6420 6f66 2047 6175  ikelihood of Gau
-00021e30: c39f 3b0a 2020 2020 6465 6620 6d79 436f  ..;.    def myCo
-00021e40: 7374 286d 753d 312e 2c20 7369 676d 613d  st(mu=1., sigma=
-00021e50: 312e 293a 0a20 2020 2020 2023 2073 696d  1.):.      # sim
-00021e60: 706c 6520 2d32 2a6c 6f67 2d6c 696b 656c  ple -2*log-likel
-00021e70: 6968 6f6f 6420 6f66 2061 2031 2d64 2047  ihood of a 1-d G
-00021e80: 6175 7373 2064 6973 7472 6962 7574 696f  auss distributio
-00021e90: 6e0a 2020 2020 2020 723d 2028 6461 7461  n.      r= (data
-00021ea0: 2d6d 7529 2f73 6967 6d61 0a20 2020 2020  -mu)/sigma.     
-00021eb0: 2072 6574 7572 6e20 6e70 2e73 756d 2820   return np.sum( 
-00021ec0: 722a 7220 2b20 322e 2a6e 702e 6c6f 6728  r*r + 2.*np.log(
-00021ed0: 7369 676d 6129 290a 0a20 2020 2072 6573  sigma))..    res
-00021ee0: 756c 7444 6963 7420 3d20 6d46 6974 286d  ultDict = mFit(m
-00021ef0: 7943 6f73 742c 0a20 2020 2020 2020 2020  yCost,.         
-00021f00: 2070 303d 4e6f 6e65 2c20 2020 2020 2020   p0=None,       
-00021f10: 2020 2020 2020 2020 2020 2320 696e 6974            # init
-00021f20: 6961 6c20 6775 6573 7320 666f 7220 7061  ial guess for pa
-00021f30: 7261 6d65 7465 7220 7661 6c75 6573 200a  rameter values .
-00021f40: 2020 2020 2020 2020 2020 636f 6e73 7472            constr
-00021f50: 6169 6e74 733d 5b5b 276d 7527 2c20 322e  aints=[['mu', 2.
-00021f60: 2c20 302e 3031 5d5d 2c20 2320 4761 7573  , 0.01]], # Gaus
-00021f70: 7369 616e 2070 6172 616d 6574 6572 2063  sian parameter c
-00021f80: 6f6e 7374 7261 696e 7473 0a20 2020 2020  onstraints.     
-00021f90: 2020 2023 2020 6c69 6d69 7473 3d28 2773     #  limits=('s
-00021fa0: 6967 6d61 272c 204e 6f6e 652c 204e 6f6e  igma', None, Non
-00021fb0: 6529 2c20 2023 6c69 6d69 7473 0a20 2020  e),  #limits.   
-00021fc0: 2020 2020 2023 2020 6669 7850 6172 7320       #  fixPars 
-00021fd0: 3d20 5b27 6d75 275d 2c20 2020 2020 2020  = ['mu'],       
-00021fe0: 2023 2066 6978 2070 6172 616d 6574 6572   # fix parameter
-00021ff0: 2873 2920 0a20 2020 2020 2020 2020 206e  (s) .          n
-00022000: 6567 326c 6f67 4c20 3d20 5472 7565 2c20  eg2logL = True, 
-00022010: 2020 2020 2020 2020 2320 636f 7374 2069          # cost i
-00022020: 7320 2d32 202a 206c 6e28 4c29 0a20 2020  s -2 * ln(L).   
-00022030: 2020 2020 2020 2070 6c6f 745f 636f 723d         plot_cor=
-00022040: 5472 7565 2c20 2020 2020 2020 2020 2020  True,           
-00022050: 2320 706c 6f74 2070 726f 6669 6c65 7320  # plot profiles 
-00022060: 6c69 6b65 6c69 686f 6f64 2061 6e64 2063  likelihood and c
-00022070: 6f6e 746f 7572 730a 2020 2020 2020 2020  ontours.        
-00022080: 2020 7368 6f77 706c 6f74 733d 4661 6c73    showplots=Fals
-00022090: 652c 2020 2020 2020 2020 2023 2073 686f  e,         # sho
-000220a0: 7720 2f20 646f 6e27 7420 7368 6f77 2070  w / don't show p
-000220b0: 6c6f 7473 0a20 2020 2020 2020 2020 2071  lots.          q
-000220c0: 7569 6574 3d46 616c 7365 2c20 2020 2020  uiet=False,     
-000220d0: 2020 2020 2020 2020 2023 2073 7570 7072           # suppr
-000220e0: 6573 7320 696e 666f 726d 6174 6976 6520  ess informative 
-000220f0: 7072 696e 746f 7574 0a20 2020 2020 2020  printout.       
-00022100: 2020 2029 0a0a 2020 2020 706c 742e 7375     )..    plt.su
-00022110: 7074 6974 6c65 2822 4d61 7869 6d75 6d2d  ptitle("Maximum-
-00022120: 6c69 6b65 6c69 686f 6f64 2066 6974 3a20  likelihood fit: 
-00022130: 7072 6f66 696c 6573 2061 6e64 2063 6f6e  profiles and con
-00022140: 746f 7572 7322 2c0a 2020 2020 2020 2020  tours",.        
-00022150: 2020 2020 2020 2020 2020 2020 2073 697a               siz
-00022160: 653d 2778 782d 6c61 7267 6527 2c20 636f  e='xx-large', co
-00022170: 6c6f 723d 2764 6172 6b62 6c75 6527 290a  lor='darkblue').
-00022180: 2020 2020 2320 5072 696e 7420 7265 7375      # Print resu
-00022190: 6c74 730a 2020 2020 7076 616c 732c 2070  lts.    pvals, p
-000221a0: 6572 7273 2c20 636f 722c 2067 6f66 2c20  errs, cor, gof, 
-000221b0: 706e 616d 7320 3d20 7265 7375 6c74 4469  pnams = resultDi
-000221c0: 6374 2e76 616c 7565 7328 290a 2020 2020  ct.values().    
-000221d0: 7072 696e 7428 275c 6e2a 3d3d 2a20 7573  print('\n*==* us
-000221e0: 6572 2d64 6566 696e 6564 2063 6f73 743a  er-defined cost:
-000221f0: 2046 6974 2052 6573 756c 743a 2729 0a20   Fit Result:'). 
-00022200: 2020 2070 7269 6e74 2822 2070 6172 616d     print(" param
-00022210: 6574 6572 206e 616d 6573 3a20 2020 2020  eter names:     
-00022220: 2020 222c 2070 6e61 6d73 290a 2020 2020    ", pnams).    
-00022230: 7072 696e 7428 2220 7061 7261 6d65 7465  print(" paramete
-00022240: 7220 7661 6c75 6573 3a20 2020 2020 2022  r values:      "
-00022250: 2c20 7076 616c 7329 0a20 2020 2070 7269  , pvals).    pri
-00022260: 6e74 2822 206e 6567 2e20 7061 7261 6d65  nt(" neg. parame
-00022270: 7465 7220 6572 726f 7273 3a20 222c 2070  ter errors: ", p
-00022280: 6572 7273 5b3a 2c30 5d29 0a20 2020 2070  errs[:,0]).    p
-00022290: 7269 6e74 2822 2070 6f73 2e20 7061 7261  rint(" pos. para
-000222a0: 6d65 7465 7220 6572 726f 7273 3a20 222c  meter errors: ",
-000222b0: 2070 6572 7273 5b3a 2c31 5d29 0a20 2020   perrs[:,1]).   
-000222c0: 2070 7269 6e74 2822 2063 6f72 7265 6c61   print(" correla
-000222d0: 7469 6f6e 7320 3a20 5c6e 222c 2063 6f72  tions : \n", cor
-000222e0: 2920 200a 0a20 2064 6566 2065 7861 6d70  )  ..  def examp
-000222f0: 6c65 5f75 6e62 696e 6e65 644d 4c46 6974  le_unbinnedMLFit
-00022300: 2829 3a0a 2020 2020 2222 222a 2a75 6e62  ():.    """**unb
-00022310: 696e 6e65 6420 4d4c 2066 6974 2a2a 206f  inned ML fit** o
-00022320: 6620 7064 6620 746f 2075 6e62 696e 6e65  f pdf to unbinne
-00022330: 6420 6461 7461 0a20 2020 200a 2020 2020  d data.    .    
-00022340: 7265 616c 2064 6174 6120 6672 6f6d 206d  real data from m
-00022350: 6561 7375 7265 6d65 6e74 2077 6974 6820  easurement with 
-00022360: 6120 5761 7465 7220 4368 6572 656e 6b6f  a Water Cherenko
-00022370: 7620 6465 7465 6374 6f72 2028 224b 616d  v detector ("Kam
-00022380: 696f 6b61 6e6e 6522 290a 0a20 2020 206e  iokanne")..    n
-00022390: 756d 6265 7273 2072 6570 7265 7365 6e74  umbers represent
-000223a0: 2074 696d 6520 6469 6666 6572 656e 6365   time difference
-000223b0: 7320 2869 6e20 c2b5 7329 2062 6574 7765  s (in ..s) betwe
-000223c0: 656e 2074 6865 2070 6173 7361 6765 206f  en the passage o
-000223d0: 6620 6120 6d75 6f6e 0a20 2020 2061 6e64  f a muon.    and
-000223e0: 2074 6865 2072 6567 6973 7472 6174 696f   the registratio
-000223f0: 6e20 6f66 2061 2073 6563 6f6e 6420 7075  n of a second pu
-00022400: 6c73 652c 206f 6674 656e 2063 6175 7365  lse, often cause
-00022410: 6420 6279 2061 6e20 656c 6563 7472 6f6e  d by an electron
-00022420: 2066 726f 6d0a 2020 2020 7468 6520 6465   from.    the de
-00022430: 6361 7920 6f66 2074 6865 2073 746f 7070  cay of the stopp
-00022440: 6564 206d 756f 6e2e 2041 7320 7375 6368  ed muon. As such
-00022450: 2065 7665 6e74 7320 6172 6520 7261 7265   events are rare
-00022460: 2c20 6869 7374 6f67 7261 6d6d 696e 6720  , histogramming 
-00022470: 7468 650a 2020 2020 6461 7461 2070 7269  the.    data pri
-00022480: 6f72 2074 6f20 6669 7474 696e 6720 776f  or to fitting wo
-00022490: 756c 6420 696e 7472 6f64 7563 6520 7368  uld introduce sh
-000224a0: 6966 7473 2061 6e64 2062 6961 7365 732c  ifts and biases,
-000224b0: 2061 6e64 2074 6865 7265 666f 7265 2074   and therefore t
-000224c0: 6865 0a20 2020 2075 6e62 696e 6e65 6420  he.    unbinned 
-000224d0: 6669 7420 6973 2074 6865 206f 7074 696d  fit is the optim
-000224e0: 616c 206d 6574 686f 6420 666f 7220 7468  al method for th
-000224f0: 6973 2061 6e64 2073 696d 756c 6172 2075  is and simular u
-00022500: 7365 2063 6173 6573 2e20 0a20 2020 2022  se cases. .    "
-00022510: 2222 0a20 2020 2064 543d 5b37 2e34 322c  "".    dT=[7.42,
-00022520: 2033 2e37 3733 2c20 352e 3936 382c 2034   3.773, 5.968, 4
-00022530: 2e39 3234 2c20 312e 3436 382c 2034 2e36  .924, 1.468, 4.6
-00022540: 3634 2c20 312e 3734 352c 2032 2e31 3434  64, 1.745, 2.144
-00022550: 2c20 332e 3833 362c 2033 2e31 3332 2c0a  , 3.836, 3.132,.
-00022560: 2020 2020 2020 2020 312e 3536 382c 2032          1.568, 2
-00022570: 2e33 3532 2c20 322e 3133 322c 2039 2e33  .352, 2.132, 9.3
-00022580: 3831 2c20 312e 3438 342c 2031 2e31 3831  81, 1.484, 1.181
-00022590: 2c20 352e 3030 342c 2033 2e30 362c 2020  , 5.004, 3.06,  
-000225a0: 342e 3538 322c 2032 2e30 3736 2c0a 2020  4.582, 2.076,.  
-000225b0: 2020 2020 2020 312e 3838 2c20 2031 2e33        1.88,  1.3
-000225c0: 3337 2c20 332e 3039 322c 2032 2e32 3635  37, 3.092, 2.265
-000225d0: 2c20 312e 3230 382c 2032 2e37 3533 2c20  , 1.208, 2.753, 
-000225e0: 342e 3435 372c 2033 2e34 3939 2c20 382e  4.457, 3.499, 8.
-000225f0: 3139 322c 2035 2e31 3031 2c0a 2020 2020  192, 5.101,.    
-00022600: 2020 2020 312e 3537 322c 2035 2e31 3532      1.572, 5.152
-00022610: 2c20 342e 3138 312c 2033 2e35 322c 2020  , 4.181, 3.52,  
-00022620: 312e 3334 342c 2031 302e 3239 2c20 312e  1.344, 10.29, 1.
-00022630: 3135 322c 2032 2e33 3438 2c20 322e 3232  152, 2.348, 2.22
-00022640: 382c 2032 2e31 3732 2c0a 2020 2020 2020  8, 2.172,.      
-00022650: 2020 372e 3434 382c 2031 2e31 3038 2c20    7.448, 1.108, 
-00022660: 342e 3334 342c 2032 2e30 3432 2c20 352e  4.344, 2.042, 5.
-00022670: 3038 382c 2031 2e30 322c 2020 312e 3035  088, 1.02,  1.05
-00022680: 312c 2031 2e39 3837 2c20 312e 3933 352c  1, 1.987, 1.935,
-00022690: 2033 2e37 3733 2c0a 2020 2020 2020 2020   3.773,.        
-000226a0: 342e 3039 322c 2031 2e36 3238 2c20 312e  4.092, 1.628, 1.
-000226b0: 3638 382c 2034 2e35 3032 2c20 342e 3638  688, 4.502, 4.68
-000226c0: 372c 2036 2e37 3535 2c20 322e 3536 2c20  7, 6.755, 2.56, 
-000226d0: 2031 2e32 3038 2c20 322e 3634 392c 2031   1.208, 2.649, 1
-000226e0: 2e30 3132 2c0a 2020 2020 2020 2020 312e  .012,.        1.
-000226f0: 3733 2c20 2032 2e31 3634 2c20 312e 3732  73,  2.164, 1.72
-00022700: 382c 2034 2e36 3436 2c20 322e 3931 362c  8, 4.646, 2.916,
-00022710: 2031 2e31 3031 2c20 322e 3534 2c20 2031   1.101, 2.54,  1
-00022720: 2e30 322c 2020 312e 3137 362c 2034 2e37  .02,  1.176, 4.7
-00022730: 3136 2c0a 2020 2020 2020 2020 392e 3637  16,.        9.67
-00022740: 312c 2031 2e36 3932 2c20 392e 3239 322c  1, 1.692, 9.292,
-00022750: 2031 302e 3732 2c20 322e 3136 342c 2032   10.72, 2.164, 2
-00022760: 2e30 3834 2c20 322e 3631 362c 2031 2e35  .084, 2.616, 1.5
-00022770: 3834 2c20 352e 3233 362c 2033 2e36 3633  84, 5.236, 3.663
-00022780: 2c0a 2020 2020 2020 2020 332e 3632 342c  ,.        3.624,
-00022790: 2031 2e30 3531 2c20 312e 3534 342c 2031   1.051, 1.544, 1
-000227a0: 2e34 3936 2c20 312e 3838 332c 2031 2e39  .496, 1.883, 1.9
-000227b0: 322c 2020 352e 3936 382c 2035 2e38 392c  2,  5.968, 5.89,
-000227c0: 2020 322e 3839 362c 2032 2e37 362c 0a20    2.896, 2.76,. 
-000227d0: 2020 2020 2020 2031 2e34 3735 2c20 322e         1.475, 2.
-000227e0: 3634 342c 2033 2e36 2c20 2020 352e 3332  644, 3.6,   5.32
-000227f0: 342c 2038 2e33 3631 2c20 332e 3035 322c  4, 8.361, 3.052,
-00022800: 2037 2e37 3033 2c20 332e 3833 2c20 2031   7.703, 3.83,  1
-00022810: 2e34 3434 2c20 312e 3334 332c 0a20 2020  .444, 1.343,.   
-00022820: 2020 2020 2034 2e37 3336 2c20 382e 372c       4.736, 8.7,
-00022830: 2020 2036 2e31 3932 2c20 352e 3739 362c     6.192, 5.796,
-00022840: 2031 2e34 2c20 2020 332e 3339 322c 2037   1.4,   3.392, 7
-00022850: 2e38 3038 2c20 362e 3334 342c 2031 2e38  .808, 6.344, 1.8
-00022860: 3834 2c20 322e 3333 322c 0a20 2020 2020  84, 2.332,.     
-00022870: 2020 2031 2e37 362c 2020 342e 3334 342c     1.76,  4.344,
-00022880: 2032 2e39 3838 2c20 372e 3434 2c20 2035   2.988, 7.44,  5
-00022890: 2e38 3034 2c20 392e 352c 2020 2039 2e39  .804, 9.5,   9.9
-000228a0: 3034 2c20 332e 3139 362c 2033 2e30 3132  04, 3.196, 3.012
-000228b0: 2c20 362e 3035 362c 0a20 2020 2020 2020  , 6.056,.       
-000228c0: 2036 2e33 3238 2c20 392e 3036 342c 2033   6.328, 9.064, 3
-000228d0: 2e30 3638 2c20 392e 3335 322c 2031 2e39  .068, 9.352, 1.9
-000228e0: 3336 2c20 312e 3038 2c20 2031 2e39 3834  36, 1.08,  1.984
-000228f0: 2c20 312e 3739 322c 2039 2e33 3834 2c20  , 1.792, 9.384, 
-00022900: 3130 2e31 352c 0a20 2020 2020 2020 2034  10.15,.        4
-00022910: 2e37 3536 2c20 312e 3532 2c20 2033 2e39  .756, 1.52,  3.9
-00022920: 3132 2c20 312e 3731 322c 2031 302e 3537  12, 1.712, 10.57
-00022930: 2c20 352e 3330 342c 2032 2e39 3638 2c20  , 5.304, 2.968, 
-00022940: 392e 3633 322c 2037 2e31 3136 2c20 312e  9.632, 7.116, 1.
-00022950: 3231 322c 0a20 2020 2020 2020 2038 2e35  212,.        8.5
-00022960: 3332 2c20 332e 3030 302c 2034 2e37 3932  32, 3.000, 4.792
-00022970: 2c20 322e 3531 322c 2031 2e33 3532 2c20  , 2.512, 1.352, 
-00022980: 322e 3136 382c 2034 2e33 3434 2c20 312e  2.168, 4.344, 1.
-00022990: 3331 362c 2031 2e34 3638 2c20 312e 3135  316, 1.468, 1.15
-000229a0: 322c 0a20 2020 2020 2020 2036 2e30 3234  2,.        6.024
-000229b0: 2c20 332e 3237 322c 2034 2e39 362c 2031  , 3.272, 4.96, 1
-000229c0: 302e 3136 2c20 2032 2e31 342c 2020 322e  0.16,  2.14,  2.
-000229d0: 3835 362c 2031 302e 3031 2c20 312e 3233  856, 10.01, 1.23
-000229e0: 322c 2032 2e36 3638 2c20 392e 3137 3620  2, 2.668, 9.176 
-000229f0: 5d0a 0a20 2020 2064 6566 2065 7870 6f6e  ]..    def expon
-00022a00: 656e 7469 616c 4465 6361 7950 4446 2874  entialDecayPDF(t
-00022a10: 2c20 7461 753d 322e 2c20 6662 673d 302e  , tau=2., fbg=0.
-00022a20: 322c 2061 3d31 2e2c 2062 3d31 312e 3529  2, a=1., b=11.5)
-00022a30: 3a0a 2020 2020 2020 2222 2250 726f 6261  :.      """Proba
-00022a40: 6269 6c69 7479 2064 656e 7369 7479 2066  bility density f
-00022a50: 756e 6374 696f 6e20 0a0a 2020 2020 2020  unction ..      
-00022a60: 666f 7220 616e 2065 7870 6f6e 656e 7469  for an exponenti
-00022a70: 616c 2064 6563 6179 2077 6974 6820 666c  al decay with fl
-00022a80: 6174 2062 6163 6b67 726f 756e 642e 2054  at background. T
-00022a90: 6865 2070 6466 2069 7320 6e6f 726d 6564  he pdf is normed
-00022aa0: 2066 6f72 200a 2020 2020 2020 7468 6520   for .      the 
-00022ab0: 696e 7465 7276 616c 205b 613d 31c2 b573  interval [a=1..s
-00022ac0: 2c20 2062 3d31 312e 35c2 b573 293b 2074  ,  b=11.5..s); t
-00022ad0: 6865 7365 2070 6172 616d 6574 6572 7320  hese parameters 
-00022ae0: 6120 616e 6420 6220 6d75 7374 2062 6520  a and b must be 
-00022af0: 0a20 2020 2020 2066 6978 6564 2069 6e20  .      fixed in 
-00022b00: 7468 6520 6669 7421 200a 0a20 2020 2020  the fit! ..     
-00022b10: 203a 7061 7261 6d20 743a 2064 6563 6179   :param t: decay
-00022b20: 2074 696d 650a 2020 2020 2020 3a70 6172   time.      :par
-00022b30: 616d 2066 6267 3a20 6261 636b 6772 6f75  am fbg: backgrou
-00022b40: 6e64 0a20 2020 2020 203a 7061 7261 6d20  nd.      :param 
-00022b50: 7461 753a 2065 7870 6563 7465 6420 6d65  tau: expected me
-00022b60: 616e 206f 6620 7468 6520 6465 6361 7920  an of the decay 
-00022b70: 7469 6d65 0a20 2020 2020 203a 7061 7261  time.      :para
-00022b80: 6d20 613a 2074 6865 206d 696e 696d 756d  m a: the minimum
-00022b90: 2064 6563 6179 2074 696d 6520 7768 6963   decay time whic
-00022ba0: 6820 6361 6e20 6265 206d 6561 7375 7265  h can be measure
-00022bb0: 640a 2020 2020 2020 3a70 6172 616d 2062  d.      :param b
-00022bc0: 3a20 7468 6520 6d61 7869 6d75 6d20 6465  : the maximum de
-00022bd0: 6361 7920 7469 6d65 2077 6869 6368 2063  cay time which c
-00022be0: 616e 2062 6520 6d65 6173 7572 6564 0a20  an be measured. 
-00022bf0: 2020 2020 203a 7265 7475 726e 3a20 7072       :return: pr
-00022c00: 6f62 6162 696c 6974 7920 666f 7220 6465  obability for de
-00022c10: 6361 7920 7469 6d65 2078 0a20 2020 2020  cay time x.     
-00022c20: 2022 2222 0a20 2020 2020 2070 6466 3120   """.      pdf1 
-00022c30: 3d20 6e70 2e65 7870 282d 7420 2f20 7461  = np.exp(-t / ta
-00022c40: 7529 202f 2074 6175 202f 2028 6e70 2e65  u) / tau / (np.e
-00022c50: 7870 282d 6120 2f20 7461 7529 202d 206e  xp(-a / tau) - n
-00022c60: 702e 6578 7028 2d62 202f 2074 6175 2929  p.exp(-b / tau))
-00022c70: 0a20 2020 2020 2070 6466 3220 3d20 312e  .      pdf2 = 1.
-00022c80: 202f 2028 6220 2d20 6129 0a20 2020 2020   / (b - a).     
-00022c90: 2072 6574 7572 6e20 2831 202d 2066 6267   return (1 - fbg
-00022ca0: 2920 2a20 7064 6631 202b 2066 6267 202a  ) * pdf1 + fbg *
-00022cb0: 2070 6466 320a 0a20 2020 2072 6573 756c   pdf2..    resul
-00022cc0: 7444 6963 7420 3d20 6d46 6974 2820 6578  tDict = mFit( ex
-00022cd0: 706f 6e65 6e74 6961 6c44 6563 6179 5044  ponentialDecayPD
-00022ce0: 462c 0a20 2020 2020 2020 2020 2064 6174  F,.          dat
-00022cf0: 6120 3d20 6454 2c20 2320 6461 7461 202d  a = dT, # data -
-00022d00: 2069 6620 6e6f 7420 4e6f 6e65 2c20 6120   if not None, a 
-00022d10: 6e6f 726d 616c 6973 6564 2050 4446 2069  normalised PDF i
-00022d20: 7320 6173 7375 6d65 6420 6173 206d 6f64  s assumed as mod
-00022d30: 656c 2020 0a20 2020 2020 2020 2020 2070  el  .          p
-00022d40: 303d 4e6f 6e65 2c20 2020 2020 2020 2020  0=None,         
-00022d50: 2020 2020 2020 2020 2320 696e 6974 6961          # initia
-00022d60: 6c20 6775 6573 7320 666f 7220 7061 7261  l guess for para
-00022d70: 6d65 7465 7220 7661 6c75 6573 200a 2020  meter values .  
-00022d80: 2020 2020 2020 2320 2063 6f6e 7374 7261        #  constra
-00022d90: 696e 7473 3d5b 5b27 7461 7527 2c20 322e  ints=[['tau', 2.
-00022da0: 322c 2030 2e30 315d 2c20 2320 4761 7573  2, 0.01], # Gaus
-00022db0: 7369 616e 2070 6172 616d 6574 6572 2063  sian parameter c
-00022dc0: 6f6e 7374 7261 696e 7473 0a20 2020 2020  onstraints.     
-00022dd0: 2020 2020 206c 696d 6974 733d 2827 6662       limits=('fb
-00022de0: 6727 2c20 302e 2c20 312e 292c 2020 2320  g', 0., 1.),  # 
-00022df0: 7061 7261 6d65 7465 7220 6c69 6d69 7473  parameter limits
-00022e00: 0a20 2020 2020 2020 2020 2066 6978 5061  .          fixPa
-00022e10: 7273 203d 205b 2761 272c 2027 6227 5d2c  rs = ['a', 'b'],
-00022e20: 2020 2020 2320 6669 7820 7061 7261 6d65      # fix parame
-00022e30: 7465 7228 7329 200a 2020 2020 2020 2020  ter(s) .        
-00022e40: 2020 6e65 6732 6c6f 674c 203d 2054 7275    neg2logL = Tru
-00022e50: 652c 2020 2020 2020 2020 2023 2075 7365  e,         # use
-00022e60: 2020 2d32 202a 206c 6e28 4c29 0a20 2020    -2 * ln(L).   
-00022e70: 2020 2020 2020 2070 6c6f 743d 5472 7565         plot=True
-00022e80: 2c20 2020 2020 2020 2020 2020 2020 2020  ,               
-00022e90: 2320 706c 6f74 2064 6174 6120 616e 6420  # plot data and 
-00022ea0: 6d6f 6465 6c0a 2020 2020 2020 2020 2020  model.          
-00022eb0: 706c 6f74 5f62 616e 643d 5472 7565 2c20  plot_band=True, 
-00022ec0: 2020 2020 2020 2020 2023 2070 6c6f 7420           # plot 
-00022ed0: 6d6f 6465 6c20 636f 6e66 6964 656e 6365  model confidence
-00022ee0: 2d62 616e 640a 2020 2020 2020 2020 2020  -band.          
-00022ef0: 706c 6f74 5f63 6f72 3d46 616c 7365 2c20  plot_cor=False, 
-00022f00: 2020 2020 2020 2020 2023 2070 6c6f 7420           # plot 
-00022f10: 7072 6f66 696c 6573 206c 696b 656c 6968  profiles likelih
-00022f20: 6f6f 6420 616e 6420 636f 6e74 6f75 7273  ood and contours
-00022f30: 0a20 2020 2020 2020 2020 2073 686f 7770  .          showp
-00022f40: 6c6f 7473 3d46 616c 7365 2c20 2020 2020  lots=False,     
-00022f50: 2020 2020 2320 7368 6f77 202f 2064 6f6e      # show / don
-00022f60: 2774 2073 686f 7720 706c 6f74 730a 2020  't show plots.  
-00022f70: 2020 2020 2020 2020 7175 6965 743d 4661          quiet=Fa
-00022f80: 6c73 652c 2020 2020 2020 2020 2020 2020  lse,            
-00022f90: 2023 2073 7570 7072 6573 7320 696e 666f   # suppress info
-00022fa0: 726d 6174 6976 6520 7072 696e 746f 7574  rmative printout
-00022fb0: 2069 6620 5472 7565 0a20 2020 2020 2020   if True.       
-00022fc0: 2020 2061 7869 735f 6c61 6265 6c73 3d5b     axis_labels=[
-00022fd0: 276c 6966 6520 7469 6d65 2020 2720 2b20  'life time  ' + 
-00022fe0: 2724 5c44 656c 7461 2474 2028 245c 6d75  '$\Delta$t ($\mu
-00022ff0: 2473 2927 2c20 0a20 2020 2020 2020 2020  $s)', .         
-00023000: 2020 2020 2020 2020 2020 2020 2020 2750                'P
-00023010: 726f 6261 6269 6c69 7479 2044 656e 7369  robability Densi
-00023020: 7479 2020 7064 6628 245c 4465 6c74 6124  ty  pdf($\Delta$
-00023030: 743b 202a 7029 275d 2c20 0a20 2020 2020  t; *p)'], .     
-00023040: 2020 2020 2064 6174 615f 6c65 6765 6e64       data_legend
-00023050: 203d 2027 245c 6d75 2420 6c69 6665 7469   = '$\mu$ lifeti
-00023060: 6d65 2064 6174 6127 2c20 2020 200a 2020  me data',    .  
-00023070: 2020 2020 2020 2020 6d6f 6465 6c5f 6c65          model_le
-00023080: 6765 6e64 203d 2027 6578 706f 6e65 6e74  gend = 'exponent
-00023090: 6961 6c20 6465 6361 7920 2b20 666c 6174  ial decay + flat
-000230a0: 2062 6163 6b67 726f 756e 6427 2029 0a20   background' ). 
-000230b0: 2020 2020 2020 2020 200a 2020 2020 706c           .    pl
-000230c0: 742e 7375 7074 6974 6c65 2822 556e 6269  t.suptitle("Unbi
-000230d0: 6e6e 6564 204d 4c20 6669 7420 6f66 2061  nned ML fit of a
-000230e0: 6e20 6578 706f 6e65 6e74 6961 6c20 2b20  n exponential + 
-000230f0: 666c 6174 2064 6973 7472 6962 7574 696f  flat distributio
-00023100: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
-00023110: 2020 2020 2020 2020 2073 697a 653d 2778           size='x
-00023120: 782d 6c61 7267 6527 2c20 636f 6c6f 723d  x-large', color=
-00023130: 2764 6172 6b62 6c75 6527 290a 2020 2020  'darkblue').    
-00023140: 2320 5072 696e 7420 7265 7375 6c74 730a  # Print results.
-00023150: 2020 2020 7076 616c 732c 2070 6572 7273      pvals, perrs
-00023160: 2c20 636f 722c 2067 6f66 2c20 706e 616d  , cor, gof, pnam
-00023170: 7320 3d20 7265 7375 6c74 4469 6374 2e76  s = resultDict.v
-00023180: 616c 7565 7328 290a 2020 2020 7072 696e  alues().    prin
-00023190: 7428 275c 6e2a 3d3d 2a20 756e 6269 6e6e  t('\n*==* unbinn
-000231a0: 6564 204d 4c20 4669 7420 5265 7375 6c74  ed ML Fit Result
-000231b0: 3a27 290a 2020 2020 7072 696e 7428 2220  :').    print(" 
-000231c0: 7061 7261 6d65 7465 7220 6e61 6d65 733a  parameter names:
-000231d0: 2020 2020 2020 2022 2c20 706e 616d 7329         ", pnams)
-000231e0: 0a20 2020 2070 7269 6e74 2822 2070 6172  .    print(" par
-000231f0: 616d 6574 6572 2076 616c 7565 733a 2020  ameter values:  
-00023200: 2020 2020 222c 2070 7661 6c73 290a 2020      ", pvals).  
-00023210: 2020 7072 696e 7428 2220 6e65 672e 2070    print(" neg. p
-00023220: 6172 616d 6574 6572 2065 7272 6f72 733a  arameter errors:
-00023230: 2022 2c20 7065 7272 735b 3a2c 305d 290a   ", perrs[:,0]).
-00023240: 2020 2020 7072 696e 7428 2220 706f 732e      print(" pos.
-00023250: 2070 6172 616d 6574 6572 2065 7272 6f72   parameter error
-00023260: 733a 2022 2c20 7065 7272 735b 3a2c 315d  s: ", perrs[:,1]
-00023270: 290a 2020 2020 7072 696e 7428 2220 636f  ).    print(" co
-00023280: 7272 656c 6174 696f 6e73 203a 205c 6e22  rrelations : \n"
-00023290: 2c20 636f 7229 2020 0a0a 2020 230a 2020  , cor)  ..  #.  
-000232a0: 2320 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  # --------------
+0001c4f0: 662e 5061 7261 6d65 7465 724e 616d 6573  f.ParameterNames
+0001c500: 2029 0a20 2020 2065 6c73 653a 0a20 2020   ).    else:.   
+0001c510: 2020 2020 7274 7570 6c65 3d20 286e 702e      rtuple= (np.
+0001c520: 636f 6e63 6174 656e 6174 6528 2028 7365  concatenate( (se
+0001c530: 6c66 2e66 7265 6550 6172 5661 6c73 2c20  lf.freeParVals, 
+0001c540: 7365 6c66 2e66 6978 6564 5061 7256 616c  self.fixedParVal
+0001c550: 7329 2029 2c0a 2020 2020 2020 2020 2020  s) ),.          
+0001c560: 2020 2020 2020 7365 6c66 2e4f 6e65 5369        self.OneSi
+0001c570: 6749 6e74 6572 7661 6c2c 0a20 2020 2020  gInterval,.     
+0001c580: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001c590: 436f 7272 656c 6174 696f 6e4d 6174 7269  CorrelationMatri
+0001c5a0: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
+0001c5b0: 2020 2073 656c 662e 476f 462c 0a20 2020     self.GoF,.   
+0001c5c0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+0001c5d0: 636f 6e63 6174 656e 6174 6528 2028 7365  concatenate( (se
+0001c5e0: 6c66 2e66 7265 6550 6172 4e61 6d73 2c20  lf.freeParNams, 
+0001c5f0: 7365 6c66 2e66 6978 6564 5061 724e 616d  self.fixedParNam
+0001c600: 7329 2029 2029 0a20 2020 206b 6579 7320  s) ) ).    keys 
+0001c610: 3d20 2820 2770 6172 616d 6574 6572 2076  = ( 'parameter v
+0001c620: 616c 7565 7327 2c0a 2020 2020 2020 2020  alues',.        
+0001c630: 2020 2020 2027 636f 6e66 6964 656e 6365       'confidence
+0001c640: 2069 6e74 6572 7661 6c73 272c 0a20 2020   intervals',.   
+0001c650: 2020 2020 2020 2020 2020 2763 6f72 7265            'corre
+0001c660: 6c61 7469 6f6e 206d 6174 7269 7827 2c0a  lation matrix',.
+0001c670: 2020 2020 2020 2020 2020 2020 2027 676f               'go
+0001c680: 6f64 6e65 7373 2d6f 662d 6669 7427 2c0a  odness-of-fit',.
+0001c690: 2020 2020 2020 2020 2020 2020 2027 7061               'pa
+0001c6a0: 7261 6d65 7465 7220 6e61 6d65 7327 2029  rameter names' )
+0001c6b0: 0a20 2020 2023 2062 7569 6c64 2064 6963  .    # build dic
+0001c6c0: 7469 6f6e 6172 790a 2020 2020 7365 6c66  tionary.    self
+0001c6d0: 2e52 6573 756c 7444 6963 7469 6f6e 6172  .ResultDictionar
+0001c6e0: 7920 3d20 7b6b 3a72 7475 706c 655b 695d  y = {k:rtuple[i]
+0001c6f0: 2066 6f72 2028 692c 206b 2920 696e 2065   for (i, k) in e
+0001c700: 6e75 6d65 7261 7465 286b 6579 7329 7d0a  numerate(keys)}.
+0001c710: 2020 2020 0a20 2064 6566 2067 6574 5265      .  def getRe
+0001c720: 7375 6c74 2873 656c 6629 3a0a 2020 2020  sult(self):.    
+0001c730: 2222 2272 6574 7572 6e20 7265 7375 6c74  """return result
+0001c740: 2064 6963 7469 6f6e 6172 790a 2020 2020   dictionary.    
+0001c750: 2222 220a 2020 2020 6966 2073 656c 662e  """.    if self.
+0001c760: 5265 7375 6c74 4469 6374 696f 6e61 7279  ResultDictionary
+0001c770: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+0001c780: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001c790: 5265 7375 6c74 4469 6374 696f 6e61 7279  ResultDictionary
+0001c7a0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+0001c7b0: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+0001c7c0: 726f 7228 0a20 2020 2020 2020 2022 2021  ror(.        " !
+0001c7d0: 2121 206d 6e46 6974 2e67 6574 5265 7375  !! mnFit.getResu
+0001c7e0: 6c74 3a20 6e6f 2072 6573 756c 7473 2061  lt: no results a
+0001c7f0: 7661 696c 6162 6c65 202d 2072 756e 2066  vailable - run f
+0001c800: 6974 2066 6972 7374 2229 0a20 2020 2020  it first").     
+0001c810: 2020 0a20 2040 7374 6174 6963 6d65 7468    .  @staticmeth
+0001c820: 6f64 0a20 2064 6566 2067 6574 4675 6e63  od.  def getFunc
+0001c830: 7469 6f6e 4572 726f 7228 782c 206d 6f64  tionError(x, mod
+0001c840: 656c 2c20 7076 616c 732c 2063 6f76 702c  el, pvals, covp,
+0001c850: 2066 6978 6564 5061 7273 293a 0a20 2020   fixedPars):.   
+0001c860: 2022 2222 2064 6574 6572 6d69 6e65 2065   """ determine e
+0001c870: 7272 6f72 206f 6620 6d6f 6465 6c20 6174  rror of model at
+0001c880: 2078 2020 0a20 2020 200a 2020 2020 466f   x  .    .    Fo
+0001c890: 726d 756c 613a 200a 2020 2020 2020 4465  rmula: .      De
+0001c8a0: 6c74 6128 7829 203d 2073 7172 7428 2073  lta(x) = sqrt( s
+0001c8b0: 756d 5f69 2c6a 2028 6466 2f64 705f 6928  um_i,j (df/dp_i(
+0001c8c0: 7829 2064 662f 6470 5f6a 2878 2920 5670  x) df/dp_j(x) Vp
+0001c8d0: 5f69 2c6a 2920 290a 0a20 2020 2041 7267  _i,j) )..    Arg
+0001c8e0: 733a 0a20 2020 2020 202a 2078 3a20 7363  s:.      * x: sc
+0001c8f0: 616c 6172 206f 7220 6e70 2d61 7272 6179  alar or np-array
+0001c900: 206f 6620 7820 7661 6c75 6573 0a20 2020   of x values.   
+0001c910: 2020 202a 206d 6f64 656c 3a20 6d6f 6465     * model: mode
+0001c920: 6c20 6675 6e63 7469 6f6e 0a20 2020 2020  l function.     
+0001c930: 202a 2070 766c 6173 3a20 7061 7261 6d65   * pvlas: parame
+0001c940: 7465 7220 7661 6c75 6573 0a20 2020 2020  ter values.     
+0001c950: 202a 2063 6f76 703a 2063 6f76 6172 6961   * covp: covaria
+0001c960: 6e63 6520 6d61 7472 6978 206f 6620 7061  nce matrix of pa
+0001c970: 7261 6d65 7465 7273 0a0a 2020 2020 5265  rameters..    Re
+0001c980: 7475 726e 733a 0a20 2020 2020 202a 206d  turns:.      * m
+0001c990: 6f64 656c 2075 6e63 6572 7461 696e 7479  odel uncertainty
+0001c9a0: 2c20 7361 6d65 206c 656e 6774 6820 6173  , same length as
+0001c9b0: 2078 0a20 2020 2022 2222 0a0a 2020 2020   x.    """..    
+0001c9c0: 2320 6361 6c63 756c 6174 6520 7061 7274  # calculate part
+0001c9d0: 6961 6c20 6465 7269 7661 7469 7665 7320  ial derivatives 
+0001c9e0: 6f66 206d 6f64 656c 2077 2e72 2e74 2070  of model w.r.t p
+0001c9f0: 6172 616d 6574 6572 7320 2020 200a 0a20  arameters    .. 
+0001ca00: 2020 2023 2020 2070 6172 616d 6574 6572     #   parameter
+0001ca10: 2073 7465 7020 7369 7a65 200a 2020 2020   step size .    
+0001ca20: 6470 203d 2030 2e30 3120 2a20 6e70 2e73  dp = 0.01 * np.s
+0001ca30: 7172 7428 6e70 2e64 6961 676f 6e61 6c28  qrt(np.diagonal(
+0001ca40: 636f 7670 2929 0a20 2020 2023 206e 756d  covp)).    # num
+0001ca50: 6265 7220 6f66 2076 6172 6961 626c 6520  ber of variable 
+0001ca60: 7061 7261 6d65 7465 7273 200a 2020 2020  parameters .    
+0001ca70: 6e76 7061 7220 3d20 6c65 6e28 6470 290a  nvpar = len(dp).
+0001ca80: 2020 2020 2320 2020 6465 7269 7661 7469      #   derivati
+0001ca90: 7665 2064 662f 6470 5f6a 2061 7420 6561  ve df/dp_j at ea
+0001caa0: 6368 2078 5f69 0a20 2020 2064 6664 7020  ch x_i.    dfdp 
+0001cab0: 3d20 6e70 2e65 6d70 7479 2820 286e 7670  = np.empty( (nvp
+0001cac0: 6172 2c20 6c65 6e28 7829 2920 290a 2020  ar, len(x)) ).  
+0001cad0: 2020 705f 706c 7573 203d 206e 702e 6172    p_plus = np.ar
+0001cae0: 7261 7928 7076 616c 732c 2063 6f70 793d  ray(pvals, copy=
+0001caf0: 5472 7565 290a 2020 2020 705f 6d69 6e75  True).    p_minu
+0001cb00: 7320 3d20 6e70 2e61 7272 6179 2870 7661  s = np.array(pva
+0001cb10: 6c73 2c20 636f 7079 3d54 7275 6529 0a20  ls, copy=True). 
+0001cb20: 2020 206b 3d30 0a20 2020 2066 6f72 206a     k=0.    for j
+0001cb30: 2069 6e20 7261 6e67 6528 6c65 6e28 7076   in range(len(pv
+0001cb40: 616c 7329 293a 0a20 2020 2020 2069 6620  als)):.      if 
+0001cb50: 6e6f 7420 6669 7865 6450 6172 735b 6a5d  not fixedPars[j]
+0001cb60: 3a0a 2020 2020 2020 2020 705f 706c 7573  :.        p_plus
+0001cb70: 5b6a 5d20 3d20 7076 616c 735b 6a5d 202b  [j] = pvals[j] +
+0001cb80: 2064 705b 6b5d 0a20 2020 2020 2020 2070   dp[k].        p
+0001cb90: 5f6d 696e 7573 5b6a 5d20 3d20 7076 616c  _minus[j] = pval
+0001cba0: 735b 6a5d 202d 2064 705b 6b5d 0a20 2020  s[j] - dp[k].   
+0001cbb0: 2020 2020 2064 6664 705b 6b5d 203d 2030       dfdp[k] = 0
+0001cbc0: 2e35 202f 2064 705b 6b5d 202a 2028 0a20  .5 / dp[k] * (. 
+0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbe0: 2020 206d 6f64 656c 2878 2c20 2a70 5f70     model(x, *p_p
+0001cbf0: 6c75 7329 202d 200a 2020 2020 2020 2020  lus) - .        
+0001cc00: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+0001cc10: 6c28 782c 202a 705f 6d69 6e75 7329 2029  l(x, *p_minus) )
+0001cc20: 0a20 2020 2020 2020 2070 5f70 6c75 735b  .        p_plus[
+0001cc30: 6a5d 203d 2070 7661 6c73 5b6a 5d0a 2020  j] = pvals[j].  
+0001cc40: 2020 2020 2020 705f 6d69 6e75 735b 6a5d        p_minus[j]
+0001cc50: 203d 2070 7661 6c73 5b6a 5d0a 2020 2020   = pvals[j].    
+0001cc60: 2020 2020 6b2b 3d31 0a20 2020 2023 2020      k+=1.    #  
+0001cc70: 2073 7175 6172 6520 6f66 2075 6e63 6572   square of uncer
+0001cc80: 7461 696e 7469 6573 206f 6e20 6675 6e63  tainties on func
+0001cc90: 7469 6f6e 2076 616c 7565 730a 2020 2020  tion values.    
+0001cca0: 4465 6c74 613d 206e 702e 656d 7074 7928  Delta= np.empty(
+0001ccb0: 6c65 6e28 7829 290a 2020 2020 666f 7220  len(x)).    for 
+0001ccc0: 6920 696e 2072 616e 6765 286c 656e 2878  i in range(len(x
+0001ccd0: 2929 3a0a 2020 2020 2020 4465 6c74 615b  )):.      Delta[
+0001cce0: 695d 203d 206e 702e 7375 6d28 6e70 2e6f  i] = np.sum(np.o
+0001ccf0: 7574 6572 2864 6664 705b 3a2c 695d 2c20  uter(dfdp[:,i], 
+0001cd00: 6466 6470 5b3a 2c69 5d29 202a 2063 6f76  dfdp[:,i]) * cov
+0001cd10: 7029 0a20 2020 2072 6574 7572 6e20 6e70  p).    return np
+0001cd20: 2e73 7172 7428 4465 6c74 6129 200a 2020  .sqrt(Delta) .  
+0001cd30: 0a0a 2020 6465 6620 646f 5f66 6974 2873  ..  def do_fit(s
+0001cd40: 656c 6629 3a0a 2020 2020 2222 2270 6572  elf):.    """per
+0001cd50: 666f 726d 2061 6c6c 206e 6563 6573 7361  form all necessa
+0001cd60: 7279 2073 7465 7073 206f 6620 6669 7420  ry steps of fit 
+0001cd70: 7365 7175 656e 6365 0a20 2020 2022 2222  sequence.    """
+0001cd80: 0a20 2020 2069 6620 7365 6c66 2e64 6174  .    if self.dat
+0001cd90: 6120 6973 204e 6f6e 6520 616e 6420 7365  a is None and se
+0001cda0: 6c66 2e66 6974 5f74 7970 6520 213d 2022  lf.fit_type != "
+0001cdb0: 7573 6572 223a 0a20 2020 2020 2072 6169  user":.      rai
+0001cdc0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+0001cdd0: 2020 2020 2020 2027 2021 2121 206d 6e46         ' !!! mnF
+0001cde0: 6974 3a20 6e6f 2064 6174 6120 6f62 6a65  it: no data obje
+0001cdf0: 6374 2064 6566 696e 6564 202d 2063 616c  ct defined - cal
+0001ce00: 6c20 696e 6974 5f64 6174 6128 2927 290a  l init_data()').
+0001ce10: 2020 2020 6966 2073 656c 662e 636f 7374      if self.cost
+0001ce20: 6620 6973 204e 6f6e 653a 0a20 2020 2020  f is None:.     
+0001ce30: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+0001ce40: 726f 7228 0a20 2020 2020 2020 2027 2121  ror(.        '!!
+0001ce50: 2120 6d6e 4669 743a 206e 6f20 6669 7420  ! mnFit: no fit 
+0001ce60: 6f62 6a65 6374 2064 6566 696e 6564 202d  object defined -
+0001ce70: 2063 616c 6c20 696e 6974 5f66 6974 2829   call init_fit()
+0001ce80: 2729 0a20 2020 200a 2020 2020 2320 7375  ').    .    # su
+0001ce90: 6d6d 6172 697a 6520 6f70 7469 6f6e 730a  mmarize options.
+0001cea0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0001ceb0: 7175 6965 743a 0a20 2020 2020 2069 6620  quiet:.      if 
+0001cec0: 7365 6c66 2e69 7465 7261 7465 4669 743a  self.iterateFit:
+0001ced0: 0a20 2020 2020 2020 2070 7269 6e74 2820  .        print( 
+0001cee0: 272a 3d3d 2a20 6d6e 4669 7420 7374 6172  '*==* mnFit star
+0001cef0: 7469 6e67 2070 7265 2d66 6974 2729 0a20  ting pre-fit'). 
+0001cf00: 2020 2020 2065 6c73 653a 200a 2020 2020       else: .    
+0001cf10: 2020 2020 7072 696e 7428 2027 2a3d 3d2a      print( '*==*
+0001cf20: 206d 6e46 6974 2073 7461 7274 696e 6720   mnFit starting 
+0001cf30: 6669 7427 290a 2020 2020 2020 7072 696e  fit').      prin
+0001cf40: 7428 2027 2020 4f70 7469 6f6e 733a 2729  t( '  Options:')
+0001cf50: 0a20 2020 2020 2066 6f72 206b 6579 2069  .      for key i
+0001cf60: 6e20 7365 6c66 2e6f 7074 696f 6e73 2e6b  n self.options.k
+0001cf70: 6579 7328 293a 0a20 2020 2020 2020 2072  eys():.        r
+0001cf80: 656c 6576 616e 7420 3d20 7365 6c66 2e6f  elevant = self.o
+0001cf90: 7074 696f 6e73 5b6b 6579 5d5b 315d 203d  ptions[key][1] =
+0001cfa0: 3d20 2261 6c6c 2220 6f72 205c 0a20 2020  = "all" or \.   
+0001cfb0: 2020 2020 2020 2073 656c 662e 6669 745f         self.fit_
+0001cfc0: 7479 7065 2069 6e20 7365 6c66 2e6f 7074  type in self.opt
+0001cfd0: 696f 6e73 5b6b 6579 5d5b 315d 0a20 2020  ions[key][1].   
+0001cfe0: 2020 2020 2069 6620 7265 6c65 7661 6e74       if relevant
+0001cff0: 3a0a 2020 2020 2020 2020 2020 696f 7074  :.          iopt
+0001d000: 203d 2073 656c 662e 6f70 7469 6f6e 735b   = self.options[
+0001d010: 6b65 795d 5b30 5d20 2b20 320a 2020 2020  key][0] + 2.    
+0001d020: 2020 2020 2020 7072 696e 7428 352a 2220        print(5*" 
+0001d030: 2220 2b20 222d 2022 2c0a 2020 2020 2020  " + "- ",.      
+0001d040: 2020 2020 2020 2020 7365 6c66 2e6f 7074          self.opt
+0001d050: 696f 6e73 5b6b 6579 5d5b 696f 7074 5d29  ions[key][iopt])
+0001d060: 0a20 2020 2020 2070 7269 6e74 2827 5c6e  .      print('\n
+0001d070: 2729 2020 0a0a 2020 2020 2320 7065 7266  ')  ..    # perf
+0001d080: 6f72 6d20 2869 6e69 7469 616c 2920 6669  orm (initial) fi
+0001d090: 740a 2020 2020 7472 793a 0a20 2020 2020  t.    try:.     
+0001d0a0: 2073 656c 662e 6d69 6772 6164 5265 7375   self.migradResu
+0001d0b0: 6c74 203d 2073 656c 662e 6d69 6e75 6974  lt = self.minuit
+0001d0c0: 2e6d 6967 7261 6428 2920 2023 2066 696e  .migrad()  # fin
+0001d0d0: 6420 6d69 6e69 6d75 6d20 6f66 2063 6f73  d minimum of cos
+0001d0e0: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
+0001d0f0: 2073 656c 662e 6d69 6772 6164 5f6f 6b20   self.migrad_ok 
+0001d100: 3d20 5472 7565 0a20 2020 2065 7863 6570  = True.    excep
+0001d110: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+0001d120: 3a0a 2020 2020 2020 7365 6c66 2e6d 6967  :.      self.mig
+0001d130: 7261 645f 6f6b 203d 2046 616c 7365 0a20  rad_ok = False. 
+0001d140: 2020 2020 2070 7269 6e74 2865 290a 2020       print(e).  
+0001d150: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
+0001d160: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0001d170: 272a 3d3d 2a20 2121 2120 6669 7420 7769  '*==* !!! fit wi
+0001d180: 7468 206d 6967 7261 6420 6661 696c 6564  th migrad failed
+0001d190: 2729 0a0a 2020 2020 2320 706f 7373 6962  ')..    # possib
+0001d1a0: 6c79 2c20 6e65 6564 2074 6f20 6974 6572  ly, need to iter
+0001d1b0: 6174 650a 2020 2020 6966 2073 656c 662e  ate.    if self.
+0001d1c0: 6974 6572 6174 6546 6974 3a0a 2020 2020  iterateFit:.    
+0001d1d0: 2020 6966 206e 6f74 2073 656c 662e 7175    if not self.qu
+0001d1e0: 6965 743a 0a20 2020 2020 2020 2070 7269  iet:.        pri
+0001d1f0: 6e74 2820 272a 3d3d 2a20 6d6e 4669 7420  nt( '*==* mnFit 
+0001d200: 6974 6572 6174 696e 6727 2c0a 2020 2020  iterating',.    
+0001d210: 2020 2020 2020 2020 2020 2027 746f 2061             'to a
+0001d220: 6363 6f75 6e74 2066 6f72 2070 6172 616d  ccount for param
+0001d230: 6574 6572 2d64 6570 656e 6465 6e74 2075  eter-dependent u
+0001d240: 6e63 6572 7461 696e 7469 6573 2729 0a20  ncertainties'). 
+0001d250: 2020 2020 2023 2065 6e61 626c 6520 6479       # enable dy
+0001d260: 6e61 6d69 6320 6361 6c63 756c 6174 696f  namic calculatio
+0001d270: 6e20 6f66 2063 6f76 6172 6961 6e63 6520  n of covariance 
+0001d280: 6d61 7472 6978 0a20 2020 2020 2073 656c  matrix.      sel
+0001d290: 662e 6461 7461 2e69 6e69 745f 6479 6e61  f.data.init_dyna
+0001d2a0: 6d69 6345 7272 6f72 7328 290a 0a20 2020  micErrors()..   
+0001d2b0: 2020 2023 2066 6974 2077 6974 6820 6479     # fit with dy
+0001d2c0: 6e61 6d69 6320 7265 6361 6c63 756c 6174  namic recalculat
+0001d2d0: 696f 6e20 6f66 2063 6f76 6172 6961 6e63  ion of covarianc
+0001d2e0: 6520 6d61 7472 6978 0a20 2020 2020 2074  e matrix.      t
+0001d2f0: 7279 3a0a 2020 2020 2020 2020 7365 6c66  ry:.        self
+0001d300: 2e6d 6967 7261 6452 6573 756c 7420 3d20  .migradResult = 
+0001d310: 7365 6c66 2e6d 696e 7569 742e 6d69 6772  self.minuit.migr
+0001d320: 6164 2829 0a20 2020 2020 2020 2073 656c  ad().        sel
+0001d330: 662e 6d69 6772 6164 5f6f 6b20 3d20 5472  f.migrad_ok = Tr
+0001d340: 7565 0a20 2020 2020 2065 7863 6570 7420  ue.      except 
+0001d350: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+0001d360: 2020 2020 2020 2020 7365 6c66 2e6d 6967          self.mig
+0001d370: 7261 645f 6f6b 203d 2046 616c 7365 0a20  rad_ok = False. 
+0001d380: 2020 2020 2020 2070 7269 6e74 2865 290a         print(e).
+0001d390: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+0001d3a0: 6e74 696d 6545 7272 6f72 280a 2020 2020  ntimeError(.    
+0001d3b0: 2020 2020 2020 272a 3d3d 2a20 2121 2120        '*==* !!! 
+0001d3c0: 6974 6572 6174 696f 6e20 6f66 2066 6974  iteration of fit
+0001d3d0: 2077 6974 6820 6d69 6772 6164 2066 6169   with migrad fai
+0001d3e0: 6c65 6427 290a 0a20 2020 2023 2072 756e  led')..    # run
+0001d3f0: 2070 726f 6669 6c65 206c 696b 656c 6968   profile likelih
+0001d400: 6f6f 6420 7363 616e 2074 6f20 6368 6563  ood scan to chec
+0001d410: 6b20 666f 7220 6173 796d 6d65 7472 6963  k for asymmetric
+0001d420: 2065 7272 6f72 730a 2020 2020 6966 2073   errors.    if s
+0001d430: 656c 662e 7275 6e5f 6d69 6e6f 733a 0a20  elf.run_minos:. 
+0001d440: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0001d450: 2e71 7569 6574 3a0a 2020 2020 2020 2020  .quiet:.        
+0001d460: 7072 696e 7428 2027 2a3d 3d2a 206d 6e46  print( '*==* mnF
+0001d470: 6974 2073 7461 7274 696e 6720 6d69 6e6f  it starting mino
+0001d480: 7320 7363 616e 2729 0a20 2020 2020 2074  s scan').      t
+0001d490: 7279 3a20 200a 2020 2020 2020 2020 7365  ry:  .        se
+0001d4a0: 6c66 2e6d 696e 6f73 5265 7375 6c74 203d  lf.minosResult =
+0001d4b0: 2073 656c 662e 6d69 6e75 6974 2e6d 696e   self.minuit.min
+0001d4c0: 6f73 2829 0a20 2020 2020 2020 2073 656c  os().        sel
+0001d4d0: 662e 6d69 6e6f 735f 6f6b 203d 2054 7275  f.minos_ok = Tru
+0001d4e0: 650a 2020 2020 2020 6578 6365 7074 2045  e.      except E
+0001d4f0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
+0001d500: 2020 2020 2020 2073 656c 662e 6d69 6e6f         self.mino
+0001d510: 735f 6f6b 203d 2046 616c 7365 0a20 2020  s_ok = False.   
+0001d520: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0001d530: 2e71 7569 6574 3a0a 2020 2020 2020 2020  .quiet:.        
+0001d540: 2020 7072 696e 7428 2027 2a3d 3d2a 206d    print( '*==* m
+0001d550: 6e46 6974 3a20 2121 2120 6d69 6e6f 7320  nFit: !!! minos 
+0001d560: 6661 696c 6564 205c 6e27 2c20 6529 2020  failed \n', e)  
+0001d570: 2020 0a20 2020 2073 656c 662e 5f73 746f    .    self._sto
+0001d580: 7265 5265 7375 6c74 2829 0a20 2020 2072  reResult().    r
+0001d590: 6574 7572 6e20 7365 6c66 2e6d 6967 7261  eturn self.migra
+0001d5a0: 6452 6573 756c 742c 2073 656c 662e 6d69  dResult, self.mi
+0001d5b0: 6e6f 7352 6573 756c 740a 0a0a 2020 6465  nosResult...  de
+0001d5c0: 6620 7365 7450 6c6f 744f 7074 696f 6e73  f setPlotOptions
+0001d5d0: 2873 656c 6629 3a0a 2020 2020 2222 2253  (self):.    """S
+0001d5e0: 6574 206f 7074 696f 6e73 2066 6f72 206e  et options for n
+0001d5f0: 6963 6572 2070 6c6f 7474 696e 670a 2020  icer plotting.  
+0001d600: 2020 2222 220a 0a20 2020 2023 2074 6f20    """..    # to 
+0001d610: 6265 2069 6d70 6c65 6d65 6e74 6564 0a20  be implemented. 
+0001d620: 2020 2070 6173 730a 0a20 2064 6566 2070     pass..  def p
+0001d630: 6c6f 744d 6f64 656c 2873 656c 662c 0a20  lotModel(self,. 
+0001d640: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0001d650: 7869 735f 6c61 6265 6c73 3d5b 2778 272c  xis_labels=['x',
+0001d660: 2027 7920 3d20 6628 782c 202a 7061 7229   'y = f(x, *par)
+0001d670: 275d 2c20 0a20 2020 2020 2020 2020 2020  '], .           
+0001d680: 2020 2020 2064 6174 615f 6c65 6765 6e64       data_legend
+0001d690: 203d 2027 6461 7461 272c 2020 2020 0a20   = 'data',    . 
+0001d6a0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001d6b0: 6f64 656c 5f6c 6567 656e 6420 3d20 2766  odel_legend = 'f
+0001d6c0: 6974 272c 0a20 2020 2020 2020 2020 2020  it',.           
+0001d6d0: 2020 2020 2070 6c6f 745f 6261 6e64 3d54       plot_band=T
+0001d6e0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+0001d6f0: 2020 2020 2073 616d 655f 706c 6f74 3d20       same_plot= 
+0001d700: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+0001d710: 2020 2020 2020 2070 6c6f 745f 7265 7369         plot_resi
+0001d720: 6475 616c 3d46 616c 7365 293a 200a 2020  dual=False): .  
+0001d730: 2020 2222 220a 2020 2020 506c 6f74 206d    """.    Plot m
+0001d740: 6f64 656c 2066 756e 6374 696f 6e20 616e  odel function an
+0001d750: 6420 6461 7461 200a 2020 2020 0a20 2020  d data .    .   
+0001d760: 2055 7365 7320 696d 696e 7569 744f 626a   Uses iminuitObj
+0001d770: 6563 742c 2063 6f73 7420 4675 6e63 7469  ect, cost Functi
+0001d780: 6f6e 2028 616e 6420 6461 7461 206f 626a  on (and data obj
+0001d790: 6563 7429 0a0a 2020 2020 4172 6773 3a20  ect)..    Args: 
+0001d7a0: 0a20 2020 2020 202a 206c 6973 7420 6f66  .      * list of
+0001d7b0: 2073 7472 3a20 6178 6973 206c 6162 656c   str: axis label
+0001d7c0: 730a 2020 2020 2020 2a20 7374 723a 206c  s.      * str: l
+0001d7d0: 6567 656e 6420 666f 7220 6461 7461 0a20  egend for data. 
+0001d7e0: 2020 2020 202a 2073 7472 3a20 6c65 6765       * str: lege
+0001d7f0: 6e64 2066 6f72 206d 6f64 656c 200a 2020  nd for model .  
+0001d800: 2020 2020 2a20 706c 6f74 5f62 616e 643a      * plot_band:
+0001d810: 2070 6c6f 7420 6d6f 6465 6c20 636f 6e66   plot model conf
+0001d820: 6964 656e 6365 2062 616e 6420 6966 2054  idence band if T
+0001d830: 7275 650a 2020 2020 2020 2a20 7361 6d65  rue.      * same
+0001d840: 5f70 6c6f 743a 2061 6363 756d 756c 6174  _plot: accumulat
+0001d850: 6520 6669 7420 7265 7375 6c74 7320 6672  e fit results fr
+0001d860: 6f6d 2070 7265 7669 6f75 7320 6361 6c6c  om previous call
+0001d870: 2069 6620 5472 7565 0a20 2020 2020 202a   if True.      *
+0001d880: 2070 6c6f 745f 7265 7369 6475 616c 3a20   plot_residual: 
+0001d890: 706c 6f74 2072 6573 6964 7561 6c20 772e  plot residual w.
+0001d8a0: 722e 742e 206d 6f64 656c 2069 6620 5472  r.t. model if Tr
+0001d8b0: 7565 0a0a 2020 2020 5265 7475 726e 733a  ue..    Returns:
+0001d8c0: 0a20 2020 2020 202a 206d 6174 706c 6f74  .      * matplot
+0001d8d0: 6c69 6220 6669 6775 7265 0a20 2020 2022  lib figure.    "
+0001d8e0: 2222 0a20 2020 200a 2020 2320 6163 6365  "".    .  # acce
+0001d8f0: 7373 206f 626a 6563 7473 0a20 2020 206d  ss objects.    m
+0001d900: 203d 2073 656c 662e 6d69 6e75 6974 2020   = self.minuit  
+0001d910: 2320 6d69 6e75 6974 206f 626a 6563 740a  # minuit object.
+0001d920: 2020 2020 6366 203d 2073 656c 662e 636f      cf = self.co
+0001d930: 7374 6620 2023 2063 6f73 7420 6675 6e63  stf  # cost func
+0001d940: 7469 6f6e 206f 626a 6563 740a 2020 2020  tion object.    
+0001d950: 6420 3d20 6366 2e64 6174 610a 2020 2020  d = cf.data.    
+0001d960: 6e70 7473 203d 206d 6178 2831 3930 2c20  npts = max(190, 
+0001d970: 352a 642e 646c 656e 6774 6829 2023 206e  5*d.dlength) # n
+0001d980: 756d 6265 7220 6f66 2070 6f69 6e74 7320  umber of points 
+0001d990: 666f 7220 6d6f 6465 6c20 6675 6e63 7469  for model functi
+0001d9a0: 6f6e 0a20 2020 200a 2020 2320 7265 7472  on.    .  # retr
+0001d9b0: 6965 7665 2066 6974 2072 6573 756c 7473  ieve fit results
+0001d9c0: 0a20 2020 2070 6e61 6d73 203d 2073 656c  .    pnams = sel
+0001d9d0: 662e 5061 7261 6d65 7465 724e 616d 6573  f.ParameterNames
+0001d9e0: 0a20 2020 2070 7661 6c73 203d 2073 656c  .    pvals = sel
+0001d9f0: 662e 5061 7261 6d65 7465 7256 616c 7565  f.ParameterValue
+0001da00: 730a 2020 2020 706d 6572 7273 203d 2073  s.    pmerrs = s
+0001da10: 656c 662e 4f6e 6553 6967 496e 7465 7276  elf.OneSigInterv
+0001da20: 616c 0a20 2020 2023 2020 7379 6d6d 6574  al.    #  symmet
+0001da30: 7269 6320 6572 726f 7273 0a20 2020 2070  ric errors.    p
+0001da40: 6572 7273 203d 2028 706d 6572 7273 5b3a  errs = (pmerrs[:
+0001da50: 2c31 5d2d 706d 6572 7273 5b3a 2c30 5d29  ,1]-pmerrs[:,0])
+0001da60: 2f32 2e0a 2020 2020 636f 7220 3d20 7365  /2..    cor = se
+0001da70: 6c66 2e43 6f72 7265 6c61 7469 6f6e 4d61  lf.CorrelationMa
+0001da80: 7472 6978 0a20 2020 2023 2020 636f 7661  trix.    #  cova
+0001da90: 7269 616e 6365 206d 6174 7269 7820 6672  riance matrix fr
+0001daa0: 6f6d 2063 6f72 7265 6c61 7469 6f6e 730a  om correlations.
+0001dab0: 2020 2020 7063 6f76 203d 2063 6f72 202a      pcov = cor *
+0001dac0: 206e 702e 6f75 7465 7228 7065 7272 732c   np.outer(perrs,
+0001dad0: 2070 6572 7273 290a 2020 2020 676f 6620   perrs).    gof 
+0001dae0: 3d20 7365 6c66 2e47 6f46 0a20 2020 206e  = self.GoF.    n
+0001daf0: 646f 6620 3d20 6366 2e6e 646f 660a 2020  dof = cf.ndof.  
+0001db00: 2020 2320 2063 6869 3270 7262 0a20 2020    #  chi2prb.   
+0001db10: 2069 6620 676f 6620 6973 206e 6f74 204e   if gof is not N
+0001db20: 6f6e 653a 0a20 2020 2020 2063 6869 3270  one:.      chi2p
+0001db30: 7262 203d 2073 656c 662e 6368 6932 7072  rb = self.chi2pr
+0001db40: 6228 676f 662c 206e 646f 6629 200a 2020  b(gof, ndof) .  
+0001db50: 2020 656c 7365 3a0a 2020 2020 2020 6368    else:.      ch
+0001db60: 6932 7072 6220 3d20 4e6f 6e65 2020 2020  i2prb = None    
+0001db70: 2020 0a20 2020 2023 2076 616c 7565 7320    .    # values 
+0001db80: 6f66 2066 7265 6520 616e 6420 6669 7865  of free and fixe
+0001db90: 6420 7061 7261 6d65 7465 7273 0a20 2020  d parameters.   
+0001dba0: 2066 6978 6564 5061 7273 203d 2073 656c   fixedPars = sel
+0001dbb0: 662e 6669 7865 6450 6172 730a 2020 2020  f.fixedPars.    
+0001dbc0: 6672 6565 5f70 7661 6c73 203d 2073 656c  free_pvals = sel
+0001dbd0: 662e 6672 6565 5061 7256 616c 730a 2020  f.freeParVals.  
+0001dbe0: 2020 6672 6565 5f70 6e61 6d73 203d 2073    free_pnams = s
+0001dbf0: 656c 662e 6672 6565 5061 724e 616d 730a  elf.freeParNams.
+0001dc00: 2020 2020 6669 7865 645f 706e 616d 733d      fixed_pnams=
+0001dc10: 2073 656c 662e 6669 7865 6450 6172 4e61   self.fixedParNa
+0001dc20: 6d73 0a20 2020 2066 6978 6564 5f70 7661  ms.    fixed_pva
+0001dc30: 6c73 3d20 7365 6c66 2e66 6978 6564 5061  ls= self.fixedPa
+0001dc40: 7256 616c 730a 2020 2020 6e66 6978 6564  rVals.    nfixed
+0001dc50: 203d 206c 656e 2866 6978 6564 5f70 7661   = len(fixed_pva
+0001dc60: 6c73 290a 2020 2020 0a20 2023 2070 6c6f  ls).    .  # plo
+0001dc70: 7420 6461 7461 0a20 2020 2066 6967 5f6d  t data.    fig_m
+0001dc80: 6f64 656c 203d 2064 2e70 6c6f 7428 6669  odel = d.plot(fi
+0001dc90: 6773 697a 653d 2837 2e35 2c20 362e 3529  gsize=(7.5, 6.5)
+0001dca0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001dcb0: 2020 2020 2020 2020 2064 6174 615f 6c61           data_la
+0001dcc0: 6265 6c3d 6461 7461 5f6c 6567 656e 642c  bel=data_legend,
+0001dcd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dce0: 2020 2020 2020 2020 706c 6f74 5f72 6573          plot_res
+0001dcf0: 6964 7561 6c3d 706c 6f74 5f72 6573 6964  idual=plot_resid
+0001dd00: 7561 6c29 0a0a 2020 2320 6f76 6572 6c61  ual)..  # overla
+0001dd10: 7920 6d6f 6465 6c20 6675 6e63 7469 6f6e  y model function
+0001dd20: 0a20 2020 2023 2068 6973 746f 6772 616d  .    # histogram
+0001dd30: 2066 6974 2070 726f 7669 6465 7320 6e6f   fit provides no
+0001dd40: 726d 616c 6973 6564 2064 6973 7472 6962  rmalised distrib
+0001dd50: 7574 696f 6e2c 0a20 2020 2023 2020 2020  ution,.    #    
+0001dd60: 6465 7465 726d 696e 6520 6269 6e20 7769  determine bin wi
+0001dd70: 6474 6873 2061 6e64 2073 6361 6c65 2066  dths and scale f
+0001dd80: 6163 746f 720a 2020 2020 786d 696e 2c20  actor.    xmin, 
+0001dd90: 786d 6178 203d 2070 6c74 2e78 6c69 6d28  xmax = plt.xlim(
+0001dda0: 290a 2020 2020 7870 6c74 203d 206e 702e  ).    xplt = np.
+0001ddb0: 6c69 6e73 7061 6365 2878 6d69 6e2c 2078  linspace(xmin, x
+0001ddc0: 6d61 782c 206e 7074 7329 0a20 2020 2078  max, npts).    x
+0001ddd0: 7661 6c73 203d 2078 706c 7420 0a20 2020  vals = xplt .   
+0001dde0: 2069 6620 7365 6c66 2e66 6974 5f74 7970   if self.fit_typ
+0001ddf0: 653d 3d27 6869 7374 273a 0a20 2020 2020  e=='hist':.     
+0001de00: 2023 2064 6574 656d 696e 6520 6c6f 6361   # detemine loca
+0001de10: 6c20 6269 6e20 7769 6474 680a 2020 2020  l bin width.    
+0001de20: 2020 6277 6964 7468 7320 3d20 6e70 2e7a    bwidths = np.z
+0001de30: 6572 6f73 286c 656e 2878 706c 7429 290a  eros(len(xplt)).
+0001de40: 2020 2020 2020 693d 300a 2020 2020 2020        i=0.      
+0001de50: 666f 7220 6a2c 2078 2069 6e20 656e 756d  for j, x in enum
+0001de60: 6572 6174 6528 7870 6c74 293a 0a20 2020  erate(xplt):.   
+0001de70: 2020 2020 2069 6620 7820 3e3d 2063 662e       if x >= cf.
+0001de80: 6461 7461 2e72 6967 6874 735b 6d69 6e28  data.rights[min(
+0001de90: 692c 2063 662e 6461 7461 2e6e 6269 6e73  i, cf.data.nbins
+0001dea0: 2d31 295d 3a0a 2020 2020 2020 2020 2020  -1)]:.          
+0001deb0: 6920 2b3d 2031 0a20 2020 2020 2020 2062  i += 1.        b
+0001dec0: 7769 6474 6873 5b6a 5d20 3d20 6366 2e64  widths[j] = cf.d
+0001ded0: 6174 612e 7769 6474 6873 5b6d 696e 2869  ata.widths[min(i
+0001dee0: 2c20 6366 2e64 6174 612e 6e62 696e 732d  , cf.data.nbins-
+0001def0: 3129 5d0a 2020 2020 2020 7366 6163 203d  1)].      sfac =
+0001df00: 2063 662e 6e6f 726d 202a 2062 7769 6474   cf.norm * bwidt
+0001df10: 6873 0a20 2020 2065 6c69 6620 7365 6c66  hs.    elif self
+0001df20: 2e66 6974 5f74 7970 653d 3d22 7879 2220  .fit_type=="xy" 
+0001df30: 6f72 2073 656c 662e 6669 745f 7479 7065  or self.fit_type
+0001df40: 3d3d 276d 6c27 3a0a 2020 2020 2020 7366  =='ml':.      sf
+0001df50: 6163 203d 2031 2e0a 2020 2020 656c 6966  ac = 1..    elif
+0001df60: 2073 656c 662e 6669 745f 7479 7065 3d3d   self.fit_type==
+0001df70: 2269 6e64 6578 6564 223a 0a20 2020 2020  "indexed":.     
+0001df80: 2073 6661 6320 3d20 312e 0a20 2020 2020   sfac = 1..     
+0001df90: 2078 7661 6c73 203d 2063 662e 6461 7461   xvals = cf.data
+0001dfa0: 2e78 0a20 2020 2020 2078 706c 7420 3d20  .x.      xplt = 
+0001dfb0: 6e70 2e6c 696e 7370 6163 6528 302e 352c  np.linspace(0.5,
+0001dfc0: 206c 656e 2878 7661 6c73 292d 302e 352c   len(xvals)-0.5,
+0001dfd0: 206c 656e 2878 7661 6c73 2929 0a20 2020   len(xvals)).   
+0001dfe0: 2065 6c73 653a 0a20 2020 2020 2070 7269   else:.      pri
+0001dff0: 6e74 2822 212a 2a21 206d 6e46 6974 2e70  nt("!**! mnFit.p
+0001e000: 6c6f 744d 6f64 656c 3a20 756e 6b6e 6f77  lotModel: unknow
+0001e010: 6e20 6669 7420 7479 7065 3a20 222c 2073  n fit type: ", s
+0001e020: 656c 662e 6669 745f 7479 7065 290a 2020  elf.fit_type).  
+0001e030: 2020 2020 7366 6163 203d 2031 2e0a 2020      sfac = 1..  
+0001e040: 2020 2020 7265 7475 726e 0a20 2020 200a      return.    .
+0001e050: 2020 2020 2320 646f 2077 6520 7761 6e74      # do we want
+0001e060: 206d 6f64 656c 206f 7220 7265 7369 6475   model or residu
+0001e070: 616c 7320 3f20 200a 2020 2020 6966 2070  als ?  .    if p
+0001e080: 6c6f 745f 7265 7369 6475 616c 3a0a 2020  lot_residual:.  
+0001e090: 2020 2020 7970 6c74 203d 206e 702e 7a65      yplt = np.ze
+0001e0a0: 726f 7328 6c65 6e28 7870 6c74 2929 0a20  ros(len(xplt)). 
+0001e0b0: 2020 2065 6c73 653a 0a20 2020 2020 2079     else:.      y
+0001e0c0: 706c 7420 3d20 6366 2e6d 6f64 656c 2878  plt = cf.model(x
+0001e0d0: 7661 6c73 2c20 2a70 7661 6c73 290a 0a20  vals, *pvals).. 
+0001e0e0: 2020 2023 2020 706c 6f74 206d 6f64 656c     #  plot model
+0001e0f0: 206c 696e 650a 2020 2020 6966 2073 656c   line.    if sel
+0001e100: 662e 6669 745f 7479 7065 203d 3d20 2269  f.fit_type == "i
+0001e110: 6e64 6578 6564 223a 0a20 2020 2020 2070  ndexed":.      p
+0001e120: 6c74 2e65 7272 6f72 6261 7228 7870 6c74  lt.errorbar(xplt
+0001e130: 2c20 7970 6c74 2c20 666d 743d 2720 272c  , yplt, fmt=' ',
+0001e140: 2078 6572 723d 302e 342c 206c 6162 656c   xerr=0.4, label
+0001e150: 3d6d 6f64 656c 5f6c 6567 656e 642c 0a20  =model_legend,. 
+0001e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e170: 2020 2020 616c 7068 613d 302e 372c 2065      alpha=0.7, e
+0001e180: 6c69 6e65 7769 6474 683d 322e 352c 2063  linewidth=2.5, c
+0001e190: 6f6c 6f72 3d27 6461 726b 6f72 616e 6765  olor='darkorange
+0001e1a0: 2729 0a20 2020 2065 6c73 653a 0a20 2020  ').    else:.   
+0001e1b0: 2020 2070 6c74 2e70 6c6f 7428 7870 6c74     plt.plot(xplt
+0001e1c0: 2c20 7970 6c74 2a73 6661 632c 206c 6162  , yplt*sfac, lab
+0001e1d0: 656c 3d6d 6f64 656c 5f6c 6567 656e 642c  el=model_legend,
+0001e1e0: 0a20 2020 2020 2020 2020 2020 2020 6c69  .             li
+0001e1f0: 6e65 7374 796c 653d 2764 6173 6865 6427  nestyle='dashed'
+0001e200: 2c20 6c69 6e65 7769 6474 683d 322e 352c  , linewidth=2.5,
+0001e210: 2061 6c70 6861 203d 2030 2e37 290a 2020   alpha = 0.7).  
+0001e220: 2023 2320 2020 2020 2020 2020 2063 6f6c   ##          col
+0001e230: 6f72 3d27 6461 726b 6f72 616e 6765 2729  or='darkorange')
+0001e240: 0a20 2020 2070 6c74 2e78 6c61 6265 6c28  .    plt.xlabel(
+0001e250: 6178 6973 5f6c 6162 656c 735b 305d 2c20  axis_labels[0], 
+0001e260: 7369 7a65 3d27 782d 6c61 7267 6527 290a  size='x-large').
+0001e270: 2020 2020 706c 742e 796c 6162 656c 2861      plt.ylabel(a
+0001e280: 7869 735f 6c61 6265 6c73 5b31 5d2c 2073  xis_labels[1], s
+0001e290: 697a 653d 2778 2d6c 6172 6765 2729 0a20  ize='x-large'). 
+0001e2a0: 2020 2070 6c74 2e67 7269 6428 290a 0a20     plt.grid().. 
+0001e2b0: 2020 2023 2064 7261 7720 6572 726f 7220     # draw error 
+0001e2c0: 6261 6e64 2061 726f 756e 6420 6d6f 6465  band around mode
+0001e2d0: 6c20 6675 6e63 7469 6f6e 0a20 2020 2069  l function.    i
+0001e2e0: 6620 706c 6f74 5f62 616e 643a 0a20 2020  f plot_band:.   
+0001e2f0: 2020 2069 6620 7365 6c66 2e66 6974 5f74     if self.fit_t
+0001e300: 7970 6520 213d 2022 696e 6465 7865 6422  ype != "indexed"
+0001e310: 3a0a 2020 2020 2020 2020 4465 6c74 6146  :.        DeltaF
+0001e320: 203d 2073 656c 662e 6765 7446 756e 6374   = self.getFunct
+0001e330: 696f 6e45 7272 6f72 2878 706c 742c 2063  ionError(xplt, c
+0001e340: 662e 6d6f 6465 6c2c 2070 7661 6c73 2c20  f.model, pvals, 
+0001e350: 7063 6f76 2c20 6669 7865 6450 6172 7329  pcov, fixedPars)
+0001e360: 0a20 2020 2020 2020 2070 6c74 2e66 696c  .        plt.fil
+0001e370: 6c5f 6265 7477 6565 6e28 7870 6c74 2c20  l_between(xplt, 
+0001e380: 7366 6163 2a28 7970 6c74 2b44 656c 7461  sfac*(yplt+Delta
+0001e390: 4629 2c0a 2020 2020 2020 2020 2020 2020  F),.            
+0001e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3b0: 2073 6661 632a 2879 706c 742d 4465 6c74   sfac*(yplt-Delt
+0001e3c0: 6146 292c 0a20 2020 2020 2020 2020 2020  aF),.           
+0001e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3e0: 2020 616c 7068 613d 302e 332c 2063 6f6c    alpha=0.3, col
+0001e3f0: 6f72 3d27 6461 726b 6b68 616b 6927 2c20  or='darkkhaki', 
+0001e400: 6c61 6265 6c3d 2720 2024 5c70 6d20 3120  label='  $\pm 1 
+0001e410: 5c73 6967 6d61 2427 290a 2020 2020 2020  \sigma$').      
+0001e420: 2020 706c 742e 706c 6f74 2878 706c 742c    plt.plot(xplt,
+0001e430: 2073 6661 632a 2879 706c 742b 4465 6c74   sfac*(yplt+Delt
+0001e440: 6146 292c 206c 696e 6577 6964 7468 3d31  aF), linewidth=1
+0001e450: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0001e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e470: 616c 7068 613d 302e 342c 2063 6f6c 6f72  alpha=0.4, color
+0001e480: 3d27 6461 726b 6772 6565 6e27 290a 2020  ='darkgreen').  
+0001e490: 2020 2020 2020 706c 742e 706c 6f74 2878        plt.plot(x
+0001e4a0: 706c 742c 2073 6661 632a 2879 706c 742d  plt, sfac*(yplt-
+0001e4b0: 4465 6c74 6146 292c 206c 696e 6577 6964  DeltaF), linewid
+0001e4c0: 7468 3d31 2c0a 2020 2020 2020 2020 2020  th=1,.          
+0001e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4e0: 2020 2061 6c70 6861 3d30 2e34 2c20 636f     alpha=0.4, co
+0001e4f0: 6c6f 723d 2764 6172 6b67 7265 656e 2729  lor='darkgreen')
+0001e500: 0a20 2020 2020 2065 6c73 653a 0a20 2020  .      else:.   
+0001e510: 2020 2020 2044 656c 7461 203d 2073 656c       Delta = sel
+0001e520: 662e 6765 7446 756e 6374 696f 6e45 7272  f.getFunctionErr
+0001e530: 6f72 2878 7661 6c73 2c20 6366 2e6d 6f64  or(xvals, cf.mod
+0001e540: 656c 2c20 7076 616c 732c 2070 636f 762c  el, pvals, pcov,
+0001e550: 2066 6978 6564 5061 7273 290a 2020 2020   fixedPars).    
+0001e560: 2020 2020 706c 742e 6572 726f 7262 6172      plt.errorbar
+0001e570: 2878 706c 742c 2079 706c 742b 4465 6c74  (xplt, yplt+Delt
+0001e580: 612c 2066 6d74 3d27 2027 2c20 7865 7272  a, fmt=' ', xerr
+0001e590: 3d30 2e34 2c0a 2020 2020 2020 2020 2020  =0.4,.          
+0001e5a0: 2020 2020 2020 2020 2020 2061 6c70 6861             alpha
+0001e5b0: 3d30 2e37 2c20 656c 696e 6577 6964 7468  =0.7, elinewidth
+0001e5c0: 3d31 2e30 2c20 636f 6c6f 723d 2764 6172  =1.0, color='dar
+0001e5d0: 6b67 7265 656e 2729 0a20 2020 2020 2020  kgreen').       
+0001e5e0: 2070 6c74 2e65 7272 6f72 6261 7228 7870   plt.errorbar(xp
+0001e5f0: 6c74 2c20 7970 6c74 2d44 656c 7461 2c20  lt, yplt-Delta, 
+0001e600: 666d 743d 2720 272c 2078 6572 723d 302e  fmt=' ', xerr=0.
+0001e610: 342c 0a20 2020 2020 2020 2020 2020 2020  4,.             
+0001e620: 2020 2020 2020 2020 616c 7068 613d 302e          alpha=0.
+0001e630: 372c 2065 6c69 6e65 7769 6474 683d 312e  7, elinewidth=1.
+0001e640: 2c20 636f 6c6f 723d 2764 6172 6b67 7265  , color='darkgre
+0001e650: 656e 2729 0a20 2020 2020 2020 2066 6f72  en').        for
+0001e660: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
+0001e670: 7870 6c74 2929 3a0a 2020 2020 2020 2020  xplt)):.        
+0001e680: 2020 206c 626c 203d 2027 245c 706d 2031     lbl = '$\pm 1
+0001e690: 205c 7369 676d 6124 2720 6966 2069 3d3d   \sigma$' if i==
+0001e6a0: 3020 656c 7365 2027 270a 2020 2020 2020  0 else ''.      
+0001e6b0: 2020 2020 2070 6c74 2e61 7868 7370 616e       plt.axhspan
+0001e6c0: 2879 706c 745b 695d 2d44 656c 7461 5b69  (yplt[i]-Delta[i
+0001e6d0: 5d2c 2079 706c 745b 695d 2b44 656c 7461  ], yplt[i]+Delta
+0001e6e0: 5b69 5d2c 0a20 2020 2020 2020 2020 2020  [i],.           
+0001e6f0: 2020 2020 2020 2020 2020 2020 786d 696e              xmin
+0001e700: 3d28 7870 6c74 5b69 5d2d 302e 3429 2f6c  =(xplt[i]-0.4)/l
+0001e710: 656e 2878 706c 7429 2c0a 2020 2020 2020  en(xplt),.      
+0001e720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e730: 2078 6d61 783d 2878 706c 745b 695d 2b30   xmax=(xplt[i]+0
+0001e740: 2e34 292f 6c65 6e28 7870 6c74 292c 0a20  .4)/len(xplt),. 
+0001e750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e760: 2020 2020 2020 616c 7068 613d 302e 332c        alpha=0.3,
+0001e770: 2063 6f6c 6f72 3d27 6461 726b 6b68 616b   color='darkkhak
+0001e780: 6927 2c20 6c61 6265 6c3d 6c62 6c29 200a  i', label=lbl) .
+0001e790: 2020 2020 2020 200a 2020 2320 6469 7370         .  # disp
+0001e7a0: 6c61 7920 6c65 6765 6e64 2077 6974 6820  lay legend with 
+0001e7b0: 6669 7420 696e 666f 200a 2020 2020 676c  fit info .    gl
+0001e7c0: 6f62 616c 2066 6974 5f69 6e66 6f0a 2020  obal fit_info.  
+0001e7d0: 2020 6966 2073 616d 655f 706c 6f74 3a0a    if same_plot:.
+0001e7e0: 2020 2020 2020 7472 793a 2066 6974 5f69        try: fit_i
+0001e7f0: 6e66 6f0a 2020 2020 2020 6578 6365 7074  nfo.      except
+0001e800: 204e 616d 6545 7272 6f72 3a20 6669 745f   NameError: fit_
+0001e810: 696e 666f 203d 205b 5d0a 2020 2020 656c  info = [].    el
+0001e820: 7365 3a0a 2020 2020 2020 6669 745f 696e  se:.      fit_in
+0001e830: 666f 203d 205b 5d20 2020 2020 200a 0a20  fo = []      .. 
+0001e840: 2020 2023 2020 312e 2070 6172 616d 6574     #  1. paramet
+0001e850: 6572 2076 616c 7565 7320 616e 6420 756e  er values and un
+0001e860: 6365 7274 6169 6e74 6965 730a 2020 2020  certainties.    
+0001e870: 7065 203d 2032 2020 2023 206e 756d 6265  pe = 2   # numbe
+0001e880: 7220 6f66 2073 6967 6e69 6669 6361 6e74  r of significant
+0001e890: 2064 6967 6974 7320 6f66 2075 6e63 6572   digits of uncer
+0001e8a0: 7461 696e 7479 0a20 2020 2069 6620 7365  tainty.    if se
+0001e8b0: 6c66 2e6d 696e 6f73 5265 7375 6c74 2069  lf.minosResult i
+0001e8c0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2073  s not None and s
+0001e8d0: 656c 662e 6d69 6e6f 735f 6f6b 3a0a 2020  elf.minos_ok:.  
+0001e8e0: 2020 2020 666f 7220 706e 2c20 762c 2065      for pn, v, e
+0001e8f0: 2069 6e20 7a69 7028 6672 6565 5f70 6e61   in zip(free_pna
+0001e900: 6d73 2c20 6672 6565 5f70 7661 6c73 2c20  ms, free_pvals, 
+0001e910: 706d 6572 7273 293a 0a20 2020 2020 2020  pmerrs):.       
+0001e920: 206e 642c 205f 762c 205f 6520 3d20 726f   nd, _v, _e = ro
+0001e930: 756e 645f 746f 5f65 7272 6f72 2876 2c6d  und_to_error(v,m
+0001e940: 696e 2861 6273 2865 5b30 5d29 2c61 6273  in(abs(e[0]),abs
+0001e950: 2865 5b31 5d29 292c 6e73 645f 653d 7065  (e[1])),nsd_e=pe
+0001e960: 290a 2020 2020 2020 2020 7478 743d 227b  ).        txt="{
+0001e970: 7d20 3d20 247b 3a23 2e7b 7076 7d67 7d5e  } = ${:#.{pv}g}^
+0001e980: 7b7b 2b7b 3a23 2e7b 7065 7d67 7d7d 7d5f  {{+{:#.{pe}g}}}_
+0001e990: 7b7b 7b3a 232e 7b70 657d 677d 7d7d 2422  {{{:#.{pe}g}}}$"
+0001e9a0: 0a20 2020 2020 2020 2066 6974 5f69 6e66  .        fit_inf
+0001e9b0: 6f2e 6170 7065 6e64 2874 7874 2e66 6f72  o.append(txt.for
+0001e9c0: 6d61 7428 706e 2c20 5f76 2c20 655b 315d  mat(pn, _v, e[1]
+0001e9d0: 2c20 655b 305d 2c20 7076 3d6e 642c 2070  , e[0], pv=nd, p
+0001e9e0: 653d 7065 2929 0a20 2020 2065 6c73 653a  e=pe)).    else:
+0001e9f0: 0a20 2020 2020 2066 6f72 2070 6e2c 2076  .      for pn, v
+0001ea00: 2c20 6520 696e 207a 6970 2866 7265 655f  , e in zip(free_
+0001ea10: 706e 616d 732c 2066 7265 655f 7076 616c  pnams, free_pval
+0001ea20: 732c 2070 6d65 7272 7329 3a0a 2020 2020  s, pmerrs):.    
+0001ea30: 2020 2020 6e64 2c20 5f76 2c20 5f65 203d      nd, _v, _e =
+0001ea40: 2072 6f75 6e64 5f74 6f5f 6572 726f 7228   round_to_error(
+0001ea50: 762c 2065 5b31 5d2c 206e 7364 5f65 3d70  v, e[1], nsd_e=p
+0001ea60: 6529 0a20 2020 2020 2020 2074 7874 3d22  e).        txt="
+0001ea70: 7b7d 203d 2024 7b3a 232e 7b70 767d 677d  {} = ${:#.{pv}g}
+0001ea80: 5c70 6d7b 3a23 2e7b 7065 7d67 7d24 220a  \pm{:#.{pe}g}$".
+0001ea90: 2020 2020 2020 2020 6669 745f 696e 666f          fit_info
+0001eaa0: 2e61 7070 656e 6428 7478 742e 666f 726d  .append(txt.form
+0001eab0: 6174 2870 6e2c 205f 762c 205f 652c 2070  at(pn, _v, _e, p
+0001eac0: 763d 6e64 2c20 7065 3d70 6529 290a 2020  v=nd, pe=pe)).  
+0001ead0: 2020 6966 206e 6669 7865 643a 0a20 2020    if nfixed:.   
+0001eae0: 2020 2066 6f72 2070 6e2c 2076 2069 6e20     for pn, v in 
+0001eaf0: 7a69 7028 6669 7865 645f 706e 616d 732c  zip(fixed_pnams,
+0001eb00: 2066 6978 6564 5f70 7661 6c73 293a 0a20   fixed_pvals):. 
+0001eb10: 2020 2020 2020 2074 7874 3d22 7b7d 203d         txt="{} =
+0001eb20: 207b 3a67 7d20 2028 6669 7865 6429 220a   {:g}  (fixed)".
+0001eb30: 2020 2020 2020 2020 6669 745f 696e 666f          fit_info
+0001eb40: 2e61 7070 656e 6428 7478 742e 666f 726d  .append(txt.form
+0001eb50: 6174 2870 6e2c 2076 2929 0a20 2020 2020  at(pn, v)).     
+0001eb60: 2020 200a 2020 2020 2320 2032 2e20 676f     .    #  2. go
+0001eb70: 6f64 6e65 7373 2d6f 662d 6669 740a 2020  odness-of-fit.  
+0001eb80: 2020 6966 2073 656c 662e 6669 745f 7479    if self.fit_ty
+0001eb90: 7065 2069 6e20 5b27 7879 272c 2027 696e  pe in ['xy', 'in
+0001eba0: 6465 7865 6427 5d3a 0a20 2020 2020 2066  dexed']:.      f
+0001ebb0: 6974 5f69 6e66 6f2e 6170 7065 6e64 280a  it_info.append(.
+0001ebc0: 2020 2020 2020 2020 2224 5c5c 6368 695e          "$\\chi^
+0001ebd0: 3224 2f24 6e5f 5c5c 6d61 7468 726d 7b7b  2$/$n_\\mathrm{{
+0001ebe0: 646f 667d 7d24 3d7b 3a2e 3166 7d2f 7b7d  dof}}$={:.1f}/{}
+0001ebf0: 222e 666f 726d 6174 2867 6f66 2c6e 646f  ".format(gof,ndo
+0001ec00: 6629 202b 205c 0a20 2020 2020 2020 2020  f) + \.         
+0001ec10: 222c 2070 3d7b 3a2e 3166 7d25 222e 666f  ", p={:.1f}%".fo
+0001ec20: 726d 6174 2831 3030 2a63 6869 3270 7262  rmat(100*chi2prb
+0001ec30: 2920 290a 2020 2020 656c 6966 2073 656c  ) ).    elif sel
+0001ec40: 662e 6669 745f 7479 7065 3d3d 2768 6973  f.fit_type=='his
+0001ec50: 7427 3a0a 2020 2020 2020 6669 745f 696e  t':.      fit_in
+0001ec60: 666f 2e61 7070 656e 6428 0a20 2020 2020  fo.append(.     
+0001ec70: 2020 2022 672e 6f2e 662e 2f24 6e5f 5c5c     "g.o.f./$n_\\
+0001ec80: 6d61 7468 726d 7b7b 646f 667d 7d24 203d  mathrm{{dof}}$ =
+0001ec90: 207b 3a2e 3166 7d2f 7b7d 222e 666f 726d   {:.1f}/{}".form
+0001eca0: 6174 2867 6f66 2c20 6e64 6f66 2920 290a  at(gof, ndof) ).
+0001ecb0: 2020 2020 2320 2061 6464 206c 6567 656e      #  add legen
+0001ecc0: 6420 746f 2070 6c6f 7420 200a 2020 2020  d to plot  .    
+0001ecd0: 706c 742e 6c65 6765 6e64 286c 6f63 3d27  plt.legend(loc='
+0001ece0: 6265 7374 272c 2074 6974 6c65 3d22 5c6e  best', title="\n
+0001ecf0: 222e 6a6f 696e 2866 6974 5f69 6e66 6f29  ".join(fit_info)
+0001ed00: 2920 2020 2020 200a 0a20 2020 2072 6574  )      ..    ret
+0001ed10: 7572 6e20 6669 675f 6d6f 6465 6c0a 2020  urn fig_model.  
+0001ed20: 0a23 2070 6c6f 7420 6172 7261 7920 6f66  .# plot array of
+0001ed30: 2070 726f 6669 6c65 7320 616e 6420 636f   profiles and co
+0001ed40: 6e74 6f75 7273 0a20 2064 6566 2070 6c6f  ntours.  def plo
+0001ed50: 7443 6f6e 746f 7572 7328 7365 6c66 2c20  tContours(self, 
+0001ed60: 6669 676e 616d 653d 2750 726f 6669 6c65  figname='Profile
+0001ed70: 7320 616e 6420 436f 6e74 6f75 7273 2729  s and Contours')
+0001ed80: 3a0a 2020 2020 2222 220a 2020 2020 506c  :.    """.    Pl
+0001ed90: 6f74 2067 7269 6420 6f66 2070 726f 6669  ot grid of profi
+0001eda0: 6c65 2063 7572 7665 7320 616e 6420 6f6e  le curves and on
+0001edb0: 652d 2061 6e64 2074 776f 2d73 6967 6d61  e- and two-sigma
+0001edc0: 0a20 2020 2063 6f6e 746f 7572 206c 696e  .    contour lin
+0001edd0: 6573 2066 726f 6d20 696d 696e 7569 7420  es from iminuit 
+0001ede0: 6f62 6a65 6374 0a0a 2020 2020 4172 673a  object..    Arg:
+0001edf0: 200a 2020 2020 2020 2a20 696d 696e 7569   .      * iminui
+0001ee00: 744f 626a 6563 740a 0a20 2020 2052 6574  tObject..    Ret
+0001ee10: 7572 6e73 3a0a 2020 2020 2020 2a20 6d61  urns:.      * ma
+0001ee20: 7470 6c6f 746c 6962 2066 6967 7572 6520  tplotlib figure 
+0001ee30: 0a20 2020 2022 2222 0a0a 2020 2020 6966  .    """..    if
+0001ee40: 206e 6f74 2073 656c 662e 7175 6965 743a   not self.quiet:
+0001ee50: 0a20 2020 2020 2070 7269 6e74 2820 272a  .      print( '*
+0001ee60: 3d3d 2a20 6d6e 4669 743a 2073 6361 6e6e  ==* mnFit: scann
+0001ee70: 696e 6720 636f 6e74 6f75 7273 2729 0a0a  ing contours')..
+0001ee80: 2020 2020 2320 7361 7665 2063 6f6c 6f72      # save color
+0001ee90: 206d 6170 2061 6e64 2073 6574 206e 6577   map and set new
+0001eea0: 206f 6e65 202d 2061 6666 6563 7473 2069   one - affects i
+0001eeb0: 6d69 6e75 6974 2e64 7261 775f 6d6e 636f  minuit.draw_mnco
+0001eec0: 6e74 6f75 7228 290a 2020 2020 6f72 6967  ntour().    orig
+0001eed0: 5f63 6d20 3d20 706c 742e 6765 745f 636d  _cm = plt.get_cm
+0001eee0: 6170 2829 0a20 2020 2070 6c74 2e73 6574  ap().    plt.set
+0001eef0: 5f63 6d61 7028 2774 6162 3230 6227 290a  _cmap('tab20b').
+0001ef00: 0a20 2020 206d 203d 2073 656c 662e 6d69  .    m = self.mi
+0001ef10: 6e75 6974 0a20 2020 2066 706e 616d 7320  nuit.    fpnams 
+0001ef20: 3d20 7365 6c66 2e66 7265 6550 6172 4e61  = self.freeParNa
+0001ef30: 6d73 0a20 2020 2066 7076 616c 7320 3d20  ms.    fpvals = 
+0001ef40: 7365 6c66 2e66 7265 6550 6172 5661 6c73  self.freeParVals
+0001ef50: 0a20 2020 2066 7065 7272 7320 3d20 7365  .    fperrs = se
+0001ef60: 6c66 2e66 7265 6550 6172 4572 7273 0a20  lf.freeParErrs. 
+0001ef70: 2020 206e 7061 7220 3d20 6c65 6e28 6670     npar = len(fp
+0001ef80: 6e61 6d73 290a 0a20 2020 2066 7369 7a65  nams)..    fsize
+0001ef90: 203d 2033 2e35 2069 6620 6e70 6172 3c3d   = 3.5 if npar<=
+0001efa0: 3320 656c 7365 2032 2e35 0a20 2020 2063  3 else 2.5.    c
+0001efb0: 6f72 5f66 6967 2c20 6178 6172 7220 3d20  or_fig, axarr = 
+0001efc0: 706c 742e 7375 6270 6c6f 7473 286e 7061  plt.subplots(npa
+0001efd0: 722c 206e 7061 722c 0a20 2020 2020 2020  r, npar,.       
+0001efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eff0: 2020 2020 2020 2020 2020 206e 756d 3d66             num=f
+0001f000: 6967 6e61 6d65 2c0a 2020 2020 2020 2020  igname,.        
+0001f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f020: 2020 2020 2020 2020 2020 6669 6773 697a            figsiz
+0001f030: 653d 2866 7369 7a65 2a6e 7061 722c 2066  e=(fsize*npar, f
+0001f040: 7369 7a65 2a6e 7061 7229 2c0a 2020 2020  size*npar),.    
+0001f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f060: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001f070: 6e73 7472 6169 6e65 645f 6c61 796f 7574  nstrained_layout
+0001f080: 3d54 7275 6529 0a20 2020 200a 2320 7072  =True).    .# pr
+0001f090: 6f74 6563 7420 7468 6520 666f 6c6c 6f77  otect the follow
+0001f0a0: 696e 672c 206d 6179 2066 6169 6c0a 2020  ing, may fail.  
+0001f0b0: 2020 7472 793a 0a20 2020 2020 2069 7020    try:.      ip 
+0001f0c0: 3d20 2d31 0a20 2020 2020 2066 6f72 2069  = -1.      for i
+0001f0d0: 2069 6e20 7261 6e67 6528 302c 206e 7061   in range(0, npa
+0001f0e0: 7229 3a0a 2020 2020 2020 2020 6970 202b  r):.        ip +
+0001f0f0: 3d20 310a 2020 2020 2020 2020 6a70 203d  = 1.        jp =
+0001f100: 202d 310a 2020 2020 2020 2020 666f 7220   -1.        for 
+0001f110: 6a20 696e 2072 616e 6765 2830 2c20 6e70  j in range(0, np
+0001f120: 6172 293a 0a20 2020 2020 2020 2020 206a  ar):.          j
+0001f130: 7020 2b3d 2031 0a20 2020 2020 2020 2020  p += 1.         
+0001f140: 2069 6620 6970 203e 206a 703a 0a20 2020   if ip > jp:.   
+0001f150: 2020 2020 2020 2020 2320 656d 7074 7920          # empty 
+0001f160: 7370 6163 650a 2020 2020 2020 2020 2020  space.          
+0001f170: 2020 6178 6172 725b 6a70 2c20 6970 5d2e    axarr[jp, ip].
+0001f180: 6178 6973 2827 6f66 6627 290a 2020 2020  axis('off').    
+0001f190: 2020 2020 2020 656c 6966 2069 7020 3d3d        elif ip ==
+0001f1a0: 206a 703a 0a20 2020 2020 2020 2020 2020   jp:.           
+0001f1b0: 2320 706c 6f74 2070 726f 6669 6c65 0a20  # plot profile. 
+0001f1c0: 2020 2020 2020 2020 2020 2070 6c74 2e73             plt.s
+0001f1d0: 6361 2861 7861 7272 5b69 702c 2069 705d  ca(axarr[ip, ip]
+0001f1e0: 2920 6966 206e 7061 7221 3d31 2065 6c73  ) if npar!=1 els
+0001f1f0: 6520 706c 742e 7363 6128 6178 6172 7229  e plt.sca(axarr)
+0001f200: 0a20 2020 2020 2020 2020 2020 206d 2e64  .            m.d
+0001f210: 7261 775f 6d6e 7072 6f66 696c 6528 6670  raw_mnprofile(fp
+0001f220: 6e61 6d73 5b69 5d2c 2073 7562 7472 6163  nams[i], subtrac
+0001f230: 745f 6d69 6e3d 5472 7565 290a 2020 2020  t_min=True).    
+0001f240: 2020 2020 2020 2020 6966 2028 7365 6c66          if (self
+0001f250: 2e45 7272 4465 6620 3d3d 2031 293a 0a20  .ErrDef == 1):. 
+0001f260: 2020 2020 2020 2020 2020 2020 2079 6c61               yla
+0001f270: 6265 6c3d 2724 5c44 656c 7461 2028 2d32  bel='$\Delta (-2
+0001f280: 5c6c 6e5c 6361 6c7b 4c7d 2924 270a 2020  \ln\cal{L})$'.  
+0001f290: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001f2a0: 2020 2020 2020 2020 2020 2020 2020 796c                yl
+0001f2b0: 6162 656c 3d27 245c 4465 6c74 6120 282d  abel='$\Delta (-
+0001f2c0: 5c6c 6e5c 6361 6c7b 4c7d 2924 270a 2020  \ln\cal{L})$'.  
+0001f2d0: 2020 2020 2020 2020 2020 706c 742e 796c            plt.yl
+0001f2e0: 6162 656c 2879 6c61 6265 6c29 0a20 2020  abel(ylabel).   
+0001f2f0: 2020 2020 2020 2020 2078 6d6e 2c20 786d           xmn, xm
+0001f300: 7820 3d20 706c 742e 6763 6128 292e 6765  x = plt.gca().ge
+0001f310: 745f 786c 696d 2829 0a20 2020 2020 2020  t_xlim().       
+0001f320: 2020 2020 2023 2073 686f 7720 686f 7269       # show hori
+0001f330: 7a6f 6e74 616c 206c 696e 6520 6174 2073  zontal line at s
+0001f340: 656c 662e 4572 7244 6566 200a 2020 2020  elf.ErrDef .    
+0001f350: 2020 2020 2020 2020 706c 742e 686c 696e          plt.hlin
+0001f360: 6573 2873 656c 662e 4572 7244 6566 2c20  es(self.ErrDef, 
+0001f370: 786d 6e2c 2078 6d78 2c20 636f 6c6f 723d  xmn, xmx, color=
+0001f380: 276f 7261 6e67 6527 2c20 6c69 6e65 7374  'orange', linest
+0001f390: 796c 653d 272d 2d27 290a 2020 2020 2020  yle='--').      
+0001f3a0: 2020 2020 2020 706c 742e 6572 726f 7262        plt.errorb
+0001f3b0: 6172 2866 7076 616c 735b 695d 2c20 302e  ar(fpvals[i], 0.
+0001f3c0: 2c20 7865 7272 3d66 7065 7272 735b 695d  , xerr=fperrs[i]
+0001f3d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001f3e0: 2020 2020 2020 2020 2020 2066 6d74 3d27             fmt='
+0001f3f0: 7827 2c20 636f 6c6f 723d 2762 6c75 6527  x', color='blue'
+0001f400: 2c20 6c69 6e65 7374 796c 653d 272d 272c  , linestyle='-',
+0001f410: 2063 6170 7369 7a65 3d33 290a 2020 2020   capsize=3).    
+0001f420: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001f430: 2020 2020 2020 2020 706c 742e 7363 6128          plt.sca(
+0001f440: 6178 6172 725b 6a70 2c20 6970 5d29 0a20  axarr[jp, ip]). 
+0001f450: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0001f460: 6c66 2e69 6d69 6e75 6974 5f76 6572 7369  lf.iminuit_versi
+0001f470: 6f6e 203c 2732 273a 0a20 2020 2020 2020  on <'2':.       
+0001f480: 2020 2020 2020 206d 2e64 7261 775f 6d6e         m.draw_mn
+0001f490: 636f 6e74 6f75 7228 6670 6e61 6d73 5b69  contour(fpnams[i
+0001f4a0: 5d2c 2066 706e 616d 735b 6a5d 290a 2020  ], fpnams[j]).  
+0001f4b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0001f4c0: 2020 2020 2020 2020 2020 2020 2020 6d2e                m.
+0001f4d0: 6472 6177 5f6d 6e63 6f6e 746f 7572 2866  draw_mncontour(f
+0001f4e0: 706e 616d 735b 695d 2c20 6670 6e61 6d73  pnams[i], fpnams
+0001f4f0: 5b6a 5d2c 0a20 2020 2020 2020 2020 2020  [j],.           
+0001f500: 2020 2020 2063 6c3d 2873 656c 662e 4368       cl=(self.Ch
+0001f510: 6932 3243 4c28 312e 292c 2073 656c 662e  i22CL(1.), self.
+0001f520: 4368 6932 3243 4c28 342e 2929 2029 0a20  Chi22CL(4.)) ). 
+0001f530: 2020 2020 2020 2020 2020 2023 2070 6c6f             # plo
+0001f540: 7420 6265 7374 2d66 6974 2076 616c 7565  t best-fit value
+0001f550: 7320 616e 6420 6d69 6772 6164 2065 7272  s and migrad err
+0001f560: 6f72 730a 2020 2020 2020 2020 2020 2020  ors.            
+0001f570: 706c 742e 6572 726f 7262 6172 2866 7076  plt.errorbar(fpv
+0001f580: 616c 735b 695d 2c20 6670 7661 6c73 5b6a  als[i], fpvals[j
+0001f590: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+0001f5a0: 2020 2020 2020 2020 2020 2020 7865 7272              xerr
+0001f5b0: 3d66 7065 7272 735b 695d 2c20 7965 7272  =fperrs[i], yerr
+0001f5c0: 3d66 7065 7272 735b 6a5d 2c0a 2020 2020  =fperrs[j],.    
+0001f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f5e0: 2020 2020 2066 6d74 3d27 7827 2c20 636f       fmt='x', co
+0001f5f0: 6c6f 723d 2764 6172 6b62 6c75 6527 2c0a  lor='darkblue',.
+0001f600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f610: 2020 2020 2020 2020 2065 636f 6c6f 723d           ecolor=
+0001f620: 2762 6c75 6527 2c20 6361 7073 697a 653d  'blue', capsize=
+0001f630: 332c 200a 2020 2020 2020 2020 2020 2020  3, .            
+0001f640: 2020 2020 2020 2020 2020 2020 2061 6c70               alp
+0001f650: 6861 3d30 2e36 3629 0a20 2020 2020 2023  ha=0.66).      #
+0001f660: 2072 6573 746f 7265 2063 6f6c 6f72 206d   restore color m
+0001f670: 6170 0a20 2020 2020 2070 6c74 2e73 6574  ap.      plt.set
+0001f680: 5f63 6d61 7028 6f72 6967 5f63 6d29 2020  _cmap(orig_cm)  
+0001f690: 2020 2020 2020 0a0a 2020 2020 2020 7265        ..      re
+0001f6a0: 7475 726e 2063 6f72 5f66 6967 0a0a 2020  turn cor_fig..  
+0001f6b0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+0001f6c0: 6f6e 2061 7320 653a 0a20 2020 2020 2070  on as e:.      p
+0001f6d0: 7269 6e74 2827 2a3d 3d2a 2021 2121 2070  rint('*==* !!! p
+0001f6e0: 726f 6669 6c65 2061 6e64 2063 6f6e 746f  rofile and conto
+0001f6f0: 7572 2073 6361 6e20 6661 696c 6564 2729  ur scan failed')
+0001f700: 0a20 2020 2020 2070 7269 6e74 2865 290a  .      print(e).
+0001f710: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0001f720: 650a 0a20 2064 6566 2067 6574 5072 6f66  e..  def getProf
+0001f730: 696c 6528 7365 6c66 2c20 706e 616d 2c20  ile(self, pnam, 
+0001f740: 7261 6e67 653d 332e 2c20 6e70 6f69 6e74  range=3., npoint
+0001f750: 733d 3330 293a 0a20 2020 2022 2222 7265  s=30):.    """re
+0001f760: 7475 726e 2070 726f 6669 6c65 206c 696b  turn profile lik
+0001f770: 656c 6968 6f6f 6420 6f66 2070 6172 616d  elihood of param
+0001f780: 6574 6572 2070 6e61 6d0a 0a20 2020 2041  eter pnam..    A
+0001f790: 7267 733a 0a20 2020 2020 202d 2070 6172  rgs:.      - par
+0001f7a0: 616d 6574 6572 206e 616d 650a 2020 2020  ameter name.    
+0001f7b0: 2020 2d20 7363 616e 2072 616e 6765 2069    - scan range i
+0001f7c0: 6e20 7369 676d 612c 2061 7265 2074 7570  n sigma, are tup
+0001f7d0: 6c65 2077 6974 6820 6c6f 7765 7220 616e  le with lower an
+0001f7e0: 6420 7570 7065 7220 7661 6c75 650a 2020  d upper value.  
+0001f7f0: 2020 2020 2d20 6e75 6d62 6572 206f 6620      - number of 
+0001f800: 706f 696e 7473 200a 2020 2020 2222 220a  points .    """.
+0001f810: 2020 2020 6966 2073 656c 662e 696d 696e      if self.imin
+0001f820: 7569 745f 7665 7273 696f 6e20 3c27 3227  uit_version <'2'
+0001f830: 3a0a 2020 2020 2020 7072 696e 7428 2221  :.      print("!
+0001f840: 2121 2067 6574 5072 6f66 696c 6520 6e6f  !! getProfile no
+0001f850: 7420 696d 706c 656d 656e 7465 6420 766f  t implemented vo
+0001f860: 7220 696d 696e 7569 7420 7665 7273 2e3c  r iminuit vers.<
+0001f870: 3222 290a 2020 2020 2020 7265 7475 726e  2").      return
+0001f880: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+0001f890: 2072 6574 7572 6e20 7365 6c66 2e6d 696e   return self.min
+0001f8a0: 7569 742e 6d6e 7072 6f66 696c 6528 706e  uit.mnprofile(pn
+0001f8b0: 616d 2c20 626f 756e 6420 3d20 7261 6e67  am, bound = rang
+0001f8c0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001f8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f8e0: 2020 2020 7369 7a65 3d6e 706f 696e 7473      size=npoints
+0001f8f0: 2c20 7375 6274 7261 6374 5f6d 696e 3d54  , subtract_min=T
+0001f900: 7275 6529 0a0a 2020 6465 6620 6765 7443  rue)..  def getC
+0001f910: 6f6e 746f 7572 2873 656c 662c 2070 6e61  ontour(self, pna
+0001f920: 6d31 2c20 706e 616d 322c 2063 6c3d 4e6f  m1, pnam2, cl=No
+0001f930: 6e65 2c20 6e70 6f69 6e74 733d 3130 3029  ne, npoints=100)
+0001f940: 3a0a 2020 2020 2222 2272 6574 7572 6e20  :.    """return 
+0001f950: 7072 6f66 696c 6520 6c69 6b65 6c69 686f  profile likeliho
+0001f960: 6f64 2063 6f6e 746f 7572 206f 6620 7061  od contour of pa
+0001f970: 7261 6d65 7465 7273 2070 6e61 6d31 2061  rameters pnam1 a
+0001f980: 6e64 2070 6e61 6d32 0a0a 2020 2020 4172  nd pnam2..    Ar
+0001f990: 6773 3a0a 2020 2020 2020 2d20 3173 7420  gs:.      - 1st 
+0001f9a0: 7061 7261 6d65 7465 7220 6e61 6d65 200a  parameter name .
+0001f9b0: 2020 2020 2020 2d20 326e 6420 7061 7261        - 2nd para
+0001f9c0: 6d65 7465 7220 6e61 6d65 200a 2020 2020  meter name .    
+0001f9d0: 2020 2d20 636f 6e66 6964 656e 6365 206c    - confidence l
+0001f9e0: 6576 656c 0a20 2020 2020 202d 206e 756d  evel.      - num
+0001f9f0: 6265 7220 6f66 2070 6f69 6e74 730a 2020  ber of points.  
+0001fa00: 0a20 2020 2052 6574 7572 6e73 3a20 0a20  .    Returns: . 
+0001fa10: 2020 2020 202d 2061 7272 6179 206f 6620       - array of 
+0001fa20: 666c 6f61 7420 286e 706f 696e 7473 202a  float (npoints *
+0001fa30: 2032 2920 636f 6e74 6f75 7220 706f 696e   2) contour poin
+0001fa40: 7473 200a 2020 2020 2222 220a 0a20 2020  ts .    """..   
+0001fa50: 2069 6620 7365 6c66 2e69 6d69 6e75 6974   if self.iminuit
+0001fa60: 5f76 6572 7369 6f6e 203c 2732 273a 0a20  _version <'2':. 
+0001fa70: 2020 2020 2070 7269 6e74 2822 2121 2120       print("!!! 
+0001fa80: 6765 7443 6f6e 746f 7572 206e 6f74 2069  getContour not i
+0001fa90: 6d70 6c65 6d65 6e74 6564 2076 6f72 2069  mplemented vor i
+0001faa0: 6d69 6e75 6974 2076 6572 732e 3c32 2229  minuit vers.<2")
+0001fab0: 0a20 2020 2020 2072 6574 7572 6e0a 2020  .      return.  
+0001fac0: 2020 7265 7475 726e 2073 656c 662e 6d69    return self.mi
+0001fad0: 6e75 6974 2e6d 6e63 6f6e 746f 7572 2870  nuit.mncontour(p
+0001fae0: 6e61 6d31 2c20 706e 616d 322c 2063 6c3d  nam1, pnam2, cl=
+0001faf0: 636c 2c20 7369 7a65 3d6e 706f 696e 7473  cl, size=npoints
+0001fb00: 290a 0a0a 2020 6465 6620 706c 6f74 5f50  )...  def plot_P
+0001fb10: 726f 6669 6c65 2873 656c 662c 2070 6e61  rofile(self, pna
+0001fb20: 6d2c 2072 616e 6765 3d32 2e2c 206e 706f  m, range=2., npo
+0001fb30: 696e 7473 3d33 3029 3a0a 2020 2020 2222  ints=30):.    ""
+0001fb40: 2270 6c6f 7420 7072 6f66 696c 6520 6c69  "plot profile li
+0001fb50: 6b65 6c69 686f 6f64 206f 6620 7061 7261  kelihood of para
+0001fb60: 6d65 7465 7220 706e 616d 0a0a 2020 2020  meter pnam..    
+0001fb70: 4172 6773 3a0a 2020 2020 2020 2d20 7061  Args:.      - pa
+0001fb80: 7261 6d65 7465 7220 6e61 6d65 0a20 2020  rameter name.   
+0001fb90: 2020 202d 2073 6361 6e20 7261 6e67 6520     - scan range 
+0001fba0: 696e 2073 6967 6d61 2c20 6172 6520 7475  in sigma, are tu
+0001fbb0: 706c 6520 7769 7468 206c 6f77 6572 2061  ple with lower a
+0001fbc0: 6e64 2075 7070 6572 2076 616c 7565 0a20  nd upper value. 
+0001fbd0: 2020 2020 202d 206e 756d 6265 7220 6f66       - number of
+0001fbe0: 2070 6f69 6e74 730a 0a20 2020 2052 6574   points..    Ret
+0001fbf0: 7572 6e73 3a20 0a20 2020 2020 202d 206d  urns: .      - m
+0001fc00: 6174 706c 6f74 6c69 6220 6669 6775 7265  atplotlib figure
+0001fc10: 200a 2020 2020 2222 220a 0a20 2020 2066   .    """..    f
+0001fc20: 6967 203d 2070 6c74 2e66 6967 7572 6528  ig = plt.figure(
+0001fc30: 6e75 6d3d 274c 696b 656c 6968 6f6f 6420  num='Likelihood 
+0001fc40: 7072 6f66 696c 6520 2720 2b20 706e 616d  profile ' + pnam
+0001fc50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001fc60: 2020 2020 2020 2066 6967 7369 7a65 3d28         figsize=(
+0001fc70: 352e 2c20 352e 2929 0a20 2020 2073 656c  5., 5.)).    sel
+0001fc80: 662e 6d69 6e75 6974 2e64 7261 775f 6d6e  f.minuit.draw_mn
+0001fc90: 7072 6f66 696c 6528 706e 616d 2c20 626f  profile(pnam, bo
+0001fca0: 756e 643d 7261 6e67 652c 2073 697a 653d  und=range, size=
+0001fcb0: 6e70 6f69 6e74 732c 2073 7562 7472 6163  npoints, subtrac
+0001fcc0: 745f 6d69 6e3d 5472 7565 290a 2020 2020  t_min=True).    
+0001fcd0: 0a20 2020 2069 6620 2873 656c 662e 4572  .    if (self.Er
+0001fce0: 7244 6566 203d 3d20 3129 3a0a 2020 2020  rDef == 1):.    
+0001fcf0: 2020 796c 6162 656c 3d27 245c 4465 6c74    ylabel='$\Delt
+0001fd00: 6120 282d 325c 6c6e 5c63 616c 7b4c 7d29  a (-2\ln\cal{L})
+0001fd10: 2427 0a20 2020 2065 6c73 653a 0a20 2020  $'.    else:.   
+0001fd20: 2020 2079 6c61 6265 6c3d 2724 5c44 656c     ylabel='$\Del
+0001fd30: 7461 2028 2d5c 6c6e 5c63 616c 7b4c 7d29  ta (-\ln\cal{L})
+0001fd40: 2427 0a20 2020 2070 6c74 2e79 6c61 6265  $'.    plt.ylabe
+0001fd50: 6c28 796c 6162 656c 290a 2020 2020 7265  l(ylabel).    re
+0001fd60: 7475 726e 2066 6967 0a0a 0a20 2064 6566  turn fig...  def
+0001fd70: 2070 6c6f 745f 636c 436f 6e74 6f75 7228   plot_clContour(
+0001fd80: 7365 6c66 2c20 706e 616d 312c 2070 6e61  self, pnam1, pna
+0001fd90: 6d32 2c20 636c 293a 0a20 2020 2022 2222  m2, cl):.    """
+0001fda0: 706c 6f74 2061 2063 6f6e 746f 7572 206f  plot a contour o
+0001fdb0: 6620 7061 7261 6d65 7465 7273 2070 6e61  f parameters pna
+0001fdc0: 6d31 2061 6e64 2070 6e61 6d32 0a20 2020  m1 and pnam2.   
+0001fdd0: 2077 6974 6820 636f 6e66 6964 656e 6365   with confidence
+0001fde0: 206c 6576 656c 2873 2920 636c 0a20 2020   level(s) cl.   
+0001fdf0: 2022 2222 0a20 2020 2069 6620 7365 6c66   """.    if self
+0001fe00: 2e69 6d69 6e75 6974 5f76 6572 7369 6f6e  .iminuit_version
+0001fe10: 203c 2732 273a 0a20 2020 2020 2070 7269   <'2':.      pri
+0001fe20: 6e74 2822 2121 2120 706c 6f74 5f63 6c43  nt("!!! plot_clC
+0001fe30: 6f6e 746f 7572 206e 6f74 2069 6d70 6c65  ontour not imple
+0001fe40: 6d65 6e74 6564 2076 6f72 2069 6d69 6e75  mented vor iminu
+0001fe50: 6974 2076 6572 732e 3c32 2229 0a20 2020  it vers.<2").   
+0001fe60: 2020 2072 6574 7572 6e0a 2020 2020 656c     return.    el
+0001fe70: 7365 3a0a 2020 2020 2020 6669 6720 3d20  se:.      fig = 
+0001fe80: 706c 742e 6669 6775 7265 286e 756d 3d27  plt.figure(num='
+0001fe90: 436f 6e74 6f75 7228 7329 2027 202b 2070  Contour(s) ' + p
+0001fea0: 6e61 6d31 202b 2027 2076 732e 2027 202b  nam1 + ' vs. ' +
+0001feb0: 2070 6e61 6d32 2c0a 2020 2020 2020 2020   pnam2,.        
+0001fec0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001fed0: 6967 7369 7a65 3d28 352e 2c20 352e 2929  igsize=(5., 5.))
+0001fee0: 0a20 2020 2020 2073 656c 662e 6d69 6e75  .      self.minu
+0001fef0: 6974 2e64 7261 775f 6d6e 636f 6e74 6f75  it.draw_mncontou
+0001ff00: 7228 706e 616d 312c 2070 6e61 6d32 2c20  r(pnam1, pnam2, 
+0001ff10: 636c 3d63 6c29 2020 2020 0a20 2020 2020  cl=cl)    .     
+0001ff20: 2072 6574 7572 6e20 6669 670a 0a0a 2020   return fig...  
+0001ff30: 6465 6620 706c 6f74 5f6e 7369 6743 6f6e  def plot_nsigCon
+0001ff40: 746f 7572 2873 656c 662c 2070 6e61 6d31  tour(self, pnam1
+0001ff50: 2c20 706e 616d 322c 206e 7369 6729 3a0a  , pnam2, nsig):.
+0001ff60: 2020 2020 2222 2270 6c6f 7420 6e73 6967      """plot nsig
+0001ff70: 2063 6f6e 746f 7572 7320 6f66 2070 6172   contours of par
+0001ff80: 616d 6574 6572 7320 706e 616d 3120 616e  ameters pnam1 an
+0001ff90: 6420 706e 616d 320a 2020 2020 2222 220a  d pnam2.    """.
+0001ffa0: 2020 2020 6669 6720 3d20 706c 742e 6669      fig = plt.fi
+0001ffb0: 6775 7265 286e 756d 3d27 436f 6e74 6f75  gure(num='Contou
+0001ffc0: 7228 7329 2027 202b 2070 6e61 6d31 202b  r(s) ' + pnam1 +
+0001ffd0: 2027 2076 732e 2027 202b 2070 6e61 6d32   ' vs. ' + pnam2
+0001ffe0: 2c0a 2020 2020 2020 6669 6773 697a 653d  ,.      figsize=
+0001fff0: 2835 2e2c 2035 2e29 290a 2020 2020 6966  (5., 5.)).    if
+00020000: 2073 656c 662e 696d 696e 7569 745f 7665   self.iminuit_ve
+00020010: 7273 696f 6e20 3c27 3227 3a0a 2020 2020  rsion <'2':.    
+00020020: 2020 7365 6c66 2e6d 696e 7569 742e 6472    self.minuit.dr
+00020030: 6177 5f6d 6e63 6f6e 746f 7572 2870 6e61  aw_mncontour(pna
+00020040: 6d31 2c20 706e 616d 322c 206e 7369 676d  m1, pnam2, nsigm
+00020050: 613d 6e73 6967 290a 2020 2020 656c 7365  a=nsig).    else
+00020060: 3a0a 2020 2020 2020 6e73 203d 2072 616e  :.      ns = ran
+00020070: 6765 2831 2c20 6e73 6967 2b31 290a 2020  ge(1, nsig+1).  
+00020080: 2020 2020 6463 6869 3220 3d20 6e70 2e61      dchi2 = np.a
+00020090: 7272 6179 286e 7329 2a2a 320a 2020 2020  rray(ns)**2.    
+000200a0: 2020 636c 203d 2073 656c 662e 4368 6932    cl = self.Chi2
+000200b0: 3243 4c28 6463 6869 3229 2020 2020 0a20  2CL(dchi2)    . 
+000200c0: 2020 2020 2073 656c 662e 6d69 6e75 6974       self.minuit
+000200d0: 2e64 7261 775f 6d6e 636f 6e74 6f75 7228  .draw_mncontour(
+000200e0: 706e 616d 312c 2070 6e61 6d32 2c20 636c  pnam1, pnam2, cl
+000200f0: 3d63 6c29 2020 2020 0a20 2020 2072 6574  =cl)    .    ret
+00020100: 7572 6e20 6669 670a 0a20 2040 7374 6174  urn fig..  @stat
+00020110: 6963 6d65 7468 6f64 0a20 2064 6566 2063  icmethod.  def c
+00020120: 6869 3270 7262 2863 6869 322c 6e64 6f66  hi2prb(chi2,ndof
+00020130: 293a 0a20 2020 2022 2222 4361 6c63 756c  ):.    """Calcul
+00020140: 6174 6520 6368 6932 2d70 726f 6261 6269  ate chi2-probabi
+00020150: 6c69 7479 2066 726f 6d20 6368 6932 2061  lity from chi2 a
+00020160: 6e64 2064 6567 7265 6573 206f 6620 6672  nd degrees of fr
+00020170: 6565 646f 6d0a 2020 2020 2222 220a 2020  eedom.    """.  
+00020180: 2020 7265 7475 726e 2031 2e2d 2073 7461    return 1.- sta
+00020190: 7473 2e63 6869 322e 6364 6628 6368 6932  ts.chi2.cdf(chi2
+000201a0: 2c20 6e64 6f66 290a 2020 0a20 2040 7374  , ndof).  .  @st
+000201b0: 6174 6963 6d65 7468 6f64 0a20 2064 6566  aticmethod.  def
+000201c0: 2043 4c32 4368 6932 2843 4c29 3a0a 2020   CL2Chi2(CL):.  
+000201d0: 2020 2222 2263 616c 6375 6c61 7465 2044    """calculate D
+000201e0: 656c 7461 4368 6932 2066 726f 6d20 636f  eltaChi2 from co
+000201f0: 6e66 6964 656e 6365 206c 6576 656c 2043  nfidence level C
+00020200: 4c20 666f 7220 322d 6469 6d20 636f 6e74  L for 2-dim cont
+00020210: 6f75 7273 0a20 2020 2022 2222 0a20 2020  ours.    """.   
+00020220: 2072 6574 7572 6e20 2d32 2e2a 6e70 2e6c   return -2.*np.l
+00020230: 6f67 2831 2e2d 434c 290a 0a20 2040 7374  og(1.-CL)..  @st
+00020240: 6174 6963 6d65 7468 6f64 0a20 2064 6566  aticmethod.  def
+00020250: 2043 6869 3232 434c 2864 6332 293a 0a20   Chi22CL(dc2):. 
+00020260: 2020 2022 2222 6361 6c63 756c 6174 6520     """calculate 
+00020270: 636f 6e66 6964 656e 6365 206c 6576 656c  confidence level
+00020280: 2043 4c20 6672 6f6d 2044 656c 7461 4368   CL from DeltaCh
+00020290: 6932 2066 6f72 2032 2d64 696d 2063 6f6e  i2 for 2-dim con
+000202a0: 746f 7572 730a 2020 2020 2222 220a 2020  tours.    """.  
+000202b0: 2020 7265 7475 726e 2028 312e 202d 206e    return (1. - n
+000202c0: 702e 6578 7028 2d64 6332 202f 2032 2e29  p.exp(-dc2 / 2.)
+000202d0: 290a 0a69 6620 5f5f 6e61 6d65 5f5f 203d  )..if __name__ =
+000202e0: 3d20 225f 5f6d 6169 6e5f 5f22 3a20 2320  = "__main__": # 
+000202f0: 2d2d 2d20 696e 7465 7266 6163 6520 616e  --- interface an
+00020300: 6420 6578 616d 706c 650a 2020 0a20 2064  d example.  .  d
+00020310: 6566 2065 7861 6d70 6c65 5f78 7946 6974  ef example_xyFit
+00020320: 2829 3a0a 2020 230a 2020 2320 2a2a 2a20  ():.  #.  # *** 
+00020330: 4578 616d 706c 6520 6f66 2061 6e20 6170  Example of an ap
+00020340: 706c 6963 6174 696f 6e20 6f66 2070 6879  plication of phy
+00020350: 4669 742e 7879 4669 7428 290a 2020 230a  Fit.xyFit().  #.
+00020360: 2020 2320 6465 6669 6e65 2074 6865 206d    # define the m
+00020370: 6f64 656c 2066 756e 6374 696f 6e20 746f  odel function to
+00020380: 2066 6974 0a20 2020 2064 6566 2065 7870   fit.    def exp
+00020390: 5f6d 6f64 656c 2878 2c20 413d 312e 2c20  _model(x, A=1., 
+000203a0: 7830 3d31 2e29 3a0a 2020 2020 2020 7265  x0=1.):.      re
+000203b0: 7475 726e 2041 2a6e 702e 6578 7028 2d78  turn A*np.exp(-x
+000203c0: 2f78 3029 0a0a 2020 2020 2320 616e 6f74  /x0)..    # anot
+000203d0: 6865 7220 6d6f 6465 6c20 6675 6e63 7469  her model functi
+000203e0: 6f6e 0a20 2020 2064 6566 2070 6f6c 7932  on.    def poly2
+000203f0: 5f6d 6f64 656c 2878 2c20 613d 302e 312c  _model(x, a=0.1,
+00020400: 2062 3d31 2e2c 2063 3d31 2e29 3a0a 2020   b=1., c=1.):.  
+00020410: 2020 2020 7265 7475 726e 2061 2a78 2a2a      return a*x**
+00020420: 3220 2b20 622a 7820 2b20 630a 0a20 2020  2 + b*x + c..   
+00020430: 2023 2073 6574 206d 6f64 656c 2074 6f20   # set model to 
+00020440: 7573 6520 696e 2066 6974 0a20 2020 2066  use in fit.    f
+00020450: 6974 6d6f 6465 6c3d 6578 705f 6d6f 6465  itmodel=exp_mode
+00020460: 6c20 2023 2061 6c73 6f20 7472 7920 706f  l  # also try po
+00020470: 6c79 325f 6d6f 6465 6c20 210a 2020 0a20  ly2_model !.  . 
+00020480: 2020 2023 2074 6865 2064 6174 6120 2e2e     # the data ..
+00020490: 2e0a 2020 2020 6461 7461 5f78 203d 205b  ..    data_x = [
+000204a0: 302e 302c 2030 2e32 2c20 302e 342c 2030  0.0, 0.2, 0.4, 0
+000204b0: 2e36 2c20 302e 382c 2031 2e2c 2031 2e32  .6, 0.8, 1., 1.2
+000204c0: 2c0a 2020 2020 2020 2020 2020 312e 342c  ,.          1.4,
+000204d0: 2031 2e36 2c20 312e 382c 2032 2e30 2c20   1.6, 1.8, 2.0, 
+000204e0: 322e 322c 2032 2e34 2c20 322e 365d 0a20  2.2, 2.4, 2.6]. 
+000204f0: 2020 2064 6174 615f 7920 3d20 5b31 2e31     data_y = [1.1
+00020500: 3439 2c20 302e 3731 322c 2030 2e38 3033  49, 0.712, 0.803
+00020510: 2c20 302e 3436 342c 2030 2e33 3938 2c20  , 0.464, 0.398, 
+00020520: 302e 3335 342c 2030 2e31 3438 2c0a 2020  0.354, 0.148,.  
+00020530: 2020 2020 2020 2020 2020 302e 3332 382c            0.328,
+00020540: 2030 2e31 3831 2c20 302e 3134 302c 2030   0.181, 0.140, 0
+00020550: 2e30 3635 2c20 302e 3030 352c 2d30 2e30  .065, 0.005,-0.0
+00020560: 3035 2c20 302e 3131 365d 0a20 2020 2023  05, 0.116].    #
+00020570: 202e 2e2e 2061 6e64 2075 6e63 6572 7461   ... and uncerta
+00020580: 6974 6965 7320 200a 2020 2020 7361 6273  ities  .    sabs
+00020590: 7920 3d20 302e 3037 2023 2069 6e64 6570  y = 0.07 # indep
+000205a0: 656e 6465 6e74 2079 0a20 2020 2073 7265  endent y.    sre
+000205b0: 6c79 203d 2030 2e30 3520 2320 3525 206f  ly = 0.05 # 5% o
+000205c0: 6620 6d6f 6465 6c20 7661 6c75 650a 2020  f model value.  
+000205d0: 2020 6361 6273 7920 3d20 302e 3034 2023    cabsy = 0.04 #
+000205e0: 2063 6f72 7265 6c61 7465 640a 2020 2020   correlated.    
+000205f0: 6372 656c 7920 3d20 302e 3033 2023 2033  crely = 0.03 # 3
+00020600: 2520 6f66 206d 6f64 656c 2076 616c 7565  % of model value
+00020610: 2063 6f72 7265 6c61 7465 640a 2020 2020   correlated.    
+00020620: 7361 6273 7820 3d20 302e 3035 2023 2069  sabsx = 0.05 # i
+00020630: 6e64 6570 656e 6465 6e74 2078 0a20 2020  ndependent x.   
+00020640: 2073 7265 6c78 203d 2030 2e30 3420 2320   srelx = 0.04 # 
+00020650: 3425 206f 6620 780a 2020 2020 6361 6273  4% of x.    cabs
+00020660: 7820 3d20 302e 3033 2023 2063 6f72 7265  x = 0.03 # corre
+00020670: 6c61 7465 6420 780a 2020 2020 6372 656c  lated x.    crel
+00020680: 7820 3d20 302e 3032 2023 2032 2520 6f66  x = 0.02 # 2% of
+00020690: 2078 2063 6f72 7265 6c61 7465 640a 0a20   x correlated.. 
+000206a0: 2020 2023 2070 6572 666f 726d 2066 6974     # perform fit
+000206b0: 2074 6f20 6461 7461 2077 6974 6820 6675   to data with fu
+000206c0: 6e63 7469 6f6e 2078 7946 6974 2075 7369  nction xyFit usi
+000206d0: 6e67 2063 6c61 7373 206d 6e46 6974 0a20  ng class mnFit. 
+000206e0: 2020 2072 6573 756c 7444 6963 7420 3d20     resultDict = 
+000206f0: 7879 4669 7428 6669 746d 6f64 656c 2c20  xyFit(fitmodel, 
+00020700: 6461 7461 5f78 2c20 6461 7461 5f79 2c0a  data_x, data_y,.
+00020710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020720: 2020 2020 2020 2073 783d 7361 6273 782c         sx=sabsx,
+00020730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020740: 2020 2020 2020 2020 7379 3d73 6162 7379          sy=sabsy
+00020750: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00020760: 2020 2020 2020 2020 2073 7265 6c78 3d73           srelx=s
+00020770: 7265 6c78 2c0a 2020 2020 2020 2020 2020  relx,.          
+00020780: 2020 2020 2020 2020 2020 2020 2073 7265               sre
+00020790: 6c79 3d73 7265 6c79 2c0a 2020 2020 2020  ly=srely,.      
+000207a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000207b0: 2078 6162 7363 6f72 3d63 6162 7378 2c0a   xabscor=cabsx,.
+000207c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000207d0: 2020 2020 2020 2078 7265 6c63 6f72 3d63         xrelcor=c
+000207e0: 7265 6c78 2c0a 2020 2020 2020 2020 2020  relx,.          
+000207f0: 2020 2020 2020 2020 2020 2020 2079 6162               yab
+00020800: 7363 6f72 3d63 6162 7379 2c0a 2020 2020  scor=cabsy,.    
+00020810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020820: 2020 2079 7265 6c63 6f72 3d63 7265 6c79     yrelcor=crely
+00020830: 2c0a 2020 2020 2320 2020 2020 2020 2020  ,.    #         
+00020840: 2020 2020 2020 2020 2070 303d 2831 2e2c           p0=(1.,
+00020850: 2030 2e35 292c 2020 2020 200a 2020 2020   0.5),     .    
+00020860: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00020870: 2020 2063 6f6e 7374 7261 696e 7473 3d5b     constraints=[
+00020880: 2741 272c 2031 2e2c 2030 2e30 335d 2c0a  'A', 1., 0.03],.
+00020890: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+000208a0: 2020 2020 2020 2063 6f6e 7374 7261 696e         constrain
+000208b0: 7473 3d5b 302c 2031 2e2c 2030 2e30 335d  ts=[0, 1., 0.03]
+000208c0: 2028 616c 7465 726e 6174 6976 6529 0a20   (alternative). 
+000208d0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+000208e0: 2020 2020 2020 6c69 6d69 7473 3d28 2741        limits=('A
+000208f0: 272c 2030 2e2c 204e 6f6e 6529 2c20 2023  ', 0., None),  #
+00020900: 2070 6172 616d 6574 6572 206c 696d 6974   parameter limit
+00020910: 730a 2020 2020 2320 2020 2020 2020 2020  s.    #         
+00020920: 2020 2020 2020 2020 2066 6978 5061 7273           fixPars
+00020930: 203d 205b 2741 275d 2c20 2020 2020 2020   = ['A'],       
+00020940: 2020 2320 6669 7820 7061 7261 6d65 7465    # fix paramete
+00020950: 7228 7329 200a 2020 2020 2020 2020 2020  r(s) .          
+00020960: 2020 2020 2020 2020 2020 2020 2075 7365               use
+00020970: 5f6e 6567 4c6f 674c 3d54 7275 652c 0a20  _negLogL=True,. 
+00020980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020990: 2020 2020 2020 706c 6f74 3d54 7275 652c        plot=True,
+000209a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000209b0: 2020 2020 2020 2020 706c 6f74 5f62 616e          plot_ban
+000209c0: 643d 5472 7565 2c0a 2020 2020 2020 2020  d=True,.        
+000209d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000209e0: 6c6f 745f 636f 723d 4661 6c73 652c 0a20  lot_cor=False,. 
+000209f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a00: 2020 2020 2020 7368 6f77 706c 6f74 733d        showplots=
+00020a10: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+00020a20: 2020 2020 2020 2020 2020 2020 2020 7175                qu
+00020a30: 6965 743d 4661 6c73 652c 0a20 2020 2020  iet=False,.     
+00020a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a50: 2020 6178 6973 5f6c 6162 656c 733d 5b27    axis_labels=['
+00020a60: 7827 2c20 2779 2020 205c 2020 6628 782c  x', 'y   \  f(x,
+00020a70: 202a 7061 7229 275d 2c20 0a20 2020 2020   *par)'], .     
+00020a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a90: 2020 6461 7461 5f6c 6567 656e 6420 3d20    data_legend = 
+00020aa0: 2772 616e 646f 6d20 6461 7461 272c 2020  'random data',  
+00020ab0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
+00020ac0: 2020 2020 2020 2020 2020 6d6f 6465 6c5f            model_
+00020ad0: 6c65 6765 6e64 203d 2027 6d6f 6465 6c27  legend = 'model'
+00020ae0: 290a 2020 2020 706c 742e 7375 7074 6974  ).    plt.suptit
+00020af0: 6c65 2822 6d6e 4669 7420 6578 616d 706c  le("mnFit exampl
+00020b00: 653a 2066 6974 2074 6f20 782d 7920 6461  e: fit to x-y da
+00020b10: 7461 222c 0a20 2020 2020 2020 2020 2020  ta",.           
+00020b20: 2020 2020 7369 7a65 3d27 7878 2d6c 6172      size='xx-lar
+00020b30: 6765 272c 2063 6f6c 6f72 3d27 6461 726b  ge', color='dark
+00020b40: 626c 7565 2729 0a20 2020 200a 2020 2320  blue').    .  # 
+00020b50: 5072 696e 7420 7265 7375 6c74 7320 0a20  Print results . 
+00020b60: 2020 2070 7661 6c73 2c20 7065 7272 732c     pvals, perrs,
+00020b70: 2063 6f72 2c20 6368 6932 2c20 706e 616d   cor, chi2, pnam
+00020b80: 7320 3d20 7265 7375 6c74 4469 6374 2e76  s = resultDict.v
+00020b90: 616c 7565 7328 290a 2020 2020 7072 696e  alues().    prin
+00020ba0: 7428 275c 6e2a 3d3d 2a20 7879 4669 7420  t('\n*==* xyFit 
+00020bb0: 5265 7375 6c74 3a27 290a 2020 2020 7072  Result:').    pr
+00020bc0: 696e 7428 2220 7061 7261 6d65 7465 7220  int(" parameter 
+00020bd0: 6e61 6d65 733a 2020 2020 2020 2022 2c20  names:       ", 
+00020be0: 706e 616d 7329 0a20 2020 2070 7269 6e74  pnams).    print
+00020bf0: 2822 2063 6869 323a 207b 3a2e 3367 7d22  (" chi2: {:.3g}"
+00020c00: 2e66 6f72 6d61 7428 6368 6932 2929 0a20  .format(chi2)). 
+00020c10: 2020 2070 7269 6e74 2822 2070 6172 616d     print(" param
+00020c20: 6574 6572 2076 616c 7565 733a 2020 2020  eter values:    
+00020c30: 2020 222c 2070 7661 6c73 290a 2020 2020    ", pvals).    
+00020c40: 7072 696e 7428 2220 6e65 672e 2070 6172  print(" neg. par
+00020c50: 616d 6574 6572 2065 7272 6f72 733a 2022  ameter errors: "
+00020c60: 2c20 7065 7272 735b 3a2c 305d 290a 2020  , perrs[:,0]).  
+00020c70: 2020 7072 696e 7428 2220 706f 732e 2070    print(" pos. p
+00020c80: 6172 616d 6574 6572 2065 7272 6f72 733a  arameter errors:
+00020c90: 2022 2c20 7065 7272 735b 3a2c 315d 290a   ", perrs[:,1]).
+00020ca0: 2020 2020 7072 696e 7428 2220 636f 7272      print(" corr
+00020cb0: 656c 6174 696f 6e73 203a 205c 6e22 2c20  elations : \n", 
+00020cc0: 636f 7229 0a0a 0a20 2064 6566 2065 7861  cor)...  def exa
+00020cd0: 6d70 6c65 5f69 6e64 6578 6564 4669 7428  mple_indexedFit(
+00020ce0: 293a 0a20 2023 0a20 2023 202a 2a2a 2045  ):.  #.  # *** E
+00020cf0: 7861 6d70 6c65 206f 6620 616e 2061 7070  xample of an app
+00020d00: 6c69 6361 7469 6f6e 206f 6620 7068 7946  lication of phyF
+00020d10: 6974 2e78 4669 7428 2920 746f 2066 6974  it.xFit() to fit
+00020d20: 2069 6e64 6578 6564 2064 6174 610a 2020   indexed data.  
+00020d30: 230a 2020 2320 2020 2020 436f 6f72 6469  #.  #     Coordi
+00020d40: 6e61 7465 7320 696e 2072 2d70 6869 2061  nates in r-phi a
+00020d50: 7265 2061 7665 7261 6765 6420 616e 6420  re averaged and 
+00020d60: 7472 616e 7366 6f72 6d65 6420 746f 2063  transformed to c
+00020d70: 6172 7465 7369 616e 200a 2020 2020 0a20  artesian .    . 
+00020d80: 2020 2064 6566 2063 6172 7465 7369 616e     def cartesian
+00020d90: 5f74 6f5f 706f 6c61 7228 6461 7461 2c20  _to_polar(data, 
+00020da0: 783d 312e 2c20 793d 312e 293a 0a20 2020  x=1., y=1.):.   
+00020db0: 2020 2023 2064 6574 6572 6d69 6e65 2070     # determine p
+00020dc0: 6f6c 6172 2063 6f6f 7264 696e 6174 7320  olar coordinats 
+00020dd0: 6672 6f6d 2063 6172 7465 7369 616e 2028  from cartesian (
+00020de0: 782c 7929 0a20 2020 2020 206e 6d20 3d20  x,y).      nm = 
+00020df0: 6c65 6e28 6461 7461 292f 2f32 2023 2065  len(data)//2 # e
+00020e00: 7870 6563 7420 7477 6f20 6172 7261 7973  xpect two arrays
+00020e10: 2077 6974 6820 6d65 6173 7572 656d 656e   with measuremen
+00020e20: 7473 0a20 2020 2020 2072 203d 206e 702e  ts.      r = np.
+00020e30: 7371 7274 2878 2a78 202b 2079 2a79 2920  sqrt(x*x + y*y) 
+00020e40: 2a20 6e70 2e6f 6e65 7328 6e6d 290a 2020  * np.ones(nm).  
+00020e50: 2020 2020 7068 6920 3d20 6e70 2e61 7263      phi = np.arc
+00020e60: 7461 6e32 2879 2c20 7829 202a 206e 702e  tan2(y, x) * np.
+00020e70: 6f6e 6573 286e 6d29 0a20 2020 2020 2072  ones(nm).      r
+00020e80: 6574 7572 6e20 6e70 2e63 6f6e 6361 7465  eturn np.concate
+00020e90: 6e61 7465 2820 2872 2c20 7068 6929 2029  nate( (r, phi) )
+00020ea0: 0a0a 2020 2020 2320 6578 616d 706c 653a  ..    # example:
+00020eb0: 2028 722c 2070 6869 2920 6f66 2074 776f   (r, phi) of two
+00020ec0: 2073 7061 6365 2070 6f69 6e74 7320 696e   space points in
+00020ed0: 2070 6f6c 6172 2063 6f6f 7264 696e 6174   polar coordinat
+00020ee0: 6573 0a20 2020 2070 6172 7320 3d20 6e70  es.    pars = np
+00020ef0: 2e61 7272 6179 285b 302e 392c 2030 2e38  .array([0.9, 0.8
+00020f00: 372c 2030 2e37 3535 2c20 302e 3739 305d  7, 0.755, 0.790]
+00020f10: 290a 2020 2020 7075 6e63 7320 3d20 6e70  ).    puncs = np
+00020f20: 2e61 7272 6179 285b 302e 3032 372c 2030  .array([0.027, 0
+00020f30: 2e30 3233 2c20 302e 3136 2c20 302e 3133  .023, 0.16, 0.13
+00020f40: 5d29 0a0a 2020 2020 2320 7065 7266 6f72  ])..    # perfor
+00020f50: 6d20 6669 7420 746f 2064 6174 6120 7769  m fit to data wi
+00020f60: 7468 2066 756e 6374 696f 6e20 7846 6974  th function xFit
+00020f70: 2075 7369 6e67 2063 6c61 7373 206d 6e46   using class mnF
+00020f80: 6974 0a20 2020 2072 6573 756c 7444 6963  it.    resultDic
+00020f90: 7420 3d20 7846 6974 2863 6172 7465 7369  t = xFit(cartesi
+00020fa0: 616e 5f74 6f5f 706f 6c61 722c 2070 6172  an_to_polar, par
+00020fb0: 732c 2073 203d 2070 756e 6373 2c0a 2020  s, s = puncs,.  
+00020fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fd0: 2020 2020 2073 7265 6c3d 4e6f 6e65 2c20       srel=None, 
+00020fe0: 7361 6273 636f 723d 4e6f 6e65 2c20 7372  sabscor=None, sr
+00020ff0: 656c 636f 723d 4e6f 6e65 2c0a 2020 2020  elcor=None,.    
+00021000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021010: 2020 206e 616d 6573 3d5b 2772 272c 2027     names=['r', '
+00021020: 7227 2c20 7227 245c 7661 7270 6869 2427  r', r'$\varphi$'
+00021030: 2c20 7227 245c 7661 7270 6869 2427 5d2c  , r'$\varphi$'],
+00021040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021050: 2020 2020 2020 2023 2070 303d 2831 2e2c         # p0=(1.,
+00021060: 2031 2e29 2c20 2020 2020 0a20 2020 2020   1.),     .     
+00021070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021080: 2020 7573 655f 6e65 674c 6f67 4c3d 5472    use_negLogL=Tr
+00021090: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+000210a0: 2020 2020 2020 2020 2020 2070 6c6f 743d             plot=
+000210b0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+000210c0: 2020 2020 2020 2020 2020 2020 2070 6c6f               plo
+000210d0: 745f 6261 6e64 3d54 7275 652c 0a20 2020  t_band=True,.   
+000210e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000210f0: 2020 2020 706c 6f74 5f63 6f72 3d54 7275      plot_cor=Tru
+00021100: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00021110: 2020 2020 2020 2020 2020 7368 6f77 706c            showpl
+00021120: 6f74 733d 4661 6c73 652c 0a20 2020 2020  ots=False,.     
+00021130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021140: 2020 7175 6965 743d 4661 6c73 652c 0a20    quiet=False,. 
+00021150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021160: 2020 2020 2020 6178 6973 5f6c 6162 656c        axis_label
+00021170: 733d 5b27 496e 6465 7827 2c20 2778 2020  s=['Index', 'x  
+00021180: 205c 2020 7828 2a70 6172 2927 5d2c 200a   \  x(*par)'], .
+00021190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000211a0: 2020 2020 2020 2064 6174 615f 6c65 6765         data_lege
+000211b0: 6e64 203d 2027 506f 6c61 7220 4461 7461  nd = 'Polar Data
+000211c0: 272c 2020 2020 0a20 2020 2020 2020 2020  ',    .         
+000211d0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+000211e0: 6465 6c5f 6c65 6765 6e64 203d 2027 722d  del_legend = 'r-
+000211f0: 7068 6920 6672 6f6d 2078 2d79 2729 0a20  phi from x-y'). 
+00021200: 2020 2070 6c74 2e73 7570 7469 746c 6528     plt.suptitle(
+00021210: 226d 6e46 6974 2065 7861 6d70 6c65 3a20  "mnFit example: 
+00021220: 6669 7420 746f 2069 6e64 6578 6564 2064  fit to indexed d
+00021230: 6174 6122 2c0a 2020 2020 2020 2020 2020  ata",.          
+00021240: 2020 2020 2073 697a 653d 2778 782d 6c61       size='xx-la
+00021250: 7267 6527 2c20 636f 6c6f 723d 2764 6172  rge', color='dar
+00021260: 6b62 6c75 6527 290a 2020 2020 0a20 2023  kblue').    .  #
+00021270: 2050 7269 6e74 2072 6573 756c 7473 200a   Print results .
+00021280: 2020 2020 7076 616c 732c 2070 6572 7273      pvals, perrs
+00021290: 2c20 636f 722c 2063 6869 322c 2070 6e61  , cor, chi2, pna
+000212a0: 6d73 203d 2072 6573 756c 7444 6963 742e  ms = resultDict.
+000212b0: 7661 6c75 6573 2829 0a20 2020 2070 7269  values().    pri
+000212c0: 6e74 2827 5c6e 2a3d 3d2a 2078 7946 6974  nt('\n*==* xyFit
+000212d0: 2052 6573 756c 743a 2729 0a20 2020 2070   Result:').    p
+000212e0: 7269 6e74 2822 2070 6172 616d 6574 6572  rint(" parameter
+000212f0: 206e 616d 6573 3a20 2020 2020 2020 222c   names:       ",
+00021300: 2070 6e61 6d73 290a 2020 2020 7072 696e   pnams).    prin
+00021310: 7428 2220 6368 6932 3a20 7b3a 2e33 677d  t(" chi2: {:.3g}
+00021320: 222e 666f 726d 6174 2863 6869 3229 290a  ".format(chi2)).
+00021330: 2020 2020 7072 696e 7428 2220 7061 7261      print(" para
+00021340: 6d65 7465 7220 7661 6c75 6573 3a20 2020  meter values:   
+00021350: 2020 2022 2c20 7076 616c 7329 0a20 2020     ", pvals).   
+00021360: 2070 7269 6e74 2822 206e 6567 2e20 7061   print(" neg. pa
+00021370: 7261 6d65 7465 7220 6572 726f 7273 3a20  rameter errors: 
+00021380: 222c 2070 6572 7273 5b3a 2c30 5d29 0a20  ", perrs[:,0]). 
+00021390: 2020 2070 7269 6e74 2822 2070 6f73 2e20     print(" pos. 
+000213a0: 7061 7261 6d65 7465 7220 6572 726f 7273  parameter errors
+000213b0: 3a20 222c 2070 6572 7273 5b3a 2c31 5d29  : ", perrs[:,1])
+000213c0: 0a20 2020 2070 7269 6e74 2822 2063 6f72  .    print(" cor
+000213d0: 7265 6c61 7469 6f6e 7320 3a20 5c6e 222c  relations : \n",
+000213e0: 2063 6f72 290a 2020 2020 0a20 2064 6566   cor).    .  def
+000213f0: 2065 7861 6d70 6c65 5f68 6973 746f 6772   example_histogr
+00021400: 616d 4669 7428 293a 0a20 2023 0a20 2023  amFit():.  #.  #
+00021410: 202a 2a2a 2048 6973 746f 6772 616d 2046   *** Histogram F
+00021420: 6974 3a20 4578 616d 706c 6520 6f66 2061  it: Example of a
+00021430: 6e20 6170 706c 6963 6174 696f 6e20 6f66  n application of
+00021440: 2070 6879 4669 742e 6846 6974 2829 200a   phyFit.hFit() .
+00021450: 2020 230a 0a20 2023 2020 2020 2320 6465    #..  #    # de
+00021460: 6669 6e65 2074 6865 206d 6f64 656c 2066  fine the model f
+00021470: 756e 6374 696f 6e20 746f 2066 6974 0a20  unction to fit. 
+00021480: 2020 2064 6566 2053 706c 7573 425f 6d6f     def SplusB_mo
+00021490: 6465 6c28 782c 206d 7520 3d20 362e 3938  del(x, mu = 6.98
+000214a0: 372c 2073 6967 6d61 203d 2030 2e35 2c20  7, sigma = 0.5, 
+000214b0: 613d 302e 2c20 7320 3d20 302e 3229 3a0a  a=0., s = 0.2):.
+000214c0: 2020 2020 2020 2727 2770 6466 206f 6620        '''pdf of 
+000214d0: 6120 4761 7573 7369 616e 2073 6967 6e61  a Gaussian signa
+000214e0: 6c20 6f6e 2074 6f70 206f 6620 666c 6174  l on top of flat
+000214f0: 2062 6163 6b67 726f 756e 640a 2020 2020   background.    
+00021500: 2020 2727 270a 2020 2020 2020 6e6f 726d    '''.      norm
+00021510: 616c 203d 206e 702e 6578 7028 2d30 2e35  al = np.exp(-0.5
+00021520: 2a28 2878 2d6d 7529 2f73 6967 6d61 292a  *((x-mu)/sigma)*
+00021530: 2a32 292f 6e70 2e73 7172 7428 322e 2a6e  *2)/np.sqrt(2.*n
+00021540: 702e 7069 2a73 6967 6d61 2a2a 3229 0a20  p.pi*sigma**2). 
+00021550: 2020 2020 206c 696e 6561 7220 3d20 2861       linear = (a
+00021560: 2a28 786d 782b 786d 6e29 2f32 202b 2031  *(xmx+xmn)/2 + 1
+00021570: 2e29 2f28 786d 782d 786d 6e29 200a 2020  .)/(xmx-xmn) .  
+00021580: 2020 2020 7265 7475 726e 2073 202a 206e      return s * n
+00021590: 6f72 6d61 6c20 2b20 2831 2d73 2920 2a20  ormal + (1-s) * 
+000215a0: 6c69 6e65 6172 200a 0a20 2020 206e 6269  linear ..    nbi
+000215b0: 6e73 3d34 300a 2020 2020 786d 6e20 3d20  ns=40.    xmn = 
+000215c0: 310a 2020 2020 786d 7820 3d20 3130 0a20  1.    xmx = 10. 
+000215d0: 2020 2062 6564 6765 733d 6e70 2e6c 696e     bedges=np.lin
+000215e0: 7370 6163 6528 786d 6e2c 2078 6d78 2c20  space(xmn, xmx, 
+000215f0: 6e62 696e 732b 3129 0a20 2020 2062 636f  nbins+1).    bco
+00021600: 6e74 656e 7473 203d 206e 702e 6172 7261  ntents = np.arra
+00021610: 7928 5b31 2c20 312c 2031 2c20 322c 2032  y([1, 1, 1, 2, 2
+00021620: 2c20 322c 2034 2c20 312c 2030 2c20 332c  , 2, 4, 1, 0, 3,
+00021630: 2031 2c20 312c 2030 2c0a 2020 2020 2020   1, 1, 0,.      
+00021640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021650: 2020 322c 2033 2c20 332c 2031 2c20 312c    2, 3, 3, 1, 1,
+00021660: 2030 2c20 322c 2033 2c20 322c 2033 2c20   0, 2, 3, 2, 3, 
+00021670: 312c 2031 2c20 382c 0a20 2020 2020 2020  1, 1, 8,.       
+00021680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021690: 2036 2c20 372c 2039 2c20 312c 2030 2c20   6, 7, 9, 1, 0, 
+000216a0: 312c 2032 2c20 312c 2033 2c20 322c 2031  1, 2, 1, 3, 2, 1
+000216b0: 2c20 332c 2032 2c20 345d 290a 2020 2020  , 3, 2, 4]).    
+000216c0: 2320 200a 2020 2020 2320 2d2d 2d20 2070  #  .    # ---  p
+000216d0: 6572 666f 726d 2066 6974 2020 0a20 2020  erform fit  .   
+000216e0: 2023 0a20 2020 2072 6573 756c 7444 6963   #.    resultDic
+000216f0: 7420 3d20 6846 6974 2853 706c 7573 425f  t = hFit(SplusB_
+00021700: 6d6f 6465 6c2c 0a20 2020 2020 2020 2020  model,.         
+00021710: 2062 636f 6e74 656e 7473 2c20 6265 6467   bcontents, bedg
+00021720: 6573 2c20 2023 2062 696e 2065 6e74 7269  es,  # bin entri
+00021730: 6573 2061 6e64 2062 696e 2065 6467 6573  es and bin edges
+00021740: 0a20 2020 2020 2020 2020 2070 303d 4e6f  .          p0=No
+00021750: 6e65 2c20 2020 2020 2020 2020 2020 2023  ne,            #
+00021760: 2069 6e69 7469 616c 2067 7565 7373 2066   initial guess f
+00021770: 6f72 2070 6172 616d 6574 6572 2076 616c  or parameter val
+00021780: 7565 7320 0a20 2020 2020 2320 2020 2020  ues .     #     
+00021790: 636f 6e73 7472 6169 6e74 733d 5b27 7327  constraints=['s'
+000217a0: 2c20 7661 6c20 2c20 6572 7220 5d2c 2020  , val , err ],  
+000217b0: 2023 2063 6f6e 7374 7261 696e 7473 2077   # constraints w
+000217c0: 6974 6869 6e20 6572 726f 7273 0a20 2020  ithin errors.   
+000217d0: 2020 2020 2020 2066 6978 5061 7273 203d         fixPars =
+000217e0: 205b 2761 275d 2c20 2020 2020 2020 2020   ['a'],         
+000217f0: 2320 6669 7820 7061 7261 6d65 7465 7228  # fix parameter(
+00021800: 7329 200a 2020 2020 2020 2020 2020 6c69  s) .          li
+00021810: 6d69 7473 3d28 2773 272c 2030 2e2c 204e  mits=('s', 0., N
+00021820: 6f6e 6529 2c20 2023 206c 696d 6974 730a  one),  # limits.
+00021830: 2020 2020 2020 2020 2020 7573 655f 4761            use_Ga
+00021840: 7573 7341 7070 726f 783d 4661 6c73 652c  ussApprox=False,
+00021850: 2020 2023 2047 6175 7373 6961 6e20 6170     # Gaussian ap
+00021860: 7072 6f78 696d 6174 696f 6e0a 2020 2020  proximation.    
+00021870: 2020 2020 2020 6669 745f 6465 6e73 6974        fit_densit
+00021880: 7920 3d20 5472 7565 2c20 2020 2020 2023  y = True,      #
+00021890: 2066 6974 2064 656e 7369 7479 0a20 2020   fit density.   
+000218a0: 2020 2020 2020 2070 6c6f 743d 5472 7565         plot=True
+000218b0: 2c20 2020 2020 2020 2020 2020 2320 706c  ,           # pl
+000218c0: 6f74 2064 6174 6120 616e 6420 6d6f 6465  ot data and mode
+000218d0: 6c0a 2020 2020 2020 2020 2020 706c 6f74  l.          plot
+000218e0: 5f62 616e 643d 5472 7565 2c20 2020 2020  _band=True,     
+000218f0: 2023 2070 6c6f 7420 6d6f 6465 6c20 636f   # plot model co
+00021900: 6e66 6964 656e 6365 2d62 616e 640a 2020  nfidence-band.  
+00021910: 2020 2020 2020 2020 706c 6f74 5f63 6f72          plot_cor
+00021920: 3d54 7275 652c 2020 2020 2020 2320 706c  =True,      # pl
+00021930: 6f74 2070 726f 6669 6c65 7320 6c69 6b65  ot profiles like
+00021940: 6c69 686f 6f64 2061 6e64 2063 6f6e 746f  lihood and conto
+00021950: 7572 730a 2020 2020 2020 2020 2020 7368  urs.          sh
+00021960: 6f77 706c 6f74 733d 4661 6c73 652c 2020  owplots=False,  
+00021970: 2020 2023 2073 686f 7720 2f20 646f 6e27     # show / don'
+00021980: 7420 7368 6f77 2070 6c6f 7473 0a20 2020  t show plots.   
+00021990: 2020 2020 2020 2071 7569 6574 3d46 616c         quiet=Fal
+000219a0: 7365 2c20 2020 2020 2020 2020 2320 7375  se,         # su
+000219b0: 7070 7265 7373 2069 6e66 6f72 6d61 7469  ppress informati
+000219c0: 7665 2070 7269 6e74 6f75 740a 2020 2020  ve printout.    
+000219d0: 2020 2020 2020 6178 6973 5f6c 6162 656c        axis_label
+000219e0: 733d 5b27 7827 2c20 2779 2020 205c 2020  s=['x', 'y   \  
+000219f0: 6628 782c 202a 7061 7229 275d 2c20 0a20  f(x, *par)'], . 
+00021a00: 2020 2020 2020 2020 2064 6174 615f 6c65           data_le
+00021a10: 6765 6e64 203d 2027 7261 6e64 6f6d 2064  gend = 'random d
+00021a20: 6174 6127 2c20 2020 200a 2020 2020 2020  ata',    .      
+00021a30: 2020 2020 6d6f 6465 6c5f 6c65 6765 6e64      model_legend
+00021a40: 203d 2027 7369 676e 616c 202b 2062 6163   = 'signal + bac
+00021a50: 6b67 726f 756e 6420 6d6f 6465 6c27 2029  kground model' )
+00021a60: 0a0a 2020 2020 706c 742e 7375 7074 6974  ..    plt.suptit
+00021a70: 6c65 2822 6d6e 4669 7420 6578 616d 706c  le("mnFit exampl
+00021a80: 653a 2066 6974 2074 6f20 6869 7374 6f67  e: fit to histog
+00021a90: 7261 6d20 6461 7461 222c 0a20 2020 2020  ram data",.     
+00021aa0: 2020 2020 2020 2020 2073 697a 653d 2778           size='x
+00021ab0: 782d 6c61 7267 6527 2c20 636f 6c6f 723d  x-large', color=
+00021ac0: 2764 6172 6b62 6c75 6527 290a 0a20 2020  'darkblue')..   
+00021ad0: 2023 2050 7269 6e74 2072 6573 756c 7473   # Print results
+00021ae0: 200a 2020 2020 7072 696e 7428 275c 6e2a   .    print('\n*
+00021af0: 3d3d 2a20 6869 7374 6f67 7261 6d20 6669  ==* histogram fi
+00021b00: 7420 5265 7375 6c74 3a27 290a 2020 2020  t Result:').    
+00021b10: 7076 616c 732c 2070 6572 7273 2c20 636f  pvals, perrs, co
+00021b20: 722c 2067 6f66 2c20 706e 616d 7320 3d20  r, gof, pnams = 
+00021b30: 7265 7375 6c74 4469 6374 2e76 616c 7565  resultDict.value
+00021b40: 7328 290a 2020 2020 7072 696e 7428 2220  s().    print(" 
+00021b50: 7061 7261 6d65 7465 7220 6e61 6d65 733a  parameter names:
+00021b60: 2020 2020 2020 2022 2c20 706e 616d 7329         ", pnams)
+00021b70: 0a20 2020 2070 7269 6e74 2822 2067 6f6f  .    print(" goo
+00021b80: 646e 6573 732d 6f66 2d66 6974 3a20 7b3a  dness-of-fit: {:
+00021b90: 2e33 677d 222e 666f 726d 6174 2867 6f66  .3g}".format(gof
+00021ba0: 2929 0a20 2020 2070 7269 6e74 2822 2070  )).    print(" p
+00021bb0: 6172 616d 6574 6572 2076 616c 7565 733a  arameter values:
+00021bc0: 2020 2020 2020 222c 2070 7661 6c73 290a        ", pvals).
+00021bd0: 2020 2020 7072 696e 7428 2220 6e65 672e      print(" neg.
+00021be0: 2070 6172 616d 6574 6572 2065 7272 6f72   parameter error
+00021bf0: 733a 2022 2c20 7065 7272 735b 3a2c 305d  s: ", perrs[:,0]
+00021c00: 290a 2020 2020 7072 696e 7428 2220 706f  ).    print(" po
+00021c10: 732e 2070 6172 616d 6574 6572 2065 7272  s. parameter err
+00021c20: 6f72 733a 2022 2c20 7065 7272 735b 3a2c  ors: ", perrs[:,
+00021c30: 315d 290a 2020 2020 7072 696e 7428 2220  1]).    print(" 
+00021c40: 636f 7272 656c 6174 696f 6e73 203a 205c  correlations : \
+00021c50: 6e22 2c20 636f 7229 0a0a 2020 6465 6620  n", cor)..  def 
+00021c60: 6578 616d 706c 655f 7573 6572 4669 7428  example_userFit(
+00021c70: 293a 0a20 2020 2022 2222 2a2a 756e 6269  ):.    """**unbi
+00021c80: 6e6e 6564 204d 4c20 6669 742a 2a20 7769  nned ML fit** wi
+00021c90: 7468 2075 7365 722d 6465 6669 6e65 6420  th user-defined 
+00021ca0: 636f 7374 2066 756e 6374 696f 6e0a 0a20  cost function.. 
+00021cb0: 2020 2054 6869 7320 636f 6465 2069 6c6c     This code ill
+00021cc0: 7573 7472 6174 6573 2075 7361 6765 206f  ustrates usage o
+00021cd0: 6620 7468 6520 7772 6170 7065 7220 6675  f the wrapper fu
+00021ce0: 6e63 7469 6f6e 206d 4669 7428 2920 200a  nction mFit()  .
+00021cf0: 2020 2020 666f 7220 2063 6c61 7373 202a      for  class *
+00021d00: 2a6d 6e46 6974 2a2a 2075 7365 722d 6465  *mnFit** user-de
+00021d10: 6669 6e65 6420 636f 7374 2066 756e 6374  fined cost funct
+00021d20: 696f 6e0a 2020 2020 2222 2220 200a 0a20  ion.    """  .. 
+00021d30: 2020 2023 2067 656e 6572 6174 6520 4761     # generate Ga
+00021d40: 7573 7369 616e 2d64 6973 7472 6962 7574  ussian-distribut
+00021d50: 6564 2064 6174 610a 2020 2020 6d75 303d  ed data.    mu0=
+00021d60: 322e 0a20 2020 2073 6967 303d 302e 350a  2..    sig0=0.5.
+00021d70: 2020 2020 6e70 2e72 616e 646f 6d2e 7365      np.random.se
+00021d80: 6564 2833 3134 3135 3929 2020 2320 696e  ed(314159)  # in
+00021d90: 6974 6961 6c69 7a65 2072 616e 646f 6d20  itialize random 
+00021da0: 6765 6e65 7261 746f 720a 2020 2020 6461  generator.    da
+00021db0: 7461 203d 206d 7530 202b 2073 6967 3020  ta = mu0 + sig0 
+00021dc0: 2a20 6e70 2e72 616e 646f 6d2e 7261 6e64  * np.random.rand
+00021dd0: 6e28 3130 3029 0a0a 2020 2020 2320 6465  n(100)..    # de
+00021de0: 6669 6e65 2063 6f73 7420 6675 6e63 7469  fine cost functi
+00021df0: 6f6e 3a20 3220 2a20 6e65 6761 7469 7665  on: 2 * negative
+00021e00: 206c 6f67 206c 696b 656c 6968 6f6f 6420   log likelihood 
+00021e10: 6f66 2047 6175 c39f 3b0a 2020 2020 6465  of Gau..;.    de
+00021e20: 6620 6d79 436f 7374 286d 753d 312e 2c20  f myCost(mu=1., 
+00021e30: 7369 676d 613d 312e 293a 0a20 2020 2020  sigma=1.):.     
+00021e40: 2023 2073 696d 706c 6520 2d32 2a6c 6f67   # simple -2*log
+00021e50: 2d6c 696b 656c 6968 6f6f 6420 6f66 2061  -likelihood of a
+00021e60: 2031 2d64 2047 6175 7373 2064 6973 7472   1-d Gauss distr
+00021e70: 6962 7574 696f 6e0a 2020 2020 2020 723d  ibution.      r=
+00021e80: 2028 6461 7461 2d6d 7529 2f73 6967 6d61   (data-mu)/sigma
+00021e90: 0a20 2020 2020 2072 6574 7572 6e20 6e70  .      return np
+00021ea0: 2e73 756d 2820 722a 7220 2b20 322e 2a6e  .sum( r*r + 2.*n
+00021eb0: 702e 6c6f 6728 7369 676d 6129 290a 0a20  p.log(sigma)).. 
+00021ec0: 2020 2072 6573 756c 7444 6963 7420 3d20     resultDict = 
+00021ed0: 6d46 6974 286d 7943 6f73 742c 0a20 2020  mFit(myCost,.   
+00021ee0: 2020 2020 2020 2070 303d 4e6f 6e65 2c20         p0=None, 
+00021ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021f00: 2320 696e 6974 6961 6c20 6775 6573 7320  # initial guess 
+00021f10: 666f 7220 7061 7261 6d65 7465 7220 7661  for parameter va
+00021f20: 6c75 6573 200a 2020 2020 2020 2020 2020  lues .          
+00021f30: 636f 6e73 7472 6169 6e74 733d 5b5b 276d  constraints=[['m
+00021f40: 7527 2c20 322e 2c20 302e 3031 5d5d 2c20  u', 2., 0.01]], 
+00021f50: 2320 4761 7573 7369 616e 2070 6172 616d  # Gaussian param
+00021f60: 6574 6572 2063 6f6e 7374 7261 696e 7473  eter constraints
+00021f70: 0a20 2020 2020 2020 2023 2020 6c69 6d69  .        #  limi
+00021f80: 7473 3d28 2773 6967 6d61 272c 204e 6f6e  ts=('sigma', Non
+00021f90: 652c 204e 6f6e 6529 2c20 2023 6c69 6d69  e, None),  #limi
+00021fa0: 7473 0a20 2020 2020 2020 2023 2020 6669  ts.        #  fi
+00021fb0: 7850 6172 7320 3d20 5b27 6d75 275d 2c20  xPars = ['mu'], 
+00021fc0: 2020 2020 2020 2023 2066 6978 2070 6172         # fix par
+00021fd0: 616d 6574 6572 2873 2920 0a20 2020 2020  ameter(s) .     
+00021fe0: 2020 2020 206e 6567 326c 6f67 4c20 3d20       neg2logL = 
+00021ff0: 5472 7565 2c20 2020 2020 2020 2020 2320  True,         # 
+00022000: 636f 7374 2069 7320 2d32 202a 206c 6e28  cost is -2 * ln(
+00022010: 4c29 0a20 2020 2020 2020 2020 2070 6c6f  L).          plo
+00022020: 745f 636f 723d 5472 7565 2c20 2020 2020  t_cor=True,     
+00022030: 2020 2020 2020 2320 706c 6f74 2070 726f        # plot pro
+00022040: 6669 6c65 7320 6c69 6b65 6c69 686f 6f64  files likelihood
+00022050: 2061 6e64 2063 6f6e 746f 7572 730a 2020   and contours.  
+00022060: 2020 2020 2020 2020 7368 6f77 706c 6f74          showplot
+00022070: 733d 4661 6c73 652c 2020 2020 2020 2020  s=False,        
+00022080: 2023 2073 686f 7720 2f20 646f 6e27 7420   # show / don't 
+00022090: 7368 6f77 2070 6c6f 7473 0a20 2020 2020  show plots.     
+000220a0: 2020 2020 2071 7569 6574 3d46 616c 7365       quiet=False
+000220b0: 2c20 2020 2020 2020 2020 2020 2020 2023  ,              #
+000220c0: 2073 7570 7072 6573 7320 696e 666f 726d   suppress inform
+000220d0: 6174 6976 6520 7072 696e 746f 7574 0a20  ative printout. 
+000220e0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+000220f0: 706c 742e 7375 7074 6974 6c65 2822 4d61  plt.suptitle("Ma
+00022100: 7869 6d75 6d2d 6c69 6b65 6c69 686f 6f64  ximum-likelihood
+00022110: 2066 6974 3a20 7072 6f66 696c 6573 2061   fit: profiles a
+00022120: 6e64 2063 6f6e 746f 7572 7322 2c0a 2020  nd contours",.  
+00022130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022140: 2020 2073 697a 653d 2778 782d 6c61 7267     size='xx-larg
+00022150: 6527 2c20 636f 6c6f 723d 2764 6172 6b62  e', color='darkb
+00022160: 6c75 6527 290a 2020 2020 2320 5072 696e  lue').    # Prin
+00022170: 7420 7265 7375 6c74 730a 2020 2020 7076  t results.    pv
+00022180: 616c 732c 2070 6572 7273 2c20 636f 722c  als, perrs, cor,
+00022190: 2067 6f66 2c20 706e 616d 7320 3d20 7265   gof, pnams = re
+000221a0: 7375 6c74 4469 6374 2e76 616c 7565 7328  sultDict.values(
+000221b0: 290a 2020 2020 7072 696e 7428 275c 6e2a  ).    print('\n*
+000221c0: 3d3d 2a20 7573 6572 2d64 6566 696e 6564  ==* user-defined
+000221d0: 2063 6f73 743a 2046 6974 2052 6573 756c   cost: Fit Resul
+000221e0: 743a 2729 0a20 2020 2070 7269 6e74 2822  t:').    print("
+000221f0: 2070 6172 616d 6574 6572 206e 616d 6573   parameter names
+00022200: 3a20 2020 2020 2020 222c 2070 6e61 6d73  :       ", pnams
+00022210: 290a 2020 2020 7072 696e 7428 2220 7061  ).    print(" pa
+00022220: 7261 6d65 7465 7220 7661 6c75 6573 3a20  rameter values: 
+00022230: 2020 2020 2022 2c20 7076 616c 7329 0a20       ", pvals). 
+00022240: 2020 2070 7269 6e74 2822 206e 6567 2e20     print(" neg. 
+00022250: 7061 7261 6d65 7465 7220 6572 726f 7273  parameter errors
+00022260: 3a20 222c 2070 6572 7273 5b3a 2c30 5d29  : ", perrs[:,0])
+00022270: 0a20 2020 2070 7269 6e74 2822 2070 6f73  .    print(" pos
+00022280: 2e20 7061 7261 6d65 7465 7220 6572 726f  . parameter erro
+00022290: 7273 3a20 222c 2070 6572 7273 5b3a 2c31  rs: ", perrs[:,1
+000222a0: 5d29 0a20 2020 2070 7269 6e74 2822 2063  ]).    print(" c
+000222b0: 6f72 7265 6c61 7469 6f6e 7320 3a20 5c6e  orrelations : \n
+000222c0: 222c 2063 6f72 2920 200a 0a20 2064 6566  ", cor)  ..  def
+000222d0: 2065 7861 6d70 6c65 5f75 6e62 696e 6e65   example_unbinne
+000222e0: 644d 4c46 6974 2829 3a0a 2020 2020 2222  dMLFit():.    ""
+000222f0: 222a 2a75 6e62 696e 6e65 6420 4d4c 2066  "**unbinned ML f
+00022300: 6974 2a2a 206f 6620 7064 6620 746f 2075  it** of pdf to u
+00022310: 6e62 696e 6e65 6420 6461 7461 0a20 2020  nbinned data.   
+00022320: 200a 2020 2020 7265 616c 2064 6174 6120   .    real data 
+00022330: 6672 6f6d 206d 6561 7375 7265 6d65 6e74  from measurement
+00022340: 2077 6974 6820 6120 5761 7465 7220 4368   with a Water Ch
+00022350: 6572 656e 6b6f 7620 6465 7465 6374 6f72  erenkov detector
+00022360: 2028 224b 616d 696f 6b61 6e6e 6522 290a   ("Kamiokanne").
+00022370: 0a20 2020 206e 756d 6265 7273 2072 6570  .    numbers rep
+00022380: 7265 7365 6e74 2074 696d 6520 6469 6666  resent time diff
+00022390: 6572 656e 6365 7320 2869 6e20 c2b5 7329  erences (in ..s)
+000223a0: 2062 6574 7765 656e 2074 6865 2070 6173   between the pas
+000223b0: 7361 6765 206f 6620 6120 6d75 6f6e 0a20  sage of a muon. 
+000223c0: 2020 2061 6e64 2074 6865 2072 6567 6973     and the regis
+000223d0: 7472 6174 696f 6e20 6f66 2061 2073 6563  tration of a sec
+000223e0: 6f6e 6420 7075 6c73 652c 206f 6674 656e  ond pulse, often
+000223f0: 2063 6175 7365 6420 6279 2061 6e20 656c   caused by an el
+00022400: 6563 7472 6f6e 2066 726f 6d0a 2020 2020  ectron from.    
+00022410: 7468 6520 6465 6361 7920 6f66 2074 6865  the decay of the
+00022420: 2073 746f 7070 6564 206d 756f 6e2e 2041   stopped muon. A
+00022430: 7320 7375 6368 2065 7665 6e74 7320 6172  s such events ar
+00022440: 6520 7261 7265 2c20 6869 7374 6f67 7261  e rare, histogra
+00022450: 6d6d 696e 6720 7468 650a 2020 2020 6461  mming the.    da
+00022460: 7461 2070 7269 6f72 2074 6f20 6669 7474  ta prior to fitt
+00022470: 696e 6720 776f 756c 6420 696e 7472 6f64  ing would introd
+00022480: 7563 6520 7368 6966 7473 2061 6e64 2062  uce shifts and b
+00022490: 6961 7365 732c 2061 6e64 2074 6865 7265  iases, and there
+000224a0: 666f 7265 2074 6865 0a20 2020 2075 6e62  fore the.    unb
+000224b0: 696e 6e65 6420 6669 7420 6973 2074 6865  inned fit is the
+000224c0: 206f 7074 696d 616c 206d 6574 686f 6420   optimal method 
+000224d0: 666f 7220 7468 6973 2061 6e64 2073 696d  for this and sim
+000224e0: 756c 6172 2075 7365 2063 6173 6573 2e20  ular use cases. 
+000224f0: 0a20 2020 2022 2222 0a20 2020 2064 543d  .    """.    dT=
+00022500: 5b37 2e34 322c 2033 2e37 3733 2c20 352e  [7.42, 3.773, 5.
+00022510: 3936 382c 2034 2e39 3234 2c20 312e 3436  968, 4.924, 1.46
+00022520: 382c 2034 2e36 3634 2c20 312e 3734 352c  8, 4.664, 1.745,
+00022530: 2032 2e31 3434 2c20 332e 3833 362c 2033   2.144, 3.836, 3
+00022540: 2e31 3332 2c0a 2020 2020 2020 2020 312e  .132,.        1.
+00022550: 3536 382c 2032 2e33 3532 2c20 322e 3133  568, 2.352, 2.13
+00022560: 322c 2039 2e33 3831 2c20 312e 3438 342c  2, 9.381, 1.484,
+00022570: 2031 2e31 3831 2c20 352e 3030 342c 2033   1.181, 5.004, 3
+00022580: 2e30 362c 2020 342e 3538 322c 2032 2e30  .06,  4.582, 2.0
+00022590: 3736 2c0a 2020 2020 2020 2020 312e 3838  76,.        1.88
+000225a0: 2c20 2031 2e33 3337 2c20 332e 3039 322c  ,  1.337, 3.092,
+000225b0: 2032 2e32 3635 2c20 312e 3230 382c 2032   2.265, 1.208, 2
+000225c0: 2e37 3533 2c20 342e 3435 372c 2033 2e34  .753, 4.457, 3.4
+000225d0: 3939 2c20 382e 3139 322c 2035 2e31 3031  99, 8.192, 5.101
+000225e0: 2c0a 2020 2020 2020 2020 312e 3537 322c  ,.        1.572,
+000225f0: 2035 2e31 3532 2c20 342e 3138 312c 2033   5.152, 4.181, 3
+00022600: 2e35 322c 2020 312e 3334 342c 2031 302e  .52,  1.344, 10.
+00022610: 3239 2c20 312e 3135 322c 2032 2e33 3438  29, 1.152, 2.348
+00022620: 2c20 322e 3232 382c 2032 2e31 3732 2c0a  , 2.228, 2.172,.
+00022630: 2020 2020 2020 2020 372e 3434 382c 2031          7.448, 1
+00022640: 2e31 3038 2c20 342e 3334 342c 2032 2e30  .108, 4.344, 2.0
+00022650: 3432 2c20 352e 3038 382c 2031 2e30 322c  42, 5.088, 1.02,
+00022660: 2020 312e 3035 312c 2031 2e39 3837 2c20    1.051, 1.987, 
+00022670: 312e 3933 352c 2033 2e37 3733 2c0a 2020  1.935, 3.773,.  
+00022680: 2020 2020 2020 342e 3039 322c 2031 2e36        4.092, 1.6
+00022690: 3238 2c20 312e 3638 382c 2034 2e35 3032  28, 1.688, 4.502
+000226a0: 2c20 342e 3638 372c 2036 2e37 3535 2c20  , 4.687, 6.755, 
+000226b0: 322e 3536 2c20 2031 2e32 3038 2c20 322e  2.56,  1.208, 2.
+000226c0: 3634 392c 2031 2e30 3132 2c0a 2020 2020  649, 1.012,.    
+000226d0: 2020 2020 312e 3733 2c20 2032 2e31 3634      1.73,  2.164
+000226e0: 2c20 312e 3732 382c 2034 2e36 3436 2c20  , 1.728, 4.646, 
+000226f0: 322e 3931 362c 2031 2e31 3031 2c20 322e  2.916, 1.101, 2.
+00022700: 3534 2c20 2031 2e30 322c 2020 312e 3137  54,  1.02,  1.17
+00022710: 362c 2034 2e37 3136 2c0a 2020 2020 2020  6, 4.716,.      
+00022720: 2020 392e 3637 312c 2031 2e36 3932 2c20    9.671, 1.692, 
+00022730: 392e 3239 322c 2031 302e 3732 2c20 322e  9.292, 10.72, 2.
+00022740: 3136 342c 2032 2e30 3834 2c20 322e 3631  164, 2.084, 2.61
+00022750: 362c 2031 2e35 3834 2c20 352e 3233 362c  6, 1.584, 5.236,
+00022760: 2033 2e36 3633 2c0a 2020 2020 2020 2020   3.663,.        
+00022770: 332e 3632 342c 2031 2e30 3531 2c20 312e  3.624, 1.051, 1.
+00022780: 3534 342c 2031 2e34 3936 2c20 312e 3838  544, 1.496, 1.88
+00022790: 332c 2031 2e39 322c 2020 352e 3936 382c  3, 1.92,  5.968,
+000227a0: 2035 2e38 392c 2020 322e 3839 362c 2032   5.89,  2.896, 2
+000227b0: 2e37 362c 0a20 2020 2020 2020 2031 2e34  .76,.        1.4
+000227c0: 3735 2c20 322e 3634 342c 2033 2e36 2c20  75, 2.644, 3.6, 
+000227d0: 2020 352e 3332 342c 2038 2e33 3631 2c20    5.324, 8.361, 
+000227e0: 332e 3035 322c 2037 2e37 3033 2c20 332e  3.052, 7.703, 3.
+000227f0: 3833 2c20 2031 2e34 3434 2c20 312e 3334  83,  1.444, 1.34
+00022800: 332c 0a20 2020 2020 2020 2034 2e37 3336  3,.        4.736
+00022810: 2c20 382e 372c 2020 2036 2e31 3932 2c20  , 8.7,   6.192, 
+00022820: 352e 3739 362c 2031 2e34 2c20 2020 332e  5.796, 1.4,   3.
+00022830: 3339 322c 2037 2e38 3038 2c20 362e 3334  392, 7.808, 6.34
+00022840: 342c 2031 2e38 3834 2c20 322e 3333 322c  4, 1.884, 2.332,
+00022850: 0a20 2020 2020 2020 2031 2e37 362c 2020  .        1.76,  
+00022860: 342e 3334 342c 2032 2e39 3838 2c20 372e  4.344, 2.988, 7.
+00022870: 3434 2c20 2035 2e38 3034 2c20 392e 352c  44,  5.804, 9.5,
+00022880: 2020 2039 2e39 3034 2c20 332e 3139 362c     9.904, 3.196,
+00022890: 2033 2e30 3132 2c20 362e 3035 362c 0a20   3.012, 6.056,. 
+000228a0: 2020 2020 2020 2036 2e33 3238 2c20 392e         6.328, 9.
+000228b0: 3036 342c 2033 2e30 3638 2c20 392e 3335  064, 3.068, 9.35
+000228c0: 322c 2031 2e39 3336 2c20 312e 3038 2c20  2, 1.936, 1.08, 
+000228d0: 2031 2e39 3834 2c20 312e 3739 322c 2039   1.984, 1.792, 9
+000228e0: 2e33 3834 2c20 3130 2e31 352c 0a20 2020  .384, 10.15,.   
+000228f0: 2020 2020 2034 2e37 3536 2c20 312e 3532       4.756, 1.52
+00022900: 2c20 2033 2e39 3132 2c20 312e 3731 322c  ,  3.912, 1.712,
+00022910: 2031 302e 3537 2c20 352e 3330 342c 2032   10.57, 5.304, 2
+00022920: 2e39 3638 2c20 392e 3633 322c 2037 2e31  .968, 9.632, 7.1
+00022930: 3136 2c20 312e 3231 322c 0a20 2020 2020  16, 1.212,.     
+00022940: 2020 2038 2e35 3332 2c20 332e 3030 302c     8.532, 3.000,
+00022950: 2034 2e37 3932 2c20 322e 3531 322c 2031   4.792, 2.512, 1
+00022960: 2e33 3532 2c20 322e 3136 382c 2034 2e33  .352, 2.168, 4.3
+00022970: 3434 2c20 312e 3331 362c 2031 2e34 3638  44, 1.316, 1.468
+00022980: 2c20 312e 3135 322c 0a20 2020 2020 2020  , 1.152,.       
+00022990: 2036 2e30 3234 2c20 332e 3237 322c 2034   6.024, 3.272, 4
+000229a0: 2e39 362c 2031 302e 3136 2c20 2032 2e31  .96, 10.16,  2.1
+000229b0: 342c 2020 322e 3835 362c 2031 302e 3031  4,  2.856, 10.01
+000229c0: 2c20 312e 3233 322c 2032 2e36 3638 2c20  , 1.232, 2.668, 
+000229d0: 392e 3137 3620 5d0a 0a20 2020 2064 6566  9.176 ]..    def
+000229e0: 2065 7870 6f6e 656e 7469 616c 4465 6361   exponentialDeca
+000229f0: 7950 4446 2874 2c20 7461 753d 322e 2c20  yPDF(t, tau=2., 
+00022a00: 6662 673d 302e 322c 2061 3d31 2e2c 2062  fbg=0.2, a=1., b
+00022a10: 3d31 312e 3529 3a0a 2020 2020 2020 2222  =11.5):.      ""
+00022a20: 2250 726f 6261 6269 6c69 7479 2064 656e  "Probability den
+00022a30: 7369 7479 2066 756e 6374 696f 6e20 0a0a  sity function ..
+00022a40: 2020 2020 2020 666f 7220 616e 2065 7870        for an exp
+00022a50: 6f6e 656e 7469 616c 2064 6563 6179 2077  onential decay w
+00022a60: 6974 6820 666c 6174 2062 6163 6b67 726f  ith flat backgro
+00022a70: 756e 642e 2054 6865 2070 6466 2069 7320  und. The pdf is 
+00022a80: 6e6f 726d 6564 2066 6f72 200a 2020 2020  normed for .    
+00022a90: 2020 7468 6520 696e 7465 7276 616c 205b    the interval [
+00022aa0: 613d 31c2 b573 2c20 2062 3d31 312e 35c2  a=1..s,  b=11.5.
+00022ab0: b573 293b 2074 6865 7365 2070 6172 616d  .s); these param
+00022ac0: 6574 6572 7320 6120 616e 6420 6220 6d75  eters a and b mu
+00022ad0: 7374 2062 6520 0a20 2020 2020 2066 6978  st be .      fix
+00022ae0: 6564 2069 6e20 7468 6520 6669 7421 200a  ed in the fit! .
+00022af0: 0a20 2020 2020 203a 7061 7261 6d20 743a  .      :param t:
+00022b00: 2064 6563 6179 2074 696d 650a 2020 2020   decay time.    
+00022b10: 2020 3a70 6172 616d 2066 6267 3a20 6261    :param fbg: ba
+00022b20: 636b 6772 6f75 6e64 0a20 2020 2020 203a  ckground.      :
+00022b30: 7061 7261 6d20 7461 753a 2065 7870 6563  param tau: expec
+00022b40: 7465 6420 6d65 616e 206f 6620 7468 6520  ted mean of the 
+00022b50: 6465 6361 7920 7469 6d65 0a20 2020 2020  decay time.     
+00022b60: 203a 7061 7261 6d20 613a 2074 6865 206d   :param a: the m
+00022b70: 696e 696d 756d 2064 6563 6179 2074 696d  inimum decay tim
+00022b80: 6520 7768 6963 6820 6361 6e20 6265 206d  e which can be m
+00022b90: 6561 7375 7265 640a 2020 2020 2020 3a70  easured.      :p
+00022ba0: 6172 616d 2062 3a20 7468 6520 6d61 7869  aram b: the maxi
+00022bb0: 6d75 6d20 6465 6361 7920 7469 6d65 2077  mum decay time w
+00022bc0: 6869 6368 2063 616e 2062 6520 6d65 6173  hich can be meas
+00022bd0: 7572 6564 0a20 2020 2020 203a 7265 7475  ured.      :retu
+00022be0: 726e 3a20 7072 6f62 6162 696c 6974 7920  rn: probability 
+00022bf0: 666f 7220 6465 6361 7920 7469 6d65 2078  for decay time x
+00022c00: 0a20 2020 2020 2022 2222 0a20 2020 2020  .      """.     
+00022c10: 2070 6466 3120 3d20 6e70 2e65 7870 282d   pdf1 = np.exp(-
+00022c20: 7420 2f20 7461 7529 202f 2074 6175 202f  t / tau) / tau /
+00022c30: 2028 6e70 2e65 7870 282d 6120 2f20 7461   (np.exp(-a / ta
+00022c40: 7529 202d 206e 702e 6578 7028 2d62 202f  u) - np.exp(-b /
+00022c50: 2074 6175 2929 0a20 2020 2020 2070 6466   tau)).      pdf
+00022c60: 3220 3d20 312e 202f 2028 6220 2d20 6129  2 = 1. / (b - a)
+00022c70: 0a20 2020 2020 2072 6574 7572 6e20 2831  .      return (1
+00022c80: 202d 2066 6267 2920 2a20 7064 6631 202b   - fbg) * pdf1 +
+00022c90: 2066 6267 202a 2070 6466 320a 0a20 2020   fbg * pdf2..   
+00022ca0: 2072 6573 756c 7444 6963 7420 3d20 6d46   resultDict = mF
+00022cb0: 6974 2820 6578 706f 6e65 6e74 6961 6c44  it( exponentialD
+00022cc0: 6563 6179 5044 462c 0a20 2020 2020 2020  ecayPDF,.       
+00022cd0: 2020 2064 6174 6120 3d20 6454 2c20 2320     data = dT, # 
+00022ce0: 6461 7461 202d 2069 6620 6e6f 7420 4e6f  data - if not No
+00022cf0: 6e65 2c20 6120 6e6f 726d 616c 6973 6564  ne, a normalised
+00022d00: 2050 4446 2069 7320 6173 7375 6d65 6420   PDF is assumed 
+00022d10: 6173 206d 6f64 656c 2020 0a20 2020 2020  as model  .     
+00022d20: 2020 2020 2070 303d 4e6f 6e65 2c20 2020       p0=None,   
+00022d30: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00022d40: 696e 6974 6961 6c20 6775 6573 7320 666f  initial guess fo
+00022d50: 7220 7061 7261 6d65 7465 7220 7661 6c75  r parameter valu
+00022d60: 6573 200a 2020 2020 2020 2020 2320 2063  es .        #  c
+00022d70: 6f6e 7374 7261 696e 7473 3d5b 5b27 7461  onstraints=[['ta
+00022d80: 7527 2c20 322e 322c 2030 2e30 315d 2c20  u', 2.2, 0.01], 
+00022d90: 2320 4761 7573 7369 616e 2070 6172 616d  # Gaussian param
+00022da0: 6574 6572 2063 6f6e 7374 7261 696e 7473  eter constraints
+00022db0: 0a20 2020 2020 2020 2020 206c 696d 6974  .          limit
+00022dc0: 733d 2827 6662 6727 2c20 302e 2c20 312e  s=('fbg', 0., 1.
+00022dd0: 292c 2020 2320 7061 7261 6d65 7465 7220  ),  # parameter 
+00022de0: 6c69 6d69 7473 0a20 2020 2020 2020 2020  limits.         
+00022df0: 2066 6978 5061 7273 203d 205b 2761 272c   fixPars = ['a',
+00022e00: 2027 6227 5d2c 2020 2020 2320 6669 7820   'b'],    # fix 
+00022e10: 7061 7261 6d65 7465 7228 7329 200a 2020  parameter(s) .  
+00022e20: 2020 2020 2020 2020 6e65 6732 6c6f 674c          neg2logL
+00022e30: 203d 2054 7275 652c 2020 2020 2020 2020   = True,        
+00022e40: 2023 2075 7365 2020 2d32 202a 206c 6e28   # use  -2 * ln(
+00022e50: 4c29 0a20 2020 2020 2020 2020 2070 6c6f  L).          plo
+00022e60: 743d 5472 7565 2c20 2020 2020 2020 2020  t=True,         
+00022e70: 2020 2020 2020 2320 706c 6f74 2064 6174        # plot dat
+00022e80: 6120 616e 6420 6d6f 6465 6c0a 2020 2020  a and model.    
+00022e90: 2020 2020 2020 706c 6f74 5f62 616e 643d        plot_band=
+00022ea0: 5472 7565 2c20 2020 2020 2020 2020 2023  True,          #
+00022eb0: 2070 6c6f 7420 6d6f 6465 6c20 636f 6e66   plot model conf
+00022ec0: 6964 656e 6365 2d62 616e 640a 2020 2020  idence-band.    
+00022ed0: 2020 2020 2020 706c 6f74 5f63 6f72 3d46        plot_cor=F
+00022ee0: 616c 7365 2c20 2020 2020 2020 2020 2023  alse,          #
+00022ef0: 2070 6c6f 7420 7072 6f66 696c 6573 206c   plot profiles l
+00022f00: 696b 656c 6968 6f6f 6420 616e 6420 636f  ikelihood and co
+00022f10: 6e74 6f75 7273 0a20 2020 2020 2020 2020  ntours.         
+00022f20: 2073 686f 7770 6c6f 7473 3d46 616c 7365   showplots=False
+00022f30: 2c20 2020 2020 2020 2020 2320 7368 6f77  ,         # show
+00022f40: 202f 2064 6f6e 2774 2073 686f 7720 706c   / don't show pl
+00022f50: 6f74 730a 2020 2020 2020 2020 2020 7175  ots.          qu
+00022f60: 6965 743d 4661 6c73 652c 2020 2020 2020  iet=False,      
+00022f70: 2020 2020 2020 2023 2073 7570 7072 6573         # suppres
+00022f80: 7320 696e 666f 726d 6174 6976 6520 7072  s informative pr
+00022f90: 696e 746f 7574 2069 6620 5472 7565 0a20  intout if True. 
+00022fa0: 2020 2020 2020 2020 2061 7869 735f 6c61           axis_la
+00022fb0: 6265 6c73 3d5b 276c 6966 6520 7469 6d65  bels=['life time
+00022fc0: 2020 2720 2b20 2724 5c44 656c 7461 2474    ' + '$\Delta$t
+00022fd0: 2028 245c 6d75 2473 2927 2c20 0a20 2020   ($\mu$s)', .   
+00022fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022ff0: 2020 2020 2750 726f 6261 6269 6c69 7479      'Probability
+00023000: 2044 656e 7369 7479 2020 7064 6628 245c   Density  pdf($\
+00023010: 4465 6c74 6124 743b 202a 7029 275d 2c20  Delta$t; *p)'], 
+00023020: 0a20 2020 2020 2020 2020 2064 6174 615f  .          data_
+00023030: 6c65 6765 6e64 203d 2027 245c 6d75 2420  legend = '$\mu$ 
+00023040: 6c69 6665 7469 6d65 2064 6174 6127 2c20  lifetime data', 
+00023050: 2020 200a 2020 2020 2020 2020 2020 6d6f     .          mo
+00023060: 6465 6c5f 6c65 6765 6e64 203d 2027 6578  del_legend = 'ex
+00023070: 706f 6e65 6e74 6961 6c20 6465 6361 7920  ponential decay 
+00023080: 2b20 666c 6174 2062 6163 6b67 726f 756e  + flat backgroun
+00023090: 6427 2029 0a20 2020 2020 2020 2020 200a  d' ).          .
+000230a0: 2020 2020 706c 742e 7375 7074 6974 6c65      plt.suptitle
+000230b0: 2822 556e 6269 6e6e 6564 204d 4c20 6669  ("Unbinned ML fi
+000230c0: 7420 6f66 2061 6e20 6578 706f 6e65 6e74  t of an exponent
+000230d0: 6961 6c20 2b20 666c 6174 2064 6973 7472  ial + flat distr
+000230e0: 6962 7574 696f 6e22 2c0a 2020 2020 2020  ibution",.      
+000230f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00023100: 697a 653d 2778 782d 6c61 7267 6527 2c20  ize='xx-large', 
+00023110: 636f 6c6f 723d 2764 6172 6b62 6c75 6527  color='darkblue'
+00023120: 290a 2020 2020 2320 5072 696e 7420 7265  ).    # Print re
+00023130: 7375 6c74 730a 2020 2020 7076 616c 732c  sults.    pvals,
+00023140: 2070 6572 7273 2c20 636f 722c 2067 6f66   perrs, cor, gof
+00023150: 2c20 706e 616d 7320 3d20 7265 7375 6c74  , pnams = result
+00023160: 4469 6374 2e76 616c 7565 7328 290a 2020  Dict.values().  
+00023170: 2020 7072 696e 7428 275c 6e2a 3d3d 2a20    print('\n*==* 
+00023180: 756e 6269 6e6e 6564 204d 4c20 4669 7420  unbinned ML Fit 
+00023190: 5265 7375 6c74 3a27 290a 2020 2020 7072  Result:').    pr
+000231a0: 696e 7428 2220 7061 7261 6d65 7465 7220  int(" parameter 
+000231b0: 6e61 6d65 733a 2020 2020 2020 2022 2c20  names:       ", 
+000231c0: 706e 616d 7329 0a20 2020 2070 7269 6e74  pnams).    print
+000231d0: 2822 2070 6172 616d 6574 6572 2076 616c  (" parameter val
+000231e0: 7565 733a 2020 2020 2020 222c 2070 7661  ues:      ", pva
+000231f0: 6c73 290a 2020 2020 7072 696e 7428 2220  ls).    print(" 
+00023200: 6e65 672e 2070 6172 616d 6574 6572 2065  neg. parameter e
+00023210: 7272 6f72 733a 2022 2c20 7065 7272 735b  rrors: ", perrs[
+00023220: 3a2c 305d 290a 2020 2020 7072 696e 7428  :,0]).    print(
+00023230: 2220 706f 732e 2070 6172 616d 6574 6572  " pos. parameter
+00023240: 2065 7272 6f72 733a 2022 2c20 7065 7272   errors: ", perr
+00023250: 735b 3a2c 315d 290a 2020 2020 7072 696e  s[:,1]).    prin
+00023260: 7428 2220 636f 7272 656c 6174 696f 6e73  t(" correlations
+00023270: 203a 205c 6e22 2c20 636f 7229 2020 0a0a   : \n", cor)  ..
+00023280: 2020 230a 2020 2320 2d2d 2d2d 2d2d 2d2d    #.  # --------
+00023290: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000232a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000232b0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
 000232c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000232d0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000232e0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 230a  -----------.  #.
-000232f0: 2020 2320 2d2d 2d20 7275 6e20 6162 6f76    # --- run abov
-00023300: 6520 6578 616d 706c 6573 0a0a 2020 7072  e examples..  pr
-00023310: 696e 7428 222a 2a2a 2078 7920 6669 7420  int("*** xy fit 
-00023320: 6578 616d 706c 6522 290a 2020 6578 616d  example").  exam
-00023330: 706c 655f 7879 4669 7428 290a 0a20 2070  ple_xyFit()..  p
-00023340: 7269 6e74 2822 2a2a 2a20 696e 6465 7865  rint("*** indexe
-00023350: 6420 6669 7420 6578 616d 706c 6522 290a  d fit example").
-00023360: 2020 6578 616d 706c 655f 696e 6465 7865    example_indexe
-00023370: 6446 6974 2829 0a0a 2020 7072 696e 7428  dFit()..  print(
-00023380: 225c 6e5c 6e2a 2a2a 2068 6973 746f 6772  "\n\n*** histogr
-00023390: 616d 2066 6974 2065 7861 6d70 6c65 2229  am fit example")
-000233a0: 0a20 2065 7861 6d70 6c65 5f68 6973 746f  .  example_histo
-000233b0: 6772 616d 4669 7428 290a 0a20 2070 7269  gramFit()..  pri
-000233c0: 6e74 2822 5c6e 5c6e 2a2a 2a20 6d69 6e75  nt("\n\n*** minu
-000233d0: 6974 2066 6974 2077 6974 6820 6578 7465  it fit with exte
-000233e0: 726e 616c 2063 6f73 7420 6675 6e63 7469  rnal cost functi
-000233f0: 6f6e 2229 0a20 2065 7861 6d70 6c65 5f75  on").  example_u
-00023400: 7365 7246 6974 2829 0a0a 2020 7072 696e  serFit()..  prin
-00023410: 7428 225c 6e5c 6e2a 2a2a 204d 4c20 6d69  t("\n\n*** ML mi
-00023420: 6e75 6974 2046 6974 2229 0a20 2065 7861  nuit Fit").  exa
-00023430: 6d70 6c65 5f75 6e62 696e 6e65 644d 4c46  mple_unbinnedMLF
-00023440: 6974 2829 0a0a 2020 2320 7368 6f77 2061  it()..  # show a
-00023450: 6c6c 2066 6967 7572 6573 0a20 2070 6c74  ll figures.  plt
-00023460: 2e73 686f 7728 290a                      .show().
+000232d0: 2d0a 2020 230a 2020 2320 2d2d 2d20 7275  -.  #.  # --- ru
+000232e0: 6e20 6162 6f76 6520 6578 616d 706c 6573  n above examples
+000232f0: 0a0a 2020 7072 696e 7428 222a 2a2a 2078  ..  print("*** x
+00023300: 7920 6669 7420 6578 616d 706c 6522 290a  y fit example").
+00023310: 2020 6578 616d 706c 655f 7879 4669 7428    example_xyFit(
+00023320: 290a 0a20 2070 7269 6e74 2822 2a2a 2a20  )..  print("*** 
+00023330: 696e 6465 7865 6420 6669 7420 6578 616d  indexed fit exam
+00023340: 706c 6522 290a 2020 6578 616d 706c 655f  ple").  example_
+00023350: 696e 6465 7865 6446 6974 2829 0a0a 2020  indexedFit()..  
+00023360: 7072 696e 7428 225c 6e5c 6e2a 2a2a 2068  print("\n\n*** h
+00023370: 6973 746f 6772 616d 2066 6974 2065 7861  istogram fit exa
+00023380: 6d70 6c65 2229 0a20 2065 7861 6d70 6c65  mple").  example
+00023390: 5f68 6973 746f 6772 616d 4669 7428 290a  _histogramFit().
+000233a0: 0a20 2070 7269 6e74 2822 5c6e 5c6e 2a2a  .  print("\n\n**
+000233b0: 2a20 6d69 6e75 6974 2066 6974 2077 6974  * minuit fit wit
+000233c0: 6820 6578 7465 726e 616c 2063 6f73 7420  h external cost 
+000233d0: 6675 6e63 7469 6f6e 2229 0a20 2065 7861  function").  exa
+000233e0: 6d70 6c65 5f75 7365 7246 6974 2829 0a0a  mple_userFit()..
+000233f0: 2020 7072 696e 7428 225c 6e5c 6e2a 2a2a    print("\n\n***
+00023400: 204d 4c20 6d69 6e75 6974 2046 6974 2229   ML minuit Fit")
+00023410: 0a20 2065 7861 6d70 6c65 5f75 6e62 696e  .  example_unbin
+00023420: 6e65 644d 4c46 6974 2829 0a0a 2020 2320  nedMLFit()..  # 
+00023430: 7368 6f77 2061 6c6c 2066 6967 7572 6573  show all figures
+00023440: 0a20 2070 6c74 2e73 686f 7728 290a       .  plt.show().
```

### Comparing `PhyPraKit-1.2.4/PhyPraKit/plotData.py` & `PhyPraKit-1.2.5/PhyPraKit/plotData.py`

 * *Files identical despite different names*

### Comparing `PhyPraKit-1.2.4/PhyPraKit/run_phyFit.py` & `PhyPraKit-1.2.5/PhyPraKit/run_phyFit.py`

 * *Files 3% similar despite different names*

```diff
@@ -208,15 +208,15 @@
     fit = xyFit_from_yaml
   elif fitType == 'histogram':
     fit = hFit_from_yaml
   else:
     print('!!! unsupported type of fit:', fitType)
     wexit(1)
 
-  for fd in ddata:  
+  for count, fd in enumerate(ddata):  
     if 'type' in fd.keys():
       fitType = fd['type']
     print("*==*", sys.argv[0], "received valid yaml data for fit:")
     if 'parametric_model' in fd: # for complex kafe2go format
       pprint(fd, compact=True)
     else:  # "nice" printout for simple xyFit format
       print(' **  Type of Fit:', fitType)
@@ -227,21 +227,23 @@
               print(key + ': ', fd[key])
         else:  # got list of uncertainty dictionaries
           print(key+':')
           for d in fd[key]:
             for k in d:
               print('  '+ k +': ', d[k], end=' ') 
             print()
-  # run fit    
-    rdict = fit(fd,                     # the input dictionary defining the fit 
-              plot=plt_flg,           # show plot of data and model
-              plot_band=band_flg,     # plot model confidence-band
-              plot_cor=cont_flg,      # plot profiles likelihood and contours
-              showplots= False,        # show plots on screen 
-              quiet=quiet_flg,        # suppress informative printout
+  # run fit
+    same = True if count > 0 else False
+    rdict = fit(fd,                 # the input dictionary defining the fit 
+              plot=plt_flg,         # show plot of data and model
+              plot_band=band_flg,   # plot model confidence-band
+              plot_cor=cont_flg,    # plot profiles likelihood and contours
+              showplots= False,     # show plots on screen
+              same_plot = same,     # overlay fit info for multiple data sets
+              quiet=quiet_flg,      # suppress informative printout
               return_fitObject=False
                ) 
 
   # print results to illustrate how to use output
     print('\n*==* Fit Result:')
     pvals, perrs, cor, chi2, pnams= rdict.values()
     print(" chi2: {:.3g}".format(chi2))
```

### Comparing `PhyPraKit-1.2.4/PhyPraKit.egg-info/PKG-INFO` & `PhyPraKit-1.2.5/PhyPraKit.egg-info/PKG-INFO`

 * *Files 17% similar despite different names*

```diff
@@ -1,71 +1,75 @@
-Metadata-Version: 1.1
+Metadata-Version: 2.1
 Name: PhyPraKit
-Version: 1.2.4
+Version: 1.2.5
 Summary: Tools for data visualisation and analysis in Physics Lab Courses
 Home-page: http://www.etp.kit.edu/~quast/
 Author: Guenter Quast
 Author-email: Guenter.Quast@online.de
 License: GNU Public Licence
-Description: *************
-        **PhyPraKit**
-        *************
-        
-        About
-        -----
-        
-        PhyPraKit is a collection of python modules `(supporting python 2.7
-        (deprecated) and python >=3.6)` for data visualization and analysis
-        in experimental laboratory courses in physics, developed at the
-        faculty of physics at Karlsruhe Institute of Technology (KIT).
-        As the modules are intended primarily for use by undergraduate
-        students in Karlsruhe, the documentation is partly in German
-        language, in particular the description of the examples.
-        
-        Created by: 
-        
-        * Guenter Quast <guenter (dot) quast (at) online (dot) de>
-        
-          
-        Installation:
-        -------------
-        
-        To use PhyPraKit, it is sufficient to place the the directory
-        `PhyPraKit` and all the files in it in the same directory as the
-        python scripts importing it.
-        
-        Installation via `pip` is also supported. After downloading, execute: 
-        
-        ``pip install --user .`` 
-        
-        in the main directory of the *PhyPraKit* package (where *setup.py*
-        is located) to install in user space.  
-        
-        The installation using the *whl*-package provided in the subdirectory
-        `dist` may also be used:
-        
-           ``pip install --user --no-cache PhyPraKit<version>.whl``
-        
-        Installation via the PyPi Python Package Index is also available, simply
-        execute:
-           
-           ``pip install --user PhyPraKit``
-        
-        [Documentaion on "Read the Docs"](https://readthedocs.org/projects/phyprakit/)
-        
-        
-        Übersicht:
-        ----------
-        
-        PhyPraKit ist eine Sammlung nützlicher Funktionen in der Sprache 
-        `Python (vers. >=3.6, 2.7 noch für manche Module lauffähig)`
-        zum Aufnehmen, zur Bearbeitung, Visualisierung  und  Auswertung
-        von Daten in den physikalischen Praktika.
-        Die Anwendung der verschiedenen Funktionen des Pakets
-        werden jeweils durch konkrete Beispiele illustriert.
-        
-        [Dokumentation auf "Read the Docs"](https://readthedocs.org/projects/phyprakit/)
-        
 Platform: UNKNOWN
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Programming Language :: Python :: 2.7
 Classifier: Programming Language :: Python :: 3.6
+License-File: LICENSE
+License-File: AUTHORS
+
+*************
+**PhyPraKit**
+*************
+
+About
+-----
+
+PhyPraKit is a collection of python modules `(supporting python 2.7
+(deprecated) and python >=3.6)` for data visualization and analysis
+in experimental laboratory courses in physics, developed at the
+faculty of physics at Karlsruhe Institute of Technology (KIT).
+As the modules are intended primarily for use by undergraduate
+students in Karlsruhe, the documentation is partly in German
+language, in particular the description of the examples.
+
+Created by: 
+
+* Guenter Quast <guenter (dot) quast (at) online (dot) de>
+
+  
+Installation:
+-------------
+
+To use PhyPraKit, it is sufficient to place the directory
+`PhyPraKit` and all the files in it in the same directory as the
+python scripts importing it.
+
+Installation via `pip` is also supported. After downloading, execute: 
+
+``pip install --user .`` 
+
+in the main directory of the *PhyPraKit* package (where *setup.py*
+is located) to install in user space.  
+
+The installation using the *whl*-package provided in the subdirectory
+`dist` may also be used:
+
+   ``pip install --user --no-cache PhyPraKit<version>.whl``
+
+Installation via the PyPi Python Package Index is also available, simply
+execute:
+   
+   ``pip install --user PhyPraKit``
+
+[Documentaion on "Read the Docs"](https://readthedocs.org/projects/phyprakit/)
+
+
+Übersicht:
+----------
+
+PhyPraKit ist eine Sammlung nützlicher Funktionen in der Sprache 
+`Python (vers. >=3.6, 2.7 noch für manche Module lauffähig)`
+zum Aufnehmen, zur Bearbeitung, Visualisierung  und  Auswertung
+von Daten in den physikalischen Praktika.
+Die Anwendung der verschiedenen Funktionen des Pakets
+werden jeweils durch konkrete Beispiele illustriert.
+
+[Dokumentation auf "Read the Docs"](https://readthedocs.org/projects/phyprakit/)
+
+
```

### Comparing `PhyPraKit-1.2.4/README.md` & `PhyPraKit-1.2.5/README.md`

 * *Files 4% similar despite different names*

```diff
@@ -17,15 +17,15 @@
 
 * Guenter Quast <guenter (dot) quast (at) online (dot) de>
 
   
 Installation:
 -------------
 
-To use PhyPraKit, it is sufficient to place the the directory
+To use PhyPraKit, it is sufficient to place the directory
 `PhyPraKit` and all the files in it in the same directory as the
 python scripts importing it.
 
 Installation via `pip` is also supported. After downloading, execute: 
 
 ``pip install --user .``
```

### Comparing `PhyPraKit-1.2.4/setup.py` & `PhyPraKit-1.2.5/setup.py`

 * *Files 12% similar despite different names*

```diff
@@ -17,15 +17,15 @@
     author='Guenter Quast',
     author_email='Guenter.Quast@online.de',
     url='http://www.etp.kit.edu/~quast/',
     license='GNU Public Licence',
     description='Tools for data visualisation and analysis in Physics Lab Courses',
     long_description=README,
     scripts=['tools/run_phyFit.py', 'tools/plotData.py',
-             'tools/csv2yml.py', 'tools/plotCSV.py' ],
+             'tools/csv2yml.py', 'tools/plotCSV.py' , 'tools/smoothCSV.py'],
     classifiers=[
     'Development Status :: 5 - Production/Stable',
     #    'Development Status :: 4 - Beta',
     # Specify the Python versions you support here. In particular, ensure
     # that you indicate whether you support Python 2, Python 3 or both.
     'Programming Language :: Python :: 2.7',
     'Programming Language :: Python :: 3.6',
```

### Comparing `PhyPraKit-1.2.4/tools/csv2yml.py` & `PhyPraKit-1.2.5/tools/csv2yml.py`

 * *Files 6% similar despite different names*

```diff
@@ -47,34 +47,38 @@
       help="quiet - no output to screen")
   parser.add_argument('-d','--delimiter', 
                       type=str, default=',',
            help="delimiter, default=','")
   parser.add_argument('-n','--header_lines', 
                       type=int, default=1,
            help="numer of header lines, default=1")
+  parser.add_argument('-k','--key_line', 
+                      type=int, default=0,
+           help="header line containing keys, default=0")
   
   if len(sys.argv)==1:  # print help message if no input given
     parser.print_help()
     raise ValueError('!!! not input given -exit !')
 
   # collect input from ArgumentParser
   args = parser.parse_args()
   fnam = args.filename
 
   nlhead = args.header_lines
+  l_key = args.key_line  
   delim = args.delimiter
   showHeader = args.Header
   sav_flg = args.save
   quiet = args.quiet
   if quiet: sav_flg = True
 
   # ---- end argument parsing -------------------
   
   f = open(fnam, 'r') 
-  hlines, ylines = csv2yaml(f, nlhead, delim)
+  hlines, ylines = csv2yaml(f, nlhead, delim, l_key)
 
   if not quiet:
     print('-->', fnam, 'to yaml', end='')
 
   if showHeader:
     print('  csv header:')
     for l in hlines:
```

### Comparing `PhyPraKit-1.2.4/tools/plotCSV.py` & `PhyPraKit-1.2.5/tools/plotCSV.py`

 * *Files identical despite different names*

### Comparing `PhyPraKit-1.2.4/tools/plotData.py` & `PhyPraKit-1.2.5/tools/plotData.py`

 * *Files identical despite different names*

### Comparing `PhyPraKit-1.2.4/tools/run_phyFit.py` & `PhyPraKit-1.2.5/tools/run_phyFit.py`

 * *Files 2% similar despite different names*

```diff
@@ -208,15 +208,15 @@
     fit = xyFit_from_yaml
   elif fitType == 'histogram':
     fit = hFit_from_yaml
   else:
     print('!!! unsupported type of fit:', fitType)
     wexit(1)
 
-  for fd in ddata:  
+  for count, fd in enumerate(ddata):  
     if 'type' in fd.keys():
       fitType = fd['type']
     print("*==*", sys.argv[0], "received valid yaml data for fit:")
     if 'parametric_model' in fd: # for complex kafe2go format
       pprint(fd, compact=True)
     else:  # "nice" printout for simple xyFit format
       print(' **  Type of Fit:', fitType)
@@ -227,21 +227,22 @@
               print(key + ': ', fd[key])
         else:  # got list of uncertainty dictionaries
           print(key+':')
           for d in fd[key]:
             for k in d:
               print('  '+ k +': ', d[k], end=' ') 
             print()
-  # run fit    
+  # run fit
+    same = True if count > 0 else False
     rdict = fit(fd,                 # the input dictionary defining the fit 
               plot=plt_flg,         # show plot of data and model
               plot_band=band_flg,   # plot model confidence-band
               plot_cor=cont_flg,    # plot profiles likelihood and contours
               showplots= False,     # show plots on screen
-            #!  same_plot = True,     # overlay fit info for multiple data sets
+              same_plot = same,     # overlay fit info for multiple data sets
               quiet=quiet_flg,      # suppress informative printout
               return_fitObject=False
                ) 
 
   # print results to illustrate how to use output
     print('\n*==* Fit Result:')
     pvals, perrs, cor, chi2, pnams= rdict.values()
```

